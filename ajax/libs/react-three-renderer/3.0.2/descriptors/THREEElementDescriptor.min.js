"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_invariant=require("fbjs/lib/invariant"),_invariant2=_interopRequireDefault(_invariant),_warning=require("fbjs/lib/warning"),_warning2=_interopRequireDefault(_warning),_events=require("events"),_events2=_interopRequireDefault(_events),_ReactPropTypes=require("react/lib/ReactPropTypes"),_ReactPropTypes2=_interopRequireDefault(_ReactPropTypes),_checkReactTypeSpec=require("react/lib/checkReactTypeSpec"),_checkReactTypeSpec2=_interopRequireDefault(_checkReactTypeSpec),_React3Instance=require("../React3Instance"),_React3Instance2=_interopRequireDefault(_React3Instance);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var EventEmitter=_events2.default.EventEmitter,THREEElementDescriptor=function(){function t(e){_classCallCheck(this,t),this.react3RendererInstance=e,this.propUpdates={},this.propDeletes={},this.propDefaults={},this._initialOnly={},this._updateInitial=[],this._simpleProperties=[],this.propTypes={},this._hasName=!1}return _createClass(t,[{key:"hasEvent",value:function(a){this._hasEvents=!0,this.hasProp(a,{type:_ReactPropTypes2.default.func,updateInitial:!0,update:function(e,t){e.userData._eventCallbacks[a]=t},default:null})}},{key:"removeProp",value:function(e){(0,_invariant2.default)(this.propTypes.hasOwnProperty(e),"The property %s has not been defined",e);var t=this._simpleProperties.indexOf(e);-1!==t&&this._simpleProperties.splice(t,1),delete this.propTypes[e],delete this.propDeletes[e],delete this.propUpdates[e],delete this.propDefaults[e];var a=this._updateInitial.indexOf(e);-1!==a&&this._updateInitial.splice(a,1),delete this._initialOnly[e]}},{key:"hasProp",value:function(t,a){var e,n=this;(0,_invariant2.default)(a.hasOwnProperty("type"),"The information should include a `type` property"),(0,_invariant2.default)(!this.propTypes.hasOwnProperty(t)||a.override,"The property %s has already been defined",t),!a.override||-1!==(e=this._simpleProperties.indexOf(t))&&this._simpleProperties.splice(e,1),this.propTypes[t]=a.type,a.hasOwnProperty("simple")?(this.registerSimpleProperties([t]),a.hasOwnProperty("default")&&(this.propDeletes[t]=function(e){n.propUpdates[t](e,a.default,!0)},this.propDefaults[t]=a.default)):(a.hasOwnProperty("update")&&(this.propUpdates[t]=a.update),a.hasOwnProperty("default")?((0,_invariant2.default)(a.hasOwnProperty("update"),"The information should include a `update` property if it has a `default` property"),this.propDeletes[t]=function(e){a.update(e,a.default,!0)},this.propDefaults[t]=a.default):(0,_invariant2.default)(a.update===this.triggerRemount,"The type information for "+this.constructor.name+"."+t+" should include a `default` property if it's not going to trigger remount"),a.hasOwnProperty("remove")&&(0,_invariant2.default)(!1,"Bad 'remove' info for "+this.constructor.name+"."+t),a.hasOwnProperty("updateInitial")&&((0,_invariant2.default)(a.hasOwnProperty("update"),"The information should include a `update` property if it has a`updateInitial` property"),"production"!==process.env.NODE_ENV&&(0,_invariant2.default)(a.hasOwnProperty("default")||3===this.propUpdates[t].length||this.propUpdates[t]===this.triggerRemount,"Prop info for "+this.constructor.name+"."+t+" has 'updateInitial', but no 'default', and the update function accepts "+this.propUpdates[t].length+" parameters instead of 3."),-1===this._updateInitial.indexOf(t)&&this._updateInitial.push(t)),a.initialOnly&&(0,_invariant2.default)(a.hasOwnProperty("updateInitial"),"The information should include a `updateInitial` property if it has an `initialOnly` property"),this._initialOnly[t]=a.initialOnly)}},{key:"hasName",value:function(){var a=this;this._hasName=!0,this.hasProp("name",{type:_ReactPropTypes2.default.string,update:function(e,t){a._updateName(e,t)},default:""})}},{key:"_updateName",value:function(e,t){var a=e.name;e.name=t,e.userData.events.emit("rename",{oldName:a,nextName:t});var n=e.userData.markup;n._rootInstance&&n._rootInstance.objectRenamed(e,a,t)}},{key:"placeRemountTrigger",value:function(e,t){e.userData._triggerRemount=t}},{key:"applyInitialProps",value:function(n,a){var r=this,e=new EventEmitter;this._hasName&&a.name&&(n.name=a.name),this._hasEvents&&(n.userData._eventCallbacks={}),e.on("resource.added",function(e){var t=n.userData.markup.childrenMarkup,a=_extends({},e,{distance:e.distance+1});t.forEach(function(e){return e.threeObject.userData.events.emit("resource.added",a)})}),e.on("resource.removed",function(e){var t=n.userData.markup.childrenMarkup,a=_extends({},e,{distance:e.distance+1});t.forEach(function(e){return e.threeObject.userData.events.emit("resource.removed",a)})}),n.userData.events=e,(n.userData._descriptor=this)._updateInitial.forEach(function(e){var t;a.hasOwnProperty(e)?r.propUpdates[e](n,a[e],!0):(t=void 0,r.propDefaults.hasOwnProperty(e)&&(t=r.propDefaults[e]),r.propUpdates[e](n,t,!1))}),this._simpleProperties.forEach(function(e){a.hasOwnProperty(e)&&(n[e]=a[e])})}},{key:"construct",value:function(){(0,_invariant2.default)(!1,"Missing constructor!")}},{key:"addChildren",value:function(){(0,_invariant2.default)(!1,"Cannot add children to "+this.constructor.name+"!")}},{key:"addChild",value:function(){(0,_invariant2.default)(!1,"Cannot add child to "+this.constructor.name+"!")}},{key:"moveChild",value:function(){(0,_invariant2.default)(!1,"Cannot move children in "+this.constructor.name+"!")}},{key:"removeChild",value:function(){(0,_invariant2.default)(!1,"Cannot remove children in "+this.constructor.name+"!")}},{key:"setParent",value:function(e,t){var a=t.userData.markup;a&&a._rootInstance&&a._rootInstance.objectMounted(e)}},{key:"componentWillUnmount",value:function(){}},{key:"unmount",value:function(e){var t=e.userData.markup;t._rootInstance&&t._rootInstance.objectRemoved(e),this._hasEvents&&delete e.userData._eventCallbacks,e.userData.events.emit("dispose",{object:e}),e.userData.events.removeAllListeners()}},{key:"removedFromParent",value:function(e){delete e.userData.events}},{key:"deleteProperty",value:function(e,t){this.propDeletes[t]?this.propDeletes[t](e):"production"!==process.env.NODE_ENV&&(0,_warning2.default)(!1,"Cannot delete property %s from "+this.constructor.name,t)}},{key:"updateProperty",value:function(e,t,a){this._initialOnly[t]?this.triggerRemount(e):this.propUpdates[t]?this.propUpdates[t](e,a,!0):((0,_warning2.default)(!1,"updating prop "+t+" ( "+a+" ) for "+this.constructor.name),this.triggerRemount(e))}},{key:"highlight",value:function(){}},{key:"hideHighlight",value:function(){}},{key:"useSimpleUpdates",value:function(e){for(var t=0;t<e.length;++t){var a=e[t];this.propUpdates[a]=this._updateSimple.bind(this,a)}}},{key:"_updateSimple",value:function(e,t,a){t[e]=a}},{key:"registerSimpleProperties",value:function(e){var t=this;e.forEach(function(e){-1===t._simpleProperties.indexOf(e)&&t._simpleProperties.push(e)}),this.useSimpleUpdates(e)}},{key:"getBoundingBoxes",value:function(){return[]}},{key:"triggerRemount",value:function(e){e.userData._triggerRemount&&(e.userData._triggerRemount(),delete e.userData._triggerRemount)}},{key:"beginPropertyUpdates",value:function(){}},{key:"completePropertyUpdates",value:function(){}},{key:"beginChildUpdates",value:function(){}},{key:"completeChildUpdates",value:function(){}}]),t}();"production"!==process.env.NODE_ENV&&function(){function d(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var h={};THREEElementDescriptor.prototype.checkPropTypes=function(e,t,a,n){!function(e,t,a,n,r,i,o){for(var s=Object.keys(a),p=0;p<s.length;++p){var u,l,c=s[p];"children"!==c&&(t.hasOwnProperty(c)||((u="Foreign prop "+c+" found in "+e+".")in h||(l=d(r),h[u]=!0,(0,_warning2.default)(!1,u+l))))}(0,_checkReactTypeSpec2.default)(t,a,n,e,i,o)}(e.type,this.propTypes,n,"prop",t,e,a)}}(),module.exports=THREEElementDescriptor;