"use strict";var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0});const path_to_regexp_1=__importDefault(require("path-to-regexp")),errors_1=require("./errors");class RouterMatcher{constructor(r){this.matchers=[];for(const e of r)this.addRouteRecord(e)}addRouteRecord(r,e){const t=[],o={...r};if(e&&"/"!==r.path[0]){let t=e.record.path;o.path&&(t+="/"),t+=r.path,o.path=t}const a={parent:e,record:o,re:path_to_regexp_1.default(o.path,t,{}),keys:t.map(r=>""+r.name),resolve:path_to_regexp_1.default.compile(o.path)};if("children"in r&&r.children)for(const e of r.children)this.addRouteRecord(e,a);this.matchers.push(a)}resolveAsPath(){}resolve(r,e){let t,o,a,n={};if("path"in r){if(!(t=this.matchers.find(e=>e.re.test(r.path))))throw new errors_1.NoRouteMatchError(e,r);o=r.path,a=t.record.name;const c=t.re.exec(o);if(!c)throw new Error(`Error parsing path "${r.path}"`);for(let e=0;e<t.keys.length;e++){const o=t.keys[e],a=c[e+1];if(!a)throw new Error(`Error parsing path "${r.path}" when looking for param "${o}"`);n[o]=a}if("redirect"in t.record){const{redirect:r}=t.record;return{redirect:r,normalizedLocation:{name:a,path:o,matched:[],params:n}}}}else if("name"in r){if(!(t=this.matchers.find(e=>e.record.name===r.name)))throw new errors_1.NoRouteMatchError(e,r);if(a=t.record.name,n=r.params||e.params,o=t.resolve(n),"redirect"in t.record){const{redirect:r}=t.record;return{redirect:r,normalizedLocation:{name:a,path:o,matched:[],params:n}}}}else{if(!(t=e.name?this.matchers.find(r=>r.record.name===e.name):this.matchers.find(r=>r.re.test(e.path))))throw new errors_1.NoRouteMatchError(e,r);a=t.record.name,n=r.params||e.params,o=t.resolve(n)}if("redirect"in t.record)throw new errors_1.InvalidRouteMatch(r);const c=[t.record];let s=t.parent;for(;s;){if("redirect"in s.record)throw new Error("TODO");c.unshift(s.record),s=s.parent}return{name:a,path:o,params:n,matched:c}}}exports.RouterMatcher=RouterMatcher;