"use strict";const headersSchema=Symbol("headers-schema"),paramsSchema=Symbol("params-schema"),querystringSchema=Symbol("querystring-schema"),bodySchema=Symbol("body-schema"),responseSchema=Symbol("response-schema");function compileSchemasForSerialization(e,r){if(!e.schema||!e.schema.response)return;const{method:a,url:t}=e.config||{};e[responseSchema]=Object.keys(e.schema.response).reduce(function(s,o){return s[o]=r({schema:e.schema.response[o],url:t,method:a,httpStatus:o}),s},{})}function compileSchemasForValidation(e,r){if(!e.schema)return;const{method:a,url:t}=e.config||{},s=e.schema.headers;if(s&&Object.getPrototypeOf(s)!==Object.prototype)e[headersSchema]=r({schema:s,method:a,url:t,httpPart:"headers"});else if(s){const o={};Object.keys(s).forEach(e=>{o[e]=s[e]}),o.required instanceof Array&&(o.required=o.required.map(e=>e.toLowerCase())),s.properties&&(o.properties={},Object.keys(s.properties).forEach(e=>{o.properties[e.toLowerCase()]=s.properties[e]})),e[headersSchema]=r({schema:o,method:a,url:t,httpPart:"headers"})}e.schema.body&&(e[bodySchema]=r({schema:e.schema.body,method:a,url:t,httpPart:"body"})),e.schema.querystring&&(e[querystringSchema]=r({schema:e.schema.querystring,method:a,url:t,httpPart:"querystring"})),e.schema.params&&(e[paramsSchema]=r({schema:e.schema.params,method:a,url:t,httpPart:"params"}))}function validateParam(e,r,a){var t=e&&e(r[a]);return!1===t?e.errors:t&&t.error?t.error:(t&&t.value&&(r[a]=t.value),!1)}function validate(e,r){var a=validateParam(e[paramsSchema],r,"params");if(a)return wrapValidationError(a,"params",e.schemaErrorFormatter);var t=validateParam(e[bodySchema],r,"body");if(t)return wrapValidationError(t,"body",e.schemaErrorFormatter);var s=validateParam(e[querystringSchema],r,"query");if(s)return wrapValidationError(s,"querystring",e.schemaErrorFormatter);var o=validateParam(e[headersSchema],r,"headers");return o?wrapValidationError(o,"headers",e.schemaErrorFormatter):null}function wrapValidationError(e,r,a){if(e instanceof Error)return e;var t=a(e,r);return t.validation=e,t.validationContext=r,t}function serialize(e,r,a){var t=e[responseSchema];if(!t)return JSON.stringify(r);if(t[a])return t[a](r);var s=(a+"")[0]+"xx";return t[s]?t[s](r):JSON.stringify(r)}module.exports={symbols:{bodySchema:bodySchema,querystringSchema:querystringSchema,responseSchema:responseSchema,paramsSchema:paramsSchema,headersSchema:headersSchema},compileSchemasForValidation:compileSchemasForValidation,compileSchemasForSerialization:compileSchemasForSerialization,validate:validate,serialize:serialize};