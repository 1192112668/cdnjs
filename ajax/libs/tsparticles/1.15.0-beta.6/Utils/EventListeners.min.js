"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventListeners=void 0;var Enums_1=require("../Enums"),Constants_1=require("./Constants"),EventListeners=function(){function o(e){var t=this;this.container=e,this.canPush=!0,this.mouseMoveHandler=function(e){return t.mouseTouchMove(e)},this.touchStartHandler=function(e){return t.mouseTouchMove(e)},this.touchMoveHandler=function(e){return t.mouseTouchMove(e)},this.touchEndHandler=function(){return t.mouseTouchFinish()},this.mouseLeaveHandler=function(){return t.mouseTouchFinish()},this.touchCancelHandler=function(){return t.mouseTouchFinish()},this.touchEndClickHandler=function(e){return t.mouseTouchClick(e)},this.mouseUpHandler=function(e){return t.mouseTouchClick(e)},this.visibilityChangeHandler=function(){return t.handleVisibilityChange()},this.resizeHandler=function(){return t.handleWindowResize()}}return o.manageListener=function(e,t,n,i,s){var o;i?(o={passive:!0},"boolean"==typeof s?o.capture=s:void 0!==s&&(o=s),e.addEventListener(t,n,o)):e.removeEventListener(t,n,s)},o.prototype.addListeners=function(){this.manageListeners(!0)},o.prototype.removeListeners=function(){this.manageListeners(!1)},o.prototype.manageListeners=function(e){var t=this.container,n=t.options,i=n.interactivity.detectsOn;i===Enums_1.InteractivityDetect.window?t.interactivity.element=window:i===Enums_1.InteractivityDetect.parent&&t.canvas.element?t.interactivity.element=t.canvas.element.parentNode:t.interactivity.element=t.canvas.element;var s=t.interactivity.element;s&&(n.interactivity.events.onHover.enable||n.interactivity.events.onClick.enable)&&(o.manageListener(s,Constants_1.Constants.mouseMoveEvent,this.mouseMoveHandler,e),o.manageListener(s,Constants_1.Constants.touchStartEvent,this.touchStartHandler,e),o.manageListener(s,Constants_1.Constants.touchMoveEvent,this.touchMoveHandler,e),n.interactivity.events.onClick.enable||o.manageListener(s,Constants_1.Constants.touchEndEvent,this.touchEndHandler,e),o.manageListener(s,Constants_1.Constants.mouseLeaveEvent,this.mouseLeaveHandler,e),o.manageListener(s,Constants_1.Constants.touchCancelEvent,this.touchCancelHandler,e)),n.interactivity.events.onClick.enable&&s&&(o.manageListener(s,Constants_1.Constants.touchEndEvent,this.touchEndClickHandler,e),o.manageListener(s,Constants_1.Constants.mouseUpEvent,this.mouseUpHandler,e)),n.interactivity.events.resize&&o.manageListener(window,Constants_1.Constants.resizeEvent,this.resizeHandler,e),document&&o.manageListener(document,Constants_1.Constants.visibilityChangeEvent,this.visibilityChangeHandler,e,!1)},o.prototype.handleWindowResize=function(){var e=this.container,t=e.options,n=e.canvas.element;if(n){var i=e.retina.pixelRatio;for(var s in e.canvas.size.width=n.offsetWidth*i,e.canvas.size.height=n.offsetHeight*i,n.width=e.canvas.size.width,n.height=e.canvas.size.height,t.particles.move.enable||e.particles.redraw(),e.densityAutoParticles(),e.plugins){var o=e.plugins[s];void 0!==o.resize&&o.resize()}}},o.prototype.handleVisibilityChange=function(){var e=this.container;e.options.pauseOnBlur&&(null!==document&&void 0!==document&&document.hidden?(e.pageHidden=!0,e.pause()):(e.pageHidden=!1,e.getAnimationStatus()?e.play(!0):e.draw()))},o.prototype.mouseTouchMove=function(e){var t,n,i,s=this.container,o=s.options,a=s.canvas.element;if(e.type.startsWith("mouse")){this.canPush=!0;var r,c,u,l,v,h,d=e;if(void 0===(null===(t=s.interactivity)||void 0===t?void 0:t.element))return;s.interactivity.element===window?a&&(r=a.getBoundingClientRect(),c={x:d.clientX-r.left,y:d.clientY-r.top}):o.interactivity.detectsOn===Enums_1.InteractivityDetect.parent?(u=d.target,l=d.currentTarget,c=u&&l?(v=u.getBoundingClientRect(),h=l.getBoundingClientRect(),{x:d.offsetX+v.left-h.left,y:d.offsetY+v.top-h.top}):{x:d.offsetX||d.clientX,y:d.offsetY||d.clientY}):d.target===s.canvas.element&&(c={x:d.offsetX||d.clientX,y:d.offsetY||d.clientY})}else{this.canPush="touchmove"!==e.type;var m=e.touches[e.touches.length-1],p=null==a?void 0:a.getBoundingClientRect();c={x:m.clientX-(null!==(n=null==p?void 0:p.left)&&void 0!==n?n:0),y:m.clientY-(null!==(i=null==p?void 0:p.top)&&void 0!==i?i:0)}}var y=s.retina.pixelRatio;c&&(c.x*=y,c.y*=y),s.interactivity.mouse.position=c,s.interactivity.status=Constants_1.Constants.mouseMoveEvent},o.prototype.mouseTouchFinish=function(){var e=this.container;delete e.interactivity.mouse.position,e.interactivity.status=Constants_1.Constants.mouseLeaveEvent},o.prototype.mouseTouchClick=function(e){var t=this.container,n=t.options,i=!1,s=t.interactivity.mouse.position;if(void 0!==s&&n.interactivity.events.onClick.enable){for(var o in t.plugins){var a=t.plugins[o];if(void 0!==a.clickPositionValid&&(i=a.clickPositionValid(s)))break}i||this.doMouseTouchClick(e)}},o.prototype.doMouseTouchClick=function(e){var t=this,n=this.container,i=n.options;if(this.canPush){var s=n.interactivity.mouse.position;if(!s)return;if(n.interactivity.mouse.clickPosition={x:s.x,y:s.y},n.interactivity.mouse.clickTime=(new Date).getTime(),i.interactivity.events.onClick.mode instanceof Array)for(var o=0,a=i.interactivity.events.onClick.mode;o<a.length;o++){var r=a[o];this.handleClickMode(r)}else{r=i.interactivity.events.onClick.mode;this.handleClickMode(r)}}"touchend"===e.type&&setTimeout(function(){return t.mouseTouchFinish()},500)},o.prototype.handleClickMode=function(e){var t=this.container,n=t.options,i=n.interactivity.modes.push.quantity,s=n.interactivity.modes.remove.quantity;switch(e){case Enums_1.ClickMode.push:0<i&&(n.particles.move.enable||1===i?t.particles.push(i,t.interactivity.mouse):1<i&&t.particles.push(i));break;case Enums_1.ClickMode.remove:t.particles.removeQuantity(s);break;case Enums_1.ClickMode.bubble:t.bubble.clicking=!0;break;case Enums_1.ClickMode.repulse:t.repulse.clicking=!0;for(var o=t.repulse.count=0,a=t.repulse.particles;o<a.length;o++){var r=a[o];r.velocity.horizontal=r.initialVelocity.horizontal,r.velocity.vertical=r.initialVelocity.vertical}t.repulse.particles=[],t.repulse.finish=!1,setTimeout(function(){t.destroyed||(t.repulse.clicking=!1)},1e3*n.interactivity.modes.repulse.duration);break;case Enums_1.ClickMode.pause:t.getAnimationStatus()?t.pause():t.play()}for(var c in t.plugins){var u=t.plugins[c];u.handleClickMode&&u.handleClickMode(e)}},o}();exports.EventListeners=EventListeners;