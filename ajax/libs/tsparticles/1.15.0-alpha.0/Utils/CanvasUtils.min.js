"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CanvasUtils=void 0;var ColorUtils_1=require("./ColorUtils"),Utils_1=require("./Utils"),CanvasUtils=function(){function o(){}return o.paintBase=function(o,t,e){o.save(),o.fillStyle=null!=e?e:"rgba(0,0,0,0)",o.fillRect(0,0,t.width,t.height),o.restore()},o.clear=function(o,t){o.clearRect(0,0,t.width,t.height)},o.drawLinkedLine=function(o,t,e,l,i,r,s,a,n,h,d){o.beginPath();var y,g,c,f,C,U,v,x,u=Utils_1.Utils.getDistance(e,l);u<=i?(o.moveTo(e.x,e.y),o.lineTo(l.x,l.y)):s&&(y={x:l.x-r.width,y:l.y},(u=Utils_1.Utils.getDistance(e,y))<=i?(f=e.x-(l.x-r.width),C=e.y-l.y,U=e.y-C/f*e.x,o.moveTo(e.x,e.y),o.lineTo(0,U),o.moveTo(l.x,l.y),o.lineTo(r.width,U)):(g={x:l.x,y:l.y-r.height},(u=Utils_1.Utils.getDistance(e,g))<=i?(f=e.x-l.x,C=e.y-(l.y-r.height),v=-(U=e.y-C/f*e.x)/(C/f),o.moveTo(e.x,e.y),o.lineTo(v,0),o.moveTo(l.x,l.y),o.lineTo(v,r.height)):(c={x:l.x-r.width,y:l.y-r.height},(u=Utils_1.Utils.getDistance(e,c))<=i&&(f=e.x-(l.x-r.width),C=e.y-(l.y-r.height),v=-(U=e.y-C/f*e.x)/(C/f),o.moveTo(e.x,e.y),o.lineTo(v,U),o.moveTo(l.x,l.y),o.lineTo(v+r.width,U+r.height))))),o.closePath(),o.lineWidth=t,a&&(o.globalCompositeOperation="destination-out"),o.strokeStyle=ColorUtils_1.ColorUtils.getStyleFromRgb(n,h),!d.enable||(x="string"==typeof d.color?ColorUtils_1.ColorUtils.stringToRgb(d.color):ColorUtils_1.ColorUtils.colorToRgb(d.color))&&(o.shadowBlur=d.blur,o.shadowColor=ColorUtils_1.ColorUtils.getStyleFromRgb(x)),o.stroke()},o.drawConnectLine=function(o,t,e,l,i){o.save(),o.beginPath(),o.moveTo(l.x,l.y),o.lineTo(i.x,i.y),o.closePath(),o.lineWidth=t,o.strokeStyle=e,o.stroke(),o.restore()},o.gradient=function(o,t,e,l){var i=Math.floor(e.size.value/t.size.value);if(t.color&&e.color){var r=t.getPosition(),s=e.getPosition(),a=ColorUtils_1.ColorUtils.mix(t.color,e.color,t.size.value,e.size.value),n=o.createLinearGradient(r.x,r.y,s.x,s.y);return n.addColorStop(0,ColorUtils_1.ColorUtils.getStyleFromHsl(t.color,l)),n.addColorStop(1<i?1:i,ColorUtils_1.ColorUtils.getStyleFromRgb(a,l)),n.addColorStop(1,ColorUtils_1.ColorUtils.getStyleFromHsl(e.color,l)),n}},o.drawGrabLine=function(o,t,e,l,i,r){o.save(),o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(l.x,l.y),o.closePath(),o.strokeStyle=ColorUtils_1.ColorUtils.getStyleFromRgb(i,r),o.lineWidth=t,o.stroke(),o.restore()},o.drawParticle=function(o,t,e,l,i,r,s,a,n){var h=e.getPosition();t.save(),t.translate(h.x,h.y),t.beginPath(),0!==e.angle&&t.rotate(e.angle*Math.PI/180),r&&(t.globalCompositeOperation="destination-out");var d=e.shadowColor;n.enable&&d&&(t.shadowBlur=n.blur,t.shadowColor=ColorUtils_1.ColorUtils.getStyleFromRgb(d),t.shadowOffsetX=n.offset.x,t.shadowOffsetY=n.offset.y),t.fillStyle=i;var y=e.stroke;0<y.width&&e.strokeColor&&(t.strokeStyle=ColorUtils_1.ColorUtils.getStyleFromRgb(e.strokeColor,e.stroke.opacity),t.lineWidth=y.width),this.drawShape(o,t,e,s,a,l),e.close&&t.closePath(),0<y.width&&e.strokeColor&&t.stroke(),e.fill&&t.fill(),t.restore(),t.save(),t.translate(h.x,h.y),0!==e.angle&&t.rotate(e.angle*Math.PI/180),r&&(t.globalCompositeOperation="destination-out"),this.drawShapeAfterEffect(o,t,e,s,a,l),t.restore()},o.drawShape=function(o,t,e,l,i,r){var s;!e.shape||(s=o.drawers[e.shape])&&s.draw(t,e,l,i,r)},o.drawShapeAfterEffect=function(o,t,e,l,i,r){var s;!e.shape||(s=o.drawers[e.shape])&&void 0!==s.afterEffect&&s.afterEffect(t,e,l,i,r)},o.drawPlugin=function(o,t,e){o.save(),void 0!==t.draw&&t.draw(o,e),o.restore()},o}();exports.CanvasUtils=CanvasUtils;