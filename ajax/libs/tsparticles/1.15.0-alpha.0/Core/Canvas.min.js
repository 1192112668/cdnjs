"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Canvas=void 0;var Constants_1=require("../Utils/Constants"),CanvasUtils_1=require("../Utils/CanvasUtils"),ColorUtils_1=require("../Utils/ColorUtils"),Canvas=function(){function t(t){this.container=t,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}return t.prototype.init=function(){this.resize();var t=this.container.options,i=t.backgroundMask.cover.color,o=t.particles.move.trail;this.coverColor=ColorUtils_1.ColorUtils.colorToRgb(i),this.trailFillColor=ColorUtils_1.ColorUtils.colorToRgb(o.fillColor),this.paint()},t.prototype.loadCanvas=function(t,i){var o;t.className||(t.className=Constants_1.Constants.canvasClass),this.generatedCanvas&&null!==(o=this.element)&&void 0!==o&&o.remove(),this.generatedCanvas=null!=i&&i,this.element=t,this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()},t.prototype.destroy=function(){var t;this.generatedCanvas&&null!==(t=this.element)&&void 0!==t&&t.remove(),this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.resize=function(){this.element&&(this.element.width=this.size.width,this.element.height=this.size.height)},t.prototype.paint=function(){var t=this.container.options;this.context&&(t.backgroundMask.enable&&t.backgroundMask.cover&&this.coverColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromRgb(this.coverColor)):this.paintBase())},t.prototype.clear=function(){var t=this.container.options,i=t.particles.move.trail;t.backgroundMask.enable?this.paint():i.enable&&0<i.length&&this.trailFillColor?this.paintBase(ColorUtils_1.ColorUtils.getStyleFromRgb(this.trailFillColor,1/i.length)):this.context&&CanvasUtils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.isPointInPath=function(t,i){var o,e;return null!==(e=null===(o=this.context)||void 0===o?void 0:o.isPointInPath(t,i.x,i.y))&&void 0!==e&&e},t.prototype.drawLinkedLine=function(t,i){var o,e,n,s,l,a,r,c,d,h=this.container,v=h.options,p=i.destination,C=i.opacity,u=t.getPosition(),g=p.getPosition(),U=this.context;U&&((e=t.particlesOptions.twinkle.lines).enable&&(n=e.frequency,l=void 0!==(s="string"==typeof e.color?{value:e.color}:e.color)?ColorUtils_1.ColorUtils.colorToRgb(s):void 0,Math.random()<n&&void 0!==l&&(c=l,C=e.opacity)),c=c||(h.particles.lineLinkedColor===Constants_1.Constants.randomColorValue?ColorUtils_1.ColorUtils.getRandomRgbColor():"mid"==h.particles.lineLinkedColor&&t.color&&p.color?(a=t.color,r=p.color,ColorUtils_1.ColorUtils.mix(a,r,t.size.value,p.size.value)):h.particles.lineLinkedColor),d=null!==(o=t.lineLinkedWidth)&&void 0!==o?o:h.retina.lineLinkedWidth,CanvasUtils_1.CanvasUtils.drawLinkedLine(U,d,u,g,t.particlesOptions.lineLinked.distance,h.canvas.size,t.particlesOptions.lineLinked.warp,v.backgroundMask.enable,c,C,t.particlesOptions.lineLinked.shadow))},t.prototype.drawConnectLine=function(t,i){var o,e,n,s,l=this.lineStyle(t,i);!l||(e=this.context)&&(n=t.getPosition(),s=i.getPosition(),CanvasUtils_1.CanvasUtils.drawConnectLine(e,null!==(o=t.lineLinkedWidth)&&void 0!==o?o:this.container.retina.lineLinkedWidth,l,n,s))},t.prototype.drawGrabLine=function(t,i,o,e){var n,s,l=this.container,a=l.canvas.context;a&&(s=t.getPosition(),CanvasUtils_1.CanvasUtils.drawGrabLine(a,null!==(n=t.lineLinkedWidth)&&void 0!==n?n:l.retina.lineLinkedWidth,s,e,i,o))},t.prototype.drawParticle=function(t,i){var o,e,n;if(void 0!==t.color){var s=this.container.options,l=t.particlesOptions.twinkle.particles,a=l.frequency,r="string"==typeof l.color?{value:l.color}:l.color,c=void 0!==r?ColorUtils_1.ColorUtils.colorToRgb(r):void 0,d=l.enable&&Math.random()<a,h=null!==(o=t.bubble.radius)&&void 0!==o?o:t.size.value,v=d?l.opacity:null!==(e=t.bubble.opacity)&&void 0!==e?e:t.opacity.value,p=t.infectionStage,C=s.infection.stages,u=void 0!==p?C[p].color:void 0,g=u?ColorUtils_1.ColorUtils.colorToRgb(u):void 0,U=d&&void 0!==c?c:null!==(n=null!=g?g:t.bubble.color)&&void 0!==n?n:ColorUtils_1.ColorUtils.hslToRgb(t.color),b=void 0!==U?ColorUtils_1.ColorUtils.getStyleFromRgb(U,v):void 0;if(this.context&&b){CanvasUtils_1.CanvasUtils.drawParticle(this.container,this.context,t,i,b,s.backgroundMask.enable,h,v,t.particlesOptions.shadow),this.context.save();for(var k=0,y=t.links;k<y.length;k++){var f=y[k];this.drawLinkedLine(t,f)}this.context.restore()}}},t.prototype.drawPlugin=function(t,i){this.context&&CanvasUtils_1.CanvasUtils.drawPlugin(this.context,t,i)},t.prototype.paintBase=function(t){this.context&&CanvasUtils_1.CanvasUtils.paintBase(this.context,this.size,t)},t.prototype.lineStyle=function(t,i){var o=this.container.options.interactivity.modes.connect;if(t.color&&i.color&&this.context)return CanvasUtils_1.CanvasUtils.gradient(this.context,t,i,o.lineLinked.opacity)},t.prototype.initBackground=function(){var t,i,o=this.container.options.background,e=this.element;e&&(t=e.style,!o.color||(i=ColorUtils_1.ColorUtils.colorToRgb(o.color))&&(t.backgroundColor=ColorUtils_1.ColorUtils.getStyleFromRgb(i,o.opacity)),o.image&&(t.backgroundImage=o.image),o.position&&(t.backgroundPosition=o.position),o.repeat&&(t.backgroundRepeat=o.repeat),o.size&&(t.backgroundSize=o.size))},t}();exports.Canvas=Canvas;