"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Infecter=void 0;const Utils_1=require("../../../../Utils");class Infecter{static infect(e,t,i){var n,o;if(e.updateInfection(i),void 0===e.infectionStage)return;const a=t.options.infection;if(!a.enable||a.stages.length<1)return;const c=a.stages[e.infectionStage],f=t.retina.pixelRatio,s=2*e.size.value+c.radius*f,r=e.getPosition(),g=null!==(n=c.infectedStage)&&void 0!==n?n:e.infectionStage,l=t.particles.quadTree.query(new Utils_1.Circle(r.x,r.y,s)).filter(t=>void 0===t.infectionStage||t.infectionStage!==e.infectionStage),d=c.rate,S=l.length;for(const t of l)if(Math.random()<d/S)if(void 0===t.infectionStage)t.startInfection(g);else if(t.infectionStage<e.infectionStage)t.updateInfectionStage(g);else if(t.infectionStage>e.infectionStage){const i=a.stages[t.infectionStage],n=null!==(o=null==i?void 0:i.infectedStage)&&void 0!==o?o:t.infectionStage;e.updateInfectionStage(n)}}}exports.Infecter=Infecter;