"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;const Utils_1=require("../../../../Utils"),Enums_1=require("../../../../Enums");class Bubbler{static reset(e){e.bubble.inRange||(delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)}static bubble(e,t){const i=e.options.interactivity.events,s=i.onHover,b=i.onClick,o=s.enable,l=s.mode,u=b.enable,n=b.mode,r=i.onDiv;if(o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,l))this.hoverBubble(e);else if(u&&Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,n))this.clickBubble(e);else if(r instanceof Array)for(const t of r){const i=t.mode;t.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,i)&&this.divHover(e,t)}else{const t=r.mode;r.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,t)&&this.divHover(e,r)}}static divHover(e,t){const i=t.ids;if(i instanceof Array)for(const s of i)this.singleDivHover(e,s,t);else this.singleDivHover(e,i,t)}static singleDivHover(e,t,i){const s=document.getElementById(t);if(!s)return;const b=e.retina.pixelRatio,o={x:(s.offsetLeft+s.offsetWidth/2)*b,y:(s.offsetTop+s.offsetHeight/2)*b},l=s.offsetWidth/2*b,u=i.type===Enums_1.DivType.circle?new Utils_1.Circle(o.x,o.y,l):new Utils_1.Rectangle(s.offsetLeft*b,s.offsetTop*b,s.offsetWidth*b,s.offsetHeight*b),n=e.particles.quadTree.query(u);for(const t of n.filter(e=>u.contains(e.getPosition())))t.bubble.inRange=!0,this.hoverBubbleSize(e,t,1),this.hoverBubbleOpacity(e,t,1),this.hoverBubbleColor(e,t)}static process(e,t,i,s,b){const o=b.bubbleObj.optValue;if(void 0===o)return;const l=e.options.interactivity.modes.bubble.duration,u=e.retina.bubbleModeDistance,n=b.particlesObj.optValue,r=b.bubbleObj.value,a=b.particlesObj.value||0,c=b.type;if(o!==n)if(e.bubble.durationEnd)r&&(c===Enums_1.ProcessBubbleType.size&&delete t.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete t.bubble.opacity);else if(i<=u){if((null!=r?r:a)!==o){const e=a-s*(a-o)/l;c===Enums_1.ProcessBubbleType.size&&(t.bubble.radius=e),c===Enums_1.ProcessBubbleType.opacity&&(t.bubble.opacity=e)}}else c===Enums_1.ProcessBubbleType.size&&delete t.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete t.bubble.opacity}static clickBubble(e){var t;const i=e.options,s=e.interactivity.mouse.clickPosition;if(void 0===s)return;const b=e.retina.bubbleModeDistance,o=e.particles.quadTree.query(new Utils_1.Circle(s.x,s.y,b));for(const b of o){b.bubble.inRange=!0;const o=b.getPosition(),l=Utils_1.Utils.getDistance(o,s),u=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;if(e.bubble.clicking){u>i.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),u>2*i.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1);const s={bubbleObj:{optValue:e.retina.bubbleModeSize,value:b.bubble.radius},particlesObj:{optValue:null!==(t=b.sizeValue)&&void 0!==t?t:e.retina.sizeValue,value:b.size.value},type:Enums_1.ProcessBubbleType.size};this.process(e,b,l,u,s);const o={bubbleObj:{optValue:i.interactivity.modes.bubble.opacity,value:b.bubble.opacity},particlesObj:{optValue:b.particlesOptions.opacity.value,value:b.opacity.value},type:Enums_1.ProcessBubbleType.opacity};this.process(e,b,l,u,o),e.bubble.durationEnd?delete b.bubble.color:l<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,b):delete b.bubble.color}}}static hoverBubble(e){const t=e.interactivity.mouse.position;if(void 0===t)return;const i=e.retina.bubbleModeDistance,s=e.particles.quadTree.query(new Utils_1.Circle(t.x,t.y,i));for(const i of s){i.bubble.inRange=!0;const s=i.getPosition(),b=Utils_1.Utils.getDistance(s,t),o=1-b/e.retina.bubbleModeDistance;b<=e.retina.bubbleModeDistance?o>=0&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,i,o),this.hoverBubbleOpacity(e,i,o),this.hoverBubbleColor(e,i)):this.reset(i),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(i)}}static hoverBubbleSize(e,t,i){var s;const b=e.retina.bubbleModeSize;if(void 0===b)return;const o=null!==(s=t.sizeValue)&&void 0!==s?s:e.retina.sizeValue,l=t.size.value,u=this.calculateBubbleValue(l,b,o,i);void 0!==u&&(t.bubble.radius=u)}static hoverBubbleOpacity(e,t,i){const s=e.options.interactivity.modes.bubble.opacity;if(void 0===s)return;const b=t.particlesOptions.opacity.value,o=t.opacity.value,l=this.calculateBubbleValue(o,s,b,i);void 0!==l&&(t.bubble.opacity=l)}static calculateBubbleValue(e,t,i,s){if(t>i){const b=e+(t-i)*s;return Utils_1.Utils.clamp(b,e,t)}if(t<i){const b=e-(i-t)*s;return Utils_1.Utils.clamp(b,t,e)}}static hoverBubbleColor(e,t){const i=e.options;if(void 0===t.bubble.color){const e=i.interactivity.modes.bubble.color;if(void 0===e)return;const s=e instanceof Array?Utils_1.Utils.itemFromArray(e):e;t.bubble.color=Utils_1.ColorUtils.colorToHsl(s)}}}exports.Bubbler=Bubbler;