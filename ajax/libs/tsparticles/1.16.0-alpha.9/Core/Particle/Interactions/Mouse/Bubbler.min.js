"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;const Utils_1=require("../../../../Utils"),Enums_1=require("../../../../Enums");class Bubbler{constructor(e){this.container=e}static calculateBubbleValue(e,i,t,o){if(i>t){const s=e+(i-t)*o;return Utils_1.Utils.clamp(s,e,i)}if(i<t){const s=e-(t-i)*o;return Utils_1.Utils.clamp(s,i,e)}}isEnabled(){const e=this.container,i=e.options,t=e.interactivity.mouse,o=i.interactivity.events,s=o.onDiv,l=s instanceof Array?s.filter(e=>e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,e.mode)).length>0:Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,s.mode);if(!(l||o.onHover.enable&&t.position||o.onClick.enable&&t.clickPosition))return!1;const b=o.onHover.mode,n=o.onClick.mode;return Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,b)||Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,n)||l}reset(e){e.bubble.inRange||(delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)}interact(){const e=this.container.options.interactivity.events,i=e.onHover,t=e.onClick,o=i.enable,s=i.mode,l=t.enable,b=t.mode,n=e.onDiv;if(o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,s))this.hoverBubble();else if(l&&Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,b))this.clickBubble();else if(n instanceof Array)for(const e of n){const i=e.mode;e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,i)&&this.divHover(e)}else{const e=n.mode;n.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,e)&&this.divHover(n)}}divHover(e){const i=e.ids;if(i instanceof Array)for(const t of i)this.singleDivHover(t,e);else this.singleDivHover(i,e)}singleDivHover(e,i){const t=this.container,o=document.getElementById(e);if(!o)return;const s=t.retina.pixelRatio,l={x:(o.offsetLeft+o.offsetWidth/2)*s,y:(o.offsetTop+o.offsetHeight/2)*s},b=o.offsetWidth/2*s,n=i.type===Enums_1.DivType.circle?new Utils_1.Circle(l.x,l.y,b):new Utils_1.Rectangle(o.offsetLeft*s,o.offsetTop*s,o.offsetWidth*s,o.offsetHeight*s),r=t.particles.quadTree.query(n);for(const i of r.filter(e=>n.contains(e.getPosition()))){i.bubble.inRange=!0;const t=this.divBubbleMode(e);this.hoverBubbleSize(i,1,t),this.hoverBubbleOpacity(i,1,t),this.hoverBubbleColor(i,t)}}process(e,i,t,o){const s=this.container,l=o.bubbleObj.optValue;if(void 0===l)return;const b=s.options.interactivity.modes.bubble.duration,n=s.retina.bubbleModeDistance,r=o.particlesObj.optValue,u=o.bubbleObj.value,a=o.particlesObj.value||0,c=o.type;if(l!==r)if(s.bubble.durationEnd)u&&(c===Enums_1.ProcessBubbleType.size&&delete e.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete e.bubble.opacity);else if(i<=n){if((null!=u?u:a)!==l){const i=a-t*(a-l)/b;c===Enums_1.ProcessBubbleType.size&&(e.bubble.radius=i),c===Enums_1.ProcessBubbleType.opacity&&(e.bubble.opacity=i)}}else c===Enums_1.ProcessBubbleType.size&&delete e.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete e.bubble.opacity}clickBubble(){var e;const i=this.container,t=i.options,o=i.interactivity.mouse.clickPosition;if(void 0===o)return;const s=i.retina.bubbleModeDistance,l=i.particles.quadTree.query(new Utils_1.Circle(o.x,o.y,s));for(const s of l){s.bubble.inRange=!0;const l=s.getPosition(),b=Utils_1.Utils.getDistance(l,o),n=((new Date).getTime()-(i.interactivity.mouse.clickTime||0))/1e3;if(i.bubble.clicking){n>t.interactivity.modes.bubble.duration&&(i.bubble.durationEnd=!0),n>2*t.interactivity.modes.bubble.duration&&(i.bubble.clicking=!1,i.bubble.durationEnd=!1);const o={bubbleObj:{optValue:i.retina.bubbleModeSize,value:s.bubble.radius},particlesObj:{optValue:null!==(e=s.sizeValue)&&void 0!==e?e:i.retina.sizeValue,value:s.size.value},type:Enums_1.ProcessBubbleType.size};this.process(s,b,n,o);const l={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:s.bubble.opacity},particlesObj:{optValue:s.particlesOptions.opacity.value,value:s.opacity.value},type:Enums_1.ProcessBubbleType.opacity};this.process(s,b,n,l),i.bubble.durationEnd?delete s.bubble.color:b<=i.retina.bubbleModeDistance?this.hoverBubbleColor(s):delete s.bubble.color}}}hoverBubble(){const e=this.container,i=e.interactivity.mouse.position;if(void 0===i)return;const t=e.retina.bubbleModeDistance,o=e.particles.quadTree.query(new Utils_1.Circle(i.x,i.y,t));for(const t of o){t.bubble.inRange=!0;const o=t.getPosition(),s=Utils_1.Utils.getDistance(o,i),l=1-s/e.retina.bubbleModeDistance;s<=e.retina.bubbleModeDistance?l>=0&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(t,l),this.hoverBubbleOpacity(t,l),this.hoverBubbleColor(t)):this.reset(t),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(t)}}hoverBubbleSize(e,i,t){var o;const s=this.container,l=(null==t?void 0:t.size)?t.size*s.retina.pixelRatio:s.retina.bubbleModeSize;if(void 0===l)return;const b=null!==(o=e.sizeValue)&&void 0!==o?o:s.retina.sizeValue,n=e.size.value,r=Bubbler.calculateBubbleValue(n,l,b,i);void 0!==r&&(e.bubble.radius=r)}hoverBubbleOpacity(e,i,t){var o;const s=this.container.options,l=null!==(o=null==t?void 0:t.opacity)&&void 0!==o?o:s.interactivity.modes.bubble.opacity;if(void 0===l)return;const b=e.particlesOptions.opacity.value,n=e.opacity.value,r=Bubbler.calculateBubbleValue(n,l,b,i);void 0!==r&&(e.bubble.opacity=r)}hoverBubbleColor(e,i){var t;const o=this.container.options;if(void 0===e.bubble.color){const s=null!==(t=null==i?void 0:i.color)&&void 0!==t?t:o.interactivity.modes.bubble.color;if(void 0===s)return;const l=s instanceof Array?Utils_1.Utils.itemFromArray(s):s;e.bubble.color=Utils_1.ColorUtils.colorToHsl(l)}}divBubbleMode(e){if(!e)return;const i=this.container.options.interactivity.modes.bubble.divs;return i?i instanceof Array?i.find(i=>i.ids.includes(e)):i.ids.includes(e)?i:void 0:void 0}}exports.Bubbler=Bubbler;