"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;const Enums_1=require("../../../../Enums"),Utils_1=require("../../../../Utils");class Repulser{constructor(e){this.container=e}isEnabled(){const e=this.container,i=e.options,s=e.interactivity.mouse,t=i.interactivity.events,o=t.onDiv,n=o instanceof Array?o.filter(e=>e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,e.mode)).length>0:Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,o.mode);if(!(n||t.onHover.enable&&s.position||t.onClick.enable&&s.clickPosition))return!1;const l=t.onHover.mode,r=t.onClick.mode;return Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,l)||Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,r)||n}reset(){}interact(){const e=this.container,i=e.options,s=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,t=i.interactivity.events,o=t.onHover.enable,n=t.onHover.mode,l=t.onClick.enable,r=t.onClick.mode,c=t.onDiv;if(s&&o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,n))this.hoverRepulse();else if(l&&Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,r))this.clickRepulse();else if(c instanceof Array)for(const e of c){const i=e.mode;e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,i)&&this.divRepulse(e)}else{const e=c.mode;c.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,e)&&this.divRepulse(c)}}divRepulse(e){const i=e.ids;if(i instanceof Array)for(const s of i)this.singleDivRepulse(s,e);else this.singleDivRepulse(i,e)}singleDivRepulse(e,i){const s=this.container,t=document.getElementById(e);if(!t)return;const o=s.retina.pixelRatio,n={x:(t.offsetLeft+t.offsetWidth/2)*o,y:(t.offsetTop+t.offsetHeight/2)*o},l=t.offsetWidth/2*o,r=i.type===Enums_1.DivType.circle?new Utils_1.Circle(n.x,n.y,l):new Utils_1.Rectangle(t.offsetLeft*o,t.offsetTop*o,t.offsetWidth*o,t.offsetHeight*o);this.processRepulse(n,l,r,this.divRepulseMode(e))}hoverRepulse(){const e=this.container,i=e.interactivity.mouse.position;if(!i)return;const s=e.retina.repulseModeDistance;this.processRepulse(i,s,new Utils_1.Circle(i.x,i.y,s))}processRepulse(e,i,s,t){var o;const n=this.container,l=n.particles.quadTree.query(s);for(const s of l){const{dx:l,dy:r,distance:c}=Utils_1.Utils.getDistances(s.position,e),u={x:l/c,y:r/c},a=100*(null!==(o=null==t?void 0:t.speed)&&void 0!==o?o:n.options.interactivity.modes.repulse.speed),p=Utils_1.Utils.clamp((1-Math.pow(c/i,2))*a,0,50),d=s.particlesOptions.move.outMode,v=s.size.value,y={x:s.position.x+u.x*p,y:s.position.y+u.y*p};if(d===Enums_1.OutMode.bounce||d===Enums_1.OutMode.bounceVertical||d===Enums_1.OutMode.bounceHorizontal){const e={horizontal:y.x-v>0&&y.x+v<n.canvas.size.width,vertical:y.y-v>0&&y.y+v<n.canvas.size.height};(d===Enums_1.OutMode.bounceVertical||e.horizontal)&&(s.position.x=y.x),(d===Enums_1.OutMode.bounceHorizontal||e.vertical)&&(s.position.y=y.y)}else s.position.x=y.x,s.position.y=y.y}}clickRepulse(){const e=this.container;if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){const i=e.retina.repulseModeDistance,s=Math.pow(i/6,3),t=e.interactivity.mouse.clickPosition;if(void 0===t)return;const o=new Utils_1.Circle(t.x,t.y,s),n=e.particles.quadTree.query(o);for(const i of n){const{dx:o,dy:n,distance:l}=Utils_1.Utils.getDistances(t,i.position),r=l*l,c=e.options.interactivity.modes.repulse.speed,u=-s*c/r;r<=s&&(e.repulse.particles.push(i),this.processClickRepulse(i,o,n,u))}}else if(!1===e.repulse.clicking){for(const i of e.repulse.particles)i.velocity.horizontal=i.initialVelocity.horizontal,i.velocity.vertical=i.initialVelocity.vertical;e.repulse.particles=[]}}processClickRepulse(e,i,s,t){const o=this.container,n=o.options,l=Math.atan2(s,i);e.velocity.horizontal=t*Math.cos(l),e.velocity.vertical=t*Math.sin(l);const r=n.particles.move.outMode;if(r===Enums_1.OutMode.bounce||r===Enums_1.OutMode.bounceHorizontal||r===Enums_1.OutMode.bounceVertical){const i={x:e.position.x+e.velocity.horizontal,y:e.position.y+e.velocity.vertical};r!==Enums_1.OutMode.bounceVertical&&(i.x+e.size.value>o.canvas.size.width||i.x-e.size.value<0)&&(e.velocity.horizontal*=-1),r!==Enums_1.OutMode.bounceHorizontal&&(i.y+e.size.value>o.canvas.size.height||i.y-e.size.value<0)&&(e.velocity.vertical*=-1)}}divRepulseMode(e){if(!e)return;const i=this.container.options.interactivity.modes.repulse.divs;return i?i instanceof Array?i.find(i=>i.ids.includes(e)):i.ids.includes(e)?i:void 0:void 0}}exports.Repulser=Repulser;