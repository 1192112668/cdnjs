"use strict";var __awaiter=this&&this.__awaiter||function(t,a,o,h){return new(o=o||Promise)(function(i,e){function s(t){try{r(h.next(t))}catch(t){e(t)}}function n(t){try{r(h.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(s,n)}r((h=h.apply(t,a||[])).next())})},__generator=this&&this.__generator||function(i,s){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&e[0]?r.return:e[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,e[1])).done)return a;switch(r=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,r=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){o.label=e[1];break}if(6===e[0]&&o.label<a[1]){o.label=a[1],a=e;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(e);break}a[2]&&o.ops.pop(),o.trys.pop();continue}e=s.call(i,o)}catch(t){e=[6,t],r=0}finally{n=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Container=void 0;var Canvas_1=require("./Canvas"),Particles_1=require("./Particles"),Retina_1=require("./Retina"),FrameManager_1=require("./FrameManager"),Options_1=require("../Options/Classes/Options"),Utils_1=require("../Utils"),Container=function(){function i(t,e){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];this.started=!1,this.destroyed=!1,this.id=t,this.paused=!0,this.sourceOptions=e,this.lastFrameTime=0,this.pageHidden=!1,this.retina=new Retina_1.Retina(this),this.canvas=new Canvas_1.Canvas(this),this.particles=new Particles_1.Particles(this),this.drawer=new FrameManager_1.FrameManager(this),this.interactivity={mouse:{}},this.bubble={},this.repulse={particles:[]},this.plugins={},this.drawers={},this.density=1,this.options=new Options_1.Options;for(var n=0,r=i;n<r.length;n++){var a=r[n];this.options.load(Utils_1.Plugins.getPreset(a))}for(var o=0,h=Utils_1.Plugins.getSupportedShapes();o<h.length;o++){var l=h[o];this.drawers[l]=Utils_1.Plugins.getShapeDrawer(l)}this.sourceOptions&&this.options.load(this.sourceOptions),this.simplex=new Utils_1.SimplexNoise,this.eventListeners=new Utils_1.EventListeners(this)}return i.requestFrame=function(t){return window.customRequestAnimationFrame(t)},i.cancelAnimation=function(t){window.cancelAnimationFrame(t)},i.prototype.play=function(t){var e=this.paused||t;if(this.paused&&(this.paused=!1),e){for(var i in this.plugins){var s=this.plugins[i];s.play&&s.play()}this.lastFrameTime=performance.now()}this.draw()},i.prototype.pause=function(){if(void 0!==this.drawAnimationFrame&&(i.cancelAnimation(this.drawAnimationFrame),delete this.drawAnimationFrame),!this.paused){for(var t in this.plugins){var e=this.plugins[t];e.pause&&e.pause()}this.pageHidden||(this.paused=!0)}},i.prototype.draw=function(){var e=this;this.drawAnimationFrame=i.requestFrame(function(t){return e.drawer.nextFrame(t)})},i.prototype.getAnimationStatus=function(){return!this.paused},i.prototype.densityAutoParticles=function(){this.initDensityFactor();var t=this.options.particles.number,e=t.value,i=0<t.limit?t.limit:e,s=Math.min(e,i)*this.density,n=this.particles.count;n<s?this.particles.push(Math.abs(s-n)):s<n&&this.particles.removeQuantity(n-s)},i.prototype.initDensityFactor=function(){var t,e,i=this.options.particles.number.density;this.canvas.element&&i.enable&&(t=this.canvas.element,e=this.retina.pixelRatio,this.density=t.width*t.height/(i.factor*e*i.area))},i.prototype.destroy=function(){for(var t in this.stop(),this.retina.reset(),this.canvas.destroy(),delete this.interactivity,delete this.options,delete this.retina,delete this.canvas,delete this.particles,delete this.bubble,delete this.repulse,delete this.drawer,delete this.eventListeners,this.drawers){var e=this.drawers[t];void 0!==e.destroy&&e.destroy(this)}this.drawers={},this.destroyed=!0},i.prototype.exportImg=function(t){this.exportImage(t)},i.prototype.exportImage=function(t,e,i){var s;return null===(s=this.canvas.element)||void 0===s?void 0:s.toBlob(t,null!=e?e:"image/png",i)},i.prototype.exportConfiguration=function(){return JSON.stringify(this.options,void 0,2)},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.stop(),[4,this.start()];case 1:return t.sent(),[2]}})})},i.prototype.stop=function(){if(this.started){for(var t in this.started=!1,this.eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.retina.reset(),this.canvas.clear(),this.plugins){var e=this.plugins[t];void 0!==e.stop&&e.stop()}this.plugins={},this.particles.linksColors={},delete this.particles.linksColor}},i.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){var e,i,s,n,r;return __generator(this,function(t){switch(t.label){case 0:return this.started?[2]:[4,this.init()];case 1:for(i in t.sent(),this.started=!0,this.eventListeners.addListeners(),e=[],this.plugins)e.push(i);s=0,t.label=2;case 2:return s<e.length?(n=e[s],void 0===(r=this.plugins[n]).startAsync?[3,4]:[4,r.startAsync()]):[3,6];case 3:return t.sent(),[3,5];case 4:void 0!==r.start&&r.start(),t.label=5;case 5:return s++,[3,2];case 6:return this.play(),[2]}})})},i.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,i,s,n,r,a,o,h,l,u,c;return __generator(this,function(t){switch(t.label){case 0:for(u in this.retina.init(),this.canvas.init(),e=Utils_1.Plugins.getAvailablePlugins(this))this.plugins[u]=e[u];for(s in i=[],this.drawers)i.push(s);n=0,t.label=1;case 1:return n<i.length?(r=i[n],void 0===(a=this.drawers[r]).init?[3,3]:[4,a.init(this)]):[3,4];case 2:t.sent(),t.label=3;case 3:return n++,[3,1];case 4:for(h in o=[],this.plugins)o.push(h);l=0,t.label=5;case 5:return l<o.length?(u=o[l],void 0===(c=this.plugins[u]).init?[3,6]:(c.init(this.sourceOptions),[3,8])):[3,9];case 6:return void 0===c.initAsync?[3,8]:[4,c.initAsync(this.sourceOptions)];case 7:t.sent(),t.label=8;case 8:return l++,[3,5];case 9:return this.particles.init(),this.densityAutoParticles(),[2]}})})},i}();exports.Container=Container;