"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;var ClickMode_1=require("../../../../Enums/Modes/ClickMode"),HoverMode_1=require("../../../../Enums/Modes/HoverMode"),OutMode_1=require("../../../../Enums/OutMode"),Utils_1=require("../../../../Utils"),DivMode_1=require("../../../../Enums/Modes/DivMode"),Repulser=function(){function e(){}return e.repulse=function(e,i){var t=e.options.interactivity,o=t.events.onHover.enable,s=t.events.onClick.enable,n=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,l=t.events.onHover.mode,r=t.events.onClick.mode,u=t.events.onDiv.mode;n&&o&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,l)?this.hoverRepulse(e):s&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,r)?this.clickRepulse(e):t.events.onDiv.enable&&Utils_1.Utils.isInArray(DivMode_1.DivMode.repulse,u)&&this.divRepulse(e)},e.divRepulse=function(e){var i,t,o,s=e.options,n=document.getElementById(s.interactivity.events.onDiv.elementId);n&&(i=e.retina.pixelRatio,t={x:(n.offsetLeft+n.offsetWidth/2)*i,y:(n.offsetTop+n.offsetHeight/2)*i},o=n.offsetWidth/2*i,this.processRepulse(e,t,o))},e.hoverRepulse=function(e){var i,t=e.interactivity.mouse.position;t&&(i=e.retina.repulseModeDistance,this.processRepulse(e,t,i))},e.processRepulse=function(e,i,t){for(var o=0,s=e.particles.quadTree.query(new Utils_1.Circle(i.x,i.y,t));o<s.length;o++){var n,l,r=s[o],u=Utils_1.Utils.getDistances(r.position,i),c=u.dx,a=u.dy,p=u.distance,v=c/p,d=a/p,M=100*e.options.interactivity.modes.repulse.speed,y=Utils_1.Utils.clamp((1-Math.pow(p/t,2))*M,0,50),h=r.particlesOptions.move.outMode,_=r.size.value,f={x:r.position.x+v*y,y:r.position.y+d*y};h===OutMode_1.OutMode.bounce||h===OutMode_1.OutMode.bounceVertical||h===OutMode_1.OutMode.bounceHorizontal?(n=0<f.x-_&&f.x+_<e.canvas.size.width,l=0<f.y-_&&f.y+_<e.canvas.size.height,h!==OutMode_1.OutMode.bounceVertical&&!n||(r.position.x=f.x),h!==OutMode_1.OutMode.bounceHorizontal&&!l||(r.position.y=f.y)):(r.position.x=f.x,r.position.y=f.y)}},e.clickRepulse=function(e){if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){var i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),o=e.interactivity.mouse.clickPosition;if(void 0===o)return;for(var s=new Utils_1.Circle(o.x,o.y,t),n=0,l=e.particles.quadTree.query(s);n<l.length;n++){var r=l[n],u=Utils_1.Utils.getDistances(o,r.position),c=u.dx,a=u.dy,p=u.distance,v=p*p,d=-t*e.options.interactivity.modes.repulse.speed/v;v<=t&&(e.repulse.particles.push(r),this.processClickRepulse(e,r,c,a,d))}}else if(!1===e.repulse.clicking){for(var M=0,y=e.repulse.particles;M<y.length;M++){(r=y[M]).velocity.horizontal=r.initialVelocity.horizontal,r.velocity.vertical=r.initialVelocity.vertical}e.repulse.particles=[]}},e.processClickRepulse=function(e,i,t,o,s){var n=e.options,l=Math.atan2(o,t);i.velocity.horizontal=s*Math.cos(l),i.velocity.vertical=s*Math.sin(l);var r,u,c=n.particles.move.outMode;c!==OutMode_1.OutMode.bounce&&c!==OutMode_1.OutMode.bounceHorizontal&&c!==OutMode_1.OutMode.bounceVertical||(r=i.position.x+i.velocity.horizontal,u=i.position.y+i.velocity.vertical,c!==OutMode_1.OutMode.bounceVertical&&(r+i.size.value>e.canvas.size.width||r-i.size.value<0)&&(i.velocity.horizontal*=-1),c!==OutMode_1.OutMode.bounceHorizontal&&(u+i.size.value>e.canvas.size.height||u-i.size.value<0)&&(i.velocity.vertical*=-1))},e}();exports.Repulser=Repulser;