"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventListeners=void 0;var ClickMode_1=require("../Enums/Modes/ClickMode"),InteractivityDetect_1=require("../Enums/InteractivityDetect"),Constants_1=require("./Constants"),EventListeners=function(){function s(e){var t=this;this.container=e,this.canPush=!0,this.mouseMoveHandler=function(e){return t.mouseTouchMove(e)},this.touchStartHandler=function(e){return t.mouseTouchMove(e)},this.touchMoveHandler=function(e){return t.mouseTouchMove(e)},this.touchEndHandler=function(){return t.mouseTouchFinish()},this.mouseLeaveHandler=function(){return t.mouseTouchFinish()},this.touchCancelHandler=function(){return t.mouseTouchFinish()},this.touchEndClickHandler=function(e){return t.mouseTouchClick(e)},this.mouseUpHandler=function(e){return t.mouseTouchClick(e)},this.visibilityChangeHandler=function(){return t.handleVisibilityChange()},this.resizeHandler=function(){return t.handleWindowResize()}}return s.manageListener=function(e,t,n,i,o){var s;i?(s={passive:!0},"boolean"==typeof o?s.capture=o:void 0!==o&&(s=o),e.addEventListener(t,n,s)):e.removeEventListener(t,n,o)},s.prototype.addListeners=function(){this.manageListeners(!0)},s.prototype.removeListeners=function(){this.manageListeners(!1)},s.prototype.manageListeners=function(e){var t=this.container,n=t.options,i=n.interactivity.detectsOn;i===InteractivityDetect_1.InteractivityDetect.window?t.interactivity.element=window:i===InteractivityDetect_1.InteractivityDetect.parent&&t.canvas.element?t.interactivity.element=t.canvas.element.parentNode:t.interactivity.element=t.canvas.element;var o=t.interactivity.element;o&&(n.interactivity.events.onHover.enable||n.interactivity.events.onClick.enable)&&(s.manageListener(o,Constants_1.Constants.mouseMoveEvent,this.mouseMoveHandler,e),s.manageListener(o,Constants_1.Constants.touchStartEvent,this.touchStartHandler,e),s.manageListener(o,Constants_1.Constants.touchMoveEvent,this.touchMoveHandler,e),n.interactivity.events.onClick.enable||s.manageListener(o,Constants_1.Constants.touchEndEvent,this.touchEndHandler,e),s.manageListener(o,Constants_1.Constants.mouseLeaveEvent,this.mouseLeaveHandler,e),s.manageListener(o,Constants_1.Constants.touchCancelEvent,this.touchCancelHandler,e)),n.interactivity.events.onClick.enable&&o&&(s.manageListener(o,Constants_1.Constants.touchEndEvent,this.touchEndClickHandler,e),s.manageListener(o,Constants_1.Constants.mouseUpEvent,this.mouseUpHandler,e)),n.interactivity.events.resize&&s.manageListener(window,Constants_1.Constants.resizeEvent,this.resizeHandler,e),document&&s.manageListener(document,Constants_1.Constants.visibilityChangeEvent,this.visibilityChangeHandler,e,!1)},s.prototype.handleWindowResize=function(){var e=this.container,t=e.options,n=e.canvas.element;if(n){var i=e.retina.pixelRatio;for(var o in e.canvas.size.width=n.offsetWidth*i,e.canvas.size.height=n.offsetHeight*i,n.width=e.canvas.size.width,n.height=e.canvas.size.height,t.particles.move.enable||e.particles.redraw(),e.densityAutoParticles(),e.plugins){var s=e.plugins[o];void 0!==s.resize&&s.resize()}}},s.prototype.handleVisibilityChange=function(){var e=this.container;e.options.pauseOnBlur&&(null!==document&&void 0!==document&&document.hidden?(e.pageHidden=!0,e.pause()):(e.pageHidden=!1,e.getAnimationStatus()?e.play(!0):e.draw()))},s.prototype.mouseTouchMove=function(e){var t,n,i,o=this.container,s=o.options,a=o.canvas.element;if(e.type.startsWith("mouse")){this.canPush=!0;var r,c,l,u,v,h,d=e;if(void 0===(null===(t=o.interactivity)||void 0===t?void 0:t.element))return;o.interactivity.element===window?a&&(r=a.getBoundingClientRect(),c={x:d.clientX-r.left,y:d.clientY-r.top}):s.interactivity.detectsOn===InteractivityDetect_1.InteractivityDetect.parent?(l=d.target,u=d.currentTarget,c=l&&u?(v=l.getBoundingClientRect(),h=u.getBoundingClientRect(),{x:d.offsetX+v.left-h.left,y:d.offsetY+v.top-h.top}):{x:d.offsetX||d.clientX,y:d.offsetY||d.clientY}):d.target===o.canvas.element&&(c={x:d.offsetX||d.clientX,y:d.offsetY||d.clientY})}else{this.canPush="touchmove"!==e.type;var p=e.touches[e.touches.length-1],m=null==a?void 0:a.getBoundingClientRect();c={x:p.clientX-(null!==(n=null==m?void 0:m.left)&&void 0!==n?n:0),y:p.clientY-(null!==(i=null==m?void 0:m.top)&&void 0!==i?i:0)}}var y=o.retina.pixelRatio;c&&(c.x*=y,c.y*=y),o.interactivity.mouse.position=c,o.interactivity.status=Constants_1.Constants.mouseMoveEvent},s.prototype.mouseTouchFinish=function(){var e=this.container;delete e.interactivity.mouse.position,e.interactivity.status=Constants_1.Constants.mouseLeaveEvent},s.prototype.mouseTouchClick=function(e){var t=this.container,n=t.options,i=!1,o=t.interactivity.mouse.position;if(void 0!==o&&n.interactivity.events.onClick.enable){for(var s in t.plugins){var a=t.plugins[s];if(void 0!==a.clickPositionValid&&(i=a.clickPositionValid(o)))break}i||this.doMouseTouchClick(e)}},s.prototype.doMouseTouchClick=function(e){var t=this,n=this.container,i=n.options;if(this.canPush){var o=n.interactivity.mouse.position;if(!o)return;if(n.interactivity.mouse.clickPosition={x:o.x,y:o.y},n.interactivity.mouse.clickTime=(new Date).getTime(),i.interactivity.events.onClick.mode instanceof Array)for(var s=0,a=i.interactivity.events.onClick.mode;s<a.length;s++){var r=a[s];this.handleClickMode(r)}else{r=i.interactivity.events.onClick.mode;this.handleClickMode(r)}}"touchend"===e.type&&setTimeout(function(){return t.mouseTouchFinish()},500)},s.prototype.handleClickMode=function(e){var t=this.container,n=t.options,i=n.interactivity.modes.push.quantity,o=n.interactivity.modes.remove.quantity;switch(e){case ClickMode_1.ClickMode.push:0<i&&(n.particles.move.enable||1===i?t.particles.push(i,t.interactivity.mouse):1<i&&t.particles.push(i));break;case ClickMode_1.ClickMode.remove:t.particles.removeQuantity(o);break;case ClickMode_1.ClickMode.bubble:t.bubble.clicking=!0;break;case ClickMode_1.ClickMode.repulse:t.repulse.clicking=!0;for(var s=t.repulse.count=0,a=t.repulse.particles;s<a.length;s++){var r=a[s];r.velocity.horizontal=r.initialVelocity.horizontal,r.velocity.vertical=r.initialVelocity.vertical}t.repulse.particles=[],t.repulse.finish=!1,setTimeout(function(){t.destroyed||(t.repulse.clicking=!1)},1e3*n.interactivity.modes.repulse.duration);break;case ClickMode_1.ClickMode.pause:t.getAnimationStatus()?t.pause():t.play()}for(var c in t.plugins){var l=t.plugins[c];l.handleClickMode&&l.handleClickMode(e)}},s}();exports.EventListeners=EventListeners;