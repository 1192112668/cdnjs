"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Canvas=void 0;const Utils_1=require("../Utils");class Canvas{constructor(t){this.container=t,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}init(){this.resize();const t=this.container.options,i=t.backgroundMask.cover.color,o=t.particles.move.trail;this.coverColor=Utils_1.ColorUtils.colorToRgb(i),this.trailFillColor=Utils_1.ColorUtils.colorToRgb(o.fillColor),this.initBackground(),this.paint()}loadCanvas(t,i){var o;t.className||(t.className=Utils_1.Constants.canvasClass),this.generatedCanvas&&(null===(o=this.element)||void 0===o||o.remove()),this.generatedCanvas=null!=i&&i,this.element=t,this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()}destroy(){var t;this.generatedCanvas&&(null===(t=this.element)||void 0===t||t.remove()),this.context&&Utils_1.CanvasUtils.clear(this.context,this.size)}resize(){this.element&&(this.element.width=this.size.width,this.element.height=this.size.height)}paint(){const t=this.container.options;this.context&&(t.backgroundMask.enable&&t.backgroundMask.cover&&this.coverColor?this.paintBase(Utils_1.ColorUtils.getStyleFromRgb(this.coverColor)):this.paintBase())}clear(){const t=this.container.options,i=t.particles.move.trail;t.backgroundMask.enable?this.paint():i.enable&&i.length>0&&this.trailFillColor?this.paintBase(Utils_1.ColorUtils.getStyleFromRgb(this.trailFillColor,1/i.length)):this.context&&Utils_1.CanvasUtils.clear(this.context,this.size)}drawLinkTriangle(t,i,o){var s,n;const e=this.container,l=e.options,a=i.destination,r=o.destination,c=t.particlesOptions.links.triangles,d=null!==(s=c.opacity)&&void 0!==s?s:(i.opacity+o.opacity)/2,h=t.getPosition(),g=a.getPosition(),v=r.getPosition(),C=this.context;if(!C)return;let u=Utils_1.ColorUtils.colorToRgb(c.color);if(!u){const i=t.particlesOptions.links,o=void 0!==i.id?e.particles.linksColors.get(i.id):e.particles.linksColor;if(o===Utils_1.Constants.randomColorValue)u=Utils_1.ColorUtils.getRandomRgbColor();else if("mid"===o){const i=t.getFillColor(),o=a.getFillColor();if(i&&o)u=Utils_1.ColorUtils.mix(i,o,t.size.value,a.size.value);else{const t=null!=i?i:o;if(!t)return;u=Utils_1.ColorUtils.hslToRgb(t)}}else u=o}const p=null!==(n=t.linksWidth)&&void 0!==n?n:e.retina.linksWidth;Utils_1.CanvasUtils.drawLinkTriangle(C,p,h,g,v,l.backgroundMask.enable,u,d)}drawLinkLine(t,i){var o;const s=this.container,n=s.options,e=i.destination;let l=i.opacity;const a=t.getPosition(),r=e.getPosition(),c=this.context;if(!c)return;let d;const h=t.particlesOptions.twinkle.lines;if(h.enable){const t=h.frequency,i=Utils_1.ColorUtils.colorToRgb(h.color);Math.random()<t&&void 0!==i&&(d=i,l=h.opacity)}if(!d){const i=t.particlesOptions.links,o=void 0!==i.id?s.particles.linksColors.get(i.id):s.particles.linksColor;if(o===Utils_1.Constants.randomColorValue)d=Utils_1.ColorUtils.getRandomRgbColor();else if("mid"===o){const i=t.getFillColor(),o=e.getFillColor();if(i&&o)d=Utils_1.ColorUtils.mix(i,o,t.size.value,e.size.value);else{const t=null!=i?i:o;if(!t)return;d=Utils_1.ColorUtils.hslToRgb(t)}}else d=o}const g=null!==(o=t.linksWidth)&&void 0!==o?o:s.retina.linksWidth;Utils_1.CanvasUtils.drawLinkLine(c,g,a,r,t.particlesOptions.links.distance,s.canvas.size,t.particlesOptions.links.warp,n.backgroundMask.enable,d,l,t.particlesOptions.links.shadow)}drawConnectLine(t,i){var o;const s=this.lineStyle(t,i);if(!s)return;const n=this.context;if(!n)return;const e=t.getPosition(),l=i.getPosition();Utils_1.CanvasUtils.drawConnectLine(n,null!==(o=t.linksWidth)&&void 0!==o?o:this.container.retina.linksWidth,s,e,l)}drawGrabLine(t,i,o,s){var n;const e=this.container,l=e.canvas.context;if(!l)return;const a=t.getPosition();Utils_1.CanvasUtils.drawGrabLine(l,null!==(n=t.linksWidth)&&void 0!==n?n:e.retina.linksWidth,a,s,i,o)}drawParticle(t,i){var o,s,n,e,l;if(!1===(null===(o=t.image)||void 0===o?void 0:o.loaded))return;const a=t.getFillColor();if(void 0===a)return;const r=null!==(s=t.getStrokeColor())&&void 0!==s?s:a,c=this.container.options,d=t.particlesOptions.twinkle.particles,h=d.frequency,g=Utils_1.ColorUtils.colorToRgb(d.color),v=d.enable&&Math.random()<h,C=null!==(n=t.bubble.radius)&&void 0!==n?n:t.size.value,u=v?d.opacity:null!==(e=t.bubble.opacity)&&void 0!==e?e:t.opacity.value,p=t.infecter.infectionStage,U=c.infection.stages,k=void 0!==p?U[p].color:void 0,b=Utils_1.ColorUtils.colorToRgb(k),f=v&&void 0!==g?g:null!=b?b:Utils_1.ColorUtils.hslToRgb(a),_=v&&void 0!==g?g:null!=b?b:Utils_1.ColorUtils.hslToRgb(r),m=void 0!==f?Utils_1.ColorUtils.getStyleFromRgb(f,u):void 0;if(!this.context||!m)return;const x=void 0!==_?Utils_1.ColorUtils.getStyleFromRgb(_,null!==(l=t.stroke.opacity)&&void 0!==l?l:u):m;if(t.links.length>0){this.context.save();for(const i of t.links){if(t.particlesOptions.links.triangles.enable){const o=t.links.map(t=>t.destination),s=i.destination.links.filter(t=>o.indexOf(t.destination)>=0);if(s.length)for(const o of s)this.drawLinkTriangle(t,i,o)}this.drawLinkLine(t,i)}this.context.restore()}Utils_1.CanvasUtils.drawParticle(this.container,this.context,t,i,m,x,c.backgroundMask.enable,C,u,t.particlesOptions.shadow)}drawPlugin(t,i){this.context&&Utils_1.CanvasUtils.drawPlugin(this.context,t,i)}paintBase(t){this.context&&Utils_1.CanvasUtils.paintBase(this.context,this.size,t)}lineStyle(t,i){const o=this.container.options.interactivity.modes.connect;if(this.context)return Utils_1.CanvasUtils.gradient(this.context,t,i,o.links.opacity)}initBackground(){const t=this.container.options.background,i=this.element;if(!i)return;const o=i.style;if(t.color){const i=Utils_1.ColorUtils.colorToRgb(t.color);i&&(o.backgroundColor=Utils_1.ColorUtils.getStyleFromRgb(i,t.opacity))}t.image&&(o.backgroundImage=t.image),t.position&&(o.backgroundPosition=t.position),t.repeat&&(o.backgroundRepeat=t.repeat),t.size&&(o.backgroundSize=t.size)}}exports.Canvas=Canvas;