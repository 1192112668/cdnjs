"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Canvas=void 0;var Utils_1=require("../Utils"),Canvas=function(){function t(t){this.container=t,this.size={height:0,width:0},this.context=null,this.generatedCanvas=!1}return t.prototype.init=function(){this.resize();var t=this.container.options,i=t.backgroundMask.cover.color,o=t.particles.move.trail;this.coverColor=Utils_1.ColorUtils.colorToRgb(i),this.trailFillColor=Utils_1.ColorUtils.colorToRgb(o.fillColor),this.paint()},t.prototype.loadCanvas=function(t,i){var o;t.className||(t.className=Utils_1.Constants.canvasClass),this.generatedCanvas&&null!==(o=this.element)&&void 0!==o&&o.remove(),this.generatedCanvas=null!=i&&i,this.element=t,this.size.height=t.offsetHeight,this.size.width=t.offsetWidth,this.context=this.element.getContext("2d"),this.container.retina.init(),this.initBackground()},t.prototype.destroy=function(){var t;this.generatedCanvas&&null!==(t=this.element)&&void 0!==t&&t.remove(),this.context&&Utils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.resize=function(){this.element&&(this.element.width=this.size.width,this.element.height=this.size.height)},t.prototype.paint=function(){var t=this.container.options;this.context&&(t.backgroundMask.enable&&t.backgroundMask.cover&&this.coverColor?this.paintBase(Utils_1.ColorUtils.getStyleFromRgb(this.coverColor)):this.paintBase())},t.prototype.clear=function(){var t=this.container.options,i=t.particles.move.trail;t.backgroundMask.enable?this.paint():i.enable&&0<i.length&&this.trailFillColor?this.paintBase(Utils_1.ColorUtils.getStyleFromRgb(this.trailFillColor,1/i.length)):this.context&&Utils_1.CanvasUtils.clear(this.context,this.size)},t.prototype.isPointInPath=function(t,i){var o,n;return null!==(n=null===(o=this.context)||void 0===o?void 0:o.isPointInPath(t,i.x,i.y))&&void 0!==n&&n},t.prototype.drawLinkTriangle=function(t,i,o){var n,e,s=this.container,l=s.options,a=i.destination,r=o.destination,c=t.particlesOptions.links.triangles,h=null!==(n=c.opacity)&&void 0!==n?n:(i.opacity+o.opacity)/2,d=t.getPosition(),p=a.getPosition(),v=r.getPosition(),g=this.context;if(g){var u=Utils_1.ColorUtils.colorToRgb(c.color);if(!u){var C=t.particlesOptions.links,U=void 0!==C.id?s.particles.linksColors[C.id]:s.particles.linksColor;if(U===Utils_1.Constants.randomColorValue)u=Utils_1.ColorUtils.getRandomRgbColor();else if("mid"===U){var k=t.getColor(),f=a.getColor();if(k&&f)u=Utils_1.ColorUtils.mix(k,f,t.size.value,a.size.value);else{var b=null!=k?k:f;if(!b)return;u=Utils_1.ColorUtils.hslToRgb(b)}}else u=U}var y=null!==(e=t.linksWidth)&&void 0!==e?e:s.retina.linksWidth;Utils_1.CanvasUtils.drawLinkTriangle(g,y,d,p,v,l.backgroundMask.enable,u,h)}},t.prototype.drawLinkLine=function(t,i){var o,n=this.container,e=n.options,s=i.destination,l=i.opacity,a=t.getPosition(),r=s.getPosition(),c=this.context;if(c){var h,d,p,v=t.particlesOptions.twinkle.lines;if(v.enable&&(d=v.frequency,p=Utils_1.ColorUtils.colorToRgb(v.color),Math.random()<d&&void 0!==p&&(h=p,l=v.opacity)),!h){var g=t.particlesOptions.links,u=void 0!==g.id?n.particles.linksColors[g.id]:n.particles.linksColor;if(u===Utils_1.Constants.randomColorValue)h=Utils_1.ColorUtils.getRandomRgbColor();else if("mid"===u){var C=t.getColor(),U=s.getColor();if(C&&U)h=Utils_1.ColorUtils.mix(C,U,t.size.value,s.size.value);else{var k=null!=C?C:U;if(!k)return;h=Utils_1.ColorUtils.hslToRgb(k)}}else h=u}var f=null!==(o=t.linksWidth)&&void 0!==o?o:n.retina.linksWidth;Utils_1.CanvasUtils.drawLinkLine(c,f,a,r,t.particlesOptions.links.distance,n.canvas.size,t.particlesOptions.links.warp,e.backgroundMask.enable,h,l,t.particlesOptions.links.shadow)}},t.prototype.drawConnectLine=function(t,i){var o,n,e,s,l=this.lineStyle(t,i);!l||(n=this.context)&&(e=t.getPosition(),s=i.getPosition(),Utils_1.CanvasUtils.drawConnectLine(n,null!==(o=t.linksWidth)&&void 0!==o?o:this.container.retina.linksWidth,l,e,s))},t.prototype.drawGrabLine=function(t,i,o,n){var e,s,l=this.container,a=l.canvas.context;a&&(s=t.getPosition(),Utils_1.CanvasUtils.drawGrabLine(a,null!==(e=t.linksWidth)&&void 0!==e?e:l.retina.linksWidth,s,n,i,o))},t.prototype.drawParticle=function(l,t){var i,o,n=l.getColor();if(void 0!==n){var e=this.container.options,s=l.particlesOptions.twinkle.particles,a=s.frequency,r=Utils_1.ColorUtils.colorToRgb(s.color),c=s.enable&&Math.random()<a,h=null!==(i=l.bubble.radius)&&void 0!==i?i:l.size.value,d=c?s.opacity:null!==(o=l.bubble.opacity)&&void 0!==o?o:l.opacity.value,p=l.infectionStage,v=e.infection.stages,g=void 0!==p?v[p].color:void 0,u=Utils_1.ColorUtils.colorToRgb(g),C=c&&void 0!==r?r:null!=u?u:Utils_1.ColorUtils.hslToRgb(n),U=void 0!==C?Utils_1.ColorUtils.getStyleFromRgb(C,d):void 0;if(this.context&&U){if(0<l.links.length){this.context.save();for(var k=function(t){if(l.particlesOptions.links.triangles.enable){var i=l.links.map(function(t){return t.destination}),o=t.destination.links.filter(function(t){return 0<=i.indexOf(t.destination)});if(o.length)for(var n=0,e=o;n<e.length;n++){var s=e[n];f.drawLinkTriangle(l,t,s)}}f.drawLinkLine(l,t)},f=this,b=0,y=l.links;b<y.length;b++){k(y[b])}this.context.restore()}Utils_1.CanvasUtils.drawParticle(this.container,this.context,l,t,U,e.backgroundMask.enable,h,d,l.particlesOptions.shadow)}}},t.prototype.drawPlugin=function(t,i){this.context&&Utils_1.CanvasUtils.drawPlugin(this.context,t,i)},t.prototype.paintBase=function(t){this.context&&Utils_1.CanvasUtils.paintBase(this.context,this.size,t)},t.prototype.lineStyle=function(t,i){var o=this.container.options.interactivity.modes.connect;if(this.context)return Utils_1.CanvasUtils.gradient(this.context,t,i,o.links.opacity)},t.prototype.initBackground=function(){var t,i,o=this.container.options.background,n=this.element;n&&(t=n.style,!o.color||(i=Utils_1.ColorUtils.colorToRgb(o.color))&&(t.backgroundColor=Utils_1.ColorUtils.getStyleFromRgb(i,o.opacity)),o.image&&(t.backgroundImage=o.image),o.position&&(t.backgroundPosition=o.position),o.repeat&&(t.backgroundRepeat=o.repeat),o.size&&(t.backgroundSize=o.size))},t}();exports.Canvas=Canvas;