"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Updater=void 0;var OutMode_1=require("../../Enums/OutMode"),Utils_1=require("../../Utils"),Mover_1=require("./Mover"),RotateDirection_1=require("../../Enums/RotateDirection"),SizeAnimationStatus_1=require("../../Enums/SizeAnimationStatus"),OpacityAnimationStatus_1=require("../../Enums/OpacityAnimationStatus"),Updater=function(){function p(t,i){this.container=t,this.particle=i,this.mover=new Mover_1.Mover(t,i)}return p.checkBounds=function(t,i,e,o,a){(e<t+i&&0<o||t-i<0&&o<0)&&a()},p.prototype.update=function(t){this.mover.move(t),this.updateOpacity(t),this.updateSize(t),this.updateAngle(t),this.updateColor(t),this.fixOutOfCanvasPosition(t),this.updateOutMode(t)},p.prototype.updateOpacity=function(t){var i=this.container.options,e=this.particle,o=0<i.fpsLimit?60*t/1e3:3.6;if(e.particlesOptions.opacity.animation.enable){switch(e.opacity.status){case OpacityAnimationStatus_1.OpacityAnimationStatus.increasing:e.opacity.value>=e.particlesOptions.opacity.value?e.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.decreasing:e.opacity.value+=(e.opacity.velocity||0)*o;break;case OpacityAnimationStatus_1.OpacityAnimationStatus.decreasing:e.opacity.value<=e.particlesOptions.opacity.animation.minimumValue?e.opacity.status=OpacityAnimationStatus_1.OpacityAnimationStatus.increasing:e.opacity.value-=(e.opacity.velocity||0)*o}e.opacity.value<0&&(e.opacity.value=0)}},p.prototype.updateSize=function(t){var i,e=this.container,o=e.options,a=this.particle,n=0<o.fpsLimit?60*t/1e3:3.6;if(a.particlesOptions.size.animation.enable){switch(a.size.status){case SizeAnimationStatus_1.SizeAnimationStatus.increasing:a.size.value>=(null!==(i=a.sizeValue)&&void 0!==i?i:e.retina.sizeValue)?a.size.status=SizeAnimationStatus_1.SizeAnimationStatus.decreasing:a.size.value+=(a.size.velocity||0)*n;break;case SizeAnimationStatus_1.SizeAnimationStatus.decreasing:a.size.value<=a.particlesOptions.size.animation.minimumValue?a.size.status=SizeAnimationStatus_1.SizeAnimationStatus.increasing:a.size.value-=(a.size.velocity||0)*n}a.size.value<0&&(a.size.value=0)}},p.prototype.updateAngle=function(t){var i=this.container.options,e=this.particle,o=0<i.fpsLimit?60*t/1e3:3.6;if(e.particlesOptions.rotate.animation.enable)switch(e.rotateDirection){case RotateDirection_1.RotateDirection.clockwise:e.angle+=e.particlesOptions.rotate.animation.speed*Math.PI/18*o,360<e.angle&&(e.angle-=360);break;case RotateDirection_1.RotateDirection.counterClockwise:default:e.angle-=e.particlesOptions.rotate.animation.speed*Math.PI/18*o,e.angle<0&&(e.angle+=360)}},p.prototype.updateColor=function(t){var i,e=this.container.options,o=this.particle;void 0!==o.color&&(i=0<e.fpsLimit?60*t/1e3:3.6,o.particlesOptions.color.animation.enable&&(o.color.h+=(o.colorVelocity||0)*i,360<o.color.h&&(o.color.h-=360)))},p.prototype.fixOutOfCanvasPosition=function(t){var i,e,o=this.container,a=this.particle,n=a.particlesOptions.move.outMode,s=a.particlesOptions.move.warp,u=o.canvas.size,c=n===OutMode_1.OutMode.bounce?{bottom:u.height,left:a.size.value,right:u.width,top:a.size.value}:n===OutMode_1.OutMode.bounceHorizontal?{bottom:u.height+a.size.value-a.offset.y,left:a.size.value,right:u.width,top:-a.size.value-a.offset.y}:n===OutMode_1.OutMode.bounceVertical?{bottom:u.height,left:-a.size.value-a.offset.x,right:u.width+a.size.value+a.offset.x,top:a.size.value}:{bottom:u.height+a.size.value-a.offset.y,left:-a.size.value-a.offset.x,right:u.width+a.size.value+a.offset.x,top:-a.size.value-a.offset.y};n===OutMode_1.OutMode.destroy?(i=a.size.value,Utils_1.Utils.isPointInside(a.position,o.canvas.size,i)||o.particles.remove(a)):(i=a.size.value,(e=Utils_1.Utils.calculateBounds(a.position,i)).left>u.width-a.offset.x?(a.position.x=c.left,s||(a.position.y=Math.random()*u.height)):e.right<-a.offset.x&&(a.position.x=c.right,s||(a.position.y=Math.random()*u.height)),e.top>u.height-a.offset.y?(s||(a.position.x=Math.random()*u.width),a.position.y=c.top):e.bottom<-a.offset.y&&(s||(a.position.x=Math.random()*u.width),a.position.y=c.bottom))},p.prototype.updateOutMode=function(t){switch(this.particle.particlesOptions.move.outMode){case OutMode_1.OutMode.bounce:case OutMode_1.OutMode.bounceVertical:case OutMode_1.OutMode.bounceHorizontal:this.updateBounce(t)}},p.prototype.updateBounce=function(t){var i,e,o,a,n=this.container,s=this.particle,u=!1;for(var c in n.plugins){var r=n.plugins[c];if(void 0!==r.particleBounce&&(u=r.particleBounce(s,t)),u)break}u||(i=s.particlesOptions.move.outMode,e=s.getPosition(),i!==OutMode_1.OutMode.bounce&&i!==OutMode_1.OutMode.bounceHorizontal||(o=s.size.value,a=s.velocity.horizontal,p.checkBounds(e.x,o,n.canvas.size.width,a,function(){s.velocity.horizontal*=-1})),i!==OutMode_1.OutMode.bounce&&i!==OutMode_1.OutMode.bounceVertical||(o=s.size.value,a=s.velocity.vertical,p.checkBounds(e.y,o,n.canvas.size.height,a,function(){s.velocity.vertical*=-1})))},p}();exports.Updater=Updater;