"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Particles=void 0;var Particle_1=require("./Particle"),InteractionManager_1=require("./Particle/Interactions/Particles/InteractionManager"),HoverMode_1=require("../Enums/Modes/HoverMode"),Grabber_1=require("./Particle/Interactions/Mouse/Grabber"),ClickMode_1=require("../Enums/Modes/ClickMode"),Repulser_1=require("./Particle/Interactions/Mouse/Repulser"),DivMode_1=require("../Enums/Modes/DivMode"),Bubbler_1=require("./Particle/Interactions/Mouse/Bubbler"),Connector_1=require("./Particle/Interactions/Mouse/Connector"),DestroyType_1=require("../Enums/DestroyType"),Utils_1=require("../Utils"),Particles=function(){function e(e){this.container=e,this.array=[],this.interactionsEnabled=!1;var t=this.container.canvas.size;this.noiseZ=0,this.linksColors={},this.quadTree=new Utils_1.QuadTree(new Utils_1.Rectangle(0,0,t.width,t.height),4)}return Object.defineProperty(e.prototype,"count",{get:function(){return this.array.length},enumerable:!1,configurable:!0}),e.prototype.init=function(){var e=this.container,t=e.options,i=!1;for(var r in this.noiseZ=0,e.plugins){var n=e.plugins[r];if(void 0!==n.particlesInitialization&&(i=n.particlesInitialization()),i)break}if(!i)for(var o=this.count;o<t.particles.number.value;o++)this.addParticle();if(this.interactionsEnabled=t.particles.links.enable||t.particles.move.attract.enable||t.particles.collisions.enable||t.infection.enable,t.infection.enable)for(o=0;o<t.infection.infections;o++){var a=this.array.filter(function(e){return void 0===e.infectionStage});Utils_1.Utils.itemFromArray(a).startInfection(0)}},e.prototype.redraw=function(){this.clear(),this.init(),this.draw(0)},e.prototype.removeAt=function(e,t){if(0<=e&&e<=this.count)for(var i=0,r=this.array.splice(e,null!=t?t:1);i<r.length;i++){r[i].destroy()}},e.prototype.remove=function(e){this.removeAt(this.array.indexOf(e))},e.prototype.update=function(e){for(var t=this.container,i=t.options,r=[],n=0;n<this.count;n++){var o,a=this.array[n];for(var s in Bubbler_1.Bubbler.reset(a),t.plugins){var l=t.plugins[s];if(a.destroyed)break;l.particleUpdate&&l.particleUpdate(a,e)}if(!a.destroyed){var c=a.particlesOptions.size,u=c.animation;if(u.enable)switch(u.destroy){case DestroyType_1.DestroyType.max:a.size.value>=c.value*t.retina.pixelRatio&&(a.destroyed=!0);break;case DestroyType_1.DestroyType.min:a.size.value<=u.minimumValue*t.retina.pixelRatio&&(a.destroyed=!0)}}a.destroyed?r.push(a):(a.update(n,e),o=a.getPosition(),this.quadTree.insert(new Utils_1.Point(o.x,o.y,a)))}for(var p,v,d,y=0,h=r;y<h.length;y++){a=h[y];this.remove(a)}(t.options.interactivity.events.onDiv.enable||t.options.interactivity.events.onHover.enable&&t.interactivity.mouse.position||t.options.interactivity.events.onClick.enable&&t.interactivity.mouse.clickPosition)&&(p=i.interactivity.events.onHover.mode,v=i.interactivity.events.onClick.mode,d=i.interactivity.events.onDiv.mode,Utils_1.Utils.isInArray(HoverMode_1.HoverMode.grab,p)&&Grabber_1.Grabber.grab(t,e),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.repulse,p)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.repulse,v)||Utils_1.Utils.isInArray(DivMode_1.DivMode.repulse,d))&&Repulser_1.Repulser.repulse(t,e),(Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,p)||Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,v))&&Bubbler_1.Bubbler.bubble(t,e),Utils_1.Utils.isInArray(HoverMode_1.HoverMode.connect,p)&&Connector_1.Connector.connect(t,e));for(var b=0,f=this.array;b<f.length;b++){a=f[b];this.interactionsEnabled&&InteractionManager_1.InteractionManager.interact(a,t,e)}},e.prototype.draw=function(e){var t=this.container;t.canvas.clear();var i=this.container.canvas.size;for(var r in this.quadTree=new Utils_1.QuadTree(new Utils_1.Rectangle(0,0,i.width,i.height),4),this.update(e),this.noiseZ+=4e-4,t.plugins){var n=t.plugins[r];t.canvas.drawPlugin(n,e)}for(var o=0,a=this.array;o<a.length;o++){a[o].draw(e)}},e.prototype.clear=function(){this.array=[]},e.prototype.push=function(e,t){var i,r,n,o=this.container,a=o.options,s=a.particles.number.limit*o.density;this.pushing=!0,0<s&&(0<(r=this.count+e-s)&&this.removeQuantity(r)),t&&(n=null!==(i=t.position)&&void 0!==i?i:{x:0,y:0});for(var l=0;l<e;l++)this.addParticle(n);a.particles.move.enable||this.container.play(),this.pushing=!1},e.prototype.addParticle=function(e,t){var i=new Particle_1.Particle(this.container,e,t);return this.array.push(i),i},e.prototype.removeQuantity=function(e){var t=this.container.options;this.removeAt(0,e),t.particles.move.enable||this.container.play()},e}();exports.Particles=Particles;