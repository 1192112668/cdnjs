"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Loader=void 0;const tslib_1=require("tslib"),Container_1=require("./Container"),Utils_1=require("../Utils"),tsParticlesDom=[];class Loader{static dom(){return tsParticlesDom}static domItem(t){const e=Loader.dom(),r=e[t];if(r&&!r.destroyed)return r;e.splice(t,1)}static loadFromArray(t,e,r){return tslib_1.__awaiter(this,void 0,void 0,function*(){return Loader.load(t,Utils_1.Utils.itemFromArray(e,r))})}static setFromArray(t,e,r,s){return tslib_1.__awaiter(this,void 0,void 0,function*(){return Loader.set(t,e,Utils_1.Utils.itemFromArray(r,s))})}static load(t,e){return tslib_1.__awaiter(this,void 0,void 0,function*(){const r=document.getElementById(t);if(r)return this.set(t,r,e)})}static set(t,e,r){return tslib_1.__awaiter(this,void 0,void 0,function*(){const s=Loader.dom(),i=s.findIndex(e=>e.id===t);if(i>=0){const t=this.domItem(i);t&&!t.destroyed&&(t.destroy(),s.splice(i,1))}let o,n;if("canvas"===e.tagName)o=e,n=!1;else{const t=e.getElementsByTagName("canvas");t.length?((o=t[0]).className||(o.className=Utils_1.Constants.canvasClass),n=!1):(n=!0,(o=document.createElement("canvas")).className=Utils_1.Constants.canvasClass,o.style.width="100%",o.style.height="100%",e.appendChild(o))}const a=new Container_1.Container(t,r);return i>=0?s.splice(i,0,a):s.push(a),a.canvas.loadCanvas(o,n),yield a.start(),a})}static loadJSON(t,e){return tslib_1.__awaiter(this,void 0,void 0,function*(){const r=yield fetch(e);if(r.ok){const e=yield r.json();return e instanceof Array?Loader.loadFromArray(t,e):Loader.load(t,e)}this.fetchError(r.status)})}static setJSON(t,e,r){return tslib_1.__awaiter(this,void 0,void 0,function*(){const s=yield fetch(r);if(s.ok){const r=yield s.json();return r instanceof Array?Loader.setFromArray(t,e,r):Loader.set(t,e,r)}this.fetchError(s.status)})}static setOnClickHandler(t){const e=Loader.dom();if(0===e.length)throw new Error("Can only set click handlers after calling tsParticles.load() or tsParticles.loadJSON()");for(const r of e){const e=r.interactivity.element;if(!e)continue;const s=(e,s)=>{if(r.destroyed)return;const i=r.retina.pixelRatio,o=r.particles.quadTree.query(new Utils_1.Circle(s.x*i,s.y*i,r.retina.sizeValue));t(e,o)},i=t=>{if(r.destroyed)return;const e=t,i={x:e.offsetX||e.clientX,y:e.offsetY||e.clientY};s(t,i)},o=()=>{r.destroyed||(l=!0,c=!1)},n=()=>{r.destroyed||(c=!0)},a=t=>{var e,i,o;if(!r.destroyed){if(l&&!c){const n=t,a=n.touches[n.touches.length-1],d=null===(e=r.canvas.element)||void 0===e?void 0:e.getBoundingClientRect(),l={x:a.clientX-(null!==(i=null==d?void 0:d.left)&&void 0!==i?i:0),y:a.clientY-(null!==(o=null==d?void 0:d.top)&&void 0!==o?o:0)};s(t,l)}l=!1,c=!1}},d=()=>{r.destroyed||(l=!1,c=!1)};let l=!1,c=!1;e.addEventListener("click",i),e.addEventListener("touchstart",o),e.addEventListener("touchmove",n),e.addEventListener("touchend",a),e.addEventListener("touchcancel",d)}}static fetchError(t){console.error(`Error tsParticles - fetch status: ${t}`),console.error("Error tsParticles - File config not found")}}exports.Loader=Loader;