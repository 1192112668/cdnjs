"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,s){function i(t){try{c(o.next(t))}catch(t){s(t)}}function a(t){try{c(o.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,a)}c((o=o.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Loader=void 0;const Container_1=require("./Container"),Utils_1=require("../Utils"),tsParticlesDom=[];class Loader{static dom(){return tsParticlesDom}static domItem(t){const e=Loader.dom(),r=e[t];if(r&&!r.destroyed)return r;e.splice(t,1)}static loadFromArray(t,e,r){return __awaiter(this,void 0,void 0,function*(){return Loader.load(t,Utils_1.Utils.itemFromArray(e,r))})}static setFromArray(t,e,r,o){return __awaiter(this,void 0,void 0,function*(){return Loader.set(t,e,Utils_1.Utils.itemFromArray(r,o))})}static load(t,e){return __awaiter(this,void 0,void 0,function*(){const r=document.getElementById(t);if(r)return this.set(t,r,e)})}static set(t,e,r){return __awaiter(this,void 0,void 0,function*(){const o=Loader.dom(),n=o.findIndex(e=>e.id===t);if(n>=0){const t=this.domItem(n);t&&!t.destroyed&&(t.destroy(),o.splice(n,1))}let s,i;if("canvas"===e.tagName)s=e,i=!1;else{const t=e.getElementsByTagName("canvas");t.length?((s=t[0]).className||(s.className=Utils_1.Constants.canvasClass),i=!1):(i=!0,(s=document.createElement("canvas")).className=Utils_1.Constants.canvasClass,s.style.width="100%",s.style.height="100%",e.appendChild(s))}const a=new Container_1.Container(t,r);return n>=0?o.splice(n,0,a):o.push(a),a.canvas.loadCanvas(s,i),yield a.start(),a})}static loadJSON(t,e){return __awaiter(this,void 0,void 0,function*(){const r=yield fetch(e);if(r.ok){const e=yield r.json();return e instanceof Array?Loader.loadFromArray(t,e):Loader.load(t,e)}this.fetchError(r.status)})}static setJSON(t,e,r){return __awaiter(this,void 0,void 0,function*(){const o=yield fetch(r);if(o.ok){const r=yield o.json();return r instanceof Array?Loader.setFromArray(t,e,r):Loader.set(t,e,r)}this.fetchError(o.status)})}static setOnClickHandler(t){const e=Loader.dom();if(0===e.length)throw new Error("Can only set click handlers after calling tsParticles.load() or tsParticles.loadJSON()");for(const r of e){const e=r.interactivity.element;if(!e)continue;const o=(e,o)=>{if(r.destroyed)return;const n=r.particles.quadTree.query(new Utils_1.Circle(o.x,o.y,1));t(e,n)},n=t=>{if(r.destroyed)return;const e=t,n={x:e.offsetX||e.clientX,y:e.offsetY||e.clientY};o(t,n)},s=()=>{r.destroyed||(d=!0,l=!1)},i=()=>{r.destroyed||(l=!0)},a=t=>{var e,n,s;if(!r.destroyed){if(d&&!l){const i=t,a=i.touches[i.touches.length-1],c=null===(e=r.canvas.element)||void 0===e?void 0:e.getBoundingClientRect(),d={x:a.clientX-(null!==(n=null==c?void 0:c.left)&&void 0!==n?n:0),y:a.clientY-(null!==(s=null==c?void 0:c.top)&&void 0!==s?s:0)};o(t,d)}d=!1,l=!1}},c=()=>{r.destroyed||(d=!1,l=!1)};let d=!1,l=!1;e.addEventListener("click",n),e.addEventListener("touchstart",s),e.addEventListener("touchmove",i),e.addEventListener("touchend",a),e.addEventListener("touchcancel",c)}}static fetchError(t){console.error(`Error tsParticles - fetch status: ${t}`),console.error("Error tsParticles - File config not found")}}exports.Loader=Loader;