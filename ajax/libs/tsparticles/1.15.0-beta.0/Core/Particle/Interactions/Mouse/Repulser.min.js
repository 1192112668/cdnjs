"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;var Enums_1=require("../../../../Enums"),Utils_1=require("../../../../Utils"),Repulser=function(){function e(){}return e.repulse=function(e,i){var t=e.options,s=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,o=t.interactivity.events,n=o.onHover.enable,l=o.onHover.mode,r=o.onClick.enable,u=o.onClick.mode,c=o.onDiv.mode,a=o.onDiv.enable;s&&n&&Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,l)?this.hoverRepulse(e):r&&Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,u)?this.clickRepulse(e):a&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,c)&&this.divRepulse(e)},e.divRepulse=function(e){var i,t,s,o=e.options,n=document.getElementById(o.interactivity.events.onDiv.elementId);n&&(i=e.retina.pixelRatio,t={x:(n.offsetLeft+n.offsetWidth/2)*i,y:(n.offsetTop+n.offsetHeight/2)*i},s=n.offsetWidth/2*i,this.processRepulse(e,t,s))},e.hoverRepulse=function(e){var i,t=e.interactivity.mouse.position;t&&(i=e.retina.repulseModeDistance,this.processRepulse(e,t,i))},e.processRepulse=function(e,i,t){for(var s=0,o=e.particles.quadTree.query(new Utils_1.Circle(i.x,i.y,t));s<o.length;s++){var n,l,r=o[s],u=Utils_1.Utils.getDistances(r.position,i),c=u.dx,a=u.dy,p=u.distance,v=c/p,d=a/p,y=100*e.options.interactivity.modes.repulse.speed,h=Utils_1.Utils.clamp((1-Math.pow(p/t,2))*y,0,50),m=r.particlesOptions.move.outMode,f=r.size.value,_={x:r.position.x+v*h,y:r.position.y+d*h};m===Enums_1.OutMode.bounce||m===Enums_1.OutMode.bounceVertical||m===Enums_1.OutMode.bounceHorizontal?(n=0<_.x-f&&_.x+f<e.canvas.size.width,l=0<_.y-f&&_.y+f<e.canvas.size.height,m!==Enums_1.OutMode.bounceVertical&&!n||(r.position.x=_.x),m!==Enums_1.OutMode.bounceHorizontal&&!l||(r.position.y=_.y)):(r.position.x=_.x,r.position.y=_.y)}},e.clickRepulse=function(e){if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){var i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),s=e.interactivity.mouse.clickPosition;if(void 0===s)return;for(var o=new Utils_1.Circle(s.x,s.y,t),n=0,l=e.particles.quadTree.query(o);n<l.length;n++){var r=l[n],u=Utils_1.Utils.getDistances(s,r.position),c=u.dx,a=u.dy,p=u.distance,v=p*p,d=-t*e.options.interactivity.modes.repulse.speed/v;v<=t&&(e.repulse.particles.push(r),this.processClickRepulse(e,r,c,a,d))}}else if(!1===e.repulse.clicking){for(var y=0,h=e.repulse.particles;y<h.length;y++){(r=h[y]).velocity.horizontal=r.initialVelocity.horizontal,r.velocity.vertical=r.initialVelocity.vertical}e.repulse.particles=[]}},e.processClickRepulse=function(e,i,t,s,o){var n=e.options,l=Math.atan2(s,t);i.velocity.horizontal=o*Math.cos(l),i.velocity.vertical=o*Math.sin(l);var r,u,c=n.particles.move.outMode;c!==Enums_1.OutMode.bounce&&c!==Enums_1.OutMode.bounceHorizontal&&c!==Enums_1.OutMode.bounceVertical||(r=i.position.x+i.velocity.horizontal,u=i.position.y+i.velocity.vertical,c!==Enums_1.OutMode.bounceVertical&&(r+i.size.value>e.canvas.size.width||r-i.size.value<0)&&(i.velocity.horizontal*=-1),c!==Enums_1.OutMode.bounceHorizontal&&(u+i.size.value>e.canvas.size.height||u-i.size.value<0)&&(i.velocity.vertical*=-1))},e}();exports.Repulser=Repulser;