"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ImageDrawer=void 0;const tslib_1=require("tslib"),Utils_1=require("../Utils"),Enums_1=require("../Enums");class ImageDrawer{constructor(){this.images=[]}getImages(e){const i=this.images.filter(i=>i.id===e.id);return i.length?i[0]:(this.images.push({id:e.id,images:[]}),this.getImages(e))}addImage(e,i){const a=this.getImages(e);null==a||a.images.push(i)}init(e){var i;return tslib_1.__awaiter(this,void 0,void 0,function*(){const a=e.options.particles.shape;if(!Utils_1.Utils.isInArray(Enums_1.ShapeType.image,a.type)&&!Utils_1.Utils.isInArray(Enums_1.ShapeType.images,a.type))return;const s=null!==(i=a.options[Enums_1.ShapeType.images])&&void 0!==i?i:a.options[Enums_1.ShapeType.image];if(s instanceof Array)for(const i of s)yield this.loadImageShape(e,i);else yield this.loadImageShape(e,s)})}destroy(){this.images=[]}loadImageShape(e,i){return tslib_1.__awaiter(this,void 0,void 0,function*(){try{const a=i.replaceColor?yield Utils_1.Utils.downloadSvgImage(i.src):yield Utils_1.Utils.loadImage(i.src);this.addImage(e,a)}catch(e){console.warn(`tsParticles error - ${i.src} not found`)}})}draw(e,i,a,s){var t,r;if(!e)return;const l=i.image,o=null===(t=null==l?void 0:l.data)||void 0===t?void 0:t.element;if(!o)return;const n=null!==(r=null==l?void 0:l.ratio)&&void 0!==r?r:1,d={x:-a,y:-a};(null==l?void 0:l.data.svgData)&&(null==l?void 0:l.replaceColor)||(e.globalAlpha=s),e.drawImage(o,d.x,d.y,2*a,2*a/n),(null==l?void 0:l.data.svgData)&&(null==l?void 0:l.replaceColor)||(e.globalAlpha=1)}}exports.ImageDrawer=ImageDrawer;