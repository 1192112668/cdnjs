"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;var Utils_1=require("../../../../Utils"),Enums_1=require("../../../../Enums"),Bubbler=function(){function e(){}return e.reset=function(e){delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color},e.bubble=function(e,i){var t=e.options.interactivity.events,b=t.onHover,l=t.onClick,u=b.enable,o=b.mode,s=l.enable,a=l.mode;u&&Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,o)?this.hoverBubble(e):s&&Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,a)&&this.clickBubble(e)},e.process=function(e,i,t,b,l){var u,o,s,a,r,n,c,v=l.bubbleObj.optValue;void 0!==v&&(u=e.options.interactivity.modes.bubble.duration,o=e.retina.bubbleModeDistance,s=l.particlesObj.optValue,a=l.bubbleObj.value,r=l.particlesObj.value||0,n=l.type,v!==s&&(e.bubble.durationEnd?a&&(n===Enums_1.ProcessBubbleType.size&&delete i.bubble.radius,n===Enums_1.ProcessBubbleType.opacity&&delete i.bubble.opacity):t<=o?(null!=a?a:r)!==v&&(c=r-b*(r-v)/u,n===Enums_1.ProcessBubbleType.size&&(i.bubble.radius=c),n===Enums_1.ProcessBubbleType.opacity&&(i.bubble.opacity=c)):(n===Enums_1.ProcessBubbleType.size&&delete i.bubble.radius,n===Enums_1.ProcessBubbleType.opacity&&delete i.bubble.opacity)))},e.clickBubble=function(e){var i,t=e.options,b=e.interactivity.mouse.clickPosition;if(void 0!==b)for(var l=e.retina.bubbleModeDistance,u=0,o=e.particles.quadTree.query(new Utils_1.Circle(b.x,b.y,l));u<o.length;u++){var s,a,r=o[u],n=r.getPosition(),c=Utils_1.Utils.getDistance(n,b),v=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;e.bubble.clicking&&(v>t.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),v>2*t.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1),s={bubbleObj:{optValue:e.retina.bubbleModeSize,value:r.bubble.radius},particlesObj:{optValue:null!==(i=r.sizeValue)&&void 0!==i?i:e.retina.sizeValue,value:r.size.value},type:Enums_1.ProcessBubbleType.size},this.process(e,r,c,v,s),a={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:r.bubble.opacity},particlesObj:{optValue:r.particlesOptions.opacity.value,value:r.opacity.value},type:Enums_1.ProcessBubbleType.opacity},this.process(e,r,c,v,a),!e.bubble.durationEnd&&c<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,r):delete r.bubble.color)}},e.hoverBubble=function(e){var i=e.interactivity.mouse.position;if(void 0!==i)for(var t=e.retina.bubbleModeDistance,b=0,l=e.particles.quadTree.query(new Utils_1.Circle(i.x,i.y,t));b<l.length;b++){var u=l[b],o=u.getPosition(),s=Utils_1.Utils.getDistance(o,i),a=1-s/e.retina.bubbleModeDistance;s<=e.retina.bubbleModeDistance?0<=a&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,u,a),this.hoverBubbleOpacity(e,u,a),this.hoverBubbleColor(e,u)):this.reset(u),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(u)}},e.hoverBubbleSize=function(e,i,t){var b,l,u,o,s=e.retina.bubbleModeSize;void 0!==s&&(l=null!==(b=i.sizeValue)&&void 0!==b?b:e.retina.sizeValue,u=i.size.value,void 0!==(o=this.calculateBubbleValue(u,s,l,t))&&(i.bubble.radius=o))},e.hoverBubbleOpacity=function(e,i,t){var b,l,u,o=e.options.interactivity.modes.bubble.opacity;void 0!==o&&(b=i.particlesOptions.opacity.value,l=i.opacity.value,void 0!==(u=this.calculateBubbleValue(l,o,b,t))&&(i.bubble.opacity=u))},e.calculateBubbleValue=function(e,i,t,b){if(t<i){var l=e+(i-t)*b;return Utils_1.Utils.clamp(l,e,i)}if(i<t){l=e-(t-i)*b;return Utils_1.Utils.clamp(l,i,e)}},e.hoverBubbleColor=function(e,i){var t=e.options;if(void 0===i.bubble.color){var b=t.interactivity.modes.bubble.color;if(void 0===b)return;var l=b instanceof Array?Utils_1.Utils.itemFromArray(b):b;i.bubble.color=Utils_1.ColorUtils.colorToRgb(l)}},e}();exports.Bubbler=Bubbler;