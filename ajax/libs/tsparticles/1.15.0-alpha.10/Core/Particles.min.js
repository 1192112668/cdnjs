"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Particles=void 0;var Particle_1=require("./Particle"),InteractionManager_1=require("./Particle/Interactions/Particles/InteractionManager"),Grabber_1=require("./Particle/Interactions/Mouse/Grabber"),Enums_1=require("../Enums"),Repulser_1=require("./Particle/Interactions/Mouse/Repulser"),Bubbler_1=require("./Particle/Interactions/Mouse/Bubbler"),Connector_1=require("./Particle/Interactions/Mouse/Connector"),Utils_1=require("../Utils"),Particles=function(){function e(e){this.container=e,this.array=[],this.interactionsEnabled=!1;var t=this.container.canvas.size;this.noiseZ=0,this.linksColors={},this.quadTree=new Utils_1.QuadTree(new Utils_1.Rectangle(0,0,t.width,t.height),4)}return Object.defineProperty(e.prototype,"count",{get:function(){return this.array.length},enumerable:!1,configurable:!0}),e.prototype.init=function(){var e=this.container,t=e.options,i=!1;for(var r in this.noiseZ=0,e.plugins){var n=e.plugins[r];if(void 0!==n.particlesInitialization&&(i=n.particlesInitialization()),i)break}if(!i)for(var a=this.count;a<t.particles.number.value;a++)this.addParticle();if(this.interactionsEnabled=t.particles.links.enable||t.particles.move.attract.enable||t.particles.collisions.enable||t.infection.enable,t.infection.enable)for(a=0;a<t.infection.infections;a++){var s=this.array.filter(function(e){return void 0===e.infectionStage});Utils_1.Utils.itemFromArray(s).startInfection(0)}},e.prototype.redraw=function(){this.clear(),this.init(),this.draw(0)},e.prototype.removeAt=function(e,t){if(0<=e&&e<=this.count)for(var i=0,r=this.array.splice(e,null!=t?t:1);i<r.length;i++){r[i].destroy()}},e.prototype.remove=function(e){this.removeAt(this.array.indexOf(e))},e.prototype.update=function(e){for(var t=this.container,i=t.options,r=[],n=0;n<this.count;n++){var a,s=this.array[n];for(var o in Bubbler_1.Bubbler.reset(s),t.plugins){var l=t.plugins[o];if(s.destroyed)break;l.particleUpdate&&l.particleUpdate(s,e)}if(!s.destroyed){var c=s.particlesOptions.size,u=c.animation;if(u.enable)switch(u.destroy){case Enums_1.DestroyType.max:s.size.value>=c.value*t.retina.pixelRatio&&(s.destroyed=!0);break;case Enums_1.DestroyType.min:s.size.value<=u.minimumValue*t.retina.pixelRatio&&(s.destroyed=!0)}}s.destroyed?r.push(s):(s.update(n,e),a=s.getPosition(),this.quadTree.insert(new Utils_1.Point(a,s)))}for(var p,v,h,d=0,y=r;d<y.length;d++){s=y[d];this.remove(s)}(t.options.interactivity.events.onDiv.enable||t.options.interactivity.events.onHover.enable&&t.interactivity.mouse.position||t.options.interactivity.events.onClick.enable&&t.interactivity.mouse.clickPosition)&&(p=i.interactivity.events.onHover.mode,v=i.interactivity.events.onClick.mode,h=i.interactivity.events.onDiv.mode,Utils_1.Utils.isInArray(Enums_1.HoverMode.grab,p)&&Grabber_1.Grabber.grab(t,e),(Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,p)||Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,v)||Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,h))&&Repulser_1.Repulser.repulse(t,e),(Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,p)||Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,v))&&Bubbler_1.Bubbler.bubble(t,e),Utils_1.Utils.isInArray(Enums_1.HoverMode.connect,p)&&Connector_1.Connector.connect(t,e));for(var b=0,f=this.array;b<f.length;b++){s=f[b];this.interactionsEnabled&&InteractionManager_1.InteractionManager.interact(s,t,e)}},e.prototype.draw=function(e){var t=this.container;t.canvas.clear();var i=this.container.canvas.size;for(var r in this.quadTree=new Utils_1.QuadTree(new Utils_1.Rectangle(0,0,i.width,i.height),4),this.update(e),this.noiseZ+=4e-4,t.plugins){var n=t.plugins[r];t.canvas.drawPlugin(n,e)}for(var a=0,s=this.array;a<s.length;a++){s[a].draw(e)}},e.prototype.clear=function(){this.array=[]},e.prototype.push=function(e,t){var i,r,n,a=this.container,s=a.options,o=s.particles.number.limit*a.density;this.pushing=!0,0<o&&(0<(r=this.count+e-o)&&this.removeQuantity(r)),t&&(n=null!==(i=t.position)&&void 0!==i?i:{x:0,y:0});for(var l=0;l<e;l++)this.addParticle(n);s.particles.move.enable||this.container.play(),this.pushing=!1},e.prototype.addParticle=function(e,t){var i=new Particle_1.Particle(this.container,e,t);return this.array.push(i),i},e.prototype.removeQuantity=function(e){var t=this.container.options;this.removeAt(0,e),t.particles.move.enable||this.container.play()},e}();exports.Particles=Particles;