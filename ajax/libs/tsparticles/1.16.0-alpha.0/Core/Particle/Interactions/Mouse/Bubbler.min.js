"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;var Utils_1=require("../../../../Utils"),Enums_1=require("../../../../Enums"),Bubbler=function(){function e(){}return e.reset=function(e){e.bubble.inRange||(delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)},e.bubble=function(e,i){var t=e.options.interactivity.events,b=t.onHover,l=t.onClick,o=b.enable,s=b.mode,u=l.enable,r=l.mode,a=t.onDiv;if(o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,s))this.hoverBubble(e);else if(u&&Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,r))this.clickBubble(e);else if(a instanceof Array)for(var n=0,c=a;n<c.length;n++){var v=c[n],d=v.mode;v.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,d)&&this.divHover(e,v)}else{d=a.mode;a.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,d)&&this.divHover(e,a)}},e.divHover=function(e,i){var t=i.ids;if(t instanceof Array)for(var b=0,l=t;b<l.length;b++){var o=l[b];this.singleDivHover(e,o,i)}else this.singleDivHover(e,t,i)},e.singleDivHover=function(e,i,t){var b=document.getElementById(i);if(b)for(var l=e.retina.pixelRatio,o={x:(b.offsetLeft+b.offsetWidth/2)*l,y:(b.offsetTop+b.offsetHeight/2)*l},s=b.offsetWidth/2*l,u=t.type===Enums_1.DivType.circle?new Utils_1.Circle(o.x,o.y,s):new Utils_1.Rectangle(b.offsetLeft,b.offsetTop,b.offsetWidth,b.offsetHeight),r=0,a=e.particles.quadTree.query(u);r<a.length;r++){var n=a[r];n.bubble.inRange=!0,this.hoverBubbleSize(e,n,1),this.hoverBubbleOpacity(e,n,1),this.hoverBubbleColor(e,n)}},e.process=function(e,i,t,b,l){var o,s,u,r,a,n,c,v=l.bubbleObj.optValue;void 0!==v&&(o=e.options.interactivity.modes.bubble.duration,s=e.retina.bubbleModeDistance,u=l.particlesObj.optValue,r=l.bubbleObj.value,a=l.particlesObj.value||0,n=l.type,v!==u&&(e.bubble.durationEnd?r&&(n===Enums_1.ProcessBubbleType.size&&delete i.bubble.radius,n===Enums_1.ProcessBubbleType.opacity&&delete i.bubble.opacity):t<=s?(null!=r?r:a)!==v&&(c=a-b*(a-v)/o,n===Enums_1.ProcessBubbleType.size&&(i.bubble.radius=c),n===Enums_1.ProcessBubbleType.opacity&&(i.bubble.opacity=c)):(n===Enums_1.ProcessBubbleType.size&&delete i.bubble.radius,n===Enums_1.ProcessBubbleType.opacity&&delete i.bubble.opacity)))},e.clickBubble=function(e){var i,t=e.options,b=e.interactivity.mouse.clickPosition;if(void 0!==b)for(var l=e.retina.bubbleModeDistance,o=0,s=e.particles.quadTree.query(new Utils_1.Circle(b.x,b.y,l));o<s.length;o++){var u=s[o];u.bubble.inRange=!0;var r,a,n=u.getPosition(),c=Utils_1.Utils.getDistance(n,b),v=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;e.bubble.clicking&&(v>t.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),v>2*t.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1),r={bubbleObj:{optValue:e.retina.bubbleModeSize,value:u.bubble.radius},particlesObj:{optValue:null!==(i=u.sizeValue)&&void 0!==i?i:e.retina.sizeValue,value:u.size.value},type:Enums_1.ProcessBubbleType.size},this.process(e,u,c,v,r),a={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:u.bubble.opacity},particlesObj:{optValue:u.particlesOptions.opacity.value,value:u.opacity.value},type:Enums_1.ProcessBubbleType.opacity},this.process(e,u,c,v,a),!e.bubble.durationEnd&&c<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,u):delete u.bubble.color)}},e.hoverBubble=function(e){var i=e.interactivity.mouse.position;if(void 0!==i)for(var t=e.retina.bubbleModeDistance,b=0,l=e.particles.quadTree.query(new Utils_1.Circle(i.x,i.y,t));b<l.length;b++){var o=l[b];o.bubble.inRange=!0;var s=o.getPosition(),u=Utils_1.Utils.getDistance(s,i),r=1-u/e.retina.bubbleModeDistance;u<=e.retina.bubbleModeDistance?0<=r&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,o,r),this.hoverBubbleOpacity(e,o,r),this.hoverBubbleColor(e,o)):this.reset(o),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(o)}},e.hoverBubbleSize=function(e,i,t){var b,l,o,s,u=e.retina.bubbleModeSize;void 0!==u&&(l=null!==(b=i.sizeValue)&&void 0!==b?b:e.retina.sizeValue,o=i.size.value,void 0!==(s=this.calculateBubbleValue(o,u,l,t))&&(i.bubble.radius=s))},e.hoverBubbleOpacity=function(e,i,t){var b,l,o,s=e.options.interactivity.modes.bubble.opacity;void 0!==s&&(b=i.particlesOptions.opacity.value,l=i.opacity.value,void 0!==(o=this.calculateBubbleValue(l,s,b,t))&&(i.bubble.opacity=o))},e.calculateBubbleValue=function(e,i,t,b){if(t<i){var l=e+(i-t)*b;return Utils_1.Utils.clamp(l,e,i)}if(i<t){l=e-(t-i)*b;return Utils_1.Utils.clamp(l,i,e)}},e.hoverBubbleColor=function(e,i){var t=e.options;if(void 0===i.bubble.color){var b=t.interactivity.modes.bubble.color;if(void 0===b)return;var l=b instanceof Array?Utils_1.Utils.itemFromArray(b):b;i.bubble.color=Utils_1.ColorUtils.colorToHsl(l)}},e}();exports.Bubbler=Bubbler;