"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;var Enums_1=require("../../../../Enums"),Utils_1=require("../../../../Utils"),Repulser=function(){function e(){}return e.repulse=function(e,i){var t=e.options,s=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,o=t.interactivity.events,n=o.onHover.enable,l=o.onHover.mode,r=o.onClick.enable,u=o.onClick.mode,a=o.onDiv;if(s&&n&&Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,l))this.hoverRepulse(e);else if(r&&Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,u))this.clickRepulse(e);else if(a instanceof Array)for(var c=0,p=a;c<p.length;c++){var v=p[c],d=v.mode;v.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,d)&&this.divRepulse(e,v)}else{d=a.mode;a.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,d)&&this.divRepulse(e,a)}},e.divRepulse=function(e,i){var t=i.ids;if(t instanceof Array)for(var s=0,o=t;s<o.length;s++){var n=o[s];this.singleDivRepulse(e,n,i)}else this.singleDivRepulse(e,t,i)},e.singleDivRepulse=function(e,i,t){var s,o,n,l,r=document.getElementById(i);r&&(s=e.retina.pixelRatio,o={x:(r.offsetLeft+r.offsetWidth/2)*s,y:(r.offsetTop+r.offsetHeight/2)*s},n=r.offsetWidth/2*s,l=t.type===Enums_1.DivType.circle?new Utils_1.Circle(o.x,o.y,n):new Utils_1.Rectangle(r.offsetLeft,r.offsetTop,r.offsetWidth,r.offsetHeight),this.processRepulse(e,o,n,l))},e.hoverRepulse=function(e){var i,t=e.interactivity.mouse.position;t&&(i=e.retina.repulseModeDistance,this.processRepulse(e,t,i,new Utils_1.Circle(t.x,t.y,i)))},e.processRepulse=function(e,i,t,s){for(var o=0,n=e.particles.quadTree.query(s);o<n.length;o++){var l,r,u=n[o],a=Utils_1.Utils.getDistances(u.position,i),c=a.dx,p=a.dy,v=a.distance,d=c/v,f=p/v,y=100*e.options.interactivity.modes.repulse.speed,h=Utils_1.Utils.clamp((1-Math.pow(v/t,2))*y,0,50),m=u.particlesOptions.move.outMode,_=u.size.value,M={x:u.position.x+d*h,y:u.position.y+f*h};m===Enums_1.OutMode.bounce||m===Enums_1.OutMode.bounceVertical||m===Enums_1.OutMode.bounceHorizontal?(l=0<M.x-_&&M.x+_<e.canvas.size.width,r=0<M.y-_&&M.y+_<e.canvas.size.height,m!==Enums_1.OutMode.bounceVertical&&!l||(u.position.x=M.x),m!==Enums_1.OutMode.bounceHorizontal&&!r||(u.position.y=M.y)):(u.position.x=M.x,u.position.y=M.y)}},e.clickRepulse=function(e){if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){var i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),s=e.interactivity.mouse.clickPosition;if(void 0===s)return;for(var o=new Utils_1.Circle(s.x,s.y,t),n=0,l=e.particles.quadTree.query(o);n<l.length;n++){var r=l[n],u=Utils_1.Utils.getDistances(s,r.position),a=u.dx,c=u.dy,p=u.distance,v=p*p,d=-t*e.options.interactivity.modes.repulse.speed/v;v<=t&&(e.repulse.particles.push(r),this.processClickRepulse(e,r,a,c,d))}}else if(!1===e.repulse.clicking){for(var f=0,y=e.repulse.particles;f<y.length;f++){(r=y[f]).velocity.horizontal=r.initialVelocity.horizontal,r.velocity.vertical=r.initialVelocity.vertical}e.repulse.particles=[]}},e.processClickRepulse=function(e,i,t,s,o){var n=e.options,l=Math.atan2(s,t);i.velocity.horizontal=o*Math.cos(l),i.velocity.vertical=o*Math.sin(l);var r,u,a=n.particles.move.outMode;a!==Enums_1.OutMode.bounce&&a!==Enums_1.OutMode.bounceHorizontal&&a!==Enums_1.OutMode.bounceVertical||(r=i.position.x+i.velocity.horizontal,u=i.position.y+i.velocity.vertical,a!==Enums_1.OutMode.bounceVertical&&(r+i.size.value>e.canvas.size.width||r-i.size.value<0)&&(i.velocity.horizontal*=-1),a!==Enums_1.OutMode.bounceHorizontal&&(u+i.size.value>e.canvas.size.height||u-i.size.value<0)&&(i.velocity.vertical*=-1))},e}();exports.Repulser=Repulser;