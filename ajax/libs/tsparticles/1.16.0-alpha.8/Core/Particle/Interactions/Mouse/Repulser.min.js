"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;const Enums_1=require("../../../../Enums"),Utils_1=require("../../../../Utils");class Repulser{constructor(e){this.container=e}isEnabled(){const e=this.container,i=e.options,t=e.interactivity.mouse,s=i.interactivity.events,o=s.onDiv,n=o instanceof Array?o.filter(e=>e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,e.mode)).length>0:Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,o.mode);if(!(n||s.onHover.enable&&t.position||s.onClick.enable&&t.clickPosition))return!1;const l=s.onHover.mode,r=s.onClick.mode;return Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,l)||Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,r)||n}reset(){}interact(){const e=this.container,i=e.options,t=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,s=i.interactivity.events,o=s.onHover.enable,n=s.onHover.mode,l=s.onClick.enable,r=s.onClick.mode,c=s.onDiv;if(t&&o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,n))this.hoverRepulse();else if(l&&Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,r))this.clickRepulse();else if(c instanceof Array)for(const e of c){const i=e.mode;e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,i)&&this.divRepulse(e)}else{const e=c.mode;c.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,e)&&this.divRepulse(c)}}divRepulse(e){const i=e.ids;if(i instanceof Array)for(const t of i)this.singleDivRepulse(t,e);else this.singleDivRepulse(i,e)}singleDivRepulse(e,i){const t=this.container,s=document.getElementById(e);if(!s)return;const o=t.retina.pixelRatio,n={x:(s.offsetLeft+s.offsetWidth/2)*o,y:(s.offsetTop+s.offsetHeight/2)*o},l=s.offsetWidth/2*o,r=i.type===Enums_1.DivType.circle?new Utils_1.Circle(n.x,n.y,l):new Utils_1.Rectangle(s.offsetLeft*o,s.offsetTop*o,s.offsetWidth*o,s.offsetHeight*o);this.processRepulse(n,l,r)}hoverRepulse(){const e=this.container,i=e.interactivity.mouse.position;if(!i)return;const t=e.retina.repulseModeDistance;this.processRepulse(i,t,new Utils_1.Circle(i.x,i.y,t))}processRepulse(e,i,t){const s=this.container,o=s.particles.quadTree.query(t);for(const t of o){const{dx:o,dy:n,distance:l}=Utils_1.Utils.getDistances(t.position,e),r={x:o/l,y:n/l},c=100*s.options.interactivity.modes.repulse.speed,u=Utils_1.Utils.clamp((1-Math.pow(l/i,2))*c,0,50),a=t.particlesOptions.move.outMode,p=t.size.value,v={x:t.position.x+r.x*u,y:t.position.y+r.y*u};if(a===Enums_1.OutMode.bounce||a===Enums_1.OutMode.bounceVertical||a===Enums_1.OutMode.bounceHorizontal){const e={horizontal:v.x-p>0&&v.x+p<s.canvas.size.width,vertical:v.y-p>0&&v.y+p<s.canvas.size.height};(a===Enums_1.OutMode.bounceVertical||e.horizontal)&&(t.position.x=v.x),(a===Enums_1.OutMode.bounceHorizontal||e.vertical)&&(t.position.y=v.y)}else t.position.x=v.x,t.position.y=v.y}}clickRepulse(){const e=this.container;if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){const i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),s=e.interactivity.mouse.clickPosition;if(void 0===s)return;const o=new Utils_1.Circle(s.x,s.y,t),n=e.particles.quadTree.query(o);for(const i of n){const{dx:o,dy:n,distance:l}=Utils_1.Utils.getDistances(s,i.position),r=l*l,c=e.options.interactivity.modes.repulse.speed,u=-t*c/r;r<=t&&(e.repulse.particles.push(i),this.processClickRepulse(i,o,n,u))}}else if(!1===e.repulse.clicking){for(const i of e.repulse.particles)i.velocity.horizontal=i.initialVelocity.horizontal,i.velocity.vertical=i.initialVelocity.vertical;e.repulse.particles=[]}}processClickRepulse(e,i,t,s){const o=this.container,n=o.options,l=Math.atan2(t,i);e.velocity.horizontal=s*Math.cos(l),e.velocity.vertical=s*Math.sin(l);const r=n.particles.move.outMode;if(r===Enums_1.OutMode.bounce||r===Enums_1.OutMode.bounceHorizontal||r===Enums_1.OutMode.bounceVertical){const i={x:e.position.x+e.velocity.horizontal,y:e.position.y+e.velocity.vertical};r!==Enums_1.OutMode.bounceVertical&&(i.x+e.size.value>o.canvas.size.width||i.x-e.size.value<0)&&(e.velocity.horizontal*=-1),r!==Enums_1.OutMode.bounceHorizontal&&(i.y+e.size.value>o.canvas.size.height||i.y-e.size.value<0)&&(e.velocity.vertical*=-1)}}}exports.Repulser=Repulser;