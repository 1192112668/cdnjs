"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;const Utils_1=require("../../../../Utils"),Enums_1=require("../../../../Enums");class Bubbler{constructor(e){this.container=e}static calculateBubbleValue(e,t,i,o){if(t>i){const s=e+(t-i)*o;return Utils_1.Utils.clamp(s,e,t)}if(t<i){const s=e-(i-t)*o;return Utils_1.Utils.clamp(s,t,e)}}isEnabled(){const e=this.container,t=e.options,i=e.interactivity.mouse,o=t.interactivity.events,s=o.onDiv,b=s instanceof Array?s.filter(e=>e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,e.mode)).length>0:Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,s.mode);if(!(b||o.onHover.enable&&i.position||o.onClick.enable&&i.clickPosition))return!1;const l=o.onHover.mode,n=o.onClick.mode;return Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,l)||Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,n)||b}reset(e){e.bubble.inRange||(delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)}interact(){const e=this.container.options.interactivity.events,t=e.onHover,i=e.onClick,o=t.enable,s=t.mode,b=i.enable,l=i.mode,n=e.onDiv;if(o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,s))this.hoverBubble();else if(b&&Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,l))this.clickBubble();else if(n instanceof Array)for(const e of n){const t=e.mode;e.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,t)&&this.divHover(e)}else{const e=n.mode;n.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,e)&&this.divHover(n)}}divHover(e){const t=e.ids;if(t instanceof Array)for(const i of t)this.singleDivHover(i,e);else this.singleDivHover(t,e)}singleDivHover(e,t){const i=this.container,o=document.getElementById(e);if(!o)return;const s=i.retina.pixelRatio,b={x:(o.offsetLeft+o.offsetWidth/2)*s,y:(o.offsetTop+o.offsetHeight/2)*s},l=o.offsetWidth/2*s,n=t.type===Enums_1.DivType.circle?new Utils_1.Circle(b.x,b.y,l):new Utils_1.Rectangle(o.offsetLeft*s,o.offsetTop*s,o.offsetWidth*s,o.offsetHeight*s),r=i.particles.quadTree.query(n);for(const e of r.filter(e=>n.contains(e.getPosition())))e.bubble.inRange=!0,this.hoverBubbleSize(e,1),this.hoverBubbleOpacity(e,1),this.hoverBubbleColor(e)}process(e,t,i,o){const s=this.container,b=o.bubbleObj.optValue;if(void 0===b)return;const l=s.options.interactivity.modes.bubble.duration,n=s.retina.bubbleModeDistance,r=o.particlesObj.optValue,u=o.bubbleObj.value,a=o.particlesObj.value||0,c=o.type;if(b!==r)if(s.bubble.durationEnd)u&&(c===Enums_1.ProcessBubbleType.size&&delete e.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete e.bubble.opacity);else if(t<=n){if((null!=u?u:a)!==b){const t=a-i*(a-b)/l;c===Enums_1.ProcessBubbleType.size&&(e.bubble.radius=t),c===Enums_1.ProcessBubbleType.opacity&&(e.bubble.opacity=t)}}else c===Enums_1.ProcessBubbleType.size&&delete e.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete e.bubble.opacity}clickBubble(){var e;const t=this.container,i=t.options,o=t.interactivity.mouse.clickPosition;if(void 0===o)return;const s=t.retina.bubbleModeDistance,b=t.particles.quadTree.query(new Utils_1.Circle(o.x,o.y,s));for(const s of b){s.bubble.inRange=!0;const b=s.getPosition(),l=Utils_1.Utils.getDistance(b,o),n=((new Date).getTime()-(t.interactivity.mouse.clickTime||0))/1e3;if(t.bubble.clicking){n>i.interactivity.modes.bubble.duration&&(t.bubble.durationEnd=!0),n>2*i.interactivity.modes.bubble.duration&&(t.bubble.clicking=!1,t.bubble.durationEnd=!1);const o={bubbleObj:{optValue:t.retina.bubbleModeSize,value:s.bubble.radius},particlesObj:{optValue:null!==(e=s.sizeValue)&&void 0!==e?e:t.retina.sizeValue,value:s.size.value},type:Enums_1.ProcessBubbleType.size};this.process(s,l,n,o);const b={bubbleObj:{optValue:i.interactivity.modes.bubble.opacity,value:s.bubble.opacity},particlesObj:{optValue:s.particlesOptions.opacity.value,value:s.opacity.value},type:Enums_1.ProcessBubbleType.opacity};this.process(s,l,n,b),t.bubble.durationEnd?delete s.bubble.color:l<=t.retina.bubbleModeDistance?this.hoverBubbleColor(s):delete s.bubble.color}}}hoverBubble(){const e=this.container,t=e.interactivity.mouse.position;if(void 0===t)return;const i=e.retina.bubbleModeDistance,o=e.particles.quadTree.query(new Utils_1.Circle(t.x,t.y,i));for(const i of o){i.bubble.inRange=!0;const o=i.getPosition(),s=Utils_1.Utils.getDistance(o,t),b=1-s/e.retina.bubbleModeDistance;s<=e.retina.bubbleModeDistance?b>=0&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(i,b),this.hoverBubbleOpacity(i,b),this.hoverBubbleColor(i)):this.reset(i),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(i)}}hoverBubbleSize(e,t){var i;const o=this.container,s=o.retina.bubbleModeSize;if(void 0===s)return;const b=null!==(i=e.sizeValue)&&void 0!==i?i:o.retina.sizeValue,l=e.size.value,n=Bubbler.calculateBubbleValue(l,s,b,t);void 0!==n&&(e.bubble.radius=n)}hoverBubbleOpacity(e,t){const i=this.container.options.interactivity.modes.bubble.opacity;if(void 0===i)return;const o=e.particlesOptions.opacity.value,s=e.opacity.value,b=Bubbler.calculateBubbleValue(s,i,o,t);void 0!==b&&(e.bubble.opacity=b)}hoverBubbleColor(e){const t=this.container.options;if(void 0===e.bubble.color){const i=t.interactivity.modes.bubble.color;if(void 0===i)return;const o=i instanceof Array?Utils_1.Utils.itemFromArray(i):i;e.bubble.color=Utils_1.ColorUtils.colorToHsl(o)}}}exports.Bubbler=Bubbler;