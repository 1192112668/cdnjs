"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;var ProcessBubbleType_1=require("../../../../Enums/ProcessBubbleType"),Utils_1=require("../../../../Utils"),HoverMode_1=require("../../../../Enums/Modes/HoverMode"),ClickMode_1=require("../../../../Enums/Modes/ClickMode"),Bubbler=function(){function e(){}return e.reset=function(e){delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color},e.bubble=function(e,b){var i=e.options.interactivity.events,t=i.onHover,l=i.onClick,o=t.enable,u=t.mode,s=l.enable,r=l.mode;o&&Utils_1.Utils.isInArray(HoverMode_1.HoverMode.bubble,u)?this.hoverBubble(e):s&&Utils_1.Utils.isInArray(ClickMode_1.ClickMode.bubble,r)&&this.clickBubble(e)},e.process=function(e,b,i,t,l){var o,u,s,r,a,c,n,v=l.bubbleObj.optValue;void 0!==v&&(o=e.options.interactivity.modes.bubble.duration,u=e.retina.bubbleModeDistance,s=l.particlesObj.optValue,r=l.bubbleObj.value,a=l.particlesObj.value||0,c=l.type,v!==s&&(e.bubble.durationEnd?r&&(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete b.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete b.bubble.opacity):i<=u?(null!=r?r:a)!==v&&(n=a-t*(a-v)/o,c===ProcessBubbleType_1.ProcessBubbleType.size&&(b.bubble.radius=n),c===ProcessBubbleType_1.ProcessBubbleType.opacity&&(b.bubble.opacity=n)):(c===ProcessBubbleType_1.ProcessBubbleType.size&&delete b.bubble.radius,c===ProcessBubbleType_1.ProcessBubbleType.opacity&&delete b.bubble.opacity)))},e.clickBubble=function(e){var b,i=e.options,t=e.interactivity.mouse.clickPosition;if(void 0!==t)for(var l=e.retina.bubbleModeDistance,o=0,u=e.particles.quadTree.query(new Utils_1.Circle(t.x,t.y,l));o<u.length;o++){var s,r,a=u[o],c=a.getPosition(),n=Utils_1.Utils.getDistance(c,t),v=((new Date).getTime()-(e.interactivity.mouse.clickTime||0))/1e3;e.bubble.clicking&&(v>i.interactivity.modes.bubble.duration&&(e.bubble.durationEnd=!0),v>2*i.interactivity.modes.bubble.duration&&(e.bubble.clicking=!1,e.bubble.durationEnd=!1),s={bubbleObj:{optValue:e.retina.bubbleModeSize,value:a.bubble.radius},particlesObj:{optValue:null!==(b=a.sizeValue)&&void 0!==b?b:e.retina.sizeValue,value:a.size.value},type:ProcessBubbleType_1.ProcessBubbleType.size},this.process(e,a,n,v,s),r={bubbleObj:{optValue:i.interactivity.modes.bubble.opacity,value:a.bubble.opacity},particlesObj:{optValue:a.particlesOptions.opacity.value,value:a.opacity.value},type:ProcessBubbleType_1.ProcessBubbleType.opacity},this.process(e,a,n,v,r),!e.bubble.durationEnd&&n<=e.retina.bubbleModeDistance?this.hoverBubbleColor(e,a):delete a.bubble.color)}},e.hoverBubble=function(e){var b=e.interactivity.mouse.position;if(void 0!==b)for(var i=e.retina.bubbleModeDistance,t=0,l=e.particles.quadTree.query(new Utils_1.Circle(b.x,b.y,i));t<l.length;t++){var o=l[t],u=o.getPosition(),s=Utils_1.Utils.getDistance(u,b),r=1-s/e.retina.bubbleModeDistance;s<=e.retina.bubbleModeDistance?0<=r&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(e,o,r),this.hoverBubbleOpacity(e,o,r),this.hoverBubbleColor(e,o)):this.reset(o),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(o)}},e.hoverBubbleSize=function(e,b,i){var t,l,o,u,s=e.retina.bubbleModeSize;void 0!==s&&(l=null!==(t=b.sizeValue)&&void 0!==t?t:e.retina.sizeValue,o=b.size.value,void 0!==(u=this.calculateBubbleValue(o,s,l,i))&&(b.bubble.radius=u))},e.hoverBubbleOpacity=function(e,b,i){var t,l,o,u=e.options.interactivity.modes.bubble.opacity;void 0!==u&&(t=b.particlesOptions.opacity.value,l=b.opacity.value,void 0!==(o=this.calculateBubbleValue(l,u,t,i))&&(b.bubble.opacity=o))},e.calculateBubbleValue=function(e,b,i,t){if(i<b){var l=e+(b-i)*t;return Utils_1.Utils.clamp(l,e,b)}if(b<i){l=e-(i-b)*t;return Utils_1.Utils.clamp(l,b,e)}},e.hoverBubbleColor=function(e,b){var i=e.options;if(void 0===b.bubble.color){var t=i.interactivity.modes.bubble.color;if(void 0===t)return;var l=t instanceof Array?Utils_1.Utils.itemFromArray(t):t;b.bubble.color=Utils_1.ColorUtils.colorToRgb(l)}},e}();exports.Bubbler=Bubbler;