"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Collider=void 0;var Utils_1=require("../../../../Utils"),CollisionMode_1=require("../../../../Enums/CollisionMode"),Collider=function(){function i(){}return i.collide=function(i,o,t){for(var e=i.getPosition(),l=0,r=o.particles.quadTree.query(new Utils_1.Circle(e.x,e.y,2*i.size.value));l<r.length;l++){var a,s,n,c=r[l];i!==c&&c.particlesOptions.collisions.enable&&i.particlesOptions.collisions.mode===c.particlesOptions.collisions.mode&&(a=c.getPosition(),s=Utils_1.Utils.getDistance(e,a),n=o.retina.sizeValue,s<=this.getRadius(i,n)+this.getRadius(c,n)&&this.resolveCollision(i,c))}},i.getRadius=function(i,o){return i.bubble.radius||i.size.value||o},i.resolveCollision=function(i,o){var t=i.getPosition(),e=o.getPosition();switch(i.particlesOptions.collisions.mode){case CollisionMode_1.CollisionMode.bounce:var l,r,a,s,n,c,v,h,u,d=i.velocity.horizontal-o.velocity.horizontal,z=i.velocity.vertical-o.velocity.vertical;0<=d*(e.x-t.x)+z*(e.y-t.y)&&(l=-Math.atan2(e.y-t.y,e.x-t.x),r=i.size.value,a=o.size.value,s=this.rotate(i.velocity,l),n=this.rotate(o.velocity,l),c={horizontal:s.horizontal*(r-a)/(r+a)+2*n.horizontal*a/(r+a),vertical:s.vertical},v={horizontal:n.horizontal*(r-a)/(r+a)+2*s.horizontal*a/(r+a),vertical:n.vertical},h=this.rotate(c,-l),u=this.rotate(v,-l),i.velocity.horizontal=h.horizontal,i.velocity.vertical=h.vertical,o.velocity.horizontal=u.horizontal,o.velocity.vertical=u.vertical)}},i.rotate=function(i,o){return{horizontal:i.horizontal*Math.cos(o)-i.vertical*Math.sin(o),vertical:i.horizontal*Math.sin(o)+i.vertical*Math.cos(o)}},i}();exports.Collider=Collider;