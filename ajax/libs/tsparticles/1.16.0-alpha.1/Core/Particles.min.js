"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Particles=void 0;var Particle_1=require("./Particle"),InteractionManager_1=require("./Particle/Interactions/Particles/InteractionManager"),Grabber_1=require("./Particle/Interactions/Mouse/Grabber"),Enums_1=require("../Enums"),Repulser_1=require("./Particle/Interactions/Mouse/Repulser"),Bubbler_1=require("./Particle/Interactions/Mouse/Bubbler"),Connector_1=require("./Particle/Interactions/Mouse/Connector"),Utils_1=require("../Utils"),Particles=function(){function e(e){this.container=e,this.array=[],this.interactionsEnabled=!1;var t=this.container.canvas.size;this.noiseZ=0,this.linksColors={},this.quadTree=new Utils_1.QuadTree(new Utils_1.Rectangle(0,0,t.width,t.height),4)}return Object.defineProperty(e.prototype,"count",{get:function(){return this.array.length},enumerable:!1,configurable:!0}),e.prototype.init=function(){var e=this.container,t=e.options,i=!1;for(var r in this.noiseZ=0,e.plugins){var n=e.plugins[r];if(void 0!==n.particlesInitialization&&(i=n.particlesInitialization()),i)break}if(!i)for(var a=this.count;a<t.particles.number.value;a++)this.addParticle();if(this.interactionsEnabled=t.particles.links.enable||t.particles.move.attract.enable||t.particles.collisions.enable||t.infection.enable,t.infection.enable)for(a=0;a<t.infection.infections;a++){var s=this.array.filter(function(e){return void 0===e.infectionStage});Utils_1.Utils.itemFromArray(s).startInfection(0)}},e.prototype.redraw=function(){this.clear(),this.init(),this.draw(0)},e.prototype.removeAt=function(e,t){if(0<=e&&e<=this.count)for(var i=0,r=this.array.splice(e,null!=t?t:1);i<r.length;i++){r[i].destroy()}},e.prototype.remove=function(e){this.removeAt(this.array.indexOf(e))},e.prototype.update=function(e){for(var t=this.container,i=[],r=0;r<this.count;r++){var n,a=this.array[r];for(var s in a.bubble.inRange=!1,t.plugins){var o=t.plugins[s];if(a.destroyed)break;o.particleUpdate&&o.particleUpdate(a,e)}if(!a.destroyed){var l=a.particlesOptions.size,c=l.animation;if(c.enable)switch(c.destroy){case Enums_1.DestroyType.max:a.size.value>=l.value*t.retina.pixelRatio&&(a.destroyed=!0);break;case Enums_1.DestroyType.min:a.size.value<=c.minimumValue*t.retina.pixelRatio&&(a.destroyed=!0)}}a.destroyed?i.push(a):(a.update(r,e),n=a.getPosition(),this.quadTree.insert(new Utils_1.Point(n,a)))}for(var u=0,p=i;u<p.length;u++){a=p[u];this.remove(a)}var d,v,h,b,y,f,_=t.interactivity.mouse,m=t.options.interactivity.events,U=t.options.interactivity.events.onDiv;b=U instanceof Array?(v=0<(d=U.filter(function(e){return e.enable}).map(function(e){return e.mode})).length,h=void 0!==d.find(function(e){return Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,e)}),void 0!==d.find(function(e){return Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,e)})):(v=U.enable,h=Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,U.mode),Utils_1.Utils.isInArray(Enums_1.DivMode.bubble,U.mode)),(v||m.onHover.enable&&_.position||m.onClick.enable&&_.clickPosition)&&(y=m.onHover.mode,f=m.onClick.mode,Utils_1.Utils.isInArray(Enums_1.HoverMode.grab,y)&&Grabber_1.Grabber.grab(t,e),(Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,y)||Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,f)||h)&&Repulser_1.Repulser.repulse(t,e),(Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,y)||Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,f)||b)&&Bubbler_1.Bubbler.bubble(t,e),Utils_1.Utils.isInArray(Enums_1.HoverMode.connect,y)&&Connector_1.Connector.connect(t,e));for(var g=0,P=this.array;g<P.length;g++){a=P[g];Bubbler_1.Bubbler.reset(a),this.interactionsEnabled&&InteractionManager_1.InteractionManager.interact(a,t,e)}},e.prototype.draw=function(e){var t=this.container;t.canvas.clear();var i=this.container.canvas.size;for(var r in this.quadTree=new Utils_1.QuadTree(new Utils_1.Rectangle(0,0,i.width,i.height),4),this.update(e),this.noiseZ+=4e-4,t.plugins){var n=t.plugins[r];t.canvas.drawPlugin(n,e)}for(var a=0,s=this.array;a<s.length;a++){s[a].draw(e)}},e.prototype.clear=function(){this.array=[]},e.prototype.push=function(e,t){var i,r,n,a=this.container,s=a.options,o=s.particles.number.limit*a.density;this.pushing=!0,0<o&&(0<(r=this.count+e-o)&&this.removeQuantity(r)),t&&(n=null!==(i=t.position)&&void 0!==i?i:{x:0,y:0});for(var l=0;l<e;l++)this.addParticle(n);s.particles.move.enable||this.container.play(),this.pushing=!1},e.prototype.addParticle=function(e,t){var i=new Particle_1.Particle(this.container,e,t);return this.array.push(i),i},e.prototype.removeQuantity=function(e){var t=this.container.options;this.removeAt(0,e),t.particles.move.enable||this.container.play()},e}();exports.Particles=Particles;