"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;const Enums_1=require("../../../../Enums"),Utils_1=require("../../../../Utils");class Repulser{static repulse(e,s){const t=e.options,i=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,o=t.interactivity.events,n=o.onHover.enable,l=o.onHover.mode,c=o.onClick.enable,r=o.onClick.mode,u=o.onDiv;if(i&&n&&Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,l))this.hoverRepulse(e);else if(c&&Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,r))this.clickRepulse(e);else if(u instanceof Array)for(const s of u){const t=s.mode;s.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,t)&&this.divRepulse(e,s)}else{const s=u.mode;u.enable&&Utils_1.Utils.isInArray(Enums_1.DivMode.repulse,s)&&this.divRepulse(e,u)}}static divRepulse(e,s){const t=s.ids;if(t instanceof Array)for(const i of t)this.singleDivRepulse(e,i,s);else this.singleDivRepulse(e,t,s)}static singleDivRepulse(e,s,t){const i=document.getElementById(s);if(!i)return;const o=e.retina.pixelRatio,n={x:(i.offsetLeft+i.offsetWidth/2)*o,y:(i.offsetTop+i.offsetHeight/2)*o},l=i.offsetWidth/2*o,c=t.type===Enums_1.DivType.circle?new Utils_1.Circle(n.x,n.y,l):new Utils_1.Rectangle(i.offsetLeft*o,i.offsetTop*o,i.offsetWidth*o,i.offsetHeight*o);this.processRepulse(e,n,l,c)}static hoverRepulse(e){const s=e.interactivity.mouse.position;if(!s)return;const t=e.retina.repulseModeDistance;this.processRepulse(e,s,t,new Utils_1.Circle(s.x,s.y,t))}static processRepulse(e,s,t,i){const o=e.particles.quadTree.query(i);for(const i of o){const{dx:o,dy:n,distance:l}=Utils_1.Utils.getDistances(i.position,s),c={x:o/l,y:n/l},r=100*e.options.interactivity.modes.repulse.speed,u=Utils_1.Utils.clamp((1-Math.pow(l/t,2))*r,0,50),a=i.particlesOptions.move.outMode,p=i.size.value,v={x:i.position.x+c.x*u,y:i.position.y+c.y*u};if(a===Enums_1.OutMode.bounce||a===Enums_1.OutMode.bounceVertical||a===Enums_1.OutMode.bounceHorizontal){const s={horizontal:v.x-p>0&&v.x+p<e.canvas.size.width,vertical:v.y-p>0&&v.y+p<e.canvas.size.height};(a===Enums_1.OutMode.bounceVertical||s.horizontal)&&(i.position.x=v.x),(a===Enums_1.OutMode.bounceHorizontal||s.vertical)&&(i.position.y=v.y)}else i.position.x=v.x,i.position.y=v.y}}static clickRepulse(e){if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){const s=e.retina.repulseModeDistance,t=Math.pow(s/6,3),i=e.interactivity.mouse.clickPosition;if(void 0===i)return;const o=new Utils_1.Circle(i.x,i.y,t),n=e.particles.quadTree.query(o);for(const s of n){const{dx:o,dy:n,distance:l}=Utils_1.Utils.getDistances(i,s.position),c=l*l,r=e.options.interactivity.modes.repulse.speed,u=-t*r/c;c<=t&&(e.repulse.particles.push(s),this.processClickRepulse(e,s,o,n,u))}}else if(!1===e.repulse.clicking){for(const s of e.repulse.particles)s.velocity.horizontal=s.initialVelocity.horizontal,s.velocity.vertical=s.initialVelocity.vertical;e.repulse.particles=[]}}static processClickRepulse(e,s,t,i,o){const n=e.options,l=Math.atan2(i,t);s.velocity.horizontal=o*Math.cos(l),s.velocity.vertical=o*Math.sin(l);const c=n.particles.move.outMode;if(c===Enums_1.OutMode.bounce||c===Enums_1.OutMode.bounceHorizontal||c===Enums_1.OutMode.bounceVertical){const t={x:s.position.x+s.velocity.horizontal,y:s.position.y+s.velocity.vertical};c!==Enums_1.OutMode.bounceVertical&&(t.x+s.size.value>e.canvas.size.width||t.x-s.size.value<0)&&(s.velocity.horizontal*=-1),c!==Enums_1.OutMode.bounceHorizontal&&(t.y+s.size.value>e.canvas.size.height||t.y-s.size.value<0)&&(s.velocity.vertical*=-1)}}}exports.Repulser=Repulser;