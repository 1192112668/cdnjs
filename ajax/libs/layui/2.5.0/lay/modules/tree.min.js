layui.define("form",function(e){"use strict";function a(e){var i=this;i.index=++n.index,i.config=x.extend({},i.config,n.config,e),i.render()}var x=layui.$,b=layui.form,n={config:{},index:layui.atree?layui.atree.index+1e4:0,set:function(e){var i=this;return i.config=x.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,l,e,i)}},l="tree",w="layui-tree-set",T="layui-tree-iconClick",L="layui-icon-addition",q="layui-icon-subtraction",A="layui-tree-entry",d="layui-tree-main",S="layui-tree-pack",H="layui-tree-spread",E="layui-tree-setLineShort",I="layui-tree-showLine",j="layui-tree-lineExtend";a.prototype.config={data:[],showCheckbox:!1,showLine:!0,key:"id",checked:[],spread:[],accordion:!1,expandClick:!0,isJump:!1,renderContent:!1,showSearch:!1,draggable:!1,emptyText:"暂无数据"},a.prototype.render=function(){var e=this,i=e.config,a=x('<div class="layui-tree'+(i.showCheckbox?" layui-form":"")+(i.showLine?" layui-tree-line":"")+'"></div>');e.tree(a);var n=x(i.elem),l=n.next(".layui-tree");return l[0]&&l.remove(),i.showSearch&&a.prepend('<input type="text" class="layui-input layui-tree-search" placeholder="请输入关键字进行过滤">'),e.elem=a,e.emptyText=x('<div class="layui-tree-emptyText">'+i.emptyText+"</div>"),n.html(e.elem),0==e.elem.find(".layui-tree-set").length?void e.elem.append(e.emptyText):(i.draggable&&e.drag(),i.showCheckbox&&b.render("checkbox"),e.elem.find(".layui-tree-set").each(function(){x(this).parent(".layui-tree-pack")[0]||x(this).addClass("layui-tree-setHide"),!x(this).next()[0]&&x(this).parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&x(this).addClass(E),x(this).next()[0]||x(this).parents(".layui-tree-set").eq(0).next()[0]||x(this).addClass(E)}),void e.events())},a.prototype.tree=function(s,e){var d=this,c=d.config,i=e||c.data;layui.each(i,function(e,i){function a(e){return 0!=c.spread.length&&-1!=x.inArray(e,c.spread)}var n,l=i.children&&0<i.children.length,r=x('<div class="layui-tree-pack" style="'+(a(i[c.key])?"display: block;":"")+'"></div>'),t=x(["<div "+(c.key?'data-key="'+(i[c.key]||"")+'"':"")+' class="layui-tree-set'+(a(i[c.key])?" layui-tree-spread":"")+(n=i[c.key],0!=c.checked.length&&-1!=x.inArray(n,c.checked)?" layui-tree-checkedFirst":"")+'">',"<div "+(c.draggable&&!i.fixed?'draggable="true"':"")+' class="layui-tree-entry">','<div class="layui-tree-main layui-inline">',c.showLine?l?'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(a(i[c.key])?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(l?"":"hide")+'"></i></span>',c.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(i.disabled?"disabled":"")+">":"",c.isJump&&i.href?'<a href="'+i.href+'" target="_blank" class="layui-tree-txt">'+(i.label||"未命名")+"</a>":'<span class="layui-tree-txt">'+(i.label||"未命名")+"</span>","</div>",c.renderContent?['<div class="layui-btn-group layui-tree-btnGroup">','<i class="layui-icon layui-icon-add-1"  data-type="add"></i>','<i class="layui-icon layui-icon-edit" data-type="edit"></i>','<i class="layui-icon layui-icon-delete" data-type="del"></i>',"</div>"].join(""):"","</div></div>"].join(""));l&&(t.append(r),d.tree(r,i.children)),s.append(t),t.prev("."+w)[0]&&t.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),l||t.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),d.spread(t,i),c.showCheckbox&&d.checkClick(t,i),c.renderContent&&d.operate(t,i)})},a.prototype.spread=function(l,r){var t=this.config,e=l.children("."+A),s=t.expandClick?e.children("."+d):e.find("."+T);s.on("click",function(){var e,i=l.children("."+S),a=s.children(".layui-icon")[0]?s.children(".layui-icon"):s.find(".layui-tree-icon").children(".layui-icon"),n="";i[0]?l.hasClass(H)?(l.removeClass(H),i.slideUp(200),a.removeClass(q).addClass(L),n="close"):(l.addClass(H),i.slideDown(200),a.addClass(q).removeClass(L),n="open",t.accordion&&((e=l.siblings("."+w)).removeClass(H),e.children("."+S).slideUp(200),e.find(".layui-tree-icon").children(".layui-icon").removeClass(q).addClass(L))):n="normal",t.click&&t.click({elem:l,state:n,data:r})})},a.prototype.checkClick=function(i,n){var l=this.config,e=i.children("."+A).children("."+d),r=!1;e.on("click",'input[name="layuiTreeCheck"]+',function(e){layui.stope(e);var a=x(this).prev()[0].checked;x(this).prev()[0].disabled||("object"!=typeof n.children&&!i.find("."+S)[0]||(i.find("."+S).find('input[name="layuiTreeCheck"]').each(function(e,i){i.disabled||(i.checked=a)}),r=!0),a?function e(i){var a,n,l;i.parents("."+w)[0]&&(a=i.siblings().children("."+A),n=i.parent("."+S),l=1,a[0]&&a.each(function(e,i){var a=x(i).find('input[name="layuiTreeCheck"]')[0];0!=a.checked||a.disabled||(l=0)}),1==l&&(n.prev().find('input[name="layuiTreeCheck"]')[0].checked=!0,e(n.parent("."+w))))}(i):i.parents("."+S).prev().each(function(e,i){x(i).find('input[name="layuiTreeCheck"]')[0].checked=!1}),l.oncheck&&l.oncheck({elem:i,checked:a,data:n,hasChild:r}),b.render("checkbox"))})},a.prototype.operate=function(y,f){var C=this,v=C.config,e=y.children("."+A),m=e.children("."+d);e.children(".layui-tree-btnGroup").on("click",".layui-icon",function(e){layui.stope(e);var t,i,a,n=x(this).data("type"),l=y.children("."+S),r={data:f,type:n,elem:y};if("add"==n){l[0]||(v.showLine?(m.find("."+T).addClass("layui-tree-icon"),m.find("."+T).children(".layui-icon").addClass(L).removeClass("layui-icon-file")):m.find(".layui-tree-iconArrow").removeClass("hide"),y.append('<div class="layui-tree-pack"></div>'));var s,d,c,h=v.operate&&v.operate(r),o={label:"newElemTree"};if(o[v.key]=h,C.tree(y.children("."+S),[o]),v.showLine&&(l[0]?(l.hasClass(j)||l.addClass(j),y.find("."+S).each(function(){x(this).children("."+w).last().addClass(E)}),l.children("."+w).last().prev().hasClass(E)?l.children("."+w).last().prev().removeClass(E):l.children("."+w).last().removeClass(E),!y.parent("."+S)[0]&&y.next()[0]&&l.children("."+w).last().removeClass(E)):(s=y.siblings("."+w),d=1,c=y.parent("."+S),layui.each(s,function(e,i){x(i).children("."+S)[0]||(d=0)}),1==d?(s.children("."+S).addClass(I),s.children("."+S).children("."+w).removeClass(E),y.children("."+S).addClass(I),c.removeClass(j),c.children("."+w).last().children("."+S).children("."+w).last().addClass(E)):y.children("."+S).children("."+w).addClass(E))),!v.showCheckbox)return;m.find('input[name="layuiTreeCheck"]')[0].checked&&(y.children("."+S).children("."+w).last().find('input[name="layuiTreeCheck"]')[0].checked=!0),b.render("checkbox")}else if("edit"==n){var u=m.children(".layui-tree-txt").html();m.children(".layui-tree-txt").html(""),m.append('<input type="text" class="layui-inline layui-tree-editInput">'),m.children(".layui-tree-editInput").val(u).focus();var p=function(e){var i=(i=e.val().trim())||"未命名";e.remove(),m.children(".layui-tree-txt").html(i),r.data.label=i,v.operate&&v.operate(r)};m.children(".layui-tree-editInput").blur(function(){p(x(this))}),m.children(".layui-tree-editInput").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),p(x(this)))})}else{if(v.operate&&v.operate(r),r.status="remove",!y.prev("."+w)[0]&&!y.next("."+w)[0]&&!y.parent("."+S)[0])return y.remove(),void C.elem.append(C.emptyText);y.siblings("."+w).children("."+A)[0]?(v.showCheckbox&&(t=function(e){var i,a,n,l,r;e.parents("."+w)[0]&&(i=e.siblings("."+w).children("."+A),n=(a=e.parent("."+S).prev()).find('input[name="layuiTreeCheck"]')[0],l=1,(r=0)==n.checked&&(i.each(function(e,i){var a=x(i).find('input[name="layuiTreeCheck"]')[0];0!=a.checked||a.disabled||(l=0),a.disabled||(r=1)}),1==l&&1==r&&(n.checked=!0,b.render("checkbox"),t(a.parent("."+w)))))})(y),v.showLine&&(s=y.siblings("."+w),d=1,c=y.parent("."+S),layui.each(s,function(e,i){x(i).children("."+S)[0]||(d=0)}),1==d?(l[0]||(c.removeClass(j),s.children("."+S).addClass(I),s.children("."+S).children("."+w).removeClass(E)),y.next()[0]?c.children("."+w).last().children("."+S).children("."+w).last().addClass(E):y.prev().children("."+S).children("."+w).last().addClass(E),y.next()[0]||y.parents("."+w)[1]||y.parents("."+w).eq(0).next()[0]||y.prev("."+w).addClass(E)):!y.next()[0]&&y.hasClass(E)&&y.prev().addClass(E))):(i=y.parent("."+S).prev(),v.showLine?(i.find("."+T).removeClass("layui-tree-icon"),i.find("."+T).children(".layui-icon").removeClass(q).addClass("layui-icon-file"),(a=i.parents("."+S).eq(0)).addClass(j),a.children("."+w).each(function(){x(this).children("."+S).children("."+w).last().addClass(E)})):i.find(".layui-tree-iconArrow").addClass("hide"),y.parents("."+w).eq(0).removeClass(H),y.parent("."+S).remove()),y.remove()}})},a.prototype.drag=function(){var k=this,g=k.config;k.elem.on("dragstart","."+A,function(){var e=x(this).parent("."+w),i=e.parents("."+w)[0]?e.parents("."+w).eq(0):"未找到父节点";g.dragstart&&g.dragstart(e,i)}),k.elem.on("dragend","."+A,function(e){var d,c,i,h,o,u,p=(e=e||event).clientY,y=x(this).parent("."+w),f=y.height(),C=y.offset().top,a=k.elem.find("."+w),v=k.elem.height()+k.elem.offset().top-13,n=y.parents("."+w)[0],l=y.next()[0];n&&(d=y.parent("."+S),c=y.parents("."+w).eq(0),i=c.parent("."+S),h=c.offset().top,o=y.siblings(),u=c.children("."+S).children("."+w).length);function m(t){var a,s;n||l||k.elem.children("."+w).last().children("."+S).children("."+w).last().addClass(E),n?1==u?(g.showLine?(t.find("."+T).removeClass("layui-tree-icon"),t.find("."+T).children(".layui-icon").removeClass(q).addClass("layui-icon-file"),i.addClass(j),i.children("."+w).children("."+S).each(function(){x(this).children("."+w).last().addClass(E)})):t.find(".layui-tree-iconArrow").addClass("hide"),t.children("."+S).remove(),t.removeClass(H)):(g.showLine&&(a=1,layui.each(o,function(e,i){x(i).children("."+S)[0]||(a=0)}),1==a?(y.children("."+S)[0]||(d.removeClass(j),o.children("."+S).addClass(I),o.children("."+S).children("."+w).removeClass(E)),d.children("."+w).last().children("."+S).children("."+w).last().addClass(E),l||t.parents("."+w)[0]||t.next()[0]||d.children("."+w).last().addClass(E)):!l&&y.hasClass(E)&&d.children("."+w).last().addClass(E)),g.showCheckbox&&(s=function(e){if(e){if(!e.parents("."+w)[0])return}else if(!t[0])return;var i=e?e.siblings().children("."+A):o.children("."+A),a=e?e.parent("."+S).prev():d.prev(),n=a.find('input[name="layuiTreeCheck"]')[0],l=1,r=0;0==n.checked&&(i.each(function(e,i){var a=x(i).find('input[name="layuiTreeCheck"]')[0];0!=a.checked||a.disabled||(l=0),a.disabled||(r=1)}),1==l&&1==r&&(n.checked=!0,b.render("checkbox"),s(a.parent("."+w)||t)))})()):y.removeClass("layui-tree-setHide")}a.each(function(){if(0!=x(this).height()){if(C<p&&p<C+f)return void(g.dragend&&g.dragend("拖拽失败，拖拽在节点本身进行！"));if(1==u&&h<p&&p<C+f)return void(g.dragend&&g.dragend("拖拽失败，拖拽在节点本身进行！"));var e,i,a,n,l,r,t,s=x(this).offset().top;if(s<p&&p<s+15)return x(this).children("."+S)[0]||(g.showLine?(x(this).find("."+T).eq(0).addClass("layui-tree-icon"),x(this).find("."+T).eq(0).children(".layui-icon").addClass(L).removeClass("layui-icon-file")):x(this).find(".layui-tree-iconArrow").removeClass("hide"),x(this).append('<div class="layui-tree-pack"></div>')),x(this).children("."+S).append(y),m(c),g.showLine&&(e=x(this).children("."+S).children("."+w),y.children("."+S).children("."+w).last().addClass(E),1==e.length?(r=x(this).siblings("."+w),t=1,i=x(this).parent("."+S),layui.each(r,function(e,i){x(i).children("."+S)[0]||(t=0)}),1==t?(r.children("."+S).addClass(I),r.children("."+S).children("."+w).removeClass(E),x(this).children("."+S).addClass(I),i.removeClass(j),i.children("."+w).last().children("."+S).children("."+w).last().addClass(E).removeClass("layui-tree-setHide")):x(this).children("."+S).children("."+w).addClass(E).removeClass("layui-tree-setHide")):(y.prev("."+w).hasClass(E)?(y.prev("."+w).removeClass(E),y.addClass(E)):(y.removeClass("layui-tree-setLineShort layui-tree-setHide"),y.children("."+S)[0]?y.prev("."+w).children("."+S).children("."+w).last().removeClass(E):y.siblings("."+w).find("."+S).each(function(){x(this).children("."+w).last().addClass(E)})),x(this).next()[0]||y.addClass(E))),g.showCheckbox&&x(this).children("."+A).find('input[name="layuiTreeCheck"]')[0].checked&&y.children("."+A).find('input[name="layuiTreeCheck"]+').click(),g.dragend&&g.dragend("拖拽成功，进入目标节点内",y,x(this)),!1;if(p<s)return x(this).before(y),m(c),g.showLine&&(a=y.children("."+S),l=(n=x(this).parents("."+w).eq(0)).children("."+S).children("."+w).last(),a[0]?(y.removeClass(E),a.children("."+w).last().removeClass(E),r=y.siblings("."+w),t=1,layui.each(r,function(e,i){x(i).children("."+S)[0]||(t=0)}),1==t?n[0]&&(r.children("."+S).addClass(I),r.children("."+S).children("."+w).removeClass(E),l.children("."+S).children("."+w).last().addClass(E).removeClass(I)):y.children("."+S).children("."+w).last().addClass(E),!n.parent("."+S)[0]&&n.next()[0]&&l.removeClass(E)):(n.hasClass(j)||n.addClass(j),n.find("."+S).each(function(){x(this).children("."+w).last().addClass(E)})),n[0]||(y.addClass("layui-tree-setHide"),y.children("."+S).children("."+w).last().removeClass(E))),n[0]&&g.showCheckbox&&n.children("."+A).find('input[name="layuiTreeCheck"]')[0].checked&&y.children("."+A).find('input[name="layuiTreeCheck"]+').click(),g.dragend&&g.dragend("拖拽成功，插入目标节点上方",y,x(this)),!1;if(v<p)return k.elem.children("."+w).last().children("."+S).addClass(I),k.elem.append(y),m(c),y.prev().children("."+S).children("."+w).last().removeClass(E),y.addClass("layui-tree-setHide"),y.children("."+S).children("."+w).last().addClass(E),g.dragend&&g.dragend("拖拽成功，插入最外层节点",y,k.elem),!1}})})},a.prototype.events=function(){var l=this,r=l.config,e=l.elem.find(".layui-tree-checkedFirst");layui.each(e,function(e,i){x(i).children("."+A).find('input[name="layuiTreeCheck"]+').trigger("click")}),l.elem.find(".layui-tree-search").on("keyup",function(){var e=x(this),a=e.val(),i=e.nextAll(),n=[];i.find(".layui-tree-txt").each(function(){var i,e=x(this).parents("."+A);-1!=x(this).html().indexOf(a)&&(n.push(x(this).parent()),(i=function(e){e.addClass("layui-tree-searchShow"),e.parent("."+S)[0]&&i(e.parent("."+S).parent("."+w))})(e.parent("."+w)))}),i.find("."+A).each(function(){var e=x(this).parent("."+w);e.hasClass("layui-tree-searchShow")||e.addClass("layui-hide")}),0==i.find(".layui-tree-searchShow").length&&l.elem.append(l.emptyText),r.onsearch&&r.onsearch({elem:n})}),l.elem.find(".layui-tree-search").on("keydown",function(){x(this).nextAll().find("."+A).each(function(){x(this).parent("."+w).removeClass("layui-tree-searchShow layui-hide")}),x(".layui-tree-emptyText")[0]&&x(".layui-tree-emptyText").remove()})},a.prototype.getCheck=function(){var i=this.config,a=[];return this.elem.find(".layui-form-checked").each(function(){var e=x(this).parents("."+w)[0];i.key?a.push([e,x(e).data("key")]):a.push(e)}),a},a.prototype.setCheck=function(l){this.config,this.elem.find("."+w).each(function(e,i){var a=x(this).data("key"),n=x(i).children("."+A).find('input[name="layuiTreeCheck"]+');if("number"==typeof l){if(a==l)return n[0].checked||n.click(),!1}else-1!=x.inArray(a,l)&&(n[0].checked||n.click())})},n.render=function(e){var i=new a(e);return function(){var i=this;return{getCheck:function(){return i.getCheck()},setCheck:function(e){return i.setCheck(e)},config:i.config}}.call(i)},e(l,n)});