layui.define("form",function(e){"use strict";function a(e){var i=this;i.index=++l.index,i.config=x.extend({},i.config,l.config,e),i.render()}var x=layui.$,i=layui.form,n="tree",l={config:{},index:layui[n]?layui[n].index+1e4:0,set:function(e){var i=this;return i.config=x.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,n,e,i)}},r=function(){var i=this,e=i.config,a=e.id||i.index;return r.that[a]=i,{config:r.config[a]=e,reload:function(e){i.reload.call(i,e)},getChecked:function(){return i.getChecked.call(i)},setChecked:function(e){return i.setChecked.call(i,e)}}},b="layui-hide",c="layui-disabled",w="layui-tree-set",T="layui-tree-iconClick",L="layui-icon-addition",N="layui-icon-subtraction",A="layui-tree-entry",o="layui-tree-main",k="layui-tree-txt",q="layui-tree-pack",F="layui-tree-spread",I="layui-tree-setLineShort",H="layui-tree-showLine",S="layui-tree-lineExtend";a.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},a.prototype.reload=function(e){var a=this;layui.each(e,function(e,i){i.constructor===Array&&delete a.config[e]}),a.config=x.extend(!0,{},a.config,e),a.render()},a.prototype.render=function(){var e=this,i=e.config,a=x('<div class="layui-tree'+(i.showCheckbox?" layui-form":"")+(i.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+e.index+'"></div>');e.tree(a);var n=i.elem=x(i.elem);if(n[0]){if(i.showSearch&&a.prepend('<input type="text" class="layui-input layui-tree-search" placeholder="请输入关键字进行过滤">'),e.key=i.id||e.index,e.elem=a,e.elemNone=x('<div class="layui-tree-emptyText">'+i.text.none+"</div>"),n.html(e.elem),0==e.elem.find(".layui-tree-set").length)return e.elem.append(e.elemNone);i.drag&&e.drag(),i.showCheckbox&&e.renderForm("checkbox"),e.elem.find(".layui-tree-set").each(function(){var e=x(this);e.parent(".layui-tree-pack")[0]||e.addClass("layui-tree-setHide"),!e.next()[0]&&e.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&e.addClass(I),e.next()[0]||e.parents(".layui-tree-set").eq(0).next()[0]||e.addClass(I)}),e.events()}},a.prototype.renderForm=function(e){i.render(e,"LAY-tree-"+this.index)},a.prototype.tree=function(r,e){var t=this,d=t.config,i=e||d.data;layui.each(i,function(e,i){var a=i.children&&0<i.children.length,n=x('<div class="layui-tree-pack" '+(i.spread?'style="display: block;"':"")+'"></div>'),l=x(['<div data-id="'+i.id+'" class="layui-tree-set'+(i.spread?" layui-tree-spread":"")+(i.checked?" layui-tree-checkedFirst":"")+'">',"<div "+(d.drag&&!i.fixed?'draggable="true"':"")+' class="layui-tree-entry">','<div class="layui-tree-main">',d.showLine?a?'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(i.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(a?"":b)+'"></i></span>',d.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(i.disabled?"disabled":"")+'  value="'+i.id+'">':"",d.isJump&&i.href?'<a href="'+i.href+'" target="_blank" class="'+k+'">'+(i.title||i.label||d.text.defaultNodeName)+"</a>":'<span class="'+k+(i.disabled?" "+c:"")+'">'+(i.title||i.label||d.text.defaultNodeName)+"</span>","</div>",function(){if(!d.edit)return"";var a={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},n=['<div class="layui-btn-group layui-tree-btnGroup">'];return!0===d.edit&&(d.edit=["update","del"]),"object"==typeof d.edit?(layui.each(d.edit,function(e,i){n.push(a[i]||"")}),n.join("")+"</div>"):void 0}(),"</div></div>"].join(""));a&&(l.append(n),t.tree(n,i.children)),r.append(l),l.prev("."+w)[0]&&l.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),a||l.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),t.spread(l,i),d.showCheckbox&&t.checkClick(l,i),d.edit&&t.operate(l,i)})},a.prototype.spread=function(l,e){var r=this.config,i=l.children("."+A),a=i.children("."+o),n=i.find("."+T),t=i.find("."+k),d=r.onlyIconControl?n:a,s="";d.on("click",function(e){var i,a=l.children("."+q),n=d.children(".layui-icon")[0]?d.children(".layui-icon"):d.find(".layui-tree-icon").children(".layui-icon");a[0]?l.hasClass(F)?(l.removeClass(F),a.slideUp(200),n.removeClass(N).addClass(L)):(l.addClass(F),a.slideDown(200),n.addClass(N).removeClass(L),r.accordion&&((i=l.siblings("."+w)).removeClass(F),i.children("."+q).slideUp(200),i.find(".layui-tree-icon").children(".layui-icon").removeClass(N).addClass(L))):s="normal"}),t.on("click",function(){x(this).hasClass(c)||(s=l.hasClass(F)?r.onlyIconControl?"open":"close":r.onlyIconControl?"close":"open",r.click&&r.click({elem:l,state:s,data:e}))})},a.prototype.setCheckbox=function(e,i,a){var r=(this.config,a.prop("checked"));"object"!=typeof i.children&&!e.find("."+q)[0]||e.find("."+q).find('input[name="layuiTreeCheck"]').each(function(){this.disabled||(this.checked=r)});var t=function(e){var i,a,n,l;e.parents("."+w)[0]&&(n=(a=e.parent("."+q)).parent(),l=a.prev().find('input[name="layuiTreeCheck"]'),r?l.prop("checked",r):(a.find('input[name="layuiTreeCheck"]').each(function(){this.checked&&(i=!0)}),i||l.prop("checked",!1)),t(n))};t(e),this.renderForm("checkbox")},a.prototype.checkClick=function(n,l){var r=this,t=r.config;n.children("."+A).children("."+o).on("click",'input[name="layuiTreeCheck"]+',function(e){layui.stope(e);var i=x(this).prev(),a=i.prop("checked");i.prop("disabled")||(r.setCheckbox(n,l,i),t.oncheck&&t.oncheck({elem:n,checked:a,data:l}))})},a.prototype.operate=function(f,y){var C=this,v=C.config,e=f.children("."+A),m=e.children("."+o);e.children(".layui-tree-btnGroup").on("click",".layui-icon",function(e){layui.stope(e);var t,i,a,n=x(this).data("type"),l=f.children("."+q),r={data:y,type:n,elem:f};if("add"==n){l[0]||(v.showLine?(m.find("."+T).addClass("layui-tree-icon"),m.find("."+T).children(".layui-icon").addClass(L).removeClass("layui-icon-file")):m.find(".layui-tree-iconArrow").removeClass(b),f.append('<div class="layui-tree-pack"></div>'));var d,s,c,o=v.operate&&v.operate(r),h={};if(h.title=v.text.defaultNodeName,h.id=o,C.tree(f.children("."+q),[h]),v.showLine&&(l[0]?(l.hasClass(S)||l.addClass(S),f.find("."+q).each(function(){x(this).children("."+w).last().addClass(I)}),l.children("."+w).last().prev().hasClass(I)?l.children("."+w).last().prev().removeClass(I):l.children("."+w).last().removeClass(I),!f.parent("."+q)[0]&&f.next()[0]&&l.children("."+w).last().removeClass(I)):(d=f.siblings("."+w),s=1,c=f.parent("."+q),layui.each(d,function(e,i){x(i).children("."+q)[0]||(s=0)}),1==s?(d.children("."+q).addClass(H),d.children("."+q).children("."+w).removeClass(I),f.children("."+q).addClass(H),c.removeClass(S),c.children("."+w).last().children("."+q).children("."+w).last().addClass(I)):f.children("."+q).children("."+w).addClass(I))),!v.showCheckbox)return;m.find('input[name="layuiTreeCheck"]')[0].checked&&(f.children("."+q).children("."+w).last().find('input[name="layuiTreeCheck"]')[0].checked=!0),C.renderForm("checkbox")}else if("update"==n){var u=m.children("."+k).html();m.children("."+k).html(""),m.append('<input type="text" class="layui-tree-editInput">'),m.children(".layui-tree-editInput").val(u).focus();var p=function(e){var i=(i=e.val().trim())||v.text.defaultNodeName;e.remove(),m.children("."+k).html(i),r.data.title=i,v.operate&&v.operate(r)};m.children(".layui-tree-editInput").blur(function(){p(x(this))}),m.children(".layui-tree-editInput").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),p(x(this)))})}else{if(v.operate&&v.operate(r),r.status="remove",!f.prev("."+w)[0]&&!f.next("."+w)[0]&&!f.parent("."+q)[0])return f.remove(),void C.elem.append(C.elemNone);f.siblings("."+w).children("."+A)[0]?(v.showCheckbox&&(t=function(e){var i,a,n,l,r;e.parents("."+w)[0]&&(i=e.siblings("."+w).children("."+A),n=(a=e.parent("."+q).prev()).find('input[name="layuiTreeCheck"]')[0],l=1,(r=0)==n.checked&&(i.each(function(e,i){var a=x(i).find('input[name="layuiTreeCheck"]')[0];0!=a.checked||a.disabled||(l=0),a.disabled||(r=1)}),1==l&&1==r&&(n.checked=!0,C.renderForm("checkbox"),t(a.parent("."+w)))))})(f),v.showLine&&(d=f.siblings("."+w),s=1,c=f.parent("."+q),layui.each(d,function(e,i){x(i).children("."+q)[0]||(s=0)}),1==s?(l[0]||(c.removeClass(S),d.children("."+q).addClass(H),d.children("."+q).children("."+w).removeClass(I)),f.next()[0]?c.children("."+w).last().children("."+q).children("."+w).last().addClass(I):f.prev().children("."+q).children("."+w).last().addClass(I),f.next()[0]||f.parents("."+w)[1]||f.parents("."+w).eq(0).next()[0]||f.prev("."+w).addClass(I)):!f.next()[0]&&f.hasClass(I)&&f.prev().addClass(I))):(i=f.parent("."+q).prev(),v.showLine?(i.find("."+T).removeClass("layui-tree-icon"),i.find("."+T).children(".layui-icon").removeClass(N).addClass("layui-icon-file"),(a=i.parents("."+q).eq(0)).addClass(S),a.children("."+w).each(function(){x(this).children("."+q).children("."+w).last().addClass(I)})):i.find(".layui-tree-iconArrow").addClass(b),f.parents("."+w).eq(0).removeClass(F),f.parent("."+q).remove()),f.remove()}})},a.prototype.drag=function(){var k=this,g=k.config;k.elem.on("dragstart","."+A,function(){var e=x(this).parent("."+w),i=e.parents("."+w)[0]?e.parents("."+w).eq(0):"未找到父节点";g.dragstart&&g.dragstart(e,i)}),k.elem.on("dragend","."+A,function(e){var s,c,i,o,h,u,p=(e=e||event).clientY,f=x(this).parent("."+w),y=f.height(),C=f.offset().top,a=k.elem.find("."+w),v=k.elem.height()+k.elem.offset().top-13,n=f.parents("."+w)[0],l=f.next()[0];n&&(s=f.parent("."+q),c=f.parents("."+w).eq(0),i=c.parent("."+q),o=c.offset().top,h=f.siblings(),u=c.children("."+q).children("."+w).length);function m(t){var a,d;n||l||k.elem.children("."+w).last().children("."+q).children("."+w).last().addClass(I),n?1==u?(g.showLine?(t.find("."+T).removeClass("layui-tree-icon"),t.find("."+T).children(".layui-icon").removeClass(N).addClass("layui-icon-file"),i.addClass(S),i.children("."+w).children("."+q).each(function(){x(this).children("."+w).last().addClass(I)})):t.find(".layui-tree-iconArrow").addClass(b),t.children("."+q).remove(),t.removeClass(F)):(g.showLine&&(a=1,layui.each(h,function(e,i){x(i).children("."+q)[0]||(a=0)}),1==a?(f.children("."+q)[0]||(s.removeClass(S),h.children("."+q).addClass(H),h.children("."+q).children("."+w).removeClass(I)),s.children("."+w).last().children("."+q).children("."+w).last().addClass(I),l||t.parents("."+w)[0]||t.next()[0]||s.children("."+w).last().addClass(I)):!l&&f.hasClass(I)&&s.children("."+w).last().addClass(I)),g.showCheckbox&&(d=function(e){if(e){if(!e.parents("."+w)[0])return}else if(!t[0])return;var i=e?e.siblings().children("."+A):h.children("."+A),a=e?e.parent("."+q).prev():s.prev(),n=a.find('input[name="layuiTreeCheck"]')[0],l=1,r=0;0==n.checked&&(i.each(function(e,i){var a=x(i).find('input[name="layuiTreeCheck"]')[0];0!=a.checked||a.disabled||(l=0),a.disabled||(r=1)}),1==l&&1==r&&(n.checked=!0,k.renderForm("checkbox"),d(a.parent("."+w)||t)))})()):f.removeClass("layui-tree-setHide")}a.each(function(){if(0!=x(this).height()){if(C<p&&p<C+y)return void(g.dragend&&g.dragend("drag error"));if(1==u&&o<p&&p<C+y)return void(g.dragend&&g.dragend("drag error"));var e,i,a,n,l,r,t,d=x(this).offset().top;if(d<p&&p<d+15)return x(this).children("."+q)[0]||(g.showLine?(x(this).find("."+T).eq(0).addClass("layui-tree-icon"),x(this).find("."+T).eq(0).children(".layui-icon").addClass(L).removeClass("layui-icon-file")):x(this).find(".layui-tree-iconArrow").removeClass(b),x(this).append('<div class="layui-tree-pack"></div>')),x(this).children("."+q).append(f),m(c),g.showLine&&(e=x(this).children("."+q).children("."+w),f.children("."+q).children("."+w).last().addClass(I),1==e.length?(r=x(this).siblings("."+w),t=1,i=x(this).parent("."+q),layui.each(r,function(e,i){x(i).children("."+q)[0]||(t=0)}),1==t?(r.children("."+q).addClass(H),r.children("."+q).children("."+w).removeClass(I),x(this).children("."+q).addClass(H),i.removeClass(S),i.children("."+w).last().children("."+q).children("."+w).last().addClass(I).removeClass("layui-tree-setHide")):x(this).children("."+q).children("."+w).addClass(I).removeClass("layui-tree-setHide")):(f.prev("."+w).hasClass(I)?(f.prev("."+w).removeClass(I),f.addClass(I)):(f.removeClass("layui-tree-setLineShort layui-tree-setHide"),f.children("."+q)[0]?f.prev("."+w).children("."+q).children("."+w).last().removeClass(I):f.siblings("."+w).find("."+q).each(function(){x(this).children("."+w).last().addClass(I)})),x(this).next()[0]||f.addClass(I))),g.showCheckbox&&x(this).children("."+A).find('input[name="layuiTreeCheck"]')[0].checked&&f.children("."+A).find('input[name="layuiTreeCheck"]+').click(),g.dragend&&g.dragend("drag success",f,x(this)),!1;if(p<d)return x(this).before(f),m(c),g.showLine&&(a=f.children("."+q),l=(n=x(this).parents("."+w).eq(0)).children("."+q).children("."+w).last(),a[0]?(f.removeClass(I),a.children("."+w).last().removeClass(I),r=f.siblings("."+w),t=1,layui.each(r,function(e,i){x(i).children("."+q)[0]||(t=0)}),1==t?n[0]&&(r.children("."+q).addClass(H),r.children("."+q).children("."+w).removeClass(I),l.children("."+q).children("."+w).last().addClass(I).removeClass(H)):f.children("."+q).children("."+w).last().addClass(I),!n.parent("."+q)[0]&&n.next()[0]&&l.removeClass(I)):(n.hasClass(S)||n.addClass(S),n.find("."+q).each(function(){x(this).children("."+w).last().addClass(I)})),n[0]||(f.addClass("layui-tree-setHide"),f.children("."+q).children("."+w).last().removeClass(I))),n[0]&&g.showCheckbox&&n.children("."+A).find('input[name="layuiTreeCheck"]')[0].checked&&f.children("."+A).find('input[name="layuiTreeCheck"]+').click(),g.dragend&&g.dragend("拖拽成功，插入目标节点上方",f,x(this)),!1;if(v<p)return k.elem.children("."+w).last().children("."+q).addClass(H),k.elem.append(f),m(c),f.prev().children("."+q).children("."+w).last().removeClass(I),f.addClass("layui-tree-setHide"),f.children("."+q).children("."+w).last().addClass(I),g.dragend&&g.dragend("拖拽成功，插入最外层节点",f,k.elem),!1}})})},a.prototype.events=function(){var l=this,r=l.config,e=l.elem.find(".layui-tree-checkedFirst");layui.each(e,function(e,i){x(i).children("."+A).find('input[name="layuiTreeCheck"]+').trigger("click")}),l.elem.find(".layui-tree-search").on("keyup",function(){var e=x(this),a=e.val(),i=e.nextAll(),n=[];i.find("."+k).each(function(){var i,e=x(this).parents("."+A);-1!=x(this).html().indexOf(a)&&(n.push(x(this).parent()),(i=function(e){e.addClass("layui-tree-searchShow"),e.parent("."+q)[0]&&i(e.parent("."+q).parent("."+w))})(e.parent("."+w)))}),i.find("."+A).each(function(){var e=x(this).parent("."+w);e.hasClass("layui-tree-searchShow")||e.addClass(b)}),0==i.find(".layui-tree-searchShow").length&&l.elem.append(l.elemNone),r.onsearch&&r.onsearch({elem:n})}),l.elem.find(".layui-tree-search").on("keydown",function(){x(this).nextAll().find("."+A).each(function(){x(this).parent("."+w).removeClass("layui-tree-searchShow "+b)}),x(".layui-tree-emptyText")[0]&&x(".layui-tree-emptyText").remove()})},a.prototype.getChecked=function(){var e=this.config,i=[],a=[];this.elem.find(".layui-form-checked").each(function(){i.push(x(this).prev()[0].value)});var r=function(e,l){layui.each(e,function(e,n){layui.each(i,function(e,i){if(n.id==i){var a=x.extend({},n);return delete a.children,l.push(a),n.children&&(a.children=[],r(n.children,a.children)),!0}})})};return r(x.extend({},e.data),a),a},a.prototype.setChecked=function(r){this.config,this.elem.find("."+w).each(function(e,i){var a=x(this).data("id"),n=x(i).children("."+A).find('input[name="layuiTreeCheck"]'),l=n.next();if("number"==typeof r){if(a==r)return n[0].checked||l.click(),!1}else-1!=x.inArray(a,r)&&(n[0].checked||l.click())})},r.that={},r.config={},l.reload=function(e,i){var a=r.that[e];return a.reload(i),r.call(a)},l.getChecked=function(e){return r.that[e].getChecked()},l.setChecked=function(e,i){return r.that[e].setChecked(i)},l.render=function(e){var i=new a(e);return r.call(i)},e(n,l)});