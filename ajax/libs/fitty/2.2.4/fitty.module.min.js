"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},toArray=function(e){return[].slice.call(e)},w=window,DrawState={IDLE:0,DIRTY_CONTENT:1,DIRTY_LAYOUT:2,DIRTY:3},fitties=[],redrawFrame=null,requestRedraw="requestAnimationFrame"in w?function(){w.cancelAnimationFrame(redrawFrame),redrawFrame=w.requestAnimationFrame(function(){redraw(fitties.filter(function(e){return e.dirty}))})}:function(){},redrawAll=function(t){return function(){fitties.forEach(function(e){e.dirty=t}),requestRedraw()}},redraw=function(e){e.filter(function(e){return!e.styleComputed}).forEach(function(e){e.styleComputed=computeStyle(e)}),e.filter(shouldPreStyle).forEach(applyStyle),e.filter(shouldRedraw).forEach(calculateStyles),e.forEach(applyStyles),e.forEach(dispatchFitEvent)},calculateStyles=function(e){e.availableWidth=e.element.parentNode.clientWidth,e.currentWidth=e.element.scrollWidth,e.previousFontSize=e.currentFontSize,e.currentFontSize=Math.min(Math.max(e.minSize,e.availableWidth/e.currentWidth*e.previousFontSize),e.maxSize),e.whiteSpace=e.multiLine&&e.currentFontSize===e.minSize?"normal":"nowrap"},shouldRedraw=function(e){return e.dirty!==DrawState.DIRTY_LAYOUT||e.dirty===DrawState.DIRTY_LAYOUT&&e.element.parentNode.clientWidth!==e.availableWidth},computeStyle=function(e){var t=w.getComputedStyle(e.element,null);e.currentFontSize=parseInt(t.getPropertyValue("font-size"),10),e.display=t.getPropertyValue("display"),e.whiteSpace=t.getPropertyValue("white-space")},shouldPreStyle=function(e){var t=!1;return/inline-/.test(e.display)||(t=!0,e.display="inline-block"),"nowrap"!==e.whiteSpace&&(t=!0,e.whiteSpace="nowrap"),t},applyStyles=function(e){applyStyle(e),e.dirty=DrawState.IDLE},applyStyle=function(e){e.originalStyle||(e.originalStyle=e.element.getAttribute("style")||""),e.element.style.cssText=e.originalStyle+";white-space:"+e.whiteSpace+";display:"+e.display+";font-size:"+e.currentFontSize+"px"},dispatchFitEvent=function(e){e.element.dispatchEvent(new CustomEvent("fit",{detail:{oldValue:e.previousFontSize,newValue:e.currentFontSize,scaleFactor:e.currentFontSize/e.previousFontSize}}))},fit=function(e,t){return function(){e.dirty=t,requestRedraw()}},subscribe=function(e){e.newbie=!0,e.dirty=!0,fitties.push(e)},unsubscribe=function(t){return function(){fitties=fitties.filter(function(e){return e.element!==t.element}),t.observeMutations&&t.observer.disconnect(),t.element.style.cssText=t.originalStyle}},observeMutations=function(e){e.observeMutations&&(e.observer=new MutationObserver(fit(e,DrawState.DIRTY_CONTENT)),e.observer.observe(e.element,e.observeMutations))},mutationObserverDefaultSetting={subtree:!0,childList:!0,characterData:!0},defaultOptions={minSize:16,maxSize:512,multiLine:!0,observeMutations:"MutationObserver"in w&&mutationObserverDefaultSetting};function fittyCreate(e,t){var n=_extends({},defaultOptions,t),r=e.map(function(e){var t=_extends({},n,{element:e});return subscribe(t),observeMutations(t),{element:e,fit:fit(t,DrawState.DIRTY),unsubscribe:unsubscribe(t)}});return requestRedraw(),r}function fitty(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e?fittyCreate(toArray(document.querySelectorAll(e)),t):fittyCreate([e],t)[0]}var resizeDebounce=null,onWindowResized=function(){w.clearTimeout(resizeDebounce),resizeDebounce=w.setTimeout(redrawAll(DrawState.DIRTY_LAYOUT),fitty.observeWindowDelay)},events=["resize","orientationchange"];Object.defineProperty(fitty,"observeWindow",{set:function(e){var t=(e?"add":"remove")+"EventListener";events.forEach(function(e){w[t](e,onWindowResized)})}}),fitty.observeWindow=!0,fitty.observeWindowDelay=100,fitty.fitAll=redrawAll(DrawState.DIRTY),exports.default=fitty;