!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.fuzzysort=r()}(this,function(){var T="undefined"!=typeof require&&"undefined"==typeof window,m=-20,D=32,S=new Map,N=new Map,z=[];z.total=0;var b=[],k=[];function r(){S.clear(),N.clear(),b=[],k=[]}function M(e){for(var r=-1/0,t=e.length-1;0<=t;--t){var n,o=e[t];null!==o&&(r<(n=o.score)&&(r=n))}return r===-1/0?null:r}function q(e,r){var t=e[r];if(void 0!==t)return t;var n=r;Array.isArray(r)||(n=r.split("."));for(var o=n.length,a=-1;e&&++a<o;)e=e[n[a]];return e}var t=function(){var a=[],i=0,e={};function r(){for(var e=a[n=0],r=1;r<i;){var t=r+1,n=r;t<i&&a[t].score<a[r].score&&(n=t),a[n-1>>1]=a[n],r=1+(n<<1)}for(var o=n-1>>1;0<n&&e.score<a[o].score;o=(n=o)-1>>1)a[n]=a[o];a[n]=e}return e.add=function(e){var r=i;a[i++]=e;for(var t=r-1>>1;0<r&&e.score<a[t].score;t=(r=t)-1>>1)a[r]=a[t];a[r]=e},e.poll=function(){if(0!==i){var e=a[0];return a[0]=a[--i],r(),e}},e.peek=function(e){if(0!==i)return a[0]},e.replaceTop=function(e){a[0]=e,r()},e},C=t();return function e(B){var F={single:function(e,r){var t,n;return"object"!=typeof e&&(void 0!==(t=N.get(e))?e=t:N.set(e,e=F.prepareSearch(e))),0===e.length?null:("object"!=typeof r&&(void 0!==(n=S.get(r))?r=n:S.set(r,r=F.prepareFast(r))),0===r._targetLowerCodes.length?null:F.algorithm(e,r,e[0]))},go:function(e,r,t){var n;if("object"!=typeof e&&(void 0!==(n=N.get(e))?e=n:N.set(e,e=F.prepareSearch(e))),0===e.length)return z;var o=e[0],a=t&&t.threshold||B&&B.threshold||-1/0,i=t&&t.limit||B&&B.limit||1/0,l=0,s=0;if(t&&t.keys)for(var f=t.scoreFn||M,u=t.keys,c=u.length,d=r.length-1;0<=d;--d){for(var g=r[d],p=new Array(c),v=c-1;0<=v;--v)void 0!==(y=q(g,w=u[v]))?("object"!=typeof y&&(void 0!==(x=S.get(y))?y=x:S.set(y,y=F.prepareFast(y))),0!==y._targetLowerCodes.length?p[v]=F.algorithm(e,y,o):p[v]=null):p[v]=null;p.obj=g;var h=f(p);null!==h&&(h<a||(p.score=h,l<i?(C.add(p),++l):(++s,h>C.peek().score&&C.replaceTop(p))))}else if(t&&t.key)for(var w=t.key,d=r.length-1;0<=d;--d)void 0!==(y=q(g=r[d],w))&&("object"!=typeof y&&(void 0!==(x=S.get(y))?y=x:S.set(y,y=F.prepareFast(y))),0!==y._targetLowerCodes.length&&null!==(m=F.algorithm(e,y,o))&&(m.score<a||(m={target:m.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:m.score,indexes:m.indexes,obj:g},l<i?(C.add(m),++l):(++s,m.score>C.peek().score&&C.replaceTop(m)))));else for(var y,x,m,d=r.length-1;0<=d;--d)"object"!=typeof(y=r[d])&&(void 0!==(x=S.get(y))?y=x:S.set(y,y=F.prepareFast(y))),0!==y._targetLowerCodes.length&&null!==(m=F.algorithm(e,y,o))&&(m.score<a||(l<i?(C.add(m),++l):(++s,m.score>C.peek().score&&C.replaceTop(m))));if(0===l)return z;for(var b=new Array(l),d=l-1;0<=d;--d)b[d]=C.poll();return b.total=l+s,b},goAsync:function(j,L,I){var A=!1,e=new Promise(function(p,v){var e;if("object"!=typeof j&&(void 0!==(e=N.get(j))?j=e:N.set(j,j=F.prepareSearch(j))),0===j.length)return p(z);var h=j[0],w=1e3,y=t(),x=L.length-1,m=I&&I.threshold||B&&B.threshold||-1/0,b=I&&I.limit||B&&B.limit||1/0,k=0,C=0;function _(){if(A)return v("canceled");var e=Date.now();if(I&&I.keys)for(var r=I.scoreFn||M,t=I.keys,n=t.length,o=L.length-1;0<=o;--o){for(var a=L[o],i=new Array(n),l=n-1;0<=l;--l)void 0!==(f=q(a,d=t[l]))?("object"!=typeof f&&(void 0!==(u=S.get(f))?f=u:S.set(f,f=F.prepareFast(f))),0!==f._targetLowerCodes.length?i[l]=F.algorithm(j,f,h):i[l]=null):i[l]=null;i.obj=a;var s=r(i);if(null!==s&&!(s<m)&&(i.score=s,k<b?(y.add(i),++k):(++C,s>y.peek().score&&y.replaceTop(i)),x%w==0&&Date.now()-e>=D))return void(T?setImmediate:setTimeout)(_)}else if(I&&I.key){for(var f,u,c,d=I.key;0<=x;--x)if(void 0!==(f=q(a=L[x],d))&&("object"!=typeof f&&(void 0!==(u=S.get(f))?f=u:S.set(f,f=F.prepareFast(f))),0!==f._targetLowerCodes.length&&null!==(c=F.algorithm(j,f,h))&&!(c.score<m)&&(c={target:c.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:c.score,indexes:c.indexes,obj:a},k<b?(y.add(c),++k):(++C,c.score>y.peek().score&&y.replaceTop(c)),x%w==0&&Date.now()-e>=D)))return void(T?setImmediate:setTimeout)(_)}else for(;0<=x;--x)if("object"!=typeof(f=L[x])&&(void 0!==(u=S.get(f))?f=u:S.set(f,f=F.prepareFast(f))),0!==f._targetLowerCodes.length&&null!==(c=F.algorithm(j,f,h))&&!(c.score<m)&&(k<b?(y.add(c),++k):(++C,c.score>y.peek().score&&y.replaceTop(c)),x%w==0&&Date.now()-e>=D))return void(T?setImmediate:setTimeout)(_);if(0===k)return p(z);for(var g=new Array(k),o=k-1;0<=o;--o)g[o]=y.poll();g.total=k+C,p(g)}T?setImmediate(_):_()});return e.cancel=function(){A=!0},e},highlight:function(e,r,t){if(null===e)return null;void 0===r&&(r="<b>"),void 0===t&&(t="</b>");for(var n="",o=0,a=!1,i=e.target,l=i.length,s=e.indexes,f=0;f<l;++f){var u=i[f];if(s[o]===f){if(a||(a=!0,n+=r),++o===s.length){n+=u+t+i.substr(f+1);break}}else a&&(a=!1,n+=t);n+=u}return n},prepare:function(e){return{target:e,_targetLowerCodes:F.prepareLowerCodes(e),_nextBeginningIndexes:F.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){return F.prepareLowerCodes(e)},algorithm:function(e,r,t){for(var n=r._targetLowerCodes,o=e.length,a=n.length,i=0,l=0,s=0,f=0;;){if(t===n[l]){if(b[f++]=l,++i===o)break;t=e[0===s?i:s===i?i+1:s===i-1?i-1:i]}if(a<=++l)for(;;){if(i<=1)return null;if(0===s){if(t===e[--i])continue;s=i}else{if(1===s)return null;if((t=e[1+(i=--s)])===e[i])continue}l=b[(f=i)-1]+1;break}}var i=0,u=0,c=!1,d=0,g=r._nextBeginningIndexes;null===g&&(g=r._nextBeginningIndexes=F.prepareNextBeginningIndexes(r.target));var p,v,h=l=0===b[0]?0:g[b[0]-1];if(l!==a)for(;;)if(a<=l){if(i<=0){if(o-2<++u)break;if(e[u]===e[u+1])continue;l=h;continue}--i,l=g[k[--d]]}else if(e[0===u?i:u===i?i+1:u===i-1?i-1:i]===n[l]){if(k[d++]=l,++i===o){c=!0;break}++l}else l=g[l];v=c?(p=k,d):(p=b,f);for(var w=0,y=-1,x=0;x<o;++x)y!==(l=p[x])-1&&(w-=l),y=l;for(c?0!==u&&(w+=m):(w*=1e3,0!==s&&(w+=m)),w-=a-o,r.score=w,r.indexes=new Array(v),x=v-1;0<=x;--x)r.indexes[x]=p[x];return r},prepareFast:function(e){return{target:e,_targetLowerCodes:F.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareLowerCodes:function(e){for(var r=new Array(e.length),t=e.toLowerCase(),n=e.length,o=0;o<n;++o)r[o]=t.charCodeAt(o);return r},prepareBeginningIndexes:function(e){for(var r=e.length,t=[],n=0,o=!1,a=!1,i=0;i<r;++i){var l=e.charCodeAt(i),s=65<=l&&l<=90,f=s||97<=l&&l<=122||48<=l&&l<=57,u=s&&!o||!a||!f,o=s,a=f;u&&(t[n++]=i)}return t},prepareNextBeginningIndexes:function(e){for(var r=e.length,t=F.prepareBeginningIndexes(e),n=new Array(r),o=t[0],a=0,i=0;i<r;++i)i<o?n[i]=o:(o=t[++a],n[i]=void 0===o?r:o);return n},cleanup:r,new:e};return F}()});