!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.fuzzysort=r()}(this,function(){var B="undefined"!=typeof require&&"undefined"==typeof window,b=-20,D=32,S=new Map,N=new Map,z=[];z.total=0;var x=[],k=[];function r(){S.clear(),N.clear(),x=[],k=[]}function M(e){for(var r=-1/0,t=e.length-1;0<=t;--t){var n,o=e[t];null!==o&&(r<(n=o.score)&&(r=n))}return r===-1/0?null:r}function q(e,r){var t=e[r];if(void 0!==t)return t;var n=r;Array.isArray(r)||(n=r.split("."));for(var o=n.length,a=-1;e&&++a<o;)e=e[n[a]];return e}var t=function(){function r(){for(var e=a[n=0],r=1;r<i;){var t=r+1,n=r;t<i&&a[t].score<a[r].score&&(n=t),a[n-1>>1]=a[n],r=1+(n<<1)}for(var o=n-1>>1;0<n&&e.score<a[o].score;o=(n=o)-1>>1)a[n]=a[o];a[n]=e}var a=[],i=0,e=Object.assign({});return e.add=function(e){var r=i;a[i++]=e;for(var t=r-1>>1;0<r&&e.score<a[t].score;t=(r=t)-1>>1)a[r]=a[t];a[r]=e},e.poll=function(){var e=a[0];return a[0]=a[--i],r(),e},e.peek=function(e){return a[0]},e.replaceTop=function(e){a[0]=e,r()},e},j=t();return function e(F){var T={single:function(e,r,t){var n,o;return"object"!=typeof e&&(void 0!==(n=N.get(e))?e=n:N.set(e,e=T.prepareSearch(e))),0===e.length?null:("object"!=typeof r&&(void 0!==(o=S.get(r))?r=o:S.set(r,r=T.prepareFast(r))),0===r._targetLowerCodes.length?null:T.algorithm(e,r,e[0]))},go:function(e,r,t){var n;if("object"!=typeof e&&(void 0!==(n=N.get(e))?e=n:N.set(e,e=T.prepareSearch(e))),0===e.length)return z;var o=e[0],a=t&&t.threshold||F&&F.threshold||-1/0,i=t&&t.limit||F&&F.limit||1/0,l=0,s=0;if(t&&t.keys)for(var f=t.scoreFn||M,u=t.keys,c=u.length,p=r.length-1;0<=p;--p){for(var g=r[p],d=new Array(c),v=c-1;0<=v;--v)"object"!=typeof(w=q(g,y=u[v]))&&(void 0!==(m=S.get(w))?w=m:S.set(w,w=T.prepareFast(w))),0!==w._targetLowerCodes.length?d[v]=T.algorithm(e,w,o):d[v]=null;var h=f(d);null!==h&&(h<a||(d.obj=g,d.score=h,l<i?(j.add(d),++l):(++s,h>j.peek().score&&j.replaceTop(d))))}else if(t&&t.key)for(var y=t.key,p=r.length-1;0<=p;--p)"object"!=typeof(w=q(g=r[p],y))&&(void 0!==(m=S.get(w))?w=m:S.set(w,w=T.prepareFast(w))),0!==w._targetLowerCodes.length&&null!==(b=T.algorithm(e,w,o))&&(b.score<a||(b.obj=g,l<i?(j.add(b),++l):(++s,b.score>j.peek().score&&j.replaceTop(b))));else for(var w,m,b,p=r.length-1;0<=p;--p)"object"!=typeof(w=r[p])&&(void 0!==(m=S.get(w))?w=m:S.set(w,w=T.prepareFast(w))),0!==w._targetLowerCodes.length&&null!==(b=T.algorithm(e,w,o))&&(b.score<a||(l<i?(j.add(b),++l):(++s,b.score>j.peek().score&&j.replaceTop(b))));if(0===l)return z;for(var x=new Array(l),p=l-1;0<=p;--p)x[p]=j.poll();return x.total=l+s,x},goAsync:function(L,I,_){var A=!1,e=new Promise(function(d,v){var e;if("object"!=typeof L&&(void 0!==(e=N.get(L))?L=e:N.set(L,L=T.prepareSearch(L))),0===L.length)return d(z);var h=L[0],y=1e3,w=t(),m=I.length-1,b=_&&_.threshold||F&&F.threshold||-1/0,x=_&&_.limit||F&&F.limit||Infinit,k=0,j=0;function C(){if(A)return v("canceled");var e=Date.now();if(_&&_.keys)for(var r=_.scoreFn||M,t=_.keys,n=t.length,o=I.length-1;0<=o;--o){for(var a=I[o],i=new Array(n),l=n-1;0<=l;--l)"object"!=typeof(f=q(a,p=t[l]))&&(void 0!==(u=S.get(f))?f=u:S.set(f,f=T.prepareFast(f))),0!==f._targetLowerCodes.length?i[l]=T.algorithm(L,f,h):i[l]=null;var s=r(i);if(null!==s&&!(s<b)&&(i.obj=a,i.score=s,k<x?(w.add(i),++k):(++j,s>w.peek().score&&w.replaceTop(i)),m%y==0&&Date.now()-e>=D))return void(B?setImmediate:setTimeout)(C)}else if(_&&_.key){for(var f,u,c,p=_.key;0<=m;--m)if("object"!=typeof(f=q(a=I[m],p))&&(void 0!==(u=S.get(f))?f=u:S.set(f,f=T.prepareFast(f))),0!==f._targetLowerCodes.length&&null!==(c=T.algorithm(L,f,h))&&!(c.score<b)&&(c.obj=a,k<x?(w.add(c),++k):(++j,c.score>w.peek().score&&w.replaceTop(c)),m%y==0&&Date.now()-e>=D))return void(B?setImmediate:setTimeout)(C)}else for(;0<=m;--m)if("object"!=typeof(f=I[m])&&(void 0!==(u=S.get(f))?f=u:S.set(f,f=T.prepareFast(f))),0!==f._targetLowerCodes.length&&null!==(c=T.algorithm(L,f,h))&&!(c.score<b)&&(k<x?(w.add(c),++k):(++j,c.score>w.peek().score&&w.replaceTop(c)),m%y==0&&Date.now()-e>=D))return void(B?setImmediate:setTimeout)(C);if(0===k)return d(z);for(var g=new Array(k),o=k-1;0<=o;--o)g[o]=w.poll();g.total=k+j,d(g)}B?setImmediate(C):C()});return e.cancel=function(){A=!0},e},highlight:function(e,r,t){if(null===e)return null;void 0===r&&(r="<b>"),void 0===t&&(t="</b>");for(var n="",o=0,a=!1,i=e.target,l=i.length,s=e.indexes,f=0;f<l;++f){var u=i[f];if(s[o]===f){if(a||(a=!0,n+=r),++o===s.length){n+=u+t+i.substr(f+1);break}}else a&&(a=!1,n+=t);n+=u}return n},prepare:function(e){return{target:e,_targetLowerCodes:T.prepareLowerCodes(e),_nextBeginningIndexes:T.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){return T.prepareLowerCodes(e)},algorithm:function(e,r,t){for(var n=r._targetLowerCodes,o=e.length,a=n.length,i=0,l=0,s=0,f=0;;){if(t===n[l]){if(x[f++]=l,++i===o)break;t=e[0===s?i:s===i?i+1:s===i-1?i-1:i]}if(a<=++l)for(;;){if(i<=1)return null;if(0===s){if(t===e[--i])continue;s=i}else{if(1===s)return null;if((t=e[1+(i=--s)])===e[i])continue}l=x[(f=i)-1]+1;break}}var i=0,u=0,c=!1,p=0,g=r._nextBeginningIndexes;null===g&&(g=r._nextBeginningIndexes=T.prepareNextBeginningIndexes(r.target));var d,v,h=l=0===x[0]?0:g[x[0]-1];if(l!==a)for(;;)if(a<=l){if(i<=0){if(o-2<++u)break;if(e[u]===e[u+1])continue;l=h;continue}--i,l=g[k[--p]]}else if(e[0===u?i:u===i?i+1:u===i-1?i-1:i]===n[l]){if(k[p++]=l,++i===o){c=!0;break}++l}else l=g[l];v=c?(d=k,p):(d=x,f);for(var y=0,w=-1,m=0;m<o;++m)w!==(l=d[m])-1&&(y-=l),w=l;for(c?0!==u&&(y+=b):(y*=1e3,0!==s&&(y+=b)),y-=a-o,r.score=y,r.indexes=new Array(v),m=v-1;0<=m;--m)r.indexes[m]=d[m];return r},prepareFast:function(e){return{target:e,_targetLowerCodes:T.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareLowerCodes:function(e){for(var r=new Array(e.length),t=e.toLowerCase(),n=e.length,o=0;o<n;++o)r[o]=t.charCodeAt(o);return r},prepareBeginningIndexes:function(e){for(var r=e.length,t=[],n=0,o=!1,a=!1,i=0;i<r;++i){var l=e.charCodeAt(i),s=65<=l&&l<=90,f=s||97<=l&&l<=122||48<=l&&l<=57,u=s&&!o||!a||!f,o=s,a=f;u&&(t[n++]=i)}return t},prepareNextBeginningIndexes:function(e){for(var r=e.length,t=T.prepareBeginningIndexes(e),n=new Array(r),o=t[0],a=0,i=0;i<r;++i)i<o?n[i]=o:(o=t[++a],n[i]=void 0===o?r:o);return n},cleanup:r,new:e};return T}()});