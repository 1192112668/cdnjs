define(["../_base/lang","../_base/array","../date","../cldr/supplemental","../i18n","../regexp","../string","../i18n!../cldr/nls/gregorian","module"],function(i,w,u,p,l,a,v,e,r){var y={};function d(m,b,h,k){return k.replace(/([a-z])\1*/gi,function(e){var a,r=e.charAt(0),t=e.length,n=["abbr","wide","narrow"];switch(r){case"G":s=b[t<4?"eraAbbr":"eraNames"][m.getFullYear()<0?0:1];break;case"y":switch(s=m.getFullYear(),t){case 1:break;case 2:if(!h.fullYear){s=(s=String(s)).substr(s.length-2);break}default:a=!0}break;case"Q":case"q":s=Math.ceil((m.getMonth()+1)/3),a=!0;break;case"M":case"L":var c,s,o=m.getMonth();t<3?(s=o+1,a=!0):(c=["months","L"==r?"standAlone":"format",n[t-3]].join("-"),s=b[c][o]);break;case"w":s=y._getWeekOfYear(m,0),a=!0;break;case"d":s=m.getDate(),a=!0;break;case"D":s=y._getDayOfYear(m),a=!0;break;case"e":case"c":var i=m.getDay();if(t<2){s=(i-p.getFirstDayOfWeek(h.locale)+8)%7;break}case"E":var l,i=m.getDay();t<3?(s=i+1,a=!0):(l=["days","c"==r?"standAlone":"format",n[t-3]].join("-"),s=b[l][i]);break;case"a":var u=m.getHours()<12?"am":"pm";s=h[u]||b["dayPeriods-format-wide-"+u];break;case"h":case"H":case"K":case"k":var d=m.getHours();switch(r){case"h":s=d%12||12;break;case"H":s=d;break;case"K":s=d%12;break;case"k":s=d||24}a=!0;break;case"m":s=m.getMinutes(),a=!0;break;case"s":s=m.getSeconds(),a=!0;break;case"S":s=Math.round(m.getMilliseconds()*Math.pow(10,t-3)),a=!0;break;case"v":case"z":if(s=y._getZone(m,!0,h))break;t=4;case"Z":var g=y._getZone(m,!1,h),f=[g<=0?"+":"-",v.pad(Math.floor(Math.abs(g)/60),2),v.pad(Math.abs(g)%60,2)];4==t&&(f.splice(0,0,"GMT"),f.splice(3,0,":")),s=f.join("");break;default:throw new Error("dojo.date.locale.format: invalid pattern char: "+k)}return a&&(s=v.pad(s,t)),s})}function g(e,r,t,a){function n(e){return e}r=r||n,t=t||n,a=a||n;var c=e.match(/(''|[^'])+/g),s="'"==e.charAt(0);return w.forEach(c,function(e,a){e?(c[a]=(s?t:r)(e.replace(/''/g,"'")),s=!s):c[a]=""}),a(c.join(""))}i.setObject(r.id.replace(/\//g,"."),y),y._getZone=function(e,a,r){return a?u.getTimezoneName(e):e.getTimezoneOffset()},y.format=function(e,a){a=a||{};var r,t=l.normalizeLocale(a.locale),n=a.formatLength||"short",c=y._getGregorianBundle(t),s=[],o=i.hitch(this,d,e,c,a);return"year"==a.selector?g(c["dateFormatItem-yyyy"]||"yyyy",o):("date"!=a.selector&&(r=a.timePattern||c["timeFormat-"+n])&&s.push(g(r,o)),"time"!=a.selector&&(r=a.datePattern||c["dateFormat-"+n])&&s.push(g(r,o)),1==s.length?s[0]:c["dateTimeFormat-"+n].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(e,a){return s[a]}))},y.regexp=function(e){return y._parseInfo(e).regexp},y._parseInfo=function(e){e=e||{};var a=l.normalizeLocale(e.locale),r=y._getGregorianBundle(a),t=e.formatLength||"short",n=e.datePattern||r["dateFormat-"+t],c=e.timePattern||r["timeFormat-"+t],s="date"==e.selector?n:"time"==e.selector?c:r["dateTimeFormat-"+t].replace(/\{(\d+)\}/g,function(e,a){return[c,n][a]}),o=[];return{regexp:g(s,i.hitch(this,m,o,r,e)),tokens:o,bundle:r}},y.parse=function(e,f){var a=/[\u200E\u200F\u202A\u202E]/g,r=y._parseInfo(f),m=r.tokens,b=r.bundle,t=new RegExp("^"+r.regexp.replace(a,"")+"$",r.strict?"":"i").exec(e&&e.replace(a,""));if(!t)return null;var h=["abbr","wide","narrow"],k=[1970,0,1,0,0,0,0],p="",n=w.every(t,function(e,a){if(!a)return!0;var r=m[a-1],t=r.length,n=r.charAt(0);switch(n){case"y":if(2!=t&&f.strict)k[0]=e;else if(e<100){e=Number(e);var c=""+(new Date).getFullYear(),s=100*c.substring(0,2),o=Math.min(Number(c.substring(2,4))+20,99);k[0]=e<o?s+e:s-100+e}else{if(f.strict)return!1;k[0]=e}break;case"M":case"L":if(2<t){var i=b["months-"+("L"==n?"standAlone":"format")+"-"+h[t-3]].concat();if(f.strict||(e=e.replace(".","").toLowerCase(),i=w.map(i,function(e){return e.replace(".","").toLowerCase()})),-1==(e=w.indexOf(i,e)))return!1}else e--;k[1]=e;break;case"E":case"e":case"c":var l=b["days-"+("c"==n?"standAlone":"format")+"-"+h[t-3]].concat();if(f.strict||(e=e.toLowerCase(),l=w.map(l,function(e){return e.toLowerCase()})),-1==(e=w.indexOf(l,e)))return!1;break;case"D":k[1]=0;case"d":k[2]=e;break;case"a":var u,d=f.am||b["dayPeriods-format-wide-am"],g=f.pm||b["dayPeriods-format-wide-pm"];if(f.strict||(u=/\./g,e=e.replace(u,"").toLowerCase(),d=d.replace(u,"").toLowerCase(),g=g.replace(u,"").toLowerCase()),f.strict&&e!=d&&e!=g)return!1;p=e==g?"p":e==d?"a":"";break;case"K":24==e&&(e=0);case"h":case"H":case"k":if(23<e)return!1;k[3]=e;break;case"m":k[4]=e;break;case"s":k[5]=e;break;case"S":k[6]=e}return!0}),c=+k[3];"p"===p&&c<12?k[3]=12+c:"a"===p&&12==c&&(k[3]=0);var s=new Date(k[0],k[1],k[2],k[3],k[4],k[5],k[6]);f.strict&&s.setFullYear(k[0]);var o=m.join(""),i=-1!=o.indexOf("d"),l=-1!=o.indexOf("M");return!n||l&&s.getMonth()>k[1]||i&&s.getDate()>k[2]?null:((l&&s.getMonth()<k[1]||i&&s.getDate()<k[2])&&(s=u.add(s,"hour",1)),s)};var f=["abbr","wide","narrow"];function m(i,l,u,e){return e=a.escapeString(e),u.strict||(e=e.replace(" a"," ?a")),e.replace(/([a-z])\1*/gi,function(e){var a,r=e.charAt(0),t=e.length,n="",c="";switch(u.strict?(1<t&&(n="0{"+(t-1)+"}"),2<t&&(c="0{"+(t-2)+"}")):(n="0?",c="0{0,2}"),r){case"y":a="\\d{2,4}";break;case"M":case"L":2<t?(a=l["months-"+("L"==r?"standAlone":"format")+"-"+f[t-3]].slice(0).join("|"),u.strict||(a="(?:"+(a=a.replace(/\./g,""))+")\\.?")):a="1[0-2]|"+n+"[1-9]";break;case"D":a="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+n+"[1-9][0-9]|"+c+"[1-9]";break;case"d":a="3[01]|[12]\\d|"+n+"[1-9]";break;case"w":a="[1-4][0-9]|5[0-3]|"+n+"[1-9]";break;case"E":case"e":case"c":a=".+?";break;case"h":a="1[0-2]|"+n+"[1-9]";break;case"k":a="1[01]|"+n+"\\d";break;case"H":a="1\\d|2[0-3]|"+n+"\\d";break;case"K":a="1\\d|2[0-4]|"+n+"[1-9]";break;case"m":case"s":a="[0-5]\\d";break;case"S":a="\\d{"+t+"}";break;case"a":var s=u.am||l["dayPeriods-format-wide-am"],o=u.pm||l["dayPeriods-format-wide-pm"];a=s+"|"+o,u.strict||(s!=s.toLowerCase()&&(a+="|"+s.toLowerCase()),o!=o.toLowerCase()&&(a+="|"+o.toLowerCase()),-1!=a.indexOf(".")&&(a+="|"+a.replace(/\./g,""))),a=a.replace(/\./g,"\\.");break;default:a=".*"}return i&&i.push(e),"("+a+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var n=[],c={};return y.addCustomFormats=function(e,a){n.push({pkg:e,name:a}),c={}},y._getGregorianBundle=function(r){if(c[r])return c[r];var t={};return w.forEach(n,function(e){var a=l.getLocalization(e.pkg,e.name,r);t=i.mixin(t,a)},this),c[r]=t},y.addCustomFormats(r.id.replace(/\/date\/locale$/,".cldr"),"gregorian"),y.getNames=function(e,a,r,t){var n,c=y._getGregorianBundle(t),s=[e,r,a];return"standAlone"==r&&1==(n=c[s.join("-")])[0]&&(n=void 0),s[1]="format",(n||c[s.join("-")]).concat()},y.isWeekend=function(e,a){var r=p.getWeekend(a),t=(e||new Date).getDay();return r.end<r.start&&(r.end+=7,t<r.start&&(t+=7)),t>=r.start&&t<=r.end},y._getDayOfYear=function(e){return u.difference(new Date(e.getFullYear(),0,1,e.getHours()),e)+1},y._getWeekOfYear=function(e,a){1==arguments.length&&(a=0);var r=new Date(e.getFullYear(),0,1).getDay(),t=(r-a+7)%7,n=Math.floor((y._getDayOfYear(e)+t-1)/7);return r==a&&n++,n},y});