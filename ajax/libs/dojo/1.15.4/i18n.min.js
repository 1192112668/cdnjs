define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./has!host-browser?./_base/xhr","./json","module"],function(g,v,y,m,x,L,a,b,r){y.add("dojo-preload-i18n-Api",1),y.add("dojo-v1x-i18n-Api",1);function t(e,n,o){return o=o?o.toLowerCase():g.locale,e=e.replace(/\./g,"/"),n=n.replace(/\./g,"/"),/root/i.test(o)?e+"/nls/"+n:e+"/nls/"+o+"/"+n}function l(e,o,n){function u(){--h||n(L.delegate($[c]))}var r,i,t=M.exec(e),f=t[1]+"/",s=t[5]||t[4],d=f+s,a=t[5]&&t[4],l=a||g.locale||"",c=d+"/"+l,p=a?[l]:(r=l,i=x.extraLocale||[],(i=L.isArray(i)?i:[i]).push(r),i),h=p.length,_=e.split("*"),v="preload"==_[1];if(y("dojo-preload-i18n-Api")){if(v&&($[e]||($[e]=1,j(_[2],b.parse(_[3]),1,o)),n(1)),v||A(e,o,n)&&!$[c])return}else if(v)return void n(1);m.forEach(p,function(e){var r,i,t,a,l,c,n=d+"/"+e;y("dojo-preload-i18n-Api")&&O(n),$[n]?u():(t=f,a=s,l=e,c=u,(r=o)([i=d],function(e){var n=L.clone(e.root||e.ROOT),o=function(e,n,o,r){for(var i=[o+r],t=n.split("-"),a="",l=0;l<t.length;l++)a+=(a?"-":"")+t[l],e&&!e[a]||(i.push(o+a+"/"+r),i.specificity=a);return i}(!e._v1x&&e,l,t,a);r(o,function(){for(var e=1;e<o.length;e++)n=L.mixin(L.clone(n),arguments[e]);($[i+"/"+l]=n).$locale=o.specificity,c()})}))})}var n,c,u,f,j,A,s,d,p,z,O,e=g.i18n={},M=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,$={},o=g.getL10nName=function(e,n,o){return r.id+"!"+t(e,n,o)};return(y("dojo-preload-i18n-Api")||y("dojo-v1x-i18n-Api"))&&(n=e.normalizeLocale=function(e){var n=e?e.toLowerCase():g.locale;return"root"==n?"ROOT":n},c=function(e,n){return!y("dojo-sync-loader")||!y("dojo-v1x-i18n-Api")||n.isXdUrl(v.toUrl(e+".js"))},u=0,f=[],j=e._preloadLocalizations=function(r,i,t,s){function d(e,n){for(var o=e.split("-");o.length;){if(n(o.join("-")))return;o.pop()}n("ROOT")}function p(){u++}function h(){for(--u;!u&&f.length;)l.apply(null,f.shift())}function _(e,n,o,r){return r.toAbsMid(e+n+"/"+o)}function e(f){d(f=n(f),function(u){if(0<=m.indexOf(i,u)){var e=r.replace(/\./g,"/")+"_"+u;return p(),o=function(e){for(var n in e){var o,r,i,t,a=e[n],l=n.match(/(.+)\/([^\/]+)$/);function c(n,o,r,i){var t=[],a=[];d(f,function(e){i[e]&&(t.push(v.toAbsMid(n+e+"/"+o)),a.push(_(n,o,e,v)))}),t.length?(p(),s(t,function(){for(var e=t.length-1;0<=e;e--)r=L.mixin(L.clone(r),arguments[e]),$[a[e]]=r;$[_(n,o,f,v)]=L.clone(r),h()})):$[_(n,o,f,v)]=r}l&&(i=l[2],t=l[1]+"/",a._localized&&("ROOT"===u?(r=o=a._localized,delete a._localized,r.root=a,$[v.toAbsMid(n)]=r):(o=a._localized,$[_(t,i,u,v)]=a),u!==f&&c(t,i,a,o)))}h()},c(n=e,s)||t?s([n],o):z([n],o,s),1}var n,o})}s=s||v,e(),m.forEach(g.config.extraLocale,e)},A=function(e,n,o){return u&&f.push([e,n,o]),u},O=function(){}),y("dojo-v1x-i18n-Api")?(s={},d={},z=function(e,n,i){var t=[];m.forEach(e,function(o){var r=i.toUrl(o+".js");function e(e){var n=(p=p||new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"))(e,O,o,s);n===s?t.push($[r]=s.result):(n instanceof Error&&(console.error("failed to evaluate i18n bundle; url="+r,n),n={}),t.push($[r]=/nls\/[^\/]+\/[^\/]+$/.test(r)?n:{root:n,_v1x:1}))}if($[r])t.push($[r]);else{var n=i.syncLoadNls(o);if(n=n||O(o.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1")))t.push(n);else if(a)a.get({url:r,sync:!0,load:e,error:function(){t.push($[r]={})}});else try{i.getText(r,!0,e)}catch(e){t.push($[r]={})}}}),n&&n.apply(null,t)},O=function(e){for(var n,o=e.split("/"),r=g.global[o[0]],i=1;r&&i<o.length-1;r=r[o[i++]]);return r&&(n=(n=r[o[i]])||r[o[i].replace(/-/g,"_")])&&($[e]=n),n},e.getLocalization=function(e,n,o){var r,i=t(e,n,o);return d[i]?d[i]:(l(i,c(i,v)?v:function(e,n){z(e,n,v)},function(e){d[i]=e,r=e}),r)}):e.getLocalization=function(e,n,o){var r=e.replace(/\./g,"/")+"/nls/"+n+"/"+(o||x.locale);return this.cache[r]},L.mixin(e,{dynamic:!0,normalize:function(e,n){return/^\./.test(e)?n(e):e},load:l,cache:$,getL10nName:o})});