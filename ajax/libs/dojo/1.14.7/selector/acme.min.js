define(["../dom","../sniff","../_base/array","../_base/lang","../_base/window"],function(s,c,d,n,t){function g(){return t.doc}function h(){return!0}function f(e){function t(n,t){return _(e.slice(n,t))}function n(){var n;0<=g&&(b.id=t(g,m).replace(/\\/g,""),g=-1),0<=h&&(n=h==m?null:t(h,m),b[w.indexOf(n)<0?"tag":"oper"]=n,h=-1),0<=d&&(b.classes.push(t(d+1,m).replace(/\\/g,"")),d=-1)}0<=w.indexOf(e.slice(-1))?e+=" * ":e+=" ";for(var r,u,i,o,a=[],c=-1,f=-1,l=-1,s=-1,d=-1,g=-1,h=-1,p="",v="",m=0,y=e.length,b=null,x=null;p=v,v=e.charAt(m),m<y;m++){"\\"!=p&&(b||(b={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return q?this.otag:this.tag}},h=u=m),r?v==r&&(r=null):"'"!=v&&'"'!=v?0<=c?"]"==v?(x.attr?x.matchFor=t(l||c+1,m):x.attr=t(c+1,m),(i=x.matchFor)&&('"'!=i.charAt(0)&&"'"!=i.charAt(0)||(x.matchFor=i.slice(1,-1))),x.matchFor&&(x.matchFor=x.matchFor.replace(/\\/g,"")),b.attrs.push(x),x=null,c=l=-1):"="==v&&(o=0<="|~^$*".indexOf(p)?p:"",x.type=o+v,x.attr=t(c+1,m-o.length),l=m+1):0<=f?")"==v&&(0<=s&&(x.value=t(f+1,m)),s=f=-1):"#"==v?(n(),g=m+1):"."==v?(n(),d=m):":"==v?(n(),s=m):"["==v?(n(),c=m,x={}):"("==v?(0<=s&&(x={name:t(s+1,m),value:null},b.pseudos.push(x)),f=m):" "==v&&p!=v&&(n(),0<=s&&b.pseudos.push({name:t(s+1,m)}),b.loops=b.pseudos.length||b.attrs.length||b.classes.length,b.oquery=b.query=t(u,m),b.otag=b.tag=b.oper?null:b.tag||"*",b.tag&&(b.tag=b.tag.toUpperCase()),a.length&&a[a.length-1].oper&&(b.infixOper=a.pop(),b.query=b.infixOper.query+" "+b.query),a.push(b),b=null):r=v)}return a}function i(n,t){return n?t?function(){return n.apply(window,arguments)&&t.apply(window,arguments)}:n:t}function p(n,t){var e=t||[];return n&&e.push(n),e}function v(n){return 1==n.nodeType}function o(n,t){return n?"class"==t?n.className||"":"for"==t?n.htmlFor||"":"style"==t?n.style.cssText||"":(q?n.getAttribute(t):n.getAttribute(t,2))||"":""}function e(n){for(;n=n[z];)if(B(n))return!1;return!0}function r(n){for(;n=n[F];)if(B(n))return!1;return!0}function l(n){var t=n.parentNode,e=0,r=(t=7!=t.nodeType?t:t.nextSibling).children||t.childNodes,u=n._i||n.getAttribute("_i")||-1,i=t._l||(void 0!==t.getAttribute?t.getAttribute("_l"):-1);if(!r)return-1;var o=r.length;if(i==o&&0<=u&&0<=i)return u;c("ie")&&void 0!==t.setAttribute?t.setAttribute("_l",o):t._l=o,u=-1;for(var a=t.firstElementChild||t.firstChild;a;a=a[F])B(a)&&(c("ie")?a.setAttribute("_i",++e):a._i=++e,n===a&&(u=e));return u}function m(n){return!(l(n)%2)}function y(n){return l(n)%2}function b(o,a){function c(t){var e=[];try{e=Array.prototype.slice.call(t)}catch(n){for(var r=0,u=t.length;r<u;r++)e.push(t[r])}return e}return o=o||h,function(n,t,e){var r,u=0,i=[],i=c(n.children||n.childNodes);for(a&&d.forEach(i,function(n){1===n.nodeType&&(i=i.concat(c(n.getElementsByTagName("*"))))});r=i[u++];)B(r)&&(!e||V(r,e))&&o(r,u)&&t.push(r);return t}}function x(n,t){for(var e=n.parentNode;e&&e!=t;)e=e.parentNode;return!!e}function A(c){var n=L[c.query];if(n)return n;var t,a,u,r,e=c.infixOper,i=e?e.oper:"",f=$(c,{el:1}),o="*"==c.tag,l=g().getElementsByClassName;return i?(t={el:1},o&&(t.tag=1),f=$(c,t),"+"==i?(r=f,n=function(n,t,e){for(;n=n[F];)if(!C||v(n)){e&&!V(n,e)||!r(n)||t.push(n);break}return t}):"~"==i?(u=f,n=function(n,t,e){for(var r=n[F];r;){if(B(r)){if(e&&!V(r,e))break;u(r)&&t.push(r)}r=r[F]}return t}):">"==i&&(n=b(f))):n=c.id?(f=!c.loops&&o?h:$(c,{el:1,id:1}),function(n,t){var e,r=s.byId(c.id,n.ownerDocument||n);if(n.ownerDocument&&!x(n,n.ownerDocument)&&(e=11===n.nodeType?n.childNodes:[n],d.some(e,function(n){var t=b(function(n){return n.id===c.id},!0)(n,[]);if(t.length)return r=t[0],!1})),r&&f(r))return 9==n.nodeType||x(r,n)?p(r,t):void 0}):l&&/\{\s*\[native code\]\s*\}/.test(String(l))&&c.classes.length&&!E?(f=$(c,{el:1,classes:1,id:1}),a=c.classes.join(" "),function(n,t,e){for(var r,u=p(0,t),i=0,o=n.getElementsByClassName(a);r=o[i++];)f(r,n)&&V(r,e)&&u.push(r);return u}):o||c.loops?(f=$(c,{el:1,tag:1,id:1}),function(n,t,e){for(var r,u=p(0,t),i=0,o=c.getTag(),a=o?n.getElementsByTagName(o):[];r=a[i++];)f(r,n)&&V(r,e)&&u.push(r);return u}):function(n,t,e){for(var r,u=p(0,t),i=0,o=c.getTag(),a=o?n.getElementsByTagName(o):[];r=a[i++];)V(r,e)&&u.push(r);return u},L[c.query]=n}function O(n){var t=f(_(n));if(1!=t.length)return function(n){return function(n,t){for(var e,r,u,i,o=p(n),a=t.length,c=0;c<a;c++){i=[],e=t[c],0<o.length-1&&(u={},i.nozip=!0);for(var f=A(e),l=0;r=o[l];l++)f(r,i,u);if(!i.length)break;o=i}return i}(n,t)};var e=A(t[0]);return function(n){var t=e(n,[]);return t&&(t.nozip=!0),t}}function u(n,t,e,r){return e?(t?t+" ":"")+e+(r?" "+r:""):n}function N(n,t,e){return t.replace(G,u)+(e||"")}function T(n,t){var e=(t=t||g()).ownerDocument||t;q="div"===e.createElement("div").tagName;var r=K(n)(t);return r&&r.nozip?r:function(n){if(n&&n.nozip)return n;if(!n||!n.length)return[];if(n.length<2)return[n[0]];var t,e=[];if(P++,c("ie")&&q)for(var r=P+"",u=0;u<n.length;u++)(t=n[u])&&t.getAttribute(W)!=r&&(e.push(t),t.setAttribute(W,r));else if(c("ie")&&n.commentStrip)try{for(u=0;u<n.length;u++)(t=n[u])&&v(t)&&e.push(t)}catch(n){}else for(u=0;u<n.length;u++)(t=n[u])&&t[W]!=P&&(e.push(t),t[W]=P);return e}(r)}var _=n.trim,a=d.forEach,E="BackCompat"==g().compatMode,w=">~+",q=!1,S={"*=":function(t,e){return function(n){return 0<=o(n,t).indexOf(e)}},"^=":function(t,e){return function(n){return 0==o(n,t).indexOf(e)}},"$=":function(r,u){return function(n){var t=" "+o(n,r),e=t.lastIndexOf(u);return-1<e&&e==t.length-u.length}},"~=":function(t,n){var e=" "+n+" ";return function(n){return 0<=(" "+o(n,t)+" ").indexOf(e)}},"|=":function(e,r){var u=r+"-";return function(n){var t=o(n,e);return t==r||0==t.indexOf(u)}},"=":function(t,e){return function(n){return o(n,t)==e}}},k=g().documentElement,C=!(k.nextElementSibling||"nextElementSibling"in k),F=C?"nextSibling":"nextElementSibling",z=C?"previousSibling":"previousElementSibling",B=C?v:h,I={checked:function(n,t){return function(n){return!!("checked"in n?n.checked:n.selected)}},disabled:function(n,t){return function(n){return n.disabled}},enabled:function(n,t){return function(n){return!n.disabled}},"first-child":function(){return e},"last-child":function(){return r},"only-child":function(n,t){return function(n){return e(n)&&r(n)}},empty:function(n,t){return function(n){for(var t=n.childNodes,e=n.childNodes.length-1;0<=e;e--){var r=t[e].nodeType;if(1===r||3==r)return!1}return!0}},contains:function(n,t){var e=t.charAt(0);return'"'!=e&&"'"!=e||(t=t.slice(1,-1)),function(n){return 0<=n.innerHTML.indexOf(t)}},not:function(n,t){var e=f(t)[0],r={el:1};"*"!=e.tag&&(r.tag=1),e.classes.length||(r.classes=1);var u=$(e,r);return function(n){return!u(n)}},"nth-child":function(n,t){var e=parseInt;if("odd"==t)return y;if("even"==t)return m;if(-1!=t.indexOf("n")){var r=t.split("n",2),u=r[0]?"-"==r[0]?-1:e(r[0]):1,i=r[1]?e(r[1]):0,o=0,a=-1;if(0<u?i<0?i=i%u&&u+i%u:0<i&&(u<=i&&(o=i-i%u),i%=u):u<0&&(u*=-1,0<i&&(a=i,i%=u)),0<u)return function(n){var t=l(n);return o<=t&&(a<0||t<=a)&&t%u==i};t=i}var c=e(t);return function(n){return l(n)==c}}},D=c("ie")<9||9==c("ie")&&c("quirks")?function(t){var e=t.toLowerCase();return"class"==e&&(t="className"),function(n){return q?n.getAttribute(t):n[t]||n[e]}}:function(t){return function(n){return n&&n.getAttribute&&n.hasAttribute(t)}},$=function(t,n){if(!t)return h;var u=null;return"el"in(n=n||{})||(u=i(u,v)),"tag"in n||"*"!=t.tag&&(u=i(u,function(n){return n&&(q?n.tagName:n.tagName.toUpperCase())==t.getTag()})),"classes"in n||a(t.classes,function(n,t,e){var r=new RegExp("(?:^|\\s)"+n+"(?:\\s|$)");(u=i(u,function(n){return r.test(n.className)})).count=t}),"pseudos"in n||a(t.pseudos,function(n){var t=n.name;I[t]&&(u=i(u,I[t](t,n.value)))}),"attrs"in n||a(t.attrs,function(n){var t,e=n.attr;n.type&&S[n.type]?t=S[n.type](e,n.matchFor):e.length&&(t=D(e)),t&&(u=i(u,t))}),"id"in n||t.id&&(u=i(u,function(n){return!!n&&n.id==t.id})),u||"default"in n||(u=h),u},L={},M={},U={},j=c("ie")?"commentStrip":"nozip",H="querySelectorAll",R=!!g()[H],G=/\\[>~+]|n\+\d|([^ \\])?([>~+])([^ =])?/g,J=/([^[]*)([^\]]*])?/g,K=function(e,n){if(e=e.replace(J,N),R){var t=U[e];if(t&&!n)return t}var r=M[e];if(r)return r;var u=e.charAt(0),i=-1==e.indexOf(" ");if(0<=e.indexOf("#")&&i&&(n=!0),!(!R||n||-1!=w.indexOf(u)||c("ie")&&-1!=e.indexOf(":")||E&&0<=e.indexOf(".")||-1!=e.indexOf(":contains")||-1!=e.indexOf(":checked")||-1!=e.indexOf("|="))){var o=0<=w.indexOf(e.charAt(e.length-1))?e+" *":e;return U[e]=function(n){if(9==n.nodeType||i)try{var t=n[H](o);return t[j]=!0,t}catch(n){}return K(e,!0)(n)}}var a=e.match(/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g);return M[e]=a.length<2?O(e):function(n){for(var t,e=0,r=[];t=a[e++];)r=r.concat(O(t)(n));return r}},P=0,Q=c("ie")?function(n){return q?n.getAttribute("_uid")||n.setAttribute("_uid",++P)||P:n.uniqueID}:function(n){return n._uid||(n._uid=++P)},V=function(n,t){if(!t)return 1;var e=Q(n);return t[e]?0:t[e]=1},W="_zipIdx";return T.filter=function(n,t,e){for(var r,u=[],i=f(t),o=1!=i.length||/[^\w#\.]/.test(t)?function(n){return-1!=d.indexOf(T(t,s.byId(e)),n)}:$(i[0]),a=0;r=n[a];a++)o(r)&&u.push(r);return u},T});