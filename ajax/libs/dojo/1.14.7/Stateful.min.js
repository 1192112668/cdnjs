define(["./_base/declare","./_base/lang","./_base/array","./when"],function(t,a,n,h){return t("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(t){var a=this._attrPairNames;return a[t]?a[t]:a[t]={s:"_"+t+"Setter",g:"_"+t+"Getter"}},postscript:function(t){t&&this.set(t)},_get:function(t,a){return"function"==typeof this[a.g]?this[a.g]():this[t]},get:function(t){return this._get(t,this._getAttrNames(t))},set:function(t,a){if("object"==typeof t){for(var e in t)t.hasOwnProperty(e)&&"_watchCallbacks"!=e&&this.set(e,t[e]);return this}var s,i,n=this._getAttrNames(t),r=this._get(t,n),c=this[n.s];return"function"==typeof c?s=c.apply(this,Array.prototype.slice.call(arguments,1)):this[t]=a,this._watchCallbacks&&(i=this,h(s,function(){i._watchCallbacks(t,r,a)})),this},_changeAttrValue:function(t,a){var e=this.get(t);return this[t]=a,this._watchCallbacks&&this._watchCallbacks(t,e,a),this},watch:function(t,a){var r,e=this._watchCallbacks;e||(e=(r=this)._watchCallbacks=function(s,i,n,t){function a(t){if(t)for(var a=0,e=(t=t.slice()).length;a<e;a++)t[a].call(r,s,i,n)}a(e["_"+s]),t||a(e["*"])}),t=a||"function"!=typeof t?"_"+t:(a=t,"*");var s=e[t];"object"!=typeof s&&(s=e[t]=[]),s.push(a);var i={};return i.unwatch=i.remove=function(){var t=n.indexOf(s,a);-1<t&&s.splice(t,1)},i}})});