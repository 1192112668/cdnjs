define(["require","../util","intern/dojo/node!querystring","intern/dojo/node!fs"],function(r,t,i,o){function a(e,n){return t.call(o.readFile,e).then(function(e){return{status:200,headers:{"Content-Type":n},body:[e.toString()]}})}return function(o){var e=new t.Promise(function(n){function t(e){n({status:200,headers:{"Content-Type":"application/json"},body:[JSON.stringify({method:o.method,query:o.query,headers:o.headers,url:o.nodeRequest.url,payload:e||null})]})}-1<o.serviceURL.indexOf("/xml")?n({status:200,headers:{"Content-Type":"application/xml"},body:['<?xml version="1.0" encoding="UTF-8" ?>','<foo><bar baz="thonk">blargh</bar><bar>blah</bar></foo>']}):-1<o.serviceURL.indexOf("/responseTypeGif")?n(a(r.toUrl("./support/blob.gif"),"image/gif")):-1<o.serviceURL.indexOf("/responseTypeDoc")?n(a(r.toUrl("./support/document.html"),"text/html")):o.data?n(o.data.then(function(e){return{status:200,headers:{"Content-Type":"application/json"},body:[JSON.stringify(e)]}})):"GET"!==o.method?o.body.join().then(function(e){t(i.parse(e))}):t()}),n=o.query.delay;return n&&(n=parseInt(n,10),e=t.delay(e,n)),e}});