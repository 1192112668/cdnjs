define(["../../_base/array"],function(o){return function(e,u){switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var i=e;e=function(t){for(var r in i){var n=i[r];if(n&&n.test){if(!n.test(t[r],t))return!1}else if(n!=t[r])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}function t(t){var r,n=o.filter(t,e),a=u&&u.sort;return a&&n.sort("function"==typeof a?a:function(t,r){for(var n,e=0;n=a[e];e++){var u=t[n.attribute],i=r[n.attribute];if((u=null!=u?u.valueOf():u)!=(i=null!=i?i.valueOf():i))return!!n.descending==(null==u||i<u)?-1:1}return 0}),u&&(u.start||u.count)&&(r=n.length,(n=n.slice(u.start||0,(u.start||0)+(u.count||1/0))).total=r),n}return t.matches=e,t}});