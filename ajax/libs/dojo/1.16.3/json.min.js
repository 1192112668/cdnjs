define(["./has"],function(has){"use strict";var hasJSON="undefined"!=typeof JSON;if(has.add("json-parse",hasJSON),has.add("json-stringify",hasJSON&&'{"a":1}'==JSON.stringify({a:0},function(r,n){return n||1})),has("json-stringify"))return JSON;var escapeString=function(r){return('"'+r.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};return{parse:has("json-parse")?JSON.parse:function(str,strict){if(strict&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(str))throw new SyntaxError("Invalid characters in JSON");return eval("("+str+")")},stringify:function(r,g,h){var y;return"string"==typeof g&&(h=g,g=null),function r(i,n,e){g&&(i=g(e,i));var t=typeof i;if("number"==t)return isFinite(i)?i+"":"null";if("boolean"==t)return i+"";if(null===i)return"null";if("string"==typeof i)return escapeString(i);if("function"==t||"undefined"==t)return y;if("function"==typeof i.toJSON)return r(i.toJSON(e),n,e);if(i instanceof Date)return'"{FullYear}-{Month+}-{Date}T{Hours}:{Minutes}:{Seconds}Z"'.replace(/\{(\w+)(\+)?\}/g,function(r,n,e){var t=i["getUTC"+n]()+(e?1:0);return t<10?"0"+t:t});if(i.valueOf()!==i)return r(i.valueOf(),n,e);var a=h?n+h:"",s=h?" ":"",f=h?"\n":"";if(i instanceof Array){var u,o=i.length,c=[];for(e=0;e<o;e++)"string"!=typeof(u=r(i[e],a,e))&&(u="null"),c.push(f+a+u);return"["+c.join(",")+f+n+"]"}var l,p=[];for(e in i)if(i.hasOwnProperty(e)){if("number"==typeof e)l='"'+e+'"';else{if("string"!=typeof e)continue;l=escapeString(e)}if("string"!=typeof(u=r(i[e],a,e)))continue;p.push(f+a+l+":"+s+u)}return"{"+p.join(",")+f+n+"}"}(r,"","")}}});