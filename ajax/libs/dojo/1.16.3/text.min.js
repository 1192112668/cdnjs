define(["./_base/kernel","require","./has","./has!host-browser?./request"],function(e,i,t,r){var d;t("host-browser")?d=function(e,t,n){r(e,{sync:!!t,headers:{"X-Requested-With":null}}).then(n)}:i.getText?d=i.getText:console.error("dojo/text plugin failed to load because loader does not support getText");function f(e){var t;return e?(t=(e=e.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"")).match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im))&&(e=t[1]):e="",e}var h={},p={},g={};return e.cache=function(e,t,n){var r;"string"==typeof e?/\//.test(e)?(r=e,n=t):r=i.toUrl(e.replace(/\./g,"/")+(t?"/"+t:"")):(r=e+"",n=t);var o=null!=n&&"string"!=typeof n?n.value:n,s=n&&n.sanitize;return"string"==typeof o?(h[r]=o,s?f(o):o):null===o?(delete h[r],null):(r in h||d(r,!0,function(e){h[r]=e}),s?f(h[r]):h[r])},{dynamic:!0,normalize:function(e,t){var n=e.split("!"),r=n[0];return(/^\./.test(r)?t(r):r)+(n[1]?"!"+n[1]:"")},load:function(e,t,n){function r(e){n(i?f(e):e)}var o,s=e.split("!"),i=1<s.length,a=s[0],l=t.toUrl(s[0]),u="url:"+l,c=p;a in h?c=h[a]:t.cache&&u in t.cache?c=t.cache[u]:l in h&&(c=h[l]),c===p?g[l]?g[l].push(r):(o=g[l]=[r],d(l,!t.async,function(e){h[a]=h[l]=e;for(var t=0;t<o.length;)o[t++](e);delete g[l]})):r(c)}}});