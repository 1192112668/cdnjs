define(["../_base/array","../_base/declare","../_base/lang","../sniff","../_base/window","../dom","../dom-geometry","../dom-style","../Evented","../on","../touch","./common","./autoscroll"],function(o,t,a,e,l,r,v,c,s,h,u,n,d){return t("dojo.dnd.Mover",[s],{constructor:function(t,o,e){this.node=r.byId(t),this.marginBox={l:o.pageX,t:o.pageY},this.mouseButton=o.button;var s=this.host=e,n=t.ownerDocument;function i(t){t.preventDefault(),t.stopPropagation()}this.events=[h(n,u.move,a.hitch(this,"onFirstMove")),h(n,u.move,a.hitch(this,"onMouseMove")),h(n,u.release,a.hitch(this,"onMouseUp")),h(n,"dragstart",i),h(n.body,"selectstart",i)],d.autoScrollStart(n),s&&s.onMoveStart&&s.onMoveStart(this)},onMouseMove:function(t){d.autoScroll(t);var o=this.marginBox;this.host.onMove(this,{l:o.l+t.pageX,t:o.t+t.pageY},t),t.preventDefault(),t.stopPropagation()},onMouseUp:function(t){(e("webkit")&&e("mac")&&2==this.mouseButton?0==t.button:this.mouseButton==t.button)&&this.destroy(),t.preventDefault(),t.stopPropagation()},onFirstMove:function(t){var o=this.node.style,e=this.host;switch(o.position){case"relative":case"absolute":h=Math.round(parseFloat(o.left))||0,u=Math.round(parseFloat(o.top))||0;break;default:o.position="absolute";var s=v.getMarginBox(this.node),n=l.doc.body,i=c.getComputedStyle(n),a=v.getMarginBox(n,i),r=v.getContentBox(n,i),h=s.l-(r.l-a.l),u=s.t-(r.t-a.t)}this.marginBox.l=h-this.marginBox.l,this.marginBox.t=u-this.marginBox.t,e&&e.onFirstMove&&e.onFirstMove(this,t),this.events.shift().remove()},destroy:function(){o.forEach(this.events,function(t){t.remove()});var t=this.host;t&&t.onMoveStop&&t.onMoveStop(this),this.events=this.node=this.host=null}})});