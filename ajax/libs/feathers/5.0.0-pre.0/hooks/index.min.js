"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return o[t]}})}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&__createBinding(o,e,t);return __setModuleDefault(o,e),o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.activateHooks=void 0;const hookCommons=__importStar(require("./commons")),hooks_1=require("@feathersjs/hooks"),base_1=require("./base"),baseHooks=[base_1.assignArguments,base_1.validate],{getHooks:getHooks,enableHooks:enableHooks,ACTIVATE_HOOKS:ACTIVATE_HOOKS,finallyWrapper:finallyWrapper,errorWrapper:errorWrapper,wrap:wrap}=hookCommons;function getContextUpdaters(e,o,t){const r=o.methods[t].map(e=>"params"===e?["params",{}]:e);return[hooks_1.withParams(...r),hooks_1.withProps({app:e,service:o,type:"before",get path(){return o&&e&&e.services?Object.keys(e.services).find(t=>e.services[t]===o):null}})]}function getCollector(e,o,t){return(r,s,n)=>{const a=[...hooks_1.getMiddleware(r),...s&&"function"==typeof s.collect?s.collect(s,s.original,n):[]];if("object"==typeof r)return a;const i={async:getHooks(e,o,"async",t),before:getHooks(e,o,"before",t),after:getHooks(e,o,"after",t,!0),error:getHooks(e,o,"error",t,!0),finally:getHooks(e,o,"finally",t,!0)};return[...finallyWrapper(i.finally),...errorWrapper(i.error),...baseHooks,...a,...wrap(i)]}}function withHooks(e,o,t){const r=t.reduce((t,r)=>"function"!=typeof o[r]?t:(t[r]={middleware:[],context:getContextUpdaters(e,o,r),collect:getCollector(e,o,r)},t),{});hooks_1.hooks(o,r)}function mixinMethod(){const e=Array.from(arguments),o=(!0===e[e.length-1]||e[e.length-1]instanceof hooks_1.HookContext)&&e.pop(),t=o instanceof hooks_1.HookContext?o:new hooks_1.HookContext;return this._super.call(this,...e,t).then(()=>o?t:t.result).catch(()=>void 0!==t.error&&void 0===t.result?Promise.reject(o?t:t.error):o?t:t.result)}const hookMixin=exports.hookMixin=function(e){if("function"==typeof e.hooks)return;e.methods=Object.getOwnPropertyNames(e).filter(o=>"function"==typeof e[o]&&e[o][ACTIVATE_HOOKS]).reduce((o,t)=>(o[t]=e[t][ACTIVATE_HOOKS],o),e.methods||{}),Object.assign(e.methods,{find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]});const o=Object.keys(e.methods);withHooks(this,e,o);const t=o.reduce((o,t)=>"function"!=typeof e[t]?o:(o[t]=mixinMethod,o),{});enableHooks(e,o,this.hookTypes),e.mixin(t)};function default_1(){return function(e){Object.assign(e,{hookTypes:["async","before","after","error","finally"]}),enableHooks(e,e.methods,e.hookTypes),e.mixins.push(hookMixin)}}function activateHooks(e){return o=>(Object.defineProperty(o,ACTIVATE_HOOKS,{value:e}),o)}exports.default=default_1,exports.activateHooks=activateHooks;