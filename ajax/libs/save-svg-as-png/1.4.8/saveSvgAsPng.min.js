"use strict";!function(){var a="undefined"!=typeof exports&&exports||"undefined"!=typeof define&&{}||this||window;"undefined"!=typeof define&&define("save-svg-as-png",[],function(){return a}),a.default=a;function w(t){if(!((e=t)instanceof HTMLElement||e instanceof SVGElement))throw new Error("an HTMLElement or SVGElement is required; got "+t);var e}function g(t,e,n){var r=t.viewBox&&t.viewBox.baseVal&&t.viewBox.baseVal[n]||null!==e.getAttribute(n)&&!e.getAttribute(n).match(/%$/)&&parseInt(e.getAttribute(n))||t.getBoundingClientRect()[n]||parseInt(e.style[n])||parseInt(window.getComputedStyle(t).getPropertyValue(n));return null==r||isNaN(parseFloat(r))?0:r}function i(t){for(var e=window.atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),o=new Uint8Array(r),i=0;i<e.length;i++)o[i]=e.charCodeAt(i);return new Blob([r],{type:n})}function c(t,e){var n=t.cssText.match(s),r=n&&n[1]||"";if(r&&!r.match(/^data:/)&&"about:blank"!==r){var o,i,a=r.startsWith("../")?e+"/../"+r:r.startsWith("./")?e+"/."+r:r;return{text:t.cssText,format:(o=a,(i=Object.keys(u).filter(function(t){return 0<o.indexOf("."+t)}).map(function(t){return u[t]}))?i[0]:(console.error("Unknown font format for "+o+". Fonts may not be working correctly."),"application/octet-stream")),url:a}}}function p(t){return Promise.all(Array.from(t.querySelectorAll("image")).map(function(o){var t,i=o.getAttributeNS("http://www.w3.org/1999/xlink","href")||o.getAttribute("href");return i?((t=i)&&0===t.lastIndexOf("http",0)&&-1===t.lastIndexOf(window.location.host)&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),new Promise(function(t,e){var n=document.createElement("canvas"),r=new Image;r.crossOrigin="anonymous",r.src=i,r.onerror=function(){return e(new Error("Could not load "+i))},r.onload=function(){n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0),o.setAttributeNS("http://www.w3.org/1999/xlink","href",n.toDataURL("image/png")),t(!0)}})):Promise.resolve(null)}))}function f(t){return Promise.all(t.map(function(o){return new Promise(function(n,t){if(l[o.url])return n(l[o.url]);var r=new XMLHttpRequest;r.addEventListener("load",function(){var t=function(t){for(var e="",n=new Uint8Array(t),r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return window.btoa(e)}(r.response),e=o.text.replace(s,'url("data:'+o.format+";base64,"+t+'")')+"\n";l[o.url]=e,n(e)}),r.addEventListener("error",function(t){console.warn("Failed to load font from: "+o.url,t),l[o.url]=null,n(null)}),r.addEventListener("abort",function(t){console.warn("Aborted loading font from: "+o.url,t),n(null)}),r.open("GET",o.url),r.responseType="arraybuffer",r.send()})})).then(function(t){return t.filter(function(t){return t}).join("")})}function m(r,t){var e=t||{},n=e.selectorRemap,o=e.modifyStyle,i=e.fonts,a=e.modifyCss||function(t,e){return(n?n(t):t)+"{"+(o?o(e):e)+"}\n"},s=[],u=void 0===i,l=i||[];return(d=d||Array.from(document.styleSheets).map(function(e){try{return{rules:e.cssRules,href:e.href}}catch(t){return console.warn("Stylesheet could not be loaded: "+e.href,t),{}}})).forEach(function(t){var e=t.rules,n=t.href;e&&Array.from(e).forEach(function(t){var e;void 0!==t.style&&(!function(t,e){if(e)try{return t.querySelector(e)||t.parentNode&&t.parentNode.querySelector(e)}catch(t){console.warn('Invalid CSS selector "'+e+'"',t)}}(r,t.selectorText)?u&&t.cssText.match(/^@font-face/)?(e=c(t,n))&&l.push(e):s.push(t.cssText):s.push(a(t.selectorText,t.style.cssText)))})}),f(l).then(function(t){return s.join("\n")+t})}var v="http://www.w3.org/2000/xmlns/",s=/url\(["']?(.+?)["']?\)/,u={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},l={},d=null;a.prepareSvg=function(n,r,u){w(n);var t=r||{},e=t.left,o=void 0===e?0:e,i=t.top,l=void 0===i?0:i,c=t.width,f=t.height,a=t.scale,d=void 0===a?1:a,s=t.responsive,h=void 0!==s&&s;return p(n).then(function(){var i=n.cloneNode(!0);i.style.backgroundColor=(r||{}).backgroundColor||n.style.backgroundColor;var t=function(t,e,n,r){if("svg"===t.tagName)return{width:n||g(t,e,"width"),height:r||g(t,e,"height")};if(t.getBBox){var o=t.getBBox(),i=o.x,a=o.y;return{width:i+o.width,height:a+o.height}}}(n,i,c,f),a=t.width,s=t.height;if("svg"!==n.tagName){if(!n.getBBox)return void console.error("Attempted to render non-SVG element",n);i.setAttribute("transform",i.getAttribute("transform").replace(/translate\(.*?\)/,""));var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.appendChild(i),i=e}return i.setAttribute("version","1.1"),i.setAttribute("viewBox",[o,l,a,s].join(" ")),i.getAttribute("xmlns")||i.setAttributeNS(v,"xmlns","http://www.w3.org/2000/svg"),i.getAttribute("xmlns:xlink")||i.setAttributeNS(v,"xmlns:xlink","http://www.w3.org/1999/xlink"),h?(i.removeAttribute("width"),i.removeAttribute("height"),i.setAttribute("preserveAspectRatio","xMinYMin meet")):(i.setAttribute("width",a*d),i.setAttribute("height",s*d)),Array.from(i.querySelectorAll("foreignObject > *")).forEach(function(t){t.getAttribute("xmlns")||t.setAttributeNS(v,"xmlns","http://www.w3.org/1999/xhtml")}),m(n,r).then(function(t){var e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML="<![CDATA[\n"+t+"\n]]>";var n=document.createElement("defs");n.appendChild(e),i.insertBefore(n,i.firstChild);var r=document.createElement("div");r.appendChild(i);var o=r.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if("function"!=typeof u)return{src:o,width:a,height:s};u(o,a,s)})})},a.svgAsDataUri=function(t,e,i){return w(t),a.prepareSvg(t,e).then(function(t){var e=t.src,n=t.width,r=t.height,o="data:image/svg+xml;base64,"+window.btoa(decodeURIComponent(encodeURIComponent('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>'+e).replace(/%([0-9A-F]{2})/g,function(t,e){var n=String.fromCharCode("0x"+e);return"%"===n?"%25":n})));return"function"==typeof i&&i(o,n,r),o})},a.svgAsPngUri=function(t,e,u){w(t);function o(t){var e=t.src,n=t.width,r=t.height,o=document.createElement("canvas"),i=o.getContext("2d"),a=window.devicePixelRatio||1;o.width=n*a,o.height=r*a,o.style.width=o.width+"px",o.style.height=o.height+"px",i.setTransform(a,0,0,a,0,0),f?f(o,e):i.drawImage(e,0,0);var s=void 0;try{s=o.toDataURL(l,c)}catch(t){if("undefined"!=typeof SecurityError&&t instanceof SecurityError||"SecurityError"===t.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw t}return"function"==typeof u&&u(s,o.width,o.height),Promise.resolve(s)}var n=e||{},r=n.encoderType,l=void 0===r?"image/png":r,i=n.encoderOptions,c=void 0===i?.8:i,f=n.canvg;return f?a.prepareSvg(t,e).then(o):a.svgAsDataUri(t,e).then(function(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(o({src:n,width:n.width,height:n.height}))},n.onerror=function(){e("There was an error loading the data URI as an image on the following SVG\n"+window.atob(r.slice(26))+"Open the following link to see browser's diagnosis\n"+r)},n.src=r})})},a.download=function(t,e){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(i(e),t);else{var n=document.createElement("a");if("download"in n){n.download=t,n.style.display="none",document.body.appendChild(n);try{var r=i(e),o=URL.createObjectURL(r);n.href=o,n.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(o)})}}catch(t){console.warn("This browser does not support object URLs. Falling back to string URL."),n.href=e}n.click(),document.body.removeChild(n)}else window.open(e,"_temp","menubar=no,toolbar=no,status=no")}},a.saveSvg=function(t,e,n){w(t),a.svgAsDataUri(t,n||{},function(t){return a.download(e,t)})},a.saveSvgAsPng=function(t,e,n){w(t),a.svgAsPngUri(t,n||{},function(t){return a.download(e,t)})}}();