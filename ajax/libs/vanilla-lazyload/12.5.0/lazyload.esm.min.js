const runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window,supportsClassList=runningOnBrowser&&"classList"in document.createElement("p"),defaultSettings={elements_selector:"img",container:isBot||runningOnBrowser?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_poster:"poster",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,auto_unobserve:!0,callback_enter:null,callback_exit:null,callback_reveal:null,callback_loaded:null,callback_error:null,callback_finish:null,use_native:!1};var getInstanceSettings=e=>Object.assign({},defaultSettings,e);const createInstance=function(e,t){var a;let s=new e(t);try{a=new CustomEvent("LazyLoad::Initialized",{detail:{instance:s}})}catch(e){(a=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:s})}window.dispatchEvent(a)};function autoInitialize(e,t){if(t)if(t.length)for(let a,s=0;a=t[s];s+=1)createInstance(e,a);else createInstance(e,t)}const dataPrefix="data-",processedDataName="was-processed",timeoutDataName="ll-timeout",trueString="true",getData=(e,t)=>e.getAttribute("data-"+t),setData=(e,t,a)=>{var s="data-"+t;null!==a?e.setAttribute(s,a):e.removeAttribute(s)},resetWasProcessedData=e=>setData(e,"was-processed",null),setWasProcessedData=e=>setData(e,"was-processed","true"),getWasProcessedData=e=>"true"===getData(e,"was-processed"),setTimeoutData=(e,t)=>setData(e,"ll-timeout",t),getTimeoutData=e=>getData(e,"ll-timeout"),purgeProcessedElements=e=>e.filter(e=>!getWasProcessedData(e)),purgeOneElement=(e,t)=>e.filter(e=>e!==t),safeCallback=(e,t,a,s)=>{e&&(void 0===s?void 0===a?e(t):e(t,a):e(t,a,s))},updateLoadingCount=(e,t)=>{e.loadingCount+=t,0===e._elements.length&&0===e.loadingCount&&safeCallback(e._settings.callback_finish,e)},getSourceTags=e=>{let t=[];for(let a,s=0;a=e.children[s];s+=1)"SOURCE"===a.tagName&&t.push(a);return t},setAttributeIfValue=(e,t,a)=>{a&&e.setAttribute(t,a)},setImageAttributes=(e,t)=>{setAttributeIfValue(e,"sizes",getData(e,t.data_sizes)),setAttributeIfValue(e,"srcset",getData(e,t.data_srcset)),setAttributeIfValue(e,"src",getData(e,t.data_src))},setSourcesImg=(e,t)=>{const a=e.parentNode;if(a&&"PICTURE"===a.tagName){getSourceTags(a).forEach(e=>{setImageAttributes(e,t)})}setImageAttributes(e,t)},setSourcesIframe=(e,t)=>{setAttributeIfValue(e,"src",getData(e,t.data_src))},setSourcesVideo=(e,t)=>{getSourceTags(e).forEach(e=>{setAttributeIfValue(e,"src",getData(e,t.data_src))}),setAttributeIfValue(e,"poster",getData(e,t.data_poster)),setAttributeIfValue(e,"src",getData(e,t.data_src)),e.load()},setSourcesBgImage=(e,t)=>{const a=getData(e,t.data_src),s=getData(e,t.data_bg);a&&(e.style.backgroundImage=`url("${a}")`),s&&(e.style.backgroundImage=s)},setSourcesFunctions={IMG:setSourcesImg,IFRAME:setSourcesIframe,VIDEO:setSourcesVideo},setSources=(e,t)=>{const a=t._settings,s=e.tagName,n=setSourcesFunctions[s];if(n)return n(e,a),updateLoadingCount(t,1),void(t._elements=purgeOneElement(t._elements,e));setSourcesBgImage(e,a)},addClass=(e,t)=>{supportsClassList?e.classList.add(t):e.className+=(e.className?" ":"")+t},removeClass=(e,t)=>{supportsClassList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},genericLoadEventName="load",mediaLoadEventName="loadeddata",errorEventName="error",addEventListener=(e,t,a)=>{e.addEventListener(t,a)},removeEventListener=(e,t,a)=>{e.removeEventListener(t,a)},addEventListeners=(e,t,a)=>{addEventListener(e,"load",t),addEventListener(e,"loadeddata",t),addEventListener(e,"error",a)},removeEventListeners=(e,t,a)=>{removeEventListener(e,"load",t),removeEventListener(e,"loadeddata",t),removeEventListener(e,"error",a)},eventHandler=function(e,t,a){var s=a._settings;const n=t?s.class_loaded:s.class_error,r=t?s.callback_loaded:s.callback_error,o=e.target;removeClass(o,s.class_loading),addClass(o,n),safeCallback(r,o,a),updateLoadingCount(a,-1)},addOneShotEventListeners=(e,t)=>{const a=n=>{eventHandler(n,!0,t),removeEventListeners(e,a,s)},s=n=>{eventHandler(n,!1,t),removeEventListeners(e,a,s)};addEventListeners(e,a,s)},managedTags=["IMG","IFRAME","VIDEO"],onEnter=(e,t,a)=>{const s=a._settings;safeCallback(s.callback_enter,e,t,a),s.load_delay?delayLoad(e,a):revealAndUnobserve(e,a)},revealAndUnobserve=(e,t)=>{var a=t._observer;revealElement(e,t),a&&t._settings.auto_unobserve&&a.unobserve(e)},onExit=(e,t,a)=>{const s=a._settings;safeCallback(s.callback_exit,e,t,a),s.load_delay&&cancelDelayLoad(e)},cancelDelayLoad=e=>{var t=getTimeoutData(e);t&&(clearTimeout(t),setTimeoutData(e,null))},delayLoad=(e,t)=>{var a=t._settings.load_delay,s=getTimeoutData(e);s||(s=setTimeout(function(){revealAndUnobserve(e,t),cancelDelayLoad(e)},a),setTimeoutData(e,s))},revealElement=(e,t,a)=>{var s=t._settings;!a&&getWasProcessedData(e)||(managedTags.indexOf(e.tagName)>-1&&(addOneShotEventListeners(e,t),addClass(e,s.class_loading)),setSources(e,t),setWasProcessedData(e),safeCallback(s.callback_reveal,e,t),safeCallback(s.callback_set,e,t))},isIntersecting=e=>e.isIntersecting||e.intersectionRatio>0,getObserverSettings=e=>({root:e.container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),setObserver=e=>!!supportsIntersectionObserver&&(e._observer=new IntersectionObserver(t=>{t.forEach(t=>isIntersecting(t)?onEnter(t.target,t,e):onExit(t.target,t,e))},getObserverSettings(e._settings)),!0),nativeLazyTags=["IMG","IFRAME"],shouldUseNative=e=>e.use_native&&"loading"in HTMLImageElement.prototype,loadAllNative=e=>{e._elements.forEach(t=>{-1!==nativeLazyTags.indexOf(t.tagName)&&(t.setAttribute("loading","lazy"),revealElement(t,e))})},nodeSetToArray=e=>Array.prototype.slice.call(e),queryElements=e=>e.container.querySelectorAll(e.elements_selector),getElements=(e,t)=>purgeProcessedElements(nodeSetToArray(e||queryElements(t))),retryLazyLoad=e=>{var t=e._settings;[...t.container.querySelectorAll("."+t.class_error)].forEach(e=>{removeClass(e,t.class_error),resetWasProcessedData(e)}),e.update()},setOnlineCheck=e=>{runningOnBrowser&&window.addEventListener("online",t=>{retryLazyLoad(e)})},LazyLoad=function(e,t){var a;this._settings=getInstanceSettings(e),this.loadingCount=0,setObserver(this),this.update(t),a=this,runningOnBrowser&&window.addEventListener("online",e=>{retryLazyLoad(a)})};LazyLoad.prototype={update:function(e){var t,a=this._settings;(this._elements=getElements(e,a),!isBot&&this._observer)?(shouldUseNative(a)&&((t=this)._elements.forEach(e=>{-1!==nativeLazyTags.indexOf(e.tagName)&&(e.setAttribute("loading","lazy"),revealElement(e,t))}),this._elements=getElements(e,a)),this._elements.forEach(e=>{this._observer.observe(e)})):this.loadAll()},destroy:function(){this._observer&&(this._elements.forEach(e=>{this._observer.unobserve(e)}),this._observer=null),this._elements=null,this._settings=null},load:function(e,t){revealElement(e,this,t)},loadAll:function(){this._elements.forEach(e=>{revealAndUnobserve(e,this)})}},runningOnBrowser&&autoInitialize(LazyLoad,window.lazyLoadOptions);export default LazyLoad;