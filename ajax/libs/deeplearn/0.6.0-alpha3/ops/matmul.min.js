"use strict";var __decorate=this&&this.__decorate||function(r,t,e,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(r,t,e,n);else for(var s=r.length-1;0<=s;s--)(a=r[s])&&(i=(o<3?a(i):3<o?a(t,e,i):a(t,e))||i);return 3<o&&i&&Object.defineProperty(t,e,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),MatmulOps=function(){function r(){}return r.matMul=function(t,e,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var r=n?t.shape[0]:t.shape[1],o=a?e.shape[1]:e.shape[0];util.assert(2===t.rank&&2===e.rank,"Error in matMul: inputs must be rank 2, got ranks "+t.rank+" and "+e.rank+"."),util.assert(r===o,"Error in matMul: inner shapes ("+r+") and ("+o+") of Tensors with shapes "+t.shape+" and "+e.shape+" and transposeA="+n+" and transposeB="+a+" must match.");return environment_1.ENV.engine.runKernel(function(r){return r.matMul(t,e,n,a)},{a:t,b:e},function(r){if(n||a)throw new Error("Backprop for transposed MatMul not yet implemented.");return{a:function(){return r.matMul(e.toFloat(),!1,!0)},b:function(){return t.toFloat().matMul(r,!0,!1)}}})},r.vectorTimesMatrix=function(r,t){return util.assert(1===r.rank,"Error in vectorTimesMatrix: first input must be rank 1, but got rank "+r.rank+"."),util.assert(2===t.rank,"Error in vectorTimesMatrix: second input must be rank 2, but got rank "+t.rank+"."),util.assert(r.size===t.shape[0],"Error in vectorTimesMatrix: size of vector ("+r.size+") must match first dimension of matrix ("+t.shape[0]+")"),r.as2D(1,-1).matMul(t).as1D()},r.matrixTimesVector=function(r,t){return util.assert(1===t.rank,"Error in matrixTimesVector: second input must rank 1, but got rank "+t.rank+"."),util.assert(2===r.rank,"Error in matrixTimesVector: first input must be a rank 2, but got rank "+r.rank+"."),util.assert(t.size===r.shape[1],"Error in matrixTimesVector: size of first rank 1 input "+t.size+" must match inner dimension of second rank 2 input, but got shape "+r.shape+"."),r.matMul(t.as2D(-1,1)).as1D()},r.dotProduct=function(r,t){return util.assert(1===r.rank&&1===t.rank,"Error in dotProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+t.rank+"."),util.assert(r.size===t.size,"Error in dotProduct: size of inputs ("+r.size+") and ("+t.size+") must match."),r.as2D(1,-1).matMul(t.as2D(-1,1)).asScalar()},r.outerProduct=function(r,t){return util.assert(1===r.rank&&1===t.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+t.rank+"."),r.as2D(-1,1).matMul(t.as2D(1,-1))},__decorate([doc_1.doc({heading:"Operations",subheading:"Matrices"}),operation_1.operation],r,"matMul",null),__decorate([operation_1.operation],r,"vectorTimesMatrix",null),__decorate([operation_1.operation],r,"matrixTimesVector",null),__decorate([operation_1.operation],r,"dotProduct",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Matrices"}),operation_1.operation],r,"outerProduct",null),r}();exports.MatmulOps=MatmulOps;