"use strict";var __extends=this&&this.__extends||function(){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(e,t){function a(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),optimizer_1=require("./optimizer"),RMSPropOptimizer=function(n){function e(e,t,a,s){void 0===t&&(t=.9),void 0===a&&(a=0),void 0===s&&(s=1e-8);var o=n.call(this)||this;return o.learningRate=e,o.accumulatedMeanSquares={},o.accumulatedMoments={},o.c=globals_1.keep(ops_1.scalar(e)),o.epsilon=globals_1.keep(ops_1.scalar(s)),o.decay=globals_1.keep(ops_1.scalar(t)),o.momentum=globals_1.keep(ops_1.scalar(a)),o.oneMinusDecay=globals_1.keep(ops_1.scalar(1-t)),o}return __extends(e,n),e.prototype.applyGradients=function(e){function t(s){var o=environment_1.ENV.engine.registeredVariables[s];null==a.accumulatedMeanSquares[s]&&globals_1.tidy(function(){u.accumulatedMeanSquares[s]=ops_1.zerosLike(o).variable(!1)}),null==a.accumulatedMoments[s]&&globals_1.tidy(function(){u.accumulatedMoments[s]=ops_1.zerosLike(o).variable(!1)});var n=a.accumulatedMeanSquares[s],i=a.accumulatedMoments[s],r=e[s];globals_1.tidy(function(){var e=u.decay.mul(n).add(u.oneMinusDecay.mul(r.square())),t=u.momentum.mul(i).add(u.c.mul(r).div(e.add(u.epsilon).sqrt()));u.accumulatedMeanSquares[s].assign(e),u.accumulatedMoments[s].assign(t);var a=o.sub(t);o.assign(a)})}var u=this,a=this;for(var s in e)t(s)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilon.dispose(),this.decay.dispose(),this.momentum.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return t.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return t.accumulatedMoments[e].dispose()})},e}(optimizer_1.Optimizer);exports.RMSPropOptimizer=RMSPropOptimizer;