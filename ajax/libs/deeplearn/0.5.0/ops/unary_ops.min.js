"use strict";var __decorate=this&&this.__decorate||function(e,n,t,r){var o,i=arguments.length,u=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,n,t,r);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(u=(i<3?o(u):3<i?o(n,t,u):o(n,t))||u);return 3<i&&u&&Object.defineProperty(n,t,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),ops=require("./ops"),ops_1=require("./ops"),selu_util=require("./selu_util"),Ops=function(){function r(){}return r.neg=function(e){return environment_1.ENV.engine.executeKernel("Neg",{inputs:{x:e}},function(e,n){return{x:function(){return e.neg()}}})},r.ceil=function(e){return environment_1.ENV.engine.executeKernel("Ceil",{inputs:{x:e}},function(e,n){return{x:function(){return ops.zeros(n.shape)}}})},r.floor=function(e){return environment_1.ENV.engine.executeKernel("Floor",{inputs:{x:e}},function(e,n){return{x:function(){return ops.zeros(n.shape)}}})},r.exp=function(e){return environment_1.ENV.engine.executeKernel("Exp",{inputs:{x:e}},function(e,n){return{x:function(){return e.mul(n)}}})},r.log=function(t){return environment_1.ENV.engine.executeKernel("Log",{inputs:{x:t}},function(e,n){return{x:function(){return e.div(t.toFloat())}}})},r.sqrt=function(t){return environment_1.ENV.engine.executeKernel("Sqrt",{inputs:{x:t}},function(e,n){return{x:function(){return e.div(t.toFloat().sqrt().mul(ops.scalar(2)))}}})},r.square=function(t){return environment_1.ENV.engine.executeKernel("Square",{inputs:{x:t}},function(e,n){return{x:function(){return e.mul(t.toFloat().mul(ops.scalar(2)))}}})},r.abs=function(t){return environment_1.ENV.engine.executeKernel("Abs",{inputs:{x:t}},function(e,n){return{x:function(){return e.mul(t.toFloat().step(-1))}}})},r.clipByValue=function(t,r,o){return util.assert(r<=o,"Error in clip: min ("+r+") must beless than or equal to max ("+o+")."),environment_1.ENV.engine.executeKernel("Clip",{inputs:{x:t},args:{min:r,max:o}},function(e,n){return{x:function(){return e.where(t.greater(ops.scalar(r)).logicalAnd(t.less(ops.scalar(o))),ops_1.zerosLike(e))}}})},r.relu=function(r){return environment_1.ENV.engine.executeKernel("Relu",{inputs:{x:r}},function(e,n){var t=r.step();return{x:function(){return e.mul(t.toFloat())}}})},r.elu=function(n){return environment_1.ENV.engine.executeKernel("Elu",{inputs:{x:n}},function(e){return{x:function(){return e.mul(eluDer(n))},alpha:function(){throw new Error("Derivative of prelu with respect to alpha is not implemented yet")}}})},r.selu=function(u){return environment_1.ENV.engine.executeKernel("Selu",{inputs:{x:u}},function(i,e){return{x:function(){var e=u.greater(ops.scalar(0)),n=ops.scalar(selu_util.SELU_SCALEALPHA),t=ops.scalar(selu_util.SELU_SCALE),r=i.mul(t),o=i.mul(n).mul(u.toFloat().exp());return ops.where(e,r,o)}}})},r.leakyRelu=function(t,r){void 0===r&&(r=.2);return environment_1.ENV.engine.executeKernel("LeakyRelu",{inputs:{x:t},args:{alpha:r}},function(e,n){return{x:function(){return e.mul(t.step(r))}}})},r.prelu=function(n,t){return environment_1.ENV.engine.executeKernel("PReLU",{inputs:{x:n,alpha:t}},function(e){return{x:function(){return e.mul(preluDer(n,t))},alpha:function(){throw new Error("Derivative of prelu with respect to alpha is not implemented yet")}}})},r.sigmoid=function(e){return environment_1.ENV.engine.executeKernel("Sigmoid",{inputs:{x:e}},function(e,n){return{x:function(){return e.mul(n.mul(ops.scalar(1).sub(n)))}}})},r.sin=function(t){return environment_1.ENV.engine.executeKernel("Sin",{inputs:{x:t}},function(e,n){return{x:function(){return t.toFloat().cos().mul(e)}}})},r.cos=function(t){return environment_1.ENV.engine.executeKernel("Cos",{inputs:{x:t}},function(e,n){return{x:function(){return t.toFloat().sin().neg().mul(e)}}})},r.tan=function(t){return environment_1.ENV.engine.executeKernel("Tan",{inputs:{x:t}},function(e,n){return{x:function(){return e.div(t.cos().square())}}})},r.asin=function(t){return environment_1.ENV.engine.executeKernel("Asin",{inputs:{x:t}},function(e,n){return{x:function(){return e.div(r.sqrt(ops.scalar(1).sub(t.toFloat().square())))}}})},r.acos=function(t){return environment_1.ENV.engine.executeKernel("Acos",{inputs:{x:t}},function(e,n){return{x:function(){return e.div(r.sqrt(ops.scalar(1).sub(t.toFloat().square()))).neg()}}})},r.atan=function(t){return environment_1.ENV.engine.executeKernel("Atan",{inputs:{x:t}},function(e,n){return{x:function(){return e.div(ops.scalar(1).add(t.toFloat().square()))}}})},r.sinh=function(t){return environment_1.ENV.engine.executeKernel("Sinh",{inputs:{x:t}},function(e,n){return{x:function(){return t.toFloat().cosh().mul(e)}}})},r.cosh=function(t){return environment_1.ENV.engine.executeKernel("Cosh",{inputs:{x:t}},function(e,n){return{x:function(){return t.toFloat().sinh().mul(e)}}})},r.tanh=function(e){return environment_1.ENV.engine.executeKernel("Tanh",{inputs:{x:e}},function(e,n){return{x:function(){return ops.scalar(1).sub(n.square()).mul(e)}}})},r.step=function(e,n){return void 0===n&&(n=0),environment_1.ENV.engine.executeKernel("Step",{inputs:{x:e},args:{alpha:n}},function(e,n){return{x:function(){return ops.zeros(n.shape)}}})},__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"neg",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"ceil",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"floor",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"exp",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"log",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"sqrt",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"square",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"abs",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"clipByValue",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"relu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"elu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"selu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"leakyRelu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"prelu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"sigmoid",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"sin",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"cos",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"tan",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"asin",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"acos",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"atan",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"sinh",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"cosh",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"tanh",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],r,"step",null),r}();function preluDer(e,n){return environment_1.ENV.engine.executeKernel("PReLUDer",{inputs:{x:e,alpha:n}})}function eluDer(e){return environment_1.ENV.engine.executeKernel("EluDer",{inputs:{x:e}})}exports.Ops=Ops;