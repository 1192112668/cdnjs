"use strict";var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(o,i,s,u){return new(s=s||Promise)(function(t,e){function r(t){try{a(u.next(t))}catch(t){e(t)}}function n(t){try{a(u.throw(t))}catch(t){e(t)}}function a(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(r,n)}a((u=u.apply(o,i||[])).next())})},__generator=this&&this.__generator||function(r,n){var a,o,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,o&&(i=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(i=i.call(o,e[1])).done)return i;switch(o=0,i&&(e=[0,i.value]),e[0]){case 0:case 1:i=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){s.label=e[1];break}if(6===e[0]&&s.label<i[1]){s.label=i[1],i=e;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(e);break}i[2]&&s.ops.pop(),s.trys.pop();continue}e=n.call(r,s)}catch(t){e=[6,t],o=0}finally{a=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),batch_dataset_1=require("./batch_dataset"),statistics_1=require("./statistics"),data_stream_1=require("./streams/data_stream"),data_stream_2=require("./streams/data_stream"),data_stream_3=require("./streams/data_stream"),Dataset=function(){function t(){}return t.prototype.computeStatistics=function(e,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,statistics_1.computeDatasetStatistics(this,e,r)]})})},t.prototype.filter=function(e){var t=this,r=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r.getStream()];case 1:return[2,t.sent().filter(e)]}})})})},t.prototype.map=function(e){var t=this,r=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r.getStream()];case 1:return[2,t.sent().map(e)]}})})})},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new batch_dataset_1.BatchDataset(this,t,e)},t.prototype.concatenate=function(n){var t=this,a=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){var e,r;return __generator(this,function(t){switch(t.label){case 0:return[4,a.getStream()];case 1:return r=(e=t.sent()).concatenate,[4,n.getStream()];case 2:return[2,r.apply(e,[t.sent()])]}})})})},t.prototype.repeat=function(r){var t=this,n=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=data_stream_2.streamFromFunction(function(){return n.getStream()}),[4,data_stream_1.streamFromConcatenated(e.take(r))];case 1:return[2,t.sent()]}})})})},t.prototype.take=function(e){var t=this,r=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r.getStream()];case 1:return[2,t.sent().take(e)]}})})})},t.prototype.skip=function(e){var t=this,r=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r.getStream()];case 1:return[2,t.sent().skip(e)]}})})})},t.prototype.shuffle=function(r,t,n){var e=this;void 0===n&&(n=!0);var a=this,o=seedrandom(t);return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=o.int32(),n&&(e+=o.int32()),[4,a.getStream()];case 1:return[2,t.sent().shuffle(r,e.toString())]}})})})},t.prototype.prefetch=function(e){var t=this,r=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r.getStream()];case 1:return[2,t.sent().prefetch(e)]}})})})},t}();function datasetFromStreamFn(e){return __extends(t,r=Dataset),t.prototype.getStream=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,e()]})})},new t;function t(){return null!==r&&r.apply(this,arguments)||this}var r}function datasetFromElements(e){var t=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return[2,Promise.resolve(data_stream_3.streamFromItems(e))]})})})}function datasetFromConcatenated(r){var t=this;return datasetFromStreamFn(function(){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(r.map(function(t){return t.getStream()}))];case 1:return e=t.sent(),[2,data_stream_1.streamFromConcatenated(data_stream_3.streamFromItems(e))]}})})})}exports.Dataset=Dataset,exports.datasetFromStreamFn=datasetFromStreamFn,exports.datasetFromElements=datasetFromElements,exports.datasetFromConcatenated=datasetFromConcatenated;