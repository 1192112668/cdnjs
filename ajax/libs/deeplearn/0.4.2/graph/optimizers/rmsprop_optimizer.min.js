"use strict";var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var ndarray_1=require("../../math/ndarray"),optimizer_1=require("../../math/optimizers/optimizer"),tensor_array_map_1=require("../tensor_array_map"),RMSPropOptimizer=function(s){function t(t,e,r){var a=s.call(this,t,r)||this;return a.learningRate=t,a.gamma=e,a.accumulatedSquaredGradients=new tensor_array_map_1.TensorArrayMap,a.eps=ndarray_1.Scalar.new(1e-6),a.g=ndarray_1.Scalar.new(a.gamma),a}return __extends(t,s),t.prototype.applyGradients=function(t){throw new Error("RMSProp optimizer not yet implemented for eager mode.")},t.prototype.beforeBatch=function(t,e,r,a,o){var i=this;s.prototype.beforeBatch.call(this,t,e,r,a,o),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach(function(t){i.accumulatedSquaredGradients.set(t.output,ndarray_1.NDArray.zeros(t.output.shape))})},t.prototype.afterBatch=function(p,t,e,u,r){var d=this;p.scope(function(n){d.variableNodes.forEach(function(t){var e=u.get(t.output),r=d.variableGradients.get(t.output),a=d.accumulatedSquaredGradients.get(t.output),o=p.multiply(r,r),i=p.scaledArrayAdd(d.g,a,p.subtract(d.one,d.g),o),s=p.scaledArrayAdd(d.cGraph,p.divide(r,p.add(p.sqrt(i),d.eps)),d.one,e);d.accumulatedSquaredGradients.set(t.output,n(i)),u.set(t.output,n(s)),t.data=s,e.dispose(),a.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){s.prototype.dispose.call(this),this.eps.dispose(),this.g.dispose(),this.accumulatedSquaredGradients.dispose()},t}(optimizer_1.Optimizer);exports.RMSPropOptimizer=RMSPropOptimizer;