"use strict";var __extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var ndarray_1=require("../../math/ndarray"),sgd_optimizer_1=require("../../math/optimizers/sgd_optimizer"),tensor_array_map_1=require("../tensor_array_map"),MomentumOptimizer=function(n){function t(t,e,r){var o=n.call(this,t,r)||this;return o.learningRate=t,o.momentum=e,o.variableVelocities=new tensor_array_map_1.TensorArrayMap,o.m=ndarray_1.Scalar.new(o.momentum),o}return __extends(t,n),t.prototype.applyGradients=function(t){throw new Error("Momentum optimizer not yet implemented for eager mode.")},t.prototype.beforeBatch=function(t,e,r,o,i){var a=this;n.prototype.beforeBatch.call(this,t,e,r,o,i),0===this.variableVelocities.size()&&this.variableNodes.forEach(function(t){a.variableVelocities.set(t.output,ndarray_1.NDArray.zeros(t.output.shape))})},t.prototype.afterBatch=function(s,t,e,p,r){var u=this;s.scope(function(n){u.variableNodes.forEach(function(t){var e=p.get(t.output),r=u.variableGradients.get(t.output),o=u.variableVelocities.get(t.output),i=s.scaledArrayAdd(u.m,o,u.one,r),a=s.scaledArrayAdd(u.cGraph,i,u.one,e);u.variableVelocities.set(t.output,n(i)),p.set(t.output,n(a)),t.data=a,e.dispose(),o.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){n.prototype.dispose.call(this),this.m.dispose(),this.variableVelocities.dispose()},t.prototype.setMomentum=function(t){this.momentum=t},t}(sgd_optimizer_1.SGDOptimizer);exports.MomentumOptimizer=MomentumOptimizer;