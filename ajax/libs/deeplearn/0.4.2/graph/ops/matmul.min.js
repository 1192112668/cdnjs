"use strict";var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var matmul_1=require("../../math/backends/types/matmul"),graph_util=require("../graph_util"),op_1=require("./op"),MatMul=function(s){function e(e,t,r){var n=s.call(this)||this;return n.x1Tensor=e,n.x2Tensor=t,n.yTensor=r,n}return __extends(e,s),e.prototype.feedForward=function(t,r){var n=this,s=r.get(this.x1Tensor),o=r.get(this.x2Tensor);t.scope(function(e){2===s.shape.length&&2===o.shape.length?r.set(n.yTensor,e(t.matMul(s,o))):2===s.shape.length&&1===o.shape.length?r.set(n.yTensor,e(t.matrixTimesVector(s,o))):1===s.shape.length&&2===o.shape.length&&r.set(n.yTensor,e(t.vectorTimesMatrix(s,o)))})},e.prototype.backProp=function(r,e,n){var s=this,o=e.get(this.x1Tensor),a=e.get(this.x2Tensor),i=n.get(this.yTensor);1===o.shape.length&&(o=o.reshape([1,o.size]),i=i.reshape([1,i.size])),1===a.shape.length&&(a=a.reshape([a.size,1]),i=i.reshape([i.size,1])),r.scope(function(){var e,t;graph_util.shouldBackProp(s.x1Tensor)&&(e=r.matMul(i,a,matmul_1.MatrixOrientation.REGULAR,matmul_1.MatrixOrientation.TRANSPOSED),n.add(s.x1Tensor,1===s.x1Tensor.shape.length?e.as1D():e)),graph_util.shouldBackProp(s.x2Tensor)&&(t=r.matMul(o,i,matmul_1.MatrixOrientation.TRANSPOSED,matmul_1.MatrixOrientation.REGULAR),n.add(s.x2Tensor,1===s.x2Tensor.shape.length?t.as1D():t))})},e}(op_1.Operation);exports.MatMul=MatMul;