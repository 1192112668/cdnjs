"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ndarray_1=require("../math/ndarray"),MANIFEST_FILE="manifest.json",CheckpointLoader=function(){function e(e){this.urlPath=e,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}return e.prototype.loadManifest=function(){var r=this;return new Promise(function(e,n){var t=new XMLHttpRequest;t.open("GET",r.urlPath+MANIFEST_FILE),t.onload=function(){r.checkpointManifest=JSON.parse(t.responseText),e()},t.onerror=function(e){throw new Error(MANIFEST_FILE+" not found at "+r.urlPath+". "+e)},t.send()})},e.prototype.getCheckpointManifest=function(){var t=this;return null==this.checkpointManifest?new Promise(function(e,n){t.loadManifest().then(function(){e(t.checkpointManifest)})}):new Promise(function(e,n){e(t.checkpointManifest)})},e.prototype.getAllVariables=function(){var i=this;return null!=this.variables?new Promise(function(e,n){e(i.variables)}):new Promise(function(o,e){i.getCheckpointManifest().then(function(e){for(var t=Object.keys(i.checkpointManifest),n=[],r=0;r<t.length;r++)n.push(i.getVariable(t[r]));Promise.all(n).then(function(e){i.variables={};for(var n=0;n<e.length;n++)i.variables[t[n]]=e[n];o(i.variables)})})})},e.prototype.getVariable=function(o){var i=this;if(!(o in this.checkpointManifest))throw new Error("Cannot load non-existant variable "+o);function t(t,e){var r=new XMLHttpRequest;r.responseType="arraybuffer";var n=i.checkpointManifest[o].filename;r.open("GET",i.urlPath+n),r.onload=function(){if(404===r.status)throw new Error("Not found variable "+o);var e=new Float32Array(r.response),n=ndarray_1.NDArray.make(i.checkpointManifest[o].shape,{values:e});t(n)},r.onerror=function(e){throw new Error("Could not fetch variable "+o+": "+e)},r.send()}return null==this.checkpointManifest?new Promise(function(e,n){i.loadManifest().then(function(){new Promise(t).then(e)})}):new Promise(t)},e}();exports.CheckpointLoader=CheckpointLoader;