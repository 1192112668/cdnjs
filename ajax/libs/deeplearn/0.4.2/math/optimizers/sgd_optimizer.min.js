"use strict";var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),tensor_array_map_1=require("../../graph/tensor_array_map"),ndarray_1=require("../ndarray"),optimizer_1=require("./optimizer"),SGDOptimizer=function(n){function t(t,e){var r=n.call(this,t,e)||this;return r.learningRate=t,r.setLearningRate(t),r}return __extends(t,n),t.prototype.applyGradients=function(i){var a=this,o=environment_1.ENV.math;Object.keys(i).forEach(function(t){var e=i[t],r=o.registeredVariables[t],n=o.scope(function(){return o.add(o.multiply(a.c,e),r)});r.assign(n)})},t.prototype.afterBatch=function(a,t,e,o,r){var s=this;a.scope(function(i){s.variableNodes.forEach(function(t){var e=o.get(t.output),r=s.variableGradients.get(t.output),n=a.scaledArrayAdd(s.cGraph,r,s.one,e);o.set(t.output,i(n)),t.data=n,e.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){this.c.dispose(),n.prototype.dispose.call(this)},t.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=environment_1.ENV.math.keep(ndarray_1.Scalar.new(-t))},t}(optimizer_1.Optimizer);exports.SGDOptimizer=SGDOptimizer;