"use strict";var __extends=this&&this.__extends||function(){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(e,t){function a(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),optimizer_1=require("./optimizer"),AdadeltaOptimizer=function(o){function e(e,t,a){void 0===a&&(a=1e-8);var s=o.call(this)||this;return s.accumulatedGrads={},s.accumulatedUpdates={},s.c=globals_1.keep(ops_1.scalar(-e)),s.epsilon=globals_1.keep(ops_1.scalar(a)),s.rho=globals_1.keep(ops_1.scalar(t)),s.oneMinusRho=globals_1.keep(ops_1.scalar(1-t)),s}return __extends(e,o),e.prototype.applyGradients=function(e){function t(o){var r=environment_1.ENV.engine.registeredVariables[o];null==a.accumulatedGrads[o]&&globals_1.tidy(function(){l.accumulatedGrads[o]=ops_1.zerosLike(r).variable(!1)}),null==a.accumulatedUpdates[o]&&globals_1.tidy(function(){l.accumulatedUpdates[o]=ops_1.zerosLike(r).variable(!1)});var i=e[o],n=a.accumulatedGrads[o],u=a.accumulatedUpdates[o];globals_1.tidy(function(){var e=l.rho.mul(n).add(l.oneMinusRho.mul(i.square())),t=u.add(l.epsilon).sqrt().div(n.add(l.epsilon).sqrt()).mul(i),a=l.rho.mul(u).add(l.oneMinusRho.mul(t.square()));l.accumulatedGrads[o].assign(e),l.accumulatedUpdates[o].assign(a);var s=l.c.mul(t).add(r);r.assign(s)})}var l=this,a=this;for(var s in e)t(s)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilon.dispose(),this.rho.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return t.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()}))},e}(optimizer_1.Optimizer);exports.AdadeltaOptimizer=AdadeltaOptimizer;