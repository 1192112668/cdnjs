"use strict";var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),optimizer_1=require("./optimizer"),AdagradOptimizer=function(a){function e(e,t){void 0===t&&(t=.1);var r=a.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=t,r.accumulatedGrads={},r.c=globals_1.keep(ops_1.scalar(-e)),r.epsilon=globals_1.keep(ops_1.scalar(1e-8)),r}return __extends(e,a),e.prototype.applyGradients=function(e){function t(r){var a=environment_1.ENV.engine.registeredVariables[r];null==n.accumulatedGrads[r]&&globals_1.tidy(function(){s.accumulatedGrads[r]=ops_1.fill(a.shape,s.initialAccumulatorValue).variable(!1)});var i=e[r],o=n.accumulatedGrads[r];globals_1.tidy(function(){var e=o.add(i.square());s.accumulatedGrads[r].assign(e);var t=s.c.mul(i.div(e.add(s.epsilon).sqrt())).add(a);a.assign(t)})}var s=this,n=this;for(var r in e)t(r)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},e}(optimizer_1.Optimizer);exports.AdagradOptimizer=AdagradOptimizer;