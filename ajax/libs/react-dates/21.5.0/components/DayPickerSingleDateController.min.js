"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _enzymeShallowEqual=_interopRequireDefault(require("enzyme-shallow-equal")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactMomentProptypes=_interopRequireDefault(require("react-moment-proptypes")),_airbnbPropTypes=require("airbnb-prop-types"),_moment=_interopRequireDefault(require("moment")),_object=_interopRequireDefault(require("object.values")),_isTouchDevice=_interopRequireDefault(require("is-touch-device")),_defaultPhrases=require("../defaultPhrases"),_getPhrasePropTypes=_interopRequireDefault(require("../utils/getPhrasePropTypes")),_isSameDay=_interopRequireDefault(require("../utils/isSameDay")),_isAfterDay=_interopRequireDefault(require("../utils/isAfterDay")),_getVisibleDays=_interopRequireDefault(require("../utils/getVisibleDays")),_toISODateString=_interopRequireDefault(require("../utils/toISODateString")),_modifiers=require("../utils/modifiers"),_ScrollableOrientationShape=_interopRequireDefault(require("../shapes/ScrollableOrientationShape")),_DayOfWeekShape=_interopRequireDefault(require("../shapes/DayOfWeekShape")),_CalendarInfoPositionShape=_interopRequireDefault(require("../shapes/CalendarInfoPositionShape")),_NavPositionShape=_interopRequireDefault(require("../shapes/NavPositionShape")),_constants=require("../constants"),_DayPicker=_interopRequireDefault(require("./DayPicker")),_getPooledMoment=_interopRequireDefault(require("../utils/getPooledMoment"));function ownKeys(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(n,!0).forEach(function(e){(0,_defineProperty2.default)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var propTypes="production"!==process.env.NODE_ENV?(0,_airbnbPropTypes.forbidExtraProps)({date:_reactMomentProptypes.default.momentObj,onDateChange:_propTypes.default.func,focused:_propTypes.default.bool,onFocusChange:_propTypes.default.func,onClose:_propTypes.default.func,keepOpenOnDateSelect:_propTypes.default.bool,isOutsideRange:_propTypes.default.func,isDayBlocked:_propTypes.default.func,isDayHighlighted:_propTypes.default.func,renderMonthText:(0,_airbnbPropTypes.mutuallyExclusiveProps)(_propTypes.default.func,"renderMonthText","renderMonthElement"),renderMonthElement:(0,_airbnbPropTypes.mutuallyExclusiveProps)(_propTypes.default.func,"renderMonthText","renderMonthElement"),renderWeekHeaderElement:_propTypes.default.func,enableOutsideDays:_propTypes.default.bool,numberOfMonths:_propTypes.default.number,orientation:_ScrollableOrientationShape.default,withPortal:_propTypes.default.bool,initialVisibleMonth:_propTypes.default.func,firstDayOfWeek:_DayOfWeekShape.default,hideKeyboardShortcutsPanel:_propTypes.default.bool,daySize:_airbnbPropTypes.nonNegativeInteger,verticalHeight:_airbnbPropTypes.nonNegativeInteger,noBorder:_propTypes.default.bool,verticalBorderSpacing:_airbnbPropTypes.nonNegativeInteger,transitionDuration:_airbnbPropTypes.nonNegativeInteger,horizontalMonthPadding:_airbnbPropTypes.nonNegativeInteger,dayPickerNavigationInlineStyles:_propTypes.default.object,navPosition:_NavPositionShape.default,navPrev:_propTypes.default.node,navNext:_propTypes.default.node,renderNavPrevButton:_propTypes.default.func,renderNavNextButton:_propTypes.default.func,onPrevMonthClick:_propTypes.default.func,onNextMonthClick:_propTypes.default.func,onOutsideClick:_propTypes.default.func,renderCalendarDay:_propTypes.default.func,renderDayContents:_propTypes.default.func,renderCalendarInfo:_propTypes.default.func,calendarInfoPosition:_CalendarInfoPositionShape.default,onBlur:_propTypes.default.func,isFocused:_propTypes.default.bool,showKeyboardShortcuts:_propTypes.default.bool,onTab:_propTypes.default.func,onShiftTab:_propTypes.default.func,monthFormat:_propTypes.default.string,weekDayFormat:_propTypes.default.string,phrases:_propTypes.default.shape((0,_getPhrasePropTypes.default)(_defaultPhrases.DayPickerPhrases)),dayAriaLabelFormat:_propTypes.default.string,isRTL:_propTypes.default.bool}):{},defaultProps={date:void 0,onDateChange:function(){},focused:!1,onFocusChange:function(){},onClose:function(){},keepOpenOnDateSelect:!1,isOutsideRange:function(){},isDayBlocked:function(){},isDayHighlighted:function(){},renderMonthText:null,renderWeekHeaderElement:null,enableOutsideDays:!1,numberOfMonths:1,orientation:_constants.HORIZONTAL_ORIENTATION,withPortal:!1,hideKeyboardShortcutsPanel:!1,initialVisibleMonth:null,firstDayOfWeek:null,daySize:_constants.DAY_SIZE,verticalHeight:null,noBorder:!1,verticalBorderSpacing:void 0,transitionDuration:void 0,horizontalMonthPadding:13,dayPickerNavigationInlineStyles:null,navPosition:_constants.NAV_POSITION_TOP,navPrev:null,navNext:null,renderNavPrevButton:null,renderNavNextButton:null,onPrevMonthClick:function(){},onNextMonthClick:function(){},onOutsideClick:function(){},renderCalendarDay:void 0,renderDayContents:null,renderCalendarInfo:null,renderMonthElement:null,calendarInfoPosition:_constants.INFO_POSITION_BOTTOM,onBlur:function(){},isFocused:!1,showKeyboardShortcuts:!1,onTab:function(){},onShiftTab:function(){},monthFormat:"MMMM YYYY",weekDayFormat:"dd",phrases:_defaultPhrases.DayPickerPhrases,dayAriaLabelFormat:void 0,isRTL:!1},DayPickerSingleDateController=function(o){(0,_inheritsLoose2.default)(t,o);var e=t.prototype;function t(t){var n=o.call(this,t)||this;n.isTouchDevice=!1,n.today=(0,_moment.default)(),n.modifiers={today:function(e){return n.isToday(e)},blocked:function(e){return n.isBlocked(e)},"blocked-calendar":function(e){return t.isDayBlocked(e)},"blocked-out-of-range":function(e){return t.isOutsideRange(e)},"highlighted-calendar":function(e){return t.isDayHighlighted(e)},valid:function(e){return!n.isBlocked(e)},hovered:function(e){return n.isHovered(e)},selected:function(e){return n.isSelected(e)},"first-day-of-week":function(e){return n.isFirstDayOfWeek(e)},"last-day-of-week":function(e){return n.isLastDayOfWeek(e)}};var e=n.getStateForNewMonth(t),i=e.currentMonth,r=e.visibleDays;return n.state={hoverDate:null,currentMonth:i,visibleDays:r},n.onDayMouseEnter=n.onDayMouseEnter.bind((0,_assertThisInitialized2.default)(n)),n.onDayMouseLeave=n.onDayMouseLeave.bind((0,_assertThisInitialized2.default)(n)),n.onDayClick=n.onDayClick.bind((0,_assertThisInitialized2.default)(n)),n.onPrevMonthClick=n.onPrevMonthClick.bind((0,_assertThisInitialized2.default)(n)),n.onNextMonthClick=n.onNextMonthClick.bind((0,_assertThisInitialized2.default)(n)),n.onMonthChange=n.onMonthChange.bind((0,_assertThisInitialized2.default)(n)),n.onYearChange=n.onYearChange.bind((0,_assertThisInitialized2.default)(n)),n.onMultiplyScrollableMonths=n.onMultiplyScrollableMonths.bind((0,_assertThisInitialized2.default)(n)),n.getFirstFocusableDay=n.getFirstFocusableDay.bind((0,_assertThisInitialized2.default)(n)),n}return e[!_react.default.PureComponent&&"shouldComponentUpdate"]=function(e,t){return!(0,_enzymeShallowEqual.default)(this.props,e)||!(0,_enzymeShallowEqual.default)(this.state,t)},e.componentDidMount=function(){this.isTouchDevice=(0,_isTouchDevice.default)()},e.componentWillReceiveProps=function(e){var n=this,t=e.date,i=e.focused,r=e.isOutsideRange,o=e.isDayBlocked,a=e.isDayHighlighted,s=e.initialVisibleMonth,l=e.numberOfMonths,u=e.enableOutsideDays,d=this.props,f=d.isOutsideRange,c=d.isDayBlocked,h=d.isDayHighlighted,p=d.numberOfMonths,y=d.enableOutsideDays,b=d.initialVisibleMonth,D=d.focused,_=d.date,v=this.state.visibleDays,M=!1,g=!1,m=!1;r!==f&&(this.modifiers["blocked-out-of-range"]=function(e){return r(e)},M=!0),o!==c&&(this.modifiers["blocked-calendar"]=function(e){return o(e)},g=!0),a!==h&&(this.modifiers["highlighted-calendar"]=function(e){return a(e)},m=!0);var O,T,P=M||g||m;(l!==p||u!==y||s!==b&&!D&&i)&&(T=(O=this.getStateForNewMonth(e)).currentMonth,v=O.visibleDays,this.setState({currentMonth:T,visibleDays:v}));var k=i!==D,S={};t!==_&&(S=this.deleteModifier(S,_,"selected"),S=this.addModifier(S,t,"selected")),(k||P)&&(0,_object.default)(v).forEach(function(e){Object.keys(e).forEach(function(e){var t=(0,_getPooledMoment.default)(e);S=n.isBlocked(t)?n.addModifier(S,t,"blocked"):n.deleteModifier(S,t,"blocked"),(k||M)&&(S=r(t)?n.addModifier(S,t,"blocked-out-of-range"):n.deleteModifier(S,t,"blocked-out-of-range")),(k||g)&&(S=o(t)?n.addModifier(S,t,"blocked-calendar"):n.deleteModifier(S,t,"blocked-calendar")),(k||m)&&(S=a(t)?n.addModifier(S,t,"highlighted-calendar"):n.deleteModifier(S,t,"highlighted-calendar"))})});var C=(0,_moment.default)();(0,_isSameDay.default)(this.today,C)||(S=this.deleteModifier(S,this.today,"today"),S=this.addModifier(S,C,"today"),this.today=C),0<Object.keys(S).length&&this.setState({visibleDays:_objectSpread({},v,{},S)})},e.componentWillUpdate=function(){this.today=(0,_moment.default)()},e.onDayClick=function(e,t){var n,i,r,o,a;t&&t.preventDefault(),this.isBlocked(e)||(i=(n=this.props).onDateChange,r=n.keepOpenOnDateSelect,o=n.onFocusChange,a=n.onClose,i(e),r||(o({focused:!1}),a({date:e})))},e.onDayMouseEnter=function(e){var t,n,i,r;this.isTouchDevice||(n=(t=this.state).hoverDate,i=t.visibleDays,r=this.deleteModifier({},n,"hovered"),r=this.addModifier(r,e,"hovered"),this.setState({hoverDate:e,visibleDays:_objectSpread({},i,{},r)}))},e.onDayMouseLeave=function(){var e,t=this.state,n=t.hoverDate,i=t.visibleDays;!this.isTouchDevice&&n&&(e=this.deleteModifier({},n,"hovered"),this.setState({hoverDate:null,visibleDays:_objectSpread({},i,{},e)}))},e.onPrevMonthClick=function(){var e=this.props,t=e.onPrevMonthClick,n=e.numberOfMonths,i=e.enableOutsideDays,r=this.state,o=r.currentMonth,a=r.visibleDays,s={};Object.keys(a).sort().slice(0,n+1).forEach(function(e){s[e]=a[e]});var l=o.clone().subtract(1,"month"),u=(0,_getVisibleDays.default)(l,1,i);this.setState({currentMonth:l,visibleDays:_objectSpread({},s,{},this.getModifiers(u))},function(){t(l.clone())})},e.onNextMonthClick=function(){var e=this.props,t=e.onNextMonthClick,n=e.numberOfMonths,i=e.enableOutsideDays,r=this.state,o=r.currentMonth,a=r.visibleDays,s={};Object.keys(a).sort().slice(1).forEach(function(e){s[e]=a[e]});var l=o.clone().add(n,"month"),u=(0,_getVisibleDays.default)(l,1,i),d=o.clone().add(1,"month");this.setState({currentMonth:d,visibleDays:_objectSpread({},s,{},this.getModifiers(u))},function(){t(d.clone())})},e.onMonthChange=function(e){var t=this.props,n=t.numberOfMonths,i=t.enableOutsideDays,r=t.orientation===_constants.VERTICAL_SCROLLABLE,o=(0,_getVisibleDays.default)(e,n,i,r);this.setState({currentMonth:e.clone(),visibleDays:this.getModifiers(o)})},e.onYearChange=function(e){var t=this.props,n=t.numberOfMonths,i=t.enableOutsideDays,r=t.orientation===_constants.VERTICAL_SCROLLABLE,o=(0,_getVisibleDays.default)(e,n,i,r);this.setState({currentMonth:e.clone(),visibleDays:this.getModifiers(o)})},e.onMultiplyScrollableMonths=function(){var e=this.props,t=e.numberOfMonths,n=e.enableOutsideDays,i=this.state,r=i.currentMonth,o=i.visibleDays,a=Object.keys(o).length,s=r.clone().add(a,"month"),l=(0,_getVisibleDays.default)(s,t,n,!0);this.setState({visibleDays:_objectSpread({},o,{},this.getModifiers(l))})},e.getFirstFocusableDay=function(e){var t=this,n=this.props,i=n.date,r=n.numberOfMonths,o=e.clone().startOf("month");if(i&&(o=i.clone()),this.isBlocked(o)){for(var a=[],s=e.clone().add(r-1,"months").endOf("month"),l=o.clone();!(0,_isAfterDay.default)(l,s);)l=l.clone().add(1,"day"),a.push(l);var u=a.filter(function(e){return!t.isBlocked(e)&&(0,_isAfterDay.default)(e,o)});0<u.length&&(o=(0,_slicedToArray2.default)(u,1)[0])}return o},e.getModifiers=function(e){var n=this,i={};return Object.keys(e).forEach(function(t){i[t]={},e[t].forEach(function(e){i[t][(0,_toISODateString.default)(e)]=n.getModifiersForDay(e)})}),i},e.getModifiersForDay=function(t){var n=this;return new Set(Object.keys(this.modifiers).filter(function(e){return n.modifiers[e](t)}))},e.getStateForNewMonth=function(e){var t=this,n=e.initialVisibleMonth,i=e.date,r=e.numberOfMonths,o=e.orientation,a=e.enableOutsideDays,s=(n||(i?function(){return i}:function(){return t.today}))(),l=o===_constants.VERTICAL_SCROLLABLE;return{currentMonth:s,visibleDays:this.getModifiers((0,_getVisibleDays.default)(s,r,a,l))}},e.addModifier=function(e,t,n){return(0,_modifiers.addModifier)(e,t,n,this.props,this.state)},e.deleteModifier=function(e,t,n){return(0,_modifiers.deleteModifier)(e,t,n,this.props,this.state)},e.isBlocked=function(e){var t=this.props,n=t.isDayBlocked,i=t.isOutsideRange;return n(e)||i(e)},e.isHovered=function(e){var t=(this.state||{}).hoverDate;return(0,_isSameDay.default)(e,t)},e.isSelected=function(e){var t=this.props.date;return(0,_isSameDay.default)(e,t)},e.isToday=function(e){return(0,_isSameDay.default)(e,this.today)},e.isFirstDayOfWeek=function(e){var t=this.props.firstDayOfWeek;return e.day()===(t||_moment.default.localeData().firstDayOfWeek())},e.isLastDayOfWeek=function(e){var t=this.props.firstDayOfWeek;return e.day()===((t||_moment.default.localeData().firstDayOfWeek())+6)%7},e.render=function(){var e=this.props,t=e.numberOfMonths,n=e.orientation,i=e.monthFormat,r=e.renderMonthText,o=e.renderWeekHeaderElement,a=e.dayPickerNavigationInlineStyles,s=e.navPosition,l=e.navPrev,u=e.navNext,d=e.renderNavPrevButton,f=e.renderNavNextButton,c=e.onOutsideClick,h=e.onShiftTab,p=e.onTab,y=e.withPortal,b=e.focused,D=e.enableOutsideDays,_=e.hideKeyboardShortcutsPanel,v=e.daySize,M=e.firstDayOfWeek,g=e.renderCalendarDay,m=e.renderDayContents,O=e.renderCalendarInfo,T=e.renderMonthElement,P=e.calendarInfoPosition,k=e.isFocused,S=e.isRTL,C=e.phrases,q=e.dayAriaLabelFormat,N=e.onBlur,I=e.showKeyboardShortcuts,R=e.weekDayFormat,E=e.verticalHeight,B=e.noBorder,F=e.transitionDuration,w=e.verticalBorderSpacing,L=e.horizontalMonthPadding,j=this.state,x=j.currentMonth,z=j.visibleDays;return _react.default.createElement(_DayPicker.default,{orientation:n,enableOutsideDays:D,modifiers:z,numberOfMonths:t,onDayClick:this.onDayClick,onDayMouseEnter:this.onDayMouseEnter,onDayMouseLeave:this.onDayMouseLeave,onPrevMonthClick:this.onPrevMonthClick,onNextMonthClick:this.onNextMonthClick,onMonthChange:this.onMonthChange,onYearChange:this.onYearChange,onMultiplyScrollableMonths:this.onMultiplyScrollableMonths,monthFormat:i,withPortal:y,hidden:!b,hideKeyboardShortcutsPanel:_,initialVisibleMonth:function(){return x},firstDayOfWeek:M,onOutsideClick:c,dayPickerNavigationInlineStyles:a,navPosition:s,navPrev:l,navNext:u,renderNavPrevButton:d,renderNavNextButton:f,renderMonthText:r,renderWeekHeaderElement:o,renderCalendarDay:g,renderDayContents:m,renderCalendarInfo:O,renderMonthElement:T,calendarInfoPosition:P,isFocused:k,getFirstFocusableDay:this.getFirstFocusableDay,onBlur:N,onTab:p,onShiftTab:h,phrases:C,daySize:v,isRTL:S,showKeyboardShortcuts:I,weekDayFormat:R,dayAriaLabelFormat:q,verticalHeight:E,noBorder:B,transitionDuration:F,verticalBorderSpacing:w,horizontalMonthPadding:L})},t}(_react.default.PureComponent||_react.default.Component);(exports.default=DayPickerSingleDateController).propTypes="production"!==process.env.NODE_ENV?propTypes:{},DayPickerSingleDateController.defaultProps=defaultProps;