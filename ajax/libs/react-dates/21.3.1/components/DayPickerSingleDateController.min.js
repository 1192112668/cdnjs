"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _enzymeShallowEqual=_interopRequireDefault(require("enzyme-shallow-equal")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactMomentProptypes=_interopRequireDefault(require("react-moment-proptypes")),_airbnbPropTypes=require("airbnb-prop-types"),_moment=_interopRequireDefault(require("moment")),_object=_interopRequireDefault(require("object.values")),_isTouchDevice=_interopRequireDefault(require("is-touch-device")),_defaultPhrases=require("../defaultPhrases"),_getPhrasePropTypes=_interopRequireDefault(require("../utils/getPhrasePropTypes")),_isSameDay=_interopRequireDefault(require("../utils/isSameDay")),_isAfterDay=_interopRequireDefault(require("../utils/isAfterDay")),_getVisibleDays=_interopRequireDefault(require("../utils/getVisibleDays")),_isDayVisible=_interopRequireDefault(require("../utils/isDayVisible")),_toISODateString=_interopRequireDefault(require("../utils/toISODateString")),_modifiers=require("../utils/modifiers"),_ScrollableOrientationShape=_interopRequireDefault(require("../shapes/ScrollableOrientationShape")),_DayOfWeekShape=_interopRequireDefault(require("../shapes/DayOfWeekShape")),_CalendarInfoPositionShape=_interopRequireDefault(require("../shapes/CalendarInfoPositionShape")),_NavPositionShape=_interopRequireDefault(require("../shapes/NavPositionShape")),_constants=require("../constants"),_DayPicker=_interopRequireDefault(require("./DayPicker")),_getPooledMoment=_interopRequireDefault(require("../utils/getPooledMoment"));function ownKeys(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(i,!0).forEach(function(e){(0,_defineProperty2.default)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var propTypes="production"!==process.env.NODE_ENV?(0,_airbnbPropTypes.forbidExtraProps)({date:_reactMomentProptypes.default.momentObj,onDateChange:_propTypes.default.func,focused:_propTypes.default.bool,onFocusChange:_propTypes.default.func,onClose:_propTypes.default.func,keepOpenOnDateSelect:_propTypes.default.bool,isOutsideRange:_propTypes.default.func,isDayBlocked:_propTypes.default.func,isDayHighlighted:_propTypes.default.func,renderMonthText:(0,_airbnbPropTypes.mutuallyExclusiveProps)(_propTypes.default.func,"renderMonthText","renderMonthElement"),renderMonthElement:(0,_airbnbPropTypes.mutuallyExclusiveProps)(_propTypes.default.func,"renderMonthText","renderMonthElement"),renderWeekHeaderElement:_propTypes.default.func,enableOutsideDays:_propTypes.default.bool,numberOfMonths:_propTypes.default.number,orientation:_ScrollableOrientationShape.default,withPortal:_propTypes.default.bool,initialVisibleMonth:_propTypes.default.func,firstDayOfWeek:_DayOfWeekShape.default,hideKeyboardShortcutsPanel:_propTypes.default.bool,daySize:_airbnbPropTypes.nonNegativeInteger,verticalHeight:_airbnbPropTypes.nonNegativeInteger,noBorder:_propTypes.default.bool,verticalBorderSpacing:_airbnbPropTypes.nonNegativeInteger,transitionDuration:_airbnbPropTypes.nonNegativeInteger,horizontalMonthPadding:_airbnbPropTypes.nonNegativeInteger,dayPickerNavigationInlineStyles:_propTypes.default.object,navPosition:_NavPositionShape.default,navPrev:_propTypes.default.node,navNext:_propTypes.default.node,onPrevMonthClick:_propTypes.default.func,onNextMonthClick:_propTypes.default.func,onOutsideClick:_propTypes.default.func,renderCalendarDay:_propTypes.default.func,renderDayContents:_propTypes.default.func,renderCalendarInfo:_propTypes.default.func,calendarInfoPosition:_CalendarInfoPositionShape.default,onBlur:_propTypes.default.func,isFocused:_propTypes.default.bool,showKeyboardShortcuts:_propTypes.default.bool,onTab:_propTypes.default.func,onShiftTab:_propTypes.default.func,monthFormat:_propTypes.default.string,weekDayFormat:_propTypes.default.string,phrases:_propTypes.default.shape((0,_getPhrasePropTypes.default)(_defaultPhrases.DayPickerPhrases)),dayAriaLabelFormat:_propTypes.default.string,isRTL:_propTypes.default.bool}):{},defaultProps={date:void 0,onDateChange:function(){},focused:!1,onFocusChange:function(){},onClose:function(){},keepOpenOnDateSelect:!1,isOutsideRange:function(){},isDayBlocked:function(){},isDayHighlighted:function(){},renderMonthText:null,renderWeekHeaderElement:null,enableOutsideDays:!1,numberOfMonths:1,orientation:_constants.HORIZONTAL_ORIENTATION,withPortal:!1,hideKeyboardShortcutsPanel:!1,initialVisibleMonth:null,firstDayOfWeek:null,daySize:_constants.DAY_SIZE,verticalHeight:null,noBorder:!1,verticalBorderSpacing:void 0,transitionDuration:void 0,horizontalMonthPadding:13,dayPickerNavigationInlineStyles:null,navPosition:_constants.NAV_POSITION_TOP,navPrev:null,navNext:null,onPrevMonthClick:function(){},onNextMonthClick:function(){},onOutsideClick:function(){},renderCalendarDay:void 0,renderDayContents:null,renderCalendarInfo:null,renderMonthElement:null,calendarInfoPosition:_constants.INFO_POSITION_BOTTOM,onBlur:function(){},isFocused:!1,showKeyboardShortcuts:!1,onTab:function(){},onShiftTab:function(){},monthFormat:"MMMM YYYY",weekDayFormat:"dd",phrases:_defaultPhrases.DayPickerPhrases,dayAriaLabelFormat:void 0,isRTL:!1},DayPickerSingleDateController=function(o){(0,_inheritsLoose2.default)(t,o);var e=t.prototype;function t(t){var i=o.call(this,t)||this;i.isTouchDevice=!1,i.today=(0,_moment.default)(),i.modifiers={today:function(e){return i.isToday(e)},blocked:function(e){return i.isBlocked(e)},"blocked-calendar":function(e){return t.isDayBlocked(e)},"blocked-out-of-range":function(e){return t.isOutsideRange(e)},"highlighted-calendar":function(e){return t.isDayHighlighted(e)},valid:function(e){return!i.isBlocked(e)},hovered:function(e){return i.isHovered(e)},selected:function(e){return i.isSelected(e)},"first-day-of-week":function(e){return i.isFirstDayOfWeek(e)},"last-day-of-week":function(e){return i.isLastDayOfWeek(e)}};var e=i.getStateForNewMonth(t),n=e.currentMonth,r=e.visibleDays;return i.state={hoverDate:null,currentMonth:n,visibleDays:r},i.onDayMouseEnter=i.onDayMouseEnter.bind((0,_assertThisInitialized2.default)(i)),i.onDayMouseLeave=i.onDayMouseLeave.bind((0,_assertThisInitialized2.default)(i)),i.onDayClick=i.onDayClick.bind((0,_assertThisInitialized2.default)(i)),i.onPrevMonthClick=i.onPrevMonthClick.bind((0,_assertThisInitialized2.default)(i)),i.onNextMonthClick=i.onNextMonthClick.bind((0,_assertThisInitialized2.default)(i)),i.onMonthChange=i.onMonthChange.bind((0,_assertThisInitialized2.default)(i)),i.onYearChange=i.onYearChange.bind((0,_assertThisInitialized2.default)(i)),i.onMultiplyScrollableMonths=i.onMultiplyScrollableMonths.bind((0,_assertThisInitialized2.default)(i)),i.getFirstFocusableDay=i.getFirstFocusableDay.bind((0,_assertThisInitialized2.default)(i)),i}return e[!_react.default.PureComponent&&"shouldComponentUpdate"]=function(e,t){return!(0,_enzymeShallowEqual.default)(this.props,e)||!(0,_enzymeShallowEqual.default)(this.state,t)},e.componentDidMount=function(){this.isTouchDevice=(0,_isTouchDevice.default)()},e.componentWillReceiveProps=function(e){var i=this,t=e.date,n=e.focused,r=e.isOutsideRange,o=e.isDayBlocked,a=e.isDayHighlighted,s=e.initialVisibleMonth,l=e.numberOfMonths,u=e.enableOutsideDays,d=this.props,f=d.isOutsideRange,c=d.isDayBlocked,h=d.isDayHighlighted,p=d.numberOfMonths,y=d.enableOutsideDays,b=d.initialVisibleMonth,D=d.focused,_=d.date,v=this.state.currentMonth,M=this.state.visibleDays,g=!1,m=!1,O=!1;r!==f&&(this.modifiers["blocked-out-of-range"]=function(e){return r(e)},g=!0),o!==c&&(this.modifiers["blocked-calendar"]=function(e){return o(e)},m=!0),a!==h&&(this.modifiers["highlighted-calendar"]=function(e){return a(e)},O=!0);var T,P=g||m||O,k=t!==_,S=n!==D,C=!0;k&&(C=(0,_isDayVisible.default)(t,v,l,u)),l===p&&u===y&&(s===b||D||!n)&&C||(v=(T=this.getStateForNewMonth(e)).currentMonth,M=T.visibleDays,this.setState({currentMonth:v,visibleDays:M}));var q={};k&&(q=this.deleteModifier(q,_,"selected"),q=this.addModifier(q,t,"selected")),(S||P)&&(0,_object.default)(M).forEach(function(e){Object.keys(e).forEach(function(e){var t=(0,_getPooledMoment.default)(e);q=i.isBlocked(t)?i.addModifier(q,t,"blocked"):i.deleteModifier(q,t,"blocked"),(S||g)&&(q=r(t)?i.addModifier(q,t,"blocked-out-of-range"):i.deleteModifier(q,t,"blocked-out-of-range")),(S||m)&&(q=o(t)?i.addModifier(q,t,"blocked-calendar"):i.deleteModifier(q,t,"blocked-calendar")),(S||O)&&(q=a(t)?i.addModifier(q,t,"highlighted-calendar"):i.deleteModifier(q,t,"highlighted-calendar"))})});var I=(0,_moment.default)();(0,_isSameDay.default)(this.today,I)||(q=this.deleteModifier(q,this.today,"today"),q=this.addModifier(q,I,"today"),this.today=I),0<Object.keys(q).length&&this.setState({visibleDays:_objectSpread({},M,{},q)})},e.componentWillUpdate=function(){this.today=(0,_moment.default)()},e.onDayClick=function(e,t){var i,n,r,o,a;t&&t.preventDefault(),this.isBlocked(e)||(n=(i=this.props).onDateChange,r=i.keepOpenOnDateSelect,o=i.onFocusChange,a=i.onClose,n(e),r||(o({focused:!1}),a({date:e})))},e.onDayMouseEnter=function(e){var t,i,n,r;this.isTouchDevice||(i=(t=this.state).hoverDate,n=t.visibleDays,r=this.deleteModifier({},i,"hovered"),r=this.addModifier(r,e,"hovered"),this.setState({hoverDate:e,visibleDays:_objectSpread({},n,{},r)}))},e.onDayMouseLeave=function(){var e,t=this.state,i=t.hoverDate,n=t.visibleDays;!this.isTouchDevice&&i&&(e=this.deleteModifier({},i,"hovered"),this.setState({hoverDate:null,visibleDays:_objectSpread({},n,{},e)}))},e.onPrevMonthClick=function(){var e=this.props,t=e.onPrevMonthClick,i=e.numberOfMonths,n=e.enableOutsideDays,r=this.state,o=r.currentMonth,a=r.visibleDays,s={};Object.keys(a).sort().slice(0,i+1).forEach(function(e){s[e]=a[e]});var l=o.clone().subtract(1,"month"),u=(0,_getVisibleDays.default)(l,1,n);this.setState({currentMonth:l,visibleDays:_objectSpread({},s,{},this.getModifiers(u))},function(){t(l.clone())})},e.onNextMonthClick=function(){var e=this.props,t=e.onNextMonthClick,i=e.numberOfMonths,n=e.enableOutsideDays,r=this.state,o=r.currentMonth,a=r.visibleDays,s={};Object.keys(a).sort().slice(1).forEach(function(e){s[e]=a[e]});var l=o.clone().add(i,"month"),u=(0,_getVisibleDays.default)(l,1,n),d=o.clone().add(1,"month");this.setState({currentMonth:d,visibleDays:_objectSpread({},s,{},this.getModifiers(u))},function(){t(d.clone())})},e.onMonthChange=function(e){var t=this.props,i=t.numberOfMonths,n=t.enableOutsideDays,r=t.orientation===_constants.VERTICAL_SCROLLABLE,o=(0,_getVisibleDays.default)(e,i,n,r);this.setState({currentMonth:e.clone(),visibleDays:this.getModifiers(o)})},e.onYearChange=function(e){var t=this.props,i=t.numberOfMonths,n=t.enableOutsideDays,r=t.orientation===_constants.VERTICAL_SCROLLABLE,o=(0,_getVisibleDays.default)(e,i,n,r);this.setState({currentMonth:e.clone(),visibleDays:this.getModifiers(o)})},e.onMultiplyScrollableMonths=function(){var e=this.props,t=e.numberOfMonths,i=e.enableOutsideDays,n=this.state,r=n.currentMonth,o=n.visibleDays,a=Object.keys(o).length,s=r.clone().add(a,"month"),l=(0,_getVisibleDays.default)(s,t,i,!0);this.setState({visibleDays:_objectSpread({},o,{},this.getModifiers(l))})},e.getFirstFocusableDay=function(e){var t=this,i=this.props,n=i.date,r=i.numberOfMonths,o=e.clone().startOf("month");if(n&&(o=n.clone()),this.isBlocked(o)){for(var a=[],s=e.clone().add(r-1,"months").endOf("month"),l=o.clone();!(0,_isAfterDay.default)(l,s);)l=l.clone().add(1,"day"),a.push(l);var u=a.filter(function(e){return!t.isBlocked(e)&&(0,_isAfterDay.default)(e,o)});0<u.length&&(o=(0,_slicedToArray2.default)(u,1)[0])}return o},e.getModifiers=function(e){var i=this,n={};return Object.keys(e).forEach(function(t){n[t]={},e[t].forEach(function(e){n[t][(0,_toISODateString.default)(e)]=i.getModifiersForDay(e)})}),n},e.getModifiersForDay=function(t){var i=this;return new Set(Object.keys(this.modifiers).filter(function(e){return i.modifiers[e](t)}))},e.getStateForNewMonth=function(e){var t=this,i=e.initialVisibleMonth,n=e.date,r=e.numberOfMonths,o=e.orientation,a=e.enableOutsideDays,s=(i||(n?function(){return n}:function(){return t.today}))(),l=o===_constants.VERTICAL_SCROLLABLE;return{currentMonth:s,visibleDays:this.getModifiers((0,_getVisibleDays.default)(s,r,a,l))}},e.addModifier=function(e,t,i){return(0,_modifiers.addModifier)(e,t,i,this.props,this.state)},e.deleteModifier=function(e,t,i){return(0,_modifiers.deleteModifier)(e,t,i,this.props,this.state)},e.isBlocked=function(e){var t=this.props,i=t.isDayBlocked,n=t.isOutsideRange;return i(e)||n(e)},e.isHovered=function(e){var t=(this.state||{}).hoverDate;return(0,_isSameDay.default)(e,t)},e.isSelected=function(e){var t=this.props.date;return(0,_isSameDay.default)(e,t)},e.isToday=function(e){return(0,_isSameDay.default)(e,this.today)},e.isFirstDayOfWeek=function(e){var t=this.props.firstDayOfWeek;return e.day()===(t||_moment.default.localeData().firstDayOfWeek())},e.isLastDayOfWeek=function(e){var t=this.props.firstDayOfWeek;return e.day()===((t||_moment.default.localeData().firstDayOfWeek())+6)%7},e.render=function(){var e=this.props,t=e.numberOfMonths,i=e.orientation,n=e.monthFormat,r=e.renderMonthText,o=e.renderWeekHeaderElement,a=e.dayPickerNavigationInlineStyles,s=e.navPosition,l=e.navPrev,u=e.navNext,d=e.onOutsideClick,f=e.onShiftTab,c=e.onTab,h=e.withPortal,p=e.focused,y=e.enableOutsideDays,b=e.hideKeyboardShortcutsPanel,D=e.daySize,_=e.firstDayOfWeek,v=e.renderCalendarDay,M=e.renderDayContents,g=e.renderCalendarInfo,m=e.renderMonthElement,O=e.calendarInfoPosition,T=e.isFocused,P=e.isRTL,k=e.phrases,S=e.dayAriaLabelFormat,C=e.onBlur,q=e.showKeyboardShortcuts,I=e.weekDayFormat,R=e.verticalHeight,E=e.noBorder,N=e.transitionDuration,F=e.verticalBorderSpacing,w=e.horizontalMonthPadding,L=this.state,j=L.currentMonth,B=L.visibleDays;return _react.default.createElement(_DayPicker.default,{orientation:i,enableOutsideDays:y,modifiers:B,numberOfMonths:t,onDayClick:this.onDayClick,onDayMouseEnter:this.onDayMouseEnter,onDayMouseLeave:this.onDayMouseLeave,onPrevMonthClick:this.onPrevMonthClick,onNextMonthClick:this.onNextMonthClick,onMonthChange:this.onMonthChange,onYearChange:this.onYearChange,onMultiplyScrollableMonths:this.onMultiplyScrollableMonths,monthFormat:n,withPortal:h,hidden:!p,hideKeyboardShortcutsPanel:b,initialVisibleMonth:function(){return j},firstDayOfWeek:_,onOutsideClick:d,dayPickerNavigationInlineStyles:a,navPosition:s,navPrev:l,navNext:u,renderMonthText:r,renderWeekHeaderElement:o,renderCalendarDay:v,renderDayContents:M,renderCalendarInfo:g,renderMonthElement:m,calendarInfoPosition:O,isFocused:T,getFirstFocusableDay:this.getFirstFocusableDay,onBlur:C,onTab:c,onShiftTab:f,phrases:k,daySize:D,isRTL:P,showKeyboardShortcuts:q,weekDayFormat:I,dayAriaLabelFormat:S,verticalHeight:R,noBorder:E,transitionDuration:N,verticalBorderSpacing:F,horizontalMonthPadding:w})},t}(_react.default.PureComponent||_react.default.Component);(exports.default=DayPickerSingleDateController).propTypes="production"!==process.env.NODE_ENV?propTypes:{},DayPickerSingleDateController.defaultProps=defaultProps;