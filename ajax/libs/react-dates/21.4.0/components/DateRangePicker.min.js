"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.PureDateRangePicker=void 0;var _enzymeShallowEqual=_interopRequireDefault(require("enzyme-shallow-equal")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_react=_interopRequireDefault(require("react")),_moment=_interopRequireDefault(require("moment")),_reactWithStyles=require("react-with-styles"),_reactPortal=require("react-portal"),_airbnbPropTypes=require("airbnb-prop-types"),_consolidatedEvents=require("consolidated-events"),_isTouchDevice=_interopRequireDefault(require("is-touch-device")),_reactOutsideClickHandler=_interopRequireDefault(require("react-outside-click-handler")),_DateRangePickerShape=_interopRequireDefault(require("../shapes/DateRangePickerShape")),_defaultPhrases=require("../defaultPhrases"),_getResponsiveContainerStyles=_interopRequireDefault(require("../utils/getResponsiveContainerStyles")),_getDetachedContainerStyles=_interopRequireDefault(require("../utils/getDetachedContainerStyles")),_getInputHeight=_interopRequireDefault(require("../utils/getInputHeight")),_isInclusivelyAfterDay=_interopRequireDefault(require("../utils/isInclusivelyAfterDay")),_disableScroll2=_interopRequireDefault(require("../utils/disableScroll")),_noflip=_interopRequireDefault(require("../utils/noflip")),_DateRangePickerInputController=_interopRequireDefault(require("./DateRangePickerInputController")),_DayPickerRangeController=_interopRequireDefault(require("./DayPickerRangeController")),_CloseButton=_interopRequireDefault(require("./CloseButton")),_constants=require("../constants");function ownKeys(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(n,!0).forEach(function(e){(0,_defineProperty2.default)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var propTypes="production"!==process.env.NODE_ENV?(0,_airbnbPropTypes.forbidExtraProps)(_objectSpread({},_reactWithStyles.withStylesPropTypes,{},_DateRangePickerShape.default)):{},defaultProps={startDate:null,endDate:null,focusedInput:null,startDatePlaceholderText:"Start Date",endDatePlaceholderText:"End Date",startDateAriaLabel:void 0,endDateAriaLabel:void 0,startDateOffset:void 0,endDateOffset:void 0,disabled:!1,required:!1,readOnly:!1,screenReaderInputMessage:"",showClearDates:!1,showDefaultInputIcon:!1,inputIconPosition:_constants.ICON_BEFORE_POSITION,customInputIcon:null,customArrowIcon:null,customCloseIcon:null,noBorder:!1,block:!1,small:!1,regular:!1,keepFocusOnInput:!1,renderMonthText:null,renderWeekHeaderElement:null,orientation:_constants.HORIZONTAL_ORIENTATION,anchorDirection:_constants.ANCHOR_LEFT,openDirection:_constants.OPEN_DOWN,horizontalMargin:0,withPortal:!1,withFullScreenPortal:!1,appendToBody:!1,disableScroll:!1,initialVisibleMonth:null,numberOfMonths:2,keepOpenOnDateSelect:!1,reopenPickerOnClearDates:!1,renderCalendarInfo:null,calendarInfoPosition:_constants.INFO_POSITION_BOTTOM,hideKeyboardShortcutsPanel:!1,daySize:_constants.DAY_SIZE,isRTL:!1,firstDayOfWeek:null,verticalHeight:null,transitionDuration:void 0,verticalSpacing:_constants.DEFAULT_VERTICAL_SPACING,horizontalMonthPadding:void 0,dayPickerNavigationInlineStyles:null,navPosition:_constants.NAV_POSITION_TOP,navPrev:null,navNext:null,onPrevMonthClick:function(){},onNextMonthClick:function(){},onClose:function(){},renderCalendarDay:void 0,renderDayContents:null,renderMonthElement:null,minimumNights:1,enableOutsideDays:!1,isDayBlocked:function(){return!1},isOutsideRange:function(e){return!(0,_isInclusivelyAfterDay.default)(e,(0,_moment.default)())},isDayHighlighted:function(){return!1},minDate:void 0,maxDate:void 0,displayFormat:function(){return _moment.default.localeData().longDateFormat("L")},monthFormat:"MMMM YYYY",weekDayFormat:"dd",phrases:_defaultPhrases.DateRangePickerPhrases,dayAriaLabelFormat:void 0},DateRangePicker=function(n){(0,_inheritsLoose2.default)(t,n);var e=t.prototype;function t(e){var t=n.call(this,e)||this;return t.state={dayPickerContainerStyles:{},isDateRangePickerInputFocused:!1,isDayPickerFocused:!1,showKeyboardShortcuts:!1},t.isTouchDevice=!1,t.onOutsideClick=t.onOutsideClick.bind((0,_assertThisInitialized2.default)(t)),t.onDateRangePickerInputFocus=t.onDateRangePickerInputFocus.bind((0,_assertThisInitialized2.default)(t)),t.onDayPickerFocus=t.onDayPickerFocus.bind((0,_assertThisInitialized2.default)(t)),t.onDayPickerFocusOut=t.onDayPickerFocusOut.bind((0,_assertThisInitialized2.default)(t)),t.onDayPickerBlur=t.onDayPickerBlur.bind((0,_assertThisInitialized2.default)(t)),t.showKeyboardShortcutsPanel=t.showKeyboardShortcutsPanel.bind((0,_assertThisInitialized2.default)(t)),t.responsivizePickerPosition=t.responsivizePickerPosition.bind((0,_assertThisInitialized2.default)(t)),t.disableScroll=t.disableScroll.bind((0,_assertThisInitialized2.default)(t)),t.setDayPickerContainerRef=t.setDayPickerContainerRef.bind((0,_assertThisInitialized2.default)(t)),t.setContainerRef=t.setContainerRef.bind((0,_assertThisInitialized2.default)(t)),t}return e[!_react.default.PureComponent&&"shouldComponentUpdate"]=function(e,t){return!(0,_enzymeShallowEqual.default)(this.props,e)||!(0,_enzymeShallowEqual.default)(this.state,t)},e.componentDidMount=function(){this.removeEventListener=(0,_consolidatedEvents.addEventListener)(window,"resize",this.responsivizePickerPosition,{passive:!0}),this.responsivizePickerPosition(),this.disableScroll(),this.props.focusedInput&&this.setState({isDateRangePickerInputFocused:!0}),this.isTouchDevice=(0,_isTouchDevice.default)()},e.componentDidUpdate=function(e){var t=this.props.focusedInput;!e.focusedInput&&t&&this.isOpened()?(this.responsivizePickerPosition(),this.disableScroll()):!e.focusedInput||t||this.isOpened()||this.enableScroll&&this.enableScroll()},e.componentWillUnmount=function(){this.removeDayPickerEventListeners(),this.removeEventListener&&this.removeEventListener(),this.enableScroll&&this.enableScroll()},e.onOutsideClick=function(e){var t=this.props,n=t.onFocusChange,i=t.onClose,r=t.startDate,a=t.endDate,o=t.appendToBody;this.isOpened()&&(o&&this.dayPickerContainer.contains(e.target)||(this.setState({isDateRangePickerInputFocused:!1,isDayPickerFocused:!1,showKeyboardShortcuts:!1}),n(null),i({startDate:r,endDate:a})))},e.onDateRangePickerInputFocus=function(e){var t=this.props,n=t.onFocusChange,i=t.readOnly,r=t.withPortal,a=t.withFullScreenPortal,o=t.keepFocusOnInput;e&&(r||a||i&&!o||this.isTouchDevice&&!o?this.onDayPickerFocus():this.onDayPickerBlur()),n(e)},e.onDayPickerFocus=function(){var e=this.props,t=e.focusedInput,n=e.onFocusChange;t||n(_constants.START_DATE),this.setState({isDateRangePickerInputFocused:!1,isDayPickerFocused:!0,showKeyboardShortcuts:!1})},e.onDayPickerFocusOut=function(e){var t=e.relatedTarget!==document.body&&e.relatedTarget||e.target;this.dayPickerContainer.contains(t)||this.onOutsideClick(e)},e.onDayPickerBlur=function(){this.setState({isDateRangePickerInputFocused:!0,isDayPickerFocused:!1,showKeyboardShortcuts:!1})},e.setDayPickerContainerRef=function(e){e!==this.dayPickerContainer&&(this.dayPickerContainer&&this.removeDayPickerEventListeners(),(this.dayPickerContainer=e)&&this.addDayPickerEventListeners())},e.setContainerRef=function(e){this.container=e},e.addDayPickerEventListeners=function(){this.removeDayPickerFocusOut=(0,_consolidatedEvents.addEventListener)(this.dayPickerContainer,"focusout",this.onDayPickerFocusOut)},e.removeDayPickerEventListeners=function(){this.removeDayPickerFocusOut&&this.removeDayPickerFocusOut()},e.isOpened=function(){var e=this.props.focusedInput;return e===_constants.START_DATE||e===_constants.END_DATE},e.disableScroll=function(){var e=this.props,t=e.appendToBody,n=e.disableScroll;(t||n)&&this.isOpened()&&(this.enableScroll=(0,_disableScroll2.default)(this.container))},e.responsivizePickerPosition=function(){var e,t,n,i,r,a,o,s,l,c,u,d=this.state.dayPickerContainerStyles;0<Object.keys(d).length&&this.setState({dayPickerContainerStyles:{}}),this.isOpened()&&(t=(e=this.props).openDirection,n=e.anchorDirection,i=e.horizontalMargin,r=e.withPortal,a=e.withFullScreenPortal,o=e.appendToBody,s=n===_constants.ANCHOR_LEFT,r||a||(l=this.dayPickerContainer.getBoundingClientRect(),c=d[n]||0,u=s?l[_constants.ANCHOR_RIGHT]:l[_constants.ANCHOR_LEFT],this.setState({dayPickerContainerStyles:_objectSpread({},(0,_getResponsiveContainerStyles.default)(n,c,u,i),{},o&&(0,_getDetachedContainerStyles.default)(t,n,this.container))})))},e.showKeyboardShortcutsPanel=function(){this.setState({isDateRangePickerInputFocused:!1,isDayPickerFocused:!0,showKeyboardShortcuts:!0})},e.maybeRenderDayPickerWithPortal=function(){var e=this.props,t=e.withPortal,n=e.withFullScreenPortal,i=e.appendToBody;return this.isOpened()?t||n||i?_react.default.createElement(_reactPortal.Portal,null,this.renderDayPicker()):this.renderDayPicker():null},e.renderDayPicker=function(){var e=this.props,t=e.anchorDirection,n=e.openDirection,i=e.isDayBlocked,r=e.isDayHighlighted,a=e.isOutsideRange,o=e.numberOfMonths,s=e.orientation,l=e.monthFormat,c=e.renderMonthText,u=e.renderWeekHeaderElement,d=e.dayPickerNavigationInlineStyles,h=e.navPosition,p=e.navPrev,D=e.navNext,_=e.onPrevMonthClick,P=e.onNextMonthClick,f=e.onDatesChange,y=e.onFocusChange,k=e.withPortal,g=e.withFullScreenPortal,b=e.daySize,R=e.enableOutsideDays,m=e.focusedInput,O=e.startDate,v=e.startDateOffset,C=e.endDate,I=e.endDateOffset,S=e.minDate,T=e.maxDate,F=e.minimumNights,w=e.keepOpenOnDateSelect,E=e.renderCalendarDay,q=e.renderDayContents,N=e.renderCalendarInfo,A=e.renderMonthElement,L=e.calendarInfoPosition,x=e.firstDayOfWeek,z=e.initialVisibleMonth,M=e.hideKeyboardShortcutsPanel,B=e.customCloseIcon,H=e.onClose,K=e.phrases,W=e.dayAriaLabelFormat,j=e.isRTL,V=e.weekDayFormat,G=e.styles,U=e.verticalHeight,Y=e.transitionDuration,Z=e.verticalSpacing,Q=e.horizontalMonthPadding,X=e.small,J=e.disabled,$=e.theme.reactDates,ee=this.state,te=ee.dayPickerContainerStyles,ne=ee.isDayPickerFocused,ie=ee.showKeyboardShortcuts,re=!g&&k?this.onOutsideClick:void 0,ae=z||function(){return O||C||(0,_moment.default)()},oe=B||_react.default.createElement(_CloseButton.default,(0,_reactWithStyles.css)(G.DateRangePicker_closeButton_svg)),se=(0,_getInputHeight.default)($,X),le=k||g;return _react.default.createElement("div",(0,_extends2.default)({ref:this.setDayPickerContainerRef},(0,_reactWithStyles.css)(G.DateRangePicker_picker,t===_constants.ANCHOR_LEFT&&G.DateRangePicker_picker__directionLeft,t===_constants.ANCHOR_RIGHT&&G.DateRangePicker_picker__directionRight,s===_constants.HORIZONTAL_ORIENTATION&&G.DateRangePicker_picker__horizontal,s===_constants.VERTICAL_ORIENTATION&&G.DateRangePicker_picker__vertical,!le&&n===_constants.OPEN_DOWN&&{top:se+Z},!le&&n===_constants.OPEN_UP&&{bottom:se+Z},le&&G.DateRangePicker_picker__portal,g&&G.DateRangePicker_picker__fullScreenPortal,j&&G.DateRangePicker_picker__rtl,te),{onClick:re}),_react.default.createElement(_DayPickerRangeController.default,{orientation:s,enableOutsideDays:R,numberOfMonths:o,onPrevMonthClick:_,onNextMonthClick:P,onDatesChange:f,onFocusChange:y,onClose:H,focusedInput:m,startDate:O,startDateOffset:v,endDate:C,endDateOffset:I,minDate:S,maxDate:T,monthFormat:l,renderMonthText:c,renderWeekHeaderElement:u,withPortal:le,daySize:b,initialVisibleMonth:ae,hideKeyboardShortcutsPanel:M,dayPickerNavigationInlineStyles:d,navPosition:h,navPrev:p,navNext:D,minimumNights:F,isOutsideRange:a,isDayHighlighted:r,isDayBlocked:i,keepOpenOnDateSelect:w,renderCalendarDay:E,renderDayContents:q,renderCalendarInfo:N,renderMonthElement:A,calendarInfoPosition:L,isFocused:ne,showKeyboardShortcuts:ie,onBlur:this.onDayPickerBlur,phrases:K,dayAriaLabelFormat:W,isRTL:j,firstDayOfWeek:x,weekDayFormat:V,verticalHeight:U,transitionDuration:Y,disabled:J,horizontalMonthPadding:Q}),g&&_react.default.createElement("button",(0,_extends2.default)({},(0,_reactWithStyles.css)(G.DateRangePicker_closeButton),{type:"button",onClick:this.onOutsideClick,"aria-label":K.closeDatePicker}),oe))},e.render=function(){var e=this.props,t=e.startDate,n=e.startDateId,i=e.startDatePlaceholderText,r=e.startDateAriaLabel,a=e.endDate,o=e.endDateId,s=e.endDatePlaceholderText,l=e.endDateAriaLabel,c=e.focusedInput,u=e.screenReaderInputMessage,d=e.showClearDates,h=e.showDefaultInputIcon,p=e.inputIconPosition,D=e.customInputIcon,_=e.customArrowIcon,P=e.customCloseIcon,f=e.disabled,y=e.required,k=e.readOnly,g=e.openDirection,b=e.phrases,R=e.isOutsideRange,m=e.minimumNights,O=e.withPortal,v=e.withFullScreenPortal,C=e.displayFormat,I=e.reopenPickerOnClearDates,S=e.keepOpenOnDateSelect,T=e.onDatesChange,F=e.onClose,w=e.isRTL,E=e.noBorder,q=e.block,N=e.verticalSpacing,A=e.small,L=e.regular,x=e.styles,z=this.state.isDateRangePickerInputFocused,M=!O&&!v,B=N<_constants.FANG_HEIGHT_PX,H=_react.default.createElement(_DateRangePickerInputController.default,{startDate:t,startDateId:n,startDatePlaceholderText:i,isStartDateFocused:c===_constants.START_DATE,startDateAriaLabel:r,endDate:a,endDateId:o,endDatePlaceholderText:s,isEndDateFocused:c===_constants.END_DATE,endDateAriaLabel:l,displayFormat:C,showClearDates:d,showCaret:!O&&!v&&!B,showDefaultInputIcon:h,inputIconPosition:p,customInputIcon:D,customArrowIcon:_,customCloseIcon:P,disabled:f,required:y,readOnly:k,openDirection:g,reopenPickerOnClearDates:I,keepOpenOnDateSelect:S,isOutsideRange:R,minimumNights:m,withFullScreenPortal:v,onDatesChange:T,onFocusChange:this.onDateRangePickerInputFocus,onKeyDownArrowDown:this.onDayPickerFocus,onKeyDownQuestionMark:this.showKeyboardShortcutsPanel,onClose:F,phrases:b,screenReaderMessage:u,isFocused:z,isRTL:w,noBorder:E,block:q,small:A,regular:L,verticalSpacing:N},this.maybeRenderDayPickerWithPortal());return _react.default.createElement("div",(0,_extends2.default)({ref:this.setContainerRef},(0,_reactWithStyles.css)(x.DateRangePicker,q&&x.DateRangePicker__block)),M&&_react.default.createElement(_reactOutsideClickHandler.default,{onOutsideClick:this.onOutsideClick},H),M||H)},t}(_react.default.PureComponent||_react.default.Component);(exports.PureDateRangePicker=DateRangePicker).propTypes="production"!==process.env.NODE_ENV?propTypes:{},DateRangePicker.defaultProps=defaultProps;var _default=(0,_reactWithStyles.withStyles)(function(e){var t=e.reactDates,n=t.color,i=t.zIndex;return{DateRangePicker:{position:"relative",display:"inline-block"},DateRangePicker__block:{display:"block"},DateRangePicker_picker:{zIndex:i+1,backgroundColor:n.background,position:"absolute"},DateRangePicker_picker__rtl:{direction:(0,_noflip.default)("rtl")},DateRangePicker_picker__directionLeft:{left:(0,_noflip.default)(0)},DateRangePicker_picker__directionRight:{right:(0,_noflip.default)(0)},DateRangePicker_picker__portal:{backgroundColor:"rgba(0, 0, 0, 0.3)",position:"fixed",top:0,left:(0,_noflip.default)(0),height:"100%",width:"100%"},DateRangePicker_picker__fullScreenPortal:{backgroundColor:n.background},DateRangePicker_closeButton:{background:"none",border:0,color:"inherit",font:"inherit",lineHeight:"normal",overflow:"visible",cursor:"pointer",position:"absolute",top:0,right:(0,_noflip.default)(0),padding:15,zIndex:i+2,":hover":{color:"darken(".concat(n.core.grayLighter,", 10%)"),textDecoration:"none"},":focus":{color:"darken(".concat(n.core.grayLighter,", 10%)"),textDecoration:"none"}},DateRangePicker_closeButton_svg:{height:15,width:15,fill:n.core.grayLighter}}},{pureComponent:void 0!==_react.default.PureComponent})(DateRangePicker);exports.default=_default;