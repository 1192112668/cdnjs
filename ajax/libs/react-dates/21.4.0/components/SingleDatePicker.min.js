"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.PureSingleDatePicker=void 0;var _enzymeShallowEqual=_interopRequireDefault(require("enzyme-shallow-equal")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_react=_interopRequireDefault(require("react")),_moment=_interopRequireDefault(require("moment")),_reactWithStyles=require("react-with-styles"),_reactPortal=require("react-portal"),_airbnbPropTypes=require("airbnb-prop-types"),_consolidatedEvents=require("consolidated-events"),_isTouchDevice=_interopRequireDefault(require("is-touch-device")),_reactOutsideClickHandler=_interopRequireDefault(require("react-outside-click-handler")),_SingleDatePickerShape=_interopRequireDefault(require("../shapes/SingleDatePickerShape")),_defaultPhrases=require("../defaultPhrases"),_getResponsiveContainerStyles=_interopRequireDefault(require("../utils/getResponsiveContainerStyles")),_getDetachedContainerStyles=_interopRequireDefault(require("../utils/getDetachedContainerStyles")),_getInputHeight=_interopRequireDefault(require("../utils/getInputHeight")),_isInclusivelyAfterDay=_interopRequireDefault(require("../utils/isInclusivelyAfterDay")),_disableScroll2=_interopRequireDefault(require("../utils/disableScroll")),_noflip=_interopRequireDefault(require("../utils/noflip")),_SingleDatePickerInputController=_interopRequireDefault(require("./SingleDatePickerInputController")),_DayPickerSingleDateController=_interopRequireDefault(require("./DayPickerSingleDateController")),_CloseButton=_interopRequireDefault(require("./CloseButton")),_constants=require("../constants");function ownKeys(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(i,!0).forEach(function(e){(0,_defineProperty2.default)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var propTypes="production"!==process.env.NODE_ENV?(0,_airbnbPropTypes.forbidExtraProps)(_objectSpread({},_reactWithStyles.withStylesPropTypes,{},_SingleDatePickerShape.default)):{},defaultProps={date:null,focused:!1,id:"date",placeholder:"Date",ariaLabel:void 0,disabled:!1,required:!1,readOnly:!1,screenReaderInputMessage:"",showClearDate:!1,showDefaultInputIcon:!1,inputIconPosition:_constants.ICON_BEFORE_POSITION,customInputIcon:null,customCloseIcon:null,noBorder:!1,block:!1,small:!1,regular:!1,verticalSpacing:_constants.DEFAULT_VERTICAL_SPACING,keepFocusOnInput:!1,orientation:_constants.HORIZONTAL_ORIENTATION,anchorDirection:_constants.ANCHOR_LEFT,openDirection:_constants.OPEN_DOWN,horizontalMargin:0,withPortal:!1,withFullScreenPortal:!1,appendToBody:!1,disableScroll:!1,initialVisibleMonth:null,firstDayOfWeek:null,numberOfMonths:2,keepOpenOnDateSelect:!1,reopenPickerOnClearDate:!1,renderCalendarInfo:null,calendarInfoPosition:_constants.INFO_POSITION_BOTTOM,hideKeyboardShortcutsPanel:!1,daySize:_constants.DAY_SIZE,isRTL:!1,verticalHeight:null,transitionDuration:void 0,horizontalMonthPadding:13,dayPickerNavigationInlineStyles:null,navPosition:_constants.NAV_POSITION_TOP,navPrev:null,navNext:null,onPrevMonthClick:function(){},onNextMonthClick:function(){},onClose:function(){},renderMonthText:null,renderWeekHeaderElement:null,renderCalendarDay:void 0,renderDayContents:null,renderMonthElement:null,enableOutsideDays:!1,isDayBlocked:function(){return!1},isOutsideRange:function(e){return!(0,_isInclusivelyAfterDay.default)(e,(0,_moment.default)())},isDayHighlighted:function(){},displayFormat:function(){return _moment.default.localeData().longDateFormat("L")},monthFormat:"MMMM YYYY",weekDayFormat:"dd",phrases:_defaultPhrases.SingleDatePickerPhrases,dayAriaLabelFormat:void 0},SingleDatePicker=function(i){(0,_inheritsLoose2.default)(t,i);var e=t.prototype;function t(e){var t=i.call(this,e)||this;return t.isTouchDevice=!1,t.state={dayPickerContainerStyles:{},isDayPickerFocused:!1,isInputFocused:!1,showKeyboardShortcuts:!1},t.onFocusOut=t.onFocusOut.bind((0,_assertThisInitialized2.default)(t)),t.onOutsideClick=t.onOutsideClick.bind((0,_assertThisInitialized2.default)(t)),t.onInputFocus=t.onInputFocus.bind((0,_assertThisInitialized2.default)(t)),t.onDayPickerFocus=t.onDayPickerFocus.bind((0,_assertThisInitialized2.default)(t)),t.onDayPickerBlur=t.onDayPickerBlur.bind((0,_assertThisInitialized2.default)(t)),t.showKeyboardShortcutsPanel=t.showKeyboardShortcutsPanel.bind((0,_assertThisInitialized2.default)(t)),t.responsivizePickerPosition=t.responsivizePickerPosition.bind((0,_assertThisInitialized2.default)(t)),t.disableScroll=t.disableScroll.bind((0,_assertThisInitialized2.default)(t)),t.setDayPickerContainerRef=t.setDayPickerContainerRef.bind((0,_assertThisInitialized2.default)(t)),t.setContainerRef=t.setContainerRef.bind((0,_assertThisInitialized2.default)(t)),t}return e[!_react.default.PureComponent&&"shouldComponentUpdate"]=function(e,t){return!(0,_enzymeShallowEqual.default)(this.props,e)||!(0,_enzymeShallowEqual.default)(this.state,t)},e.componentDidMount=function(){this.removeResizeEventListener=(0,_consolidatedEvents.addEventListener)(window,"resize",this.responsivizePickerPosition,{passive:!0}),this.responsivizePickerPosition(),this.disableScroll(),this.props.focused&&this.setState({isInputFocused:!0}),this.isTouchDevice=(0,_isTouchDevice.default)()},e.componentDidUpdate=function(e){var t=this.props.focused;!e.focused&&t?(this.responsivizePickerPosition(),this.disableScroll()):e.focused&&!t&&this.enableScroll&&this.enableScroll()},e.componentWillUnmount=function(){this.removeResizeEventListener&&this.removeResizeEventListener(),this.removeFocusOutEventListener&&this.removeFocusOutEventListener(),this.enableScroll&&this.enableScroll()},e.onOutsideClick=function(e){var t=this.props,i=t.focused,n=t.onFocusChange,r=t.onClose,o=t.date,a=t.appendToBody;i&&(a&&this.dayPickerContainer.contains(e.target)||(this.setState({isInputFocused:!1,isDayPickerFocused:!1,showKeyboardShortcuts:!1}),n({focused:!1}),r({date:o})))},e.onInputFocus=function(e){var t=e.focused,i=this.props,n=i.onFocusChange,r=i.readOnly,o=i.withPortal,a=i.withFullScreenPortal,s=i.keepFocusOnInput;t&&(o||a||r&&!s||this.isTouchDevice&&!s?this.onDayPickerFocus():this.onDayPickerBlur()),n({focused:t})},e.onDayPickerFocus=function(){this.setState({isInputFocused:!1,isDayPickerFocused:!0,showKeyboardShortcuts:!1})},e.onDayPickerBlur=function(){this.setState({isInputFocused:!0,isDayPickerFocused:!1,showKeyboardShortcuts:!1})},e.onFocusOut=function(e){var t=this.props.onFocusChange,i=e.relatedTarget!==document.body&&e.relatedTarget||e.target;this.dayPickerContainer.contains(i)||t({focused:!1})},e.setDayPickerContainerRef=function(e){e!==this.dayPickerContainer&&(this.removeEventListeners(),(this.dayPickerContainer=e)&&this.addEventListeners())},e.setContainerRef=function(e){this.container=e},e.addEventListeners=function(){this.removeFocusOutEventListener=(0,_consolidatedEvents.addEventListener)(this.dayPickerContainer,"focusout",this.onFocusOut)},e.removeEventListeners=function(){this.removeFocusOutEventListener&&this.removeFocusOutEventListener()},e.disableScroll=function(){var e=this.props,t=e.appendToBody,i=e.disableScroll,n=e.focused;(t||i)&&n&&(this.enableScroll=(0,_disableScroll2.default)(this.container))},e.responsivizePickerPosition=function(){this.setState({dayPickerContainerStyles:{}});var e,t,i,n,r=this.props,o=r.openDirection,a=r.anchorDirection,s=r.horizontalMargin,l=r.withPortal,c=r.withFullScreenPortal,u=r.appendToBody,d=r.focused,h=this.state.dayPickerContainerStyles;d&&(e=a===_constants.ANCHOR_LEFT,l||c||(t=this.dayPickerContainer.getBoundingClientRect(),i=h[a]||0,n=e?t[_constants.ANCHOR_RIGHT]:t[_constants.ANCHOR_LEFT],this.setState({dayPickerContainerStyles:_objectSpread({},(0,_getResponsiveContainerStyles.default)(a,i,n,s),{},u&&(0,_getDetachedContainerStyles.default)(o,a,this.container))})))},e.showKeyboardShortcutsPanel=function(){this.setState({isInputFocused:!1,isDayPickerFocused:!0,showKeyboardShortcuts:!0})},e.maybeRenderDayPickerWithPortal=function(){var e=this.props,t=e.focused,i=e.withPortal,n=e.withFullScreenPortal,r=e.appendToBody;return t?i||n||r?_react.default.createElement(_reactPortal.Portal,null,this.renderDayPicker()):this.renderDayPicker():null},e.renderDayPicker=function(){var e=this.props,t=e.anchorDirection,i=e.openDirection,n=e.onDateChange,r=e.date,o=e.onFocusChange,a=e.focused,s=e.enableOutsideDays,l=e.numberOfMonths,c=e.orientation,u=e.monthFormat,d=e.dayPickerNavigationInlineStyles,h=e.navPosition,p=e.navPrev,_=e.navNext,f=e.onPrevMonthClick,P=e.onNextMonthClick,D=e.onClose,y=e.withPortal,k=e.withFullScreenPortal,S=e.keepOpenOnDateSelect,g=e.initialVisibleMonth,b=e.renderMonthText,v=e.renderWeekHeaderElement,C=e.renderCalendarDay,O=e.renderDayContents,m=e.renderCalendarInfo,I=e.renderMonthElement,R=e.calendarInfoPosition,F=e.hideKeyboardShortcutsPanel,T=e.firstDayOfWeek,E=e.customCloseIcon,w=e.phrases,q=e.dayAriaLabelFormat,L=e.daySize,N=e.isRTL,z=e.isOutsideRange,M=e.isDayBlocked,B=e.isDayHighlighted,H=e.weekDayFormat,x=e.styles,A=e.verticalHeight,K=e.transitionDuration,W=e.verticalSpacing,j=e.horizontalMonthPadding,V=e.small,U=e.theme.reactDates,G=this.state,Y=G.dayPickerContainerStyles,Z=G.isDayPickerFocused,Q=G.showKeyboardShortcuts,X=!k&&y?this.onOutsideClick:void 0,J=E||_react.default.createElement(_CloseButton.default,null),$=(0,_getInputHeight.default)(U,V),ee=y||k;return _react.default.createElement("div",(0,_extends2.default)({ref:this.setDayPickerContainerRef},(0,_reactWithStyles.css)(x.SingleDatePicker_picker,t===_constants.ANCHOR_LEFT&&x.SingleDatePicker_picker__directionLeft,t===_constants.ANCHOR_RIGHT&&x.SingleDatePicker_picker__directionRight,i===_constants.OPEN_DOWN&&x.SingleDatePicker_picker__openDown,i===_constants.OPEN_UP&&x.SingleDatePicker_picker__openUp,!ee&&i===_constants.OPEN_DOWN&&{top:$+W},!ee&&i===_constants.OPEN_UP&&{bottom:$+W},c===_constants.HORIZONTAL_ORIENTATION&&x.SingleDatePicker_picker__horizontal,c===_constants.VERTICAL_ORIENTATION&&x.SingleDatePicker_picker__vertical,ee&&x.SingleDatePicker_picker__portal,k&&x.SingleDatePicker_picker__fullScreenPortal,N&&x.SingleDatePicker_picker__rtl,Y),{onClick:X}),_react.default.createElement(_DayPickerSingleDateController.default,{date:r,onDateChange:n,onFocusChange:o,orientation:c,enableOutsideDays:s,numberOfMonths:l,monthFormat:u,withPortal:ee,focused:a,keepOpenOnDateSelect:S,hideKeyboardShortcutsPanel:F,initialVisibleMonth:g,dayPickerNavigationInlineStyles:d,navPosition:h,navPrev:p,navNext:_,onPrevMonthClick:f,onNextMonthClick:P,onClose:D,renderMonthText:b,renderWeekHeaderElement:v,renderCalendarDay:C,renderDayContents:O,renderCalendarInfo:m,renderMonthElement:I,calendarInfoPosition:R,isFocused:Z,showKeyboardShortcuts:Q,onBlur:this.onDayPickerBlur,phrases:w,dayAriaLabelFormat:q,daySize:L,isRTL:N,isOutsideRange:z,isDayBlocked:M,isDayHighlighted:B,firstDayOfWeek:T,weekDayFormat:H,verticalHeight:A,transitionDuration:K,horizontalMonthPadding:j}),k&&_react.default.createElement("button",(0,_extends2.default)({},(0,_reactWithStyles.css)(x.SingleDatePicker_closeButton),{"aria-label":w.closeDatePicker,type:"button",onClick:this.onOutsideClick}),_react.default.createElement("div",(0,_reactWithStyles.css)(x.SingleDatePicker_closeButton_svg),J)))},e.render=function(){var e=this.props,t=e.id,i=e.placeholder,n=e.ariaLabel,r=e.disabled,o=e.focused,a=e.required,s=e.readOnly,l=e.openDirection,c=e.showClearDate,u=e.showDefaultInputIcon,d=e.inputIconPosition,h=e.customCloseIcon,p=e.customInputIcon,_=e.date,f=e.onDateChange,P=e.displayFormat,D=e.phrases,y=e.withPortal,k=e.withFullScreenPortal,S=e.screenReaderInputMessage,g=e.isRTL,b=e.noBorder,v=e.block,C=e.small,O=e.regular,m=e.verticalSpacing,I=e.reopenPickerOnClearDate,R=e.keepOpenOnDateSelect,F=e.styles,T=e.isOutsideRange,E=this.state.isInputFocused,w=!y&&!k,q=m<_constants.FANG_HEIGHT_PX,L=_react.default.createElement(_SingleDatePickerInputController.default,{id:t,placeholder:i,ariaLabel:n,focused:o,isFocused:E,disabled:r,required:a,readOnly:s,openDirection:l,showCaret:!y&&!k&&!q,showClearDate:c,showDefaultInputIcon:u,inputIconPosition:d,isOutsideRange:T,customCloseIcon:h,customInputIcon:p,date:_,onDateChange:f,displayFormat:P,onFocusChange:this.onInputFocus,onKeyDownArrowDown:this.onDayPickerFocus,onKeyDownQuestionMark:this.showKeyboardShortcutsPanel,screenReaderMessage:S,phrases:D,isRTL:g,noBorder:b,block:v,small:C,regular:O,verticalSpacing:m,reopenPickerOnClearDate:I,keepOpenOnDateSelect:R},this.maybeRenderDayPickerWithPortal());return _react.default.createElement("div",(0,_extends2.default)({ref:this.setContainerRef},(0,_reactWithStyles.css)(F.SingleDatePicker,v&&F.SingleDatePicker__block)),w&&_react.default.createElement(_reactOutsideClickHandler.default,{onOutsideClick:this.onOutsideClick},L),w||L)},t}(_react.default.PureComponent||_react.default.Component);(exports.PureSingleDatePicker=SingleDatePicker).propTypes="production"!==process.env.NODE_ENV?propTypes:{},SingleDatePicker.defaultProps=defaultProps;var _default=(0,_reactWithStyles.withStyles)(function(e){var t=e.reactDates,i=t.color,n=t.zIndex;return{SingleDatePicker:{position:"relative",display:"inline-block"},SingleDatePicker__block:{display:"block"},SingleDatePicker_picker:{zIndex:n+1,backgroundColor:i.background,position:"absolute"},SingleDatePicker_picker__rtl:{direction:(0,_noflip.default)("rtl")},SingleDatePicker_picker__directionLeft:{left:(0,_noflip.default)(0)},SingleDatePicker_picker__directionRight:{right:(0,_noflip.default)(0)},SingleDatePicker_picker__portal:{backgroundColor:"rgba(0, 0, 0, 0.3)",position:"fixed",top:0,left:(0,_noflip.default)(0),height:"100%",width:"100%"},SingleDatePicker_picker__fullScreenPortal:{backgroundColor:i.background},SingleDatePicker_closeButton:{background:"none",border:0,color:"inherit",font:"inherit",lineHeight:"normal",overflow:"visible",cursor:"pointer",position:"absolute",top:0,right:(0,_noflip.default)(0),padding:15,zIndex:n+2,":hover":{color:"darken(".concat(i.core.grayLighter,", 10%)"),textDecoration:"none"},":focus":{color:"darken(".concat(i.core.grayLighter,", 10%)"),textDecoration:"none"}},SingleDatePicker_closeButton_svg:{height:15,width:15,fill:i.core.grayLighter}}},{pureComponent:void 0!==_react.default.PureComponent})(SingleDatePicker);exports.default=_default;