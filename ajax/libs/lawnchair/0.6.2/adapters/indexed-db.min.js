Lawnchair.adapter("indexed-db",function(){function h(t,n){console.log("error in indexed-db adapter!",t,n)}function r(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB}return{valid:function(){return!!r()},init:function(t,n){this.idb=r(),this.waiting=[];function i(){return e.call(o,o)}var s=this.idb.open(this.name),o=this,e=o.fn(o.name,n);s.onsuccess=function(t){if(o.db=s.result,"1.0"!=o.db.version){var n=o.db.setVersion("1.0");n.onsuccess=function(t){o.store=o.db.createObjectStore("teststore",{autoIncrement:!0});for(var n=0;n<o.waiting.length;n++)o.waiting[n].call(o);o.waiting=[],i()},n.onerror=function(t){console.log("Failed to create objectstore "+t),h(t)}}else{o.store={};for(var e=0;e<o.waiting.length;e++)o.waiting[e].call(o);o.waiting=[],i()}},s.onerror=h},save:function(n,e){if(this.store){var i=this,t=this.db.transaction(["teststore"],webkitIDBTransaction.READ_WRITE,0).objectStore("teststore"),s=n.key?t.put(n,n.key):t.put(n);return s.onsuccess=function(t){e&&(n.key=t.target.result,i.lambda(e).call(i,n))},s.onerror=h,this}this.waiting.push(function(){this.save(n,e)})},batch:function(n,t){function e(t){i.push(t),s=i.length===n.length}for(var i=[],s=!1,o=this,r=setInterval(function(){s&&(t&&o.lambda(t).call(o,i),clearInterval(r))},200),a=0,c=n.length;a<c;a++)this.save(n[a],e);return this},get:function(n,e){if(this.store){var i=this;if(this.isArray(n)){function t(t){s.push(t),o=s.length===r.length}for(var s=[],o=!1,r=n,a=setInterval(function(){o&&(e&&i.lambda(e).call(i,s),clearInterval(a))},200),c=0,u=r.length;c<u;c++)this.get(r[c],t)}else{var l=this.db.transaction("teststore").objectStore("teststore").get(n);l.onsuccess=function(t){e&&i.lambda(e).call(i,t.target.result)},l.onerror=function(t){console.log("Failed to find "+n),h(t)}}return this}this.waiting.push(function(){this.get(n,e)})},all:function(t){if(this.store){var e=this.fn(this.name,t)||void 0,i=this,n=this.db.transaction("teststore").objectStore("teststore"),s=[];return n.openCursor().onsuccess=function(t){var n=t.target.result;n?(s.push(n.value),n.continue()):e&&e.call(i,s)},this}this.waiting.push(function(){this.all(t)})},remove:function(t,n){if(this.store){"object"==typeof t&&(t=t.key);var e=this,i=this.db.transaction(["teststore"],webkitIDBTransaction.READ_WRITE).objectStore("teststore").delete(t);return i.onsuccess=function(){n&&e.lambda(n).call(e)},i.onerror=h,this}this.waiting.push(function(){this.remove(t,n)})},nuke:function(t){if(this.store){var n=this,e=t?function(){n.lambda(t).call(n)}:function(){};try{this.db.transaction(["teststore"],webkitIDBTransaction.READ_WRITE).objectStore("teststore").clear().onsuccess=e}catch(t){h()}return this}this.waiting.push(function(){this.nuke(t)})}}}());