{"version":3,"file":"vuejs-storage.min.js","sources":["../src/objpath.ts","../src/drivers.ts","../src/merge.ts","../src/install.ts","../src/index.ts","../src/vuexplugin.ts"],"sourcesContent":["export function parsePath(path: string): string[] {\n\treturn path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n}\nexport function get(obj: object, path: string): any {\n\treturn parsePath(path).reduce((prev, cur) => prev && prev[cur], obj)\n}\nexport function set(obj: object, path: string, value: any): void {\n\tconst paths = parsePath(path)\n\tlet cur = obj\n\tfor (let i = 0; i < paths.length - 1; i++) {\n\t\tconst pname = paths[i]\n\t\tif (!cur.hasOwnProperty(pname)) cur[pname] = {}\n\t\tcur = cur[pname]\n\t}\n\tcur[paths[paths.length - 1]] = value\n}\nexport function copy(dest: object, source: object, path: string): void {\n\tset(dest, path, get(source, path))\n}\n","import { StorageDriver } from './interfaces'\nexport default class StroageDriverImpl implements StorageDriver {\n\tprivate storage\n\tconstructor(storage: Storage) {\n\t\tthis.storage = storage\n\t}\n\tset(key: string, value: any) {\n\t\tthis.storage.setItem(key, JSON.stringify(value))\n\t}\n\tget(key: string) {\n\t\treturn JSON.parse(this.storage.getItem(key))\n\t}\n\thas(key: string) {\n\t\treturn !!this.storage.getItem(key)\n\t}\n}\nexport const localStorage = new StroageDriverImpl(window.localStorage)\nexport const sessionStorage = new StroageDriverImpl(window.sessionStorage)\n","// a simple object merge function implementation\nexport const isobj = x => typeof x === 'object' && !Array.isArray(x) && x !== null\nfunction merge(obj1: object, ...objs: object[]) {\n\tfor (const obj2 of objs) {\n\t\tfor (const k in obj2) {\n\t\t\tif (!obj2.hasOwnProperty(k)) continue\n\t\t\tif (isobj(obj2[k])) merge(obj1[k], obj2[k])\n\t\t\telse obj1[k] = obj2[k]\n\t\t}\n\t}\n\treturn obj1\n}\nexport default merge\n","import { Vue, VueConstructor, Option } from './interfaces'\nimport { set, copy } from './objpath'\nimport { localStorage } from './drivers'\nimport defaultMerge from './merge'\n\nfunction applyPersistence(vm, option: Option) {\n\tconst { keys, merge = defaultMerge, namespace: ns, driver = localStorage } = option\n\n\tlet originaldata = {}\n\tfor (const k of keys) {\n\t\tcopy(originaldata, vm, k)\n\t}\n\n\tlet data = null\n\tif (driver.has(ns)) {\n\t\tdata = driver.get(ns)\n\t} else {\n\t\tconst tmp = {}\n\t\tfor (const k of keys) {\n\t\t\tcopy(tmp, originaldata, k)\n\t\t}\n\t\tdata = tmp\n\t\tdriver.set(ns, data)\n\t}\n\tdata = merge(originaldata, data)\n\tfor (const k of keys) {\n\t\tcopy(vm, data, k)\n\t\tvm.$watch(k, {\n\t\t\thandler: value => {\n\t\t\t\tset(data, k, value)\n\t\t\t\tdriver.set(ns, data)\n\t\t\t},\n\t\t\tdeep: true\n\t\t})\n\t}\n}\n\nexport function install(Vue: VueConstructor) {\n\tVue.mixin({\n\t\tcreated() {\n\t\t\tif ('storage' in this.$options) {\n\t\t\t\tconst option: Option | Option[] = this.$options.storage\n\t\t\t\tif (Array.isArray(option)) option.forEach(opt => applyPersistence(this, opt))\n\t\t\t\telse applyPersistence(this, option)\n\t\t\t}\n\t\t}\n\t})\n}\n","import { Vue, VueConstructor, VuexPlugin, StorageDriver } from './interfaces'\n\nimport { install } from './install'\nimport { createVuexPlugin } from './vuexplugin'\nimport * as drivers from './drivers'\n\nexport interface vjs {\n\t(): VuexPlugin<Object>\n\tinstall: (Vue: VueConstructor) => void\n\tdrivers: { localStorage: StorageDriver; sessionStorage: StorageDriver }\n}\nconst vuejsStorage = <vjs>function(option) {\n\treturn createVuexPlugin(option)\n}\nvuejsStorage.install = install\nvuejsStorage.drivers = drivers\n\nexport default vuejsStorage\n","import { Store, VuexPlugin, Option } from './interfaces'\nimport { copy } from './objpath'\nimport { localStorage } from './drivers'\nimport defaultMerge from './merge'\n\n/**\n * Create Vuex plugin\n */\nexport function createVuexPlugin(option: Option): VuexPlugin<object> {\n\tconst { keys, merge = defaultMerge, namespace: ns, driver = localStorage } = option\n\treturn (store: Store<object>) => {\n\t\tif (driver.has(ns)) {\n\t\t\tconst data = driver.get(ns)\n\t\t\tstore.replaceState(merge(store.state, data))\n\t\t} else {\n\t\t\tconst data = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(data, store.state, k)\n\t\t\t}\n\t\t\tdriver.set(ns, data)\n\t\t}\n\t\tstore.subscribe((mutation, state) => {\n\t\t\tconst data = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(data, state, k)\n\t\t\t}\n\t\t\tdriver.set(ns, data)\n\t\t})\n\t}\n}\n"],"names":["path","replace","split","filter","t","obj","value","paths","parsePath","cur","i","length","pname","hasOwnProperty","dest","source","set","reduce","prev","get","storage","this","StroageDriverImpl","key","setItem","JSON","stringify","parse","getItem","localStorage","window","sessionStorage","isobj","x","Array","isArray","obj1","_i","objs","objs_1","_a","obj2","k","merge","vm","option","keys","ns","_b","driver","originaldata","keys_1","copy","data","has","tmp","keys_2","_c","$watch","handler","deep","keys_3","_d","vuejsStorage","store","replaceState","state","subscribe","mutation","createVuexPlugin","install","Vue","mixin","created","$options","forEach","opt","applyPersistence","_this","drivers"],"mappings":"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"}