InteractiveDataDisplay="undefined"==typeof InteractiveDataDisplay?{}:InteractiveDataDisplay,InteractiveDataDisplay.DataTransform=function(a,t,r,e){this.dataToPlot=a,this.plotToData=t,this.domain=r||{isInDomain:function(a){return!0}},this.type=e};var mercator_maxPhi=85.05112878,mercator_R=mercator_maxPhi/Math.log(Math.tan(mercator_maxPhi*Math.PI/360+Math.PI/4));InteractiveDataDisplay.mercatorTransform=new InteractiveDataDisplay.DataTransform(function(a){return-mercator_maxPhi<=a&&a<=mercator_maxPhi?mercator_R*Math.log(Math.tan(Math.PI*(a+90)/360)):a},function(a){return-mercator_maxPhi<=a&&a<=mercator_maxPhi?360*Math.atan(Math.exp(a/mercator_R))/Math.PI-90:a},void 0,"mercator"),Math.LOGE10=Math.log(10),InteractiveDataDisplay.logTransform=new InteractiveDataDisplay.DataTransform(function(a){return Math.log(a)/Math.LOGE10},function(a){return Math.pow(10,a)},{isInDomain:function(a){return 1e-8<a}},"log10"),InteractiveDataDisplay.identityTransform=new InteractiveDataDisplay.DataTransform(function(a){return a},function(a){return a},{isInDomain:function(a){return!0}},"identity"),self.onmessage=function(a){var t,r,e,n,i,o,f=a.data.scaleX,d=a.data.offsetX,l=a.data.scaleY,c=a.data.offsetY;r="string"==typeof a.data.xDataTransform?(n=(e=getDataTransform(a.data.xDataTransform)).dataToPlot,t=!0,function(a){return n(a)*f+d}):(t=!1,function(a){return f*a+d}),o="string"==typeof a.data.yDataTransform?(n=(e=getDataTransform(a.data.yDataTransform)).dataToPlot,i=!0,function(a){return c-n(a)*l}):(i=!1,function(a){return c-a*l});var s,m,v,h=a.data.width,u=a.data.height;a.data.x.length!=a.data.f.length?renderMatrix(a.data.image,h,u,a.data.x,a.data.y,a.data.f,a.data.fmin,a.data.fmax,a.data.palette,a.data.plotRect,r,o,t,i):(xscale_r=1/f,yscale_r=1/l,s=t?(m=e.plotToData,function(a){return m((a-d)*xscale_r)}):function(a){return(a-d)*xscale_r},v=i?(m=e.plotToData,function(a){return m((c-a)*yscale_r)}):function(a){return(c-a)*yscale_r},renderGradient(a.data.image,h,u,a.data.x,a.data.y,a.data.f,a.data.fmin,a.data.fmax,a.data.palette,a.data.plotRect,r,s,o,v,t,i)),a.data.x=void 0,a.data.y=void 0,a.data.f=void 0,a.data.palette=void 0,self.postMessage(a.data)};var getDataTransform=function(a){if("mercator"==a)return InteractiveDataDisplay.mercatorTransform;throw"Unknown data transform"},renderMatrix=function(a,t,r,e,n,i,o,f,d,l,c,s,m,v){for(var h,u,D,y=e.length,g=n.length,p=a.data,x=t,M=r,T=new Float32Array(g),I=0;I<g;I++)T[I]=0|s(n[I]);var _=l.x;l.width;if(m){for(h=0;h<y;h++)if(0<=c(e[h])){0==h&&h++;break}}else for(h=0;h<y;h++)if(e[h]>=_){0==h&&h++;break}if(h!=y){l.y,l.height;for(var P=0;P<g;P++)if(T[P]<M){0==P&&P++;break}if(P!=g){var w=0,k=0,b=d.isNormalized,R=d.colors,A=(R.length>>2)-1;b||(f=d.range.max,o=d.range.min);for(var F=f!==o?1/(f-o):0,I=h;I<y&&k<x;I++){u=e[I-1];var G=e[I];if(u==u&&G==G){if((w=k||Math.ceil(c(u)))<0&&(w=0),x<=(k=Math.ceil(c(G)))&&(k=x),k-w!=0){D=n[P-1];for(var z=0,E=T[P-1],L=P;L<g&&0<=z;L++){D=n[L-1];var N=n[L];if(D==D&&N==N){if(z=E||T[L-1],(E=T[L])<0&&(E=-1),M<=z&&(z=M-1),E-z!=0){var O=i[I-1][L-1];if(O==O){var X=F*(O-o)*A|0;X<0?X=0:A<X&&(X=A),X<<=2;for(var Y=E+1;Y<=z;Y++)for(var U=x*Y+w<<2,j=w;j<k;j++)p[U++]=R[X],p[U++]=R[X+1],p[U++]=R[X+2],p[U++]=R[X+3];if(E<=0)break}}}else E=void 0}if(x<=k)break}}else k=void 0}}}},renderGradient=function(a,t,r,e,n,i,o,f,d,l,c,s,m,v,h,u){for(var D=e.length,y=n.length,g=a.data,p=t,x=r,M=new Float32Array(y),T=0;T<y;T++)M[T]=0|m(n[T]);for(var I=new Float32Array(p),_=0;_<p;_++)I[_]=s(_+.5);for(var P,w,k,b=new Float32Array(x),R=0;R<x;R++)b[R]=v(R+.5);var A=l.x;l.width;if(h){for(P=0;P<D;P++)if(0<=c(e[P])){0==P&&P++;break}}else for(P=0;P<D;P++)if(e[P]>=A){0==P&&P++;break}if(P!=D){l.y,l.height;for(var F=0;F<y;F++)if(M[F]<x){0==F&&F++;break}if(F!=y){var G=0,z=0,E=d.isNormalized,L=d.colors,N=(L.length>>2)-1;E||(f=d.range.max,o=d.range.min);for(var O,X,Y,U,j=f!==o?1/(f-o):0,T=P;T<D&&z<p;T++){w=e[T-1];var q=e[T];if(w==w&&q==q){if((G=z||Math.ceil(c(w)))<0&&(G=0),p<=(z=Math.ceil(c(q)))&&(z=p),z-G!=0){for(var B=0,C=0,H=i[T],J=i[T-1],K=F;K<y&&0<=B;K++){k=n[K-1];var Q=n[K];if(k==k&&Q==Q){if(B=C||M[K-1],(C=M[K])<0&&(C=-1),x<=B&&(B=x-1),B-C!=0&&(X=J[K],O=J[K-1],Y=H[K],U=H[K-1],X==X&&O==O&&Y==Y&&U==U)){for(var S=(X-O)/(Q-k),V=(Y-U)/(Q-k),R=C+1;R<=B;R++)for(var W=p*R+G<<2,Z=b[R],$=S*(Z-k)+O,aa=(V*(Z-k)+U-$)/(q-w),_=G;_<z;_++){var ta=j*(aa*(I[_]-w)+$-o)*N|0;ta<0?ta=0:N<ta&&(ta=N),ta<<=2,g[W++]=L[ta++],g[W++]=L[ta++],g[W++]=L[ta++],g[W++]=L[ta]}if(C<=0)break}}else C=void 0}if(p<=z)break}}else z=void 0}}}};