!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(r=r||self).wretch=t()}(this,function(){"use strict";var d=function(){return(d=Object.assign||function(r){for(var t,e=1,o=arguments.length;e<o;e++)for(var n in t=arguments[e])Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}).apply(this,arguments)};function y(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var o=Array(r),n=0,t=0;t<e;t++)for(var i=arguments[t],s=0,u=i.length;s<u;s++,n++)o[n]=i[s];return o}function i(r,t,e,o){if(r.getEntriesByName){var n=r.getEntriesByName(t);return!!(n&&0<n.length)&&(e(n.reverse()[0]),o.clearMeasures&&o.clearMeasures(t),g.callbacks.delete(t),g.callbacks.size<1&&(g.observer.disconnect(),o.clearResourceTimings&&o.clearResourceTimings()),!0)}}function v(r){this.error=r}var m=function(r,t,e){if(void 0===e&&(e=!1),!r||!t||"object"!=typeof r||"object"!=typeof t)return r;var o=d({},r);for(var n in t)t.hasOwnProperty(n)&&(t[n]instanceof Array&&r[n]instanceof Array?o[n]=e?y(r[n],t[n]):t[n]:"object"==typeof t[n]&&"object"==typeof r[n]?o[n]=m(r[n],t[n],e):o[n]=t[n]);return o},b={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(r,t){for(var e=void 0===t?{}:t,o=e.doThrow,n=void 0===o||o,i=e.instance,s=void 0!==i&&i,u=[],a=2;a<arguments.length;a++)u[a-2]=arguments[a];var f=this.polyfills[r]||("undefined"!=typeof self?self[r]:null)||("undefined"!=typeof global?global[r]:null);if(n&&!f)throw new Error(r+" is not defined");return s&&f?new(f.bind.apply(f,y([void 0],u))):f}},g={callbacks:new Map,observer:null,observe:function(r,t){var e,o,n;r&&t&&(e=b.polyfill("performance",{doThrow:!1}),o=e,n=b.polyfill("PerformanceObserver",{doThrow:!1}),!g.observer&&o&&n&&(g.observer=new n(function(e){g.callbacks.forEach(function(r,t){i(e,t,r,o)})}),o.clearResourceTimings&&o.clearResourceTimings()),g.observer&&(i(e,r,t,e)||(g.callbacks.size<1&&g.observer.observe({entryTypes:["resource","measure"]}),g.callbacks.set(r,t))))}},r=(_.factory=function(r,t){return void 0===r&&(r=""),void 0===t&&(t={}),new _(r,t)},_.prototype.selfFactory=function(r){var t=void 0===r?{}:r,e=t.url,o=void 0===e?this._url:e,n=t.options,i=void 0===n?this._options:n,s=t.catchers,u=void 0===s?this._catchers:s,a=t.resolvers,f=void 0===a?this._resolvers:a,c=t.middlewares,l=void 0===c?this._middlewares:c,p=t.deferredChain,h=void 0===p?this._deferredChain:p;return new _(o,d({},i),new Map(u),y(f),y(l),y(h))},_.prototype.defaults=function(r,t){return void 0===t&&(t=!1),b.defaults=t?m(b.defaults,r):r,this},_.prototype.errorType=function(r){return b.errorType=r,this},_.prototype.polyfills=function(r){return b.polyfills=d(d({},b.polyfills),r),this},_.prototype.url=function(r,t){if(void 0===t&&(t=!1),t)return this.selfFactory({url:r});var e=this._url.split("?");return this.selfFactory({url:1<e.length?e[0]+r+"?"+e[1]:this._url+r})},_.prototype.options=function(r,t){return void 0===t&&(t=!0),this.selfFactory({options:t?m(this._options,r):r})},_.prototype.query=function(r,t){return void 0===t&&(t=!1),this.selfFactory({url:e(this._url,r,t)})},_.prototype.headers=function(r){return this.selfFactory({options:m(this._options,{headers:r||{}})})},_.prototype.accept=function(r){return this.headers({Accept:r})},_.prototype.content=function(r){return this.headers({"Content-Type":r})},_.prototype.auth=function(r){return this.headers({Authorization:r})},_.prototype.catcher=function(r,t){var e=new Map(this._catchers);return e.set(r,t),this.selfFactory({catchers:e})},_.prototype.signal=function(r){return this.selfFactory({options:d(d({},this._options),{signal:r.signal})})},_.prototype.resolve=function(r,t){return void 0===t&&(t=!1),this.selfFactory({resolvers:t?[r]:y(this._resolvers,[r])})},_.prototype.defer=function(r,t){return void 0===t&&(t=!1),this.selfFactory({deferredChain:t?[r]:y(this._deferredChain,[r])})},_.prototype.middlewares=function(r,t){return void 0===t&&(t=!1),this.selfFactory({middlewares:t?r:y(this._middlewares,r)})},_.prototype.method=function(r,t,e){void 0===t&&(t={}),void 0===e&&(e=null);var o=e?"object"==typeof e?this.json(e):this.body(e):this;return function(o){var r=o._url,t=o._catchers,e=o._resolvers,n=o._middlewares,i=o._options,s=new Map(t),u=m(b.defaults,i),a=b.polyfill("AbortController",{doThrow:!1,instance:!0});function f(e){return function(t){return(e?h.then(function(r){return r&&r[e]()}).then(function(r){return t?t(r):r}):h.then(function(r){return t?t(r):r})).catch(function(r){l.clear();var t=r instanceof v?r.error:r;if(r instanceof v&&s.has("__fromFetch"))return s.get("__fromFetch")(t,o);if(s.has(t.status))return s.get(t.status)(t,o);if(s.has(t.name))return s.get(t.name)(t,o);throw t})}}!u.signal&&a&&(u.signal=a.signal);var c,l={ref:null,clear:function(){l.ref&&(clearTimeout(l.ref),l.ref=null)}},p=(c=n,function(o){return 0===c.length?o:1===c.length?c[0](o):c.reduceRight(function(r,t,e){return e===c.length-2?t(r(o)):t(r)})}(b.polyfill("fetch"))(r,u)),h=p.catch(function(r){throw new v(r)}).then(function(e){return l.clear(),e.ok?e:e[b.errorType||"text"]().then(function(r){var t=new Error(r);throw t[b.errorType||"text"]=r,t.status=e.status,t.response=e,t})}),d={res:f(null),json:f("json"),blob:f("blob"),formData:f("formData"),arrayBuffer:f("arrayBuffer"),text:f("text"),perfs:function(t){return p.then(function(r){return g.observe(r.url,t)}),d},setTimeout:function(r,t){return void 0===t&&(t=a),l.clear(),l.ref=setTimeout(function(){return t.abort()},r),d},controller:function(){return[a,d]},error:function(r,t){return s.set(r,t),d},badRequest:function(r){return d.error(400,r)},unauthorized:function(r){return d.error(401,r)},forbidden:function(r){return d.error(403,r)},notFound:function(r){return d.error(404,r)},timeout:function(r){return d.error(408,r)},internalError:function(r){return d.error(500,r)},fetchError:function(r){return d.error("__fromFetch",r)},onAbort:function(r){return d.error("AbortError",r)}};return e.reduce(function(r,t){return t(r,o)},d)}((o=o.options(d(d({},t),{method:r})))._deferredChain.reduce(function(r,t){return t(r,r._url,r._options)},o))},_.prototype.get=function(r){return this.method("GET",r)},_.prototype.delete=function(r){return this.method("DELETE",r)},_.prototype.put=function(r,t){return this.method("PUT",t,r)},_.prototype.post=function(r,t){return this.method("POST",t,r)},_.prototype.patch=function(r,t){return this.method("PATCH",t,r)},_.prototype.head=function(r){return this.method("HEAD",r)},_.prototype.opts=function(r){return this.method("OPTIONS",r)},_.prototype.replay=function(r){return this.method(this._options.method,r)},_.prototype.body=function(r){return this.selfFactory({options:d(d({},this._options),{body:r})})},_.prototype.json=function(r){return this.content("application/json").body(JSON.stringify(r))},_.prototype.formData=function(r){return this.body(function(r){var t=b.polyfill("FormData",{instance:!0});for(var e in r)if(r[e]instanceof Array)for(var o=0,n=r[e];o<n.length;o++){var i=n[o];t.append(e+"[]",i)}else t.append(e,r[e]);return t}(r))},_.prototype.formUrl=function(r){return this.body("string"==typeof r?r:(e=r,Object.keys(e).map(function(t){var r=e[t];return r instanceof Array?r.map(function(r){return o(t,r)}).join("&"):o(t,r)}).join("&"))).content("application/x-www-form-urlencoded");var e},_),e=function(r,t,e){var o;if("string"==typeof t)o=t;else{var n=b.polyfill("URLSearchParams",{instance:!0});for(var i in t)if(t[i]instanceof Array)for(var s=0,u=t[i];s<u.length;s++){var a=u[s];n.append(i,a)}else n.append(i,t[i]);o=n.toString()}var f=r.split("?");return e||f.length<2?f[0]+"?"+o:r+"&"+o};function _(r,t,e,o,n,i){void 0===e&&(e=new Map),void 0===o&&(o=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),this._url=r,this._options=t,this._catchers=e,this._resolvers=o,this._middlewares=n,this._deferredChain=i}function o(r,t){return encodeURIComponent(r)+"="+encodeURIComponent("object"==typeof t?JSON.stringify(t):""+t)}var t=r.factory;return t.default=r.factory,t});