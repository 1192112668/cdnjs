"use strict";var artRule={test:/{{[ \t]*([@#]?)(\/?)([\w\W]*?)[ \t]*}}/,use:function(a,e,t,n){function i(e,t){console.warn((r.filename||"anonymous")+":"+(a.line+1)+":"+(a.start+1)+"\nTemplate upgrade: {{"+e+"}} -> {{"+t+"}}")}var r=this.options,s=this.getEsTokens(n.trim()),u=s.map(function(e){return e.value}),c={},o=void 0,l=!!e&&"raw",f=t+u.shift();switch("#"===e&&i("#value","@value"),f){case"set":n="var "+u.join("");break;case"if":n="if("+u.join("")+"){";break;case"else":var h=u.indexOf("if");n=-1<h?(u.splice(0,h+1),"}else if("+u.join("")+"){"):"}else{";break;case"/if":n="}";break;case"each":(o=artRule._split(s)).shift(),"as"===o[1]&&(i("each object as value index","each object value index"),o.splice(1,1));var p=o[0]||"$data",v=o[1]||"$value",b=o[2]||"$index";n="$each("+p+",function("+v+","+b+"){";break;case"/each":n="})";break;case"echo":f="print",i("echo value","value");case"print":case"include":case"extend":(o=artRule._split(s)).shift(),n=f+"("+o.join(",")+")";break;case"block":n="block("+u.join("")+",function(){";break;case"/block":n="})";break;default:if(-1!==u.indexOf("|")){for(var d=f,k=[],m=u.filter(function(e){return!/^\s+$/.test(e)});"|"!==m[0];)d+=m.shift();m.filter(function(e){return":"!==e}).forEach(function(e){"|"===e?k.push([]):k[k.length-1].push(e)}),k.reduce(function(e,t){var a=t.shift();return t.unshift(e),n="$imports."+a+"("+t.join(",")+")"},d)}else n=""+f+u.join("");l=l||"escape"}return c.code=n,c.output=l,c},_split:function(e){for(var t=0,a=e.shift(),n=[[a]];t<e.length;){var i=e[t],r=i.type;"whitespace"!==r&&"comment"!==r&&("punctuator"===a.type&&"]"!==a.value||"punctuator"===r?n[n.length-1].push(i):n.push([i]),a=i),t++}return n.map(function(e){return e.map(function(e){return e.value}).join("")})}};module.exports=artRule;