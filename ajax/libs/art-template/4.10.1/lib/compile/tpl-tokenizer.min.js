"use strict";var TYPE_STRING="string",TYPE_EXPRESSION="expression",TYPE_RAW="raw",TYPE_ESCAPE="escape";function Match(e,t,n,l){var r=new String(e);return r.line=t,r.start=n,r.end=l,r}var tplTokenizer=function(e,t,n){for(var R=2<arguments.length&&void 0!==n?n:{},c=[{type:TYPE_STRING,value:e,line:0,start:0,end:e.length}],l=function(e){for(var t=e.test.ignoreCase?"ig":"g",n=e.test.source+"|^$|[\\w\\W]",l=new RegExp(n,t),r=0;r<c.length;r++)if(c[r].type===TYPE_STRING){for(var E=c[r].line,T=c[r].start,a=c[r].end,i=c[r].value.match(l),s=[],P=0;P<i.length;P++){var p=i[P];e.test.lastIndex=0;var S,o=e.test.exec(p),Y=o?TYPE_EXPRESSION:TYPE_STRING,_=s[s.length-1],g=_||c[r],h=g.value,u={type:Y,value:p,line:E,start:T=g.line===E?_?_.end:T:h.length-h.lastIndexOf("\n")-1,end:a=T+p.length};Y===TYPE_STRING?_&&_.type===TYPE_STRING?(_.value+=p,_.end+=p.length):s.push(u):(o[0]=new Match(o[0],E,T,a),S=e.use.apply(R,o),u.script=S,s.push(u)),E+=p.split(/\n/).length-1}c.splice.apply(c,[r,1].concat(s)),r+=s.length-1}},r=0;r<t.length;r++)l(t[r]);return c};tplTokenizer.TYPE_STRING=TYPE_STRING,tplTokenizer.TYPE_EXPRESSION=TYPE_EXPRESSION,tplTokenizer.TYPE_RAW=TYPE_RAW,tplTokenizer.TYPE_ESCAPE=TYPE_ESCAPE,module.exports=tplTokenizer;