"use strict";var Compiler=require("./compiler"),defaults=require("./defaults"),TemplateError=require("./error"),debugRender=function(e,r){r.onerror(e,r);function t(){return"{Template Error}"}return t.mappings=[],t.sourcesContent=[],t},compile=function i(e,r){var n=1<arguments.length&&void 0!==r?r:{};"string"!=typeof e?n=e:n.source=e,e=(n=defaults.$extend(n)).source,n.debug&&(n.cache=!1,n.bail=!1,n.minimize=!1,n.compileDebug=!0),n.compileDebug&&(n.minimize=!1),n.filename&&(n.filename=n.resolveFilename(n.filename,n));var t=n.filename,o=n.cache,a=n.caches;if(o&&t){var u=a.get(t);if(u)return u}if(!e)try{e=n.loader(t,n),n.source=e}catch(e){var c=new TemplateError({name:"CompileError",path:t,message:"template not found: "+e.message,stack:e.stack});if(n.bail)throw c;return debugRender(c,n)}var l=void 0,m=new Compiler(n);try{l=m.build()}catch(c){if(c=new TemplateError(c),n.bail)throw c;return debugRender(c,n)}function p(r,t){try{return l(r,t)}catch(e){if(!n.compileDebug)return n.cache=!1,n.compileDebug=!0,i(n)(r,t);if(e=new TemplateError(e),n.bail)throw e;return debugRender(e,n)()}}return p.mappings=l.mappings,p.sourcesContent=l.sourcesContent,p.toString=function(){return l.toString()},o&&t&&a.set(t,p),p};compile.Compiler=Compiler,module.exports=compile;