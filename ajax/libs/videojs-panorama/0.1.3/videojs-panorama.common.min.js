"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var videojs=_interopDefault(require("video.js")),THREE$1=_interopDefault(require("three")),Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,Check_Version:function(){var e,t=-1;return"Microsoft Internet Explorer"==navigator.appName?(e=navigator.userAgent,null!==new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(-1!==navigator.appVersion.indexOf("Trident")?t=11:(e=navigator.userAgent,null!==new RegExp("Edge/([0-9]{1,}[\\.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1)))),t},supportVideoTexture:function(){var e=this.Check_Version();return-1===e||13<=e},isLiveStreamOnSafari:function(e){for(var t=e.querySelectorAll("source"),i=!1,n=0;n<t.length;n++){var a=t[n];("application/x-mpegURL"==a.type||"application/vnd.apple.mpegurl"==a.type)&&/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(i=!0);break}return i},getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,i=void 0!==(e=e||{}).parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie";(t=Detector.getWebGLErrorMessage()).id=n,i.appendChild(t)}},MobileBuffering={prev_currentTime:0,counter:0,isBuffering:function(e){return e==this.prev_currentTime?this.counter++:this.counter=0,this.prev_currentTime=e,10<this.counter&&(this.counter=10,!0)}},HAVE_CURRENT_DATA=2,BaseCanvas=function(a,r,e){var o=2<arguments.length&&void 0!==e?e:{};return{constructor:function(e,t){this.settings=t,this.width=e.el().offsetWidth,this.height=e.el().offsetHeight,this.lon=t.initLon,this.lat=t.initLat,this.phi=0,this.theta=0,this.videoType=t.videoType,this.clickToToggle=t.clickToToggle,this.mouseDown=!1,this.isUserInteracting=!1,this.renderer=new r.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.autoClear=!1,this.renderer.setClearColor(0,1);var i,n=o.getTech(e);this.supportVideoTexture=Detector.supportVideoTexture(),this.liveStreamOnSafari=Detector.isLiveStreamOnSafari(n),this.liveStreamOnSafari&&(this.supportVideoTexture=!1),this.supportVideoTexture?this.texture=new r.Texture(n):(this.helperCanvas=e.addChild("HelperCanvas",{video:n,width:this.width,height:this.height}),i=this.helperCanvas.el(),this.texture=new r.Texture(i)),n.style.display="none",this.texture.generateMipmaps=!1,this.texture.minFilter=r.LinearFilter,this.texture.maxFilter=r.LinearFilter,this.texture.format=r.RGBFormat,this.el_=this.renderer.domElement,this.el_.classList.add("vjs-video-canvas"),t.el=this.el_,a.call(this,e,t),this.attachControlEvents(),this.player().on("play",function(){this.time=(new Date).getTime(),this.animate()}.bind(this))},attachControlEvents:function(){this.on("mousemove",this.handleMouseMove.bind(this)),this.on("touchmove",this.handleMouseMove.bind(this)),this.on("mousedown",this.handleMouseDown.bind(this)),this.on("touchstart",this.handleMouseDown.bind(this)),this.on("mouseup",this.handleMouseUp.bind(this)),this.on("touchend",this.handleMouseUp.bind(this)),this.settings.scrollable&&(this.on("mousewheel",this.handleMouseWheel.bind(this)),this.on("MozMousePixelScroll",this.handleMouseWheel.bind(this))),this.on("mouseenter",this.handleMouseEnter.bind(this)),this.on("mouseleave",this.handleMouseLease.bind(this))},handleResize:function(){this.width=this.player().el().offsetWidth,this.height=this.player().el().offsetHeight,this.renderer.setSize(this.width,this.height)},handleMouseUp:function(e){if(this.mouseDown=!1,this.clickToToggle){var t=e.clientX||e.changedTouches&&e.changedTouches[0].clientX,i=e.clientY||e.changedTouches&&e.changedTouches[0].clientY;if(void 0===t||"undefined"===i)return;var n=Math.abs(t-this.onPointerDownPointerX),a=Math.abs(i-this.onPointerDownPointerY);n<.1&&a<.1&&(this.player().paused()?this.player().play():this.player().pause())}},handleMouseDown:function(e){e.preventDefault();var t=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;void 0!==t&&"undefined"!==i&&(this.mouseDown=!0,this.onPointerDownPointerX=t,this.onPointerDownPointerY=i,this.onPointerDownLon=this.lon,this.onPointerDownLat=this.lat)},handleMouseMove:function(e){var t,i,n=e.clientX||e.touches&&e.touches[0].clientX,a=e.clientY||e.touches&&e.touches[0].clientY;void 0!==n&&"undefined"!==a&&(this.settings.clickAndDrag?this.mouseDown&&(this.lon=.2*(this.onPointerDownPointerX-n)+this.onPointerDownLon,this.lat=.2*(a-this.onPointerDownPointerY)+this.onPointerDownLat):(t=e.pageX-this.el_.offsetLeft,i=e.pageY-this.el_.offsetTop,this.lon=t/this.width*430-225,this.lat=i/this.height*-180+90))},handleMobileOrientation:function(e){var t,i,n,a,r,o;void 0!==e.rotationRate&&(t=e.rotationRate.alpha,i=e.rotationRate.beta,n=void 0!==e.portrait?e.portrait:window.matchMedia("(orientation: portrait)").matches,a=void 0!==e.landscape?e.landscape:window.matchMedia("(orientation: landscape)").matches,r=e.orientation||window.orientation,n?(this.lon=this.lon-i*this.settings.mobileVibrationValue,this.lat=this.lat+t*this.settings.mobileVibrationValue):a&&(o=void 0!==r?r:-90,this.lon=-90==o?this.lon+t*this.settings.mobileVibrationValue:this.lon-t*this.settings.mobileVibrationValue,this.lat=-90==o?this.lat+i*this.settings.mobileVibrationValue:this.lat-i*this.settings.mobileVibrationValue))},handleMouseWheel:function(e){e.stopPropagation(),e.preventDefault()},handleMouseEnter:function(){this.isUserInteracting=!0},handleMouseLease:function(){this.isUserInteracting=!1},animate:function(){var e,t;this.requestAnimationId=requestAnimationFrame(this.animate.bind(this)),this.player().paused()||void 0!==this.texture&&(!this.isPlayOnMobile&&this.player().readyState()>=HAVE_CURRENT_DATA||this.isPlayOnMobile&&this.player().hasClass("vjs-playing"))&&(30<=(e=(new Date).getTime())-this.time&&(this.texture.needsUpdate=!0,this.time=e),this.isPlayOnMobile&&(t=this.player().currentTime(),MobileBuffering.isBuffering(t)?this.player().hasClass("vjs-panorama-mobile-inline-video-buffering")||this.player().addClass("vjs-panorama-mobile-inline-video-buffering"):this.player().hasClass("vjs-panorama-mobile-inline-video-buffering")&&this.player().removeClass("vjs-panorama-mobile-inline-video-buffering"))),this.render()},render:function(){var e,t;this.isUserInteracting||(e=this.lat>this.settings.initLat?-1:1,t=this.lon>this.settings.initLon?-1:1,this.settings.backToVerticalCenter&&(this.lat=this.lat>this.settings.initLat-Math.abs(this.settings.returnStepLat)&&this.lat<this.settings.initLat+Math.abs(this.settings.returnStepLat)?this.settings.initLat:this.lat+this.settings.returnStepLat*e),this.settings.backToHorizonCenter&&(this.lon=this.lon>this.settings.initLon-Math.abs(this.settings.returnStepLon)&&this.lon<this.settings.initLon+Math.abs(this.settings.returnStepLon)?this.settings.initLon:this.lon+this.settings.returnStepLon*t)),this.lat=Math.max(this.settings.minLat,Math.min(this.settings.maxLat,this.lat)),this.lon=Math.max(this.settings.minLon,Math.min(this.settings.maxLon,this.lon)),this.phi=r.Math.degToRad(90-this.lat),this.theta=r.Math.degToRad(this.lon),this.supportVideoTexture||this.helperCanvas.update(),this.renderer.clear()},playOnMobile:function(){this.isPlayOnMobile=!0,this.settings.autoMobileOrientation&&window.addEventListener("devicemotion",this.handleMobileOrientation.bind(this))},el:function(){return this.el_}}};function whichTransitionEvent(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}function mobileAndTabletcheck(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}function isIos(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function isRealIphone(){return/iPhone|iPod/i.test(navigator.platform)}function fovToNDCScaleOffset(e){var t=2/(e.leftTan+e.rightTan),i=(e.leftTan-e.rightTan)*t*.5,n=2/(e.upTan+e.downTan);return{scale:[t,n],offset:[i,(e.upTan-e.downTan)*n*.5]}}function fovPortToProjection(e,t,i,n){i=void 0===i?.01:i,n=void 0===n?1e4:n;var a=(t=void 0===t||t)?-1:1,r=new THREE.Matrix4,o=r.elements,s=fovToNDCScaleOffset(e);return o[0]=s.scale[0],o[1]=0,o[2]=s.offset[0]*a,o[3]=0,o[4]=0,o[5]=s.scale[1],o[6]=-s.offset[1]*a,o[7]=0,o[8]=0,o[9]=0,o[10]=n/(i-n)*-a,o[11]=n*i/(i-n),o[12]=0,o[13]=0,o[14]=a,o[15]=0,r.transpose(),r}function fovToProjection(e,t,i,n){var a=Math.PI/180;return fovPortToProjection({upTan:Math.tan(e.upDegrees*a),downTan:Math.tan(e.downDegrees*a),leftTan:Math.tan(e.leftDegrees*a),rightTan:Math.tan(e.rightDegrees*a)},t,i,n)}function extend(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=e[i]);return t}function deepCopy(e){var t={};for(var i in e)t[i]=e[i];return t}var util={whichTransitionEvent:whichTransitionEvent,mobileAndTabletcheck:mobileAndTabletcheck,isIos:isIos,isRealIphone:isRealIphone,fovToProjection:fovToProjection,extend:extend,deepCopy:deepCopy},Canvas=function(e,u,t){var p=BaseCanvas(e,u,2<arguments.length&&void 0!==t?t:{});return util.extend(p,{constructor:function(e,t){p.constructor.call(this,e,t),this.VRMode=!1,this.scene=new u.Scene,this.camera=new u.PerspectiveCamera(t.initFov,this.width/this.height,1,2e3),this.camera.target=new u.Vector3(0,0,0);var i="equirectangular"===this.videoType?new u.SphereGeometry(500,60,40):new u.SphereBufferGeometry(500,60,40).toNonIndexed();if("fisheye"===this.videoType){for(var n=i.attributes.normal.array,a=i.attributes.uv.array,r=0,o=n.length/3;r<o;r++){var s=n[3*r+0],h=n[3*r+1],l=n[3*r+2],c=Math.asin(Math.sqrt(s*s+l*l)/Math.sqrt(s*s+h*h+l*l))/Math.PI;h<0&&(c=1-c);var d=0==s&&0==l?0:Math.acos(s/Math.sqrt(s*s+l*l));l<0&&(d*=-1),a[2*r+0]=-.8*c*Math.cos(d)+.5,a[2*r+1]=.8*c*Math.sin(d)+.5}i.rotateX(t.rotateX),i.rotateY(t.rotateY),i.rotateZ(t.rotateZ)}i.scale(-1,1,1),this.mesh=new u.Mesh(i,new u.MeshBasicMaterial({map:this.texture})),this.scene.add(this.mesh)},enableVR:function(){var e,t;this.VRMode=!0,"undefined"!=typeof vrHMD&&(e=vrHMD.getEyeParameters("left"),t=vrHMD.getEyeParameters("right"),this.eyeFOVL=e.recommendedFieldOfView,this.eyeFOVR=t.recommendedFieldOfView),this.cameraL=new u.PerspectiveCamera(this.camera.fov,this.width/2/this.height,1,2e3),this.cameraR=new u.PerspectiveCamera(this.camera.fov,this.width/2/this.height,1,2e3)},disableVR:function(){this.VRMode=!1,this.renderer.setViewport(0,0,this.width,this.height),this.renderer.setScissor(0,0,this.width,this.height)},handleResize:function(){p.handleResize.call(this),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.VRMode&&(this.cameraL.aspect=this.camera.aspect/2,this.cameraR.aspect=this.camera.aspect/2,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix())},handleMouseWheel:function(e){p.handleMouseWheel(e),e.wheelDeltaY?this.camera.fov-=.05*e.wheelDeltaY:e.wheelDelta?this.camera.fov-=.05*e.wheelDelta:e.detail&&(this.camera.fov+=+e.detail),this.camera.fov=Math.min(this.settings.maxFov,this.camera.fov),this.camera.fov=Math.max(this.settings.minFov,this.camera.fov),this.camera.updateProjectionMatrix(),this.VRMode&&(this.cameraL.fov=this.camera.fov,this.cameraR.fov=this.camera.fov,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix())},render:function(){var e,t,i,n,a,r,o,s;p.render.call(this),this.camera.target.x=500*Math.sin(this.phi)*Math.cos(this.theta),this.camera.target.y=500*Math.cos(this.phi),this.camera.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.camera.lookAt(this.camera.target),this.VRMode?(e=this.width/2,t=this.height,"undefined"!=typeof vrHMD?(this.cameraL.projectionMatrix=util.fovToProjection(this.eyeFOVL,!0,this.camera.near,this.camera.far),this.cameraR.projectionMatrix=util.fovToProjection(this.eyeFOVR,!0,this.camera.near,this.camera.far)):(i=this.lon+this.settings.VRGapDegree,n=this.lon-this.settings.VRGapDegree,a=u.Math.degToRad(i),r=u.Math.degToRad(n),(o=util.deepCopy(this.camera.target)).x=500*Math.sin(this.phi)*Math.cos(a),o.z=500*Math.sin(this.phi)*Math.sin(a),this.cameraL.lookAt(o),(s=util.deepCopy(this.camera.target)).x=500*Math.sin(this.phi)*Math.cos(r),s.z=500*Math.sin(this.phi)*Math.sin(r),this.cameraR.lookAt(s)),this.renderer.setViewport(0,0,e,t),this.renderer.setScissor(0,0,e,t),this.renderer.render(this.scene,this.cameraL),this.renderer.setViewport(e,0,e,t),this.renderer.setScissor(e,0,e,t),this.renderer.render(this.scene,this.cameraR)):this.renderer.render(this.scene,this.camera)}})},ThreeDCanvas=function(e,c,t){var d=BaseCanvas(e,c,2<arguments.length&&void 0!==t?t:{});return util.extend(d,{constructor:function(e,t){d.constructor.call(this,e,t),this.scene=new c.Scene;var i=this.width/this.height/2;this.cameraL=new c.PerspectiveCamera(t.initFov,i,1,2e3),this.cameraL.target=new c.Vector3(0,0,0),this.cameraR=new c.PerspectiveCamera(t.initFov,i,1,2e3),this.cameraR.position.set(1e3,0,0),this.cameraR.target=new c.Vector3(1e3,0,0);for(var n=new c.SphereBufferGeometry(500,60,40).toNonIndexed(),a=new c.SphereBufferGeometry(500,60,40).toNonIndexed(),r=n.attributes.uv.array,o=n.attributes.normal.array,s=0;s<o.length/3;s++)r[2*s+1]=r[2*s+1]/2;for(var h=a.attributes.uv.array,l=a.attributes.normal.array,s=0;s<l.length/3;s++)h[2*s+1]=h[2*s+1]/2+.5;n.scale(-1,1,1),a.scale(-1,1,1),this.meshL=new c.Mesh(n,new c.MeshBasicMaterial({map:this.texture})),this.meshR=new c.Mesh(a,new c.MeshBasicMaterial({map:this.texture})),this.meshR.position.set(1e3,0,0),this.scene.add(this.meshL),this.scene.add(this.meshR),t.callback&&t.callback()},handleResize:function(){d.handleResize.call(this);var e=this.width/this.height/2;this.cameraL.aspect=e,this.cameraR.aspect=e,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix()},handleMouseWheel:function(e){d.handleMouseWheel(e),e.wheelDeltaY?this.cameraL.fov-=.05*e.wheelDeltaY:e.wheelDelta?this.cameraL.fov-=.05*e.wheelDelta:e.detail&&(this.cameraL.fov+=+e.detail),this.cameraL.fov=Math.min(this.settings.maxFov,this.cameraL.fov),this.cameraL.fov=Math.max(this.settings.minFov,this.cameraL.fov),this.cameraR.fov=this.cameraL.fov,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix()},render:function(){d.render.call(this);var e=this.width/2,t=this.height;this.cameraL.target.x=500*Math.sin(this.phi)*Math.cos(this.theta),this.cameraL.target.y=500*Math.cos(this.phi),this.cameraL.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.cameraL.lookAt(this.cameraL.target),this.cameraR.target.x=1e3+500*Math.sin(this.phi)*Math.cos(this.theta),this.cameraR.target.y=500*Math.cos(this.phi),this.cameraR.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.cameraR.lookAt(this.cameraR.target),this.renderer.setViewport(0,0,e,t),this.renderer.setScissor(0,0,e,t),this.renderer.render(this.scene,this.cameraL),this.renderer.setViewport(e,0,e,t),this.renderer.setScissor(e,0,e,t),this.renderer.render(this.scene,this.cameraR)}})},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},get=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},set=function e(t,i,n,a){var r,o,s=Object.getOwnPropertyDescriptor(t,i);return void 0===s?null!==(r=Object.getPrototypeOf(t))&&e(r,i,n,a):"value"in s&&s.writable?s.value=n:void 0!==(o=s.set)&&o.call(a,n),n},Notice=function(i){var n=document.createElement("div");return n.className="vjs-video-notice-label",{constructor:function(e,t){"object"==_typeof(t.NoticeMessage)?(n=t.NoticeMessage,t.el=t.NoticeMessage):"string"==typeof t.NoticeMessage&&(n.innerHTML=t.NoticeMessage,t.el=n),i.call(this,e,t)},el:function(){return n}}},element=document.createElement("canvas");element.className="vjs-video-helper-canvas";var HelperCanvas=function(i){return{constructor:function(e,t){this.videoElement=t.video,this.width=t.width,this.height=t.height,element.width=this.width,element.height=this.height,element.style.display="none",t.el=element,this.context=element.getContext("2d"),this.context.drawImage(this.videoElement,0,0,this.width,this.height),i.call(this,e,t)},getContext:function(){return this.context},update:function(){this.context.drawImage(this.videoElement,0,0,this.width,this.height)},el:function(){return element}}},VRButton=function(i){return{constructor:function(e,t){i.call(this,e,t)},buildCSSClass:function(){return"vjs-VR-control "+i.prototype.buildCSSClass.call(this)},handleClick:function(){var e=this.player().getChild("Canvas");e.VRMode?e.disableVR():e.enableVR(),e.VRMode?this.addClass("enable"):this.removeClass("enable"),e.VRMode?this.player().trigger("VRModeOn"):this.player().trigger("VRModeOff")},controlText_:"VR"}},index$1="undefined"==typeof Symbol?function(e){return"@"+(e||"@")+Math.random()}:Symbol;function intervalometer(t,i,e,n){var a,r;function o(e){a=i(o,n),t(e-(r||e)),r=e}return{start:function(){a||o(0)},stop:function(){e(a),a=null,r=0}}}function frameIntervalometer(e){return intervalometer(e,requestAnimationFrame,cancelAnimationFrame)}function preventEvent(t,e,i,n){function a(e){Boolean(t[i])===Boolean(n)&&e.stopImmediatePropagation(),delete t[i]}return t.addEventListener(e,a,!1),a}function proxyProperty(e,t,i,n){function a(e){i[t]=e}n&&a(e[t]),Object.defineProperty(e,t,{get:function(){return i[t]},set:a})}function proxyEvent(e,t,i){i.addEventListener(t,function(){return e.dispatchEvent(new Event(t))})}function dispatchEventAsync(e,t){Promise.resolve().then(function(){e.dispatchEvent(new Event(t))})}var isWhitelisted=/iPhone|iPod/i.test(navigator.userAgent)&&!matchMedia("(-webkit-video-playable-inline)").matches,ಠ=index$1(),ಠevent=index$1(),ಠplay=index$1("nativeplay"),ಠpause=index$1("nativepause");function getAudioFromVideo(e){var t=new Audio;return proxyEvent(e,"play",t),proxyEvent(e,"playing",t),proxyEvent(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}var lastTimeupdateEvent,lastRequests=[],requestIndex=0;function setTime(e,t,i){(lastTimeupdateEvent||0)+200<Date.now()&&(e[ಠevent]=!0,lastTimeupdateEvent=Date.now()),i||(e.currentTime=t),lastRequests[++requestIndex%3]=100*t|0}function isPlayerEnded(e){return e.driver.currentTime>=e.video.duration}function update$1(e){var t=this;t.video.readyState>=t.video.HAVE_FUTURE_DATA?(t.hasAudio||(t.driver.currentTime=t.video.currentTime+e*t.video.playbackRate/1e3,t.video.loop&&isPlayerEnded(t)&&(t.driver.currentTime=0)),setTime(t.video,t.driver.currentTime)):t.video.networkState!==t.video.NETWORK_IDLE||t.video.buffered.length||t.video.load(),t.video.ended&&(delete t.video[ಠevent],t.video.pause(!0))}function play(){var e=this,t=e[ಠ];e.webkitDisplayingFullscreen?e[ಠplay]():("data:"!==t.driver.src&&t.driver.src!==e.src&&(setTime(e,0,!0),t.driver.src=e.src),e.paused&&(t.paused=!1,e.buffered.length||e.load(),t.driver.play(),t.updater.start(),t.hasAudio||(dispatchEventAsync(e,"play"),t.video.readyState>=t.video.HAVE_ENOUGH_DATA&&dispatchEventAsync(e,"playing"))))}function pause(e){var t=this,i=t[ಠ];i.driver.pause(),i.updater.stop(),t.webkitDisplayingFullscreen&&t[ಠpause](),i.paused&&!e||(i.paused=!0,i.hasAudio||dispatchEventAsync(t,"pause"),t.ended&&(t[ಠevent]=!0,dispatchEventAsync(t,"ended")))}function addPlayer(t,e){var i=t[ಠ]={};i.paused=!0,i.hasAudio=e,i.video=t,i.updater=frameIntervalometer(update$1.bind(i)),e?i.driver=getAudioFromVideo(t):(t.addEventListener("canplay",function(){t.paused||dispatchEventAsync(t,"playing")}),i.driver={src:t.src||t.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,isPlayerEnded(i)&&setTime(t,0)},get ended(){return isPlayerEnded(i)}}),t.addEventListener("emptied",function(){var e=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==t.src&&(setTime(t,0,!0),i.driver.src=t.src,e?i.driver.play():i.updater.stop())},!1),t.addEventListener("webkitbeginfullscreen",function(){t.paused?e&&!i.driver.buffered.length&&i.driver.load():(t.pause(),t[ಠplay]())}),e&&(t.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=t.currentTime}),t.addEventListener("seeking",function(){lastRequests.indexOf(100*t.currentTime|0)<0&&(i.driver.currentTime=t.currentTime)}))}function overloadAPI(e){var t=e[ಠ];e[ಠplay]=e.play,e[ಠpause]=e.pause,e.play=play,e.pause=pause,proxyProperty(e,"paused",t.driver),proxyProperty(e,"muted",t.driver,!0),proxyProperty(e,"playbackRate",t.driver,!0),proxyProperty(e,"ended",t.driver),proxyProperty(e,"loop",t.driver,!0),preventEvent(e,"seeking"),preventEvent(e,"seeked"),preventEvent(e,"timeupdate",ಠevent,!1),preventEvent(e,"ended",ಠevent,!1)}function enableInlineVideo(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0),i&&!isWhitelisted||e[ಠ]||(addPlayer(e,t),overloadAPI(e),e.classList.add("IIV"),!t&&e.autoplay&&e.play(),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}enableInlineVideo.isWhitelisted=isWhitelisted;var runOnMobile=util.mobileAndTabletcheck(),defaults$1={clickAndDrag:runOnMobile,showNotice:!0,NoticeMessage:"Please use your mouse drag and drop the video.",autoHideNotice:3e3,scrollable:!0,initFov:75,maxFov:105,minFov:51,initLat:0,initLon:-180,returnStepLat:.5,returnStepLon:2,backToVerticalCenter:!runOnMobile,backToHorizonCenter:!runOnMobile,clickToToggle:!1,minLat:-85,maxLat:85,minLon:-1/0,maxLon:1/0,videoType:"equirectangular",rotateX:0,rotateY:0,rotateZ:0,autoMobileOrientation:!1,mobileVibrationValue:util.isIos()?.022:1,VREnable:!0,VRGapDegree:2.5,closePanorama:!1};function playerResize(e){var t=e.getChild("Canvas");return function(){e.el().style.width=window.innerWidth+"px",e.el().style.height=window.innerHeight+"px",t.handleResize()}}function fullscreenOnIOS(t,e){var i=playerResize(t);t.controlBar.fullscreenToggle.off("tap",e),t.controlBar.fullscreenToggle.on("tap",function(){var e=t.getChild("Canvas");t.isFullscreen()?(t.isFullscreen(!1),t.exitFullWindow(),t.el().style.width="",t.el().style.height="",e.handleResize(),window.removeEventListener("devicemotion",i)):(t.isFullscreen(!0),t.enterFullWindow(),i(),window.addEventListener("devicemotion",i))})}var onPlayerReady=function(e,t,i){if(e.addClass("vjs-panorama"),!Detector.webgl)return PopupNotification(e,{NoticeMessage:Detector.getWebGLErrorMessage(),autoHideNotice:t.autoHideNotice}),void(t.callback&&t.callback());e.addChild("Canvas",util.deepCopy(t));var n,a=e.getChild("Canvas");runOnMobile&&(n=i.getTech(e),util.isRealIphone()&&(n.setAttribute("playsinline",""),enableInlineVideo(n,!0)),util.isIos()&&fullscreenOnIOS(e,i.getFullscreenToggleClickFn(e)),e.addClass("vjs-panorama-mobile-inline-video"),e.removeClass("vjs-using-native-controls"),a.playOnMobile()),t.showNotice&&e.on("playing",function(){PopupNotification(e,util.deepCopy(t))}),t.VREnable&&"3dVideo"!==t.videoType&&e.controlBar.addChild("VRButton",{},e.controlBar.children().length-1),a.hide(),e.on("play",function(){a.show()}),e.on("fullscreenchange",function(){a.handleResize()}),t.callback&&t.callback()},PopupNotification=function(e,t){var i=1<arguments.length&&void 0!==t?t:{NoticeMessage:""},n=e.addChild("Notice",i);0<i.autoHideNotice&&setTimeout(function(){n.addClass("vjs-video-notice-fadeOut");var t=util.whichTransitionEvent();n.on(t,function e(){n.hide(),n.removeClass("vjs-video-notice-fadeOut"),n.off(t,e)})},i.autoHideNotice)},plugin$1=function(e){function t(e){var t=this;i.mergeOption&&(e=i.mergeOption(defaults$1,e)),void 0!==i._init&&"function"==typeof i._init?(-1==n.indexOf(e.videoType)&&(e.videoType=defaults$1.videoType),i._init(e),this.ready(function(){onPlayerReady(t,e,i)})):console.error("plugin must implement init function().")}var i=0<arguments.length&&void 0!==e?e:{},n=["equirectangular","fisheye","3dVideo"];return t.VERSION="0.1.3",t};function getTech(e){return e.tech({IWillNotUseThisInPlugins:!0}).el()}function getFullscreenToggleClickFn(e){return e.controlBar.fullscreenToggle.handleClick}var component=videojs.getComponent("Component"),notice=Notice(component);videojs.registerComponent("Notice",videojs.extend(component,notice));var helperCanvas=HelperCanvas(component);videojs.registerComponent("HelperCanvas",videojs.extend(component,helperCanvas));var button=videojs.getComponent("Button"),vrBtn=VRButton(button);videojs.registerComponent("VRButton",videojs.extend(button,vrBtn)),videojs.plugin("panorama",plugin$1({_init:function(e){var t=("3dVideo"!==e.videoType?Canvas:ThreeDCanvas)(component,THREE$1,{getTech:getTech});videojs.registerComponent("Canvas",videojs.extend(component,t))},mergeOption:function(e,t){return videojs.mergeOptions(e,t)},getTech:getTech,getFullscreenToggleClickFn:getFullscreenToggleClickFn}));var plugin_es6=function(e,t){return e.panorama(t)};module.exports=plugin_es6;