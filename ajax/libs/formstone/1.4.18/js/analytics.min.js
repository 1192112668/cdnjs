!function(e){"function"==typeof define&&define.amd?define(["jquery","./core","./mediaquery"],e):e(jQuery,Formstone)}(function(c,o){"use strict";function t(){d.scrollDepth&&l()}function n(){var e,t=c(this),n="undefined"!==c.type(t[0].href)?t[0].href:"",a=document.domain.split(".").reverse(),i=null!==n.match(a[1]+"."+a[0]);n.match(/^mailto\:/i)?e="Email, Click, "+n.replace(/^mailto\:/i,""):n.match(/^tel\:/i)?e="Telephone, Click, "+n.replace(/^tel\:/i,""):n.match(d.fileTypes)?e="File, Download:"+(/[.]/.exec(n)?/[^.]+$/.exec(n):void 0)[0]+", "+n.replace(/ /g,"-"):i||(e="ExternalLink, Click, "+n),e&&t.attr(w,e)}function a(e){v.startTimer(T,250,i)}function i(){for(var e=u.scrollTop()+o.windowHeight,t=1/d.scrollStops,n=t,a=1;a<=d.scrollStops;a++){var i=Math.round(100*n).toString();!x[k][i].passed&&e>x[k][i].edge&&(x[k][i].passed=!0,s(c.extend(d.scrollFields,{eventCategory:"ScrollDepth",eventAction:k,eventLabel:i,nonInteraction:!0}))),n+=t}}function l(){var e,t=c.mediaquery("state"),n=h.outerHeight(),a={},i=1/d.scrollStops,o=i,l=0;t.minWidth&&(k="MinWidth:"+t.minWidth+"px");for(var r=1;r<=d.scrollStops;r++)l=parseInt(n*o),a[e=Math.round(100*o).toString()]={edge:"100"===e?l-10:l,passsed:!(!x[k]||!x[k][e])&&x[k][e].passed},o+=i;x[k]=a}function r(e){var t=c(this),n=t.attr("href"),a=t.data(g).split(",");for(var i in d.eventCallback&&e.preventDefault(),a)a.hasOwnProperty(i)&&(a[i]=c.trim(a[i]));s({eventCategory:a[0],eventAction:a[1],eventLabel:a[2]||n,eventValue:a[3],nonInteraction:a[4]},t)}function s(e,t){f.location;var n,a,i,o,l=c.extend({hitType:"event"},e);"undefined"===c.type(t)||t.attr("data-analytics-stop")||(n="undefined"!==c.type(t[0].href)?t[0].href:"",""!==(a=!n.match(/^mailto\:/i)&&!n.match(/^tel\:/i)&&n.indexOf(":")<0?f.location.protocol+"//"+f.location.hostname+"/"+n:n)&&((i=t.attr("target"))?f.open(a,i):d.eventCallback&&(l[o="hitCallback"]=function(){var e;b&&(v.clearTimer(b),e=a,document.location=e)},b=v.startTimer(b,d.eventTimeout,l[o])))),p(l)}function p(e){if("function"===c.type(f.ga)&&"function"===c.type(f.ga.getAll))for(var t=f.ga.getAll(),n=0,a=t.length;n<a;n++)f.ga(t[n].get("name")+".send",e)}var e=o.Plugin("analytics",{methods:{_resize:t},utilities:{_delegate:function(){if(arguments.length&&"object"!==c.type(arguments[0]))if("destroy"===arguments[0])(function(){y&&h&&h.length&&(u.off(m.namespace),h.off(m.namespace),y=!1)}).apply(this);else{var e=Array.prototype.slice.call(arguments,1);switch(arguments[0]){case"pageview":(function(e){p(c.extend({hitType:"pageview"},e))}).apply(this,e);break;case"event":s.apply(this,e)}}else(function(e){!y&&h&&h.length&&(y=!0,(d=c.extend(d,e||{})).autoEvents&&h.find("a").not("["+w+"]").each(n),d.scrollDepth&&(l(),u.on(m.scroll,a).one(m.load,t)),h.on(m.click,"*["+w+"]",r))}).apply(this,arguments);return null}}}),d={autoEvents:!1,fileTypes:/\.(zip|exe|dmg|pdf|doc.*|xls.*|ppt.*|mp3|txt|rar|wma|mov|avi|wmv|flv|wav)$/i,eventCallback:!1,eventTimeout:1e3,scrollDepth:!1,scrollStops:5,scrollFields:{}},f=o.window,u=o.$window,h=null,v=e.functions,m=e.events,y=!1,g="analytics-event",w="data-"+g,x={},T=null,k="Site",b=null;o.Ready(function(){h=o.$body})});