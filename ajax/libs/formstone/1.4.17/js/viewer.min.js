!function(t){"function"==typeof define&&define.amd?define(["jquery","./core","./transition"],t):t(jQuery,Formstone)}(function(s,n){"use strict";function t(){j.scrollTop(),n.windowHeight}function l(){(Z=s(z.base)).length?b.lockViewport(x):b.unlockViewport(x)}function m(r,t){r.isAnimating||(r.isAnimating=!0,r.$container=s('<div class="'+I.container+'"><img></div>'),r.$image=r.$container.find("img"),r.$viewport.append(r.$container),r.$image.one(y.load,function(){var t,e,i,o,n,a;o=(i=t=r).$image[0],n=new Image,a=void 0!==o.naturalHeight?{naturalHeight:o.naturalHeight,naturalWidth:o.naturalWidth}:"img"===o.tagName.toLowerCase()&&(n.src=o.src,{naturalHeight:n.height,naturalWidth:n.width}),i.naturalHeight=a.naturalHeight,i.naturalWidth=a.naturalWidth,i.ratioHorizontal=i.naturalHeight/i.naturalWidth,i.ratioVertical=i.naturalWidth/i.naturalHeight,i.isWide=i.naturalWidth>i.naturalHeight,g(t),t.containerTop=t.viewportHeight/2,t.containerLeft=t.viewportWidth/2,d(t),t.imageHeight=t.naturalHeight,t.imageWidth=t.naturalWidth,(e=t).imageHeight=e.imageMinHeight,e.imageWidth=e.imageMinWidth,c(t),h(t),u(t),f(t),p(t,{containerTop:t.containerTop,containerLeft:t.containerLeft,imageHeight:t.imageHeight,imageWidth:t.imageWidth,imageTop:t.imageTop,imageLeft:t.imageLeft}),t.isRendering=!0,r.isAnimating=!1,r.$container.fsTransition({property:"opacity"},function(){}),r.$el.removeClass(I.loading),r.$container.fsTouch({pan:!0,scale:!0}).on(y.scaleStart,r,H).on(y.scaleEnd,r,v).on(y.scale,r,W),r.$el.trigger(y.loaded)}).one(y.error,r,e).attr("src",t).addClass(I.image),!r.$image[0].complete&&4!==r.$image[0].readyState||r.$image.trigger(y.load),r.source=t)}function e(t){t.data.$el.trigger(y.error)}function g(t){t.viewportHeight=t.$viewport.outerHeight(),t.viewportWidth=t.$viewport.outerWidth()}function c(t){t.imageHeight<=t.viewportHeight?(t.containerMinTop=t.viewportHeight/2,t.containerMaxTop=t.viewportHeight/2):(t.containerMinTop=t.viewportHeight-t.imageHeight/2,t.containerMaxTop=t.imageHeight/2),t.imageWidth<=t.viewportWidth?(t.containerMinLeft=t.viewportWidth/2,t.containerMaxLeft=t.viewportWidth/2):(t.containerMinLeft=t.viewportWidth-t.imageWidth/2,t.containerMaxLeft=t.imageWidth/2)}function d(t){t.isWide?(t.imageMinWidth=t.viewportWidth,t.imageMinHeight=t.imageMinWidth*t.ratioHorizontal,t.imageMinHeight>t.viewportHeight&&(t.imageMinHeight=t.viewportHeight,t.imageMinWidth=t.imageMinHeight*t.ratioVertical)):(t.imageMinHeight=t.viewportHeight,t.imageMinWidth=t.imageMinHeight*t.ratioVertical,t.imageMinWidth>t.viewportWidth&&(t.imageMinWidth=t.viewportWidth,t.imageMinHeight=t.imageMinWidth*t.ratioHorizontal)),(t.imageMinWidth>t.naturalWidth||t.imageMinHeight>t.naturalHeight)&&(t.imageMinHeight=t.naturalHeight,t.imageMinWidth=t.naturalWidth),t.imageMaxHeight=t.naturalHeight,t.imageMaxWidth=t.naturalWidth}function h(t){t.imageTop=-t.imageHeight/2,t.imageLeft=-t.imageWidth/2}function u(t){t.lastContainerTop=t.containerTop,t.lastContainerLeft=t.containerLeft,t.lastImageHeight=t.imageHeight,t.lastImageWidth=t.imageWidth,t.lastImageTop=t.imageTop,t.lastImageLeft=t.imageLeft}function f(t){t.renderContainerTop=t.lastContainerTop,t.renderContainerLeft=t.lastContainerLeft,t.renderImageTop=t.lastImageTop,t.renderImageLeft=t.lastImageLeft,t.renderImageHeight=t.lastImageHeight,t.renderImageWidth=t.lastImageWidth}function i(t){t.imageHeight<t.imageMinHeight&&(t.imageHeight=t.imageMinHeight),t.imageHeight>t.imageMaxHeight&&(t.imageHeight=t.imageMaxHeight),t.imageWidth<t.imageMinWidth&&(t.imageWidth=t.imageMinWidth),t.imageWidth>t.imageMaxWidth&&(t.imageWidth=t.imageMaxWidth)}function a(t){t.containerTop<t.containerMinTop&&(t.containerTop=t.containerMinTop),t.containerTop>t.containerMaxTop&&(t.containerTop=t.containerMaxTop),t.containerLeft<t.containerMinLeft&&(t.containerLeft=t.containerMinLeft),t.containerLeft>t.containerMaxLeft&&(t.containerLeft=t.containerMaxLeft)}function r(t){b.clearTimer(t.tapTimer),t.tapTimer=null}function p(t,e){var i,o;n.transform?(i=e.imageWidth/t.naturalWidth,o=e.imageHeight/t.naturalHeight,t.$container.css(n.transform,"translate3d("+e.containerLeft+"px, "+e.containerTop+"px, 0)"),t.$image.css(n.transform,"translate3d(-50%, -50%, 0) scale("+i+","+o+")")):(t.$container.css({top:e.containerTop,left:e.containerLeft}),t.$image.css({height:e.imageHeight,width:e.imageWidth,top:e.imageTop,left:e.imageLeft}))}function H(t){var e,i,o,n=t.data;null===(e=n).tapTimer?e.tapTimer=b.startTimer(e.tapTimer,500,function(){r(e)}):(r(e),o=(i=e).imageHeight>i.imageMinHeight+1,i.isZooming=!0,u(i),f(i),o?(i.imageHeight=i.imageMinHeight,i.imageWidth=i.imageMinWidth):(i.imageHeight=i.imageMaxHeight,i.imageWidth=i.imageMaxWidth),c(i),a(i),h(i),i.isRendering=!0),u(n)}function W(t){var e=t.data;r(e),e.isRendering=!1,e.isZooming=!1,e.imageHeight,e.imageMinHeight,e.containerTop=e.lastContainerTop+t.deltaY,e.containerLeft=e.lastContainerLeft+t.deltaX,e.imageHeight=e.lastImageHeight*t.scale,e.imageWidth=e.lastImageWidth*t.scale,c(e),a(e),i(e),h(e),p(e,{containerTop:e.containerTop,containerLeft:e.containerLeft,imageHeight:e.imageHeight,imageWidth:e.imageWidth,imageTop:e.imageTop,imageLeft:e.imageLeft})}function v(t){var e=t.data;e.isZooming||(u(e),f(e),e.isRendering=!0)}function T(t){b.killEvent(t);var e,i,o=s(t.currentTarget),n=t.data;"out"==(o.hasClass(I.control_zoom_out)?"out":"in")?((i=n).keyDownTime=1,i.action="zoom_out"):((e=n).keyDownTime=1,e.action="zoom_in")}function $(t){t.data.action=!1}function o(t){var e;t.isRendering&&(t.action&&(t.keyDownTime+=t.zoomIncrement,(e=("zoom_out"===t.action?-1:1)*Math.round(t.imageWidth*t.keyDownTime-t.imageWidth))>t.zoomDelta&&(e=t.zoomDelta),t.isWide?(t.imageWidth+=e,t.imageHeight=Math.round(t.imageWidth/t.ratioVertical)):(t.imageHeight+=e,t.imageWidth=Math.round(t.imageHeight/t.ratioHorizontal)),i(t),h(t),c(t),a(t)),t.renderContainerTop+=Math.round((t.containerTop-t.renderContainerTop)*t.zoomEnertia),t.renderContainerLeft+=Math.round((t.containerLeft-t.renderContainerLeft)*t.zoomEnertia),t.renderImageTop+=Math.round((t.imageTop-t.renderImageTop)*t.zoomEnertia),t.renderImageLeft+=Math.round((t.imageLeft-t.renderImageLeft)*t.zoomEnertia),t.renderImageHeight+=Math.round((t.imageHeight-t.renderImageHeight)*t.zoomEnertia),t.renderImageWidth+=Math.round((t.imageWidth-t.renderImageWidth)*t.zoomEnertia),p(t,{containerTop:t.renderContainerTop,containerLeft:t.renderContainerLeft,imageHeight:t.renderImageHeight,imageWidth:t.renderImageWidth,imageTop:t.renderImageTop,imageLeft:t.renderImageLeft}))}function M(t,e){t.isAnimating||(r(t),t.isAnimating=!0,t.isRendering=!1,t.isZooming=!1,t.$container&&t.$container.length&&t.$container.fsTouch("destroy").off(y.scaleStart,H).off(y.scaleEnd,v).off(y.scale,W),t.$container.fsTransition({property:"opacity"},function(){t.isAnimating=!1,t.$container.remove(),"function"==typeof e&&e.call(window,t)}),t.$el.addClass(I.loading))}function w(t){b.killEvent(t);var e=s(t.currentTarget),i=t.data,o=i.index+(e.hasClass(I.control_next)?1:-1);i.isAnimating||(o<0&&(o=0),o>i.total&&(o=i.total),o!==i.index&&(i.index=o,M(i,function(){m(i,i.images[i.index])})),_(i))}function _(t){t.$controlItems.removeClass(I.control_disabled),0===t.index&&t.$controlPrevious.addClass(I.control_disabled),t.index===t.images.length-1&&t.$controlNext.addClass(I.control_disabled)}function C(t){g(t),c(t),d(t),h(t),c(t),a(t),i(t)}var L=n.Plugin("viewer",{widget:!0,defaults:{controls:!0,customClass:"",labels:{count:"of",next:"Next",previous:"Previous",zoom_in:"Zoom In",zoom_out:"Zoom Out"},theme:"fs-light",zoomDelta:100,zoomEnertia:.2,zoomIncrement:.01},classes:["source","wrapper","viewport","container","image","gallery","loading_icon","controls","controls_custom","control","control_previous","control_next","control_zoom_in","control_zoom_out","control_disabled","loading"],events:{loaded:"loaded",ready:"ready"},methods:{_construct:function(t){var e,i="",o=[I.control,I.control_previous].join(" "),n=[I.control,I.control_next].join(" "),a=[I.control,I.control_zoom_in].join(" "),r=[I.control,I.control_zoom_out].join(" ");t.thisClasses=[I.base,I.loading,t.customClass,t.theme],t.images=[],t.source=!1,t.gallery=!1,t.tapTimer=null,t.action=!1,t.isRendering=!1,t.isZooming=!1,t.isAnimating=!1,t.keyDownTime=1,t.$images=this.find("img").addClass(I.source),t.index=0,t.total=t.$images.length-1,t.customControls="object"===s.type(t.controls)&&t.controls.zoom_in&&t.controls.zoom_out,1<t.$images.length&&(t.gallery=!0,t.thisClasses.push(I.gallery),!t.customControls||t.controls.previous&&t.controls.next||(t.customControls=!1));for(var g=0;g<t.$images.length;g++)e=t.$images.eq(g),t.images.push(e.attr("src"));i+='<div class="'+I.wrapper+'">',i+='<div class="'+I.loading_icon+'"></div>',i+='<div class="'+I.viewport+'"></div>',i+="</div>",t.controls&&!t.customControls&&(i+='<div class="'+I.controls+'">',i+='<button type="button" class="'+o+'">'+t.labels.previous+"</button>",i+='<button type="button" class="'+r+'">'+t.labels.zoom_out+"</button>",i+='<button type="button" class="'+a+'">'+t.labels.zoom_in+"</button>",i+='<button type="button" class="'+n+'">'+t.labels.next+"</button>",i+="</div>"),this.addClass(t.thisClasses.join(" ")).prepend(i),t.$wrapper=this.find(z.wrapper),t.$viewport=this.find(z.viewport),t.customControls?(t.$controls=s(t.controls.container).addClass([I.controls,I.controls_custom].join(" ")),t.$controlPrevious=s(t.controls.previous).addClass(o),t.$controlNext=s(t.controls.next).addClass(n),t.$controlZoomIn=s(t.controls.zoom_in).addClass(a),t.$controlZoomOut=s(t.controls.zoom_out).addClass(r)):(t.$controls=this.find(z.controls),t.$controlPrevious=this.find(z.control_previous),t.$controlNext=this.find(z.control_next),t.$controlZoomIn=this.find(z.control_zoom_in),t.$controlZoomOut=this.find(z.control_zoom_out)),t.$controlItems=t.$controlPrevious.add(t.$controlNext),t.$controlZooms=t.$controlZoomIn.add(t.$controlZoomOut),l(),t.$controlItems.on(y.click,t,w),t.$controlZooms.on([y.touchStart,y.mouseDown].join(" "),t,T).on([y.touchEnd,y.mouseUp].join(" "),t,$),m(t,t.images[t.index]),_(t)},_destruct:function(t){t.$wrapper.remove(),t.$image.removeClass(I.source),t.controls&&!t.customControls&&t.$controls.remove(),t.customControls&&(t.$controls.removeClass([I.controls,I.controls_custom].join(" ")),t.$controlItems.off(y.click).removeClass([I.control,I.control_previous,I.control_next].join(" ")),t.$controlZooms.off([y.touchStart,y.mouseDown].join(" ")).off([y.touchStart,y.mouseDown].join(" ")).off([y.touchEnd,y.mouseUp].join(" ")).removeClass([I.control,I.control_zoom_in,I.control_zoom_out].join(" "))),this.removeClass(t.thisClasses.join(" ")).off(y.namespace),l()},_resize:function(){b.iterate.call(Z,C)},_raf:function(){b.iterate.call(Z,o)},resize:C,load:function(t,e){t.index=0,"string"==typeof e?(t.total=0,t.images=[e],t.gallery=!1,t.$el.removeClass(I.gallery)):(t.total=e.length-1,1<(t.images=e).length&&(t.gallery=!0,t.$el.addClass(I.gallery)),e=t.images[t.index]),M(t,function(){m(t,e)})},unload:function(t){M(t)}}}),x=L.namespace,z=L.classes,I=z.raw,y=L.events,b=L.functions,j=(n.window,n.$window),Z=[];n.Ready(function(){t(),j.on("scroll",t),n.$body})});