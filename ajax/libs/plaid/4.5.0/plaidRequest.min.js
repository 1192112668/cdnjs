"use strict";var R=require("ramda"),request=require("request"),pjson=require("../package.json"),PlaidError=require("./PlaidError"),wrapPromise=require("./wrapPromise"),DEFAULT_TIMEOUT_IN_MILLIS=6e5,handleApiResponse=function(e,r,s,n,t,i){return null!=n&&"Object"===R.type(t)&&(t.status_code=n.statusCode),null!=s?r(s):i&&200===n.statusCode?e([null,t]):i&&210===n.statusCode?e([t,null]):200===n.statusCode?null!=n.headers["plaid-request-id"]&&null!=n.headers["content-type"]&&0===n.headers["content-type"].indexOf("application")?e({request_id:n.headers["plaid-request-id"],buffer:t}):e(t):"Object"===R.type(t)?r(new PlaidError(t)):r(new PlaidError({error_type:"API_ERROR",status_code:n.statusCode,error_code:"INTERNAL_SERVER_ERROR",error_message:String(t),display_message:null,request_id:null}))},plaidRequest=function(e,i,r,s){var n=e.env+i.path,t=R.merge(R.dissoc("env",e),i.body),o={"User-Agent":"Plaid Node v"+pjson.version};null!=r.version&&(o["Plaid-Version"]=r.version),null!=r.clientApp&&(o["Plaid-Client-App"]=r.clientApp);var u=R.merge({uri:n,method:"POST",json:t,headers:o,timeout:DEFAULT_TIMEOUT_IN_MILLIS,encoding:i.binary?null:"utf8"},r);return wrapPromise(new Promise(function(n,t){request(u,function(e,r,s){handleApiResponse(n,t,e,r,s,i.includeMfaResponse)})}),s)};module.exports=plaidRequest;