import{__assign,__spreadArrays,__rest}from"tslib";import{hex,rgba,hsla,complex,color}from"style-value-types";import{invariant}from"hey-listen";import sync,{cancelSync,getFrameData}from"framesync";function spring(e){var n=e.from,t=void 0===n?0:n,r=e.to,a=void 0===r?0:r,o=e.velocity,i=void 0===o?0:o,u=e.stiffness,s=void 0===u?100:u,c=e.damping,f=void 0===c?10:c,p=e.mass,l=void 0===p?1:p,v=e.restSpeed,m=void 0===v?2:v,d=e.restDelta,h={done:!1,value:t},y=zero,g=zero;function b(){var e=i?-i/1e3:0,n=a-t,r=f/(2*Math.sqrt(s*l)),o=Math.sqrt(s/l)/1e3;if(null!=d||(d=Math.abs(a-t)<=1?.01:.4),r<1)y=function(t){var i=Math.exp(-r*o*t),u=o*Math.sqrt(1-r*r);return a-i*((e+r*o*n)/u*Math.sin(u*t)+n*Math.cos(u*t))},g=function(t){var a=Math.exp(-r*o*t),i=o*Math.sqrt(1-r*r);return r*o*a*(Math.sin(i*t)*(e+r*o*n)/i+n*Math.cos(i*t))-a*(Math.cos(i*t)*(e+r*o*n)-i*n*Math.sin(i*t))};else if(1===r)y=function(t){var r=Math.exp(-o*t);return a-r*(n+(e+o*n)*t)};else{var u=o*Math.sqrt(r*r-1);y=function(t){var i=Math.exp(-r*o*t);return a-i*((e+r*o*n)*Math.sinh(u*t)+u*n*Math.cosh(u*t))/u}}}return b(),{next:function(e){var n=y(e),t=1e3*g(e),r=Math.abs(t)<=m,o=Math.abs(a-n)<=d;return h.done=r&&o,h.value=h.done?a:n,h},flipTarget:function(){var e;i=-i,t=(e=[a,t])[0],a=e[1],b()}}}spring.needsInterpolation=function(e,n){return"string"==typeof e||"string"==typeof n};var zero=function(e){return 0},progress=function(e,n,t){var r=n-e;return 0===r?1:(t-e)/r},mix=function(e,n,t){return-t*e+t*n+e},mixLinearColor=function(e,n,t){var r=e*e,a=n*n;return Math.sqrt(Math.max(0,t*(a-r)+r))},colorTypes=[hex,rgba,hsla],getColorType=function(e){return colorTypes.find(function(n){return n.test(e)})},notAnimatable=function(e){return"'"+e+"' is not an animatable color. Use the equivalent color code instead."},mixColor=function(e,n){var t=getColorType(e),r=getColorType(n);invariant(!!t,notAnimatable(e)),invariant(!!r,notAnimatable(n)),invariant(t.transform===r.transform,"Both colors must be hex/RGBA, OR both must be HSLA.");var a=t.parse(e),o=r.parse(n),i=__assign({},a),u=t===hsla?mix:mixLinearColor;return function(e){for(var n in i)"alpha"!==n&&(i[n]=u(a[n],o[n],e));return i.alpha=mix(a.alpha,o.alpha,e),t.transform(i)}},zeroPoint={x:0,y:0,z:0},isNum=function(e){return"number"==typeof e},combineFunctions=function(e,n){return function(t){return n(e(t))}},pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.reduce(combineFunctions)};function getMixer(e,n){return isNum(e)?function(t){return mix(e,n,t)}:color.test(e)?mixColor(e,n):mixComplex(e,n)}var mixArray=function(e,n){var t=__spreadArrays(e),r=t.length,a=e.map(function(e,t){return getMixer(e,n[t])});return function(e){for(var n=0;n<r;n++)t[n]=a[n](e);return t}},mixObject=function(e,n){var t=__assign(__assign({},e),n),r={};for(var a in t)void 0!==e[a]&&void 0!==n[a]&&(r[a]=getMixer(e[a],n[a]));return function(e){for(var n in r)t[n]=r[n](e);return t}};function analyse(e){for(var n=complex.parse(e),t=n.length,r=0,a=0,o=0,i=0;i<t;i++)r||"number"==typeof n[i]?r++:void 0!==n[i].hue?o++:a++;return{parsed:n,numNumbers:r,numRGB:a,numHSL:o}}var mixComplex=function(e,n){var t=complex.createTransformer(n),r=analyse(e),a=analyse(n);return invariant(r.numHSL===a.numHSL&&r.numRGB===a.numRGB&&r.numNumbers>=a.numNumbers,"Complex values '"+e+"' and '"+n+"' too different to mix. Ensure all colors are of the same type."),pipe(mixArray(r.parsed,a.parsed),t)},clamp=function(e,n,t){return Math.min(Math.max(t,e),n)},mixNumber=function(e,n){return function(t){return mix(e,n,t)}};function detectMixerFactory(e){return"number"==typeof e?mixNumber:"string"==typeof e?color.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:"object"==typeof e?mixObject:void 0}function createMixers(e,n,t){for(var r=[],a=t||detectMixerFactory(e[0]),o=e.length-1,i=0;i<o;i++){var u=a(e[i],e[i+1]);if(n){var s=Array.isArray(n)?n[i]:n;u=pipe(s,u)}r.push(u)}return r}function fastInterpolate(e,n){var t=e[0],r=e[1],a=n[0];return function(e){return a(progress(t,r,e))}}function slowInterpolate(e,n){var t=e.length,r=t-1;return function(a){var o=0,i=!1;if(a<=e[0]?i=!0:a>=e[r]&&(o=r-1,i=!0),!i){for(var u=1;u<t&&!(e[u]>a||u===r);u++);o=u-1}var s=progress(e[o],e[o+1],a);return n[o](s)}}function interpolate(e,n,t){var r=void 0===t?{}:t,a=r.clamp,o=void 0===a||a,i=r.ease,u=r.mixer,s=e.length;invariant(s===n.length,"Both input and output ranges must be the same length"),invariant(!i||!Array.isArray(i)||i.length===s-1,"Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values."),e[0]>e[s-1]&&(e=[].concat(e),n=[].concat(n),e.reverse(),n.reverse());var c=createMixers(n,i,u),f=2===s?fastInterpolate(e,c):slowInterpolate(e,c);return o?function(n){return f(clamp(e[0],e[s-1],n))}:f}var reverseEasing=function(e){return function(n){return 1-e(1-n)}},mirrorEasing=function(e){return function(n){return n<=.5?e(2*n)/2:(2-e(2*(1-n)))/2}},createExpoIn=function(e){return function(n){return Math.pow(n,e)}},createBackIn=function(e){return function(n){return n*n*((e+1)*n-e)}},createAnticipate=function(e){var n=createBackIn(e);return function(e){return(e*=2)<1?.5*n(e):.5*(2-Math.pow(2,-10*(e-1)))}},DEFAULT_OVERSHOOT_STRENGTH=1.525,BOUNCE_FIRST_THRESHOLD=4/11,BOUNCE_SECOND_THRESHOLD=8/11,BOUNCE_THIRD_THRESHOLD=.9,linear=function(e){return e},easeIn=createExpoIn(2),easeOut=reverseEasing(easeIn),easeInOut=mirrorEasing(easeIn),circIn=function(e){return 1-Math.sin(Math.acos(e))},circOut=reverseEasing(circIn),circInOut=mirrorEasing(circOut),backIn=createBackIn(DEFAULT_OVERSHOOT_STRENGTH),backOut=reverseEasing(backIn),backInOut=mirrorEasing(backIn),anticipate=createAnticipate(DEFAULT_OVERSHOOT_STRENGTH),ca=4356/361,cb=35442/1805,cc=16061/1805,bounceOut=function(e){if(1===e||0===e)return e;var n=e*e;return e<BOUNCE_FIRST_THRESHOLD?7.5625*n:e<BOUNCE_SECOND_THRESHOLD?9.075*n-9.9*e+3.4:e<BOUNCE_THIRD_THRESHOLD?ca*n-cb*e+cc:10.8*e*e-20.52*e+10.72},bounceIn=reverseEasing(bounceOut),bounceInOut=function(e){return e<.5?.5*(1-bounceOut(1-2*e)):.5*bounceOut(2*e-1)+.5};function defaultEasing(e,n){return e.map(function(){return n||easeInOut}).splice(0,e.length-1)}function defaultOffset(e){var n=e.length;return e.map(function(e,t){return 0!==t?t/(n-1):0})}function convertOffsetToTimes(e,n){return e.map(function(e){return e*n})}function keyframes(e){var n=e.from,t=void 0===n?0:n,r=e.to,a=void 0===r?1:r,o=e.ease,i=e.offset,u=e.duration,s=void 0===u?300:u,c={done:!1,value:t},f=Array.isArray(a)?a:[t,a],p=convertOffsetToTimes(null!=i?i:defaultOffset(f),s);function l(){return interpolate(p,f,{ease:Array.isArray(o)?o:defaultEasing(f,o)})}var v=l();return{next:function(e){return c.value=v(e),c.done=e>=s,c},flipTarget:function(){f.reverse(),v=l()}}}function decay(e){var n=e.velocity,t=void 0===n?0:n,r=e.from,a=void 0===r?0:r,o=e.power,i=void 0===o?.8:o,u=e.timeConstant,s=void 0===u?350:u,c=e.restDelta,f=void 0===c?.5:c,p=e.modifyTarget,l={done:!1,value:a},v=i*t,m=a+v,d=void 0===p?m:p(m);return d!==m&&(v=d-a),{next:function(e){var n=-v*Math.exp(-e/s);return l.done=!(n>f||n<-f),l.value=l.done?d:d+n,l},flipTarget:function(){}}}var types={keyframes:keyframes,spring:spring,decay:decay};function detectAnimationFromOptions(e){if(Array.isArray(e.to))return keyframes;if(types[e.type])return types[e.type];var n=new Set(Object.keys(e));return n.has("ease")||n.has("duration")?keyframes:n.has("stiffness")||n.has("mass")||n.has("damping")||n.has("restSpeed")||n.has("restDelta")?spring:keyframes}function loopElapsed(e,n,t){return void 0===t&&(t=0),e-n-t}function reverseElapsed(e,n,t,r){return void 0===t&&(t=0),void 0===r&&(r=!0),r?loopElapsed(n+-e,n,t):n-(e-n)+t}function hasRepeatDelayElapsed(e,n,t,r){return r?e>=n+t:e<=-t}var framesync=function(e){var n=function(n){var t=n.delta;return e(t)};return{start:function(){return sync.update(n,!0,!0)},stop:function(){return cancelSync.update(n)}}};function animate(e){var n,t,r,a,o,i=e.from,u=e.autoplay,s=void 0===u||u,c=e.driver,f=void 0===c?framesync:c,p=e.elapsed,l=void 0===p?0:p,v=e.repeat,m=void 0===v?0:v,d=e.repeatType,h=void 0===d?"loop":d,y=e.repeatDelay,g=void 0===y?0:y,b=e.onPlay,x=e.onStop,M=e.onComplete,S=e.onRepeat,O=e.onUpdate,T=__rest(e,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),E=T.to,I=0,_=T.duration,D=!1,A=!0,k=detectAnimationFromOptions(T);(null===(t=(n=k).needsInterpolation)||void 0===t?void 0:t.call(n,i,E))&&(o=interpolate([0,100],[i,E],{clamp:!1}),i=0,E=100);var R=k(__assign(__assign({},T),{from:i,to:E}));function C(e){if(A||(e=-e),l+=e,!D){var n=R.next(Math.max(0,l));a=n.value,o&&(a=o(a)),D=A?n.done:l<=0}null==O||O(a),D&&(0===I&&(null!=_||(_=l)),I<m?hasRepeatDelayElapsed(l,_,g,A)&&(I++,"reverse"===h?l=reverseElapsed(l,_,g,A=I%2==0):(l=loopElapsed(l,_,g),"mirror"===h&&R.flipTarget()),D=!1,S&&S()):(r.stop(),M&&M()))}return s&&(null==b||b(),(r=f(C)).start()),{stop:function(){null==x||x(),r.stop()}}}function velocityPerSecond(e,n){return n?e*(1e3/n):0}function inertia(e){var n,t=e.from,r=void 0===t?0:t,a=e.velocity,o=void 0===a?0:a,i=e.min,u=e.max,s=e.power,c=void 0===s?.8:s,f=e.timeConstant,p=void 0===f?750:f,l=e.bounceStiffness,v=void 0===l?500:l,m=e.bounceDamping,d=void 0===m?10:m,h=e.restDelta,y=void 0===h?1:h,g=e.modifyTarget,b=e.driver,x=e.onUpdate,M=e.onComplete;function S(e){return void 0!==i&&e<i||void 0!==u&&e>u}function O(e){return void 0===i?u:void 0===u?i:Math.abs(i-e)<Math.abs(u-e)?i:u}function T(e){null==n||n.stop(),n=animate(__assign(__assign({},e),{driver:b,onUpdate:function(n){var t;null==x||x(n),null===(t=e.onUpdate)||void 0===t||t.call(e,n)},onComplete:M}))}function E(e){T(__assign({type:"spring",stiffness:v,damping:d,restDelta:y},e))}if(S(r))E({from:r,velocity:o,to:O(r)});else{var I=c*o+r;void 0!==g&&(I=g(I));var _,D,A=O(I),k=A===i?-1:1;T({type:"decay",from:r,velocity:o,timeConstant:p,power:c,restDelta:y,modifyTarget:g,onUpdate:S(I)?function(e){_=D,D=e,o=velocityPerSecond(e-_,getFrameData().delta),(1===k&&e>A||-1===k&&e<A)&&E({from:e,to:A,velocity:o})}:void 0})}return{stop:function(){return null==n?void 0:n.stop()}}}var radiansToDegrees=function(e){return 180*e/Math.PI},angle=function(e,n){return void 0===n&&(n=zeroPoint),radiansToDegrees(Math.atan2(n.y-e.y,n.x-e.x))},applyOffset=function(e,n){var t=!0;return void 0===n&&(n=e,t=!1),function(r){return t?r-e+n:(e=r,t=!0,n)}},identity=function(e){return e},createAttractor=function(e){return void 0===e&&(e=identity),function(n,t,r){var a=t-r,o=-(0-n+1)*(0-e(Math.abs(a)));return a<=0?t+o:t-o}},attract=createAttractor(),attractExpo=createAttractor(Math.sqrt),degreesToRadians=function(e){return e*Math.PI/180},isPoint=function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")},isPoint3D=function(e){return isPoint(e)&&e.hasOwnProperty("z")},distance1D=function(e,n){return Math.abs(e-n)};function distance(e,n){if(isNum(e)&&isNum(n))return distance1D(e,n);if(isPoint(e)&&isPoint(n)){var t=distance1D(e.x,n.x),r=distance1D(e.y,n.y),a=isPoint3D(e)&&isPoint3D(n)?distance1D(e.z,n.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(r,2)+Math.pow(a,2))}}var pointFromVector=function(e,n,t){return n=degreesToRadians(n),{x:t*Math.cos(n)+e.x,y:t*Math.sin(n)+e.y}},toDecimal=function(e,n){return void 0===n&&(n=2),n=Math.pow(10,n),Math.round(e*n)/n},smoothFrame=function(e,n,t,r){return void 0===r&&(r=0),toDecimal(e+t*(n-e)/Math.max(r,t))},smooth=function(e){void 0===e&&(e=50);var n=0,t=0;return function(r){var a=getFrameData().timestamp,o=a!==t?a-t:0,i=o?smoothFrame(n,r,o,e):n;return t=a,n=i,i}},snap=function(e){if("number"==typeof e)return function(n){return Math.round(n/e)*e};var n=0,t=e.length;return function(r){var a=Math.abs(e[0]-r);for(n=1;n<t;n++){var o=e[n],i=Math.abs(o-r);if(0===i)return o;if(i>a)return e[n-1];if(n===t-1)return o;a=i}}};function velocityPerFrame(e,n){return e/(1e3/n)}var wrap=function(e,n,t){var r=n-e;return((t-e)%r+r)%r+e},a=function(e,n){return 1-3*n+3*e},b=function(e,n){return 3*n-6*e},c=function(e){return 3*e},calcBezier=function(e,n,t){return((a(n,t)*e+b(n,t))*e+c(n))*e},getSlope=function(e,n,t){return 3*a(n,t)*e*e+2*b(n,t)*e+c(n)},subdivisionPrecision=1e-7,subdivisionMaxIterations=10;function binarySubdivide(e,n,t,r,a){var o,i,u=0;do{(o=calcBezier(i=n+(t-n)/2,r,a)-e)>0?t=i:n=i}while(Math.abs(o)>subdivisionPrecision&&++u<subdivisionMaxIterations);return i}var newtonIterations=8,newtonMinSlope=.001;function newtonRaphsonIterate(e,n,t,r){for(var a=0;a<newtonIterations;++a){var o=getSlope(n,t,r);if(0===o)return n;n-=(calcBezier(n,t,r)-e)/o}return n}var kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1);function cubicBezier(e,n,t,r){if(e===n&&t===r)return linear;for(var a=new Float32Array(kSplineTableSize),o=0;o<kSplineTableSize;++o)a[o]=calcBezier(o*kSampleStepSize,e,t);return function(o){return 0===o||1===o?o:calcBezier(function(n){for(var r=0,o=1,i=kSplineTableSize-1;o!==i&&a[o]<=n;++o)r+=kSampleStepSize;var u=r+(n-a[--o])/(a[o+1]-a[o])*kSampleStepSize,s=getSlope(u,e,t);return s>=newtonMinSlope?newtonRaphsonIterate(n,u,e,t):0===s?u:binarySubdivide(n,r,r+kSampleStepSize,e,t)}(o),n,r)}}var steps=function(e,n){return void 0===n&&(n="end"),function(t){var r=(t="end"===n?Math.min(t,.999):Math.max(t,.001))*e,a="end"===n?Math.floor(r):Math.ceil(r);return clamp(0,1,a/e)}};export{angle,animate,anticipate,applyOffset,attract,attractExpo,backIn,backInOut,backOut,bounceIn,bounceInOut,bounceOut,circIn,circInOut,circOut,clamp,createAnticipate,createAttractor,createBackIn,createExpoIn,cubicBezier,decay,degreesToRadians,distance,easeIn,easeInOut,easeOut,inertia,interpolate,isPoint,isPoint3D,keyframes,linear,mirrorEasing,mix,mixColor,mixComplex,pipe,pointFromVector,progress,radiansToDegrees,reverseEasing,smooth,smoothFrame,snap,spring,steps,toDecimal,velocityPerFrame,velocityPerSecond,wrap};