!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).popmotion={})}(this,function(t){"use strict";var q=function(){return(q=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}).apply(this,arguments)};function F(t){var r=t.from,i=void 0===r?0:r,n=t.to,f=void 0===n?0:n,e=t.velocity,s=void 0===e?0:e,o=t.stiffness,c=void 0===o?100:o,a=t.damping,p=void 0===a?10:a,u=t.mass,v=void 0===u?1:u,l=t.restSpeed,d=void 0===l?2:l,h=t.restDelta,m=b,y=b;function g(){var n,e=s?-s/1e3:0,o=f-i,a=p/(2*Math.sqrt(c*v)),u=Math.sqrt(c/v)/1e3;null!=h||(h=Math.abs(f-i)<=1?.01:.4),a<1?(m=function(t){var r=Math.exp(-a*u*t),n=u*Math.sqrt(1-a*a);return f-r*((e+a*u*o)/n*Math.sin(n*t)+o*Math.cos(n*t))},y=function(t){var r=Math.exp(-a*u*t),n=u*Math.sqrt(1-a*a);return a*u*r*(Math.sin(n*t)*(e+a*u*o)/n+o*Math.cos(n*t))-r*(Math.cos(n*t)*(e+a*u*o)-n*o*Math.sin(n*t))}):m=1==a?function(t){var r=Math.exp(-u*t);return f-r*(o+(e+u*o)*t)}:(n=u*Math.sqrt(a*a-1),function(t){var r=Math.exp(-a*u*t);return f-r*((e+a*u*o)*Math.sinh(n*t)+n*o*Math.cosh(n*t))/n})}g();var M={current:i,isComplete:!1,update:function(t){var r=m(t),n=1e3*y(t),e=Math.abs(n)<=d,o=Math.abs(f-r)<=h;return M.isComplete=e&&o,M.current=M.isComplete?f:r,M.current},flipTarget:function(){var t;s=-s,i=(t=[f,i])[0],f=t[1],g()}};return M}F.needsInterpolation=function(t,r){return"string"==typeof t||"string"==typeof r};function f(t,r,n){return-n*t+n*r+t}function r(r,n){return function(t){return Math.max(Math.min(t,n),r)}}function p(t){return t%1?Number(t.toFixed(5)):t}function n(t){return void 0!==t.red}function e(t){return void 0!==t.hue}var o,b=function(t){return 0},x=function(t,r,n){var e=r-t;return 0==e?1:(n-t)/e},s=/(-)?(\d[\d\.]*)/g,c=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,a=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,u={test:function(t){return"number"==typeof t},parse:parseFloat,transform:function(t){return t}},v=q(q({},u),{transform:r(0,1)}),l=(q(q({},u),{default:1}),o="%",{test:function(t){return"string"==typeof t&&t.endsWith(o)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+o}}),i=(q(q({},l),{parse:function(t){return l.parse(t)/100},transform:function(t){return l.transform(100*t)}}),r(0,255));function d(a){return function(t){if("string"!=typeof t)return t;for(var r,n={},e=(r=t).substring(r.indexOf("(")+1,r.lastIndexOf(")")).replace(/(,|\/)/g," ").split(/ \s*/),o=0;o<4;o++)n[a[o]]=void 0!==e[o]?parseFloat(e[o]):1;return n}}var h=q(q({},u),{transform:function(t){return Math.round(i(t))}});function m(t,r){return t.startsWith(r)&&a.test(t)}function y(t){return"number"==typeof t?0:t}function g(t,r,n){var e=t*t,o=r*r;return Math.sqrt(Math.max(0,n*(o-e)+e))}function M(r){return k.find(function(t){return t.test(r)})}function O(t){return"number"==typeof t}function w(r,n){return function(t){return n(r(t))}}var I={test:function(t){return"string"==typeof t?m(t,"rgb"):n(t)},parse:d(["red","green","blue","alpha"]),transform:function(t){var r,n,e,o,a,u=t.red,i=t.green,f=t.blue,s=t.alpha,c=void 0===s?1:s;return r={red:h.transform(u),green:h.transform(i),blue:h.transform(f),alpha:p(v.transform(c))},n=r.red,e=r.green,o=r.blue,a=r.alpha,"rgba("+n+", "+e+", "+o+", "+(void 0===a?1:a)+")"}},A={test:function(t){return"string"==typeof t?m(t,"hsl"):e(t)},parse:d(["hue","saturation","lightness","alpha"]),transform:function(t){var r,n,e,o,a,u=t.hue,i=t.saturation,f=t.lightness,s=t.alpha,c=void 0===s?1:s;return r={hue:Math.round(u),saturation:l.transform(p(i)),lightness:l.transform(p(f)),alpha:p(v.transform(c))},n=r.hue,e=r.saturation,o=r.lightness,a=r.alpha,"hsla("+n+", "+e+", "+o+", "+(void 0===a?1:a)+")"}},C=q(q({},I),{test:function(t){return"string"==typeof t&&m(t,"#")},parse:function(t){var r="",n="",e="";return 4<t.length?(r=t.substr(1,2),n=t.substr(3,2),e=t.substr(5,2)):(r=t.substr(1,1),n=t.substr(2,1),e=t.substr(3,1),r+=r,n+=n,e+=e),{red:parseInt(r,16),green:parseInt(n,16),blue:parseInt(e,16),alpha:1}}}),P={test:function(t){return"string"==typeof t&&a.test(t)||n(t)||e(t)},parse:function(t){return I.test(t)?I.parse(t):A.test(t)?A.parse(t):C.test(t)?C.parse(t):t},transform:function(t){return n(t)?I.transform(t):e(t)?A.transform(t):t}},T="${c}",D="${n}",S={test:function(t){if("string"!=typeof t||!isNaN(t))return!1;var r=0,n=t.match(s),e=t.match(c);return n&&(r+=n.length),e&&(r+=e.length),0<r},parse:function(t){var r=t,n=[],e=r.match(c);e&&(r=r.replace(c,T),n.push.apply(n,e.map(P.parse)));var o=r.match(s);return o&&n.push.apply(n,o.map(u.parse)),n},createTransformer:function(t){var e=t,o=0,r=t.match(c),a=r?r.length:0;if(r)for(var n=0;n<a;n++)e=e.replace(r[n],T),o++;var u=e.match(s),i=u?u.length:0;if(u)for(n=0;n<i;n++)e=e.replace(u[n],D),o++;return function(t){for(var r=e,n=0;n<o;n++)r=r.replace(n<a?T:D,n<a?P.transform(t[n]):p(t[n]));return r}},getAnimatableNone:function(t){var r=S.parse(t);return S.createTransformer(t)(r.map(y))}},j=function(){},k=[C,I,A],E=function(t,r){var n=M(t),e=M(r);j(n.transform===e.transform);var o=n.parse(t),a=e.parse(r),u=q({},o),i=n===A?f:g;return function(t){for(var r in u)"alpha"!==r&&(u[r]=i(o[r],a[r],t));return u.alpha=f(o.alpha,a.alpha,t),n.transform(u)}},R={x:0,y:0,z:0},U=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.reduce(w)};function z(r,n){return O(r)?function(t){return f(r,n,t)}:(P.test(r)?E:$)(r,n)}var N=function(t,n){var e=function(){for(var t=0,r=0,n=arguments.length;r<n;r++)t+=arguments[r].length;for(var e=Array(t),o=0,r=0;r<n;r++)for(var a=arguments[r],u=0,i=a.length;u<i;u++,o++)e[o]=a[u];return e}(t),o=e.length,a=t.map(function(t,r){return z(t,n[r])});return function(t){for(var r=0;r<o;r++)e[r]=a[r](t);return e}},W=function(t,r){var n=q(q({},t),r),e={};for(var o in n)void 0!==t[o]&&void 0!==r[o]&&(e[o]=z(t[o],r[o]));return function(t){for(var r in e)n[r]=e[r](t);return n}};function B(t){for(var r=S.parse(t),n=r.length,e=0,o=0,a=0,u=0;u<n;u++)e||"number"==typeof r[u]?e++:void 0!==r[u].hue?a++:o++;return{parsed:r,numNumbers:e,numRGB:o,numHSL:a}}var $=function(t,r){var n=S.createTransformer(r),e=B(t),o=B(r);return U(N(e.parsed,o.parsed),n)},_=function(t,r,n){return Math.min(Math.max(n,t),r)},G=function(r,n){return function(t){return f(r,n,t)}};function H(t,r,n){for(var e,o=[],a=n||("number"==typeof(e=t[0])?G:"string"==typeof e?P.test(e)?E:$:Array.isArray(e)?N:"object"==typeof e?W:void 0),u=t.length-1,i=0;i<u;i++){var f,s=a(t[i],t[i+1]);r&&(f=Array.isArray(r)?r[i]:r,s=U(f,s)),o.push(s)}return o}function L(r,t,n){var e=void 0===n?{}:n,o=e.clamp,a=void 0===o||o,u=e.ease,i=e.mixer,f=r.length;j(f===t.length),j(!u||!Array.isArray(u)||u.length===f-1),r[0]>r[f-1]&&(r=[].concat(r),t=[].concat(t),r.reverse(),t.reverse());var s,c,p,v,l,d,h,m,y,g=H(t,u,i),M=2===f?(d=g,h=(l=r)[0],m=l[1],y=d[0],function(t){return y(x(h,m,t))}):(c=g,p=(s=r).length,v=p-1,function(t){var r=0,n=!1;if(t<=s[0]?n=!0:t>=s[v]&&(r=v-1,n=!0),!n){for(var e=1;e<p&&!(s[e]>t||e===v);e++);r=e-1}var o=x(s[r],s[r+1],t);return c[r](o)});return a?function(t){return M(_(r[0],r[f-1],t))}:M}function V(r){return function(t){return 1-r(1-t)}}function J(r){return function(t){return t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2}}function K(r){return function(t){return Math.pow(t,r)}}function Q(r){return function(t){return t*t*((r+1)*t-r)}}function X(t){var r=Q(t);return function(t){return(t*=2)<1?.5*r(t):.5*(2-Math.pow(2,-10*(t-1)))}}function Y(t){return t}function Z(t){return 1-Math.sin(Math.acos(t))}function tt(t){if(1===t||0===t)return t;var r=t*t;return t<4/11?7.5625*r:t<8/11?9.075*r-9.9*t+3.4:t<.9?4356/361*r-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}var rt=K(2),nt=V(rt),et=J(rt),ot=V(Z),at=J(ot),ut=Q(1.525),it=V(ut),ft=J(ut),st=X(1.525),ct=V(tt);function pt(t){var r,n,e,o,a=t.from,u=void 0===a?0:a,i=t.to,f=void 0===i?1:i,s=t.ease,c=t.offset,p=t.duration,v=void 0===p?300:p,l=Array.isArray(f)?f:[u,f],d=(r=null!=c?c:(o=(e=l).length,e.map(function(t,r){return 0!==r?r/(o-1):0})),n=v,r.map(function(t){return t*n}));function h(){return L(d,l,{ease:Array.isArray(s)?s:(r=s,(t=l).map(function(){return r||et}).splice(0,t.length-1))});var t,r}var m=h(),y={current:l[0],isComplete:!1,update:function(t){y.current=m(t),y.isComplete=v<=t},flipTarget:function(){l.reverse(),m=h()}};return y}function vt(t){var r=t.velocity,n=void 0===r?0:r,e=t.from,o=void 0===e?0:e,a=t.power,u=void 0===a?.8:a,i=t.timeConstant,f=void 0===i?350:i,s=t.restDelta,c=void 0===s?.5:s,p=t.modifyTarget,v=u*n,l=o+v,d=void 0===p?l:p(l);d!==l&&(v=d-o);var h={current:o,isComplete:!1,update:function(t){var r=-v*Math.exp(-t/f);h.isComplete=!(c<r||r<-c),h.current=h.isComplete?d:d+r},flipTarget:function(){}};return h}pt.needsInterpolation=function(){return!1},vt.needsInterpolation=function(){return!1};var lt={keyframes:pt,spring:F,decay:vt};function dt(t){return bt=t}function ht(t){return It[t].process(Ot)}var mt=0,yt="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var r=Date.now(),n=Math.max(0,16.7-(r-mt));mt=r+n,setTimeout(function(){return t(mt)},n)},gt=1/60*1e3,Mt=!0,bt=!1,xt=!1,Ot={delta:0,timestamp:0},wt=["read","update","preRender","render","postRender"],It=wt.reduce(function(t,r){var e,a,u,i,f,o,s,c,p;return t[r]=(e=dt,a=[],f=!(u=[]),o=i=0,s=new WeakSet,c=new WeakSet,p={cancel:function(t){var r=u.indexOf(t);s.add(t),-1!==r&&u.splice(r,1)},process:function(t){var r,n;if(f=!0,a=(r=[u,a])[0],(u=r[1]).length=0,i=a.length)for(o=0;o<i;o++)(n=a[o])(t),!0!==c.has(n)||s.has(n)||(p.schedule(n),e(!0));f=!1},schedule:function(t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var e=n&&f,o=e?a:u;s.delete(t),r&&c.add(t),-1===o.indexOf(t)&&(o.push(t),e&&(i=a.length))}}),t},{}),At=wt.reduce(function(t,r){var e=It[r];return t[r]=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),bt||Tt(),e.schedule(t,r,n),t},t},{}),Ct=wt.reduce(function(t,r){return t[r]=It[r].cancel,t},{}),Pt=function(t){bt=!1,Ot.delta=Mt?gt:Math.max(Math.min(t-Ot.timestamp,40),1),Mt||(gt=Ot.delta),Ot.timestamp=t,xt=!0,wt.forEach(ht),xt=!1,bt&&(Mt=!1,yt(Pt))},Tt=function(){Mt=bt=!0,xt||yt(Pt)};function Dt(t,r,n){return void 0===n&&(n=0),t-r-n}var St=function(n){function t(t){var r=t.delta;return n(r)}return{start:function(){return At.update(t,!0,!0)},stop:function(){return Ct.update(t)}}};function jt(t){var o,a,u,r=t.from,n=t.autoplay,e=void 0===n||n,i=t.driver,f=void 0===i?St:i,s=t.elapsed,c=void 0===s?0:s,p=t.repeat,v=void 0===p?0:p,l=t.repeatType,d=void 0===l?"loop":l,h=t.repeatDelay,m=void 0===h?0:h,y=t.onPlay,g=t.onStop,M=t.onComplete,b=t.onRepeat,x=t.onUpdate,O=function(t,r){var n={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(n[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,e=Object.getOwnPropertySymbols(t);o<e.length;o++)r.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(n[e[o]]=t[e[o]]);return n}(t,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),w=O.to,I=0,A=O.duration,C=!1,P=!0,T=function(t){if(Array.isArray(t.to))return pt;if(lt[t.type])return lt[t.type];var r=new Set(Object.keys(t));return!r.has("ease")&&!r.has("duration")&&(r.has("stiffness")||r.has("mass")||r.has("damping")||r.has("restSpeed")||r.has("restDelta"))?F:pt}(O);T.needsInterpolation(r,w)&&(u=L([0,100],[r,w],{clamp:!1}),r=0,w=100);var D=T(q(q({},O),{from:r,to:w}));function S(){var t,r,n,e;I++,"reverse"===d?(t=c,r=A,void 0===(n=m)&&(n=0),void 0===(e=P=I%2==0)&&(e=!0),c=e?Dt(r+-t,r,n):r-(t-r)+n):(c=Dt(c,A,m),"mirror"===d&&D.flipTarget()),C=!1,D.isComplete=!1,b&&b()}function j(t){var r,n,e;P||(t=-t),c+=t,C||(D.update(Math.max(0,c)),a=D.current,u&&(a=u(a)),C=P?D.isComplete:c<=0),null!=x&&x(a),C&&(0===I&&(null!=A||(A=c)),I<v?(r=c,n=A,e=m,(P?n+e<=r:r<=-e)&&S()):(o.stop(),M&&M()))}return e&&(null!=y&&y(),(o=f(j)).start()),{stop:function(){null!=g&&g(),o.stop()}}}function qt(t,r){return r?t*(1e3/r):0}function Ft(t){return 180*t/Math.PI}function kt(t){return t}function Et(a){return void 0===a&&(a=kt),function(t,r,n){var e=r-n,o=-(0-t+1)*(0-a(Math.abs(e)));return e<=0?r+o:r-o}}function Rt(t){return t*Math.PI/180}function Ut(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")}function zt(t){return Ut(t)&&t.hasOwnProperty("z")}function Nt(t,r){return Math.abs(t-r)}var Wt=Et(),Bt=Et(Math.sqrt);function $t(t,r){return void 0===r&&(r=2),r=Math.pow(10,r),Math.round(t*r)/r}function _t(t,r,n,e){return void 0===e&&(e=0),$t(t+n*(r-t)/Math.max(e,n))}function Gt(t,r){return 1-3*r+3*t}function Ht(t,r){return 3*r-6*t}var Lt=function(t,r,n){return((Gt(r,n)*t+Ht(r,n))*t+3*r)*t},Vt=function(t,r,n){return 3*Gt(r,n)*t*t+2*Ht(r,n)*t+3*r},Jt=1e-7,Kt=10;var Qt=8;t.angle=function(t,r){return void 0===r&&(r=R),Ft(Math.atan2(r.y-t.y,r.x-t.x))},t.animate=jt,t.anticipate=st,t.applyOffset=function(r,n){var e=!0;return void 0===n&&(n=r,e=!1),function(t){return e?t-r+n:(r=t,e=!0,n)}},t.attract=Wt,t.attractExpo=Bt,t.backIn=ut,t.backInOut=ft,t.backOut=it,t.bounceIn=ct,t.bounceInOut=function(t){return t<.5?.5*(1-tt(1-2*t)):.5*tt(2*t-1)+.5},t.bounceOut=tt,t.circIn=Z,t.circInOut=at,t.circOut=ot,t.clamp=_,t.createAnticipate=X,t.createAttractor=Et,t.createBackIn=Q,t.createExpoIn=K,t.cubicBezier=function(a,r,u,n){if(a===r&&u===n)return Y;for(var i=new Float32Array(11),t=0;t<11;++t)i[t]=Lt(.1*t,a,u);function e(t){for(var r=0,n=1;10!==n&&i[n]<=t;++n)r+=.1;var e=r+.1*((t-i[--n])/(i[n+1]-i[n])),o=Vt(e,a,u);return.001<=o?function(t,r,n,e){for(var o=0;o<Qt;++o){var a=Vt(r,n,e);if(0===a)return r;r-=(Lt(r,n,e)-t)/a}return r}(t,e,a,u):0===o?e:function(t,r,n,e,o){for(var a,u,i=0;0<(a=Lt(u=r+(n-r)/2,e,o)-t)?n=u:r=u,Math.abs(a)>Jt&&++i<Kt;);return u}(t,r,r+.1,a,u)}return function(t){return 0===t||1===t?t:Lt(e(t),r,n)}},t.decay=vt,t.degreesToRadians=Rt,t.distance=function(t,r){if(O(t)&&O(r))return Nt(t,r);if(Ut(t)&&Ut(r)){var n=Nt(t.x,r.x),e=Nt(t.y,r.y),o=zt(t)&&zt(r)?Nt(t.z,r.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(e,2)+Math.pow(o,2))}},t.easeIn=rt,t.easeInOut=et,t.easeOut=nt,t.inertia=function(t){var r,n,e,o,a,u=t.from,i=void 0===u?0:u,f=t.velocity,s=void 0===f?0:f,c=t.min,p=t.max,v=t.power,l=void 0===v?.8:v,d=t.timeConstant,h=void 0===d?750:d,m=t.bounceStiffness,y=void 0===m?500:m,g=t.bounceDamping,M=void 0===g?10:g,b=t.restDelta,x=void 0===b?1:b,O=t.modifyTarget,w=t.driver,I=t.onUpdate,A=t.onComplete;function C(t){return void 0!==c&&t<c||void 0!==p&&p<t}function P(t){return void 0!==c&&(void 0===p||Math.abs(c-t)<Math.abs(p-t))?c:p}function T(n){null!=r&&r.stop(),r=jt(q(q({},n),{driver:w,onUpdate:function(t){var r;null!=I&&I(t),null!==(r=n.onUpdate)&&void 0!==r&&r.call(n,t)},onComplete:A}))}function D(t){T(q({type:"spring",stiffness:y,damping:M,restDelta:x},t))}return C(i)?D({from:i,velocity:s,to:P(i)}):(n=l*s+i,void 0!==O&&(n=O(n)),e=P(n),o=e===c?-1:1,T({type:"decay",from:i,velocity:s,timeConstant:h,power:l,restDelta:x,modifyTarget:O,onUpdate:C(n)?function(t){s=qt(t-a,Ot.delta),0<e-(a=t)*o||D({from:a,to:e,velocity:s})}:void 0})),{stop:function(){return null==r?void 0:r.stop()}}},t.interpolate=L,t.isPoint=Ut,t.isPoint3D=zt,t.keyframes=pt,t.linear=Y,t.mirrorEasing=J,t.mix=f,t.mixColor=E,t.mixComplex=$,t.pipe=U,t.pointFromVector=function(t,r,n){return r=Rt(r),{x:n*Math.cos(r)+t.x,y:n*Math.sin(r)+t.y}},t.progress=x,t.radiansToDegrees=Ft,t.reverseEasing=V,t.smooth=function(o){void 0===o&&(o=50);var a=0,u=0;return function(t){var r=Ot.timestamp,n=r!==u?r-u:0,e=n?_t(a,t,n,o):a;return u=r,a=e}},t.smoothFrame=_t,t.snap=function(o){if("number"==typeof o)return function(t){return Math.round(t/o)*o};var a=0,u=o.length;return function(t){var r=Math.abs(o[0]-t);for(a=1;a<u;a++){var n=o[a],e=Math.abs(n-t);if(0===e)return n;if(r<e)return o[a-1];if(a===u-1)return n;r=e}}},t.spring=F,t.steps=function(e,o){return void 0===o&&(o="end"),function(t){var r=(t="end"===o?Math.min(t,.999):Math.max(t,.001))*e,n="end"===o?Math.floor(r):Math.ceil(r);return _(0,1,n/e)}},t.toDecimal=$t,t.velocityPerFrame=function(t,r){return t/(1e3/r)},t.velocityPerSecond=qt,t.wrap=function(t,r,n){var e=r-t;return((n-t)%e+e)%e+t},Object.defineProperty(t,"__esModule",{value:!0})});
