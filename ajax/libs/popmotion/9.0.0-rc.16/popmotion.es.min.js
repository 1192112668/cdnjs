import{__assign,__spreadArrays,__rest}from"tslib";import{warning,invariant}from"hey-listen";import{hex,rgba,hsla,complex,color}from"style-value-types";import sync,{cancelSync,getFrameData}from"framesync";var clamp=function(n,e,t){return Math.min(Math.max(t,n),e)},safeMin=.001,minDuration=.01,maxDuration=10,minDamping=.05,maxDamping=1;function findSpring(n){var e,t,r=n.dampingRatio,a=n.duration,i=n.velocity,o=void 0===i?0:i,u=n.mass,s=void 0===u?1:u;warning(a<=1e3*maxDuration,"Spring duration must be 10 seconds or less"),r=clamp(minDamping,maxDamping,r),a=clamp(minDuration,maxDuration,a/1e3),r<1?(e=function(n){var e=n*r,t=e*a,i=e-o,u=calcAngularFreq(n,r),s=Math.exp(-t);return safeMin-i/u*s},t=function(n){var t=n*r*a,i=t*o+o,u=Math.pow(r,2)*Math.pow(n,2)*a,s=Math.exp(-t),c=calcAngularFreq(Math.pow(n,2),r);return(-e(n)+safeMin>0?-1:1)*((i-u)*s)/c}):(e=function(n){return Math.exp(-n*a)*((n-o)*a+1)-safeMin},t=function(n){return Math.exp(-n*a)*(a*a*(o-n))});var c=approximateRoot(e,t,5/a);if(isNaN(c))return{stiffness:100,damping:10};var f=Math.pow(c,2)*s;return{stiffness:f,damping:2*r*Math.sqrt(s*f)}}var rootIterations=12;function approximateRoot(n,e,t){for(var r=t,a=1;a<rootIterations;a++)r-=n(r)/e(r);return r}function calcAngularFreq(n,e){return n*Math.sqrt(1-e*e)}function spring(n){var e=n.from,t=void 0===e?0:e,r=n.to,a=void 0===r?1:r,i=n.velocity,o=void 0===i?0:i,u=n.stiffness,s=void 0===u?100:u,c=n.damping,f=void 0===c?10:c,p=n.mass,l=void 0===p?1:p,v=n.restSpeed,m=void 0===v?2:v,d=n.restDelta,h=n.duration,y=n.dampingRatio,g={done:!1,value:t};if(void 0!==h&&void 0!==y){var x=findSpring({duration:h,dampingRatio:y});s=x.stiffness,f=x.damping,o=0,l=1}var M=zero,b=zero;function S(){var n=o?-o/1e3:0,e=a-t;y=f/(2*Math.sqrt(s*l));var r=Math.sqrt(s/l)/1e3;if(null!=d||(d=Math.abs(a-t)<=1?.01:.4),y<1){var i=calcAngularFreq(r,y);M=function(t){var o=Math.exp(-y*r*t);return a-o*((n+y*r*e)/i*Math.sin(i*t)+e*Math.cos(i*t))},b=function(t){var a=Math.exp(-y*r*t);return y*r*a*(Math.sin(i*t)*(n+y*r*e)/i+e*Math.cos(i*t))-a*(Math.cos(i*t)*(n+y*r*e)-i*e*Math.sin(i*t))}}else if(1===y)M=function(t){return a-Math.exp(-r*t)*(e+(n+r*e)*t)};else{var u=r*Math.sqrt(y*y-1);M=function(t){var i=Math.exp(-y*r*t),o=Math.min(u*t,300);return a-i*((n+y*r*e)*Math.sinh(o)+u*e*Math.cosh(o))/u}}}return S(),{next:function(n){var e=M(n);if(void 0===h){var t=1e3*b(n),r=Math.abs(t)<=m,i=Math.abs(a-e)<=d;g.done=r&&i}else g.done=n>=h;return g.value=g.done?a:e,g},flipTarget:function(){var n;o=-o,t=(n=[a,t])[0],a=n[1],S()}}}spring.needsInterpolation=function(n,e){return"string"==typeof n||"string"==typeof e};var zero=function(n){return 0},progress=function(n,e,t){var r=e-n;return 0===r?1:(t-n)/r},mix=function(n,e,t){return-t*n+t*e+n},mixLinearColor=function(n,e,t){var r=n*n,a=e*e;return Math.sqrt(Math.max(0,t*(a-r)+r))},colorTypes=[hex,rgba,hsla],getColorType=function(n){return colorTypes.find(function(e){return e.test(n)})},notAnimatable=function(n){return"'"+n+"' is not an animatable color. Use the equivalent color code instead."},mixColor=function(n,e){var t=getColorType(n),r=getColorType(e);invariant(!!t,notAnimatable(n)),invariant(!!r,notAnimatable(e)),invariant(t.transform===r.transform,"Both colors must be hex/RGBA, OR both must be HSLA.");var a=t.parse(n),i=r.parse(e),o=__assign({},a),u=t===hsla?mix:mixLinearColor;return function(n){for(var e in o)"alpha"!==e&&(o[e]=u(a[e],i[e],n));return o.alpha=mix(a.alpha,i.alpha,n),t.transform(o)}},zeroPoint={x:0,y:0,z:0},isNum=function(n){return"number"==typeof n},combineFunctions=function(n,e){return function(t){return e(n(t))}},pipe=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.reduce(combineFunctions)};function getMixer(n,e){return isNum(n)?function(t){return mix(n,e,t)}:color.test(n)?mixColor(n,e):mixComplex(n,e)}var mixArray=function(n,e){var t=__spreadArrays(n),r=t.length,a=n.map(function(n,t){return getMixer(n,e[t])});return function(n){for(var e=0;e<r;e++)t[e]=a[e](n);return t}},mixObject=function(n,e){var t=__assign(__assign({},n),e),r={};for(var a in t)void 0!==n[a]&&void 0!==e[a]&&(r[a]=getMixer(n[a],e[a]));return function(n){for(var e in r)t[e]=r[e](n);return t}};function analyse(n){for(var e=complex.parse(n),t=e.length,r=0,a=0,i=0,o=0;o<t;o++)r||"number"==typeof e[o]?r++:void 0!==e[o].hue?i++:a++;return{parsed:e,numNumbers:r,numRGB:a,numHSL:i}}var mixComplex=function(n,e){var t=complex.createTransformer(e),r=analyse(n),a=analyse(e);return invariant(r.numHSL===a.numHSL&&r.numRGB===a.numRGB&&r.numNumbers>=a.numNumbers,"Complex values '"+n+"' and '"+e+"' too different to mix. Ensure all colors are of the same type."),pipe(mixArray(r.parsed,a.parsed),t)},mixNumber=function(n,e){return function(t){return mix(n,e,t)}};function detectMixerFactory(n){return"number"==typeof n?mixNumber:"string"==typeof n?color.test(n)?mixColor:mixComplex:Array.isArray(n)?mixArray:"object"==typeof n?mixObject:void 0}function createMixers(n,e,t){for(var r=[],a=t||detectMixerFactory(n[0]),i=n.length-1,o=0;o<i;o++){var u=a(n[o],n[o+1]);if(e){var s=Array.isArray(e)?e[o]:e;u=pipe(s,u)}r.push(u)}return r}function fastInterpolate(n,e){var t=n[0],r=n[1],a=e[0];return function(n){return a(progress(t,r,n))}}function slowInterpolate(n,e){var t=n.length,r=t-1;return function(a){var i=0,o=!1;if(a<=n[0]?o=!0:a>=n[r]&&(i=r-1,o=!0),!o){for(var u=1;u<t&&!(n[u]>a||u===r);u++);i=u-1}var s=progress(n[i],n[i+1],a);return e[i](s)}}function interpolate(n,e,t){var r=void 0===t?{}:t,a=r.clamp,i=void 0===a||a,o=r.ease,u=r.mixer,s=n.length;invariant(s===e.length,"Both input and output ranges must be the same length"),invariant(!o||!Array.isArray(o)||o.length===s-1,"Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values."),n[0]>n[s-1]&&(n=[].concat(n),e=[].concat(e),n.reverse(),e.reverse());var c=createMixers(e,o,u),f=2===s?fastInterpolate(n,c):slowInterpolate(n,c);return i?function(e){return f(clamp(n[0],n[s-1],e))}:f}var reverseEasing=function(n){return function(e){return 1-n(1-e)}},mirrorEasing=function(n){return function(e){return e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2}},createExpoIn=function(n){return function(e){return Math.pow(e,n)}},createBackIn=function(n){return function(e){return e*e*((n+1)*e-n)}},createAnticipate=function(n){var e=createBackIn(n);return function(n){return(n*=2)<1?.5*e(n):.5*(2-Math.pow(2,-10*(n-1)))}},DEFAULT_OVERSHOOT_STRENGTH=1.525,BOUNCE_FIRST_THRESHOLD=4/11,BOUNCE_SECOND_THRESHOLD=8/11,BOUNCE_THIRD_THRESHOLD=.9,linear=function(n){return n},easeIn=createExpoIn(2),easeOut=reverseEasing(easeIn),easeInOut=mirrorEasing(easeIn),circIn=function(n){return 1-Math.sin(Math.acos(n))},circOut=reverseEasing(circIn),circInOut=mirrorEasing(circOut),backIn=createBackIn(DEFAULT_OVERSHOOT_STRENGTH),backOut=reverseEasing(backIn),backInOut=mirrorEasing(backIn),anticipate=createAnticipate(DEFAULT_OVERSHOOT_STRENGTH),ca=4356/361,cb=35442/1805,cc=16061/1805,bounceOut=function(n){if(1===n||0===n)return n;var e=n*n;return n<BOUNCE_FIRST_THRESHOLD?7.5625*e:n<BOUNCE_SECOND_THRESHOLD?9.075*e-9.9*n+3.4:n<BOUNCE_THIRD_THRESHOLD?ca*e-cb*n+cc:10.8*n*n-20.52*n+10.72},bounceIn=reverseEasing(bounceOut),bounceInOut=function(n){return n<.5?.5*(1-bounceOut(1-2*n)):.5*bounceOut(2*n-1)+.5};function defaultEasing(n,e){return n.map(function(){return e||easeInOut}).splice(0,n.length-1)}function defaultOffset(n){var e=n.length;return n.map(function(n,t){return 0!==t?t/(e-1):0})}function convertOffsetToTimes(n,e){return n.map(function(n){return n*e})}function keyframes(n){var e=n.from,t=void 0===e?0:e,r=n.to,a=void 0===r?1:r,i=n.ease,o=n.offset,u=n.duration,s=void 0===u?300:u,c={done:!1,value:t},f=Array.isArray(a)?a:[t,a],p=convertOffsetToTimes(null!=o?o:defaultOffset(f),s);function l(){return interpolate(p,f,{ease:Array.isArray(i)?i:defaultEasing(f,i)})}var v=l();return{next:function(n){return c.value=v(n),c.done=n>=s,c},flipTarget:function(){f.reverse(),v=l()}}}function decay(n){var e=n.velocity,t=void 0===e?0:e,r=n.from,a=void 0===r?0:r,i=n.power,o=void 0===i?.8:i,u=n.timeConstant,s=void 0===u?350:u,c=n.restDelta,f=void 0===c?.5:c,p=n.modifyTarget,l={done:!1,value:a},v=o*t,m=a+v,d=void 0===p?m:p(m);return d!==m&&(v=d-a),{next:function(n){var e=-v*Math.exp(-n/s);return l.done=!(e>f||e<-f),l.value=l.done?d:d+e,l},flipTarget:function(){}}}var types={keyframes:keyframes,spring:spring,decay:decay};function detectAnimationFromOptions(n){if(Array.isArray(n.to))return keyframes;if(types[n.type])return types[n.type];var e=new Set(Object.keys(n));return e.has("ease")||e.has("duration")&&!e.has("dampingRatio")?keyframes:e.has("dampingRatio")||e.has("stiffness")||e.has("mass")||e.has("damping")||e.has("restSpeed")||e.has("restDelta")?spring:keyframes}function loopElapsed(n,e,t){return void 0===t&&(t=0),n-e-t}function reverseElapsed(n,e,t,r){return void 0===t&&(t=0),void 0===r&&(r=!0),r?loopElapsed(e+-n,e,t):e-(n-e)+t}function hasRepeatDelayElapsed(n,e,t,r){return r?n>=e+t:n<=-t}var framesync=function(n){var e=function(e){var t=e.delta;return n(t)};return{start:function(){return sync.update(e,!0,!0)},stop:function(){return cancelSync.update(e)}}};function animate(n){var e,t,r,a,i,o=n.from,u=n.autoplay,s=void 0===u||u,c=n.driver,f=void 0===c?framesync:c,p=n.elapsed,l=void 0===p?0:p,v=n.repeat,m=void 0===v?0:v,d=n.repeatType,h=void 0===d?"loop":d,y=n.repeatDelay,g=void 0===y?0:y,x=n.onPlay,M=n.onStop,b=n.onComplete,S=n.onRepeat,O=n.onUpdate,T=__rest(n,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),D=T.to,E=0,I=T.duration,_=!1,A=!0,R=detectAnimationFromOptions(T);(null===(t=(e=R).needsInterpolation)||void 0===t?void 0:t.call(e,o,D))&&(i=interpolate([0,100],[o,D],{clamp:!1}),o=0,D=100);var w=R(__assign(__assign({},T),{from:o,to:D}));function k(n){if(A||(n=-n),l+=n,!_){var e=w.next(Math.max(0,l));a=e.value,i&&(a=i(a)),_=A?e.done:l<=0}null==O||O(a),_&&(0===E&&(null!=I||(I=l)),E<m?hasRepeatDelayElapsed(l,I,g,A)&&(E++,"reverse"===h?l=reverseElapsed(l,I,g,A=E%2==0):(l=loopElapsed(l,I,g),"mirror"===h&&w.flipTarget()),_=!1,S&&S()):(r.stop(),b&&b()))}return s&&(null==x||x(),(r=f(k)).start()),{stop:function(){null==M||M(),r.stop()}}}function velocityPerSecond(n,e){return e?n*(1e3/e):0}function inertia(n){var e,t=n.from,r=void 0===t?0:t,a=n.velocity,i=void 0===a?0:a,o=n.min,u=n.max,s=n.power,c=void 0===s?.8:s,f=n.timeConstant,p=void 0===f?750:f,l=n.bounceStiffness,v=void 0===l?500:l,m=n.bounceDamping,d=void 0===m?10:m,h=n.restDelta,y=void 0===h?1:h,g=n.modifyTarget,x=n.driver,M=n.onUpdate,b=n.onComplete;function S(n){return void 0!==o&&n<o||void 0!==u&&n>u}function O(n){return void 0===o?u:void 0===u?o:Math.abs(o-n)<Math.abs(u-n)?o:u}function T(n){null==e||e.stop(),e=animate(__assign(__assign({},n),{driver:x,onUpdate:function(e){var t;null==M||M(e),null===(t=n.onUpdate)||void 0===t||t.call(n,e)},onComplete:b}))}function D(n){T(__assign({type:"spring",stiffness:v,damping:d,restDelta:y},n))}if(S(r))D({from:r,velocity:i,to:O(r)});else{var E=c*i+r;void 0!==g&&(E=g(E));var I,_,A=O(E),R=A===o?-1:1;T({type:"decay",from:r,velocity:i,timeConstant:p,power:c,restDelta:y,modifyTarget:g,onUpdate:S(E)?function(n){I=_,_=n,i=velocityPerSecond(n-I,getFrameData().delta),(1===R&&n>A||-1===R&&n<A)&&D({from:n,to:A,velocity:i})}:void 0})}return{stop:function(){return null==e?void 0:e.stop()}}}var radiansToDegrees=function(n){return 180*n/Math.PI},angle=function(n,e){return void 0===e&&(e=zeroPoint),radiansToDegrees(Math.atan2(e.y-n.y,e.x-n.x))},applyOffset=function(n,e){var t=!0;return void 0===e&&(e=n,t=!1),function(r){return t?r-n+e:(n=r,t=!0,e)}},identity=function(n){return n},createAttractor=function(n){return void 0===n&&(n=identity),function(e,t,r){var a=t-r,i=-(0-e+1)*(0-n(Math.abs(a)));return a<=0?t+i:t-i}},attract=createAttractor(),attractExpo=createAttractor(Math.sqrt),degreesToRadians=function(n){return n*Math.PI/180},isPoint=function(n){return n.hasOwnProperty("x")&&n.hasOwnProperty("y")},isPoint3D=function(n){return isPoint(n)&&n.hasOwnProperty("z")},distance1D=function(n,e){return Math.abs(n-e)};function distance(n,e){if(isNum(n)&&isNum(e))return distance1D(n,e);if(isPoint(n)&&isPoint(e)){var t=distance1D(n.x,e.x),r=distance1D(n.y,e.y),a=isPoint3D(n)&&isPoint3D(e)?distance1D(n.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(r,2)+Math.pow(a,2))}}var pointFromVector=function(n,e,t){return e=degreesToRadians(e),{x:t*Math.cos(e)+n.x,y:t*Math.sin(e)+n.y}},toDecimal=function(n,e){return void 0===e&&(e=2),e=Math.pow(10,e),Math.round(n*e)/e},smoothFrame=function(n,e,t,r){return void 0===r&&(r=0),toDecimal(n+t*(e-n)/Math.max(r,t))},smooth=function(n){void 0===n&&(n=50);var e=0,t=0;return function(r){var a=getFrameData().timestamp,i=a!==t?a-t:0,o=i?smoothFrame(e,r,i,n):e;return t=a,e=o,o}},snap=function(n){if("number"==typeof n)return function(e){return Math.round(e/n)*n};var e=0,t=n.length;return function(r){var a=Math.abs(n[0]-r);for(e=1;e<t;e++){var i=n[e],o=Math.abs(i-r);if(0===o)return i;if(o>a)return n[e-1];if(e===t-1)return i;a=o}}};function velocityPerFrame(n,e){return n/(1e3/e)}var wrap=function(n,e,t){var r=e-n;return((t-n)%r+r)%r+n},a=function(n,e){return 1-3*e+3*n},b=function(n,e){return 3*e-6*n},c=function(n){return 3*n},calcBezier=function(n,e,t){return((a(e,t)*n+b(e,t))*n+c(e))*n},getSlope=function(n,e,t){return 3*a(e,t)*n*n+2*b(e,t)*n+c(e)},subdivisionPrecision=1e-7,subdivisionMaxIterations=10;function binarySubdivide(n,e,t,r,a){var i,o,u=0;do{(i=calcBezier(o=e+(t-e)/2,r,a)-n)>0?t=o:e=o}while(Math.abs(i)>subdivisionPrecision&&++u<subdivisionMaxIterations);return o}var newtonIterations=8,newtonMinSlope=.001;function newtonRaphsonIterate(n,e,t,r){for(var a=0;a<newtonIterations;++a){var i=getSlope(e,t,r);if(0===i)return e;e-=(calcBezier(e,t,r)-n)/i}return e}var kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1);function cubicBezier(n,e,t,r){if(n===e&&t===r)return linear;for(var a=new Float32Array(kSplineTableSize),i=0;i<kSplineTableSize;++i)a[i]=calcBezier(i*kSampleStepSize,n,t);return function(i){return 0===i||1===i?i:calcBezier(function(e){for(var r=0,i=1,o=kSplineTableSize-1;i!==o&&a[i]<=e;++i)r+=kSampleStepSize;var u=r+(e-a[--i])/(a[i+1]-a[i])*kSampleStepSize,s=getSlope(u,n,t);return s>=newtonMinSlope?newtonRaphsonIterate(e,u,n,t):0===s?u:binarySubdivide(e,r,r+kSampleStepSize,n,t)}(i),e,r)}}var steps=function(n,e){return void 0===e&&(e="end"),function(t){var r=(t="end"===e?Math.min(t,.999):Math.max(t,.001))*n,a="end"===e?Math.floor(r):Math.ceil(r);return clamp(0,1,a/n)}};export{angle,animate,anticipate,applyOffset,attract,attractExpo,backIn,backInOut,backOut,bounceIn,bounceInOut,bounceOut,circIn,circInOut,circOut,clamp,createAnticipate,createAttractor,createBackIn,createExpoIn,cubicBezier,decay,degreesToRadians,distance,easeIn,easeInOut,easeOut,inertia,interpolate,isPoint,isPoint3D,keyframes,linear,mirrorEasing,mix,mixColor,mixComplex,pipe,pointFromVector,progress,radiansToDegrees,reverseEasing,smooth,smoothFrame,snap,spring,steps,toDecimal,velocityPerFrame,velocityPerSecond,wrap};