!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.app={}))}(this,function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)},n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n=n||Promise)(function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})}function i(t,e){var n,r,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||0<e--)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}var a=(u.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},u);function u(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}var c,h,l,f="FirebaseError",d=(c=Error,e(h=g,l=c),h.prototype=null===l?Object.create(l):(p.prototype=l.prototype,new p),g);function p(){this.constructor=h}function g(t,e){var n=c.call(this,e)||this;return n.code=t,n.name=f,Object.setPrototypeOf(n,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(y.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},s=this.service+"/"+t,o=this.errors[t],a=o?(r=i,o.replace(w,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",u=this.serviceName+": "+a+" ("+s+").",c=new d(s,u),h=0,l=Object.keys(i);h<l.length;h++){var f=l[h];"_"!==f.slice(-1)&&(f in c&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),c[f]=i[f])}return c},y);function y(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,v=(b.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},b.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},b.prototype.setServiceProps=function(t){return this.serviceProps=t,this},b);function b(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var E="[DEFAULT]",I=(_.prototype.get=function(t){void 0===t&&(t=E);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new a;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},_.prototype.getImmediate=function(t){var e=n({identifier:E,optional:!1},t),r=e.identifier,i=e.optional,s=this.normalizeInstanceIdentifier(r);try{var o=this.getOrInitializeService(s);if(o)return o;if(i)return null;throw Error("Service "+this.name+" is not available")}catch(t){if(i)return null;throw t}},_.prototype.getComponent=function(){return this.component},_.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if("EAGER"===(this.component=t).instantiationMode)try{this.getOrInitializeService(E)}catch(t){}try{for(var r=s(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var a=o(i.value,2),u=a[0],c=a[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService(h);c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},_.prototype.clearInstance=function(t){void 0===t&&(t=E),this.instancesDeferred.delete(t),this.instances.delete(t)},_.prototype.delete=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}),t.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()})))];case 1:return e.sent(),[2]}})})},_.prototype.isComponentSet=function(){return null!=this.component},_.prototype.getOrInitializeService=function(t){var e,n=this.instances.get(t);return!n&&this.component&&(n=this.component.instanceFactory(this.container,(e=t)===E?void 0:e),this.instances.set(t,n)),n||null},_.prototype.normalizeInstanceIdentifier=function(t){return!this.component||this.component.multipleInstances?t:E},_);function _(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var T,N=(A.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},A.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},A.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new I(t,this);return this.providers.set(t,e),e},A.prototype.getProviders=function(){return Array.from(this.providers.values())},A);function A(t){this.name=t,this.providers=new Map}function S(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}var L,x,D=[];function O(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),s=C[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,S(["["+i+"]  "+t.name+":"],n))}}(x=L=L||{})[x.DEBUG=0]="DEBUG",x[x.VERBOSE=1]="VERBOSE",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT";var R={debug:L.DEBUG,verbose:L.VERBOSE,info:L.INFO,warn:L.WARN,error:L.ERROR,silent:L.SILENT},k=L.INFO,C=((T={})[L.DEBUG]="log",T[L.VERBOSE]="log",T[L.INFO]="info",T[L.WARN]="warn",T[L.ERROR]="error",T),P=(Object.defineProperty(V.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in L))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),V.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?R[t]:t},Object.defineProperty(V.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),V.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,L.DEBUG],t)),this._logHandler.apply(this,S([this,L.DEBUG],t))},V.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,L.VERBOSE],t)),this._logHandler.apply(this,S([this,L.VERBOSE],t))},V.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,L.INFO],t)),this._logHandler.apply(this,S([this,L.INFO],t))},V.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,L.WARN],t)),this._logHandler.apply(this,S([this,L.WARN],t))},V.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,L.ERROR],t)),this._logHandler.apply(this,S([this,L.ERROR],t))},V);function V(t){this.name=t,this._logLevel=k,this._logHandler=O,this._userLogHandler=null,D.push(this)}var M=(U.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if("VERSION"!==(null==(e=t.getComponent())?void 0:e.type))return null;var e,n=t.getImmediate();return n.library+"/"+n.version}).filter(function(t){return t}).join(" ")},U);function U(t){this.container=t}var F,q,j="@firebase/app",$=new P("@firebase/app"),B="[DEFAULT]",G=((F={})[j]="fire-core",F["@firebase/app-compat"]="fire-core-compat",F["@firebase/analytics"]="fire-analytics",F["@firebase/auth"]="fire-auth",F["@firebase/database"]="fire-rtdb",F["@firebase/functions"]="fire-fn",F["@firebase/installations"]="fire-iid",F["@firebase/messaging"]="fire-fcm",F["@firebase/performance"]="fire-perf",F["@firebase/remote-config"]="fire-rc",F["@firebase/storage"]="fire-gcs",F["@firebase/firestore"]="fire-fst",F["fire-js"]="fire-js",F.firebase="fire-js-all",F),z=new Map,H=new Map;function K(t,e){try{t.container.addComponent(e)}catch(n){$.debug("Component "+e.name+" failed to register with FirebaseApp "+t.name,n)}}function W(t){var e,n,r=t.name;if(H.has(r))return $.debug("There were multiple attempts to register component "+r+"."),!1;H.set(r,t);try{for(var i=s(z.values()),o=i.next();!o.done;o=i.next())K(o.value,t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0}function X(t,e){return t.container.getProvider(e)}var Y=((q={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",q["bad-app-name"]="Illegal App name: '{$appName}",q["duplicate-app"]="Firebase App named '{$appName}' already exists",q["app-deleted"]="Firebase App named '{$appName}' already deleted",q["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",q["invalid-log-argument"]="First argument to `onLog` must be null or a function.",q),Q=new m("app","Firebase",Y),J=(Object.defineProperty(Z.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"name",{get:function(){return this.checkDestroyed(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"options",{get:function(){return this.checkDestroyed(),this.options_},enumerable:!1,configurable:!0}),Z.prototype.checkDestroyed=function(){if(this.isDeleted)throw Q.create("app-deleted",{appName:this.name_})},Z);function Z(t,e,r){var i=this;this.isDeleted=!1,this.options_=n({},t),this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled,this.container=r,this.container.addComponent(new v("app-exp",function(){return i},"PUBLIC"))}function tt(t,e,n){var r,i=null!==(r=G[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){var a=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&a.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&o&&a.push("and"),o&&a.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void $.warn(a.join(" "))}W(new v(i+"-version",function(){return{library:i,version:e}},"VERSION"))}W(new v("platform-logger",function(t){return new M(t)},"PRIVATE")),tt(j,"0.0.800-exp.63d7fc805",void 0),tt("fire-js",""),tt("firebase","0.800.8","app"),t.SDK_VERSION="7.21.1",t._DEFAULT_ENTRY_NAME=B,t._addComponent=K,t._addOrOverwriteComponent=function(t,e){t.container.addOrOverwriteComponent(e)},t._apps=z,t._clearComponents=function(){H.clear()},t._components=H,t._getProvider=X,t._registerComponent=W,t._removeServiceInstance=function(t,e,n){void 0===n&&(n=B),X(t,e).clearInstance(n)},t.deleteApp=function(t){return r(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return e=t.name,z.has(e)?(z.delete(e),[4,Promise.all(t.container.getProviders().map(function(t){return t.delete()}))]):[3,2];case 1:n.sent(),t.isDeleted=!0,n.label=2;case 2:return[2]}})})},t.getApp=function(t){void 0===t&&(t=B);var e=z.get(t);if(!e)throw Q.create("no-app",{appName:t});return e},t.getApps=function(){return Array.from(z.values())},t.initializeApp=function(t,e){var r,i;void 0===e&&(e={}),"object"!=typeof e&&(e={name:e});var o=n({name:B,automaticDataCollectionEnabled:!1},e),a=o.name;if("string"!=typeof a||!a)throw Q.create("bad-app-name",{appName:String(a)});if(z.has(a))throw Q.create("duplicate-app",{appName:a});var u=new N(a);try{for(var c=s(H.values()),h=c.next();!h.done;h=c.next()){var l=h.value;u.addComponent(l)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}var f=new J(t,o,u);return z.set(a,f),f},t.onLog=function(t,e){if(null!==t&&"function"!=typeof t)throw Q.create("invalid-log-argument",{appName:name});!function(t,e){for(var n=0,r=D;n<r.length;n++)!function(n){var r=null;e&&e.level&&(r=R[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var o=i.map(function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}}).filter(function(t){return t}).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:L[n].toLowerCase(),message:o,args:i,type:e.name})}}(r[n])}(t,e)},t.registerVersion=tt,t.setLogLevel=function(t){var e;e=t,D.forEach(function(t){t.setLogLevel(e)})},Object.defineProperty(t,"__esModule",{value:!0})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.functions=t.firebase.functions||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function i(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})}function s(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var o="FirebaseError",a=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=o,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,u.prototype.create),i}return r(e,t),e}(Error),u=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,s=this.errors[t],o=s?function(t,e){return t.replace(c,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(s,r):"Error",u=this.serviceName+": "+o+" ("+i+").",h=new a(i,u),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},t}();var c=/\{\$([^}]+)}/g,h=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),l="type.googleapis.com/google.protobuf.Int64Value",f="type.googleapis.com/google.protobuf.UInt64Value";function d(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}function p(t){if(null==t)return t;if(t["@type"])switch(t["@type"]){case l:case f:var e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return p(t)}):"function"==typeof t||"object"==typeof t?d(t,function(t){return p(t)}):t}var g="functions",m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=function(t){function e(e,n,r){var i=t.call(this,g+"/"+e,n||"")||this;return i.details=r,i}return r(e,t),e}(a);var w=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}return t.prototype.getAuthToken=function(){return i(this,void 0,void 0,function(){var t;return s(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return[2,null==(t=e.sent())?void 0:t.accessToken];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getMessagingToken=function(){return i(this,void 0,void 0,function(){return s(this,function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]})})},t.prototype.getContext=function(){return i(this,void 0,void 0,function(){var t,e;return s(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getMessagingToken()];case 2:return e=n.sent(),[2,{authToken:t,messagingToken:e}]}})})},t}(),v="us-central1";var b=function(){function t(t,e,n,r,i){var s=this;void 0===r&&(r=v),this.app=t,this.region=r,this.fetchImpl=i,this.emulatorOrigin=null,this.contextProvider=new w(e,n),this.cancelAllRequests=new Promise(function(t){s.deleteService=function(){return Promise.resolve(t())}})}return t.prototype._delete=function(){return this.deleteService()},t.prototype._url=function(t){var e=this.app.options.projectId,n=this.region;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t}();function E(t,e,n){return function(r){return function(t,e,n,r){return i(this,void 0,void 0,function(){var o,a,u,c,h,l,f,g;return s(this,function(w){switch(w.label){case 0:return o=t._url(e),n=function t(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e))return e.map(function(e){return t(e)});if("function"==typeof e||"object"==typeof e)return d(e,function(e){return t(e)});throw new Error("Data cannot be encoded in JSON: "+e)}(n),a={data:n},u={},[4,t.contextProvider.getContext()];case 1:return(c=w.sent()).authToken&&(u.Authorization="Bearer "+c.authToken),c.messagingToken&&(u["Firebase-Instance-ID-Token"]=c.messagingToken),h=r.timeout||7e4,[4,Promise.race([function(t,e,n,r){return i(this,void 0,void 0,function(){var i,o;return s(this,function(s){switch(s.label){case 0:n["Content-Type"]="application/json",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,r(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return i=s.sent(),[3,4];case 3:return s.sent(),[2,{status:0,json:null}];case 4:o=null,s.label=5;case 5:return s.trys.push([5,7,,8]),[4,i.json()];case 6:return o=s.sent(),[3,8];case 7:return s.sent(),[3,8];case 8:return[2,{status:i.status,json:o}]}})})}(o,a,u,t.fetchImpl),(v=h,new Promise(function(t,e){setTimeout(function(){e(new y("deadline-exceeded","deadline-exceeded"))},v)})),t.cancelAllRequests])];case 2:if(!(l=w.sent()))throw new y("cancelled","Firebase Functions instance was deleted.");if(f=function(t,e){var n=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),r=n,i=void 0;try{var s=e&&e.error;if(s){var o=s.status;if("string"==typeof o){if(!m[o])return new y("internal","internal");n=m[o],r=o}var a=s.message;"string"==typeof a&&(r=a),void 0!==(i=s.details)&&(i=p(i))}}catch(t){}return"ok"===n?null:new y(n,r,i)}(l.status,l.json))throw f;if(!l.json)throw new y("internal","Response is not valid JSON object.");if(void 0===(g=l.json.data)&&(g=l.json.result),void 0===g)throw new y("internal","Response is missing data field.");return[2,{data:p(g)}]}var v})})}(t,e,r,n||{})}}var I;I=fetch,e._registerComponent(new h(g,function(t,e){var n=t.getProvider("app-exp").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("messaging");return new b(n,r,i,e,I)},"PUBLIC").setMultipleInstances(!0)),e.registerVersion("@firebase/functions-exp","0.0.800"),t.getFunctions=function(t,n){return void 0===n&&(n=v),e._getProvider(t,g).getImmediate({identifier:n})},t.httpsCallable=function(t,e,n){return E(t,e,n)},t.useFunctionsEmulator=function(t,e){!function(t,e){t.emulatorOrigin=e}(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-functions.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",s=function(t){function e(n,r){var s=t.call(this,r)||this;return s.code=n,s.name=i,Object.setPrototypeOf(s,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(s,o.prototype.create),s}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(c,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(o,r):"Error",u=this.serviceName+": "+a+" ("+i+").",h=new s(i,u),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},t}();var a,u,c=/\{\$([^}]+)}/g,h=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}(u=t.LogLevel||(t.LogLevel={}))[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT";var f={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},d=t.LogLevel.INFO,p=((a={})[t.LogLevel.DEBUG]="log",a[t.LogLevel.VERBOSE]="log",a[t.LogLevel.INFO]="info",a[t.LogLevel.WARN]="warn",a[t.LogLevel.ERROR]="error",a),g=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),s=p[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function e(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in t.LogLevel))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.DEBUG],e)),this._logHandler.apply(this,l([this,t.LogLevel.DEBUG],e))},e.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.VERBOSE],e)),this._logHandler.apply(this,l([this,t.LogLevel.VERBOSE],e))},e.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.INFO],e)),this._logHandler.apply(this,l([this,t.LogLevel.INFO],e))},e.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.WARN],e)),this._logHandler.apply(this,l([this,t.LogLevel.WARN],e))},e.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.ERROR],e)),this._logHandler.apply(this,l([this,t.LogLevel.ERROR],e))},e}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function _(){}function T(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function N(t){var e=T(t);return"array"==e||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var S="closure_uid_"+(1e9*Math.random()>>>0),L=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function D(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function O(t,e,n){return(O=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:D).apply(null,arguments)}function R(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var k=Date.now;function C(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,S)&&t[S]||(t[S]=++L)})(this)},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,s=0;s<r;s++)s in i&&e.call(n,i[s],s,t)};function U(t){return Array.prototype.concat.apply([],arguments)}function F(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function q(t){return/^[\s\xa0]*$/.test(t)}var j,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function B(t,e){return-1!=t.indexOf(e)}function G(t,e){return t<e?-1:t>e?1:0}t:{var z=I.navigator;if(z){var H=z.userAgent;if(H){j=H;break t}}j=""}function K(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function W(t){var e={};for(var n in t)e[n]=t[n];return e}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var s=0;s<X.length;s++)n=X[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Q(t){return Q[" "](t),t}Q[" "]=_;var J,Z,tt=B(j,"Opera"),et=B(j,"Trident")||B(j,"MSIE"),nt=B(j,"Edge"),rt=nt||et,it=B(j,"Gecko")&&!(B(j.toLowerCase(),"webkit")&&!B(j,"Edge"))&&!(B(j,"Trident")||B(j,"MSIE"))&&!B(j,"Edge"),st=B(j.toLowerCase(),"webkit")&&!B(j,"Edge");function ot(){var t=I.document;return t?t.documentMode:void 0}t:{var at="",ut=(Z=j,it?/rv:([^\);]+)(\)|;)/.exec(Z):nt?/Edge\/([\d\.]+)/.exec(Z):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):st?/WebKit\/(\S+)/.exec(Z):tt?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(ut&&(at=ut?ut[1]:""),et){var ct=ot();if(null!=ct&&ct>parseFloat(at)){J=String(ct);break t}}J=at}var ht,lt={};function ft(t){return function(t,e){var n=lt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=$(String(J)).split("."),r=$(String(t)).split("."),i=Math.max(n.length,r.length),s=0;0==e&&s<i;s++){var o=n[s]||"",a=r[s]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=G(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||G(0==o[2].length,0==a[2].length)||G(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&et){var dt=ot();ht=dt||(parseInt(J,10)||void 0)}else ht=void 0;var pt=ht,gt=!et||9<=Number(pt),mt=et&&!ft("9"),yt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",_,e),I.removeEventListener("test",_,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(it){t:{try{Q(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},C(vt,wt);var bt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),It=0;function _t(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],s=V(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.Y&&s.listener==e&&s.capture==!!n&&s.ca==r)return i}return-1}Tt.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.a[s])||(t=this.a[s]=[],this.b++);var o=At(t,e,r,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++It,this.Y=this.Z=!1}(e,this.src,s,!!r,i)).Z=n,t.push(e)),e};var St="closure_lm_"+(1e6*Math.random()|0),Lt={};function xt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],r,i,s);return null}r=Mt(r);return e&&e[Et]?e.wa(n,r,A(i)?!!i.capture:!!i,s):Dt(e,n,r,!0,i,s)}(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)xt(t,e[s],n,r,i);return null}return n=Mt(n),t&&t[Et]?t.va(e,n,A(r)?!!r.capture:!!r,i):Dt(t,e,n,!1,r,i)}function Dt(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i;if(o&&!gt)return null;var a=Pt(t);if(a||(t[St]=a=new Tt(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){var t=Ct,e=gt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)yt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ot(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Nt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Pt(e))?(Nt(n,t),0==n.b&&(n.src=null,e[St]=null)):_t(t)}}}function Rt(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function kt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ot(t),n.call(r,e)}function Ct(t,e){if(t.Y)return!0;if(!gt){if(!e)t:{e=["window","event"];for(var n=I,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return kt(t,e=new vt(e,this))}return kt(t,new vt(e,this))}function Pt(t){return(t=t[St])instanceof Tt?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mt(t){return"function"==T(t)?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function Ut(){P.call(this),this.c=new Tt(this),this.J=this,this.C=null}function Ft(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.Y&&o.capture==n){var a=o.listener,u=o.ca||o.src;o.Z&&Nt(t.c,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}C(Ut,P),Ut.prototype[Et]=!0,(v=Ut.prototype).addEventListener=function(t,e,n,r){xt(this,t,e,n,r)},v.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],r,i,s);else i=A(i)?!!i.capture:!!i,r=Mt(r),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=At(o=e.a[n],r,i,s))&&(_t(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,r,i,s)),(r=-1<e?n[e]:null)&&Ot(r))}(this,t,e,n,r)},v.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new wt(t,n);else if(t instanceof wt)t.target=t.target||n;else{var i=t;Y(t=new wt(r,n),i)}if(i=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.a=e[s];i=Ft(o,r,!0,t)&&i}if(i=Ft(o=t.a=n,r,!0,t)&&i,i=Ft(o,r,!1,t)&&i,e)for(s=0;s<e.length;s++)i=Ft(o=t.a=e[s],r,!1,t)&&i;return i},v.G=function(){if(Ut.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},v.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var qt=I.JSON.stringify;function jt(){this.b=this.a=null}var $t,Bt=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()},100);function Gt(){var t=Xt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Ht(t){I.setTimeout(function(){throw t},0)}function Kt(t,e){$t||function(){var t=I.Promise.resolve(void 0);$t=function(){t.then(Yt)}}(),Wt||($t(),Wt=!0),Xt.add(t,e)}jt.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Wt=!1,Xt=new jt;function Yt(){for(var t;t=Gt();){try{t.a.call(t.b)}catch(t){Ht(t)}var e=Bt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Wt=!1}function Qt(t,e){Ut.call(this),this.b=t||1,this.a=e||I,this.f=O(this.Ya,this),this.g=k()}function Jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==T(t))n&&(t=O(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=O(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}C(Qt,Ut),(v=Qt.prototype).aa=!1,v.M=null,v.Ya=function(){if(this.aa){var t=k()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Jt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=k())},v.G=function(){Qt.S.G.call(this),Jt(this),delete this.a};var te=function(t){function e(e,n,r){var i=t.call(this)||this;return i.g=null!=r?e.bind(r):e,i.h=n,i.b=null,i.c=!1,i.a=null,i}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function ee(t){P.call(this),this.b=t,this.a={}}C(ee,P);var ne=[];function re(t,e,n,r){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var s=xt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!s)break;t.a[s.key]=s}}function ie(t){K(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ot(t)},t),t.a={}}function se(){this.a=!0}function oe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ee.prototype.G=function(){ee.S.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},se.prototype.info=function(){};var ae=null;function ue(){return ae=ae||new Ut}function ce(t){wt.call(this,"serverreachability",t)}function he(t){var e=ue();e.dispatchEvent(new ce(e,t))}function le(t){wt.call(this,"statevent",t)}function fe(t){var e=ue();e.dispatchEvent(new le(e,t))}function de(t){wt.call(this,"timingevent",t)}function pe(t,e){if("function"!=T(t))throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}C(ce,wt),C(le,wt),C(de,wt);var ge={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},me={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function ye(){}function we(t){var e;return(e=t.a)||(e=t.a={}),e}function ve(){}ye.prototype.a=null;var be,Ee={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ie(){wt.call(this,"d")}function _e(){wt.call(this,"c")}function Te(){}function Ne(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new ee(this),this.P=Ae,t=rt?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}C(Ie,wt),C(_e,wt),C(Te,ye),be=new Te;var Ae=45e3,Se={},Le={};function xe(t,e,n){t.H=1,t.i=Qe(ze(e)),t.j=n,t.I=!0,De(t,null)}function De(t,e){t.u=k(),ke(t),t.l=ze(t.i);var n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),ln(n.b,"t",r),t.D=0,t.a=rr(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(O(t.Ca,t,t.a),t.O)),re(t.J,t.a,"readystatechange",t.Wa),e=t.B?W(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),he(1),function(t,e,n,r,i,s){t.info(function(){if(t.a)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+c+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.T,t.j)}function Oe(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Re(t,n);if(i==Le){4==e&&(t.h=4,fe(14),r=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==Se){t.h=4,fe(15),oe(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}oe(t.c,t.f,i,null),Ue(t,i)}4==e&&0==n.length&&(t.h=1,fe(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(e),e.F=!0)):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Ve(t))}function Re(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Le:(n=Number(e.substring(n,r)),isNaN(n)?Se:(r+=1)+n>e.length?Le:(e=e.substr(r,n),t.D=r+n,e))}function ke(t){t.U=k()+t.P,Ce(t,t.P)}function Ce(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pe(O(t.Ua,t),e)}function Pe(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Jn(t.g,t)}function Me(t){Pe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Jt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ue(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||yn(n.b,t)))if(n.I=t.N,!t.C&&yn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Qn(n),qn(n)}Wn(n),fe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=pe(O(n.Ra,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else tr(n,11)}else if((t.C||n.a==t)&&Qn(n),!q(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var s=i[3];null!=s&&(n.ha=s,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(B(h,"spdy")||B(h,"quic")||B(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(wn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Ye(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=k()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=nr(u,u.C?u.ga:null,u.fa),d.C){vn(u.b,d);var p=d,g=u.D;g&&p.setTimeout(g),p.o&&(Pe(p),ke(p)),u.a=d}else Kn(u);0<n.g.length&&Bn(n)}else"stop"!=i[0]&&"close"!=i[0]||tr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?tr(n,7):Fn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);he(4)}catch(t){}}function Fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)M(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}}function qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof qe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];$e(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)$e(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Wa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),r=this.a.X();if(!(3>e||3==e&&!rt&&!this.a.$())){this.A||4!=e||7==n||he(8==n||0>=r?3:2),Pe(this);var i=this.a.X();this.N=i;var s=this.a.$();if(this.b=200==i,function(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o})}(this.c,this.m,this.l,this.f,this.T,e,i),this.b){if(this.V&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,fe(12),Me(this),Ve(this);break t}oe(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ue(this,u)}this.I?(Oe(this,e,s),rt&&this.b&&3==e&&(re(this.J,this.R,"tick",this.Va),this.R.start())):(oe(this.c,this.f,s,null),Ue(this,s)),4==e&&Me(this),this.b&&!this.A&&(4==e?Jn(this.g,this):(this.b=!1,ke(this)))}else 400==i&&0<s.indexOf("Unknown SID")?(this.h=3,fe(12)):(this.h=0,fe(13)),Me(this),Ve(this)}}}catch(t){}},v.Va=function(){if(this.a){var t=Pn(this.a),e=this.a.$();this.D<e.length&&(Pe(this),Oe(this,t,e),this.b&&4!=t&&ke(this))}},v.cancel=function(){this.A=!0,Me(this)},v.Ua=function(){this.o=null;var t=k();0<=t-this.U?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(he(3),fe(17)),Me(this),this.h=2,Ve(this)):Ce(this,this.U-t)},(v=qe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return $e(this.b,t)?this.b[t]:e},v.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);t.call(e,s,i,this)}};var Be=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ge){this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,Ke(this,t.c),We(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new qe(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match(Be))?(this.a=!!e,He(this,n[1]||"",!0),this.j=Je(n[2]||""),Ke(this,n[3]||"",!0),We(this,n[4]),this.g=Je(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Je(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function ze(t){return new Ge(t)}function He(t,e,n){t.f=n?Je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ke(t,e,n){t.c=n?Je(e,!0):e}function We(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(un(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),ln(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ze(e,sn)),t.b=new an(e,t.a))}function Ye(t,e,n){t.b.set(e,n)}function Qe(t){return Ye(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^k()).toString(36)),t}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,on)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,sn=/[#\?@]/g,on=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(t){t.a||(t.a=new qe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){un(t),e=fn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function hn(t,e){return un(t),e=fn(t,e),$e(t.a.b,e)}function ln(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),F(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dn(t){this.g=t||pn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(v=an.prototype).add=function(t,e){un(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){un(this),this.a.forEach(function(n,r){M(n,function(n){t.call(e,n,r,this)},this)},this)},v.L=function(){un(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],s=0;s<i.length;s++)n.push(e[r]);return n},v.K=function(t){un(this);var e=[];if("string"==typeof t)hn(this,t)&&(e=U(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},v.set=function(t,e){return un(this),this.c=null,hn(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),t.push(o)}}return this.c=t.join("&")};var pn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function yn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=w(t.a.values()),s=i.next();!s.done;s=i.next()){var o=s.value;r=r.concat(o.s)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return F(t.c)}function En(){}function In(t,e,n){var r=n||"";try{Fe(t,function(t,n){var i=t;A(t)&&(i=qt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function _n(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var Tn=I.JSON.parse;function Nn(t){Ut.call(this),this.headers=new qe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=An,this.D=this.F=!1}C(Nn,Ut);var An="",Sn=/^https?$/i,Ln=["POST","PUT"];function xn(t){return"content-type"==t.toLowerCase()}function Dn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,On(t),kn(t)}function On(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rn(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Pn(t)||2!=t.X()))if(t.l&&4==Pn(t))Zt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Pn(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.B).match(Be)[1]||null;if(!s&&I.self&&I.self.location){var o=I.self.location.protocol;s=o.substr(0,o.length-1)}i=!Sn.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.X()+"]",On(t)}}finally{kn(t)}}}function kn(t,e){if(t.a){Cn(t);var n=t.a,r=t.s[0]?_:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Cn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Vn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return K(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ye(t,e,n))}function Mn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Un(t){this.pa=0,this.g=[],this.c=new se,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Mn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Mn("baseRetryDelayMs",5e3,t),this.Ma=Mn("retryDelaySeedMs",1e4,t),this.Ja=Mn("forwardChannelMaxRetries",2,t),this.ma=Mn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new En},this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Fn(t){if(jn(t),3==t.v){var e=t.R++,n=ze(t.B);Ye(n,"SID",t.J),Ye(n,"RID",e),Ye(n,"TYPE","terminate"),zn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Qe(ze(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=rr(e.g,null),e.a.ba(e.i)),e.u=k(),ke(e)}er(t)}function qn(t){t.a&&(Xn(t),t.a.cancel(),t.a=null)}function jn(t){qn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Qn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function $n(t,e){t.g.push(new function(t,e){this.b=t,this.a=e}(t.La++,e)),3==t.v&&Bn(t)}function Bn(t){gn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Gn(t,e){var n;n=e?e.f:t.R++;var r=ze(t.B);Ye(r,"SID",t.J),Ye(r,"RID",n),Ye(r,"AID",t.P),zn(t,r),t.i&&t.l&&Vn(r,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Hn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),xe(n,r,e)}function zn(t,e){t.f&&Fe({},function(t,n){Ye(e,n,t)})}function Hn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?O(t.f.Ha,t.f,t):null;t:for(var i=t.g,s=-1;;){var o=["count="+n];-1==s?0<n?(s=i[0].b,o.push("ofs="+s)):s=0:o.push("ofs="+s);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=s))s=Math.max(0,i[u].b-100),a=!1;else try{In(h,o,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Kn(t){t.a||t.j||(t.U=1,Kt(t.Aa,t),t.o=0)}function Wn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pe(O(t.Aa,t),Zn(t,t.o)),t.o++,!0)}function Xn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Yn(t){t.a=new Ne(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Ye(e,"RID","rpc"),Ye(e,"SID",t.J),Ye(e,"CI",t.H?"0":"1"),Ye(e,"AID",t.P),zn(t,e),Ye(e,"TYPE","xmlhttp"),t.i&&t.l&&Vn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Qe(ze(e)),n.j=null,n.I=!0,De(n,t)}function Qn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function Jn(t,e){var n=null;if(t.a==e){Qn(t),Xn(t),t.a=null;var r=2}else{if(!yn(t.b,e))return;n=e.s,vn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=k()-e.u;var i=t.u;(r=ue()).dispatchEvent(new de(r,n,e,i)),Bn(t)}else Kn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)||(t.h=pe(O(t.Ba,t,e),Zn(t,t.u)),t.u++,0)))}(t,e)||2==r&&Wn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:tr(t,5);break;case 4:tr(t,10);break;case 3:tr(t,6);break;default:tr(t,2)}}function Zn(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function tr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=O(t.Xa,t);n||(n=new Ge("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||He(n,"https"),Qe(n)),function(t,e){var n=new se;if(I.Image){var r=new Image;r.onload=R(_n,n,r,"TestLoadImage: loaded",!0,e),r.onerror=R(_n,n,r,"TestLoadImage: error",!1,e),r.onabort=R(_n,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=R(_n,n,r,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else fe(2);t.v=0,t.f&&t.f.ra(e),er(t),jn(t)}function er(t){t.v=0,t.I=-1,t.f&&(0==bn(t.b).length&&0==t.g.length||(t.b.c.length=0,F(t.g),t.g.length=0),t.f.qa())}function nr(t,e,n){var r=function(t){return t instanceof Ge?ze(t):new Ge(t,void 0)}(n);if(""!=r.c)e&&Ke(r,e+"."+r.c),We(r,r.h);else{var i=I.location;r=function(t,e,n,r){var i=new Ge(null,void 0);return t&&He(i,t),e&&Ke(i,e),n&&We(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.W&&K(t.W,function(t,e){Ye(r,e,t)}),e=t.A,n=t.na,e&&n&&Ye(r,e,n),Ye(r,"VER",t.ha),zn(t,r),r}function rr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Ka)).F=t.C,e}function ir(){}function sr(){if(et&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function or(t,e){Ut.call(this),this.a=new Un(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!q(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new cr(this)}function ar(t){Ie.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ur(){_e.call(this),this.status=1}function cr(t){this.a=t}(v=Nn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?we(this.H):we(be),this.a.onreadystatechange=O(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Dn(this,t)}t=n||"";var i=new qe(this.headers);r&&Fe(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=xn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=I.FormData&&t instanceof I.FormData,!(0<=V(Ln,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.D=function(t){return et&&ft(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=O(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Dn(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),kn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),kn(this,!0)),Nn.S.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ta())},v.Ta=function(){Rn(this)},v.X=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Un.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Y(r=W(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var s=this.g[i];if(void 0===(s="__data__"in s.a&&"string"==typeof(s=s.a.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Hn(this,n,e),Ye(i=ze(this.B),"RID",t),Ye(i,"CVER",22),this.A&&Ye(i,"X-HTTP-Session-Id",this.A),zn(this,i),this.i&&r&&Vn(i,this.i,r),wn(this.b,n),this.Ga&&Ye(i,"TYPE","init"),this.da?(Ye(i,"$req",e),Ye(i,"SID","null"),n.V=!0,xe(n,i,null)):xe(n,i,e),this.v=2}}else 3==this.v&&(t?Gn(this,t):0==this.g.length||gn(this.b)||Gn(this))},v.Aa=function(){if(this.j=null,Yn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pe(O(this.Sa,this),t)}},v.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,qn(this),Yn(this))},v.Ra=function(){null!=this.m&&(this.m=null,qn(this),Wn(this),fe(19))},v.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),fe(2)):(this.c.info("Failed to ping google.com"),fe(1))},(v=ir.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ha=function(){},sr.prototype.a=function(t,e){return new or(t,e)},C(or,Ut),(v=or.prototype).addEventListener=function(t,e,n,r){or.S.addEventListener.call(this,t,e,n,r)},v.removeEventListener=function(t,e,n,r){or.S.removeEventListener.call(this,t,e,n,r)},v.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;fe(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=nr(t,null,t.fa),Bn(t)},v.close=function(){Fn(this.a)},v.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,$n(this.a,e)}else this.g?((e={}).__data__=qt(t),$n(this.a,e)):$n(this.a,t)},v.G=function(){this.a.f=null,delete this.f,Fn(this.a),delete this.a,or.S.G.call(this)},C(ar,Ie),C(ur,_e),C(cr,ir),cr.prototype.ta=function(){this.a.dispatchEvent("a")},cr.prototype.sa=function(t){this.a.dispatchEvent(new ar(t))},cr.prototype.ra=function(t){this.a.dispatchEvent(new ur(t))},cr.prototype.qa=function(){this.a.dispatchEvent("b")},sr.prototype.createWebChannel=sr.prototype.a,or.prototype.send=or.prototype.Pa,or.prototype.open=or.prototype.Oa,or.prototype.close=or.prototype.close,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",ve.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Ut.prototype.listen=Ut.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var hr={createWebChannelTransport:function(){return new sr},ErrorCode:ge,EventType:me,WebChannel:ve,XhrIo:Nn},lr=hr.createWebChannelTransport,fr=hr.ErrorCode,dr=hr.EventType,pr=hr.WebChannel,gr=hr.XhrIo;class mr{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}mr.UNAUTHENTICATED=new mr(null),mr.o=new mr("google-credentials-uid"),mr.u=new mr("first-party-uid");const yr=new m("@firebase/firestore");function wr(){return yr.logLevel}function vr(e,...n){if(yr.logLevel<=t.LogLevel.DEBUG){const t=n.map(Ir);yr.debug("Firestore (7.21.1): "+e,...t)}}function br(e,...n){if(yr.logLevel<=t.LogLevel.ERROR){const t=n.map(Ir);yr.error("Firestore (7.21.1): "+e,...t)}}function Er(e,...n){if(yr.logLevel<=t.LogLevel.WARN){const t=n.map(Ir);yr.warn("Firestore (7.21.1): "+e,...t)}}function Ir(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _r(t="Unexpected state"){const e="FIRESTORE (7.21.1) INTERNAL ASSERTION FAILED: "+t;throw br(e),new Error(e)}function Tr(t,e){t||_r()}function Nr(t,e){return t}const Ar={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Sr extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Lr{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class xr{constructor(t){this.l=null,this.currentUser=mr.UNAUTHENTICATED,this._=!1,this.T=0,this.I=null,this.forceRefresh=!1,this.l=(()=>{this.T++,this.currentUser=this.m(),this._=!0,this.I&&this.I(this.currentUser)}),this.T=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.l):(this.l(null),t.get().then(t=>{this.auth=t,this.l&&this.auth.addAuthTokenListener(this.l)},()=>{}))}getToken(){const t=this.T,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.T!==t?(vr("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Tr("string"==typeof e.accessToken),new Lr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}A(){this.forceRefresh=!0}R(t){this.I=t,this._&&t(this.currentUser)}P(){this.auth&&this.auth.removeAuthTokenListener(this.l),this.l=null,this.I=null}m(){const t=this.auth&&this.auth.getUid();return Tr(null===t||"string"==typeof t),new mr(t)}}function Dr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Or{static g(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Dr(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length))}return n}}function Rr(t,e){return t<e?-1:t>e?1:0}function kr(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}function Cr(t){return t+"\0"}class Pr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Pr.fromMillis(Date.now())}static fromDate(t){return Pr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Pr(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}V(t){return this.seconds===t.seconds?Rr(this.nanoseconds,t.nanoseconds):Rr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Vr{constructor(t){this.timestamp=t}static p(t){return new Vr(t)}static min(){return new Vr(new Pr(0,0))}v(t){return this.timestamp.V(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}S(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}D(){return this.timestamp}}class Mr{constructor(t,e,n){void 0===e?e=0:e>t.length&&_r(),void 0===n?n=t.length-e:n>t.length-e&&_r(),this.segments=t,this.offset=e,this.C=n}get length(){return this.C}isEqual(t){return 0===Mr.N(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Mr?t.forEach(t=>{e.push(t)}):e.push(t),this.O(e)}limit(){return this.offset+this.length}F(t){return t=void 0===t?1:t,this.O(this.segments,this.offset+t,this.length-t)}M(){return this.O(this.segments,this.offset,this.length-1)}$(){return this.segments[this.offset]}k(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}L(){return 0===this.length}q(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}B(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}U(){return this.segments.slice(this.offset,this.limit())}static N(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ur extends Mr{O(t,e,n){return new Ur(t,e,n)}K(){return this.U().join("/")}toString(){return this.K()}static W(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Ur(e)}static j(){return new Ur([])}}const Fr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qr extends Mr{O(t,e,n){return new qr(t,e,n)}static G(t){return Fr.test(t)}K(){return this.U().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),qr.G(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.K()}H(){return 1===this.length&&"__name__"===this.get(0)}static J(){return new qr(["__name__"])}static Y(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Sr(Ar.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Sr(Ar.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new qr(e)}static j(){return new qr([])}}class jr{constructor(t){this.path=t}static X(t){return new jr(Ur.W(t))}static Z(t){return new jr(Ur.W(t).F(5))}tt(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Ur.N(this.path,t.path)}toString(){return this.path.toString()}static N(t,e){return Ur.N(t.path,e.path)}static et(t){return t.length%2==0}static nt(t){return new jr(new Ur(t.slice()))}}class $r{constructor(t,e,n,r,i){this.st=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}class Br{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get it(){return"(default)"===this.database}isEqual(t){return t instanceof Br&&t.projectId===this.projectId&&t.database===this.database}v(t){return Rr(this.projectId,t.projectId)||Rr(this.database,t.database)}}function Gr(t){return null==t}function zr(t){return 0===t&&1/t==-1/0}function Hr(t){return"number"==typeof t&&Number.isInteger(t)&&!zr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Kr{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.rt=null}}function Wr(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Kr(t,e,n,r,i,s,o)}function Xr(t){const e=Nr(t);if(null===e.rt){let t=e.path.K();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.K()+t.op.toString()+Bi(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.K()+t.dir})(t)).join(","),Gr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Mo(e.startAt)),e.endAt&&(t+="|ub:",t+=Mo(e.endAt)),e.rt=t}return e.rt}function Yr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!$o(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],r=e.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!Fi(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Fo(t.startAt,e.startAt)&&Fo(t.endAt,e.endAt)}function Qr(t){return jr.et(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Jr{constructor(t){this.ot=t}static fromBase64String(t){const e=atob(t);return new Jr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Jr(e)}toBase64(){return t=this.ot,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.ot)}ct(){return 2*this.ot.length}v(t){return Rr(this.ot,t.ot)}isEqual(t){return this.ot===t.ot}}Jr.at=new Jr("");class Zr{constructor(t,e,n,r,i=Vr.min(),s=Vr.min(),o=Jr.at){this.target=t,this.targetId=e,this.ut=n,this.sequenceNumber=r,this.ht=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}lt(t){return new Zr(this.target,this.targetId,this.ut,t,this.ht,this.lastLimboFreeSnapshotVersion,this.resumeToken)}_t(t,e){return new Zr(this.target,this.targetId,this.ut,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}ft(t){return new Zr(this.target,this.targetId,this.ut,this.sequenceNumber,this.ht,t,this.resumeToken)}}class ti{constructor(t){this.count=t}}var ei,ni;function ri(t){switch(t){case Ar.OK:return _r();case Ar.CANCELLED:case Ar.UNKNOWN:case Ar.DEADLINE_EXCEEDED:case Ar.RESOURCE_EXHAUSTED:case Ar.INTERNAL:case Ar.UNAVAILABLE:case Ar.UNAUTHENTICATED:return!1;case Ar.INVALID_ARGUMENT:case Ar.NOT_FOUND:case Ar.ALREADY_EXISTS:case Ar.PERMISSION_DENIED:case Ar.FAILED_PRECONDITION:case Ar.ABORTED:case Ar.OUT_OF_RANGE:case Ar.UNIMPLEMENTED:case Ar.DATA_LOSS:return!0;default:return _r()}}function ii(t){if(void 0===t)return br("GRPC error has no .code"),Ar.UNKNOWN;switch(t){case ei.OK:return Ar.OK;case ei.CANCELLED:return Ar.CANCELLED;case ei.UNKNOWN:return Ar.UNKNOWN;case ei.DEADLINE_EXCEEDED:return Ar.DEADLINE_EXCEEDED;case ei.RESOURCE_EXHAUSTED:return Ar.RESOURCE_EXHAUSTED;case ei.INTERNAL:return Ar.INTERNAL;case ei.UNAVAILABLE:return Ar.UNAVAILABLE;case ei.UNAUTHENTICATED:return Ar.UNAUTHENTICATED;case ei.INVALID_ARGUMENT:return Ar.INVALID_ARGUMENT;case ei.NOT_FOUND:return Ar.NOT_FOUND;case ei.ALREADY_EXISTS:return Ar.ALREADY_EXISTS;case ei.PERMISSION_DENIED:return Ar.PERMISSION_DENIED;case ei.FAILED_PRECONDITION:return Ar.FAILED_PRECONDITION;case ei.ABORTED:return Ar.ABORTED;case ei.OUT_OF_RANGE:return Ar.OUT_OF_RANGE;case ei.UNIMPLEMENTED:return Ar.UNIMPLEMENTED;case ei.DATA_LOSS:return Ar.DATA_LOSS;default:return _r()}}(ni=ei||(ei={}))[ni.OK=0]="OK",ni[ni.CANCELLED=1]="CANCELLED",ni[ni.UNKNOWN=2]="UNKNOWN",ni[ni.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ni[ni.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ni[ni.NOT_FOUND=5]="NOT_FOUND",ni[ni.ALREADY_EXISTS=6]="ALREADY_EXISTS",ni[ni.PERMISSION_DENIED=7]="PERMISSION_DENIED",ni[ni.UNAUTHENTICATED=16]="UNAUTHENTICATED",ni[ni.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ni[ni.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ni[ni.ABORTED=10]="ABORTED",ni[ni.OUT_OF_RANGE=11]="OUT_OF_RANGE",ni[ni.UNIMPLEMENTED=12]="UNIMPLEMENTED",ni[ni.INTERNAL=13]="INTERNAL",ni[ni.UNAVAILABLE=14]="UNAVAILABLE",ni[ni.DATA_LOSS=15]="DATA_LOSS";class si{constructor(t,e){this.N=t,this.root=e||ai.EMPTY}dt(t,e){return new si(this.N,this.root.dt(t,e,this.N).copy(null,null,ai.wt,null,null))}remove(t){return new si(this.N,this.root.remove(t,this.N).copy(null,null,ai.wt,null,null))}get(t){let e=this.root;for(;!e.L();){const n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.L();){const r=this.N(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}L(){return this.root.L()}get size(){return this.root.size}Et(){return this.root.Et()}Tt(){return this.root.Tt()}It(t){return this.root.It(t)}forEach(t){this.It((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.It((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}At(t){return this.root.At(t)}Rt(){return new oi(this.root,null,this.N,!1)}Pt(t){return new oi(this.root,t,this.N,!1)}gt(){return new oi(this.root,null,this.N,!0)}Vt(t){return new oi(this.root,t,this.N,!0)}}class oi{constructor(t,e,n,r){this.yt=r,this.bt=[];let i=1;for(;!t.L();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.yt?t.left:t.right;else{if(0===i){this.bt.push(t);break}this.bt.push(t),t=this.yt?t.right:t.left}}vt(){let t=this.bt.pop();const e={key:t.key,value:t.value};if(this.yt)for(t=t.left;!t.L();)this.bt.push(t),t=t.right;else for(t=t.right;!t.L();)this.bt.push(t),t=t.left;return e}St(){return this.bt.length>0}Dt(){if(0===this.bt.length)return null;const t=this.bt[this.bt.length-1];return{key:t.key,value:t.value}}}class ai{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ai.RED,this.left=null!=r?r:ai.EMPTY,this.right=null!=i?i:ai.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new ai(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}L(){return!1}It(t){return this.left.It(t)||t(this.key,this.value)||this.right.It(t)}At(t){return this.right.At(t)||t(this.key,this.value)||this.left.At(t)}min(){return this.left.L()?this:this.left.min()}Et(){return this.min().key}Tt(){return this.right.L()?this.key:this.right.Tt()}dt(t,e,n){let r=this;const i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.dt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.dt(t,e,n))).Ct()}Nt(){if(this.left.L())return ai.EMPTY;let t=this;return t.left.xt()||t.left.left.xt()||(t=t.Ot()),(t=t.copy(null,null,null,t.left.Nt(),null)).Ct()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.L()||r.left.xt()||r.left.left.xt()||(r=r.Ot()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.xt()&&(r=r.Ft()),r.right.L()||r.right.xt()||r.right.left.xt()||(r=r.Mt()),0===e(t,r.key)){if(r.right.L())return ai.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Nt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Ct()}xt(){return this.color}Ct(){let t=this;return t.right.xt()&&!t.left.xt()&&(t=t.$t()),t.left.xt()&&t.left.left.xt()&&(t=t.Ft()),t.left.xt()&&t.right.xt()&&(t=t.kt()),t}Ot(){let t=this.kt();return t.right.left.xt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Ft())).$t()).kt()),t}Mt(){let t=this.kt();return t.left.left.xt()&&(t=(t=t.Ft()).kt()),t}$t(){const t=this.copy(null,null,ai.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}Ft(){const t=this.copy(null,null,ai.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}kt(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Lt(){const t=this.qt();return Math.pow(2,t)<=this.size+1}qt(){if(this.xt()&&this.left.xt())throw _r();if(this.right.xt())throw _r();const t=this.left.qt();if(t!==this.right.qt())throw _r();return t+(this.xt()?0:1)}}ai.EMPTY=null,ai.RED=!0,ai.wt=!1,ai.EMPTY=new class{constructor(){this.size=0}get key(){throw _r()}get value(){throw _r()}get color(){throw _r()}get left(){throw _r()}get right(){throw _r()}copy(t,e,n,r,i){return this}dt(t,e,n){return new ai(t,e)}remove(t,e){return this}L(){return!0}It(t){return!1}At(t){return!1}Et(){return null}Tt(){return null}xt(){return!1}Lt(){return!0}qt(){return 0}};class ui{constructor(t){this.N=t,this.data=new si(this.N)}has(t){return null!==this.data.get(t)}first(){return this.data.Et()}last(){return this.data.Tt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.It((e,n)=>(t(e),!1))}Bt(t,e){const n=this.data.Pt(t[0]);for(;n.St();){const r=n.vt();if(this.N(r.key,t[1])>=0)return;e(r.key)}}Ut(t,e){let n;for(n=void 0!==e?this.data.Pt(e):this.data.Rt();n.St();)if(!t(n.vt().key))return}Kt(t){const e=this.data.Pt(t);return e.St()?e.vt().key:null}Rt(){return new ci(this.data.Rt())}Pt(t){return new ci(this.data.Pt(t))}add(t){return this.copy(this.data.remove(t).dt(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}L(){return this.data.L()}Qt(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof ui))return!1;if(this.size!==t.size)return!1;const e=this.data.Rt(),n=t.data.Rt();for(;e.St();){const t=e.vt().key,r=n.vt().key;if(0!==this.N(t,r))return!1}return!0}U(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new ui(this.N);return e.data=t,e}}class ci{constructor(t){this.Wt=t}vt(){return this.Wt.vt().key}St(){return this.Wt.St()}}const hi=new si(jr.N);function li(){return hi}function fi(){return li()}const di=new si(jr.N);function pi(){return di}const gi=new si(jr.N),mi=new ui(jr.N);function yi(...t){let e=mi;for(const n of t)e=e.add(n);return e}const wi=new ui(Rr);function vi(){return wi}class bi{constructor(t){this.N=t?(e,n)=>t(e,n)||jr.N(e.key,n.key):(t,e)=>jr.N(t.key,e.key),this.jt=pi(),this.Gt=new si(this.N)}static zt(t){return new bi(t.N)}has(t){return null!=this.jt.get(t)}get(t){return this.jt.get(t)}first(){return this.Gt.Et()}last(){return this.Gt.Tt()}L(){return this.Gt.L()}indexOf(t){const e=this.jt.get(t);return e?this.Gt.indexOf(e):-1}get size(){return this.Gt.size}forEach(t){this.Gt.It((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.jt.dt(t.key,t),e.Gt.dt(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.jt.remove(t),this.Gt.remove(e)):this}isEqual(t){if(!(t instanceof bi))return!1;if(this.size!==t.size)return!1;const e=this.Gt.Rt(),n=t.Gt.Rt();for(;e.St();){const t=e.vt().key,r=n.vt().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bi;return n.N=this.N,n.jt=t,n.Gt=e,n}}class Ei{constructor(){this.Ht=new si(jr.N)}track(t){const e=t.doc.key,n=this.Ht.get(e);n?0!==t.type&&3===n.type?this.Ht=this.Ht.dt(e,t):3===t.type&&1!==n.type?this.Ht=this.Ht.dt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ht=this.Ht.dt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ht=this.Ht.dt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ht=this.Ht.remove(e):1===t.type&&2===n.type?this.Ht=this.Ht.dt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ht=this.Ht.dt(e,{type:2,doc:t.doc}):_r():this.Ht=this.Ht.dt(e,t)}Jt(){const t=[];return this.Ht.It((e,n)=>{t.push(n)}),t}}class Ii{constructor(t,e,n,r,i,s,o,a){this.query=t,this.docs=e,this.Yt=n,this.docChanges=r,this.Xt=i,this.fromCache=s,this.Zt=o,this.te=a}static ee(t,e,n,r){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Ii(t,e,bi.zt(e),i,n,r,!0,!1)}get hasPendingWrites(){return!this.Xt.L()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Zt===t.Zt&&this.Xt.isEqual(t.Xt)&&Io(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Yt.isEqual(t.Yt)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class _i{constructor(t,e,n,r,i){this.ht=t,this.ne=e,this.se=n,this.ie=r,this.re=i}static oe(t,e){const n=new Map;return n.set(t,Ti.ce(t,e)),new _i(Vr.min(),n,vi(),li(),yi())}}class Ti{constructor(t,e,n,r,i){this.resumeToken=t,this.ae=e,this.ue=n,this.he=r,this.le=i}static ce(t,e){return new Ti(Jr.at,e,yi(),yi(),yi())}}class Ni{constructor(t,e,n,r){this._e=t,this.removedTargetIds=e,this.key=n,this.fe=r}}class Ai{constructor(t,e){this.targetId=t,this.de=e}}class Si{constructor(t,e,n=Jr.at,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Li{constructor(){this.we=0,this.Ee=Oi(),this.Te=Jr.at,this.Ie=!1,this.me=!0}get ae(){return this.Ie}get resumeToken(){return this.Te}get Ae(){return 0!==this.we}get Re(){return this.me}Pe(t){t.ct()>0&&(this.me=!0,this.Te=t)}ge(){let t=yi(),e=yi(),n=yi();return this.Ee.forEach((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:_r()}}),new Ti(this.Te,this.Ie,t,e,n)}Ve(){this.me=!1,this.Ee=Oi()}ye(t,e){this.me=!0,this.Ee=this.Ee.dt(t,e)}pe(t){this.me=!0,this.Ee=this.Ee.remove(t)}be(){this.we+=1}ve(){this.we-=1}Se(){this.me=!0,this.Ie=!0}}class xi{constructor(t){this.De=t,this.Ce=new Map,this.Ne=li(),this.xe=Di(),this.Oe=new ui(Rr)}Fe(t){for(const e of t._e)t.fe instanceof uo?this.Me(e,t.fe):t.fe instanceof co&&this.$e(e,t.key,t.fe);for(const e of t.removedTargetIds)this.$e(e,t.key,t.fe)}ke(t){this.Le(t,e=>{const n=this.qe(e);switch(t.state){case 0:this.Be(e)&&n.Pe(t.resumeToken);break;case 1:n.ve(),n.Ae||n.Ve(),n.Pe(t.resumeToken);break;case 2:n.ve(),n.Ae||this.removeTarget(e);break;case 3:this.Be(e)&&(n.Se(),n.Pe(t.resumeToken));break;case 4:this.Be(e)&&(this.Ue(e),n.Pe(t.resumeToken));break;default:_r()}})}Le(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ce.forEach((t,n)=>{this.Be(n)&&e(n)})}Ke(t){const e=t.targetId,n=t.de.count,r=this.Qe(e);if(r){const t=r.target;if(Qr(t))if(0===n){const n=new jr(t.path);this.$e(e,n,new co(n,Vr.min()))}else Tr(1===n);else this.We(e)!==n&&(this.Ue(e),this.Oe=this.Oe.add(e))}}je(t){const e=new Map;this.Ce.forEach((n,r)=>{const i=this.Qe(r);if(i){if(n.ae&&Qr(i.target)){const e=new jr(i.target.path);null!==this.Ne.get(e)||this.Ge(r,e)||this.$e(r,e,new co(e,t))}n.Re&&(e.set(r,n.ge()),n.Ve())}});let n=yi();this.xe.forEach((t,e)=>{let r=!0;e.Ut(t=>{const e=this.Qe(t);return!e||2===e.ut||(r=!1,!1)}),r&&(n=n.add(t))});const r=new _i(t,e,this.Oe,this.Ne,n);return this.Ne=li(),this.xe=Di(),this.Oe=new ui(Rr),r}Me(t,e){if(!this.Be(t))return;const n=this.Ge(t,e.key)?2:0;this.qe(t).ye(e.key,n),this.Ne=this.Ne.dt(e.key,e),this.xe=this.xe.dt(e.key,this.ze(e.key).add(t))}$e(t,e,n){if(!this.Be(t))return;const r=this.qe(t);this.Ge(t,e)?r.ye(e,1):r.pe(e),this.xe=this.xe.dt(e,this.ze(e).delete(t)),n&&(this.Ne=this.Ne.dt(e,n))}removeTarget(t){this.Ce.delete(t)}We(t){const e=this.qe(t).ge();return this.De.He(t).size+e.ue.size-e.le.size}be(t){this.qe(t).be()}qe(t){let e=this.Ce.get(t);return e||(e=new Li,this.Ce.set(t,e)),e}ze(t){let e=this.xe.get(t);return e||(e=new ui(Rr),this.xe=this.xe.dt(t,e)),e}Be(t){const e=null!==this.Qe(t);return e||vr("WatchChangeAggregator","Detected inactive target",t),e}Qe(t){const e=this.Ce.get(t);return e&&e.Ae?null:this.De.Je(t)}Ue(t){this.Ce.set(t,new Li),this.De.He(t).forEach(e=>{this.$e(t,e,null)})}Ge(t,e){return this.De.He(t).has(e)}}function Di(){return new si(jr.N)}function Oi(){return new si(jr.N)}function Ri(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ki(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ci(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vi(t){const e=Gi(t.mapValue.fields.__local_write_time__.timestampValue);return new Pr(e.seconds,e.nanos)}const Mi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ui(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Pi(t)?4:10:_r()}function Fi(t,e){const n=Ui(t);if(n!==Ui(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vi(t).isEqual(Vi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Gi(t.timestampValue),r=Gi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Hi(t.bytesValue).isEqual(Hi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zi(t.geoPointValue.latitude)===zi(e.geoPointValue.latitude)&&zi(t.geoPointValue.longitude)===zi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zi(t.integerValue)===zi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=zi(t.doubleValue),r=zi(e.doubleValue);return n===r?zr(n)===zr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return kr(t.arrayValue.values||[],e.arrayValue.values||[],Fi);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ri(n)!==Ri(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Fi(n[t],r[t])))return!1;return!0}(t,e);default:return _r()}}function qi(t,e){return void 0!==(t.values||[]).find(t=>Fi(t,e))}function ji(t,e){const n=Ui(t),r=Ui(e);if(n!==r)return Rr(n,r);switch(n){case 0:return 0;case 1:return Rr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=zi(t.integerValue||t.doubleValue),r=zi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return $i(t.timestampValue,e.timestampValue);case 4:return $i(Vi(t),Vi(e));case 5:return Rr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Hi(t),r=Hi(e);return n.v(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Rr(n[t],r[t]);if(0!==e)return e}return Rr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Rr(zi(t.latitude),zi(e.latitude));return 0!==n?n:Rr(zi(t.longitude),zi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=ji(n[t],r[t]);if(e)return e}return Rr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Rr(r[t],s[t]);if(0!==e)return e;const o=ji(n[r[t]],i[s[t]]);if(0!==o)return o}return Rr(r.length,s.length)}(t.mapValue,e.mapValue);default:throw _r()}}function $i(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rr(t,e);const n=Gi(t),r=Gi(e),i=Rr(n.seconds,r.seconds);return 0!==i?i:Rr(n.nanos,r.nanos)}function Bi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Gi(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Hi(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,jr.Z(r).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",r=!0;for(const i of e.values||[])r?r=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let r="{",i=!0;for(const s of n)i?i=!1:r+=",",r+=`${s}:${t(e.fields[s])}`;return r+"}"}(e.mapValue):_r();var n,r}(t)}function Gi(t){if(Tr(!!t),"string"==typeof t){let e=0;const n=Mi.exec(t);if(Tr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:zi(t.seconds),nanos:zi(t.nanos)}}function zi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Hi(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}function Ki(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.K()}`}}function Wi(t){return!!t&&"integerValue"in t}function Xi(t){return!!t&&"arrayValue"in t}function Yi(t){return!!t&&"nullValue"in t}function Qi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ji(t){return!!t&&"mapValue"in t}const Zi={asc:"ASCENDING",desc:"DESCENDING"},ts={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class es{constructor(t,e){this.st=t,this.Ye=e}}function ns(t){return{integerValue:""+t}}function rs(t,e){if(t.Ye){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zr(e)?"-0":e}}function is(t,e){return Hr(e)?ns(e):rs(t,e)}function ss(t,e){return t.Ye?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function os(t,e){return t.Ye?e.toBase64():e.toUint8Array()}function as(t){return Tr(!!t),Vr.p(function(t){const e=Gi(t);return new Pr(e.seconds,e.nanos)}(t))}function us(t,e){return function(t){return new Ur(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).K()}function cs(t){const e=Ur.W(t);return Tr(As(e)),e}function hs(t,e){return us(t.st,e.path)}function ls(t,e){const n=cs(e);return Tr(n.get(1)===t.st.projectId),Tr(!n.get(3)&&!t.st.database||n.get(3)===t.st.database),new jr(gs(n))}function fs(t,e){return us(t.st,e)}function ds(t){const e=cs(t);return 4===e.length?Ur.j():gs(e)}function ps(t){return new Ur(["projects",t.st.projectId,"databases",t.st.database]).K()}function gs(t){return Tr(t.length>4&&"documents"===t.get(4)),t.F(5)}function ms(t,e,n){return{name:hs(t,e),fields:n.proto.mapValue.fields}}function ys(t,e){let n;if(e instanceof Ys)n={update:ms(t,e.key,e.value)};else if(e instanceof no)n={delete:hs(t,e.key)};else if(e instanceof Qs)n={update:ms(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.K())),{fieldPaths:e}}(e.Xe)};else if(e instanceof Zs)n={transform:{document:hs(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Os)return{fieldPath:e.field.K(),setToServerValue:"REQUEST_TIME"};if(n instanceof Rs)return{fieldPath:e.field.K(),appendMissingElements:{values:n.elements}};if(n instanceof Cs)return{fieldPath:e.field.K(),removeAllFromArray:{values:n.elements}};if(n instanceof Vs)return{fieldPath:e.field.K(),increment:n.Ze};throw _r()})(0,t))}};else{if(!(e instanceof ro))return _r();n={verify:hs(t,e.key)}}return e.en.tn||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return ss(t,e.D())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_r()}(t,e.en)),n}function ws(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?$s.updateTime(as(t.updateTime)):void 0!==t.exists?$s.exists(t.exists):$s.nn()}(e.currentDocument):$s.nn();if(e.update){e.update.name;const r=ls(t,e.update.name),i=new io({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Fs(e.map(t=>qr.Y(t)))}(e.updateMask);return new Qs(r,i,t,n)}return new Ys(r,i,n)}if(e.delete){const r=ls(t,e.delete);return new no(r,n)}if(e.transform){const r=ls(t,e.transform.document),i=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)Tr("REQUEST_TIME"===e.setToServerValue),n=new Os;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Rs(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Cs(t)}else"increment"in e?n=new Vs(t,e.increment):_r();const r=qr.Y(e.fieldPath);return new qs(r,n)})(t,e));return Tr(!0===n.exists),new Zs(r,i)}if(e.verify){const r=ls(t,e.verify);return new ro(r,n)}return _r()}function vs(t,e){return{documents:[fs(t,e.path)]}}function bs(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=fs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fs(t,r.M()),n.structuredQuery.from=[{collectionId:r.k()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Qi(t.value))return{unaryFilter:{field:Ts(t.field),op:"IS_NAN"}};if(Yi(t.value))return{unaryFilter:{field:Ts(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Qi(t.value))return{unaryFilter:{field:Ts(t.field),op:"IS_NOT_NAN"}};if(Yi(t.value))return{unaryFilter:{field:Ts(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ts(t.field),op:function(t){return ts[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Ts(t.field),direction:function(t){return Zi[t]}(t.dir)}})(t))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(t,e){return t.Ye||Gr(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Is(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Is(e.endAt)),n}function Es(t){let e=ds(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Tr(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ns(t.unaryFilter.field);return So.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ns(t.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ns(t.unaryFilter.field);return So.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ns(t.unaryFilter.field);return So.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _r()}}(e)]:void 0!==e.fieldFilter?[function(t){return So.create(Ns(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _r()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):_r():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new qo(Ns(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Gr(e="object"==typeof t?t.value:t)?null:e}(n.limit));let u=null;n.startAt&&(u=_s(n.startAt));let c=null;return n.endAt&&(c=_s(n.endAt)),Eo(fo(e,i,o,s,a,"F",u,c))}function Is(t){return{before:t.before,values:t.position}}function _s(t){const e=!!t.before,n=t.values||[];return new Vo(n,e)}function Ts(t){return{fieldPath:t.K()}}function Ns(t){return qr.Y(t.fieldPath)}function As(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ss{constructor(){this.sn=void 0}}function Ls(t,e,n){return t instanceof Os?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Rs?ks(t,e):t instanceof Cs?Ps(t,e):function(t,e){const n=Ds(t,e),r=Ms(n)+Ms(t.Ze);return Wi(n)&&Wi(t.Ze)?ns(r):rs(t.serializer,r)}(t,e)}function xs(t,e,n){return t instanceof Rs?ks(t,e):t instanceof Cs?Ps(t,e):n}function Ds(t,e){return t instanceof Vs?Wi(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Os extends Ss{}class Rs extends Ss{constructor(t){super(),this.elements=t}}function ks(t,e){const n=Us(e);for(const e of t.elements)n.some(t=>Fi(t,e))||n.push(e);return{arrayValue:{values:n}}}class Cs extends Ss{constructor(t){super(),this.elements=t}}function Ps(t,e){let n=Us(e);for(const e of t.elements)n=n.filter(t=>!Fi(t,e));return{arrayValue:{values:n}}}class Vs extends Ss{constructor(t,e){super(),this.serializer=t,this.Ze=e}}function Ms(t){return zi(t.integerValue||t.doubleValue)}function Us(t){return Xi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Fs{constructor(t){this.fields=t,t.sort(qr.N)}rn(t){for(const e of this.fields)if(e.q(t))return!0;return!1}isEqual(t){return kr(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class qs{constructor(t,e){this.field=t,this.transform=e}}class js{constructor(t,e){this.version=t,this.transformResults=e}}class $s{constructor(t,e){this.updateTime=t,this.exists=e}static nn(){return new $s}static exists(t){return new $s(void 0,t)}static updateTime(t){return new $s(t)}get tn(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Bs(t,e){return void 0!==t.updateTime?e instanceof uo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof uo}class Gs{}function zs(t,e,n){return t instanceof Ys?function(t,e,n){return new uo(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Qs?function(t,e,n){if(!Bs(t.en,e))return new ho(t.key,n.version);const r=Js(t,e);return new uo(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Zs?function(t,e,n){if(Tr(null!=n.transformResults),!Bs(t.en,e))return new ho(t.key,n.version);const r=to(t,e),i=function(t,e,n){const r=[];Tr(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform;let a=null;e instanceof uo&&(a=e.field(s.field)),r.push(xs(o,a,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),s=n.version,o=eo(t,r.data(),i);return new uo(t.key,s,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new co(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Hs(t,e,n,r){return t instanceof Ys?function(t,e){if(!Bs(t.en,e))return e;const n=Xs(e);return new uo(t.key,n,t.value,{on:!0})}(t,e):t instanceof Qs?function(t,e){if(!Bs(t.en,e))return e;const n=Xs(e),r=Js(t,e);return new uo(t.key,n,r,{on:!0})}(t,e):t instanceof Zs?function(t,e,n,r){if(!Bs(t.en,e))return e;const i=to(t,e),s=function(t,e,n,r){const i=[];for(const s of t){const t=s.transform;let o=null;n instanceof uo&&(o=n.field(s.field)),null===o&&r instanceof uo&&(o=r.field(s.field)),i.push(Ls(t,o,e))}return i}(t.fieldTransforms,n,e,r),o=eo(t,i.data(),s);return new uo(t.key,i.version,o,{on:!0})}(t,e,r,n):function(t,e){return Bs(t.en,e)?new co(t.key,Vr.min()):e}(t,e)}function Ks(t,e){return t instanceof Zs?function(t,e){let n=null;for(const r of t.fieldTransforms){const t=e instanceof uo?e.field(r.field):void 0,i=Ds(r.transform,t||null);null!=i&&(n=null==n?(new so).set(r.field,i):n.set(r.field,i))}return n?n.cn():null}(t,e):null}function Ws(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.en.isEqual(e.en)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Xe.isEqual(e.Xe):2!==t.type||kr(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Rs&&e instanceof Rs||t instanceof Cs&&e instanceof Cs?kr(t.elements,e.elements,Fi):t instanceof Vs&&e instanceof Vs?Fi(t.Ze,e.Ze):t instanceof Os&&e instanceof Os}(t.transform,e.transform)})(t,e)))}function Xs(t){return t instanceof uo?t.version:Vr.min()}class Ys extends Gs{constructor(t,e,n){super(),this.key=t,this.value=e,this.en=n,this.type=0}}class Qs extends Gs{constructor(t,e,n,r){super(),this.key=t,this.data=e,this.Xe=n,this.en=r,this.type=1}}function Js(t,e){let n;return function(t,e){const n=new so(e);return t.Xe.fields.forEach(e=>{if(!e.L()){const r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}}),n.cn()}(t,n=e instanceof uo?e.data():io.empty())}class Zs extends Gs{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.en=$s.exists(!0)}}function to(t,e){return e}function eo(t,e,n){const r=new so(e);for(let e=0;e<t.fieldTransforms.length;e++){const i=t.fieldTransforms[e];r.set(i.field,n[e])}return r.cn()}class no extends Gs{constructor(t,e){super(),this.key=t,this.en=e,this.type=3}}class ro extends Gs{constructor(t,e){super(),this.key=t,this.en=e,this.type=4}}class io{constructor(t){this.proto=t}static empty(){return new io({mapValue:{}})}field(t){if(t.L())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ji(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.k()])||null}}isEqual(t){return Fi(this.proto,t.proto)}}class so{constructor(t=io.empty()){this.an=t,this.un=new Map}set(t,e){return this.hn(t,e),this}delete(t){return this.hn(t,null),this}hn(t,e){let n=this.un;for(let e=0;e<t.length-1;++e){const r=t.get(e);let i=n.get(r);i instanceof Map?n=i:i&&10===Ui(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(r,i),n=i):(i=new Map,n.set(r,i),n=i)}n.set(t.k(),e)}cn(){const t=this.ln(qr.j(),this.un);return null!=t?new io(t):this.an}ln(t,e){let n=!1;const r=this.an.field(t),i=Ji(r)?Object.assign({},r.mapValue.fields):{};return e.forEach((e,r)=>{if(e instanceof Map){const s=this.ln(t.child(r),e);null!=s&&(i[r]=s,n=!0)}else null!==e?(i[r]=e,n=!0):i.hasOwnProperty(r)&&(delete i[r],n=!0)}),n?{mapValue:{fields:i}}:null}}function oo(t){const e=[];return ki(t.fields||{},(t,n)=>{const r=new qr([t]);if(Ji(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)}),new Fs(e)}class ao{constructor(t,e){this.key=t,this.version=e}}class uo extends ao{constructor(t,e,n,r){super(t,e),this._n=n,this.on=!!r.on,this.hasCommittedMutations=!!r.hasCommittedMutations}field(t){return this._n.field(t)}data(){return this._n}fn(){return this._n.proto}isEqual(t){return t instanceof uo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.on===t.on&&this.hasCommittedMutations===t.hasCommittedMutations&&this._n.isEqual(t._n)}toString(){return`Document(${this.key}, ${this.version}, ${this._n.toString()}, {hasLocalMutations: ${this.on}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.on||this.hasCommittedMutations}}class co extends ao{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof co&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class ho extends ao{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof ho&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class lo{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.dn=n,this.filters=r,this.limit=i,this.wn=s,this.startAt=o,this.endAt=a,this.En=null,this.Tn=null,this.startAt,this.endAt}}function fo(t,e,n,r,i,s,o,a){return new lo(t,e,n,r,i,s,o,a)}function po(t){return new lo(t)}function go(t){return!Gr(t.limit)&&"F"===t.wn}function mo(t){return!Gr(t.limit)&&"L"===t.wn}function yo(t){return t.dn.length>0?t.dn[0].field:null}function wo(t){for(const e of t.filters)if(e.In())return e.field;return null}function vo(t){return null!==t.collectionGroup}function bo(t){const e=Nr(t);if(null===e.En){e.En=[];const t=wo(e),n=yo(e);if(null!==t&&null===n)t.H()||e.En.push(new qo(t)),e.En.push(new qo(qr.J(),"asc"));else{let t=!1;for(const n of e.dn)e.En.push(n),n.field.H()&&(t=!0);if(!t){const t=e.dn.length>0?e.dn[e.dn.length-1].dir:"asc";e.En.push(new qo(qr.J(),t))}}}return e.En}function Eo(t){const e=Nr(t);if(!e.Tn)if("F"===e.wn)e.Tn=Wr(e.path,e.collectionGroup,bo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of bo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new qo(n.field,e))}const n=e.endAt?new Vo(e.endAt.position,!e.endAt.before):null,r=e.startAt?new Vo(e.startAt.position,!e.startAt.before):null;e.Tn=Wr(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.Tn}function Io(t,e){return Yr(Eo(t),Eo(e))&&t.wn===e.wn}function _o(t){return`${Xr(Eo(t))}|lt:${t.wn}`}function To(t){return`Query(target=${function(t){let e=t.path.K();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.K()} ${e.op} ${Bi(e.value)}`;var e}).join(", ")}]`),Gr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.K()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Mo(t.startAt)),t.endAt&&(e+=", endAt: "+Mo(t.endAt)),`Target(${e})`}(Eo(t))}; limitType=${t.wn})`}function No(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.tt(t.collectionGroup)&&t.path.q(n):jr.et(t.path)?t.path.isEqual(n):t.path.B(n)}(t,e)&&function(t,e){for(const n of t.dn)if(!n.field.H()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Uo(t.startAt,bo(t),e))&&(!t.endAt||!Uo(t.endAt,bo(t),e))}(t,e)}function Ao(t){return(e,n)=>{let r=!1;for(const i of bo(t)){const t=jo(i,e,n);if(0!==t)return t;r=r||i.field.H()}return 0}}class So extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.H())return"in"===e||"not-in"===e?this.mn(t,e,n):new Lo(t,e,n);if(Yi(n)){if("=="!==e&&"!="!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new So(t,e,n)}if(Qi(n)){if("=="!==e&&"!="!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new So(t,e,n)}return"array-contains"===e?new Ro(t,n):"in"===e?new ko(t,n):"not-in"===e?new Co(t,n):"array-contains-any"===e?new Po(t,n):new So(t,e,n)}static mn(t,e,n){return"in"===e?new xo(t,n):new Do(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.An(ji(e,this.value)):null!==e&&Ui(this.value)===Ui(e)&&this.An(ji(e,this.value))}An(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _r()}}In(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Lo extends So{constructor(t,e,n){super(t,e,n),this.key=jr.Z(n.referenceValue)}matches(t){const e=jr.N(t.key,this.key);return this.An(e)}}class xo extends So{constructor(t,e){super(t,"in",e),this.keys=Oo("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Do extends So{constructor(t,e){super(t,"not-in",e),this.keys=Oo("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Oo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>jr.Z(t.referenceValue))}class Ro extends So{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Xi(e)&&qi(e.arrayValue,this.value)}}class ko extends So{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&qi(this.value.arrayValue,e)}}class Co extends So{constructor(t,e){super(t,"not-in",e)}matches(t){if(qi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!qi(this.value.arrayValue,e)}}class Po extends So{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Xi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>qi(this.value.arrayValue,t))}}class Vo{constructor(t,e){this.position=t,this.before=e}}function Mo(t){return`${t.before?"b":"a"}:${t.position.map(t=>Bi(t)).join(",")}`}function Uo(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.H()?jr.N(jr.Z(o.referenceValue),n.key):ji(o,n.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Fo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Fi(t.position[n],e.position[n]))return!1;return!0}class qo{constructor(t,e="asc"){this.field=t,this.dir=e}}function jo(t,e,n){const r=t.field.H()?jr.N(e.key,n.key):function(t,e,n){const r=e.field(t),i=n.field(t);return null!==r&&null!==i?ji(r,i):_r()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return _r()}}function $o(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Bo{constructor(t,e,n,r){this.batchId=t,this.Rn=e,this.baseMutations=n,this.mutations=r}Pn(t,e,n){const r=n.gn;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=zs(i,e,r[n]))}return e}Vn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Hs(n,e,e,this.Rn));const n=e;for(const r of this.mutations)r.key.isEqual(t)&&(e=Hs(r,e,n,this.Rn));return e}yn(t){let e=t;return this.mutations.forEach(n=>{const r=this.Vn(n.key,t.get(n.key));r&&(e=e.dt(n.key,r))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),yi())}isEqual(t){return this.batchId===t.batchId&&kr(this.mutations,t.mutations,(t,e)=>Ws(t,e))&&kr(this.baseMutations,t.baseMutations,(t,e)=>Ws(t,e))}}class Go{constructor(t,e,n,r){this.batch=t,this.pn=e,this.gn=n,this.bn=r}static from(t,e,n){Tr(t.mutations.length===n.length);let r=gi;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.dt(i[t].key,n[t].version);return new Go(t,e,n,r)}}class zo{constructor(t,e){this.vn=t,this.Sn=e,this.Dn={}}get(t){const e=this.vn(t),n=this.Dn[e];if(void 0!==n)for(const[e,r]of n)if(this.Sn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.vn(t),r=this.Dn[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.Sn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.Dn[n]=[[t,e]]}delete(t){const e=this.vn(t),n=this.Dn[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.Sn(n[r][0],t))return 1===n.length?delete this.Dn[e]:n.splice(r,1),!0;return!1}forEach(t){ki(this.Dn,(e,n)=>{for(const[e,r]of n)t(e,r)})}L(){return Ci(this.Dn)}}class Ho{constructor(t){this.Cn=null,this.Nn=null,this.result=void 0,this.error=void 0,this.xn=!1,this.On=!1,t(t=>{this.xn=!0,this.result=t,this.Cn&&this.Cn(t)},t=>{this.xn=!0,this.error=t,this.Nn&&this.Nn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.On&&_r(),this.On=!0,this.xn?this.error?this.Fn(e,this.error):this.Mn(t,this.result):new Ho((n,r)=>{this.Cn=(e=>{this.Mn(t,e).next(n,r)}),this.Nn=(t=>{this.Fn(e,t).next(n,r)})})}$n(){return new Promise((t,e)=>{this.next(t,e)})}kn(t){try{const e=t();return e instanceof Ho?e:Ho.resolve(e)}catch(t){return Ho.reject(t)}}Mn(t,e){return t?this.kn(()=>t(e)):Ho.resolve(e)}Fn(t,e){return t?this.kn(()=>t(e)):Ho.reject(e)}static resolve(t){return new Ho((e,n)=>{e(t)})}static reject(t){return new Ho((e,n)=>{n(t)})}static Ln(t){return new Ho((e,n)=>{let r=0,i=0,s=!1;t.forEach(t=>{++r,t.next(()=>{++i,s&&i===r&&e()},t=>n(t))}),s=!0,i===r&&e()})}static qn(t){let e=Ho.resolve(!1);for(const n of t)e=e.next(t=>t?Ho.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.Ln(n)}}class Ko{constructor(){this.Bn=new zo(t=>t.toString(),(t,e)=>t.isEqual(e)),this.Un=!1}set readTime(t){this.Kn=t}get readTime(){return this.Kn}Qn(t,e){this.Wn(),this.readTime=e,this.Bn.set(t.key,t)}jn(t,e){this.Wn(),e&&(this.readTime=e),this.Bn.set(t,null)}Gn(t,e){this.Wn();const n=this.Bn.get(e);return void 0!==n?Ho.resolve(n):this.zn(t,e)}getEntries(t,e){return this.Hn(t,e)}apply(t){return this.Wn(),this.Un=!0,this.Jn(t)}Wn(){}}const Wo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Xo{constructor(){this.Yn=[]}Xn(t){this.Yn.push(t)}Zn(){this.Yn.forEach(t=>t())}}class Yo{constructor(t,e,n){this.ts=t,this.es=e,this.ns=n}ss(t,e){return this.es.rs(t,e).next(n=>this.os(t,e,n))}os(t,e,n){return this.ts.Gn(t,e).next(t=>{for(const r of n)t=r.Vn(e,t);return t})}cs(t,e,n){let r=fi();return e.forEach((t,e)=>{for(const r of n)e=r.Vn(t,e);r=r.dt(t,e)}),r}us(t,e){return this.ts.getEntries(t,e).next(e=>this.hs(t,e))}hs(t,e){return this.es.ls(t,e).next(n=>{const r=this.cs(t,e,n);let i=li();return r.forEach((t,e)=>{e||(e=new co(t,Vr.min())),i=i.dt(t,e)}),i})}_s(t,e,n){return function(t){return jr.et(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.fs(t,e.path):vo(e)?this.ds(t,e,n):this.ws(t,e,n)}fs(t,e){return this.ss(t,new jr(e)).next(t=>{let e=pi();return t instanceof uo&&(e=e.dt(t.key,t)),e})}ds(t,e,n){const r=e.collectionGroup;let i=pi();return this.ns.Es(t,r).next(s=>Ho.forEach(s,s=>{const o=function(t,e){return new lo(e,null,t.dn.slice(),t.filters.slice(),t.limit,t.wn,t.startAt,t.endAt)}(e,s.child(r));return this.ws(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.dt(t,e)})})}).next(()=>i))}ws(t,e,n){let r,i;return this.ts._s(t,e,n).next(n=>(r=n,this.es.Ts(t,e))).next(e=>(i=e,this.Is(t,i,r).next(t=>{r=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=r.get(n),s=Hs(e,i,i,t.Rn);r=s instanceof uo?r.dt(n,s):r.remove(n)}}))).next(()=>(r.forEach((t,n)=>{No(e,n)||(r=r.remove(t))}),r))}Is(t,e,n){let r=yi();for(const t of e)for(const e of t.mutations)e instanceof Qs&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.ts.getEntries(t,r).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof uo&&(i=i.dt(t,e))}),i))}}class Qo{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.As=n,this.Rs=r}static Ps(t,e){let n=yi(),r=yi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Qo(t,e.fromCache,n,r)}}class Jo{constructor(t,e){this.previousValue=t,e&&(e.gs=(t=>this.Vs(t)),this.ys=(t=>e.ps(t)))}Vs(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ys&&this.ys(t),t}}Jo.bs=-1;class Zo{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ta{constructor(t,e,n=1e3,r=1.5,i=6e4){this.vs=t,this.Ss=e,this.Ds=n,this.Cs=r,this.Ns=i,this.xs=0,this.Os=null,this.Fs=Date.now(),this.reset()}reset(){this.xs=0}Ms(){this.xs=this.Ns}$s(t){this.cancel();const e=Math.floor(this.xs+this.ks()),n=Math.max(0,Date.now()-this.Fs),r=Math.max(0,e-n);r>0&&vr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.xs} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Os=this.vs.Ls(this.Ss,r,()=>(this.Fs=Date.now(),t())),this.xs*=this.Cs,this.xs<this.Ds&&(this.xs=this.Ds),this.xs>this.Ns&&(this.xs=this.Ns)}qs(){null!==this.Os&&(this.Os.Bs(),this.Os=null)}cancel(){null!==this.Os&&(this.Os.cancel(),this.Os=null)}ks(){return(Math.random()-.5)*this.xs}}class ea{constructor(t,e,n){this.name=t,this.version=e,this.Us=n,12.2===ea.Ks(r())&&br("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return vr("SimpleDb","Removing database:",t),aa(window.indexedDB.deleteDatabase(t)).$n()}static Qs(){if("undefined"==typeof indexedDB)return!1;if(ea.Ws())return!0;const t=r(),e=ea.Ks(t),n=0<e&&e<10,i=ea.js(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static Ws(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Gs)}static zs(t,e){return t.store(e)}static Ks(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static js(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Hs(){return this.db||(vr("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,e)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=(e=>{const n=e.target.result;t(n)}),n.onblocked=(()=>{e(new ra("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),n.onerror=(t=>{const n=t.target.error;"VersionError"===n.name?e(new Sr(Ar.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):e(new ra(n))}),n.onupgradeneeded=(t=>{vr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Us.createOrUpgrade(e,n.transaction,t.oldVersion,this.version).next(()=>{vr("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Js&&(this.db.onversionchange=(t=>this.Js(t))),this.db}Ys(t){this.Js=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n){const r="readonly"===t;for(;;){0;try{this.db=await this.Hs();const i=sa.open(this.db,r?"readonly":"readwrite",e),s=n(i).catch(t=>(i.abort(t),Ho.reject(t))).$n();return s.catch(()=>{}),await i.Xs,s}catch(t){const e="FirebaseError"!==t.name&&s<3;if(vr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class na{constructor(t){this.Zs=t,this.ti=!1,this.ei=null}get xn(){return this.ti}get ni(){return this.ei}set cursor(t){this.Zs=t}done(){this.ti=!0}si(t){this.ei=t}delete(){return aa(this.Zs.delete())}}class ra extends Sr{constructor(t){super(Ar.UNAVAILABLE,"IndexedDB transaction failed: "+t),this.name="IndexedDbTransactionError"}}function ia(t){return"IndexedDbTransactionError"===t.name}class sa{constructor(t){this.transaction=t,this.aborted=!1,this.ii=new Zo,this.transaction.oncomplete=(()=>{this.ii.resolve()}),this.transaction.onabort=(()=>{t.error?this.ii.reject(new ra(t.error)):this.ii.resolve()}),this.transaction.onerror=(t=>{const e=ca(t.target.error);this.ii.reject(new ra(e))})}static open(t,e,n){try{return new sa(t.transaction(n,e))}catch(t){throw new ra(t)}}get Xs(){return this.ii.promise}abort(t){t&&this.ii.reject(t),this.aborted||(vr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new oa(e)}}class oa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(vr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(vr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),aa(n)}add(t){return vr("SimpleDb","ADD",this.store.name,t,t),aa(this.store.add(t))}get(t){return aa(this.store.get(t)).next(e=>(void 0===e&&(e=null),vr("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return vr("SimpleDb","DELETE",this.store.name,t),aa(this.store.delete(t))}count(){return vr("SimpleDb","COUNT",this.store.name),aa(this.store.count())}ri(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.oi(n,(t,e)=>{r.push(e)}).next(()=>r)}ci(t,e){vr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.ai=!1;const r=this.cursor(n);return this.oi(r,(t,e,n)=>n.delete())}ui(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.oi(r,e)}hi(t){const e=this.cursor({});return new Ho((n,r)=>{e.onerror=(t=>{const e=ca(t.target.error);r(e)}),e.onsuccess=(e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next(t=>{t?r.continue():n()}):n()})})}oi(t,e){const n=[];return new Ho((r,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void r();const s=new na(i),o=e(i.primaryKey,i.value,s);if(o instanceof Ho){const t=o.catch(t=>(s.done(),Ho.reject(t)));n.push(t)}s.xn?r():null===s.ni?i.continue():i.continue(s.ni)})}).next(()=>Ho.Ln(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.ai?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function aa(t){return new Ho((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=ca(t.target.error);n(e)})})}let ua=!1;function ca(t){const e=ea.Ks(r());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Sr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ua||(ua=!0,setTimeout(()=>{throw t},0)),t}}return t}function ha(){return"undefined"!=typeof window?window:null}function la(){return"undefined"!=typeof document?document:null}class fa{constructor(t,e,n,r,i){this.li=t,this.Ss=e,this._i=n,this.op=r,this.fi=i,this.di=new Zo,this.then=this.di.promise.then.bind(this.di.promise),this.di.promise.catch(t=>{})}static wi(t,e,n,r,i){const s=Date.now()+n,o=new fa(t,e,s,r,i);return o.start(n),o}start(t){this.Ei=setTimeout(()=>this.Ti(),t)}Bs(){return this.Ti()}cancel(t){null!==this.Ei&&(this.clearTimeout(),this.di.reject(new Sr(Ar.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Ti(){this.li.Ii(()=>null!==this.Ei?(this.clearTimeout(),this.op().then(t=>this.di.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Ei&&(this.fi(this),clearTimeout(this.Ei),this.Ei=null)}}class da{constructor(){this.mi=Promise.resolve(),this.Ai=[],this.Ri=!1,this.Pi=[],this.gi=null,this.Vi=!1,this.yi=[],this.pi=new ta(this,"async_queue_retry"),this.bi=(()=>{const t=la();t&&vr("AsyncQueue","Visibility state changed to  ",t.visibilityState),this.pi.qs()});const t=la();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bi)}get vi(){return this.Ri}Ii(t){this.enqueue(t)}Si(t){this.Di(),this.Ci(t)}Ni(){if(!this.Ri){this.Ri=!0;const t=la();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bi)}}enqueue(t){return this.Di(),this.Ri?new Promise(t=>{}):this.Ci(t)}xi(t){this.Ai.push(t),this.Ii(()=>this.Oi())}async Oi(){if(0!==this.Ai.length){try{await this.Ai[0](),this.Ai.shift(),this.pi.reset()}catch(t){if(!ia(t))throw t;vr("AsyncQueue","Operation failed with retryable error: "+t)}this.Ai.length>0&&this.pi.$s(()=>this.Oi())}}Ci(t){const e=this.mi.then(()=>(this.Vi=!0,t().catch(t=>{throw this.gi=t,this.Vi=!1,br("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.Vi=!1,t))));return this.mi=e,e}Ls(t,e,n){this.Di(),this.yi.indexOf(t)>-1&&(e=0);const r=fa.wi(this,t,e,n,t=>this.Fi(t));return this.Pi.push(r),r}Di(){this.gi&&_r()}Mi(){}async $i(){let t;do{t=this.mi,await t}while(t!==this.mi)}ki(t){for(const e of this.Pi)if(e.Ss===t)return!0;return!1}Li(t){return this.$i().then(()=>{this.Pi.sort((t,e)=>t._i-e._i);for(const e of this.Pi)if(e.Bs(),"all"!==t&&e.Ss===t)break;return this.$i()})}qi(t){this.yi.push(t)}Fi(t){const e=this.Pi.indexOf(t);this.Pi.splice(e,1)}}function pa(t,e){if(br("AsyncQueue",`${e}: ${t}`),ia(t))return new Sr(Ar.UNAVAILABLE,`${e}: ${t}`);throw t}function ga([t,e],[n,r]){const i=Rr(t,n);return 0===i?Rr(e,r):i}class ma{constructor(t){this.Bi=t,this.buffer=new ui(ga),this.Ui=0}Ki(){return++this.Ui}Qi(t){const e=[t,this.Ki()];if(this.buffer.size<this.Bi)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();ga(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const ya={Wi:!1,ji:0,Gi:0,zi:0};class wa{constructor(t,e,n){this.Hi=t,this.Ji=e,this.Yi=n}static Xi(t){return new wa(t,wa.Zi,wa.tr)}}wa.er=-1,wa.nr=1048576,wa.sr=41943040,wa.Zi=10,wa.tr=1e3,wa.ir=new wa(wa.sr,wa.Zi,wa.tr),wa.rr=new wa(wa.er,0,0);class va{constructor(t,e){this.cr=t,this.li=e,this.ar=!1,this.ur=null}start(t){this.cr.params.Hi!==wa.er&&this.hr(t)}stop(){this.ur&&(this.ur.cancel(),this.ur=null)}get lr(){return null!==this.ur}hr(t){const e=this.ar?3e5:6e4;vr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ur=this.li.Ls("lru_garbage_collection",e,async()=>{this.ur=null,this.ar=!0;try{await t._r(this.cr)}catch(t){ia(t)?vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Pu(t)}await this.hr(t)})}}class ba{constructor(t,e){this.dr=t,this.params=e}wr(t,e){return this.dr.Er(t).next(t=>Math.floor(e/100*t))}Tr(t,e){if(0===e)return Ho.resolve(Jo.bs);const n=new ma(e);return this.dr.Le(t,t=>n.Qi(t.sequenceNumber)).next(()=>this.dr.Ir(t,t=>n.Qi(t))).next(()=>n.maxValue)}mr(t,e,n){return this.dr.mr(t,e,n)}Ar(t,e){return this.dr.Ar(t,e)}Rr(t,e){return this.params.Hi===wa.er?(vr("LruGarbageCollector","Garbage collection skipped; disabled"),Ho.resolve(ya)):this.Pr(t).next(n=>n<this.params.Hi?(vr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Hi),ya):this.gr(t,e))}Pr(t){return this.dr.Pr(t)}gr(e,n){let r,i,s,o,a,u,c;const h=Date.now();return this.wr(e,this.params.Ji).next(t=>(t>this.params.Yi?(vr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.Yi} from `+t),i=this.params.Yi):i=t,o=Date.now(),this.Tr(e,i))).next(t=>(r=t,a=Date.now(),this.mr(e,r,n))).next(t=>(s=t,u=Date.now(),this.Ar(e,r))).next(e=>(c=Date.now(),wr()<=t.LogLevel.DEBUG&&vr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-h}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(u-a)+"ms\n"+`\tRemoved ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),Ho.resolve({Wi:!0,ji:i,Gi:s,zi:e})))}}function Ea(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=_a(e)),e=Ia(t.get(n),e);return _a(e)}function Ia(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function _a(t){return t+""}function Ta(t){const e=t.length;if(Tr(e>=2),2===e)return Tr(""===t.charAt(0)&&""===t.charAt(1)),Ur.j();const n=e-2,r=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>s)&&_r(),t.charAt(e+1)){case"":const s=t.substring(n,e);let o;0===i.length?o=s:(o=i+=s,i=""),r.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:_r()}n=e+2}return new Ur(r)}class Na{constructor(t){this.Vr=t}}function Aa(t,e){if(e.document)return function(t,e,n){const r=ls(t,e.name),i=as(e.updateTime),s=new io({mapValue:{fields:e.fields}});return new uo(r,i,s,{hasCommittedMutations:!!n})}(t.Vr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=jr.nt(e.noDocument.path),n=Oa(e.noDocument.readTime);return new co(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=jr.nt(e.unknownDocument.path),n=Oa(e.unknownDocument.version);return new ho(t,n)}return _r()}function Sa(t,e,n){const r=La(n),i=e.key.path.M().U();if(e instanceof uo){const n=function(t,e){return{name:hs(t,e.key),fields:e.fn().mapValue.fields,updateTime:ss(t,e.version.D())}}(t.Vr,e),s=e.hasCommittedMutations;return new nu(null,null,n,s,r,i)}if(e instanceof co){const t=e.key.path.U(),n=Da(e.version),s=e.hasCommittedMutations;return new nu(null,new tu(t,n),null,s,r,i)}if(e instanceof ho){const t=e.key.path.U(),n=Da(e.version);return new nu(new eu(t,n),null,null,!0,r,i)}return _r()}function La(t){const e=t.D();return[e.seconds,e.nanoseconds]}function xa(t){const e=new Pr(t[0],t[1]);return Vr.p(e)}function Da(t){const e=t.D();return new Xa(e.seconds,e.nanoseconds)}function Oa(t){const e=new Pr(t.seconds,t.nanoseconds);return Vr.p(e)}function Ra(t,e){const n=(e.baseMutations||[]).map(e=>ws(t.Vr,e)),r=e.mutations.map(e=>ws(t.Vr,e)),i=Pr.fromMillis(e.localWriteTimeMs);return new Bo(e.batchId,i,n,r)}function ka(t){const e=Oa(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Oa(t.lastLimboFreeSnapshotVersion):Vr.min();let r;var i;return void 0!==t.query.documents?(Tr(1===(i=t.query).documents.length),r=Eo(po(ds(i.documents[0])))):r=Es(t.query),new Zr(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Jr.fromBase64String(t.resumeToken))}function Ca(t,e){const n=Da(e.ht),r=Da(e.lastLimboFreeSnapshotVersion);let i;i=Qr(e.target)?vs(t.Vr,e.target):bs(t.Vr,e.target);const s=e.resumeToken.toBase64();return new iu(e.targetId,Xr(e.target),n,s,e.sequenceNumber,r,i)}class Pa{constructor(t,e,n,r){this.userId=t,this.serializer=e,this.ns=n,this.yr=r,this.pr={}}static br(t,e,n,r){Tr(""!==t.uid);const i=t.t()?t.uid:"";return new Pa(i,e,n,r)}vr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ua(t).ui({index:Ja.userMutationsIndex,range:n},(t,n,r)=>{e=!1,r.done()}).next(()=>e)}Sr(t,e,n,r){const i=Fa(t),s=Ua(t);return s.add({}).next(o=>{Tr("number"==typeof o);const a=new Bo(o,e,n,r),u=function(t,e,n){const r=n.baseMutations.map(e=>ys(t.Vr,e)),i=n.mutations.map(e=>ys(t.Vr,e));return new Ja(e,n.batchId,n.Rn.toMillis(),r,i)}(this.serializer,this.userId,a),c=[];let h=new ui((t,e)=>Rr(t.K(),e.K()));for(const t of r){const e=Za.key(this.userId,t.key.path,o);h=h.add(t.key.path.M()),c.push(s.put(u)),c.push(i.put(e,Za.PLACEHOLDER))}return h.forEach(e=>{c.push(this.ns.Dr(t,e))}),t.Xn(()=>{this.pr[o]=a.keys()}),Ho.Ln(c).next(()=>a)})}Cr(t,e){return Ua(t).get(e).next(t=>t?(Tr(t.userId===this.userId),Ra(this.serializer,t)):null)}Nr(t,e){return this.pr[e]?Ho.resolve(this.pr[e]):this.Cr(t,e).next(t=>{if(t){const n=t.keys();return this.pr[e]=n,n}return null})}Or(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ua(t).ui({index:Ja.userMutationsIndex,range:r},(t,e,r)=>{e.userId===this.userId&&(Tr(e.batchId>=n),i=Ra(this.serializer,e)),r.done()}).next(()=>i)}Fr(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ua(t).ui({index:Ja.userMutationsIndex,range:e,reverse:!0},(t,e,r)=>{n=e.batchId,r.done()}).next(()=>n)}Mr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ua(t).ri(Ja.userMutationsIndex,e).next(t=>t.map(t=>Ra(this.serializer,t)))}rs(t,e){const n=Za.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),i=[];return Fa(t).ui({range:r},(n,r,s)=>{const[o,a,u]=n,c=Ta(a);if(o===this.userId&&e.path.isEqual(c))return Ua(t).get(u).next(t=>{if(!t)throw _r();Tr(t.userId===this.userId),i.push(Ra(this.serializer,t))});s.done()}).next(()=>i)}ls(t,e){let n=new ui(Rr);const r=[];return e.forEach(e=>{const i=Za.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(i),o=Fa(t).ui({range:s},(t,r,i)=>{const[s,o,a]=t,u=Ta(o);s===this.userId&&e.path.isEqual(u)?n=n.add(a):i.done()});r.push(o)}),Ho.Ln(r).next(()=>this.$r(t,n))}Ts(t,e){const n=e.path,r=n.length+1,i=Za.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new ui(Rr);return Fa(t).ui({range:s},(t,e,i)=>{const[s,a,u]=t,c=Ta(a);s===this.userId&&n.q(c)?c.length===r&&(o=o.add(u)):i.done()}).next(()=>this.$r(t,o))}$r(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Ua(t).get(e).next(t=>{if(null===t)throw _r();Tr(t.userId===this.userId),n.push(Ra(this.serializer,t))}))}),Ho.Ln(r).next(()=>n)}kr(t,e){return Ma(t.Lr,this.userId,e).next(n=>(t.Xn(()=>{this.qr(e.batchId)}),Ho.forEach(n,e=>this.yr.Br(t,e))))}qr(t){delete this.pr[t]}Ur(t){return this.vr(t).next(e=>{if(!e)return Ho.resolve();const n=IDBKeyRange.lowerBound(Za.prefixForUser(this.userId)),r=[];return Fa(t).ui({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=Ta(t[1]);r.push(e)}else n.done()}).next(()=>{Tr(0===r.length)})})}Kr(t,e){return Va(t,this.userId,e)}Qr(t){return qa(t).get(this.userId).next(t=>t||new Qa(this.userId,-1,""))}}function Va(t,e,n){const r=Za.prefixForPath(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Fa(t).ui({range:s,ai:!0},(t,n,r)=>{const[s,a,u]=t;s===e&&a===i&&(o=!0),r.done()}).next(()=>o)}function Ma(t,e,n){const r=t.store(Ja.store),i=t.store(Za.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=r.ui({range:o},(t,e,n)=>(a++,n.delete()));s.push(u.next(()=>{Tr(1===a)}));const c=[];for(const t of n.mutations){const r=Za.key(e,t.key.path,n.batchId);s.push(i.delete(r)),c.push(t.key)}return Ho.Ln(s).next(()=>c)}function Ua(t){return bu.zs(t,Ja.store)}function Fa(t){return bu.zs(t,Za.store)}function qa(t){return bu.zs(t,Qa.store)}class ja{constructor(t,e){this.serializer=t,this.ns=e}Qn(t,e,n){return Ba(t).put(Ga(e),n)}jn(t,e){const n=Ba(t),r=Ga(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Wr(t,n)))}Gn(t,e){return Ba(t).get(Ga(e)).next(t=>this.jr(t))}Gr(t,e){return Ba(t).get(Ga(e)).next(t=>{const e=this.jr(t);return e?{zr:e,size:za(t)}:null})}getEntries(t,e){let n=fi();return this.Hr(t,e,(t,e)=>{const r=this.jr(e);n=n.dt(t,r)}).next(()=>n)}Jr(t,e){let n=fi(),r=new si(jr.N);return this.Hr(t,e,(t,e)=>{const i=this.jr(e);i?(n=n.dt(t,i),r=r.dt(t,za(e))):(n=n.dt(t,null),r=r.dt(t,0))}).next(()=>({Yr:n,Xr:r}))}Hr(t,e,n){if(e.L())return Ho.resolve();const r=IDBKeyRange.bound(e.first().path.U(),e.last().path.U()),i=e.Rt();let s=i.vt();return Ba(t).ui({range:r},(t,e,r)=>{const o=jr.nt(t);for(;s&&jr.N(s,o)<0;)n(s,null),s=i.vt();s&&s.isEqual(o)&&(n(s,e),s=i.St()?i.vt():null),s?r.si(s.path.U()):r.done()}).next(()=>{for(;s;)n(s,null),s=i.St()?i.vt():null})}_s(t,e,n){let r=pi();const i=e.path.length+1,s={};if(n.isEqual(Vr.min())){const t=e.path.U();s.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.U(),r=La(n);s.range=IDBKeyRange.lowerBound([t,r],!0),s.index=nu.collectionReadTimeIndex}return Ba(t).ui(s,(t,n,s)=>{if(t.length!==i)return;const o=Aa(this.serializer,n);e.path.q(o.key.path)?o instanceof uo&&No(e,o)&&(r=r.dt(o.key,o)):s.done()}).next(()=>r)}Zr(t,e){let n=li(),r=La(e);const i=Ba(t),s=IDBKeyRange.lowerBound(r,!0);return i.ui({index:nu.readTimeIndex,range:s},(t,e)=>{const i=Aa(this.serializer,e);n=n.dt(i.key,i),r=e.readTime}).next(()=>({eo:n,readTime:xa(r)}))}no(t){const e=Ba(t);let n=Vr.min();return e.ui({index:nu.readTimeIndex,reverse:!0},(t,e,r)=>{e.readTime&&(n=xa(e.readTime)),r.done()}).next(()=>n)}so(t){return new ja.io(this,!!t&&t.ro)}oo(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return $a(t).get(ru.key).next(t=>(Tr(!!t),t))}Wr(t,e){return $a(t).put(ru.key,e)}jr(t){if(t){const e=Aa(this.serializer,t);return e instanceof co&&e.version.isEqual(Vr.min())?null:e}return null}}function $a(t){return bu.zs(t,ru.store)}function Ba(t){return bu.zs(t,nu.store)}function Ga(t){return t.path.U()}function za(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _r();e=t.noDocument}return JSON.stringify(e).length}ja.io=class extends Ko{constructor(t,e){super(),this.co=t,this.ro=e,this.ao=new zo(t=>t.toString(),(t,e)=>t.isEqual(e))}Jn(t){const e=[];let n=0,r=new ui((t,e)=>Rr(t.K(),e.K()));return this.Bn.forEach((i,s)=>{const o=this.ao.get(i);if(s){const a=Sa(this.co.serializer,s,this.readTime);r=r.add(i.path.M());const u=za(a);n+=u-o,e.push(this.co.Qn(t,i,a))}else if(n-=o,this.ro){const n=Sa(this.co.serializer,new co(i,Vr.min()),this.readTime);e.push(this.co.Qn(t,i,n))}else e.push(this.co.jn(t,i))}),r.forEach(n=>{e.push(this.co.ns.Dr(t,n))}),e.push(this.co.updateMetadata(t,n)),Ho.Ln(e)}zn(t,e){return this.co.Gr(t,e).next(t=>null===t?(this.ao.set(e,0),null):(this.ao.set(e,t.size),t.zr))}Hn(t,e){return this.co.Jr(t,e).next(({Yr:t,Xr:e})=>(e.forEach((t,e)=>{this.ao.set(t,e)}),t))}};class Ha{constructor(){this.uo=new Ka}Dr(t,e){return this.uo.add(e),Ho.resolve()}Es(t,e){return Ho.resolve(this.uo.getEntries(e))}}class Ka{constructor(){this.index={}}add(t){const e=t.k(),n=t.M(),r=this.index[e]||new ui(Ur.N),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.k(),n=t.M(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new ui(Ur.N)).U()}}class Wa{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,r){Tr(n<r&&n>=0&&r<=10);const i=new sa(e);n<1&&r>=1&&(function(t){t.createObjectStore(Ya.store)}(t),function(t){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath}),t.createObjectStore(Ja.store,{keyPath:Ja.keyPath,autoIncrement:!0}).createIndex(Ja.userMutationsIndex,Ja.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Za.store)}(t),uu(t),function(t){t.createObjectStore(nu.store)}(t));let s=Ho.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(su.store),t.deleteObjectStore(iu.store),t.deleteObjectStore(ou.store)}(t),uu(t)),s=s.next(()=>(function(t){const e=i.store(ou.store),n=new ou(0,0,Vr.min().D(),0);return e.put(ou.key,n)})())),n<4&&r>=4&&(0!==n&&(s=s.next(()=>(function(t,e){return e.store(Ja.store).ri().next(n=>{t.deleteObjectStore(Ja.store),t.createObjectStore(Ja.store,{keyPath:Ja.keyPath,autoIncrement:!0}).createIndex(Ja.userMutationsIndex,Ja.userMutationsKeyPath,{unique:!0});const r=e.store(Ja.store),i=n.map(t=>r.put(t));return Ho.Ln(i)})})(t,i))),s=s.next(()=>{!function(t){t.createObjectStore(cu.store,{keyPath:cu.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),n<6&&r>=6&&(s=s.next(()=>((function(t){t.createObjectStore(ru.store)})(t),this.addDocumentGlobal(i)))),n<7&&r>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),n<8&&r>=8&&(s=s.next(()=>this.createCollectionParentIndex(t,i))),n<9&&r>=9&&(s=s.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(nu.store);e.createIndex(nu.readTimeIndex,nu.readTimeIndexPath,{unique:!1}),e.createIndex(nu.collectionReadTimeIndex,nu.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),s}addDocumentGlobal(t){let e=0;return t.store(nu.store).ui((t,n)=>{e+=za(n)}).next(()=>{const n=new ru(e);return t.store(ru.store).put(ru.key,n)})}removeAcknowledgedMutations(t){const e=t.store(Qa.store),n=t.store(Ja.store);return e.ri().next(e=>Ho.forEach(e,e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ri(Ja.userMutationsIndex,r).next(n=>Ho.forEach(n,n=>{Tr(n.userId===e.userId);const r=Ra(this.serializer,n);return Ma(t,e.userId,r).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(su.store),n=t.store(nu.store);return t.store(ou.store).get(ou.key).next(t=>{const r=[];return n.ui((n,i)=>{const s=new Ur(n),o=function(t){return[0,Ea(s)]}();r.push(e.get(o).next(n=>n?Ho.resolve():(n=>e.put(new su(0,Ea(n),t.highestListenSequenceNumber)))(s)))}).next(()=>Ho.Ln(r))})}createCollectionParentIndex(t,e){t.createObjectStore(au.store,{keyPath:au.keyPath});const n=e.store(au.store),r=new Ka,i=t=>{if(r.add(t)){const e=t.k(),r=t.M();return n.put({collectionId:e,parent:Ea(r)})}};return e.store(nu.store).ui({ai:!0},(t,e)=>{const n=new Ur(t);return i(n.M())}).next(()=>e.store(Za.store).ui({ai:!0},([t,e,n],r)=>{const s=Ta(e);return i(s.M())}))}rewriteCanonicalIds(t){const e=t.store(iu.store);return e.ui((t,n)=>{const r=ka(n),i=Ca(this.serializer,r);return e.put(i)})}}class Xa{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Ya{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Ya.store="owner",Ya.key="owner";class Qa{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Qa.store="mutationQueues",Qa.keyPath="userId";class Ja{constructor(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}Ja.store="mutations",Ja.keyPath="batchId",Ja.userMutationsIndex="userMutationsIndex",Ja.userMutationsKeyPath=["userId","batchId"];class Za{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Ea(e)]}static key(t,e,n){return[t,Ea(e),n]}}Za.store="documentMutations",Za.PLACEHOLDER=new Za;class tu{constructor(t,e){this.path=t,this.readTime=e}}class eu{constructor(t,e){this.path=t,this.version=e}}class nu{constructor(t,e,n,r,i,s){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}nu.store="remoteDocuments",nu.readTimeIndex="readTimeIndex",nu.readTimeIndexPath="readTime",nu.collectionReadTimeIndex="collectionReadTimeIndex",nu.collectionReadTimeIndexPath=["parentPath","readTime"];class ru{constructor(t){this.byteSize=t}}ru.store="remoteDocumentGlobal",ru.key="remoteDocumentGlobalKey";class iu{constructor(t,e,n,r,i,s,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}iu.store="targets",iu.keyPath="targetId",iu.queryTargetsIndexName="queryTargetsIndex",iu.queryTargetsKeyPath=["canonicalId","targetId"];class su{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}su.store="targetDocuments",su.keyPath=["targetId","path"],su.documentTargetsIndex="documentTargetsIndex",su.documentTargetsKeyPath=["path","targetId"];class ou{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}ou.key="targetGlobalKey",ou.store="targetGlobal";class au{constructor(t,e){this.collectionId=t,this.parent=e}}function uu(t){t.createObjectStore(su.store,{keyPath:su.keyPath}).createIndex(su.documentTargetsIndex,su.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(iu.store,{keyPath:iu.keyPath}).createIndex(iu.queryTargetsIndexName,iu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ou.store)}au.store="collectionParents",au.keyPath=["collectionId","parent"];class cu{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}cu.store="clientMetadata",cu.keyPath="clientId";const hu=[...[...[...[Qa.store,Ja.store,Za.store,nu.store,iu.store,Ya.store,ou.store,su.store],cu.store],ru.store],au.store];class lu{constructor(){this.ho=new Ka}Dr(t,e){if(!this.ho.has(e)){const n=e.k(),r=e.M();t.Xn(()=>{this.ho.add(e)});const i={collectionId:n,parent:Ea(r)};return fu(t).put(i)}return Ho.resolve()}Es(t,e){const n=[],r=IDBKeyRange.bound([e,""],[Cr(e),""],!1,!0);return fu(t).ri(r).next(t=>{for(const r of t){if(r.collectionId!==e)break;n.push(Ta(r.parent))}return n})}}function fu(t){return bu.zs(t,au.store)}class du{constructor(t){this.lo=t}next(){return this.lo+=2,this.lo}static _o(){return new du(0)}static fo(){return new du(-1)}}class pu{constructor(t,e){this.yr=t,this.serializer=e}do(t){return this.wo(t).next(e=>{const n=new du(e.highestTargetId);return e.highestTargetId=n.next(),this.Eo(t,e).next(()=>e.highestTargetId)})}To(t){return this.wo(t).next(t=>Vr.p(new Pr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Io(t){return this.wo(t).next(t=>t.highestListenSequenceNumber)}mo(t,e,n){return this.wo(t).next(r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.D()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Eo(t,r)))}Ao(t,e){return this.Ro(t,e).next(()=>this.wo(t).next(n=>(n.targetCount+=1,this.Po(e,n),this.Eo(t,n))))}Vo(t,e){return this.Ro(t,e)}yo(t,e){return this.po(t,e.targetId).next(()=>gu(t).delete(e.targetId)).next(()=>this.wo(t)).next(e=>(Tr(e.targetCount>0),e.targetCount-=1,this.Eo(t,e)))}mr(t,e,n){let r=0;const i=[];return gu(t).ui((s,o)=>{const a=ka(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,i.push(this.yo(t,a)))}).next(()=>Ho.Ln(i)).next(()=>r)}Le(t,e){return gu(t).ui((t,n)=>{const r=ka(n);e(r)})}wo(t){return mu(t).get(ou.key).next(t=>(Tr(null!==t),t))}Eo(t,e){return mu(t).put(ou.key,e)}Ro(t,e){return gu(t).put(Ca(this.serializer,e))}Po(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}bo(t){return this.wo(t).next(t=>t.targetCount)}vo(t,e){const n=Xr(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return gu(t).ui({range:r,index:iu.queryTargetsIndexName},(t,n,r)=>{const s=ka(n);Yr(e,s.target)&&(i=s,r.done())}).next(()=>i)}So(t,e,n){const r=[],i=yu(t);return e.forEach(e=>{const s=Ea(e.path);r.push(i.put(new su(n,s))),r.push(this.yr.Do(t,n,e))}),Ho.Ln(r)}Co(t,e,n){const r=yu(t);return Ho.forEach(e,e=>{const i=Ea(e.path);return Ho.Ln([r.delete([n,i]),this.yr.No(t,n,e)])})}po(t,e){const n=yu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}xo(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=yu(t);let i=yi();return r.ui({range:n,ai:!0},(t,e,n)=>{const r=Ta(t[1]),s=new jr(r);i=i.add(s)}).next(()=>i)}Kr(t,e){const n=Ea(e.path),r=IDBKeyRange.bound([n],[Cr(n)],!1,!0);let i=0;return yu(t).ui({index:su.documentTargetsIndex,ai:!0,range:r},([t,e],n,r)=>{0!==t&&(i++,r.done())}).next(()=>i>0)}Je(t,e){return gu(t).get(e).next(t=>t?ka(t):null)}}function gu(t){return bu.zs(t,iu.store)}function mu(t){return bu.zs(t,ou.store)}function yu(t){return bu.zs(t,su.store)}const wu="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class vu extends Xo{constructor(t,e){super(),this.Lr=t,this.Oo=e}}class bu{constructor(t,e,n,r,i,s,o,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.vs=i,this.window=s,this.document=o,this.Fo=u,this.Mo=c,this.$o=null,this.ko=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Lo=null,this.inForeground=!1,this.qo=null,this.Bo=null,this.Uo=Number.NEGATIVE_INFINITY,this.Ko=(t=>Promise.resolve()),!bu.Qs())throw new Sr(Ar.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.yr=new _u(this,r),this.Qo=e+"main",this.serializer=new Na(a),this.Wo=new ea(this.Qo,10,new Wa(this.serializer)),this.jo=new pu(this.yr,this.serializer),this.ns=new lu,this.ts=new ja(this.serializer,this.ns),this.window&&this.window.localStorage?this.Go=this.window.localStorage:(this.Go=null,!1===c&&br("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static zs(t,e){if(t instanceof vu)return ea.zs(t.Lr,e);throw _r()}start(){return this.zo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Sr(Ar.FAILED_PRECONDITION,wu);return this.Ho(),this.Jo(),this.Yo(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.jo.Io(t))}).then(t=>{this.$o=new Jo(t,this.Fo)}).then(()=>{this.ko=!0}).catch(t=>(this.Wo&&this.Wo.close(),Promise.reject(t)))}Xo(t){return this.Ko=(async e=>{if(this.lr)return t(e)}),t(this.isPrimary)}Zo(t){this.Wo.Ys(async e=>{null===e.newVersion&&await t()})}tc(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.vs.Ii(async()=>{this.lr&&await this.zo()}))}zo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Iu(t).put(new cu(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.ec(t).next(t=>{t||(this.isPrimary=!1,this.vs.xi(()=>this.Ko(!1)))})}).next(()=>this.nc(t)).next(e=>this.isPrimary&&!e?this.sc(t).next(()=>!1):!!e&&this.ic(t).next(()=>!0))).catch(t=>{if(ia(t))return vr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.vs.xi(()=>this.Ko(t)),this.isPrimary=t})}ec(t){return Eu(t).get(Ya.key).next(t=>Ho.resolve(this.rc(t)))}oc(t){return Iu(t).delete(this.clientId)}async cc(){if(this.isPrimary&&!this.ac(this.Uo,18e5)){this.Uo=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=bu.zs(t,cu.store);return e.ri().next(t=>{const n=this.uc(t,18e5),r=t.filter(t=>-1===n.indexOf(t));return Ho.forEach(r,t=>e.delete(t.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Go)for(const e of t)this.Go.removeItem(this.hc(e.clientId))}}Yo(){this.Bo=this.vs.Ls("client_metadata_refresh",4e3,()=>this.zo().then(()=>this.cc()).then(()=>this.Yo()))}rc(t){return!!t&&t.ownerId===this.clientId}nc(t){return this.Mo?Ho.resolve(!0):Eu(t).get(Ya.key).next(e=>{if(null!==e&&this.ac(e.leaseTimestampMs,5e3)&&!this.lc(e.ownerId)){if(this.rc(e)&&this.networkEnabled)return!0;if(!this.rc(e)){if(!e.allowTabSynchronization)throw new Sr(Ar.FAILED_PRECONDITION,wu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Iu(t).ri().next(t=>void 0===this.uc(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&vr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async _c(){this.ko=!1,this.fc(),this.Bo&&(this.Bo.cancel(),this.Bo=null),this.dc(),this.wc(),await this.Wo.runTransaction("readwrite",[Ya.store,cu.store],t=>{const e=new vu(t,Jo.bs);return this.sc(e).next(()=>this.oc(e))}),this.Wo.close(),this.Ec()}uc(t,e){return t.filter(t=>this.ac(t.updateTimeMs,e)&&!this.lc(t.clientId))}Tc(){return this.runTransaction("getActiveClients","readonly",t=>Iu(t).ri().next(t=>this.uc(t,18e5).map(t=>t.clientId)))}get lr(){return this.ko}Ic(t){return Pa.br(t,this.serializer,this.ns,this.yr)}mc(){return this.jo}Ac(){return this.ts}Rc(){return this.ns}runTransaction(t,e,n){vr("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite";let i;return this.Wo.runTransaction(r,hu,r=>(i=new vu(r,this.$o?this.$o.next():Jo.bs),"readwrite-primary"===e?this.ec(i).next(t=>!!t||this.nc(i)).next(e=>{if(!e)throw br(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.vs.xi(()=>this.Ko(!1)),new Sr(Ar.FAILED_PRECONDITION,Wo);return n(i)}).next(t=>this.ic(i).next(()=>t)):this.Pc(i).next(()=>n(i)))).then(t=>(i.Zn(),t))}Pc(t){return Eu(t).get(Ya.key).next(t=>{if(null!==t&&this.ac(t.leaseTimestampMs,5e3)&&!this.lc(t.ownerId)&&!this.rc(t)&&!(this.Mo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Sr(Ar.FAILED_PRECONDITION,wu)})}ic(t){const e=new Ya(this.clientId,this.allowTabSynchronization,Date.now());return Eu(t).put(Ya.key,e)}static Qs(){return ea.Qs()}sc(t){const e=Eu(t);return e.get(Ya.key).next(t=>this.rc(t)?(vr("IndexedDbPersistence","Releasing primary lease."),e.delete(Ya.key)):Ho.resolve())}ac(t,e){const n=Date.now();return!(t<n-e||t>n&&(br(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ho(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qo=(()=>{this.vs.Ii(()=>(this.inForeground="visible"===this.document.visibilityState,this.zo()))}),this.document.addEventListener("visibilitychange",this.qo),this.inForeground="visible"===this.document.visibilityState)}dc(){this.qo&&(this.document.removeEventListener("visibilitychange",this.qo),this.qo=null)}Jo(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Lo=(()=>{this.fc(),this.vs.Ii(()=>this._c())}),this.window.addEventListener("unload",this.Lo))}wc(){this.Lo&&(this.window.removeEventListener("unload",this.Lo),this.Lo=null)}lc(t){var e;try{const n=null!==(null===(e=this.Go)||void 0===e?void 0:e.getItem(this.hc(t)));return vr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return br("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}fc(){if(this.Go)try{this.Go.setItem(this.hc(this.clientId),String(Date.now()))}catch(t){br("Failed to set zombie client id.",t)}}Ec(){if(this.Go)try{this.Go.removeItem(this.hc(this.clientId))}catch(t){}}hc(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Eu(t){return bu.zs(t,Ya.store)}function Iu(t){return bu.zs(t,cu.store)}class _u{constructor(t,e){this.db=t,this.cr=new ba(this,e)}Er(t){const e=this.gc(t);return this.db.mc().bo(t).next(t=>e.next(e=>t+e))}gc(t){let e=0;return this.Ir(t,t=>{e++}).next(()=>e)}Le(t,e){return this.db.mc().Le(t,e)}Ir(t,e){return this.Vc(t,(t,n)=>e(n))}Do(t,e,n){return Tu(t,n)}No(t,e,n){return Tu(t,n)}mr(t,e,n){return this.db.mc().mr(t,e,n)}Br(t,e){return Tu(t,e)}yc(t,e){return function(t,e){let n=!1;return qa(t).hi(r=>Va(t,r,e).next(t=>(t&&(n=!0),Ho.resolve(!t)))).next(()=>n)}(t,e)}Ar(t,e){const n=this.db.Ac().so(),r=[];let i=0;return this.Vc(t,(s,o)=>{if(o<=e){const e=this.yc(t,s).next(e=>{if(!e)return i++,n.Gn(t,s).next(()=>(n.jn(s),yu(t).delete([0,Ea(s.path)])))});r.push(e)}}).next(()=>Ho.Ln(r)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.lt(t.Oo);return this.db.mc().Vo(t,n)}bc(t,e){return Tu(t,e)}Vc(t,e){const n=yu(t);let r,i=Jo.bs;return n.ui({index:su.documentTargetsIndex},([t,n],{path:s,sequenceNumber:o})=>{0===t?(i!==Jo.bs&&e(new jr(Ta(r)),i),i=o,r=s):i=Jo.bs}).next(()=>{i!==Jo.bs&&e(new jr(Ta(r)),i)})}Pr(t){return this.db.Ac().oo(t)}}function Tu(t,e){return yu(t).put(function(t,e){return new su(0,Ea(t.path),e)}(e,t.Oo))}function Nu(t,e){let n=t.projectId;return t.it||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}async function Au(t){if(!ea.Qs())return Promise.resolve();const e=t+"main";await ea.delete(e)}class Su{constructor(t,e,n){this.persistence=t,this.vc=e,this.Sc=new si(Rr),this.Dc=new zo(t=>Xr(t),Yr),this.Cc=Vr.min(),this.es=t.Ic(n),this.Nc=t.Ac(),this.jo=t.mc(),this.xc=new Yo(this.Nc,this.es,this.persistence.Rc()),this.vc.Oc(this.xc)}_r(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Rr(e,this.Sc))}}async function Lu(t,e){const n=Nr(t);let r=n.es,i=n.xc;const s=await n.persistence.runTransaction("Handle user change","readonly",t=>{let s;return n.es.Mr(t).next(o=>(s=o,r=n.persistence.Ic(e),i=new Yo(n.Nc,r,n.persistence.Rc()),r.Mr(t))).next(e=>{const n=[],r=[];let o=yi();for(const t of s){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.us(t,o).next(t=>({Fc:t,Mc:n,$c:r}))})});return n.es=r,n.xc=i,n.vc.Oc(n.xc),s}function xu(t){const e=Nr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.jo.To(t))}function Du(t,e){const n=Nr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.es.Or(t,e)))}function Ou(t,e){const n=Nr(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.jo.vo(t,e).next(i=>i?(r=i,Ho.resolve(r)):n.jo.do(t).next(i=>(r=new Zr(e,i,0,t.Oo),n.jo.Ao(t,r).next(()=>r))))}).then(t=>{const r=n.Sc.get(t.targetId);return(null===r||t.ht.v(r.ht)>0)&&(n.Sc=n.Sc.dt(t.targetId,t),n.Dc.set(e,t.targetId)),t})}async function Ru(t,e,n){const r=Nr(t),i=r.Sc.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,t=>r.persistence.yr.removeTarget(t,i))}catch(t){if(!ia(t))throw t;vr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Sc=r.Sc.remove(e),r.Dc.delete(i.target)}function ku(t,e,n){const r=Nr(t);let i=Vr.min(),s=yi();return r.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const r=Nr(t),i=r.Dc.get(n);return void 0!==i?Ho.resolve(r.Sc.get(i)):r.jo.vo(e,n)})(r,t,Eo(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.jo.xo(t,e.targetId).next(t=>{s=t})}).next(()=>r.vc._s(t,e,n?i:Vr.min(),n?s:yi())).next(t=>({documents:t,kc:s})))}function Cu(t,e){const n=Nr(t),r=Nr(n.jo),i=n.Sc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>r.Je(t,e).next(t=>t?t.target:null))}async function Pu(t){if(t.code!==Ar.FAILED_PRECONDITION||t.message!==Wo)throw t;vr("LocalStore","Unexpectedly lost primary lease")}class Vu{constructor(t,e,n,r,i,s){this.vs=t,this.Lc=n,this.qc=r,this.Bc=i,this.listener=s,this.state=0,this.Uc=0,this.Kc=null,this.stream=null,this.pi=new ta(t,e)}Qc(){return 1===this.state||2===this.state||4===this.state}Wc(){return 2===this.state}start(){3!==this.state?this.auth():this.jc()}async stop(){this.Qc()&&await this.close(0)}Gc(){this.state=0,this.pi.reset()}zc(){this.Wc()&&null===this.Kc&&(this.Kc=this.vs.Ls(this.Lc,6e4,()=>this.Hc()))}Jc(t){this.Yc(),this.stream.send(t)}async Hc(){if(this.Wc())return this.close(0)}Yc(){this.Kc&&(this.Kc.cancel(),this.Kc=null)}async close(t,e){this.Yc(),this.pi.cancel(),this.Uc++,3!==t?this.pi.reset():e&&e.code===Ar.RESOURCE_EXHAUSTED?(br(e.toString()),br("Using maximum backoff delay to prevent overloading the backend."),this.pi.Ms()):e&&e.code===Ar.UNAUTHENTICATED&&this.Bc.A(),null!==this.stream&&(this.Xc(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Zc(e)}Xc(){}auth(){this.state=1;const t=this.ta(this.Uc),e=this.Uc;this.Bc.getToken().then(t=>{this.Uc===e&&this.ea(t)},e=>{t(()=>{const t=new Sr(Ar.UNKNOWN,"Fetching auth token failed: "+e.message);return this.na(t)})})}ea(t){const e=this.ta(this.Uc);this.stream=this.sa(t),this.stream.ia(()=>{e(()=>(this.state=2,this.listener.ia()))}),this.stream.Zc(t=>{e(()=>this.na(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}jc(){this.state=4,this.pi.$s(async()=>{this.state=0,this.start()})}na(t){return vr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}ta(t){return e=>{this.vs.Ii(()=>this.Uc===t?e():(vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Mu extends Vu{constructor(t,e,n,r,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.serializer=r}sa(t){return this.qc.ra("Listen",t)}onMessage(t){this.pi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_r()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.Ye?(Tr(void 0===e||"string"==typeof e),Jr.fromBase64String(e||"")):(Tr(void 0===e||e instanceof Uint8Array),Jr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ar.UNKNOWN:ii(t.code);return new Sr(e,t.message||"")}(o);n=new Si(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=ls(t,r.document.name),s=as(r.document.updateTime),o=new io({mapValue:{fields:r.document.fields}}),a=new uo(i,s,o,{}),u=r.targetIds||[],c=r.removedTargetIds||[];n=new Ni(u,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=ls(t,r.document),s=r.readTime?as(r.readTime):Vr.min(),o=new co(i,s),a=r.removedTargetIds||[];n=new Ni([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=ls(t,r.document),s=r.removedTargetIds||[];n=new Ni([],s,i,null)}else{if(!("filter"in e))return _r();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,i=new ti(r),s=t.targetId;n=new Ai(s,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Vr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Vr.min():e.readTime?as(e.readTime):Vr.min()}(t);return this.listener.oa(e,n)}ca(t){const e={};e.database=ps(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;return(n=Qr(r)?{documents:vs(t,r)}:{query:bs(t,r)}).targetId=e.targetId,e.resumeToken.ct()>0&&(n.resumeToken=os(t,e.resumeToken)),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _r()}}(0,e.ut);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Jc(e)}aa(t){const e={};e.database=ps(this.serializer),e.removeTarget=t,this.Jc(e)}}class Uu extends Vu{constructor(t,e,n,r,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.serializer=r,this.ua=!1}get ha(){return this.ua}start(){this.ua=!1,this.lastStreamToken=void 0,super.start()}Xc(){this.ua&&this.la([])}sa(t){return this.qc.ra("Write",t)}onMessage(t){if(Tr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ua){this.pi.reset();const e=function(t,e){return t&&t.length>0?(Tr(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?as(t.updateTime):as(e);n.isEqual(Vr.min())&&(n=as(e));let r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new js(n,r)})(t,e))):[]}(t.writeResults,t.commitTime),n=as(t.commitTime);return this.listener._a(n,e)}return Tr(!t.writeResults||0===t.writeResults.length),this.ua=!0,this.listener.fa()}da(){const t={};t.database=ps(this.serializer),this.Jc(t)}la(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>ys(this.serializer,t))};this.Jc(e)}}class Fu extends class{}{constructor(t,e,n){super(),this.credentials=t,this.qc=e,this.serializer=n,this.wa=!1}Ea(){if(this.wa)throw new Sr(Ar.FAILED_PRECONDITION,"The client has already been terminated.")}Ta(t,e,n){return this.Ea(),this.credentials.getToken().then(r=>this.qc.Ta(t,e,n,r)).catch(t=>{throw t.code===Ar.UNAUTHENTICATED&&this.credentials.A(),t})}Ia(t,e,n){return this.Ea(),this.credentials.getToken().then(r=>this.qc.Ia(t,e,n,r)).catch(t=>{throw t.code===Ar.UNAUTHENTICATED&&this.credentials.A(),t})}terminate(){this.wa=!1}}function qu(t,e,n){return new Fu(t,e,n)}class ju{constructor(t,e){this.li=t,this.ma=e,this.state="Unknown",this.Aa=0,this.Ra=null,this.Pa=!0}ga(){0===this.Aa&&(this.Va("Unknown"),this.Ra=this.li.Ls("online_state_timeout",1e4,()=>(this.Ra=null,this.ya("Backend didn't respond within 10 seconds."),this.Va("Offline"),Promise.resolve())))}pa(t){"Online"===this.state?this.Va("Unknown"):(this.Aa++,this.Aa>=1&&(this.ba(),this.ya("Connection failed 1 times. Most recent error: "+t.toString()),this.Va("Offline")))}set(t){this.ba(),this.Aa=0,"Online"===t&&(this.Pa=!1),this.Va(t)}Va(t){t!==this.state&&(this.state=t,this.ma(t))}ya(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Pa?(br(e),this.Pa=!1):vr("OnlineStateTracker",e)}ba(){null!==this.Ra&&(this.Ra.cancel(),this.Ra=null)}}class $u{constructor(t,e,n,r,i){this.va=t,this.Sa=e,this.li=n,this.Da={},this.Ca=[],this.Na=new Map,this.xa=new Set,this.Oa=[],this.Fa=i,this.Fa.Ma(t=>{n.Ii(async()=>{Qu(this)&&(vr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Nr(t);e.xa.add(4),await Gu(e),e.$a.set("Unknown"),e.xa.delete(4),await Bu(e)}(this))})}),this.$a=new ju(n,r)}}async function Bu(t){if(Qu(t))for(const e of t.Oa)await e(!0)}async function Gu(t){for(const e of t.Oa)await e(!1)}function zu(t,e){const n=Nr(t);n.Na.has(e.targetId)||(n.Na.set(e.targetId,e),Yu(n)?Xu(n):ac(n).Wc()&&Ku(n,e))}function Hu(t,e){const n=Nr(t),r=ac(n);n.Na.delete(e),r.Wc()&&Wu(n,e),0===n.Na.size&&(r.Wc()?r.zc():Qu(n)&&n.$a.set("Unknown"))}function Ku(t,e){t.ka.be(e.targetId),ac(t).ca(e)}function Wu(t,e){t.ka.be(e),ac(t).aa(e)}function Xu(t){t.ka=new xi({He:e=>t.Da.He(e),Je:e=>t.Na.get(e)||null}),ac(t).start(),t.$a.ga()}function Yu(t){return Qu(t)&&!ac(t).Qc()&&t.Na.size>0}function Qu(t){return 0===Nr(t).xa.size}function Ju(t){t.ka=void 0}async function Zu(t,e,n){if(!ia(e))throw e;t.xa.add(1),await Gu(t),t.$a.set("Offline"),n||(n=(()=>xu(t.va))),t.li.xi(async()=>{vr("RemoteStore","Retrying IndexedDB access"),await n(),t.xa.delete(1),await Bu(t)})}function tc(t,e){return e().catch(n=>Zu(t,n,e))}async function ec(t){const e=Nr(t),n=uc(e);let r=e.Ca.length>0?e.Ca[e.Ca.length-1].batchId:-1;for(;nc(e);)try{const i=await Du(e.va,r);if(null===i){0===e.Ca.length&&n.zc();break}r=i.batchId,rc(e,i)}catch(t){await Zu(e,t)}ic(e)&&sc(e)}function nc(t){return Qu(t)&&t.Ca.length<10}function rc(t,e){t.Ca.push(e);const n=uc(t);n.Wc()&&n.ha&&n.la(e.mutations)}function ic(t){return Qu(t)&&!uc(t).Qc()&&t.Ca.length>0}function sc(t){uc(t).start()}async function oc(t,e){const n=Nr(t);e?(n.xa.delete(2),await Bu(n)):e||(n.xa.add(2),await Gu(n),n.$a.set("Unknown"))}function ac(t){return t.Ka||(t.Ka=function(t,e,n){const r=Nr(t);return r.Ea(),new Mu(e,r.qc,r.credentials,r.serializer,n)}(t.Sa,t.li,{ia:async function(t){t.Na.forEach((e,n)=>{Ku(t,e)})}.bind(null,t),Zc:async function(t,e){Ju(t),Yu(t)?(t.$a.pa(e),Xu(t)):t.$a.set("Unknown")}.bind(null,t),oa:async function(t,e,n){if(t.$a.set("Online"),e instanceof Si&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Na.has(r)&&(await t.Da.La(r,n),t.Na.delete(r),t.ka.removeTarget(r))}(t,e)}catch(n){vr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Zu(t,n)}else if(e instanceof Ni?t.ka.Fe(e):e instanceof Ai?t.ka.Ke(e):t.ka.ke(e),!n.isEqual(Vr.min()))try{const r=await xu(t.va);n.v(r)>=0&&await function(t,e){const n=t.ka.je(e);return n.ne.forEach((n,r)=>{if(n.resumeToken.ct()>0){const i=t.Na.get(r);i&&t.Na.set(r,i._t(n.resumeToken,e))}}),n.se.forEach(e=>{const n=t.Na.get(e);if(!n)return;t.Na.set(e,n._t(Jr.at,n.ht)),Wu(t,e);const r=new Zr(n.target,e,1,n.sequenceNumber);Ku(t,r)}),t.Da.qa(n)}(t,n)}catch(e){vr("RemoteStore","Failed to raise snapshot:",e),await Zu(t,e)}}.bind(null,t)}),t.Oa.push(async e=>{e?(t.Ka.Gc(),Yu(t)?Xu(t):t.$a.set("Unknown")):(await t.Ka.stop(),Ju(t))})),t.Ka}function uc(t){return t.Qa||(t.Qa=function(t,e,n){const r=Nr(t);return r.Ea(),new Uu(e,r.qc,r.credentials,r.serializer,n)}(t.Sa,t.li,{ia:async function(t){uc(t).da()}.bind(null,t),Zc:async function(t,e){e&&uc(t).ha&&await async function(t,e){if(ri(n=e.code)&&n!==Ar.ABORTED){const n=t.Ca.shift();uc(t).Gc(),await tc(t,()=>t.Da.Ua(n.batchId,e)),await ec(t)}var n}(t,e),ic(t)&&sc(t)}.bind(null,t),fa:async function(t){const e=uc(t);for(const n of t.Ca)e.la(n.mutations)}.bind(null,t),_a:async function(t,e,n){const r=t.Ca.shift(),i=Go.from(r,e,n);await tc(t,()=>t.Da.Ba(i)),await ec(t)}.bind(null,t)}),t.Oa.push(async e=>{e?(t.Qa.Gc(),await ec(t)):(await t.Qa.stop(),t.Ca.length>0&&(vr("RemoteStore",`Stopping write stream with ${t.Ca.length} pending writes`),t.Ca=[]))})),t.Qa}class cc{constructor(){this.Wa=void 0,this.listeners=[]}}class hc{constructor(){this.ja=new zo(t=>_o(t),Io),this.onlineState="Unknown",this.Ga=new Set}}async function lc(t,e){const n=Nr(t),r=e.query;let i=!1,s=n.ja.get(r);if(s||(i=!0,s=new cc),i)try{s.Wa=await n.za(r)}catch(t){const n=pa(t,`Initialization of query '${To(e.query)}' failed`);return void e.onError(n)}n.ja.set(r,s),s.listeners.push(e),e.Ha(n.onlineState),s.Wa&&e.Ja(s.Wa)&&dc(n)}async function fc(t,e){const n=Nr(t),r=e.query;let i=!1;const s=n.ja.get(r);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),i=0===s.listeners.length)}if(i)return n.ja.delete(r),n.Ya(r)}function dc(t){t.Ga.forEach(t=>{t.next()})}class pc{constructor(t,e,n){this.query=t,this.Xa=e,this.Za=!1,this.tu=null,this.onlineState="Unknown",this.options=n||{}}Ja(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ii(t.query,t.docs,t.Yt,e,t.Xt,t.fromCache,t.Zt,!0)}let e=!1;return this.Za?this.eu(t)&&(this.Xa.next(t),e=!0):this.nu(t,this.onlineState)&&(this.su(t),e=!0),this.tu=t,e}onError(t){this.Xa.error(t)}Ha(t){this.onlineState=t;let e=!1;return this.tu&&!this.Za&&this.nu(this.tu,t)&&(this.su(this.tu),e=!0),e}nu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.iu&&n||t.docs.L()&&"Offline"!==e)}eu(t){if(t.docChanges.length>0)return!0;const e=this.tu&&this.tu.hasPendingWrites!==t.hasPendingWrites;return!(!t.Zt&&!e)&&!0===this.options.includeMetadataChanges}su(t){t=Ii.ee(t.query,t.docs,t.Xt,t.fromCache),this.Za=!0,this.Xa.next(t)}}class gc{constructor(){this.ru=new ui(mc.ou),this.cu=new ui(mc.au)}L(){return this.ru.L()}Do(t,e){const n=new mc(t,e);this.ru=this.ru.add(n),this.cu=this.cu.add(n)}uu(t,e){t.forEach(t=>this.Do(t,e))}No(t,e){this.hu(new mc(t,e))}lu(t,e){t.forEach(t=>this.No(t,e))}_u(t){const e=new jr(new Ur([])),n=new mc(e,t),r=new mc(e,t+1),i=[];return this.cu.Bt([n,r],t=>{this.hu(t),i.push(t.key)}),i}fu(){this.ru.forEach(t=>this.hu(t))}hu(t){this.ru=this.ru.delete(t),this.cu=this.cu.delete(t)}du(t){const e=new jr(new Ur([])),n=new mc(e,t),r=new mc(e,t+1);let i=yi();return this.cu.Bt([n,r],t=>{i=i.add(t.key)}),i}Kr(t){const e=new mc(t,0),n=this.ru.Kt(e);return null!==n&&t.isEqual(n.key)}}class mc{constructor(t,e){this.key=t,this.wu=e}static ou(t,e){return jr.N(t.key,e.key)||Rr(t.wu,e.wu)}static au(t,e){return Rr(t.wu,e.wu)||jr.N(t.key,e.key)}}function yc(t,e){return`firestore_clients_${t}_${e}`}function wc(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.t()&&(r+="_"+e.uid),r}function vc(t,e){return`firestore_targets_${t}_${e}`}class bc{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Eu(t,e,n){const r=JSON.parse(n);let i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),s=void 0;return i&&r.error&&((i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(s=new Sr(r.error.code,r.error.message))),i?new bc(t,e,r.state,s):(br("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Tu(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Ec{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Eu(t,e){const n=JSON.parse(e);let r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&((r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Sr(n.error.code,n.error.message))),r?new Ec(t,n.state,i):(br("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Tu(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Ic{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Eu(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=vi();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Hr(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return r?new Ic(t,i):(br("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class _c{constructor(t,e){this.clientId=t,this.onlineState=e}static Eu(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new _c(e.clientId,e.onlineState):(br("SharedClientState","Failed to parse online state: "+t),null)}}class Tc{constructor(){this.activeTargetIds=vi()}Iu(t){this.activeTargetIds=this.activeTargetIds.add(t)}mu(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Tu(){const t={activeTargetIds:this.activeTargetIds.U(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Nc{constructor(t,e,n,r,i){this.window=t,this.vs=e,this.persistenceKey=n,this.Au=r,this.Ru=null,this.ma=null,this.gs=null,this.Pu=this.gu.bind(this),this.Vu=new si(Rr),this.lr=!1,this.yu=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pu=yc(this.persistenceKey,this.Au),this.bu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Vu=this.Vu.dt(this.Au,new Tc),this.vu=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Su=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Du=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Cu=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Pu)}static Qs(t){return!(!t||!t.localStorage)}async start(){const t=await this.Ru.Tc();for(const e of t){if(e===this.Au)continue;const t=this.getItem(yc(this.persistenceKey,e));if(t){const n=Ic.Eu(e,t);n&&(this.Vu=this.Vu.dt(n.clientId,n))}}this.Nu();const e=this.storage.getItem(this.Cu);if(e){const t=this.xu(e);t&&this.Ou(t)}for(const t of this.yu)this.gu(t);this.yu=[],this.window.addEventListener("unload",()=>this._c()),this.lr=!0}ps(t){this.setItem(this.bu,JSON.stringify(t))}Fu(){return this.Mu(this.Vu)}$u(t){let e=!1;return this.Vu.forEach((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)}),e}ku(t){this.Lu(t,"pending")}qu(t,e,n){this.Lu(t,e,n),this.Bu(t)}Uu(t){let e="not-current";if(this.$u(t)){const n=this.storage.getItem(vc(this.persistenceKey,t));if(n){const r=Ec.Eu(t,n);r&&(e=r.state)}}return this.Ku.Iu(t),this.Nu(),e}Qu(t){this.Ku.mu(t),this.Nu()}Wu(t){return this.Ku.activeTargetIds.has(t)}ju(t){this.removeItem(vc(this.persistenceKey,t))}Gu(t,e,n){this.zu(t,e,n)}Hu(t,e,n){e.forEach(t=>{this.Bu(t)}),this.currentUser=t,n.forEach(t=>{this.ku(t)})}Ju(t){this.Yu(t)}_c(){this.lr&&(this.window.removeEventListener("storage",this.Pu),this.removeItem(this.pu),this.lr=!1)}getItem(t){const e=this.storage.getItem(t);return vr("SharedClientState","READ",t,e),e}setItem(t,e){vr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){vr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gu(t){const e=t;if(e.storageArea===this.storage){if(vr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.pu)return void br("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.vs.xi(async()=>{if(this.lr){if(null!==e.key)if(this.vu.test(e.key)){if(null==e.newValue){const t=this.Xu(e.key);return this.Zu(t,null)}{const t=this.th(e.key,e.newValue);if(t)return this.Zu(t.clientId,t)}}else if(this.Su.test(e.key)){if(null!==e.newValue){const t=this.eh(e.key,e.newValue);if(t)return this.nh(t)}}else if(this.Du.test(e.key)){if(null!==e.newValue){const t=this.sh(e.key,e.newValue);if(t)return this.ih(t)}}else if(e.key===this.Cu){if(null!==e.newValue){const t=this.xu(e.newValue);if(t)return this.Ou(t)}}else if(e.key===this.bu){const t=function(t){let e=Jo.bs;if(null!=t)try{const n=JSON.parse(t);Tr("number"==typeof n),e=n}catch(t){br("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Jo.bs&&this.gs(t)}}else this.yu.push(e)})}}get Ku(){return this.Vu.get(this.Au)}Nu(){this.setItem(this.pu,this.Ku.Tu())}Lu(t,e,n){const r=new bc(this.currentUser,t,e,n),i=wc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Tu())}Bu(t){const e=wc(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Yu(t){const e={clientId:this.Au,onlineState:t};this.storage.setItem(this.Cu,JSON.stringify(e))}zu(t,e,n){const r=vc(this.persistenceKey,t),i=new Ec(t,e,n);this.setItem(r,i.Tu())}Xu(t){const e=this.vu.exec(t);return e?e[1]:null}th(t,e){const n=this.Xu(t);return Ic.Eu(n,e)}eh(t,e){const n=this.Su.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return bc.Eu(new mr(i),r,e)}sh(t,e){const n=this.Du.exec(t),r=Number(n[1]);return Ec.Eu(r,e)}xu(t){return _c.Eu(t)}async nh(t){if(t.user.uid===this.currentUser.uid)return this.Ru.rh(t.batchId,t.state,t.error);vr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}ih(t){return this.Ru.oh(t.targetId,t.state,t.error)}Zu(t,e){const n=e?this.Vu.dt(t,e):this.Vu.remove(t),r=this.Mu(this.Vu),i=this.Mu(n),s=[],o=[];return i.forEach(t=>{r.has(t)||s.push(t)}),r.forEach(t=>{i.has(t)||o.push(t)}),this.Ru.ah(s,o).then(()=>{this.Vu=n})}Ou(t){this.Vu.get(t.clientId)&&this.ma(t.onlineState)}Mu(t){let e=vi();return t.forEach((t,n)=>{e=e.Qt(n.activeTargetIds)}),e}}class Ac{constructor(){this.uh=new Tc,this.hh={},this.ma=null,this.gs=null}ku(t){}qu(t,e,n){}Uu(t){return this.uh.Iu(t),this.hh[t]||"not-current"}Gu(t,e,n){this.hh[t]=e}Qu(t){this.uh.mu(t)}Wu(t){return this.uh.activeTargetIds.has(t)}ju(t){delete this.hh[t]}Fu(){return this.uh.activeTargetIds}$u(t){return this.uh.activeTargetIds.has(t)}start(){return this.uh=new Tc,Promise.resolve()}Hu(t,e,n){}Ju(t){}_c(){}ps(t){}}class Sc{constructor(t){this.key=t}}class Lc{constructor(t){this.key=t}}class xc{constructor(t,e){this.query=t,this.lh=e,this._h=null,this.ae=!1,this.fh=yi(),this.Xt=yi(),this.dh=Ao(t),this.wh=new bi(this.dh)}get Eh(){return this.lh}Th(t,e){const n=e?e.Ih:new Ei,r=e?e.wh:this.wh;let i=e?e.Xt:this.Xt,s=r,o=!1;const a=go(this.query)&&r.size===this.query.limit?r.last():null,u=mo(this.query)&&r.size===this.query.limit?r.first():null;if(t.It((t,e)=>{const c=r.get(t);let h=e instanceof uo?e:null;h&&(h=No(this.query,h)?h:null);const l=!!c&&this.Xt.has(c.key),f=!!h&&(h.on||this.Xt.has(h.key)&&h.hasCommittedMutations);let d=!1;c&&h?c.data().isEqual(h.data())?l!==f&&(n.track({type:3,doc:h}),d=!0):this.mh(c,h)||(n.track({type:2,doc:h}),d=!0,(a&&this.dh(h,a)>0||u&&this.dh(h,u)<0)&&(o=!0)):!c&&h?(n.track({type:0,doc:h}),d=!0):c&&!h&&(n.track({type:1,doc:c}),d=!0,(a||u)&&(o=!0)),d&&(h?(s=s.add(h),i=f?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))}),go(this.query)||mo(this.query))for(;s.size>this.query.limit;){const t=go(this.query)?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{wh:s,Ih:n,Ah:o,Xt:i}}mh(t,e){return t.on&&e.hasCommittedMutations&&!e.on}Jn(t,e,n){const r=this.wh;this.wh=t.wh,this.Xt=t.Xt;const i=t.Ih.Jt();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _r()}};return n(t)-n(e)})(t.type,e.type)||this.dh(t.doc,e.doc)),this.Rh(n);const s=e?this.Ph():[],o=0===this.fh.size&&this.ae?1:0,a=o!==this._h;return this._h=o,0!==i.length||a?{snapshot:new Ii(this.query,t.wh,r,i,t.Xt,0===o,a,!1),gh:s}:{gh:s}}Ha(t){return this.ae&&"Offline"===t?(this.ae=!1,this.Jn({wh:this.wh,Ih:new Ei,Xt:this.Xt,Ah:!1},!1)):{gh:[]}}Vh(t){return!this.lh.has(t)&&!!this.wh.has(t)&&!this.wh.get(t).on}Rh(t){t&&(t.ue.forEach(t=>this.lh=this.lh.add(t)),t.he.forEach(t=>{}),t.le.forEach(t=>this.lh=this.lh.delete(t)),this.ae=t.ae)}Ph(){if(!this.ae)return[];const t=this.fh;this.fh=yi(),this.wh.forEach(t=>{this.Vh(t.key)&&(this.fh=this.fh.add(t.key))});const e=[];return t.forEach(t=>{this.fh.has(t)||e.push(new Lc(t))}),this.fh.forEach(n=>{t.has(n)||e.push(new Sc(n))}),e}yh(t){this.lh=t.kc,this.fh=yi();const e=this.Th(t.documents);return this.Jn(e,!0)}ph(){return Ii.ee(this.query,this.wh,this.Xt,0===this._h)}}class Dc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Oc{constructor(t){this.key=t,this.bh=!1}}class Rc{constructor(t,e,n,r,i,s){this.va=t,this.Sh=e,this.Dh=n,this.Ch=r,this.currentUser=i,this.Nh=s,this.xh={},this.Oh=new zo(t=>_o(t),Io),this.Fh=new Map,this.Mh=[],this.$h=new si(jr.N),this.kh=new Map,this.Lh=new gc,this.qh={},this.Bh=new Map,this.Uh=du.fo(),this.onlineState="Unknown",this.Kh=void 0}get Qh(){return!0===this.Kh}}async function kc(t,e,n,r){t.Wh=((e,n,r)=>(async function(t,e,n,r){let i=e.view.Th(n);i.Ah&&(i=await ku(t.va,e.query,!1).then(({documents:t})=>e.view.Th(t,i)));const s=r&&r.ne.get(e.targetId),o=e.view.Jn(i,t.Qh,s);return jc(t,e.targetId,o.gh),o.snapshot})(t,e,n,r));const i=await ku(t.va,e,!0),s=new xc(e,i.kc),o=s.Th(i.documents),a=Ti.ce(n,r&&"Offline"!==t.onlineState),u=s.Jn(o,t.Qh,a);jc(t,n,u.gh);const c=new Dc(e,n,s);return t.Oh.set(e,c),t.Fh.has(n)?t.Fh.get(n).push(e):t.Fh.set(n,[e]),u.snapshot}async function Cc(t,e){const n=Nr(t);try{const r=await function(t,e){const n=Nr(t),r=e.ht;let i=n.Sc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const s=n.Nc.so({ro:!0});i=n.Sc;const o=[];e.ne.forEach((e,s)=>{const a=i.get(s);if(!a)return;o.push(n.jo.Co(t,e.le,s).next(()=>n.jo.So(t,e.ue,s)));const u=e.resumeToken;if(u.ct()>0){const c=a._t(u,r).lt(t.Oo);i=i.dt(s,c),function(t,e,n){return Tr(e.resumeToken.ct()>0),0===t.resumeToken.ct()||e.ht.S()-t.ht.S()>=3e8||n.ue.size+n.he.size+n.le.size>0}(a,c,e)&&o.push(n.jo.Vo(t,c))}});let a=li(),u=yi();if(e.ie.forEach((t,e)=>{u=u.add(t)}),o.push(s.getEntries(t,u).next(i=>{e.ie.forEach((u,c)=>{const h=i.get(u);c instanceof co&&c.version.isEqual(Vr.min())?(s.jn(u,r),a=a.dt(u,c)):null==h||c.version.v(h.version)>0||0===c.version.v(h.version)&&h.hasPendingWrites?(s.Qn(c,r),a=a.dt(u,c)):vr("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.re.has(u)&&o.push(n.persistence.yr.bc(t,u))})})),!r.isEqual(Vr.min())){const e=n.jo.To(t).next(e=>n.jo.mo(t,t.Oo,r));o.push(e)}return Ho.Ln(o).next(()=>s.apply(t)).next(()=>n.xc.hs(t,a))}).then(t=>(n.Sc=i,t))}(n.va,e);e.ne.forEach((t,e)=>{const r=n.kh.get(e);r&&(Tr(t.ue.size+t.he.size+t.le.size<=1),t.ue.size>0?r.bh=!0:t.he.size>0?Tr(r.bh):t.le.size>0&&(Tr(r.bh),r.bh=!1))}),await Gc(n,r,e)}catch(t){await Pu(t)}}function Pc(t,e,n){const r=Nr(t);if(r.Qh&&0===n||!r.Qh&&1===n){const t=[];r.Oh.forEach((n,r)=>{const i=r.view.Ha(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=Nr(t);n.onlineState=e;let r=!1;n.ja.forEach((t,n)=>{for(const t of n.listeners)t.Ha(e)&&(r=!0)}),r&&dc(n)}(r.Dh,e),t.length&&r.xh.oa(t),r.onlineState=e,r.Qh&&r.Ch.Ju(e)}}async function Vc(t,e){const n=Nr(t),r=e.batch.batchId;try{const i=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const r=e.batch.keys(),i=n.Nc.so({ro:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Ho.resolve();return s.forEach(t=>{o=o.next(()=>r.Gn(e,t)).next(e=>{let s=e;const o=n.bn.get(t);Tr(null!==o),(!s||s.version.v(o)<0)&&(s=i.Pn(t,s,n))&&r.Qn(s,n.pn)})}),o.next(()=>t.es.kr(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.es.Ur(t)).next(()=>n.xc.us(t,r))})}(n.va,e);Uc(n,r,null),Mc(n,r),n.Ch.qu(r,"acknowledged"),await Gc(n,i)}catch(t){await Pu(t)}}function Mc(t,e){(t.Bh.get(e)||[]).forEach(t=>{t.resolve()}),t.Bh.delete(e)}function Uc(t,e,n){const r=Nr(t);let i=r.qh[r.currentUser.i()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.qh[r.currentUser.i()]=i}}function Fc(t,e,n=null){t.Ch.Qu(e);for(const r of t.Fh.get(e))t.Oh.delete(r),n&&t.xh.jh(r,n);t.Fh.delete(e),t.Qh&&t.Lh._u(e).forEach(e=>{t.Lh.Kr(e)||qc(t,e)})}function qc(t,e){const n=t.$h.get(e);null!==n&&(Hu(t.Sh,n),t.$h=t.$h.remove(e),t.kh.delete(n),Bc(t))}function jc(t,e,n){for(const r of n)r instanceof Sc?(t.Lh.Do(r.key,e),$c(t,r)):r instanceof Lc?(vr("SyncEngine","Document no longer in limbo: "+r.key),t.Lh.No(r.key,e),t.Lh.Kr(r.key)||qc(t,r.key)):_r()}function $c(t,e){const n=e.key;t.$h.get(n)||(vr("SyncEngine","New document in limbo: "+n),t.Mh.push(n),Bc(t))}function Bc(t){for(;t.Mh.length>0&&t.$h.size<t.Nh;){const e=t.Mh.shift(),n=t.Uh.next();t.kh.set(n,new Oc(e)),t.$h=t.$h.dt(e,n),zu(t.Sh,new Zr(Eo(po(e.path)),n,2,Jo.bs))}}async function Gc(t,e,n){const r=Nr(t),i=[],s=[],o=[];r.Oh.L()||(r.Oh.forEach((t,a)=>{o.push(r.Wh(a,e,n).then(t=>{if(t){r.Qh&&r.Ch.Gu(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Qo.Ps(a.targetId,t);s.push(e)}}))}),await Promise.all(o),r.xh.oa(i),await async function(t,e){const n=Nr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Ho.forEach(e,e=>Ho.forEach(e.As,r=>n.persistence.yr.Do(t,e.targetId,r)).next(()=>Ho.forEach(e.Rs,r=>n.persistence.yr.No(t,e.targetId,r)))))}catch(t){if(!ia(t))throw t;vr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Sc.get(e),r=t.ht,i=t.ft(r);n.Sc=n.Sc.dt(e,i)}}}(r.va,s))}async function zc(t,e){const n=Nr(t),r=await ku(n.va,e.query,!0),i=e.view.yh(r);return n.Qh&&jc(n,e.targetId,i.gh),i}async function Hc(t,e,n){const r=Nr(t),i=[],s=[];for(const t of e){let e;const n=r.Fh.get(t);if(n&&0!==n.length){e=await Ou(r.va,Eo(n[0]));for(const t of n){const e=r.Oh.get(t),n=await zc(r,e);n.snapshot&&s.push(n.snapshot)}}else{const n=await Cu(r.va,t);e=await Ou(r.va,n),await kc(r,Kc(n),t,!1)}i.push(e)}return r.xh.oa(s),i}function Kc(t){return fo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Wc(t){const e=Nr(t);return e.Sh.Da.qa=Cc.bind(null,e),e.Sh.Da.He=function(t,e){const n=Nr(t),r=n.kh.get(e);if(r&&r.bh)return yi().add(r.key);{let t=yi();const r=n.Fh.get(e);if(!r)return t;for(const e of r){const r=n.Oh.get(e);t=t.Qt(r.view.Eh)}return t}}.bind(null,e),e.Sh.Da.La=async function(t,e,n){const r=Nr(t);r.Ch.Gu(e,"rejected",n);const i=r.kh.get(e),s=i&&i.key;if(s){let t=new si(jr.N);t=t.dt(s,new co(s,Vr.min()));const n=yi().add(s),i=new _i(Vr.min(),new Map,new ui(Rr),t,n);await Cc(r,i),r.$h=r.$h.remove(s),r.kh.delete(e),Bc(r)}else await Ru(r.va,e,!1).then(()=>Fc(r,e,n)).catch(Pu)}.bind(null,e),e.xh.oa=function(t,e){const n=Nr(t);let r=!1;for(const t of e){const e=t.query,i=n.ja.get(e);if(i){for(const e of i.listeners)e.Ja(t)&&(r=!0);i.Wa=t}}r&&dc(n)}.bind(null,e.Dh),e.xh.jh=function(t,e,n){const r=Nr(t),i=r.ja.get(e);if(i)for(const t of i.listeners)t.onError(n);r.ja.delete(e)}.bind(null,e.Dh),e}function Xc(t){const e=Nr(t);return e.Sh.Da.Ba=Vc.bind(null,e),e.Sh.Da.Ua=async function(t,e,n){const r=Nr(t);try{const t=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return n.es.Cr(t,e).next(e=>(Tr(null!==e),r=e.keys(),n.es.kr(t,e))).next(()=>n.es.Ur(t)).next(()=>n.xc.us(t,r))})}(r.va,e);Uc(r,e,n),Mc(r,e),r.Ch.qu(e,"rejected",n),await Gc(r,t)}catch(n){await Pu(n)}}.bind(null,e),e}class Yc{Oc(t){this.Gh=t}_s(e,n,r,i){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.dn.length||1===t.dn.length&&t.dn[0].field.H())}(n)||r.isEqual(Vr.min())?this.zh(e,n):this.Gh.us(e,i).next(s=>{const o=this.Hh(n,s);return(go(n)||mo(n))&&this.Ah(n.wn,o,i,r)?this.zh(e,n):(wr()<=t.LogLevel.DEBUG&&vr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),To(n)),this.Gh._s(e,n,r).next(t=>(o.forEach(e=>{t=t.dt(e.key,e)}),t)))})}Hh(t,e){let n=new ui(Ao(t));return e.forEach((e,r)=>{r instanceof uo&&No(t,r)&&(n=n.add(r))}),n}Ah(t,e,n,r){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.v(r)>0)}zh(e,n){return wr()<=t.LogLevel.DEBUG&&vr("IndexFreeQueryEngine","Using full collection scan to execute query:",To(n)),this.Gh._s(e,n,Vr.min())}}class Qc{constructor(t,e){this.ns=t,this.yr=e,this.es=[],this.Jh=1,this.Yh=new ui(mc.ou)}vr(t){return Ho.resolve(0===this.es.length)}Sr(t,e,n,r){const i=this.Jh;this.Jh++,this.es.length>0&&this.es[this.es.length-1];const s=new Bo(i,e,n,r);this.es.push(s);for(const e of r)this.Yh=this.Yh.add(new mc(e.key,i)),this.ns.Dr(t,e.key.path.M());return Ho.resolve(s)}Cr(t,e){return Ho.resolve(this.Xh(e))}Or(t,e){const n=e+1,r=this.Zh(n),i=r<0?0:r;return Ho.resolve(this.es.length>i?this.es[i]:null)}Fr(){return Ho.resolve(0===this.es.length?-1:this.Jh-1)}Mr(t){return Ho.resolve(this.es.slice())}rs(t,e){const n=new mc(e,0),r=new mc(e,Number.POSITIVE_INFINITY),i=[];return this.Yh.Bt([n,r],t=>{const e=this.Xh(t.wu);i.push(e)}),Ho.resolve(i)}ls(t,e){let n=new ui(Rr);return e.forEach(t=>{const e=new mc(t,0),r=new mc(t,Number.POSITIVE_INFINITY);this.Yh.Bt([e,r],t=>{n=n.add(t.wu)})}),Ho.resolve(this.tl(n))}Ts(t,e){const n=e.path,r=n.length+1;let i=n;jr.et(i)||(i=i.child(""));const s=new mc(new jr(i),0);let o=new ui(Rr);return this.Yh.Ut(t=>{const e=t.key.path;return!!n.q(e)&&(e.length===r&&(o=o.add(t.wu)),!0)},s),Ho.resolve(this.tl(o))}tl(t){const e=[];return t.forEach(t=>{const n=this.Xh(t);null!==n&&e.push(n)}),e}kr(t,e){Tr(0===this.el(e.batchId,"removed")),this.es.shift();let n=this.Yh;return Ho.forEach(e.mutations,r=>{const i=new mc(r.key,e.batchId);return n=n.delete(i),this.yr.Br(t,r.key)}).next(()=>{this.Yh=n})}qr(t){}Kr(t,e){const n=new mc(e,0),r=this.Yh.Kt(n);return Ho.resolve(e.isEqual(r&&r.key))}Ur(t){return this.es.length,Ho.resolve()}el(t,e){return this.Zh(t)}Zh(t){return 0===this.es.length?0:t-this.es[0].batchId}Xh(t){const e=this.Zh(t);return e<0||e>=this.es.length?null:this.es[e]}}class Jc{constructor(t,e){this.ns=t,this.nl=e,this.docs=new si(jr.N),this.size=0}Qn(t,e,n){const r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.nl(e);return this.docs=this.docs.dt(r,{zr:e,size:o,readTime:n}),this.size+=o-s,this.ns.Dr(t,r.path.M())}jn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Gn(t,e){const n=this.docs.get(e);return Ho.resolve(n?n.zr:null)}getEntries(t,e){let n=fi();return e.forEach(t=>{const e=this.docs.get(t);n=n.dt(t,e?e.zr:null)}),Ho.resolve(n)}_s(t,e,n){let r=pi();const i=new jr(e.path.child("")),s=this.docs.Pt(i);for(;s.St();){const{key:t,value:{zr:i,readTime:o}}=s.vt();if(!e.path.q(t.path))break;o.v(n)<=0||i instanceof uo&&No(e,i)&&(r=r.dt(i.key,i))}return Ho.resolve(r)}sl(t,e){return Ho.forEach(this.docs,t=>e(t))}so(t){return new Jc.io(this)}oo(t){return Ho.resolve(this.size)}}Jc.io=class extends Ko{constructor(t){super(),this.co=t}Jn(t){const e=[];return this.Bn.forEach((n,r)=>{r?e.push(this.co.Qn(t,r,this.readTime)):this.co.jn(n)}),Ho.Ln(e)}zn(t,e){return this.co.Gn(t,e)}Hn(t,e){return this.co.getEntries(t,e)}};class Zc{constructor(t){this.persistence=t,this.il=new zo(t=>Xr(t),Yr),this.lastRemoteSnapshotVersion=Vr.min(),this.highestTargetId=0,this.rl=0,this.ol=new gc,this.targetCount=0,this.cl=du._o()}Le(t,e){return this.il.forEach((t,n)=>e(n)),Ho.resolve()}To(t){return Ho.resolve(this.lastRemoteSnapshotVersion)}Io(t){return Ho.resolve(this.rl)}do(t){return this.highestTargetId=this.cl.next(),Ho.resolve(this.highestTargetId)}mo(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.rl&&(this.rl=e),Ho.resolve()}Ro(t){this.il.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.cl=new du(e),this.highestTargetId=e),t.sequenceNumber>this.rl&&(this.rl=t.sequenceNumber)}Ao(t,e){return this.Ro(e),this.targetCount+=1,Ho.resolve()}Vo(t,e){return this.Ro(e),Ho.resolve()}yo(t,e){return this.il.delete(e.target),this.ol._u(e.targetId),this.targetCount-=1,Ho.resolve()}mr(t,e,n){let r=0;const i=[];return this.il.forEach((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.il.delete(s),i.push(this.po(t,o.targetId)),r++)}),Ho.Ln(i).next(()=>r)}bo(t){return Ho.resolve(this.targetCount)}vo(t,e){const n=this.il.get(e)||null;return Ho.resolve(n)}So(t,e,n){return this.ol.uu(e,n),Ho.resolve()}Co(t,e,n){this.ol.lu(e,n);const r=this.persistence.yr,i=[];return r&&e.forEach(e=>{i.push(r.Br(t,e))}),Ho.Ln(i)}po(t,e){return this.ol._u(e),Ho.resolve()}xo(t,e){const n=this.ol.du(e);return Ho.resolve(n)}Kr(t,e){return Ho.resolve(this.ol.Kr(e))}}class th{constructor(t){this.al={},this.$o=new Jo(0),this.ko=!1,this.ko=!0,this.yr=t(this),this.jo=new Zc(this),this.ns=new Ha,this.ts=new Jc(this.ns,t=>this.yr.ul(t))}start(){return Promise.resolve()}_c(){return this.ko=!1,Promise.resolve()}get lr(){return this.ko}Zo(){}tc(){}Rc(){return this.ns}Ic(t){let e=this.al[t.i()];return e||(e=new Qc(this.ns,this.yr),this.al[t.i()]=e),e}mc(){return this.jo}Ac(){return this.ts}runTransaction(t,e,n){vr("MemoryPersistence","Starting transaction:",t);const r=new eh(this.$o.next());return this.yr.hl(),n(r).next(t=>this.yr.ll(r).next(()=>t)).$n().then(t=>(r.Zn(),t))}_l(t,e){return Ho.qn(Object.values(this.al).map(n=>()=>n.Kr(t,e)))}}class eh extends Xo{constructor(t){super(),this.Oo=t}}class nh{constructor(t){this.persistence=t,this.fl=new gc,this.dl=null}static wl(t){return new nh(t)}get El(){if(this.dl)return this.dl;throw _r()}Do(t,e,n){return this.fl.Do(n,e),this.El.delete(n.toString()),Ho.resolve()}No(t,e,n){return this.fl.No(n,e),this.El.add(n.toString()),Ho.resolve()}Br(t,e){return this.El.add(e.toString()),Ho.resolve()}removeTarget(t,e){this.fl._u(e.targetId).forEach(t=>this.El.add(t.toString()));const n=this.persistence.mc();return n.xo(t,e.targetId).next(t=>{t.forEach(t=>this.El.add(t.toString()))}).next(()=>n.yo(t,e))}hl(){this.dl=new Set}ll(t){const e=this.persistence.Ac().so();return Ho.forEach(this.El,n=>{const r=jr.X(n);return this.Tl(t,r).next(t=>{t||e.jn(r)})}).next(()=>(this.dl=null,e.apply(t)))}bc(t,e){return this.Tl(t,e).next(t=>{t?this.El.delete(e.toString()):this.El.add(e.toString())})}ul(t){return 0}Tl(t,e){return Ho.qn([()=>Ho.resolve(this.fl.Kr(e)),()=>this.persistence.mc().Kr(t,e),()=>this.persistence._l(t,e)])}}class rh{constructor(t){this.Il=t.Il,this.ml=t.ml}ia(t){this.Al=t}Zc(t){this.Rl=t}onMessage(t){this.Pl=t}close(){this.ml()}send(t){this.Il(t)}gl(){this.Al()}Vl(t){this.Rl(t)}yl(t){this.Pl(t)}}const ih={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class sh extends class{constructor(t){this.pl=t,this.st=t.st;const e=t.ssl?"https":"http";this.bl=e+"://"+t.host,this.vl="projects/"+this.st.projectId+"/databases/"+this.st.database+"/documents"}Ta(t,e,n,r){const i=this.Sl(t,e);vr("RestConnection","Sending: ",i,n);const s={};return this.Dl(s,r),this.Cl(t,i,s,n).then(t=>(vr("RestConnection","Received: ",t),t),e=>{throw Er("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}Ia(t,e,n,r){return this.Ta(t,e,n,r)}Dl(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.21.1",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}Sl(t,e){const n=ih[t];return`${this.bl}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling}Cl(t,e,n,r){return new Promise((i,s)=>{const o=new gr;o.listenOnce(dr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case fr.NO_ERROR:const e=o.getResponseJson();vr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case fr.TIMEOUT:vr("Connection",'RPC "'+t+'" timed out'),s(new Sr(Ar.DEADLINE_EXCEEDED,"Request time out"));break;case fr.HTTP_ERROR:const n=o.getStatus();if(vr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace("_","-");return Object.values(Ar).indexOf(e)>=0?e:Ar.UNKNOWN}(t.status);s(new Sr(e,t.message))}else s(new Sr(Ar.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Sr(Ar.UNAVAILABLE,"Connection failed."));break;default:_r()}}finally{vr("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(r);o.send(e,"POST",a,n,15)})}ra(t,e){const n=[this.bl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=lr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.st.projectId}/databases/${this.st.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};var o,a;this.Dl(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(r())||"object"==typeof navigator&&"ReactNative"===navigator.product||r().indexOf("Electron/")>=0||((a=r()).indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0)||r().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(s.httpHeadersOverwriteParam="$httpHeaders");const u=n.join("");vr("Connection","Creating WebChannel: "+u,s);const c=i.createWebChannel(u,s);let h=!1,l=!1;const f=new rh({Il:t=>{l?vr("Connection","Not sending because WebChannel is closed:",t):(h||(vr("Connection","Opening WebChannel transport."),c.open(),h=!0),vr("Connection","WebChannel sending:",t),c.send(t))},ml:()=>c.close()}),d=(t,e)=>{c.listen(t,t=>{try{e(t)}catch(t){setTimeout(()=>{throw t},0)}})};return d(pr.EventType.OPEN,()=>{l||vr("Connection","WebChannel transport opened.")}),d(pr.EventType.CLOSE,()=>{l||(l=!0,vr("Connection","WebChannel transport closed"),f.Vl())}),d(pr.EventType.ERROR,t=>{l||(l=!0,Er("Connection","WebChannel transport errored:",t),f.Vl(new Sr(Ar.UNAVAILABLE,"The operation could not be completed")))}),d(pr.EventType.MESSAGE,t=>{var e;if(!l){const n=t.data[0];Tr(!!n);const r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){vr("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=ei[t];if(void 0!==e)return ii(e)}(t),n=i.message;void 0===e&&(e=Ar.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),l=!0,f.Vl(new Sr(e,n)),c.close()}else vr("Connection","WebChannel received:",n),f.yl(n)}}),setTimeout(()=>{f.gl()},0),f}}class oh{constructor(){this.Nl=(()=>this.xl()),this.Ol=(()=>this.Fl()),this.Ml=[],this.$l()}Ma(t){this.Ml.push(t)}_c(){window.removeEventListener("online",this.Nl),window.removeEventListener("offline",this.Ol)}$l(){window.addEventListener("online",this.Nl),window.addEventListener("offline",this.Ol)}xl(){vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Ml)t(0)}Fl(){vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Ml)t(1)}static Qs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class ah{Ma(t){}_c(){}}function uh(t){return new sh(t)}function ch(t){return new es(t,!0)}const hh="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.";class lh{async initialize(t){this.Ch=this.kl(t),this.persistence=this.Ll(t),await this.persistence.start(),this.ql=this.Bl(t),this.va=this.Ul(t)}Bl(t){return null}Ul(t){return e=this.persistence,n=new Yc,r=t.Kl,new Su(e,n,r);var e,n,r}Ll(t){if(t.persistenceSettings.Ql)throw new Sr(Ar.FAILED_PRECONDITION,hh);return new th(nh.wl)}kl(t){return new Ac}async terminate(){this.ql&&this.ql.stop(),await this.Ch._c(),await this.persistence._c()}clearPersistence(t,e){throw new Sr(Ar.FAILED_PRECONDITION,hh)}}class fh extends lh{constructor(t){super(),this.Wl=t}async initialize(t){await super.initialize(t),await async function(t){const e=Nr(t),n=Nr(e.Nc);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>n.no(t)).then(t=>{e.Cc=t})}(this.va),await this.Wl.initialize(this,t),await Xc(this.Wl.Ru),await ec(this.Wl.Sh)}Bl(t){const e=this.persistence.yr.cr;return new va(e,t.li)}Ll(t){const e=Nu(t.pl.st,t.pl.persistenceKey),n=ch(t.pl.st);return new bu(t.persistenceSettings.synchronizeTabs,e,t.clientId,wa.Xi(t.persistenceSettings.cacheSizeBytes),t.li,ha(),la(),n,this.Ch,t.persistenceSettings.Mo)}kl(t){return new Ac}clearPersistence(t,e){return Au(Nu(t,e))}}class dh extends fh{async initialize(t){await super.initialize(t);const e=this.Wl.Ru;this.Ch instanceof Nc&&(this.Ch.Ru={rh:async function(t,e,n,r){const i=Nr(t),s=await function(t,e){const n=Nr(t),r=Nr(n.es);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>r.Nr(t,e).next(e=>e?n.xc.us(t,e):Ho.resolve(null)))}(i.va,e);null!==s?("pending"===n?await ec(i.Sh):"acknowledged"===n||"rejected"===n?(Uc(i,e,r||null),Mc(i,e),function(t,e){Nr(Nr(t).es).qr(e)}(i.va,e)):_r(),await Gc(i,s)):vr("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),oh:async function(t,e,n,r){const i=Nr(t);if(i.Kh)vr("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fh.has(e))switch(n){case"current":case"not-current":{const t=await function(t){const e=Nr(i.va),n=Nr(e.Nc);return e.persistence.runTransaction("Get new document changes","readonly",t=>n.Zr(t,e.Cc)).then(({eo:t,readTime:n})=>(e.Cc=n,t))}(),r=_i.oe(e,"current"===n);await Gc(i,t,r);break}case"rejected":await Ru(i.va,e,!0),Fc(i,e,r);break;default:_r()}}.bind(null,e),ah:async function(t,e,n){const r=Wc(t);if(r.Kh){for(const t of e){if(r.Fh.has(t)){vr("SyncEngine","Adding an already active target "+t);continue}const e=await Cu(r.va,t),n=await Ou(r.va,e);await kc(r,Kc(e),n.targetId,!1),zu(r.Sh,n)}for(const t of n)r.Fh.has(t)&&await Ru(r.va,t,!1).then(()=>{Hu(r.Sh,t),Fc(r,t)}).catch(Pu)}}.bind(null,e),Tc:function(t){return Nr(Nr(Nr(t).va).persistence).Tc()}.bind(null,e)},await this.Ch.start()),await this.persistence.Xo(async t=>{await async function(t,e){const n=Nr(t);if(Wc(n),Xc(n),!0===e&&!0!==n.Kh){const t=n.Ch.Fu(),e=await Hc(n,t.U());n.Kh=!0,await oc(n.Sh,!0);for(const t of e)zu(n.Sh,t)}else if(!1===e&&!1!==n.Kh){const t=[];let e=Promise.resolve();n.Fh.forEach((r,i)=>{n.Ch.Wu(i)?t.push(i):e=e.then(()=>(Fc(n,i),Ru(n.va,i,!0))),Hu(n.Sh,i)}),await e,await Hc(n,t),function(t){const e=Nr(n);e.kh.forEach((t,n)=>{Hu(e.Sh,n)}),e.Lh.fu(),e.kh=new Map,e.$h=new si(jr.N)}(),n.Kh=!1,await oc(n.Sh,!1)}}(this.Wl.Ru,t),this.ql&&(t&&!this.ql.lr?this.ql.start(this.va):t||this.ql.stop())})}kl(t){if(t.persistenceSettings.Ql&&t.persistenceSettings.synchronizeTabs){const e=ha();if(!Nc.Qs(e))throw new Sr(Ar.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Nu(t.pl.st,t.pl.persistenceKey);return new Nc(e,t.li,n,t.clientId,t.Kl)}return new Ac}}class ph{async initialize(t,e){this.va||(this.va=t.va,this.Ch=t.Ch,this.Sa=this.jl(e),this.Sh=this.Gl(e),this.Dh=this.zl(e),this.Ru=this.Hl(e),this.Ch.ma=(t=>Pc(this.Ru,t,1)),this.Sh.Da.Jl=async function(t,e){const n=Nr(t);if(!n.currentUser.isEqual(e)){vr("SyncEngine","User change. New user:",e.i());const t=await Lu(n.va,e);n.currentUser=e,function(t,e){t.Bh.forEach(t=>{t.forEach(t=>{t.reject(new Sr(Ar.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Bh.clear()}(n),n.Ch.Hu(e,t.Mc,t.$c),await Gc(n,t.Fc)}}.bind(null,this.Ru),await oc(this.Sh,this.Ru.Qh))}zl(t){return new hc}jl(t){const e=ch(t.pl.st),n=uh(t.pl);return qu(t.credentials,n,e)}Gl(t){return e=this.va,n=this.Sa,r=t.li,i=(t=>Pc(this.Ru,t,0)),s=oh.Qs()?new oh:new ah,new $u(e,n,r,i,s);var e,n,r,i,s}Hl(t){return function(t,e,n,r,i,s,o){const a=new Rc(t,e,n,r,i,s);return o&&(a.Kh=!0),a}(this.va,this.Sh,this.Dh,this.Ch,t.Kl,t.Nh,!t.persistenceSettings.Ql||!t.persistenceSettings.synchronizeTabs)}terminate(){return async function(t){const e=Nr(t);vr("RemoteStore","RemoteStore shutting down."),e.xa.add(5),await Gu(e),e.Fa._c(),e.$a.set("Unknown")}(this.Sh)}}class gh{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Yl(this.observer.next,t)}error(t){this.observer.error?this.Yl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Xl(){this.muted=!0}Yl(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function mh(t,e,n){if(e.length!==n)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires `+Nh(n,"argument")+", but was called with "+Nh(e.length,"argument")+".")}function yh(t,e,n){if(e.length<n)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires at least `+Nh(n,"argument")+", but was called with "+Nh(e.length,"argument")+".")}function wh(t,e,n,r){!function(t,e,n,r){let i=!1;if(!(i="object"===e?Eh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){const i=Ih(r);throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${i}`)}}(t,e,Th(n)+" argument",r)}function vh(t){if(!jr.et(t))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function bh(t){if(jr.et(t))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Eh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ih(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_r()}function _h(t,e,n){if(n<=0)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires its ${Th(e)} argument to be a positive number, but it was: ${n}.`)}function Th(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Nh(t,e){return`${t} ${e}`+(1===t?"":"s")}class Ah{constructor(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new Sr(Ar.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Nh(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(wh("FieldPath","string",e,t[e]),0===t[e].length)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Zl=new qr(t)}}class Sh extends Ah{constructor(...t){super(t)}static documentId(){return new Sh(qr.J().K())}isEqual(t){if(!(t instanceof Sh))throw function(t,e,n,r){const i=Ih(r);return new Sr(Ar.INVALID_ARGUMENT,`Function isEqual() requires its ${Th(1)} argument to be a FieldPath, but it was: ${i}`)}(0,0,0,t);return this.Zl.isEqual(t.Zl)}}const Lh=new RegExp("[~\\*/\\[\\]]");class xh{constructor(t){this.t_=t}}class Dh extends xh{e_(t){if(2!==t.n_)throw 1===t.n_?t.s_(this.t_+"() can only appear at the top level of your update data"):t.s_(this.t_+"() cannot be used with set() unless you pass {merge:true}");return t.Xe.push(t.path),null}isEqual(t){return t instanceof Dh}}function Oh(t,e,n){return new Gh({n_:3,i_:e.settings.i_,methodName:t.t_,r_:n},e.st,e.serializer,e.ignoreUndefinedProperties)}class Rh extends xh{e_(t){return new qs(t.path,new Os)}isEqual(t){return t instanceof Rh}}class kh extends xh{constructor(t,e){super(t),this.o_=e}e_(t){const e=Oh(this,t,!0),n=this.o_.map(t=>Yh(t,e)),r=new Rs(n);return new qs(t.path,r)}isEqual(t){return this===t}}class Ch extends xh{constructor(t,e){super(t),this.o_=e}e_(t){const e=Oh(this,t,!0),n=this.o_.map(t=>Yh(t,e)),r=new Cs(n);return new qs(t.path,r)}isEqual(t){return this===t}}class Ph extends xh{constructor(t,e){super(t),this.c_=e}e_(t){const e=new Vs(t.serializer,is(t.serializer,this.c_));return new qs(t.path,e)}isEqual(t){return this===t}}class Vh{constructor(t,e){if(mh("GeoPoint",arguments,2),wh("GeoPoint","number",1,t),wh("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new Sr(Ar.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Sr(Ar.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.a_=t,this.u_=e}get latitude(){return this.a_}get longitude(){return this.u_}isEqual(t){return this.a_===t.a_&&this.u_===t.u_}toJSON(){return{latitude:this.a_,longitude:this.u_}}V(t){return Rr(this.a_,t.a_)||Rr(this.u_,t.u_)}}class Mh{constructor(t){this.h_=t}static fromBase64String(t){try{return new Mh(Jr.fromBase64String(t))}catch(t){throw new Sr(Ar.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}}static fromUint8Array(t){return new Mh(Jr.fromUint8Array(t))}toBase64(){return this.h_.toBase64()}toUint8Array(){return this.h_.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.h_.isEqual(t.h_)}}class Uh{constructor(t){this.l_=t}}const Fh=/^__.*__$/;class qh{constructor(t,e,n){this.__=t,this.f_=e,this.d_=n}}class jh{constructor(t,e,n){this.data=t,this.Xe=e,this.fieldTransforms=n}w_(t,e){const n=[];return null!==this.Xe?n.push(new Qs(t,this.data,this.Xe,e)):n.push(new Ys(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Zs(t,this.fieldTransforms)),n}}class $h{constructor(t,e,n){this.data=t,this.Xe=e,this.fieldTransforms=n}w_(t,e){const n=[new Qs(t,this.data,this.Xe,e)];return this.fieldTransforms.length>0&&n.push(new Zs(t,this.fieldTransforms)),n}}function Bh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _r()}}class Gh{constructor(t,e,n,r,i,s){this.settings=t,this.st=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.E_(),this.fieldTransforms=i||[],this.Xe=s||[]}get path(){return this.settings.path}get n_(){return this.settings.n_}T_(t){return new Gh(Object.assign(Object.assign({},this.settings),t),this.st,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Xe)}I_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.T_({path:n,r_:!1});return r.m_(t),r}A_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.T_({path:n,r_:!1});return r.E_(),r}R_(t){return this.T_({path:void 0,r_:!0})}s_(t){return nl(t,this.settings.methodName,this.settings.P_||!1,this.path,this.settings.i_)}contains(t){return void 0!==this.Xe.find(e=>t.q(e))||void 0!==this.fieldTransforms.find(e=>t.q(e.field))}E_(){if(this.path)for(let t=0;t<this.path.length;t++)this.m_(this.path.get(t))}m_(t){if(0===t.length)throw this.s_("Document fields must not be empty");if(Bh(this.n_)&&Fh.test(t))throw this.s_('Document fields cannot begin and end with "__"')}}class zh{constructor(t,e,n){this.st=t,this.ignoreUndefinedProperties=e,this.serializer=n||ch(t)}g_(t,e,n,r=!1){return new Gh({n_:t,methodName:e,i_:n,path:qr.j(),r_:!1,P_:r},this.st,this.serializer,this.ignoreUndefinedProperties)}}function Hh(t,e,n,r,i,s={}){const o=t.g_(s.merge||s.mergeFields?2:0,e,n,i);Zh("Data must be an object, but it was:",o,r);const a=Qh(r,o);let u,c;if(s.merge)u=new Fs(o.Xe),c=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){let i;if(r instanceof Ah)i=r.Zl;else{if("string"!=typeof r)throw _r();i=el(e,r,n)}if(!o.contains(i))throw new Sr(Ar.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);rl(t,i)||t.push(i)}u=new Fs(t),c=o.fieldTransforms.filter(t=>u.rn(t.field))}else u=null,c=o.fieldTransforms;return new jh(new io(a),u,c)}function Kh(t,e,n,r){const i=t.g_(1,e,n);Zh("Data must be an object, but it was:",i,r);const s=[],o=new so;ki(r,(t,r)=>{const a=el(e,t,n),u=i.A_(a);if(r instanceof Dh||r instanceof Uh&&r.l_ instanceof Dh)s.push(a);else{const t=Yh(r,u);null!=t&&(s.push(a),o.set(a,t))}});const a=new Fs(s);return new $h(o.cn(),a,i.fieldTransforms)}function Wh(t,e,n,r,i,s){const o=t.g_(1,e,n),a=[tl(e,r,n)],u=[i];if(s.length%2!=0)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)a.push(tl(e,s[t])),u.push(s[t+1]);const c=[],h=new so;for(let t=a.length-1;t>=0;--t)if(!rl(c,a[t])){const e=a[t],n=u[t],r=o.A_(e);if(n instanceof Dh||n instanceof Uh&&n.l_ instanceof Dh)c.push(e);else{const t=Yh(n,r);null!=t&&(c.push(e),h.set(e,t))}}const l=new Fs(c);return new $h(h.cn(),l,o.fieldTransforms)}function Xh(t,e,n,r=!1){return Yh(n,t.g_(r?4:3,e))}function Yh(t,e){if(t instanceof Uh&&(t=t.l_),Jh(t))return Zh("Unsupported field value:",e,t),Qh(t,e);if(t instanceof xh)return function(t,e){if(!Bh(e.n_))throw e.s_(t.t_+"() can only be used with update() and set()");if(!e.path)throw e.s_(t.t_+"() is not currently supported inside arrays");const n=t.e_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Xe.push(e.path),t instanceof Array){if(e.settings.r_&&4!==e.n_)throw e.s_("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=Yh(i,e.R_(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return is(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Pr.fromDate(t);return{timestampValue:ss(e.serializer,n)}}if(t instanceof Pr){const n=new Pr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ss(e.serializer,n)}}if(t instanceof Vh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Mh)return{bytesValue:os(e.serializer,t.h_)};if(t instanceof qh){const n=e.st,r=t.__;if(!r.isEqual(n))throw e.s_(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:us(t.__||e.st,t.f_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.s_("Unsupported field value: "+Ih(t))}(t,e)}function Qh(t,e){const n={};return Ci(t)?e.path&&e.path.length>0&&e.Xe.push(e.path):ki(t,(t,r)=>{const i=Yh(r,e.I_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Jh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Pr||t instanceof Vh||t instanceof Mh||t instanceof qh||t instanceof xh)}function Zh(t,e,n){if(!Jh(n)||!Eh(n)){const r=Ih(n);throw"an object"===r?e.s_(t+" a custom object"):e.s_(t+" "+r)}}function tl(t,e,n){if(e instanceof Ah)return e.Zl;if("string"==typeof e)return el(t,e);throw nl("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function el(t,e,n){try{return function(t){if(t.search(Lh)>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new Sh(...t.split("."))}catch(e){throw new Sr(Ar.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).Zl}catch(e){throw nl((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function nl(t,e,n,r,i){const s=r&&!r.L(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=" in field "+r),o&&(u+=" in document "+i),u+=")"),new Sr(Ar.INVALID_ARGUMENT,a+t+u)}function rl(t,e){return t.some(t=>t.isEqual(e))}class il{constructor(t){this.Sa=t,this.V_=new Map,this.mutations=[],this.y_=!1,this.p_=null,this.b_=new Set}async v_(t){if(this.S_(),this.mutations.length>0)throw new Sr(Ar.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Nr(t),r=ps(n.serializer)+"/documents",i={documents:e.map(t=>hs(n.serializer,t))},s=await n.Ia("BatchGetDocuments",r,i),o=new Map;s.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){Tr(!!e.found),e.found.name,e.found.updateTime;const n=ls(t,e.found.name),r=as(e.found.updateTime),i=new io({mapValue:{fields:e.found.fields}});return new uo(n,r,i,{})}(t,e):"missing"in e?function(t,e){Tr(!!e.missing),Tr(!!e.readTime);const n=ls(t,e.missing),r=as(e.readTime);return new co(n,r)}(t,e):_r()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());Tr(!!e),a.push(e)}),a}(this.Sa,t);return e.forEach(t=>{t instanceof co||t instanceof uo?this.D_(t):_r()}),e}set(t,e){this.write(e.w_(t,this.en(t))),this.b_.add(t.toString())}update(t,e){try{this.write(e.w_(t,this.C_(t)))}catch(t){this.p_=t}this.b_.add(t.toString())}delete(t){this.write([new no(t,this.en(t))]),this.b_.add(t.toString())}async commit(){if(this.S_(),this.p_)throw this.p_;const t=this.V_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=jr.X(e);this.mutations.push(new ro(n,this.en(n)))}),await async function(t,e){const n=Nr(t),r=ps(n.serializer)+"/documents",i={writes:e.map(t=>ys(n.serializer,t))};await n.Ta("Commit",r,i)}(this.Sa,this.mutations),this.y_=!0}D_(t){let e;if(t instanceof uo)e=t.version;else{if(!(t instanceof co))throw _r();e=Vr.min()}const n=this.V_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Sr(Ar.ABORTED,"Document version changed between two reads.")}else this.V_.set(t.key.toString(),e)}en(t){const e=this.V_.get(t.toString());return!this.b_.has(t.toString())&&e?$s.updateTime(e):$s.nn()}C_(t){const e=this.V_.get(t.toString());if(!this.b_.has(t.toString())&&e){if(e.isEqual(Vr.min()))throw new Sr(Ar.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $s.updateTime(e)}return $s.exists(!0)}write(t){this.S_(),this.mutations=this.mutations.concat(t)}S_(){}}class sl{constructor(t,e,n,r){this.li=t,this.Sa=e,this.updateFunction=n,this.di=r,this.N_=5,this.pi=new ta(this.li,"transaction_retry")}run(){this.x_()}x_(){this.pi.$s(async()=>{const t=new il(this.Sa),e=this.O_(t);e&&e.then(e=>{this.li.Ii(()=>t.commit().then(()=>{this.di.resolve(e)}).catch(t=>{this.F_(t)}))}).catch(t=>{this.F_(t)})})}O_(t){try{const e=this.updateFunction(t);return!Gr(e)&&e.catch&&e.then?e:(this.di.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.di.reject(t),null}}F_(t){this.N_>0&&this.M_(t)?(this.N_-=1,this.li.Ii(()=>(this.x_(),Promise.resolve()))):this.di.reject(t)}M_(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!ri(e)}return!1}}function ol(t,e,n,r,i){const s=new gh({next:s=>{e.Ii(()=>fc(t,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Sr(Ar.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Sr(Ar.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:t=>i.reject(t)}),o=new pc(po(n.path),s,{includeMetadataChanges:!0,iu:!0});return lc(t,o)}function al(t,e,n,r,i){const s=new gh({next:n=>{e.Ii(()=>fc(t,o)),n.fromCache&&"server"===r.source?i.reject(new Sr(Ar.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new pc(n,s,{includeMetadataChanges:!0,iu:!0});return lc(t,o)}const ul=new Map;class cl{constructor(t,e){this.app=t,this.k_="(lite)",this.L_=!1,this.__=cl.q_(t),this.B_=new xr(e)}get U_(){return this.L_}get K_(){return void 0!==this.Q_}W_(t){if(this.L_)throw new Sr(Ar.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.j_=t}G_(){return this.j_||(this.j_={}),this.L_=!0,this.j_}static q_(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Sr(Ar.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Br(t.options.projectId)}_delete(){return this.Q_||(this.Q_=this.z_()),this.Q_}z_(){return function(t){const e=ul.get(t);e&&(vr("ComponentProvider","Removing Datastore"),ul.delete(t),e.terminate())}(this),Promise.resolve()}}function hl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class ll{constructor(t,e,n,r,i){this.st=t,this.timestampsInSnapshots=e,this.H_=n,this.J_=r,this.Y_=i}X_(t){switch(Ui(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zi(t.integerValue||t.doubleValue);case 3:return this.Z_(t.timestampValue);case 4:return this.tf(t);case 5:return t.stringValue;case 6:return this.Y_(Hi(t.bytesValue));case 7:return this.ef(t.referenceValue);case 8:return this.nf(t.geoPointValue);case 9:return this.sf(t.arrayValue);case 10:return this.if(t.mapValue);default:throw _r()}}if(t){const e={};return ki(t.fields||{},(t,n)=>{e[t]=this.X_(n)}),e}nf(t){return new Vh(zi(t.latitude),zi(t.longitude))}sf(t){return(t.values||[]).map(t=>this.X_(t))}tf(t){switch(this.H_){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return Pi(n)?t(n):n}(t);return null==e?null:this.X_(e);case"estimate":return this.Z_(Vi(t));default:return null}}Z_(t){const e=Gi(t),n=new Pr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}ef(t){const e=Ur.W(t);Tr(As(e));const n=new Br(e.get(1),e.get(3)),r=new jr(e.F(5));return n.isEqual(this.st)||br(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.st.projectId}/${this.st.database}) instead.`),this.J_(r)}}const fl=wa.er;class dl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function pl(t,e,n){if("string"==typeof n){if(""===n)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!vo(e)&&-1!==n.indexOf("/"))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ur.W(n));if(!jr.et(r))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ki(t,new jr(r))}if(n instanceof qh)return Ki(t,n.f_);throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ih(n)+".")}function gl(t,e){if(!Array.isArray(t)||0===t.length)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function ml(t,e,n){if(!n.isEqual(e))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function yl(t){if(mo(t)&&0===t.dn.length)throw new Sr(Ar.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function wl(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}const vl=new Map,bl=new Map;async function El(t,e,n){const r=new Zo;vl.set(t,r.promise);const i=await t.rf();i.persistenceSettings=e,vr("ComponentProvider","Initializing OfflineComponentProvider"),await n.initialize(i),t.cf(e=>t.af.Ii(()=>Lu(n.va,e))),n.persistence.Zo(()=>t._delete()),r.resolve(n)}async function Il(t,e){const n=new Zo;bl.set(t,n.promise);const r=await t.rf(),i=await _l(t);vr("ComponentProvider","Initializing OnlineComponentProvider"),await e.initialize(i,r),t.cf(n=>t.af.Ii(()=>(async function(t,e){const n=Nr(t);n.li.Mi(),vr("RemoteStore","RemoteStore received new credentials");const r=Qu(n);n.xa.add(3),await Gu(n),r&&n.$a.set("Unknown"),await n.Da.Jl(e),n.xa.delete(3),await Bu(n)})(e.Sh,n))),n.resolve(e)}function _l(t){return t.af.Mi(),vl.has(t)||(vr("ComponentProvider","Using default OfflineComponentProvider"),El(t,{Ql:!1},new lh)),vl.get(t)}function Tl(t){return t.af.Mi(),bl.has(t)||(vr("ComponentProvider","Using default OnlineComponentProvider"),Il(t,new ph)),bl.get(t)}function Nl(t){return Tl(t).then(t=>t.Ru)}function Al(t){return Tl(t).then(t=>t.Sh)}function Sl(t){return Tl(t).then(t=>{const e=t.Dh;return e.za=async function(t,e){const n=Wc(t);let r,i;const s=n.Oh.get(e);if(s)r=s.targetId,n.Ch.Uu(r),i=s.view.ph();else{const t=await Ou(n.va,Eo(e)),s=n.Ch.Uu(t.targetId);r=t.targetId,i=await kc(n,e,r,"current"===s),n.Qh&&zu(n.Sh,t)}return i}.bind(null,t.Ru),e.Ya=async function(t,e){const n=Nr(t),r=n.Oh.get(e),i=n.Fh.get(r.targetId);if(i.length>1)return n.Fh.set(r.targetId,i.filter(t=>!Io(t,e))),void n.Oh.delete(e);n.Qh?(n.Ch.Qu(r.targetId),n.Ch.$u(r.targetId)||await Ru(n.va,r.targetId,!1).then(()=>{n.Ch.ju(r.targetId),Hu(n.Sh,r.targetId),Fc(n,r.targetId)}).catch(Pu)):(Fc(n,r.targetId),await Ru(n.va,r.targetId,!0))}.bind(null,t.Ru),e})}function Ll(t){return _l(t).then(t=>t.persistence)}function xl(t){return _l(t).then(t=>t.va)}class Dl extends cl{constructor(t,e){super(t,e),this.af=new da,this.uf=Or.g(),this.hf=new Zo,this.lf=mr.UNAUTHENTICATED,this._f=(()=>{}),this.k_=t.name,this.B_.R(t=>{this.lf=t,this.hf.resolve()})}cf(t){vr("Firestore","Registering credential change listener"),this._f=t,this.hf.promise.then(()=>this._f(this.lf))}async rf(){var t,e;const n=this.G_();await this.hf.promise;const r=new $r(this.__,this.k_,null!==(t=n.host)&&void 0!==t?t:"firestore.googleapis.com",null===(e=n.ssl)||void 0===e||e,!1);return{li:this.af,pl:r,clientId:this.uf,credentials:this.B_,Kl:this.lf,Nh:100,persistenceSettings:{Ql:!1}}}G_(){return super.G_()}z_(){this.af.Ni();const t=new Zo;return this.af.Si(async()=>{try{await super.z_(),await async function(t){const e=bl.get(t);e&&(vr("ComponentProvider","Removing OnlineComponentProvider"),bl.delete(t),await(await e).terminate());const n=vl.get(t);n&&(vr("ComponentProvider","Removing OfflineComponentProvider"),vl.delete(t),await(await n).terminate())}(this),this.B_.P(),t.resolve()}catch(e){const n=pa(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}ff(){if(this.K_)throw new Sr(Ar.FAILED_PRECONDITION,"The client has already been terminated.")}}function Ol(t){if(t.U_||t.K_)throw new Sr(Ar.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Rl extends Ah{constructor(...t){super(t)}isEqual(t){return this.Zl.isEqual(t.Zl)}}class kl extends qh{constructor(t,e,n){super(t.__,new jr(n),e),this.firestore=t,this.df=n,this.type="document"}get id(){return this.df.k()}get path(){return this.df.K()}get parent(){return new $l(this.firestore,this.d_,this.f_.path.M())}withConverter(t){return new kl(this.firestore,t,this.df)}}class Cl{constructor(t,e,n){this.firestore=t,this.d_=e,this.wf=n,this.type="query"}withConverter(t){return new Cl(this.firestore,t,this.wf)}}class Pl{}class Vl extends Pl{constructor(t,e,n){super(),this.Tf=t,this.If=e,this.mf=n,this.type="where"}Ef(t){const e=zl(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.H()){if("array-contains"===s||"array-contains-any"===s)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){gl(o,s);const e=[];for(const n of o)e.push(pl(r,t,n));a={arrayValue:{values:e}}}else a=pl(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||gl(o,s),a=Xh(n,e,o,"in"===s||"not-in"===s);const u=So.create(i,s,a);return function(t,e){if(e.In()){const n=wo(t);if(null!==n&&!n.isEqual(e.field))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=yo(t);null!==r&&ml(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.wf,"where",e,t.firestore.__,this.Tf,this.If,this.mf);return new Cl(t.firestore,t.d_,function(t,e){const n=t.filters.concat([e]);return new lo(t.path,t.collectionGroup,t.dn.slice(),n,t.limit,t.wn,t.startAt,t.endAt)}(t.wf,n))}}class Ml extends Pl{constructor(t,e){super(),this.Tf=t,this.Af=e,this.type="orderBy"}Ef(t){const e=function(t,e,n){if(null!==t.startAt)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new qo(e,n);return function(t,e){if(null===yo(t)){const n=wo(t);null!==n&&ml(0,n,e.field)}}(t,r),r}(t.wf,this.Tf,this.Af);return new Cl(t.firestore,t.d_,function(t,e){const n=t.dn.concat([e]);return new lo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.wn,t.startAt,t.endAt)}(t.wf,e))}}class Ul extends Pl{constructor(t,e,n){super(),this.type=t,this.Rf=e,this.Pf=n}Ef(t){return new Cl(t.firestore,t.d_,function(t,e,n){return new lo(t.path,t.collectionGroup,t.dn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.wf,this.Rf,this.Pf))}}class Fl extends Pl{constructor(t,e,n){super(),this.type=t,this.gf=e,this.Vf=n}Ef(t){const e=jl(t,this.type,this.gf,this.Vf);return new Cl(t.firestore,t.d_,function(t,e){return new lo(t.path,t.collectionGroup,t.dn.slice(),t.filters.slice(),t.limit,t.wn,e,t.endAt)}(t.wf,e))}}class ql extends Pl{constructor(t,e,n){super(),this.type=t,this.gf=e,this.Vf=n}Ef(t){const e=jl(t,this.type,this.gf,this.Vf);return new Cl(t.firestore,t.d_,function(t,e){return new lo(t.path,t.collectionGroup,t.dn.slice(),t.filters.slice(),t.limit,t.wn,t.startAt,e)}(t.wf,e))}}function jl(t,e,n,r){if(n[0]instanceof Kl)return mh(e,n,1),function(t,e,n,r,i){if(!r)throw new Sr(Ar.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const s=[];for(const n of bo(t))if(n.field.H())s.push(Ki(e,r.key));else{const t=r.field(n.field);if(Pi(t))throw new Sr(Ar.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.K();throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}s.push(t)}return new Vo(s,i)}(t.wf,t.firestore.__,e,n[0].yf,r);{const i=zl(t.firestore);return function(t,e,n,r,i,s){const o=t.dn;if(i.length>o.length)throw new Sr(Ar.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const u=i[s];if(o[s].field.H()){if("string"!=typeof u)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!vo(t)&&-1!==u.indexOf("/"))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Ur.W(u));if(!jr.et(n))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new jr(n);a.push(Ki(e,i))}else{const t=Xh(n,r,u);a.push(t)}}return new Vo(a,s)}(t.wf,t.firestore.__,i,e,n,r)}}class $l extends Cl{constructor(t,e,n){super(t,e,po(n)),this.firestore=t,this.df=n,this.type="collection"}get id(){return this.wf.path.k()}get path(){return this.wf.path.K()}get parent(){const t=this.df.M();return t.L()?null:new kl(this.firestore,null,t)}withConverter(t){return new $l(this.firestore,t,this.df)}}function Bl(t,e,...n){if(1===arguments.length&&(e=Or.g()),Hl("doc","path",e),t instanceof cl){const r=Ur.W(e,...n);return vh(r),new kl(t,null,r)}{if(!(t instanceof kl||t instanceof $l))throw new Sr(Ar.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t.df.child(Ur.W(e,...n));return vh(r),new kl(t.firestore,t instanceof $l?t.d_:null,r)}}function Gl(t,e){return t instanceof Cl&&e instanceof Cl&&t.firestore===e.firestore&&Io(t.wf,e.wf)&&t.d_===e.d_}function zl(t){const e=t.G_(),n=ch(t.__);return new zh(t.__,!!e.ignoreUndefinedProperties,n)}function Hl(t,e,n){if(!n)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}class Kl{constructor(t,e,n,r){this.pf=t,this.f_=e,this.yf=n,this.d_=r}get id(){return this.f_.path.k()}get ref(){return new kl(this.pf,this.d_,this.f_.path)}exists(){return null!==this.yf}data(){if(this.yf){if(this.d_){const t=new Wl(this.pf,this.f_,this.yf,null);return this.d_.fromFirestore(t)}return new ll(this.pf.__,!0,"none",t=>new kl(this.pf,null,t.path),t=>new Mh(t)).X_(this.yf.fn())}}get(t){if(this.yf){const e=this.yf.data().field(Xl("DocumentSnapshot.get",t));if(null!==e)return new ll(this.pf.__,!0,"none",t=>new kl(this.pf,this.d_,t.path),t=>new Mh(t)).X_(e)}}}class Wl extends Kl{data(){return super.data()}}function Xl(t,e){return"string"==typeof e?el(t,e):e.Zl}class Yl extends Kl{constructor(t,e,n,r,i){super(t,e,n,i),this.pf=t,this.metadata=r,this.bf=t}exists(){return super.exists()}data(t){if(this.yf){if(this.d_){const e=new Ql(this.pf,this.f_,this.yf,this.metadata,null);return this.d_.fromFirestore(e,t)}return new ll(this.bf.__,!0,(null==t?void 0:t.serverTimestamps)||"none",t=>new kl(this.pf,null,t.path),t=>new Mh(t)).X_(this.yf.fn())}}get(t,e={}){if(this.yf){const n=this.yf.data().field(Xl("DocumentSnapshot.get",t));if(null!==n)return new ll(this.bf.__,!0,e.serverTimestamps||"none",t=>new kl(this.pf,this.d_,t.path),t=>new Mh(t)).X_(n)}}}class Ql extends Yl{data(t={}){return super.data(t)}}class Jl{constructor(t,e,n){this.pf=t,this.query=e,this.vf=n,this.metadata=new dl(n.hasPendingWrites,n.fromCache)}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.vf.docs.size}get empty(){return 0===this.size}forEach(t,e){this.vf.docs.forEach(n=>{t.call(e,this.Sf(n,this.vf.fromCache,this.vf.Xt.has(n.key)))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.vf.te)throw new Sr(Ar.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Df&&this.Cf===e||(this.Df=function(t,e,n){if(t.Yt.L()){let e,r=0;return t.docChanges.map(i=>{const s=n(i.doc,t.fromCache,t.Xt.has(i.doc.key));return e=i.doc,{type:"added",doc:s,oldIndex:-1,newIndex:r++}})}{let r=t.Yt;return t.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=n(e.doc,t.fromCache,t.Xt.has(e.doc.key));let s=-1,o=-1;return 0!==e.type&&(s=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _r()}}(e.type),doc:i,oldIndex:s,newIndex:o}})}}(this.vf,e,this.Sf.bind(this)),this.Cf=e),this.Df}Sf(t,e,n){return new Ql(this.pf,t.key,t,new dl(n,e),this.query.d_)}}class Zl{constructor(t,e){this.pf=t,this.Nf=e,this.xf=[],this.Of=!1,this.Ff=zl(t)}set(t,e,n){this.Mf();const r=tf(t,this.pf),i=wl(r.d_,e,n),s=Hh(this.Ff,"WriteBatch.set",r.f_,i,null!==r.d_,n);return this.xf=this.xf.concat(s.w_(r.f_,$s.nn())),this}update(t,e,n,...r){this.Mf();const i=tf(t,this.pf);let s;return s="string"==typeof e||e instanceof Rl?Wh(this.Ff,"WriteBatch.update",i.f_,e,n,r):Kh(this.Ff,"WriteBatch.update",i.f_,e),this.xf=this.xf.concat(s.w_(i.f_,$s.exists(!0))),this}delete(t){this.Mf();const e=tf(t,this.pf);return this.xf=this.xf.concat(new no(e.f_,$s.nn())),this}commit(){return this.Mf(),this.Of=!0,this.xf.length>0?this.Nf(this.xf):Promise.resolve()}Mf(){if(this.Of)throw new Sr(Ar.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function tf(t,e){if(t.firestore!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class ef extends class{constructor(t,e){this.pf=t,this.$f=e,this.Ff=zl(t)}get(t){const e=tf(t,this.pf);return this.$f.v_([e.f_]).then(t=>{if(!t||1!==t.length)return _r();const n=t[0];if(n instanceof co)return new Kl(this.pf,e.f_,null,e.d_);if(n instanceof uo)return new Kl(this.pf,n.key,n,e.d_);throw _r()})}set(t,e,n){const r=tf(t,this.pf),i=wl(r.d_,e,n),s=Hh(this.Ff,"Transaction.set",r.f_,i,null!==r.d_,n);return this.$f.set(r.f_,s),this}update(t,e,n,...r){const i=tf(t,this.pf);let s;return s="string"==typeof e||e instanceof Rl?Wh(this.Ff,"Transaction.update",i.f_,e,n,r):Kh(this.Ff,"Transaction.update",i.f_,e),this.$f.update(i.f_,s),this}delete(t){const e=tf(t,this.pf);return this.$f.delete(e.f_),this}}{constructor(t,e){super(t,e),this.pf=t}get(t){const e=tf(t,this.pf);return super.get(t).then(t=>new Yl(this.pf,e.f_,t.yf,new dl(!1,!1),e.d_))}}function nf(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Sr(Ar.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?"):new Sr(Ar.INVALID_ARGUMENT,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}function rf(t,e){const n=new Zo;return t.af.Ii(async()=>(async function(t,e,n){const r=Xc(t);try{const i=await function(t,e){const n=Nr(t),r=Pr.now(),i=e.reduce((t,e)=>t.add(e.key),yi());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.xc.us(t,i).next(i=>{s=i;const o=[];for(const t of e){const e=Ks(t,s.get(t.key));null!=e&&o.push(new Qs(t.key,e,oo(e.proto.mapValue),$s.exists(!0)))}return n.es.Sr(t,r,o,e)})).then(t=>{const e=t.yn(s);return{batchId:t.batchId,Bn:e}})}(r.va,e);r.Ch.ku(i.batchId),function(t,e,n){let r=t.qh[t.currentUser.i()];r||(r=new si(Rr)),r=r.dt(e,n),t.qh[t.currentUser.i()]=r}(r,i.batchId,n),await Gc(r,i.Bn),await ec(r.Sh)}catch(t){const e=pa(t,"Failed to persist write");n.reject(e)}})(await Nl(t),e,n)),n.promise}function sf(t,e,n){const r=n.docs.get(e.f_);return new Yl(t,e.f_,r,new dl(n.hasPendingWrites,n.fromCache),e.d_)}e._registerComponent(new h("firestore-exp",t=>((t,e)=>new Dl(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.800","node"),t.Bytes=Mh,t.CACHE_SIZE_UNLIMITED=fl,t.CollectionReference=$l,t.DocumentReference=kl,t.DocumentSnapshot=Yl,t.FieldPath=Rl,t.FieldValue=xh,t.FirebaseFirestore=Dl,t.FirestoreError=Sr,t.GeoPoint=Vh,t.Query=Cl,t.QueryConstraint=Pl,t.QueryDocumentSnapshot=Ql,t.QuerySnapshot=Jl,t.SnapshotMetadata=dl,t.Timestamp=Pr,t.Transaction=ef,t.WriteBatch=Zl,t.addDoc=function(t,e){const n=nf(t.firestore,Dl);n.ff();const r=Bl(t),i=wl(t.d_,e);return rf(n,Hh(zl(t.firestore),"addDoc",r.f_,i,null!==t.d_,{}).w_(r.f_,$s.exists(!1))).then(()=>r)},t.arrayRemove=function(...t){return yh("arrayRemove()",arguments,1),new Ch("arrayRemove",t)},t.arrayUnion=function(...t){return yh("arrayUnion()",arguments,1),new kh("arrayUnion",t)},t.clearIndexedDbPersistence=function(t){if(t.U_&&!t.K_)throw new Sr(Ar.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Zo;return t.af.Si(async()=>{try{await Au(Nu(t.__,t.k_)),e.resolve()}catch(t){e.reject(t)}}),e.promise},t.collection=function(t,e,...n){if(Hl("collection","path",e),t instanceof cl){const r=Ur.W(e,...n);return bh(r),new $l(t,null,r)}{if(!(t instanceof kl||t instanceof $l))throw new Sr(Ar.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=Ur.W(t.path,...n).child(Ur.W(e));return bh(r),new $l(t.firestore,null,r)}},t.collectionGroup=function(t,e){if(Hl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Cl(t,null,function(t){return new lo(Ur.j(),t)}(e))},t.deleteDoc=function(t){const e=nf(t.firestore,Dl);return e.ff(),rf(e,[new no(t.f_,$s.nn())])},t.deleteField=function(){return new Dh("deleteField")},t.disableNetwork=function(t){return t.ff(),t.af.enqueue(async()=>{const e=await Al(t);return(await Ll(t)).tc(!1),async function(t){const e=Nr(t);e.xa.add(0),await Gu(e),e.$a.set("Offline")}(e)})},t.doc=Bl,t.documentId=function(){return new Rl("__name__")},t.enableIndexedDbPersistence=function(t,e){Ol(t);const n=t.G_(),r=new ph,i=new fh(r);return t.af.enqueue(async()=>{await El(t,{Ql:!0,synchronizeTabs:!1,cacheSizeBytes:n.cacheSizeBytes||wa.sr,Mo:!!(null==e?void 0:e.forceOwnership)},i),await Il(t,r)})},t.enableMultiTabIndexedDbPersistence=function(t){Ol(t);const e=t.G_(),n=new ph,r=new dh(n);return t.af.enqueue(async()=>{await El(t,{Ql:!0,synchronizeTabs:!0,cacheSizeBytes:e.cacheSizeBytes||wa.sr,Mo:!1},r),await Il(t,n)})},t.enableNetwork=function(t){return t.ff(),t.af.enqueue(async()=>{const e=await Al(t);return(await Ll(t)).tc(!0),function(t){const e=Nr(t);return e.xa.delete(0),Bu(e)}(e)})},t.endAt=function(...t){return new ql("endAt",t,!1)},t.endBefore=function(...t){return new ql("endBefore",t,!0)},t.getDoc=function(t){const e=nf(t.firestore,Dl);e.ff();const n=new Zo;return e.af.Ii(async()=>{const r=await Sl(e);await ol(r,e.af,t.f_,{source:"default"},n)}),n.promise.then(n=>sf(e,t,n))},t.getDocFromCache=function(t){const e=nf(t.firestore,Dl);e.ff();const n=new Zo;return e.af.Ii(async()=>{const r=await xl(e);await async function(t,e,n){try{const r=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("read document","readonly",t=>n.xc.ss(t,e))}(t,e);r instanceof uo?n.resolve(r):r instanceof co?n.resolve(null):n.reject(new Sr(Ar.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=pa(t,`Failed to get document '${e} from cache`);n.reject(r)}}(r,t.f_,n)}),n.promise.then(n=>new Yl(e,t.f_,n,new dl(n instanceof uo&&n.on,!0),t.d_))},t.getDocFromServer=function(t){const e=nf(t.firestore,Dl);e.ff();const n=new Zo;return e.af.Ii(async()=>{const r=await Sl(e);await ol(r,e.af,t.f_,{source:"server"},n)}),n.promise.then(n=>sf(e,t,n))},t.getDocs=function(t){const e=nf(t.firestore,Dl);e.ff(),yl(t.wf);const n=new Zo;return e.af.Ii(async()=>{const r=await Sl(e);await al(r,e.af,t.wf,{source:"default"},n)}),n.promise.then(n=>new Jl(e,t,n))},t.getDocsFromCache=function(t){const e=nf(t.firestore,Dl);e.ff();const n=new Zo;return e.af.Ii(async()=>{const r=await xl(e);await async function(t,e,n){try{const r=await ku(t,e,!0),i=new xc(e,r.kc),s=i.Th(r.documents),o=i.Jn(s,!1);n.resolve(o.snapshot)}catch(t){const r=pa(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(r,t.wf,n)}),n.promise.then(n=>new Jl(e,t,n))},t.getDocsFromServer=function(t){const e=nf(t.firestore,Dl);e.ff();const n=new Zo;return e.af.Ii(async()=>{const r=await Sl(e);await al(r,e.af,t.wf,{source:"server"},n)}),n.promise.then(n=>new Jl(e,t,n))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new Ph("increment",t)},t.initializeFirestore=function(t,n){const r=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&n.cacheSizeBytes!==fl&&n.cacheSizeBytes<wa.nr)throw new Sr(Ar.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+wa.nr);return r.W_(n),r},t.limit=function(t){return _h("limit",1,t),new Ul("limit",t,"F")},t.limitToLast=function(t){return _h("limitToLast",1,t),new Ul("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,r,i;let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||hl(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(hl(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let u,c,h;t instanceof kl?(c=nf(t.firestore,Dl),h=po(t.f_.path),u={next:n=>{e[o]&&e[o](sf(c,t,n))},error:e[o+1],complete:e[o+2]}):(c=nf(t.firestore,Dl),h=t.wf,u={next:n=>{e[o]&&e[o](new Jl(c,t,n))},error:e[o+1],complete:e[o+2]},yl(t.wf)),c.ff();const l=new gh(u),f=new pc(h,l,a);return c.af.Ii(async()=>lc(await Sl(c),f)),()=>{l.Xl(),c.af.Ii(async()=>fc(await Sl(c),f))}},t.onSnapshotsInSync=function(t,e){t.ff();const n=hl(e)?e:{next:e},r=new gh(n);return t.af.Ii(async()=>{!function(t,e){Nr(t).Ga.add(e),e.next()}(await Sl(t),r)}),()=>{r.Xl(),t.af.Ii(async()=>{!function(t,e){Nr(t).Ga.delete(e)}(await Sl(t),r)})}},t.orderBy=function(t,e="asc"){const n=e,r=Xl("orderBy",t);return new Ml(r,n)},t.query=function(t,...e){for(const n of e)t=n.Ef(t);return t},t.queryEqual=Gl,t.refEqual=function(t,e){return(t instanceof kl||t instanceof $l)&&(e instanceof kl||e instanceof $l)&&t.firestore===e.firestore&&t.path===e.path&&t.d_===e.d_},t.runTransaction=function(t,e){t.ff();const n=new Zo;return t.af.Ii(async()=>{const r=await function(t){var e,n;if(t.K_)throw new Sr(Ar.FAILED_PRECONDITION,"The client has already been terminated.");if(!ul.has(t)){vr("ComponentProvider","Initializing Datastore");const r=t.G_(),i=new $r(t.__,t.k_,null!==(e=r.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=r.ssl)||void 0===n||n,!1),s=uh(i),o=ch(i.st),a=qu(t.B_,s,o);ul.set(t,a)}return ul.get(t)}(t);new sl(new da,r,n=>e(new ef(t,n)),n).run()}),n.promise},t.serverTimestamp=function(){return new Rh("serverTimestamp")},t.setDoc=function(t,e,n){const r=nf(t.firestore,Dl);r.ff();const i=wl(t.d_,e,n);return rf(r,Hh(zl(r),"setDoc",t.f_,i,null!==t.d_,n).w_(t.f_,$s.nn()))},t.setLogLevel=function(t){yr.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof Yl&&e instanceof Yl?t.pf===e.pf&&t.f_.isEqual(e.f_)&&(null===t.yf?null===e.yf:t.yf.isEqual(e.yf))&&t.d_===e.d_:t instanceof Jl&&e instanceof Jl&&t.pf===e.pf&&Gl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.vf.isEqual(e.vf)},t.startAfter=function(...t){return new Fl("startAfter",t,!1)},t.startAt=function(...t){return new Fl("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),t._delete()},t.updateDoc=function(t,e,n,...r){const i=nf(t.firestore,Dl);i.ff();const s=zl(i);let o;return rf(i,(o="string"==typeof e||e instanceof Rl?Wh(s,"updateDoc",t.f_,e,n,r):Kh(s,"updateDoc",t.f_,e)).w_(t.f_,$s.exists(!0)))},t.waitForPendingWrites=function(t){t.ff();const e=new Zo;return t.af.Ii(async()=>(async function(t,e){const n=Nr(t);Qu(n.Sh)||vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(t){const e=Nr(n.va);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.es.Fr(t))}();if(-1===r)return void e.resolve();const i=n.Bh.get(r)||[];i.push(e),n.Bh.set(r,i)}catch(t){const n=pa(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(await Nl(t),e)),e.promise},t.where=function(t,e,n){const r=e,i=Xl("where",t);return new Vl(i,r,n)},t.writeBatch=function(t){return t.ff(),new Zl(t,e=>rf(t,e))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase["firestore-lite"]=t.firebase["firestore-lite"]||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r="FirebaseError",i=function(t){function e(n,i){var o=t.call(this,i)||this;return o.code=n,o.name=r,Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,s.prototype.create),o}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error),s=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},s=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(o,r):"Error",c=this.serviceName+": "+a+" ("+s+").",h=new i(s,c),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},t}();var o,a,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}(a=t.LogLevel||(t.LogLevel={}))[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT";var l={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},f=t.LogLevel.INFO,d=((o={})[t.LogLevel.DEBUG]="log",o[t.LogLevel.VERBOSE]="log",o[t.LogLevel.INFO]="info",o[t.LogLevel.WARN]="warn",o[t.LogLevel.ERROR]="error",o),p=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),s=d[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,h(["["+i+"]  "+t.name+":"],n))}},g=function(){function e(t){this.name=t,this._logLevel=f,this._logHandler=p,this._userLogHandler=null}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in t.LogLevel))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?l[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,h([this,t.LogLevel.DEBUG],e)),this._logHandler.apply(this,h([this,t.LogLevel.DEBUG],e))},e.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,h([this,t.LogLevel.VERBOSE],e)),this._logHandler.apply(this,h([this,t.LogLevel.VERBOSE],e))},e.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,h([this,t.LogLevel.INFO],e)),this._logHandler.apply(this,h([this,t.LogLevel.INFO],e))},e.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,h([this,t.LogLevel.WARN],e)),this._logHandler.apply(this,h([this,t.LogLevel.WARN],e))},e.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,h([this,t.LogLevel.ERROR],e)),this._logHandler.apply(this,h([this,t.LogLevel.ERROR],e))},e}();const m="ok",y="cancelled",w="unknown",v="invalid-argument",b="deadline-exceeded",E="not-found",I="already-exists",_="permission-denied",T="unauthenticated",N="resource-exhausted",A="failed-precondition",S="aborted",L="out-of-range",x="unimplemented",D="internal",O="unavailable",R="data-loss";class k extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}const C=new g("@firebase/firestore");function P(e,...n){if(C.logLevel<=t.LogLevel.DEBUG){const t=n.map(M);C.debug("Firestore (7.21.1): "+e,...t)}}function V(e,...n){if(C.logLevel<=t.LogLevel.ERROR){const t=n.map(M);C.error("Firestore (7.21.1): "+e,...t)}}function M(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function U(t="Unexpected state"){const e="FIRESTORE (7.21.1) INTERNAL ASSERTION FAILED: "+t;throw V(e),new Error(e)}function F(t,e){t||U()}function q(t,e){return t}function j(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ${static t(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=j(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length))}return n}}function B(t,e){return t<e?-1:t>e?1:0}function G(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}class z{constructor(t,e,n,r,i){this.i=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}class H{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get o(){return"(default)"===this.database}isEqual(t){return t instanceof H&&t.projectId===this.projectId&&t.database===this.database}u(t){return B(this.projectId,t.projectId)||B(this.database,t.database)}}class K{constructor(t){this.uid=t}h(){return null!=this.uid}l(){return this.h()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}K.UNAUTHENTICATED=new K(null),K._=new K("google-credentials-uid"),K.m=new K("first-party-uid");class W{constructor(t,e){this.user=e,this.type="OAuth",this.p={},this.p.Authorization="Bearer "+t}}class X{constructor(t){this.I=null,this.currentUser=K.UNAUTHENTICATED,this.A=!1,this.T=0,this.P=null,this.forceRefresh=!1,this.I=(()=>{this.T++,this.currentUser=this.R(),this.A=!0,this.P&&this.P(this.currentUser)}),this.T=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(t=>{this.auth=t,this.I&&this.auth.addAuthTokenListener(this.I)},()=>{}))}getToken(){const t=this.T,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.T!==t?(P("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(F("string"==typeof e.accessToken),new W(e.accessToken,this.currentUser)):null):Promise.resolve(null)}V(){this.forceRefresh=!0}g(t){this.P=t,this.A&&t(this.currentUser)}v(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.P=null}R(){const t=this.auth&&this.auth.getUid();return F(null===t||"string"==typeof t),new K(t)}}class Y{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(v,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(v,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new k(v,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(v,"Timestamp seconds out of range: "+t)}static now(){return Y.fromMillis(Date.now())}static fromDate(t){return Y.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Y(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}N(t){return this.seconds===t.seconds?B(this.nanoseconds,t.nanoseconds):B(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{constructor(t){this.timestamp=t}static $(t){return new Q(t)}static min(){return new Q(new Y(0,0))}u(t){return this.timestamp.N(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}F(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}D(){return this.timestamp}}class J{constructor(t,e,n){void 0===e?e=0:e>t.length&&U(),void 0===n?n=t.length-e:n>t.length-e&&U(),this.segments=t,this.offset=e,this.q=n}get length(){return this.q}isEqual(t){return 0===J.S(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof J?t.forEach(t=>{e.push(t)}):e.push(t),this.O(e)}limit(){return this.offset+this.length}C(t){return t=void 0===t?1:t,this.O(this.segments,this.offset+t,this.length-t)}L(){return this.O(this.segments,this.offset,this.length-1)}U(){return this.segments[this.offset]}M(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}j(){return 0===this.length}B(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}k(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}G(){return this.segments.slice(this.offset,this.limit())}static S(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Z extends J{O(t,e,n){return new Z(t,e,n)}W(){return this.G().join("/")}toString(){return this.W()}static Y(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new k(v,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Z(e)}static H(){return new Z([])}}const tt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends J{O(t,e,n){return new et(t,e,n)}static K(t){return tt.test(t)}W(){return this.G().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),et.K(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.W()}J(){return 1===this.length&&"__name__"===this.get(0)}static Z(){return new et(["__name__"])}static X(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new k(v,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new k(v,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new k(v,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new k(v,"Unterminated ` in path: "+t);return new et(e)}static H(){return new et([])}}class nt{constructor(t){this.path=t}static tt(t){return new nt(Z.Y(t))}static nt(t){return new nt(Z.Y(t).C(5))}et(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Z.S(this.path,t.path)}toString(){return this.path.toString()}static S(t,e){return Z.S(t.path,e.path)}static rt(t){return t.length%2==0}static st(t){return new nt(new Z(t.slice()))}}function rt(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function it(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class st{constructor(t){this.it=t}static fromBase64String(t){const e=atob(t);return new st(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new st(e)}toBase64(){return t=this.it,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)}ot(){return 2*this.it.length}u(t){return B(this.it,t.it)}isEqual(t){return this.it===t.it}}function ot(t){return null==t}function at(t){return 0===t&&1/t==-1/0}function ut(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ct(t){const e=mt(t.mapValue.fields.__local_write_time__.timestampValue);return new Y(e.seconds,e.nanos)}st.ut=new st("");const ht=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ut(t)?4:10:U()}function ft(t,e){const n=lt(t);if(n!==lt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ct(t).isEqual(ct(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=mt(t.timestampValue),r=mt(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return wt(t.bytesValue).isEqual(wt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return yt(t.geoPointValue.latitude)===yt(e.geoPointValue.latitude)&&yt(t.geoPointValue.longitude)===yt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return yt(t.integerValue)===yt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=yt(t.doubleValue),r=yt(e.doubleValue);return n===r?at(n)===at(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return G(t.arrayValue.values||[],e.arrayValue.values||[],ft);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(rt(n)!==rt(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!ft(n[t],r[t])))return!1;return!0}(t,e);default:return U()}}function dt(t,e){return void 0!==(t.values||[]).find(t=>ft(t,e))}function pt(t,e){const n=lt(t),r=lt(e);if(n!==r)return B(n,r);switch(n){case 0:return 0;case 1:return B(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=yt(t.integerValue||t.doubleValue),r=yt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return gt(t.timestampValue,e.timestampValue);case 4:return gt(ct(t),ct(e));case 5:return B(t.stringValue,e.stringValue);case 6:return function(t,e){const n=wt(t),r=wt(e);return n.u(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=B(n[t],r[t]);if(0!==e)return e}return B(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=B(yt(t.latitude),yt(e.latitude));return 0!==n?n:B(yt(t.longitude),yt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=pt(n[t],r[t]);if(e)return e}return B(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=B(r[t],s[t]);if(0!==e)return e;const o=pt(n[r[t]],i[s[t]]);if(0!==o)return o}return B(r.length,s.length)}(t.mapValue,e.mapValue);default:throw U()}}function gt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return B(t,e);const n=mt(t),r=mt(e),i=B(n.seconds,r.seconds);return 0!==i?i:B(n.nanos,r.nanos)}function mt(t){if(F(!!t),"string"==typeof t){let e=0;const n=ht.exec(t);if(F(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:yt(t.seconds),nanos:yt(t.nanos)}}function yt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function wt(t){return"string"==typeof t?st.fromBase64String(t):st.fromUint8Array(t)}function vt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.W()}`}}function bt(t){return!!t&&"arrayValue"in t}function Et(t){return!!t&&"nullValue"in t}function It(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _t(t){return!!t&&"mapValue"in t}class Tt{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.at=null}}function Nt(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Tt(t,e,n,r,i,s,o)}class At{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.ct=n,this.filters=r,this.limit=i,this.ht=s,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null,this.startAt,this.endAt}}function St(t){return!ot(t.limit)&&"L"===t.ht}function Lt(t){return t.ct.length>0?t.ct[0].field:null}function xt(t){for(const e of t.filters)if(e.dt())return e.field;return null}function Dt(t){return null!==t.collectionGroup}function Ot(t){const e=q(t);if(null===e.lt){e.lt=[];const t=xt(e),n=Lt(e);if(null!==t&&null===n)t.J()||e.lt.push(new Gt(t)),e.lt.push(new Gt(et.Z(),"asc"));else{let t=!1;for(const n of e.ct)e.lt.push(n),n.field.J()&&(t=!0);if(!t){const t=e.ct.length>0?e.ct[e.ct.length-1].dir:"asc";e.lt.push(new Gt(et.Z(),t))}}}return e.lt}function Rt(t){const e=q(t);if(!e.ft)if("F"===e.ht)e.ft=Nt(e.path,e.collectionGroup,Ot(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ot(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Gt(n.field,e))}const n=e.endAt?new $t(e.endAt.position,!e.endAt.before):null,r=e.startAt?new $t(e.startAt.position,!e.startAt.before):null;e.ft=Nt(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.ft}class kt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.J())return"in"===e||"not-in"===e?this._t(t,e,n):new Ct(t,e,n);if(Et(n)){if("=="!==e&&"!="!==e)throw new k(v,"Invalid query. Null only supports '==' and '!=' comparisons.");return new kt(t,e,n)}if(It(n)){if("=="!==e&&"!="!==e)throw new k(v,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new kt(t,e,n)}return"array-contains"===e?new Ut(t,n):"in"===e?new Ft(t,n):"not-in"===e?new qt(t,n):"array-contains-any"===e?new jt(t,n):new kt(t,e,n)}static _t(t,e,n){return"in"===e?new Pt(t,n):new Vt(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.wt(pt(e,this.value)):null!==e&&lt(this.value)===lt(e)&&this.wt(pt(e,this.value))}wt(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return U()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ct extends kt{constructor(t,e,n){super(t,e,n),this.key=nt.nt(n.referenceValue)}matches(t){const e=nt.S(t.key,this.key);return this.wt(e)}}class Pt extends kt{constructor(t,e){super(t,"in",e),this.keys=Mt("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Vt extends kt{constructor(t,e){super(t,"not-in",e),this.keys=Mt("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Mt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>nt.nt(t.referenceValue))}class Ut extends kt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return bt(e)&&dt(e.arrayValue,this.value)}}class Ft extends kt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&dt(this.value.arrayValue,e)}}class qt extends kt{constructor(t,e){super(t,"not-in",e)}matches(t){if(dt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!dt(this.value.arrayValue,e)}}class jt extends kt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!bt(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>dt(this.value.arrayValue,t))}}class $t{constructor(t,e){this.position=t,this.before=e}}function Bt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ft(t.position[n],e.position[n]))return!1;return!0}class Gt{constructor(t,e="asc"){this.field=t,this.dir=e}}function zt(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Ht,Kt;function Wt(t){if(void 0===t)return V("RPC_ERROR","HTTP error has no status"),w;switch(t){case 200:return m;case 400:return A;case 401:return T;case 403:return _;case 404:return E;case 409:return S;case 416:return L;case 429:return N;case 499:return y;case 500:return w;case 501:return x;case 503:return O;case 504:return b;default:return t>=200&&t<300?m:t>=400&&t<500?A:t>=500&&t<600?D:w}}(Kt=Ht||(Ht={}))[Kt.OK=0]="OK",Kt[Kt.CANCELLED=1]="CANCELLED",Kt[Kt.UNKNOWN=2]="UNKNOWN",Kt[Kt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Kt[Kt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Kt[Kt.NOT_FOUND=5]="NOT_FOUND",Kt[Kt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Kt[Kt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Kt[Kt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Kt[Kt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Kt[Kt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Kt[Kt.ABORTED=10]="ABORTED",Kt[Kt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Kt[Kt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Kt[Kt.INTERNAL=13]="INTERNAL",Kt[Kt.UNAVAILABLE=14]="UNAVAILABLE",Kt[Kt.DATA_LOSS=15]="DATA_LOSS";const Xt={asc:"ASCENDING",desc:"DESCENDING"},Yt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Qt{constructor(t,e){this.i=t,this.yt=e}}function Jt(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!at(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?{integerValue:""+e}:function(t,e){if(t.yt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:at(e)?"-0":e}}(t,e)}function Zt(t,e){return t.yt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function te(t){return F(!!t),Q.$(function(t){const e=mt(t);return new Y(e.seconds,e.nanos)}(t))}function ee(t,e){return function(t){return new Z(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).W()}function ne(t,e){return ee(t.i,e.path)}function re(t,e){const n=function(t){const e=Z.Y(t);return F(le(e)),e}(e);return F(n.get(1)===t.i.projectId),F(!n.get(3)&&!t.i.database||n.get(3)===t.i.database),new nt((F((r=n).length>4&&"documents"===r.get(4)),r.C(5)));var r}function ie(t,e){return ee(t.i,e)}function se(t){return new Z(["projects",t.i.projectId,"databases",t.i.database]).W()}function oe(t,e,n){return{name:ne(t,e),fields:n.proto.mapValue.fields}}function ae(t,e){let n;if(e instanceof Ee)n={update:oe(t,e.key,e.value)};else if(e instanceof Te)n={delete:ne(t,e.key)};else if(e instanceof Ie)n={update:oe(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.W())),{fieldPaths:e}}(e.Et)};else if(e instanceof _e)n={transform:{document:ne(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof de)return{fieldPath:e.field.W(),setToServerValue:"REQUEST_TIME"};if(n instanceof pe)return{fieldPath:e.field.W(),appendMissingElements:{values:n.elements}};if(n instanceof ge)return{fieldPath:e.field.W(),removeAllFromArray:{values:n.elements}};if(n instanceof me)return{fieldPath:e.field.W(),increment:n.It};throw U()})(0,t))}};else{if(!(e instanceof Ne))return U();n={verify:ne(t,e.key)}}return e.Tt.At||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return Zt(t,e.D())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:U()}(t,e.Tt)),n}function ue(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ie(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ie(t,r.L()),n.structuredQuery.from=[{collectionId:r.M()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(It(t.value))return{unaryFilter:{field:he(t.field),op:"IS_NAN"}};if(Et(t.value))return{unaryFilter:{field:he(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(It(t.value))return{unaryFilter:{field:he(t.field),op:"IS_NOT_NAN"}};if(Et(t.value))return{unaryFilter:{field:he(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:he(t.field),op:function(t){return Yt[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:he(t.field),direction:function(t){return Xt[t]}(t.dir)}})(t))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(t,e){return t.yt||ot(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=ce(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ce(e.endAt)),n}function ce(t){return{before:t.before,values:t.position}}function he(t){return{fieldPath:t.W()}}function le(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class fe{constructor(){this.Pt=void 0}}class de extends fe{}class pe extends fe{constructor(t){super(),this.elements=t}}class ge extends fe{constructor(t){super(),this.elements=t}}class me extends fe{constructor(t,e){super(),this.serializer=t,this.It=e}}class ye{constructor(t){this.fields=t,t.sort(et.S)}Rt(t){for(const e of this.fields)if(e.B(t))return!0;return!1}isEqual(t){return G(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class we{constructor(t,e){this.field=t,this.transform=e}}class ve{constructor(t,e){this.updateTime=t,this.exists=e}static Vt(){return new ve}static exists(t){return new ve(void 0,t)}static updateTime(t){return new ve(t)}get At(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class be{}class Ee extends be{constructor(t,e,n){super(),this.key=t,this.value=e,this.Tt=n,this.type=0}}class Ie extends be{constructor(t,e,n,r){super(),this.key=t,this.data=e,this.Et=n,this.Tt=r,this.type=1}}class _e extends be{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.Tt=ve.exists(!0)}}class Te extends be{constructor(t,e){super(),this.key=t,this.Tt=e,this.type=3}}class Ne extends be{constructor(t,e){super(),this.key=t,this.Tt=e,this.type=4}}class Ae{constructor(t){this.proto=t}static empty(){return new Ae({mapValue:{}})}field(t){if(t.j())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!_t(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.M()])||null}}isEqual(t){return ft(this.proto,t.proto)}}class Se{constructor(t=Ae.empty()){this.gt=t,this.bt=new Map}set(t,e){return this.vt(t,e),this}delete(t){return this.vt(t,null),this}vt(t,e){let n=this.bt;for(let e=0;e<t.length-1;++e){const r=t.get(e);let i=n.get(r);i instanceof Map?n=i:i&&10===lt(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(r,i),n=i):(i=new Map,n.set(r,i),n=i)}n.set(t.M(),e)}Nt(){const t=this.$t(et.H(),this.bt);return null!=t?new Ae(t):this.gt}$t(t,e){let n=!1;const r=this.gt.field(t),i=_t(r)?Object.assign({},r.mapValue.fields):{};return e.forEach((e,r)=>{if(e instanceof Map){const s=this.$t(t.child(r),e);null!=s&&(i[r]=s,n=!0)}else null!==e?(i[r]=e,n=!0):i.hasOwnProperty(r)&&(delete i[r],n=!0)}),n?{mapValue:{fields:i}}:null}}class Le{constructor(t,e){this.key=t,this.version=e}}class xe extends Le{constructor(t,e,n,r){super(t,e),this.Ft=n,this.Dt=!!r.Dt,this.hasCommittedMutations=!!r.hasCommittedMutations}field(t){return this.Ft.field(t)}data(){return this.Ft}qt(){return this.Ft.proto}isEqual(t){return t instanceof xe&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Dt===t.Dt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ft.isEqual(t.Ft)}toString(){return`Document(${this.key}, ${this.version}, ${this.Ft.toString()}, {hasLocalMutations: ${this.Dt}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.Dt||this.hasCommittedMutations}}class De extends Le{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof De&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class Oe{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Re{constructor(t,e,n=1e3,r=1.5,i=6e4){this.xt=t,this.St=e,this.Ot=n,this.Ct=r,this.Lt=i,this.Ut=0,this.Mt=null,this.jt=Date.now(),this.reset()}reset(){this.Ut=0}Bt(){this.Ut=this.Lt}kt(t){this.cancel();const e=Math.floor(this.Ut+this.Qt()),n=Math.max(0,Date.now()-this.jt),r=Math.max(0,e-n);r>0&&P("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ut} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Mt=this.xt.Gt(this.St,r,()=>(this.jt=Date.now(),t())),this.Ut*=this.Ct,this.Ut<this.Ot&&(this.Ut=this.Ot),this.Ut>this.Lt&&(this.Ut=this.Lt)}Wt(){null!==this.Mt&&(this.Mt.Yt(),this.Mt=null)}cancel(){null!==this.Mt&&(this.Mt.cancel(),this.Mt=null)}Qt(){return(Math.random()-.5)*this.Ut}}function ke(){return"undefined"!=typeof document?document:null}class Ce{constructor(t,e,n,r,i){this.zt=t,this.St=e,this.Ht=n,this.op=r,this.Kt=i,this.Jt=new Oe,this.then=this.Jt.promise.then.bind(this.Jt.promise),this.Jt.promise.catch(t=>{})}static Zt(t,e,n,r,i){const s=Date.now()+n,o=new Ce(t,e,s,r,i);return o.start(n),o}start(t){this.Xt=setTimeout(()=>this.tn(),t)}Yt(){return this.tn()}cancel(t){null!==this.Xt&&(this.clearTimeout(),this.Jt.reject(new k(y,"Operation cancelled"+(t?": "+t:""))))}tn(){this.zt.nn(()=>null!==this.Xt?(this.clearTimeout(),this.op().then(t=>this.Jt.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Xt&&(this.Kt(this),clearTimeout(this.Xt),this.Xt=null)}}class Pe{constructor(){this.en=Promise.resolve(),this.rn=[],this.sn=!1,this.on=[],this.un=null,this.an=!1,this.cn=[],this.hn=new Re(this,"async_queue_retry"),this.ln=(()=>{const t=ke();t&&P("AsyncQueue","Visibility state changed to  ",t.visibilityState),this.hn.Wt()});const t=ke();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ln)}get fn(){return this.sn}nn(t){this.enqueue(t)}dn(t){this._n(),this.wn(t)}mn(){if(!this.sn){this.sn=!0;const t=ke();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ln)}}enqueue(t){return this._n(),this.sn?new Promise(t=>{}):this.wn(t)}pn(t){this.rn.push(t),this.nn(()=>this.yn())}async yn(){if(0!==this.rn.length){try{await this.rn[0](),this.rn.shift(),this.hn.reset()}catch(t){if(!function(t){return"IndexedDbTransactionError"===t.name}(t))throw t;P("AsyncQueue","Operation failed with retryable error: "+t)}this.rn.length>0&&this.hn.kt(()=>this.yn())}}wn(t){const e=this.en.then(()=>(this.an=!0,t().catch(t=>{throw this.un=t,this.an=!1,V("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.an=!1,t))));return this.en=e,e}Gt(t,e,n){this._n(),this.cn.indexOf(t)>-1&&(e=0);const r=Ce.Zt(this,t,e,n,t=>this.En(t));return this.on.push(r),r}_n(){this.un&&U()}In(){}async An(){let t;do{t=this.en,await t}while(t!==this.en)}Tn(t){for(const e of this.on)if(e.St===t)return!0;return!1}Pn(t){return this.An().then(()=>{this.on.sort((t,e)=>t.Ht-e.Ht);for(const e of this.on)if(e.Yt(),"all"!==t&&e.St===t)break;return this.An()})}Rn(t){this.cn.push(t)}En(t){const e=this.on.indexOf(t);this.on.splice(e,1)}}class Ve extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Vn=e,this.serializer=n,this.gn=!1}bn(){if(this.gn)throw new k(A,"The client has already been terminated.")}vn(t,e,n){return this.bn(),this.credentials.getToken().then(r=>this.Vn.vn(t,e,n,r)).catch(t=>{throw t.code===T&&this.credentials.V(),t})}Nn(t,e,n){return this.bn(),this.credentials.getToken().then(r=>this.Vn.Nn(t,e,n,r)).catch(t=>{throw t.code===T&&this.credentials.V(),t})}terminate(){this.gn=!1}}async function Me(t,e){const n=q(t),r=se(n.serializer)+"/documents",i={writes:e.map(t=>ae(n.serializer,t))};await n.vn("Commit",r,i)}async function Ue(t,e){const n=q(t),r=se(n.serializer)+"/documents",i={documents:e.map(t=>ne(n.serializer,t))},s=await n.Nn("BatchGetDocuments",r,i),o=new Map;s.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){F(!!e.found),e.found.name,e.found.updateTime;const n=re(t,e.found.name),r=te(e.found.updateTime),i=new Ae({mapValue:{fields:e.found.fields}});return new xe(n,r,i,{})}(t,e):"missing"in e?function(t,e){F(!!e.missing),F(!!e.readTime);const n=re(t,e.missing),r=te(e.readTime);return new De(n,r)}(t,e):U()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());F(!!e),a.push(e)}),a}const Fe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class qe extends class{constructor(t){this.$n=t,this.i=t.i;const e=t.ssl?"https":"http";this.Fn=e+"://"+t.host,this.Dn="projects/"+this.i.projectId+"/databases/"+this.i.database+"/documents"}vn(e,n,r,i){const s=this.qn(e,n);P("RestConnection","Sending: ",s,r);const o={};return this.xn(o,i),this.Sn(e,s,o,r).then(t=>(P("RestConnection","Received: ",t),t),n=>{throw function(e,...n){if(C.logLevel<=t.LogLevel.WARN){const t=n.map(M);C.warn("Firestore (7.21.1): RestConnection",...t)}}(0,e+" failed with error: ",n,"url: ",s,"request:",r),n})}Nn(t,e,n,r){return this.vn(t,e,n,r)}xn(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.21.1",t["Content-Type"]="text/plain",e)for(const n in e.p)e.p.hasOwnProperty(n)&&(t[n]=e.p[n])}qn(t,e){const n=Fe[t];return`${this.Fn}/v1/${e}:${n}`}}{constructor(t,e){super(t),this.On=e}Cn(t,e){throw new Error("Not supported by FetchConnection")}async Sn(t,e,n,r){const i=JSON.stringify(r);let s;try{s=await this.On(e,{method:"POST",headers:n,body:i})}catch(t){throw new k(Wt(t.status),"Request failed with error: "+t.statusText)}if(!s.ok)throw new k(Wt(s.status),"Request failed with error: "+s.statusText);return s.json()}}function je(t){return new Qt(t,!0)}const $e=new Map;function Be(t){var e,n;if(t.Ln)throw new k(A,"The client has already been terminated.");if(!$e.has(t)){P("ComponentProvider","Initializing Datastore");const r=t.Un(),i=new z(t.Mn,t.jn,null!==(e=r.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=r.ssl)||void 0===n||n,!1),s=new qe(i,fetch.bind(null)),o=je(i.i),a=function(t,e,n){return new Ve(t,s,o)}(t.Bn);$e.set(t,a)}return $e.get(t)}class Ge{constructor(t,e){this.app=t,this.jn="(lite)",this.kn=!1,this.Mn=Ge.Qn(t),this.Bn=new X(e)}get Gn(){return this.kn}get Ln(){return void 0!==this.Wn}Yn(t){if(this.kn)throw new k(A,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.zn=t}Un(){return this.zn||(this.zn={}),this.kn=!0,this.zn}static Qn(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new k(v,'"projectId" not provided in firebase.initializeApp.');return new H(t.options.projectId)}_delete(){return this.Wn||(this.Wn=this.Hn()),this.Wn}Hn(){return function(t){const e=$e.get(t);e&&(P("ComponentProvider","Removing Datastore"),$e.delete(t),e.terminate())}(this),Promise.resolve()}}function ze(t,e,n){if(e.length!==n)throw new k(v,`Function ${t}() requires `+tn(n,"argument")+", but was called with "+tn(e.length,"argument")+".")}function He(t,e,n){if(e.length<n)throw new k(v,`Function ${t}() requires at least `+tn(n,"argument")+", but was called with "+tn(e.length,"argument")+".")}function Ke(t,e,n,r){!function(t,e,n,r){let i=!1;if(!(i="object"===e?Ye(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){const i=Qe(r);throw new k(v,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${i}`)}}(t,e,Ze(n)+" argument",r)}function We(t){if(!nt.rt(t))throw new k(v,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Xe(t){if(nt.rt(t))throw new k(v,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ye(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Qe(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":U()}function Je(t,e,n){if(n<=0)throw new k(v,`Function ${t}() requires its ${Ze(e)} argument to be a positive number, but it was: ${n}.`)}function Ze(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function tn(t,e){return`${t} ${e}`+(1===t?"":"s")}class en{constructor(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new k(v,"Function FieldPath() requires its fieldNames argument to be an array with at least "+tn(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(Ke("FieldPath","string",e,t[e]),0===t[e].length)throw new k(v,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Kn=new et(t)}}class nn extends en{constructor(...t){super(t)}static documentId(){return new nn(et.Z().W())}isEqual(t){if(!(t instanceof nn))throw function(t,e,n,r){const i=Qe(r);return new k(v,`Function isEqual() requires its ${Ze(1)} argument to be a FieldPath, but it was: ${i}`)}(0,0,0,t);return this.Kn.isEqual(t.Kn)}}const rn=new RegExp("[~\\*/\\[\\]]");class sn{constructor(t){this.Jn=t}}class on extends sn{Zn(t){if(2!==t.Xn)throw 1===t.Xn?t.te(this.Jn+"() can only appear at the top level of your update data"):t.te(this.Jn+"() cannot be used with set() unless you pass {merge:true}");return t.Et.push(t.path),null}isEqual(t){return t instanceof on}}function an(t,e,n){return new bn({Xn:3,ne:e.settings.ne,methodName:t.Jn,ee:n},e.i,e.serializer,e.ignoreUndefinedProperties)}class un extends sn{Zn(t){return new we(t.path,new de)}isEqual(t){return t instanceof un}}class cn extends sn{constructor(t,e){super(t),this.re=e}Zn(t){const e=an(this,t,!0),n=this.re.map(t=>An(t,e)),r=new pe(n);return new we(t.path,r)}isEqual(t){return this===t}}class hn extends sn{constructor(t,e){super(t),this.re=e}Zn(t){const e=an(this,t,!0),n=this.re.map(t=>An(t,e)),r=new ge(n);return new we(t.path,r)}isEqual(t){return this===t}}class ln extends sn{constructor(t,e){super(t),this.se=e}Zn(t){const e=new me(t.serializer,Jt(t.serializer,this.se));return new we(t.path,e)}isEqual(t){return this===t}}class fn{constructor(t,e){if(ze("GeoPoint",arguments,2),Ke("GeoPoint","number",1,t),Ke("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new k(v,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(v,"Longitude must be a number between -180 and 180, but was: "+e);this.ie=t,this.oe=e}get latitude(){return this.ie}get longitude(){return this.oe}isEqual(t){return this.ie===t.ie&&this.oe===t.oe}toJSON(){return{latitude:this.ie,longitude:this.oe}}N(t){return B(this.ie,t.ie)||B(this.oe,t.oe)}}class dn{constructor(t){this.ue=t}static fromBase64String(t){try{return new dn(st.fromBase64String(t))}catch(t){throw new k(v,"Failed to construct Bytes from Base64 string: "+t)}}static fromUint8Array(t){return new dn(st.fromUint8Array(t))}toBase64(){return this.ue.toBase64()}toUint8Array(){return this.ue.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.ue.isEqual(t.ue)}}class pn{constructor(t){this.ae=t}}const gn=/^__.*__$/;class mn{constructor(t,e,n){this.Mn=t,this.ce=e,this.he=n}}class yn{constructor(t,e,n){this.data=t,this.Et=e,this.fieldTransforms=n}le(t,e){const n=[];return null!==this.Et?n.push(new Ie(t,this.data,this.Et,e)):n.push(new Ee(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new _e(t,this.fieldTransforms)),n}}class wn{constructor(t,e,n){this.data=t,this.Et=e,this.fieldTransforms=n}le(t,e){const n=[new Ie(t,this.data,this.Et,e)];return this.fieldTransforms.length>0&&n.push(new _e(t,this.fieldTransforms)),n}}function vn(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}class bn{constructor(t,e,n,r,i,s){this.settings=t,this.i=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.fe(),this.fieldTransforms=i||[],this.Et=s||[]}get path(){return this.settings.path}get Xn(){return this.settings.Xn}de(t){return new bn(Object.assign(Object.assign({},this.settings),t),this.i,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Et)}_e(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.de({path:n,ee:!1});return r.we(t),r}me(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.de({path:n,ee:!1});return r.fe(),r}pe(t){return this.de({path:void 0,ee:!0})}te(t){return Rn(t,this.settings.methodName,this.settings.ye||!1,this.path,this.settings.ne)}contains(t){return void 0!==this.Et.find(e=>t.B(e))||void 0!==this.fieldTransforms.find(e=>t.B(e.field))}fe(){if(this.path)for(let t=0;t<this.path.length;t++)this.we(this.path.get(t))}we(t){if(0===t.length)throw this.te("Document fields must not be empty");if(vn(this.Xn)&&gn.test(t))throw this.te('Document fields cannot begin and end with "__"')}}class En{constructor(t,e,n){this.i=t,this.ignoreUndefinedProperties=e,this.serializer=n||je(t)}Ee(t,e,n,r=!1){return new bn({Xn:t,methodName:e,ne:n,path:et.H(),ee:!1,ye:r},this.i,this.serializer,this.ignoreUndefinedProperties)}}function In(t,e,n,r,i,s={}){const o=t.Ee(s.merge||s.mergeFields?2:0,e,n,i);xn("Data must be an object, but it was:",o,r);const a=Sn(r,o);let u,c;if(s.merge)u=new ye(o.Et),c=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){let i;if(r instanceof en)i=r.Kn;else{if("string"!=typeof r)throw U();i=On(e,r,n)}if(!o.contains(i))throw new k(v,`Field '${i}' is specified in your field mask but missing from your input data.`);kn(t,i)||t.push(i)}u=new ye(t),c=o.fieldTransforms.filter(t=>u.Rt(t.field))}else u=null,c=o.fieldTransforms;return new yn(new Ae(a),u,c)}function _n(t,e,n,r){const i=t.Ee(1,e,n);xn("Data must be an object, but it was:",i,r);const s=[],o=new Se;it(r,(t,r)=>{const a=On(e,t,n),u=i.me(a);if(r instanceof on||r instanceof pn&&r.ae instanceof on)s.push(a);else{const t=An(r,u);null!=t&&(s.push(a),o.set(a,t))}});const a=new ye(s);return new wn(o.Nt(),a,i.fieldTransforms)}function Tn(t,e,n,r,i,s){const o=t.Ee(1,e,n),a=[Dn(e,r,n)],u=[i];if(s.length%2!=0)throw new k(v,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)a.push(Dn(e,s[t])),u.push(s[t+1]);const c=[],h=new Se;for(let t=a.length-1;t>=0;--t)if(!kn(c,a[t])){const e=a[t],n=u[t],r=o.me(e);if(n instanceof on||n instanceof pn&&n.ae instanceof on)c.push(e);else{const t=An(n,r);null!=t&&(c.push(e),h.set(e,t))}}const l=new ye(c);return new wn(h.Nt(),l,o.fieldTransforms)}function Nn(t,e,n,r=!1){return An(n,t.Ee(r?4:3,e))}function An(t,e){if(t instanceof pn&&(t=t.ae),Ln(t))return xn("Unsupported field value:",e,t),Sn(t,e);if(t instanceof sn)return function(t,e){if(!vn(e.Xn))throw e.te(t.Jn+"() can only be used with update() and set()");if(!e.path)throw e.te(t.Jn+"() is not currently supported inside arrays");const n=t.Zn(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Et.push(e.path),t instanceof Array){if(e.settings.ee&&4!==e.Xn)throw e.te("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=An(i,e.pe(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Jt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Y.fromDate(t);return{timestampValue:Zt(e.serializer,n)}}if(t instanceof Y){const n=new Y(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Zt(e.serializer,n)}}if(t instanceof fn)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof dn)return{bytesValue:function(t,e){return t.yt?e.toBase64():e.toUint8Array()}(e.serializer,t.ue)};if(t instanceof mn){const n=e.i,r=t.Mn;if(!r.isEqual(n))throw e.te(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ee(t.Mn||e.i,t.ce.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.te("Unsupported field value: "+Qe(t))}(t,e)}function Sn(t,e){const n={};return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(t)?e.path&&e.path.length>0&&e.Et.push(e.path):it(t,(t,r)=>{const i=An(r,e._e(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Ln(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Y||t instanceof fn||t instanceof dn||t instanceof mn||t instanceof sn)}function xn(t,e,n){if(!Ln(n)||!Ye(n)){const r=Qe(n);throw"an object"===r?e.te(t+" a custom object"):e.te(t+" "+r)}}function Dn(t,e,n){if(e instanceof en)return e.Kn;if("string"==typeof e)return On(t,e);throw Rn("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function On(t,e,n){try{return function(t){if(t.search(rn)>=0)throw new k(v,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new nn(...t.split("."))}catch(e){throw new k(v,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).Kn}catch(e){throw Rn((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function Rn(t,e,n,r,i){const s=r&&!r.j(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)");let u="";return(s||o)&&(u+=" (found",s&&(u+=" in field "+r),o&&(u+=" in document "+i),u+=")"),new k(v,(a+=". ")+t+u)}function kn(t,e){return t.some(t=>t.isEqual(e))}class Cn{constructor(t,e,n,r,i){this.i=t,this.timestampsInSnapshots=e,this.Ie=n,this.Ae=r,this.Te=i}Pe(t){switch(lt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return yt(t.integerValue||t.doubleValue);case 3:return this.Re(t.timestampValue);case 4:return this.Ve(t);case 5:return t.stringValue;case 6:return this.Te(wt(t.bytesValue));case 7:return this.ge(t.referenceValue);case 8:return this.be(t.geoPointValue);case 9:return this.ve(t.arrayValue);case 10:return this.Ne(t.mapValue);default:throw U()}}Ne(t){const e={};return it(t.fields||{},(t,n)=>{e[t]=this.Pe(n)}),e}be(t){return new fn(yt(t.latitude),yt(t.longitude))}ve(t){return(t.values||[]).map(t=>this.Pe(t))}Ve(t){switch(this.Ie){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return ut(n)?t(n):n}(t);return null==e?null:this.Pe(e);case"estimate":return this.Re(ct(t));default:return null}}Re(t){const e=mt(t),n=new Y(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}ge(t){const e=Z.Y(t);F(le(e));const n=new H(e.get(1),e.get(3)),r=new nt(e.C(5));return n.isEqual(this.i)||V(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.i.projectId}/${this.i.database}) instead.`),this.Ae(r)}}class Pn{constructor(t,e,n,r){this.$e=t,this.ce=e,this.Fe=n,this.he=r}get id(){return this.ce.path.M()}get ref(){return new Hn(this.$e,this.he,this.ce.path)}exists(){return null!==this.Fe}data(){if(this.Fe){if(this.he){const t=new Vn(this.$e,this.ce,this.Fe,null);return this.he.fromFirestore(t)}return new Cn(this.$e.Mn,!0,"none",t=>new Hn(this.$e,null,t.path),t=>new dn(t)).Pe(this.Fe.qt())}}get(t){if(this.Fe){const e=this.Fe.data().field(Un("DocumentSnapshot.get",t));if(null!==e)return new Cn(this.$e.Mn,!0,"none",t=>new Hn(this.$e,this.he,t.path),t=>new dn(t)).Pe(e)}}}class Vn extends Pn{data(){return super.data()}}class Mn{constructor(t,e){this.query=t,this.De=e}get docs(){return[...this.De]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(t,e){this.De.forEach(t,e)}}function Un(t,e){return"string"==typeof e?On(t,e):e.Kn}class Fn{constructor(t){this.qe=t,this.xe=new Map,this.mutations=[],this.Se=!1,this.Oe=null,this.Ce=new Set}async Le(t){if(this.Ue(),this.mutations.length>0)throw new k(v,"Firestore transactions require all reads to be executed before all writes.");const e=await Ue(this.qe,t);return e.forEach(t=>{t instanceof De||t instanceof xe?this.Me(t):U()}),e}set(t,e){this.write(e.le(t,this.Tt(t))),this.Ce.add(t.toString())}update(t,e){try{this.write(e.le(t,this.je(t)))}catch(t){this.Oe=t}this.Ce.add(t.toString())}delete(t){this.write([new Te(t,this.Tt(t))]),this.Ce.add(t.toString())}async commit(){if(this.Ue(),this.Oe)throw this.Oe;const t=this.xe;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=nt.tt(e);this.mutations.push(new Ne(n,this.Tt(n)))}),await Me(this.qe,this.mutations),this.Se=!0}Me(t){let e;if(t instanceof xe)e=t.version;else{if(!(t instanceof De))throw U();e=Q.min()}const n=this.xe.get(t.key.toString());if(n){if(!e.isEqual(n))throw new k(S,"Document version changed between two reads.")}else this.xe.set(t.key.toString(),e)}Tt(t){const e=this.xe.get(t.toString());return!this.Ce.has(t.toString())&&e?ve.updateTime(e):ve.Vt()}je(t){const e=this.xe.get(t.toString());if(!this.Ce.has(t.toString())&&e){if(e.isEqual(Q.min()))throw new k(v,"Can't update a document that doesn't exist.");return ve.updateTime(e)}return ve.exists(!0)}write(t){this.Ue(),this.mutations=this.mutations.concat(t)}Ue(){}}class qn{constructor(t,e,n,r){this.zt=t,this.qe=e,this.updateFunction=n,this.Jt=r,this.Be=5,this.hn=new Re(this.zt,"transaction_retry")}run(){this.ke()}ke(){this.hn.kt(async()=>{const t=new Fn(this.qe),e=this.Qe(t);e&&e.then(e=>{this.zt.nn(()=>t.commit().then(()=>{this.Jt.resolve(e)}).catch(t=>{this.Ge(t)}))}).catch(t=>{this.Ge(t)})})}Qe(t){try{const e=this.updateFunction(t);return!ot(e)&&e.catch&&e.then?e:(this.Jt.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Jt.reject(t),null}}Ge(t){this.Be>0&&this.We(t)?(this.Be-=1,this.zt.nn(()=>(this.ke(),Promise.resolve()))):this.Jt.reject(t)}We(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!function(t){switch(e){case m:return U();case y:case w:case b:case N:case D:case O:case T:return!1;case v:case E:case I:case _:case A:case S:case L:case x:case R:return!0;default:return U()}}()}return!1}}function jn(t,e,n){if("string"==typeof n){if(""===n)throw new k(v,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Dt(e)&&-1!==n.indexOf("/"))throw new k(v,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Z.Y(n));if(!nt.rt(r))throw new k(v,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return vt(t,new nt(r))}if(n instanceof mn)return vt(t,n.ce);throw new k(v,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Qe(n)+".")}function $n(t,e){if(!Array.isArray(t)||0===t.length)throw new k(v,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new k(v,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new k(v,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new k(v,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Bn(t,e,n){if(!n.isEqual(e))throw new k(v,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function Gn(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class zn extends en{constructor(...t){super(t)}isEqual(t){return this.Kn.isEqual(t.Kn)}}class Hn extends mn{constructor(t,e,n){super(t.Mn,new nt(n),e),this.firestore=t,this.Ye=n,this.type="document"}get id(){return this.Ye.M()}get path(){return this.Ye.W()}get parent(){return new er(this.firestore,this.he,this.ce.path.L())}withConverter(t){return new Hn(this.firestore,t,this.Ye)}}class Kn{constructor(t,e,n){this.firestore=t,this.he=e,this.ze=n,this.type="query"}withConverter(t){return new Kn(this.firestore,t,this.ze)}}class Wn{}class Xn extends Wn{constructor(t,e,n){super(),this.Ke=t,this.Je=e,this.Ze=n,this.type="where"}He(t){const e=ir(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.J()){if("array-contains"===s||"array-contains-any"===s)throw new k(v,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){$n(o,s);const e=[];for(const n of o)e.push(jn(r,t,n));a={arrayValue:{values:e}}}else a=jn(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||$n(o,s),a=Nn(n,e,o,"in"===s||"not-in"===s);const u=kt.create(i,s,a);return function(t,e){if(e.dt()){const n=xt(t);if(null!==n&&!n.isEqual(e.field))throw new k(v,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=Lt(t);null!==r&&Bn(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new k(v,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(v,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.ze,"where",e,t.firestore.Mn,this.Ke,this.Je,this.Ze);return new Kn(t.firestore,t.he,function(t,e){const n=t.filters.concat([e]);return new At(t.path,t.collectionGroup,t.ct.slice(),n,t.limit,t.ht,t.startAt,t.endAt)}(t.ze,n))}}class Yn extends Wn{constructor(t,e){super(),this.Ke=t,this.Xe=e,this.type="orderBy"}He(t){const e=function(t,e,n){if(null!==t.startAt)throw new k(v,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new k(v,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Gt(e,n);return function(t,e){if(null===Lt(t)){const n=xt(t);null!==n&&Bn(0,n,e.field)}}(t,r),r}(t.ze,this.Ke,this.Xe);return new Kn(t.firestore,t.he,function(t,e){const n=t.ct.concat([e]);return new At(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.ht,t.startAt,t.endAt)}(t.ze,e))}}class Qn extends Wn{constructor(t,e,n){super(),this.type=t,this.tr=e,this.nr=n}He(t){return new Kn(t.firestore,t.he,function(t,e,n){return new At(t.path,t.collectionGroup,t.ct.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.ze,this.tr,this.nr))}}class Jn extends Wn{constructor(t,e,n){super(),this.type=t,this.er=e,this.rr=n}He(t){const e=tr(t,this.type,this.er,this.rr);return new Kn(t.firestore,t.he,function(t,e){return new At(t.path,t.collectionGroup,t.ct.slice(),t.filters.slice(),t.limit,t.ht,e,t.endAt)}(t.ze,e))}}class Zn extends Wn{constructor(t,e,n){super(),this.type=t,this.er=e,this.rr=n}He(t){const e=tr(t,this.type,this.er,this.rr);return new Kn(t.firestore,t.he,function(t,e){return new At(t.path,t.collectionGroup,t.ct.slice(),t.filters.slice(),t.limit,t.ht,t.startAt,e)}(t.ze,e))}}function tr(t,e,n,r){if(n[0]instanceof Pn)return ze(e,n,1),function(t,e,n,r,i){if(!r)throw new k(E,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const s=[];for(const n of Ot(t))if(n.field.J())s.push(vt(e,r.key));else{const t=r.field(n.field);if(ut(t))throw new k(v,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.W();throw new k(v,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}s.push(t)}return new $t(s,i)}(t.ze,t.firestore.Mn,e,n[0].Fe,r);{const i=ir(t.firestore);return function(t,e,n,r,i,s){const o=t.ct;if(i.length>o.length)throw new k(v,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const u=i[s];if(o[s].field.J()){if("string"!=typeof u)throw new k(v,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!Dt(t)&&-1!==u.indexOf("/"))throw new k(v,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Z.Y(u));if(!nt.rt(n))throw new k(v,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new nt(n);a.push(vt(e,i))}else{const t=Nn(n,r,u);a.push(t)}}return new $t(a,s)}(t.ze,t.firestore.Mn,i,e,n,r)}}class er extends Kn{constructor(t,e,n){super(t,e,new At(n)),this.firestore=t,this.Ye=n,this.type="collection"}get id(){return this.ze.path.M()}get path(){return this.ze.path.W()}get parent(){const t=this.Ye.L();return t.j()?null:new Hn(this.firestore,null,t)}withConverter(t){return new er(this.firestore,t,this.Ye)}}function nr(t,e,...n){if(1===arguments.length&&(e=$.t()),sr("doc","path",e),t instanceof Ge){const r=Z.Y(e,...n);return We(r),new Hn(t,null,r)}{if(!(t instanceof Hn||t instanceof er))throw new k(v,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t.Ye.child(Z.Y(e,...n));return We(r),new Hn(t.firestore,t instanceof er?t.he:null,r)}}function rr(t,e){return t instanceof Kn&&e instanceof Kn&&t.firestore===e.firestore&&function(t,e){return function(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!zt(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],r=e.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!ft(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Bt(t.startAt,e.startAt)&&Bt(t.endAt,e.endAt)}(Rt(t),Rt(e))&&t.ht===e.ht}(t.ze,e.ze)&&t.he===e.he}function ir(t){const e=t.Un(),n=je(t.Mn);return new En(t.Mn,!!e.ignoreUndefinedProperties,n)}function sr(t,e,n){if(!n)throw new k(v,`Function ${t}() cannot be called with an empty ${e}.`)}class or{constructor(t,e){this.$e=t,this.sr=e,this.ir=[],this.ur=!1,this.ar=ir(t)}set(t,e,n){this.cr();const r=ar(t,this.$e),i=Gn(r.he,e,n),s=In(this.ar,"WriteBatch.set",r.ce,i,null!==r.he,n);return this.ir=this.ir.concat(s.le(r.ce,ve.Vt())),this}update(t,e,n,...r){this.cr();const i=ar(t,this.$e);let s;return s="string"==typeof e||e instanceof zn?Tn(this.ar,"WriteBatch.update",i.ce,e,n,r):_n(this.ar,"WriteBatch.update",i.ce,e),this.ir=this.ir.concat(s.le(i.ce,ve.exists(!0))),this}delete(t){this.cr();const e=ar(t,this.$e);return this.ir=this.ir.concat(new Te(e.ce,ve.Vt())),this}commit(){return this.cr(),this.ur=!0,this.ir.length>0?this.sr(this.ir):Promise.resolve()}cr(){if(this.ur)throw new k(A,"A write batch can no longer be used after commit() has been called.")}}function ar(t,e){if(t.firestore!==e)throw new k(v,"Provided document reference is from a different Firestore instance.");return t}class ur{constructor(t,e){this.$e=t,this.hr=e,this.ar=ir(t)}get(t){const e=ar(t,this.$e);return this.hr.Le([e.ce]).then(t=>{if(!t||1!==t.length)return U();const n=t[0];if(n instanceof De)return new Pn(this.$e,e.ce,null,e.he);if(n instanceof xe)return new Pn(this.$e,n.key,n,e.he);throw U()})}set(t,e,n){const r=ar(t,this.$e),i=Gn(r.he,e,n),s=In(this.ar,"Transaction.set",r.ce,i,null!==r.he,n);return this.hr.set(r.ce,s),this}update(t,e,n,...r){const i=ar(t,this.$e);let s;return s="string"==typeof e||e instanceof zn?Tn(this.ar,"Transaction.update",i.ce,e,n,r):_n(this.ar,"Transaction.update",i.ce,e),this.hr.update(i.ce,s),this}delete(t){const e=ar(t,this.$e);return this.hr.delete(e.ce),this}}e._registerComponent(new c("firestore/lite",t=>((t,e)=>new Ge(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-lite","0.0.800","node"),t.Bytes=dn,t.CollectionReference=er,t.DocumentReference=Hn,t.DocumentSnapshot=Pn,t.FieldPath=zn,t.FieldValue=sn,t.FirebaseFirestore=Ge,t.FirestoreError=k,t.GeoPoint=fn,t.Query=Kn,t.QueryConstraint=Wn,t.QueryDocumentSnapshot=Vn,t.QuerySnapshot=Mn,t.Timestamp=Y,t.Transaction=ur,t.WriteBatch=or,t.addDoc=function(t,e){const n=nr(t),r=Gn(t.he,e),i=In(ir(t.firestore),"addDoc",n.ce,r,null!==n.he,{});return Me(Be(t.firestore),i.le(n.ce,ve.exists(!1))).then(()=>n)},t.arrayRemove=function(...t){return He("arrayRemove()",arguments,1),new hn("arrayRemove",t)},t.arrayUnion=function(...t){return He("arrayUnion()",arguments,1),new cn("arrayUnion",t)},t.collection=function(t,e,...n){if(sr("collection","path",e),t instanceof Ge){const r=Z.Y(e,...n);return Xe(r),new er(t,null,r)}{if(!(t instanceof Hn||t instanceof er))throw new k(v,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=Z.Y(t.path,...n).child(Z.Y(e));return Xe(r),new er(t.firestore,null,r)}},t.collectionGroup=function(t,e){if(sr("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(v,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Kn(t,null,function(t){return new At(Z.H(),t)}(e))},t.deleteDoc=function(t){return Me(Be(t.firestore),[new Te(t.ce,ve.Vt())])},t.deleteField=function(){return new on("deleteField")},t.doc=nr,t.documentId=function(){return new zn("__name__")},t.endAt=function(...t){return new Zn("endAt",t,!1)},t.endBefore=function(...t){return new Zn("endBefore",t,!0)},t.getDoc=function(t){return Ue(Be(t.firestore),[t.ce]).then(e=>{F(1===e.length);const n=e[0];return new Pn(t.firestore,t.ce,n instanceof xe?n:null,t.he)})},t.getDocs=function(t){return function(t){if(St(t)&&0===t.ct.length)throw new k(x,"limitToLast() queries require specifying at least one orderBy() clause")}(t.ze),async function(t,e){const n=q(t),r=ue(n.serializer,Rt(e));return(await n.Nn("RunQuery",r.parent,{structuredQuery:r.structuredQuery})).filter(t=>!!t.document).map(t=>(function(t,e,n){const r=re(t,e.name),i=te(e.updateTime),s=new Ae({mapValue:{fields:e.fields}});return new xe(r,i,s,{hasCommittedMutations:!1})})(n.serializer,t.document))}(Be(t.firestore),t.ze).then(e=>{const n=e.map(e=>new Vn(t.firestore,e.key,e,t.he));return St(t.ze)&&n.reverse(),new Mn(t,n)})},t.getFirestore=function(t){return e._getProvider(t,"firestore/lite").getImmediate()},t.increment=function(t){return new ln("increment",t)},t.initializeFirestore=function(t,n){const r=e._getProvider(t,"firestore/lite").getImmediate();return r.Yn(n),r},t.limit=function(t){return Je("limit",1,t),new Qn("limit",t,"F")},t.limitToLast=function(t){return Je("limitToLast",1,t),new Qn("limitToLast",t,"L")},t.orderBy=function(t,e="asc"){const n=e,r=Un("orderBy",t);return new Yn(r,n)},t.query=function(t,...e){for(const n of e)t=n.He(t);return t},t.queryEqual=rr,t.refEqual=function(t,e){return(t instanceof Hn||t instanceof er)&&(e instanceof Hn||e instanceof er)&&t.firestore===e.firestore&&t.path===e.path&&t.he===e.he},t.runTransaction=function(t,e){const n=Be(t),r=new Oe;return new qn(new Pe,n,n=>e(new ur(t,n)),r).run(),r.promise},t.serverTimestamp=function(){return new un("serverTimestamp")},t.setDoc=function(t,e,n){const r=Gn(t.he,e,n),i=In(ir(t.firestore),"setDoc",t.ce,r,null!==t.he,n);return Me(Be(t.firestore),i.le(t.ce,ve.Vt()))},t.setLogLevel=function(t){C.setLogLevel(t)},t.snapshotEqual=function t(e,n){return e instanceof Pn&&n instanceof Pn?e.$e===n.$e&&e.ce.isEqual(n.ce)&&(null===e.Fe?null===n.Fe:e.Fe.isEqual(n.Fe))&&e.he===n.he:e instanceof Mn&&n instanceof Mn&&rr(e.query,n.query)&&G(e.docs,n.docs,t)},t.startAfter=function(...t){return new Jn("startAfter",t,!1)},t.startAt=function(...t){return new Jn("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore/lite"),t._delete()},t.updateDoc=function(t,e,n,...r){const i=ir(t.firestore);let s;return s="string"==typeof e||e instanceof zn?Tn(i,"updateDoc",t.ce,e,n,r):_n(i,"updateDoc",t.ce,e),Me(Be(t.firestore),s.le(t.ce,ve.exists(!0)))},t.where=function(t,e,n){const r=e,i=Un("where",t);return new Xn(i,r,n)},t.writeBatch=function(t){const e=Be(t);return new or(t,t=>Me(e,t))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore-lite.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.performance=t.firebase.performance||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}var s="FirebaseError",o=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=s,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,a.prototype.create),i}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error),a=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,s=this.errors[t],a=s?function(t,e){return t.replace(h,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(s,r):"Error",u=this.serviceName+": "+a+" ("+i+").",c=new o(i,u),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=r[d])}return c},t}();var u,c,h=/\{\$([^}]+)}/g;function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(c||(c={}));var f,d,p,g={debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT},m=c.INFO,y=((u={})[c.DEBUG]="log",u[c.VERBOSE]="log",u[c.INFO]="info",u[c.WARN]="warn",u[c.ERROR]="error",u),w=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),s=y[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,l(["["+i+"]  "+t.name+":"],n))}},v=function(){function t(t){this.name=t,this._logLevel=m,this._logHandler=w,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in c))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?g[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,c.DEBUG],t)),this._logHandler.apply(this,l([this,c.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,c.VERBOSE],t)),this._logHandler.apply(this,l([this,c.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,c.INFO],t)),this._logHandler.apply(this,l([this,c.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,c.WARN],t)),this._logHandler.apply(this,l([this,c.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,c.ERROR],t)),this._logHandler.apply(this,l([this,c.ERROR],t))},t}(),b=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),E="0.0.800",I="FB-PERF-TRACE-START",_="FB-PERF-TRACE-STOP",T="FB-PERF-TRACE-MEASURE",N="_wt_",A="@firebase/performance/config",S="@firebase/performance/configexpire",L=((f={})["trace started"]="Trace {$traceName} was started before.",f["trace stopped"]="Trace {$traceName} is not running.",f["no window"]="Window is not available.",f["no app id"]="App id is not available.",f["no project id"]="Project id is not available.",f["no api key"]="Api key is not available.",f["invalid cc log"]="Attempted to queue invalid cc event",f["FB not default"]="Performance can only start when Firebase app instance is the default one.",f["RC response not ok"]="RC response is not ok",f["invalid attribute name"]="Attribute name {$attributeName} is invalid.",f["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",f["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",f["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",f),x=new a("performance","Performance",L),D=new v("Performance");D.logLevel=c.INFO;var O,R,k=function(){function t(t){if(this.window=t,!t)throw x.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}return t.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},t.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},t.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},t.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},t.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},t.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},t.prototype.requiredApisAvailable=function(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?"indexedDB"in self&&null!=indexedDB||(D.info("IndexedDB is not supported by current browswer"),!1):(D.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)},t.prototype.setupObserver=function(t,e){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var n=0,r=t.getEntries();n<r.length;n++){var i=r[n];e(i)}}).observe({entryTypes:[t]})},t.getInstance=function(){return void 0===d&&(d=new t(p)),d},t}();function C(){return O}function P(t,e){var n=t.length-e.length;if(n<0||n>1)throw x.create("invalid String merger input");for(var r=[],i=0;i<t.length;i++)r.push(t.charAt(i)),e.length>i&&r.push(e.charAt(i));return r.join("")}var V,M=function(){function t(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=P("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=P("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return t.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},t.getInstance=function(){return void 0===R&&(R=new t),R},t}();!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN"}(V||(V={}));var U=["firebase_","google_","ga_"],F=new RegExp("^[a-zA-Z]\\w*$"),q=40,j=100;function $(){switch(k.getInstance().document.visibilityState){case"visible":return V.VISIBLE;case"hidden":return V.HIDDEN;default:return V.UNKNOWN}}function B(t){var e,n=null===(e=t.options)||void 0===e?void 0:e.appId;if(!n)throw x.create("no app id");return n}var G="0.0.1",z={loggingEnabled:!0},H="FIREBASE_INSTALLATIONS_AUTH";function K(t,e){var n=function(){var t=k.getInstance().localStorage;if(!t)return;var e=t.getItem(S);if(!(e&&(n=e,Number(n)>Date.now())))return;var n;var r=t.getItem(A);if(!r)return;try{var i=JSON.parse(r);return i}catch(t){return}}();return n?(X(n),Promise.resolve()):function(t,e){return(n=t.installations,r=n.getToken(),r.then(function(t){}),r).then(function(n){var r=function(t){var e,n=null===(e=t.options)||void 0===e?void 0:e.projectId;if(!n)throw x.create("no project id");return n}(t.app),i=function(t){var e,n=null===(e=t.options)||void 0===e?void 0:e.apiKey;if(!n)throw x.create("no api key");return n}(t.app),s="https://firebaseremoteconfig.googleapis.com/v1/projects/"+r+"/namespaces/fireperf:fetch?key="+i,o=new Request(s,{method:"POST",headers:{Authorization:H+" "+n},body:JSON.stringify({app_instance_id:e,app_instance_id_token:n,app_id:B(t.app),app_version:E,sdk_version:G})});return fetch(o).then(function(t){if(t.ok)return t.json();throw x.create("RC response not ok")})}).catch(function(){D.info(W)});var n,r}(t,e).then(X).then(function(t){return function(t){var e=k.getInstance().localStorage;if(!t||!e)return;e.setItem(A,JSON.stringify(t)),e.setItem(S,String(Date.now()+60*M.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var W="Could not fetch config, will use default configs";function X(t){if(!t)return t;var e=M.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=z.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(e.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=Y(e.tracesSamplingRate),e.logNetworkAfterSampling=Y(e.networkRequestsSamplingRate),t}function Y(t){return Math.random()<=t}var Q,J=1;function Z(t){return J=2,Q=Q||function(t){return(e=k.getInstance().document,new Promise(function(t){if(e&&"complete"!==e.readyState){var n=function(){"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()})).then(function(){return e=t.installations,(n=e.getId()).then(function(t){O=t}),n;var e,n}).then(function(e){return K(t,e)}).then(function(){return tt()},function(){return tt()});var e}(t)}function tt(){J=3}var et,nt=1e4,rt=5500,it=3,st=it,ot=[],at=!1;function ut(t){setTimeout(function(){if(0!==st)return ot.length?void function(){var t=i(ot);ot=[];var e=t.map(function(t){return{source_extension_json_proto3:t.message,event_time_ms:String(t.eventTime)}});(function(t,e){return function(t){var e=M.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(t)})}(t).then(function(t){return t.ok||D.info("Call to Firebase backend failed."),t.json()}).then(function(t){var n=Number(t.nextRequestWaitMillis),r=nt;isNaN(n)||(r=Math.max(n,r));var s=t.logResponseDetails;Array.isArray(s)&&s.length>0&&"RETRY_REQUEST_LATER"===s[0].responseAction&&(ot=i(e,ot),D.info("Retry transport request later.")),st=it,ut(r)})})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:M.getInstance().logSource,log_event:e},t).catch(function(){ot=i(t,ot),st--,D.info("Tries left: "+st+"."),ut(nt)})}():ut(nt)},t)}function ct(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];!function(t){if(!t.eventTime||!t.message)throw x.create("invalid cc log");ot=i(ot,[t])}({message:t.apply(void 0,e),eventTime:Date.now()})}}function ht(t,e){et||(et=ct(dt)),et(t,e)}function lt(t){var e=M.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&k.getInstance().requiredApisAvailable()&&(t.isAuto&&$()!==V.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===J?ft(t):Z(t.performanceController).then(function(){return ft(t)},function(){return ft(t)})))}function ft(t){C()&&setTimeout(function(){return ht(t,1)},0)}function dt(t,e){return 0===e?(r={url:(n=t).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},i={application_info:pt(n.performanceController.app),network_request_metric:r},JSON.stringify(i)):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=t.counters);var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=n);var r={application_info:pt(t.performanceController.app),trace_metric:e};return JSON.stringify(r)}(t);var n,r,i}function pt(t){return{google_app_id:B(t),app_instance_id:C(),web_app_info:{sdk_version:E,page_url:k.getInstance().getUrl(),service_worker_status:(e=k.getInstance().navigator,"serviceWorker"in e?e.serviceWorker.controller?2:3:1),visibility_state:$(),effective_connection_type:function(){var t=k.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var e}var gt=100,mt="_",yt=["_fp","_fcp","_fid"];var wt=function(){function t(t,e,n,r){void 0===n&&(n=!1),this.performanceController=t,this.name=e,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=k.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=I+"-"+this.randomId+"-"+this.name,this.traceStopMark=_+"-"+this.randomId+"-"+this.name,this.traceMeasure=r||T+"-"+this.randomId+"-"+this.name,r&&this.calculateTraceMetrics())}return t.prototype.start=function(){if(1!==this.state)throw x.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},t.prototype.stop=function(){if(2!==this.state)throw x.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),lt(this)},t.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=r({},n.attributes)),n&&n.metrics)for(var i=0,s=Object.keys(n.metrics);i<s.length;i++){var o=s[i];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}lt(this)},t.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]?this.putMetric(t,e):this.putMetric(t,this.counters[t]+e)},t.prototype.putMetric=function(t,e){if(i=t,s=this.name,0===i.length||i.length>gt||!(s&&s.startsWith(N)&&yt.indexOf(i)>-1)&&i.startsWith(mt))throw x.create("invalid custom metric name",{customMetricName:t});var n,r,i,s;this.counters[t]=(n=e,(r=Math.floor(n))<n&&D.info("Metric value should be an Integer, setting the value as : "+r+"."),r)},t.prototype.getMetric=function(t){return this.counters[t]||0},t.prototype.putAttribute=function(t,e){var n,r=!(0===(n=t).length||n.length>q||U.some(function(t){return n.startsWith(t)})||!n.match(F)),i=function(t){return 0!==t.length&&t.length<=j}(e);if(r&&i)this.customAttributes[t]=e;else{if(!r)throw x.create("invalid attribute name",{attributeName:t});if(!i)throw x.create("invalid attribute value",{attributeValue:e})}},t.prototype.getAttribute=function(t){return this.customAttributes[t]},t.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},t.prototype.getAttributes=function(){return r({},this.customAttributes)},t.prototype.setStartTime=function(t){this.startTimeUs=t},t.prototype.setDuration=function(t){this.durationUs=t},t.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},t.createOobTrace=function(e,n,r,i){var s=k.getInstance().getUrl();if(s){var o=new t(e,N+s,!0),a=Math.floor(1e3*k.getInstance().getTimeOrigin());o.setStartTime(a),n&&n[0]&&(o.setDuration(Math.floor(1e3*n[0].duration)),o.putMetric("domInteractive",Math.floor(1e3*n[0].domInteractive)),o.putMetric("domContentLoadedEventEnd",Math.floor(1e3*n[0].domContentLoadedEventEnd)),o.putMetric("loadEventEnd",Math.floor(1e3*n[0].loadEventEnd)));if(r){var u=r.find(function(t){return"first-paint"===t.name});u&&u.startTime&&o.putMetric("_fp",Math.floor(1e3*u.startTime));var c=r.find(function(t){return"first-contentful-paint"===t.name});c&&c.startTime&&o.putMetric("_fcp",Math.floor(1e3*c.startTime)),i&&o.putMetric("_fid",Math.floor(1e3*i))}lt(o)}},t.createUserTimingTrace=function(e,n){lt(new t(e,n,!1,n))},t}();function vt(t,e){var n=e;if(n&&void 0!==n.responseStart){var r=k.getInstance().getTimeOrigin(),i=Math.floor(1e3*(n.startTime+r)),s=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,o=Math.floor(1e3*(n.responseEnd-n.startTime));!function(t){var e=M.getInstance();if(e.instrumentationEnabled){var n=t.url,r=e.logEndPointUrl.split("?")[0],i=e.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return ht(t,0)},0)}}({performanceController:t,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:i,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o})}}var bt=5e3;function Et(t){C()&&(setTimeout(function(){return function(t){var e=k.getInstance(),n=e.getEntriesByType("navigation"),r=e.getEntriesByType("paint");if(e.onFirstInputDelay){var i=setTimeout(function(){wt.createOobTrace(t,n,r),i=void 0},bt);e.onFirstInputDelay(function(e){i&&(clearTimeout(i),wt.createOobTrace(t,n,r,e))})}else wt.createOobTrace(t,n,r)}(t)},0),setTimeout(function(){return function(t){for(var e=k.getInstance(),n=e.getEntriesByType("resource"),r=0,i=n;r<i.length;r++){var s=i[r];vt(t,s)}e.setupObserver("resource",function(e){return vt(t,e)})}(t)},0),setTimeout(function(){return function(t){for(var e=k.getInstance(),n=e.getEntriesByType("measure"),r=0,i=n;r<i.length;r++){var s=i[r];It(t,s)}e.setupObserver("measure",function(e){return It(t,e)})}(t)},0))}function It(t,e){var n=e.name;n.substring(0,T.length)!==T&&wt.createUserTimingTrace(t,n)}var _t=function(){function t(t,e){this.app=t,this.installations=e,this.initialized=!1}return t.prototype._init=function(t){var e=this;this.initialized||(void 0!==(null==t?void 0:t.dataCollectionEnabled)&&(this.dataCollectionEnabled=t.dataCollectionEnabled),void 0!==(null==t?void 0:t.instrumentationEnabled)&&(this.instrumentationEnabled=t.instrumentationEnabled),k.getInstance().requiredApisAvailable()?new Promise(function(t,e){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=window.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||window.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}).then(function(t){t&&(at||(ut(rt),at=!0),Z(e).then(function(){return Et(e)},function(){return Et(e)}),e.initialized=!0)}).catch(function(t){D.info("Environment doesn't support IndexedDB: "+t)}):D.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))},Object.defineProperty(t.prototype,"instrumentationEnabled",{get:function(){return M.getInstance().instrumentationEnabled},set:function(t){M.getInstance().instrumentationEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataCollectionEnabled",{get:function(){return M.getInstance().dataCollectionEnabled},set:function(t){M.getInstance().dataCollectionEnabled=t},enumerable:!1,configurable:!0}),t}();var Tt=function(t){var e=t.getProvider("app-exp").getImmediate(),n=t.getProvider("installations-exp-internal").getImmediate();if("[DEFAULT]"!==e.name)throw x.create("FB not default");if("undefined"==typeof window)throw x.create("no window");return function(t){p=t}(window),new _t(e,n)};function Nt(){e._registerComponent(new b("performance-exp",Tt,"PUBLIC"))}Nt(),e.registerVersion("@firebase/performance-exp","0.0.800"),t.getPerformance=function(t,n){var r=e._getProvider(t,"performance-exp").getImmediate();return r._init(n),r},t.registerPerformance=Nt,t.trace=function(t,e){return new wt(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-performance.js - be sure to load firebase-app.js first.")}});