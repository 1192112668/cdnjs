!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(ep){"use strict";try{(function(){ep=ep&&Object.prototype.hasOwnProperty.call(ep,"default")?ep.default:ep;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(g,f=Error),g);function g(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,E=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_=_||{},S=A||self;function k(){}function D(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){var e=D(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),P=0;function V(t,e,n){return t.call.apply(t.bind,arguments)}function L(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:L).apply(null,arguments)}function M(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var U=Date.now||function(){return+new Date};function j(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.da=function(){!this.j&&(this.j=!0,this.C(),0)&&(Object.prototype.hasOwnProperty.call(this,R)&&this[R]||(this[R]=++P))},q.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Q,K=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var X=S.navigator;if(X){var $=X.userAgent;if($){Q=$;break t}}Q=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=k;var rt,it,ot=H(Q,"Opera"),st=H(Q,"Trident")||H(Q,"MSIE"),ut=H(Q,"Edge"),at=ut||st,ht=H(Q,"Gecko")&&!(H(Q.toLowerCase(),"webkit")&&!H(Q,"Edge"))&&!(H(Q,"Trident")||H(Q,"MSIE"))&&!H(Q,"Edge"),ct=H(Q.toLowerCase(),"webkit")&&!H(Q,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=Q,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt={};function vt(u){return t=u,e=function(){for(var t=0,e=K(String(rt)).split("."),n=K(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=yt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var gt=S.document&&st&&(ft()||parseInt(rt,10))||void 0,mt=!st||9<=Number(gt),wt=st&&!vt("9"),bt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",k,e),S.removeEventListener("test",k,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},j(Tt,Et);var It={2:"touch",3:"pen",4:"mouse"};Tt.prototype.b=function(){Tt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,wt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),At=0;function _t(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++At,this.V=this.X=!1}function St(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function kt(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n,r,i,o=e.type;o in t.a&&(r=t.a[o],(n=0<=(i=F(r,e)))&&Array.prototype.splice.call(r,i,1),n&&(St(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}kt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=xt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new _t(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Rt={};function Pt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ft(r),e&&e[Nt]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Vt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Pt(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[Nt]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Vt(t,e,n,!1,r,i)}function Vt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!mt)return null;var u,a,h=jt(t);if(h||(t[Ot]=h=new kt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=Ut,r=a=mt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)bt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.V&&((e=t.src)&&e[Nt]?Dt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Dt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):St(t)))}function Ct(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Lt(t),n.call(r,e)}function Ut(t,e){if(t.V)return!0;if(mt)return Mt(t,new Tt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new Tt(e,this))}function jt(t){return(t=t[Ot])instanceof kt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==D(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Bt(){q.call(this),this.c=new kt(this),(this.J=this).A=null}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.V&&a.capture==n&&(s=a.listener,u=a.aa||a.src,a.X&&Dt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(Bt,q),Bt.prototype[Nt]=!0,(N=Bt.prototype).addEventListener=function(t,e,n,r){Pt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ft(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&Lt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Et(t,n):t instanceof Et?t.target=t.target||n:(s=t,et(t=new Et(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Gt(o,r,!0,t)&&s;if(s=Gt(o=t.a=n,r,!0,t)&&s,s=Gt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Gt(o=t.a=e[i],r,!1,t)&&s;return s},N.C=function(){if(Bt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.A=null},N.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=S.JSON.stringify;function Wt(){this.b=this.a=null}var Qt,Kt=(Ht.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Ht(function(){return new Yt},function(t){t.reset()},100));function Ht(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Yt(){this.next=this.b=this.a=null}function Xt(t){S.setTimeout(function(){throw t},0)}function $t(t,e){var n;Qt||(n=S.Promise.resolve(void 0),Qt=function(){n.then(te)}),Jt||(Qt(),Jt=!0),Zt.add(t,e)}Wt.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Jt=!(Yt.prototype.reset=function(){this.next=this.b=this.a=null}),Zt=new Wt;function te(){for(var t,e,n;n=e=void 0,n=null,(e=Zt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Xt(t)}var r=Kt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Jt=!1}function ee(t,e){Bt.call(this),this.b=t||1,this.a=e||S,this.f=C(this.Ua,this),this.g=U()}function ne(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function re(t,e,n){if("function"==D(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function ie(t,e,n){q.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function oe(t){t.T=re(t.b,t.c),t.f.apply(null,t.a)}function se(t){q.call(this),this.b=t,this.a={}}j(ee,Bt),(N=ee.prototype).Z=!1,N.L=null,N.Ua=function(){var t;this.Z&&(0<(t=U()-this.g)&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ne(this),this.start())))},N.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=U())},N.C=function(){ee.M.C.call(this),ne(this),delete this.a},j(ie,q),(N=ie.prototype).ba=!1,N.T=null,N.Ia=function(t){this.a=arguments,this.T?this.ba=!0:oe(this)},N.C=function(){ie.M.C.call(this),this.T&&(S.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},N.Pa=function(){this.T=null,this.ba&&(this.ba=!1,oe(this))},j(se,q);var ue=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=Pt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function ce(){}se.prototype.C=function(){se.M.C.call(this),he(this)},se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=null;function le(){return fe=fe||new Bt}function pe(t){Et.call(this,"serverreachability",t)}function de(){var t=le();t.dispatchEvent(new pe(t))}function ye(t){Et.call(this,"statevent",t)}function ve(){var t=le();t.dispatchEvent(new ye(t))}function ge(t){Et.call(this,"timingevent",t)}function me(t,e){if("function"!=D(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}j(pe,Et),j(ye,Et),j(ge,Et);var we={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},be={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ee(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ie(){}Ee.prototype.a=null;var Ne,Ae={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function _e(){Et.call(this,"d")}function Se(){Et.call(this,"c")}function ke(){}function De(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new se(this),this.N=xe,t=at?125:void 0,this.O=new ee(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}j(_e,Et),j(Se,Et),j(ke,Ee),Ne=new ke;var xe=45e3,Oe={},Re={};function Pe(t,e,n){t.B=1,t.f=tn(He(e)),t.j=n,t.F=!0,Ve(t,null)}function Ve(t,e){t.s=U(),Ce(t),t.A=He(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),dn(n.b,"t",r),t.w=0,t.a=or(t.g,t.g.w?e:null),0<t.J&&(t.D=new ie(C(t.ya,t,t.a),t.J)),ae(t.G,t.a,"readystatechange",t.Sa),e=t.m?Z(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),de()}function Le(t,e,n){for(var r,i,o,s,u=!0;!t.l&&t.w<n.length;){var a=(i=n,s=o=void 0,o=(r=t).w,-1==(s=i.indexOf("\n",o))?Re:(o=Number(i.substring(o,s)),isNaN(o)?Oe:(s+=1)+o>i.length?Re:(i=i.substr(s,o),r.w=s+o,i)));if(a==Re){4==e&&(t.c=4,ve(),u=!1);break}if(a==Oe){t.c=4,ve(),u=!1;break}Fe(t,a)}4==e&&0==n.length&&(t.c=1,ve(),u=!1),t.b=t.b&&u,u||(qe(t),je(t))}function Ce(t){t.P=U()+t.N,Me(t,t.N)}function Me(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=me(C(t.Qa,t),e)}function Ue(t){t.h&&(S.clearTimeout(t.h),t.h=null)}function je(t){0==t.g.u||t.l||tr(t.g,t)}function qe(t){Ue(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ne(t.O),he(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Fe(t,e){try{var n,r,i,o,s,u,a,h,c,f,l=t.g;if(0!=l.u&&(l.a==t||En(l.b,t)))if(l.A=t.H,!t.o&&En(l.b,t)&&3==l.u){try{var p=l.ja.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var d=p;if(0==d[0]){t:if(!l.i){if(l.a){if(!(l.a.s+3e3<t.s))break t;Zn(l),l.a.cancel(),l.a=null}Jn(l),ve()}}else l.ia=d[1],0<l.ia-l.G&&d[2]<37500&&l.U&&0==l.m&&!l.l&&(l.l=me(C(l.Na,l),6e3));if(bn(l.b)<=1&&l.O){try{l.O()}catch(t){}l.O=void 0}}else nr(l,11)}else if(!t.o&&l.a!=t||Zn(l),!W(e))for(e=p=l.ja.a.parse(e),p=0;p<e.length;p++){d=e[p],l.G=d[0],d=d[1],2==l.u?"c"==d[0]?(l.B=d[1],l.R=d[2],null!=(n=d[3])&&(l.oa=n),null!=(r=d[5])&&"number"==typeof r&&0<r&&(l.D=1.5*r),i=l,(o=t.a)&&(!(s=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=i.b).a&&(H(s,"spdy")||H(s,"quic")||H(s,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(Tn(u,u.b),u.b=null)),!i.s||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(i.ha=a,Ze(i.v,i.s,a))),l.u=3,l.c&&l.c.na(),h=t,(i=l).ea=ir(i,i.w?i.R:null,i.P),h.o?(In(i.b,h),c=h,(f=i.D)&&c.setTimeout(f),c.h&&(Ue(c),Ce(c)),i.a=h):$n(i),0<l.f.length&&Kn(l)):"stop"!=d[0]&&"close"!=d[0]||nr(l,7):3==l.u&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?nr(l,7):zn(l):"noop"!=d[0]&&l.c&&l.c.ma(d),l.m=0)}de()}catch(t){}}function Be(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)B(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ge(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ge)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=De.prototype).setTimeout=function(t){this.N=t},N.Sa=function(t){t=t.target;var e=this.D;e&&3==qn(t)?e.Ia():this.ya(t)},N.ya=function(t){try{if(t==this.a)t:{var e=qn(this.a),n=this.a.qa();this.a.S();if(!(e<3||3==e&&!at&&!this.a.Y())){this.l||4!=e||7==n||de(),Ue(this);var r=this.a.S();this.H=r;var i=this.a.Y();if(this.b=200==r){if(this.R&&!this.o){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.c=3,ve(),qe(this),je(this);break t}this.o=!0,Fe(this,u)}this.F?(Le(this,e,i),at&&this.b&&3==e&&(ae(this.G,this.O,"tick",this.Ra),this.O.start())):Fe(this,i),4==e&&qe(this),this.b&&!this.l&&(4==e?tr(this.g,this):(this.b=!1,Ce(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.c=3:this.c=0,ve(),qe(this),je(this)}}}catch(t){}},N.Ra=function(){var t,e;this.a&&(t=qn(this.a),e=this.a.Y(),this.w<e.length&&(Ue(this),Le(this,t,e),this.b&&4!=t&&Ce(this)))},N.cancel=function(){this.l=!0,qe(this)},N.Qa=function(){this.h=null;var t=U();0<=t-this.P?(2!=this.B&&(de(),ve()),qe(this),this.c=2,je(this)):Me(this,this.P-t)},(N=Ge.prototype).I=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return ze(this),this.a.concat()},N.get=function(t,e){return We(this.b,t)?this.b[t]:e},N.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ke(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ke?(this.a=void 0!==e?e:t.a,Ye(this,t.f),this.j=t.j,Xe(this,t.c),$e(this,t.h),this.g=t.g,e=t.b,(n=new cn).c=e.c,e.a&&(n.a=new Ge(e.a),n.b=e.b),Je(this,n),this.i=t.i):t&&(n=String(t).match(Qe))?(this.a=!!e,Ye(this,n[1]||"",!0),this.j=en(n[2]||""),Xe(this,n[3]||"",!0),$e(this,n[4]),this.g=en(n[5]||"",!0),Je(this,n[6]||"",!0),this.i=en(n[7]||"")):(this.a=!!e,this.b=new cn(null,this.a))}function He(t){return new Ke(t)}function Ye(t,e,n){t.f=n?en(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Xe(t,e,n){t.c=n?en(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Je(t,e,n){var r,i;e instanceof cn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(fn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ln(this,e),dn(this,n,t))},r)),r.f=i):(n||(e=nn(e,an)),t.b=new cn(e,t.a))}function Ze(t,e,n){t.b.set(e,n)}function tn(t){return Ze(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^U()).toString(36)),t}function en(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function nn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ke.prototype.toString=function(){var t=[],e=this.f;e&&t.push(nn(e,on,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(nn(e,on,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(nn(n,"/"==n.charAt(0)?un:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",nn(n,hn)),t.join("")};var on=/[#\/\?@]/g,sn=/[#\?:]/g,un=/[#\?]/g,an=/[#\?@]/g,hn=/#/g;function cn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(u){u.a||(u.a=new Ge,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],o=n,s=i?decodeURIComponent(i.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function ln(t,e){fn(t),e=yn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function pn(t,e){return fn(t),e=yn(t,e),We(t.a.b,e)}function dn(t,e,n){ln(t,e),0<n.length&&(t.c=null,t.a.set(yn(t,e),z(n)),t.b+=n.length)}function yn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function vn(t,e){this.b=t,this.a=e}function gn(t){this.g=t||mn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ca&&S.ca.ua&&S.ca.ua()&&S.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=cn.prototype).add=function(t,e){fn(this),this.c=null,t=yn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){fn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},N.K=function(){fn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.I=function(t){fn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=G(e,this.a.get(yn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},N.set=function(t,e){return fn(this),this.c=null,pn(this,t=yn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.I(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var mn=10;function wn(t){return t.b||t.a&&t.a.size>=t.f}function bn(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Tn(t,e){t.a?t.a.add(e):t.b=e}function In(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.i)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function An(){}function _n(){this.a=new An}function Sn(t,r,e){var i=e||"";try{Be(t,function(t,e){var n=t;O(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function kn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},An.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},An.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Dn=S.JSON.parse;function xn(t){Bt.call(this),this.headers=new Ge,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=On,this.B=this.F=!1}j(xn,Bt);var On="",Rn=/^https?$/i,Pn=["POST","PUT"];function Vn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),Un(t)}function Cn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Mn(t){if(t.b&&void 0!==_&&(!t.s[1]||4!=qn(t)||2!=t.S()))if(t.l&&4==qn(t))re(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==qn(t)){t.b=!1;try{var e,n,r,i,o=t.S();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.D).match(Qe)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<qn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Cn(t)}}finally{Un(t)}}}function Un(t,e){if(t.a){jn(t);var n=t.a,r=t.s[0]?k:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function jn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function qn(t){return t.a?t.a.readyState:0}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ze(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Bn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Bn("baseRetryDelayMs",5e3,t),this.Ga=Bn("retryDelaySeedMs",1e4,t),this.Da=Bn("forwardChannelMaxRetries",2,t),this.ga=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new gn(t&&t.concurrentRequestLimit),this.ja=new _n,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function zn(t){var e,n;Wn(t),3==t.u&&(e=t.H++,Ze(n=He(t.v),"SID",t.B),Ze(n,"RID",e),Ze(n,"TYPE","terminate"),Yn(t,n),(e=new De(t,e,void 0)).B=2,e.f=tn(He(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.f.toString(),"")),!n&&S.Image&&((new Image).src=e.f,n=!0),n||(e.a=or(e.g,null),e.a.$(e.f)),e.s=U(),Ce(e)),rr(t)}function Wn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(S.clearTimeout(t.i),t.i=null),Zn(t),t.b.cancel(),t.g&&("number"==typeof t.g&&S.clearTimeout(t.g),t.g=null)}function Qn(t,e){t.f.push(new vn(t.Fa++,e)),3==t.u&&Kn(t)}function Kn(t){wn(t.b)||t.g||(t.g=!0,$t(t.xa,t),t.o=0)}function Hn(t,e){var n=e?e.W:t.H++,r=He(t.v);Ze(r,"SID",t.B),Ze(r,"RID",n),Ze(r,"AID",t.G),Yn(t,r),t.h&&t.j&&Fn(r,t.h,t.j),n=new De(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Xn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),Tn(t.b,n),Pe(n,r,e)}function Yn(t,n){t.c&&Be({},function(t,e){Ze(n,e,t)})}function Xn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Sn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function $n(t){t.a||t.i||(t.J=1,$t(t.wa,t),t.m=0)}function Jn(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=me(C(t.wa,t),er(t,t.m)),t.m++,1)}function Zn(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function tr(t,e){var n,r=null;if(t.a==e){Zn(t),t.a=null;var i=2}else{if(!En(t.b,e))return;r=e.i,In(t.b,e),i=1}if(t.A=e.H,0!=t.u)if(e.b){1==i?(r=e.j?e.j.length:0,e=U()-e.s,n=t.o,(i=le()).dispatchEvent(new ge(i)),Kn(t)):$n(t)}else if(3==(n=e.c)||0==n&&0<t.A||!(1==i&&function(t,e){if(!(bn(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=me(C(t.xa,t,e),er(t,t.o)),t.o++,1}}(t,e)||2==i&&Jn(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function nr(t,e){var n,r,i,o,s,u;2==e?(n=null,t.c&&(n=null),r=C(t.Ta,t),n||(n=new Ke("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||Ye(n,"https"),tn(n)),i=n.toString(),o=r,u=new ce,S.Image?((s=new Image).onload=M(kn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=M(kn,u,s,"TestLoadImage: error",!1,o),s.onabort=M(kn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=M(kn,u,s,"TestLoadImage: timeout",!1,o),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):ve(),t.u=0,t.c&&t.c.la(e),rr(t),Wn(t)}function rr(t){t.u=0,t.A=-1,t.c&&(0==Nn(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.ka())}function ir(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof Ke?He(r):new Ke(r,void 0);return""!=c.c?(e&&Xe(c,e+"."+c.c),$e(c,c.h)):(o=(i=S.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new Ke(null,void 0),o&&Ye(h,o),s&&Xe(h,s),u&&$e(h,u),a&&(h.g=a),c=h),t.N&&J(t.N,function(t,e){Ze(c,e,t)}),e=t.s,n=t.ha,e&&n&&Ze(c,e,n),Ze(c,"VER",t.oa),Yn(t,c),c}function or(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Ea)).F=t.w,e}function sr(){}function ur(){if(st&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function ar(t,e){Bt.call(this),this.a=new Gn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new fr(this)}function hr(t){_e.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Se.call(this),this.status=1}function fr(t){this.a=t}(N=xn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Te(this.G):Te(Ne),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Ln(this,t)}t=n||"";var i,o=new Ge(this.headers);r&&Be(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Vn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=S.FormData&&t instanceof S.FormData,0<=F(Pn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{jn(this),0<this.o&&((this.B=(i=this.a,st&&vt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=re(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},N.ta=function(){void 0!==_&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Un(this))},N.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Un(this,!0)),xn.M.C.call(this)},N.va=function(){this.j||(this.w||this.l||this.g?Mn(this):this.Oa())},N.Oa=function(){Mn(this)},N.S=function(){try{return 2<qn(this)?this.a.status:-1}catch(t){return-1}},N.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Dn(e)}},N.qa=function(){return this.h},N.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Gn.prototype).oa=8,N.u=1,N.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new De(this,t,void 0),r=this.j;if(this.F&&(r?et(r=Z(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xn(this,n,e),Ze(i=He(this.v),"RID",t),Ze(i,"CVER",22),this.s&&Ze(i,"X-HTTP-Session-Id",this.s),Yn(this,i),this.h&&r&&Fn(i,this.h,r),Tn(this.b,n),this.fa?(Ze(i,"$req",e),Ze(i,"SID","null"),n.R=!0,Pe(n,i,null)):Pe(n,i,e),this.u=2}}else 3==this.u&&(t?Hn(this,t):0==this.f.length||wn(this.b)||Hn(this))},N.wa=function(){this.i=null,this.a=new De(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=He(this.ea);Ze(t,"RID","rpc"),Ze(t,"SID",this.B),Ze(t,"CI",this.U?"0":"1"),Ze(t,"AID",this.G),Yn(this,t),Ze(t,"TYPE","xmlhttp"),this.h&&this.j&&Fn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=tn(He(t)),e.j=null,e.F=!0,Ve(e,n)},N.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Jn(this),ve())},N.Ta=function(t){ve()},(N=sr.prototype).na=function(){},N.ma=function(){},N.la=function(){},N.ka=function(){},N.Ha=function(){},ur.prototype.a=function(t,e){return new ar(t,e)},j(ar,Bt),(N=ar.prototype).addEventListener=function(t,e,n,r){ar.M.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){ar.M.removeEventListener.call(this,t,e,n,r)},N.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ve(),t.P=e,t.N=n||{},t.U=t.W,t.v=ir(t,null,t.P),Kn(t)},N.close=function(){zn(this.a)},N.La=function(t){var e;"string"==typeof t?((e={}).__data__=t,Qn(this.a,e)):this.g?((e={}).__data__=zt(t),Qn(this.a,e)):Qn(this.a,t)},N.C=function(){this.a.c=null,delete this.f,zn(this.a),delete this.a,ar.M.C.call(this)},j(hr,_e),j(cr,Se),j(fr,sr),fr.prototype.na=function(){this.a.dispatchEvent("a")},fr.prototype.ma=function(t){this.a.dispatchEvent(new hr(t))},fr.prototype.la=function(t){this.a.dispatchEvent(new cr)},fr.prototype.ka=function(){this.a.dispatchEvent("b")},ur.prototype.createWebChannel=ur.prototype.a,ar.prototype.send=ar.prototype.La,ar.prototype.open=ar.prototype.Ka,ar.prototype.close=ar.prototype.close,we.NO_ERROR=0,we.TIMEOUT=8,we.HTTP_ERROR=6,be.COMPLETE="complete",(Ie.EventType=Ae).OPEN="a",Ae.CLOSE="b",Ae.ERROR="c",Ae.MESSAGE="d",Bt.prototype.listen=Bt.prototype.ra,xn.prototype.listenOnce=xn.prototype.sa,xn.prototype.getLastError=xn.prototype.Ma,xn.prototype.getLastErrorCode=xn.prototype.qa,xn.prototype.getStatus=xn.prototype.S,xn.prototype.getResponseJson=xn.prototype.Ja,xn.prototype.getResponseText=xn.prototype.Y,xn.prototype.send=xn.prototype.$;var lr={createWebChannelTransport:function(){return new ur},ErrorCode:we,EventType:be,WebChannel:Ie,XhrIo:xn},pr=lr.createWebChannelTransport,dr=lr.ErrorCode,yr=lr.EventType,vr=lr.WebChannel,gr=lr.XhrIo,mr=ep.SDK_VERSION,wr=(br.prototype.t=function(){return null!=this.uid},br.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},br.prototype.isEqual=function(t){return t.uid===this.uid},br);function br(t){this.uid=t}function Er(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}wr.UNAUTHENTICATED=new wr(null),wr.i=new wr("google-credentials-uid"),wr.h=new wr("first-party-uid");var Tr,Ir,Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ar=(n(Br,Ir=Error),Br),_r=(Fr.prototype.getToken=function(){return Promise.resolve(null)},Fr.prototype._=function(){},Fr.prototype.l=function(t){(this.u=t)(wr.UNAUTHENTICATED)},Fr.prototype.T=function(){this.u=null},Fr),Sr=(qr.prototype.getToken=function(){var e=this,n=this.A,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.A!==n)throw new Ar(Nr.ABORTED,"getToken aborted due to token change.");return t?(Ws("string"==typeof t.accessToken),new Er(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},qr.prototype._=function(){this.forceRefresh=!0},qr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},qr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},qr.prototype.m=function(){var t=this.auth&&this.auth.getUid();return Ws(null===t||"string"==typeof t),new wr(t)},qr),kr=(Object.defineProperty(jr.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),jr),Dr=(Ur.prototype.getToken=function(){return Promise.resolve(new kr(this.P,this.V))},Ur.prototype.l=function(t){t(wr.h)},Ur.prototype.T=function(){},Ur.prototype._=function(){},Ur),xr=(Mr.now=function(){return Mr.fromMillis(Date.now())},Mr.fromDate=function(t){return Mr.fromMillis(t.getTime())},Mr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Mr(e,1e6*(t-1e3*e))},Mr.prototype.toDate=function(){return new Date(this.toMillis())},Mr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Mr.prototype.p=function(t){return this.seconds===t.seconds?Hs(this.nanoseconds,t.nanoseconds):Hs(this.seconds,t.seconds)},Mr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Mr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Mr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Mr),Or=(Cr.v=function(t){return new Cr(t)},Cr.min=function(){return new Cr(new xr(0,0))},Cr.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Cr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Cr.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Cr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Cr.prototype.C=function(){return this.timestamp},Cr),Rr=(Object.defineProperty(Lr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),Lr.prototype.isEqual=function(t){return 0===Lr.N(this,t)},Lr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Lr?t.forEach(function(t){e.push(t)}):e.push(t),this.k(e)},Lr.prototype.limit=function(){return this.offset+this.length},Lr.prototype.$=function(t){return t=void 0===t?1:t,this.k(this.segments,this.offset+t,this.length-t)},Lr.prototype.M=function(){return this.k(this.segments,this.offset,this.length-1)},Lr.prototype.L=function(){return this.segments[this.offset]},Lr.prototype.O=function(){return this.get(this.length-1)},Lr.prototype.get=function(t){return this.segments[this.offset+t]},Lr.prototype.B=function(){return 0===this.length},Lr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Lr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Lr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Lr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},Lr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Lr),Pr=(n(Vr,Tr=Rr),Vr.prototype.k=function(t,e,n){return new Vr(t,e,n)},Vr.prototype.j=function(){return this.W().join("/")},Vr.prototype.toString=function(){return this.j()},Vr.K=function(t){if(0<=t.indexOf("//"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Vr(t.split("/").filter(function(t){return 0<t.length}))},Vr);function Vr(){return null!==Tr&&Tr.apply(this,arguments)||this}function Lr(t,e,n){void 0===e?e=0:e>t.length&&zs(),void 0===n?n=t.length-e:n>t.length-e&&zs(),this.segments=t,this.offset=e,this.F=n}function Cr(t){this.timestamp=t}function Mr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Ur(t,e){this.P=t,this.V=e}function jr(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=wr.h}function qr(t){var e=this;this.I=null,this.currentUser=wr.UNAUTHENTICATED,this.R=!1,this.A=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.A++,e.currentUser=e.m(),e.R=!0,e.u&&e.u(e.currentUser)},this.A=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function Fr(){this.u=null}function Br(t,e){var n=this;return(n=Ir.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Pr.G=new Pr([]);var Gr,zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Wr=(n(Qr,Gr=Rr),Qr.prototype.k=function(t,e,n){return new Qr(t,e,n)},Qr.H=function(t){return zr.test(t)},Qr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Qr.H(t)||(t="`"+t+"`"),t}).join(".")},Qr.prototype.toString=function(){return this.j()},Qr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Qr.J=function(){return new Qr(["__name__"])},Qr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ar(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Ar(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Qr(e)},Qr);function Qr(){return null!==Gr&&Gr.apply(this,arguments)||this}Wr.G=new Wr([]);var Kr=(Hr.Z=function(t){return new Hr(Pr.K(t).$(5))},Hr.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Hr.prototype.isEqual=function(t){return null!==t&&0===Pr.N(this.path,t.path)},Hr.prototype.toString=function(){return this.path.toString()},Hr.N=function(t,e){return Pr.N(t.path,e.path)},Hr.et=function(t){return t.length%2==0},Hr.st=function(t){return new Hr(new Pr(t.slice()))},Hr);function Hr(t){this.path=t}function Yr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function $r(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Kr.EMPTY=new Kr(new Pr([]));var Jr=(Zr.fromBase64String=function(t){return new Zr(Cs.nt().atob(t))},Zr.fromUint8Array=function(t){return new Zr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Zr.prototype.toBase64=function(){return Cs.nt().btoa(this.it)},Zr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},Zr.prototype.rt=function(){return 2*this.it.length},Zr.prototype.S=function(t){return Hs(this.it,t.it)},Zr.prototype.isEqual=function(t){return this.it===t.it},Zr);function Zr(t){this.it=t}function ti(t){return null==t}function ei(t){return-0===t&&1/t==-1/0}function ni(t){return"number"==typeof t&&Number.isInteger(t)&&!ei(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function ri(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ii(t){var e=li(t.mapValue.fields.__local_write_time__.timestampValue);return new xr(e.seconds,e.nanos)}Jr.ht=new Jr("");var oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ri(t)?4:10:zs()}function ui(r,i){var t,e,n,o=si(r);if(o!==si(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ii(r).isEqual(ii(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=li(r.timestampValue),n=li(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,di(r.bytesValue).isEqual(di(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,pi((t=r).geoPointValue.latitude)===pi(e.geoPointValue.latitude)&&pi(t.geoPointValue.longitude)===pi(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return pi(t.integerValue)===pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=pi(t.doubleValue),r=pi(e.doubleValue);return n===r?ei(n)===ei(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Ys(r.arrayValue.values||[],i.arrayValue.values||[],ui);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Yr(t)!==Yr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!ui(t[n],e[n])))return!1;return!0}();default:return zs()}}function ai(t,e){return void 0!==(t.values||[]).find(function(t){return ui(t,e)})}function hi(t,e){var n,r,i,o,s,u,a,h,c,f,l=si(t),p=si(e);if(l!==p)return Hs(l,p);switch(l){case 0:return 0;case 1:return Hs(t.booleanValue,e.booleanValue);case 2:return h=e,(c=pi(t.integerValue||t.doubleValue))<(f=pi(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return ci(t.timestampValue,e.timestampValue);case 4:return ci(ii(t),ii(e));case 5:return Hs(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=di(o),a=di(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Hs(n[i],r[i]);if(0!==o)return o}return Hs(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Hs(pi(n.latitude),pi(r.latitude)))?i:Hs(pi(n.longitude),pi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=hi(n[i],r[i]);if(o)return o}return Hs(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Hs(r[s],o[s]);if(0!==u)return u;var a=hi(n[r[s]],i[o[s]]);if(0!==a)return a}return Hs(r.length,o.length)}(t.mapValue,e.mapValue);default:throw zs()}}function ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Hs(t,e);var n=li(t),r=li(e),i=Hs(n.seconds,r.seconds);return 0!==i?i:Hs(n.nanos,r.nanos)}function fi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=li(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?di(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Kr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):zs();var t,e,n}(t)}function li(t){if(Ws(!!t),"string"!=typeof t)return{seconds:pi(t.seconds),nanos:pi(t.nanos)};var e,n=0,r=oi.exec(t);Ws(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function di(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}function yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function vi(t){return t&&"integerValue"in t}function gi(t){return!!t&&"arrayValue"in t}function mi(t){return t&&"nullValue"in t}function wi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bi(t){return t&&"mapValue"in t}var Ei=(Ti.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},Ti.prototype.at=function(t,e){return e},Ti.prototype.ut=function(t){return null},Ti.prototype.isEqual=function(t){return t instanceof Ti},Ti);function Ti(){}Ei.instance=new Ei;var Ii=(ki.prototype.ot=function(t,e){return this.apply(t)},ki.prototype.at=function(t,e){return this.apply(t)},ki.prototype.apply=function(t){for(var n=Di(t),e=function(e){n.some(function(t){return ui(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},ki.prototype.ut=function(t){return null},ki.prototype.isEqual=function(t){return t instanceof ki&&Ys(this.elements,t.elements,ui)},ki),Ni=(Si.prototype.ot=function(t,e){return this.apply(t)},Si.prototype.at=function(t,e){return this.apply(t)},Si.prototype.apply=function(t){for(var n=Di(t),e=function(e){n=n.filter(function(t){return!ui(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Si.prototype.ut=function(t){return null},Si.prototype.isEqual=function(t){return t instanceof Si&&Ys(this.elements,t.elements,ui)},Si),Ai=(_i.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return vi(n)&&vi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},_i.prototype.at=function(t,e){return e},_i.prototype.ut=function(t){return vi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},_i.prototype.isEqual=function(t){return t instanceof _i&&ui(this.ct,t.ct)},_i.prototype.asNumber=function(t){return pi(t.integerValue||t.doubleValue)},_i);function _i(t,e){this.serializer=t,this.ct=e}function Si(t){this.elements=t}function ki(t){this.elements=t}function Di(t){return gi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function xi(t,e){this.version=t,this.transformResults=e}var Oi,Ri,Pi,Vi,Li,Ci=(ro.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},ro.prototype.isEqual=function(t){return Ys(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ro),Mi=(no.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},no),Ui=(eo.ft=function(){return new eo},eo.exists=function(t){return new eo(void 0,t)},eo.updateTime=function(t){return new eo(t)},Object.defineProperty(eo.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),eo.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof wo&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof wo},eo.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},eo),ji=(to.prototype.It=function(t){},to.wt=function(t){return t instanceof wo?t.version:Or.min()},to),qi=(n(Zi,Li=ji),Zi.prototype.at=function(t,e){this.It(t);var n=e.version;return new wo(this.key,n,this.value,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=ji.wt(t);return new wo(this.key,r,this.value,{At:!0})},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},Zi),Fi=(n(Ji,Vi=ji),Ji.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.gt(t);return new wo(this.key,e.version,n,{hasCommittedMutations:!0})},Ji.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=ji.wt(t),i=this.gt(t);return new wo(this.key,r,i,{At:!0})},Ji.prototype.Pt=function(t){return null},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},Ji.prototype.gt=function(t){var e=t instanceof wo?t.data():Wi.empty();return this.pt(e)},Ji.prototype.pt=function(t){var n=this,r=new Qi(t);return this.Vt.fields.forEach(function(t){var e;t.B()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.yt()},Ji),Bi=(n($i,Pi=ji),$i.prototype.at=function(t,e){if(this.It(t),Ws(null!=e.transformResults),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new wo(this.key,i,o,{hasCommittedMutations:!0})},$i.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new wo(this.key,r.version,o,{At:!0})},$i.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof wo?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Qi).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},$i.prototype.isEqual=function(t){return t instanceof $i&&this.key.isEqual(t.key)&&Ys(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},$i.prototype.bt=function(t){return t},$i.prototype.vt=function(t,e){var n=[];Ws(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof wo&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},$i.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof wo&&(a=e.field(s.field)),null===a&&n instanceof wo&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},$i.prototype.St=function(t,e){for(var n=new Qi(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},$i),Gi=(n(Xi,Ri=ji),Xi.prototype.at=function(t,e){return this.It(t),new bo(this.key,e.version,{hasCommittedMutations:!0})},Xi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new bo(this.key,Or.min()):t},Xi.prototype.Pt=function(t){return null},Xi.prototype.isEqual=function(t){return t instanceof Xi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Xi),zi=(n(Yi,Oi=ji),Yi.prototype.at=function(t,e){zs()},Yi.prototype.ot=function(t,e,n){zs()},Yi.prototype.Pt=function(t){zs()},Yi.prototype.isEqual=function(t){return t instanceof Yi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Yi),Wi=(Hi.empty=function(){return new Hi({mapValue:{}})},Hi.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!bi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},Hi.prototype.isEqual=function(t){return ui(this.proto,t.proto)},Hi),Qi=(Ki.prototype.set=function(t,e){return this.Nt(t,e),this},Ki.prototype.delete=function(t){return this.Nt(t,null),this},Ki.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===si(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Ki.prototype.yt=function(){var t=this.kt(Wr.G,this.Ft);return null!=t?new Wi(t):this.Ct},Ki.prototype.kt=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=bi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.kt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Ki);function Ki(t){void 0===t&&(t=Wi.empty()),this.Ct=t,this.Ft=new Map}function Hi(t){this.proto=t}function Yi(t,e){var n=this;return(n=Oi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Xi(t,e){var n=this;return(n=Ri.call(this)||this).key=t,n.Rt=e,n.type=3,n}function $i(t,e){var n=this;return(n=Pi.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=Ui.exists(!0),n}function Ji(t,e,n,r){var i=this;return(i=Vi.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function Zi(t,e,n){var r=this;return(r=Li.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function to(){}function eo(t,e){this.updateTime=t,this.exists=e}function no(t,e){this.field=t,this.transform=e}function ro(t){(this.fields=t).sort(Wr.N)}function io(t){var u=[];return Xr(t.fields||{},function(t,e){var n=new Wr([t]);if(bi(e)){var r=io(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ci(u)}function oo(t,e){this.key=t,this.version=e}function so(t){this.count=t}var uo,ao,ho,co,fo,lo,po,yo,vo,go,mo,wo=(n(Qo,mo=oo),Qo.prototype.field=function(t){return this.$t.field(t)},Qo.prototype.data=function(){return this.$t},Qo.prototype.Mt=function(){return this.$t.proto},Qo.prototype.isEqual=function(t){return t instanceof Qo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.$t.isEqual(t.$t)},Qo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.$t.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Qo.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Qo),bo=(n(Wo,go=oo),Wo.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Wo.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Wo.prototype.isEqual=function(t){return t instanceof Wo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Wo),Eo=(n(zo,vo=oo),zo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),zo.prototype.isEqual=function(t){return t instanceof zo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zo),To=(Go.prototype.canonicalId=function(){var t;return null===this.Lt&&(t=this.path.j(),null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ti(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Lt=t),this.Lt},Go.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ti(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Go.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Go.prototype.Ot=function(){return Kr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Go),Io=(Bo.Wt=function(t){return new Bo(t)},Object.defineProperty(Bo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Oo(t)),this.qt.push(new Oo(Wr.J(),"asc"));else{for(var n,r=!1,i=0,o=this.xt;i<o.length;i++){var s=o[i];this.qt.push(s),s.field.Y()&&(r=!0)}r||(n=0<this.xt.length?this.xt[this.xt.length-1].dir:"asc",this.qt.push(new Oo(Wr.J(),n)))}}return this.qt},enumerable:!0,configurable:!0}),Bo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Bo(this.path,this.collectionGroup,this.xt.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.zt=function(t){var e=this.xt.concat([t]);return new Bo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.Ht=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Bo.prototype.Yt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Bo.prototype.Jt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Bo.prototype.Xt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Bo.prototype.Zt=function(t){return new Bo(t,null,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.xt.length||1===this.xt.length&&this.xt[0].field.Y())},Bo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Bo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Bo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Bo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Bo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Bo.prototype.oe=function(){return!ti(this.limit)&&"F"===this.Bt},Bo.prototype.ae=function(){return!ti(this.limit)&&"L"===this.Bt},Bo.prototype.Kt=function(){return 0<this.xt.length?this.xt[0].field:null},Bo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof No&&n.ue())return n.field}return null},Bo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof No&&0<=t.indexOf(r.op))return r.op}return null},Bo.prototype.Ot=function(){return this.ee().Ot()},Bo.prototype._e=function(){return null!==this.collectionGroup},Bo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new To(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Oo(r.field,i))}var o=this.endAt?new xo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new xo(this.startAt.position,!this.startAt.before):null;this.Ut=new To(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Bo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Kr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Bo.prototype.ne=function(t){for(var e=0,n=this.xt;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Bo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Bo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Bo.prototype.Qt=function(t){},Bo),No=(n(Fo,yo=function(){}),Fo.create=function(t,e,n){if(t.Y())return"in"===e?new _o(t,n):new Ao(t,e,n);if(mi(n)){if("=="!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fo(t,e,n)}if(wi(n)){if("=="!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fo(t,e,n)}return"array-contains"===e?new So(t,n):"in"===e?new ko(t,n):"array-contains-any"===e?new Do(t,n):new Fo(t,e,n)},Fo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&si(this.value)===si(e)&&this.de(hi(e,this.value))},Fo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return zs()}},Fo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Fo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+fi(this.value)},Fo.prototype.isEqual=function(t){return t instanceof Fo&&this.op===t.op&&this.field.isEqual(t.field)&&ui(this.value,t.value)},Fo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+fi(this.value)},Fo),Ao=(n(qo,po=No),qo.prototype.matches=function(t){var e=Kr.N(t.key,this.key);return this.de(e)},qo),_o=(n(jo,lo=No),jo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},jo),So=(n(Uo,fo=No),Uo.prototype.matches=function(t){var e=t.field(this.field);return gi(e)&&ai(e.arrayValue,this.value)},Uo),ko=(n(Mo,co=No),Mo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ai(this.value.arrayValue,e)},Mo),Do=(n(Co,ho=No),Co.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!gi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ai(e.value.arrayValue,t)})},Co),xo=(Lo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(fi).join(",")},Lo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r],n=i.field.Y()?Kr.N(Kr.Z(o.referenceValue),e.key):hi(o,e.field(i.field));if("desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Lo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ui(this.position[e],t.position[e]))return!1;return!0},Lo),Oo=(Vo.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Kr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?hi(i,o):zs());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return zs()}},Vo.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Vo.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Vo.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Vo),Ro=(Po.prototype.Ie=function(t){return new Po(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Po.prototype.we=function(t,e){return new Po(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Po.prototype.Re=function(t){return new Po(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Po);function Po(t,e,n,r,i,o,s){void 0===i&&(i=Or.min()),void 0===o&&(o=Or.min()),void 0===s&&(s=Jr.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Vo(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function Lo(t,e){this.position=t,this.before=e}function Co(t,e){return ho.call(this,t,"array-contains-any",e)||this}function Mo(t,e){return co.call(this,t,"in",e)||this}function Uo(t,e){return fo.call(this,t,"array-contains",e)||this}function jo(t,e){var n=this;return(n=lo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Kr.Z(t.referenceValue)}),n}function qo(t,e,n){var r=this;return(r=po.call(this,t,e,n)||this).key=Kr.Z(n.referenceValue),r}function Fo(t,e,n){var r=this;return(r=yo.call(this)||this).field=t,r.op=e,r.value=n,r}function Bo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Go(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Lt=null}function zo(){return null!==vo&&vo.apply(this,arguments)||this}function Wo(t,e,n){var r=this;return(r=go.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Qo(t,e,n,r){var i=this;return(i=mo.call(this,t,e)||this).$t=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Ko(t){switch(t){case Nr.OK:return zs();case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return 1;default:return zs()}}function Ho(t){if(void 0===t)return Bs("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case uo.OK:return Nr.OK;case uo.CANCELLED:return Nr.CANCELLED;case uo.UNKNOWN:return Nr.UNKNOWN;case uo.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case uo.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case uo.INTERNAL:return Nr.INTERNAL;case uo.UNAVAILABLE:return Nr.UNAVAILABLE;case uo.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case uo.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case uo.NOT_FOUND:return Nr.NOT_FOUND;case uo.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case uo.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case uo.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case uo.ABORTED:return Nr.ABORTED;case uo.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case uo.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case uo.DATA_LOSS:return Nr.DATA_LOSS;default:return zs()}}(ao=uo=uo||{})[ao.OK=0]="OK",ao[ao.CANCELLED=1]="CANCELLED",ao[ao.UNKNOWN=2]="UNKNOWN",ao[ao.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ao[ao.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ao[ao.NOT_FOUND=5]="NOT_FOUND",ao[ao.ALREADY_EXISTS=6]="ALREADY_EXISTS",ao[ao.PERMISSION_DENIED=7]="PERMISSION_DENIED",ao[ao.UNAUTHENTICATED=16]="UNAUTHENTICATED",ao[ao.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ao[ao.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ao[ao.ABORTED=10]="ABORTED",ao[ao.OUT_OF_RANGE=11]="OUT_OF_RANGE",ao[ao.UNIMPLEMENTED=12]="UNIMPLEMENTED",ao[ao.INTERNAL=13]="INTERNAL",ao[ao.UNAVAILABLE=14]="UNAVAILABLE",ao[ao.DATA_LOSS=15]="DATA_LOSS";var Yo=(ts.prototype.Ae=function(t,e){return new ts(this.N,this.root.Ae(t,e,this.N).me(null,null,$o.Pe,null,null))},ts.prototype.remove=function(t){return new ts(this.N,this.root.remove(t,this.N).me(null,null,$o.Pe,null,null))},ts.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ts.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ts.prototype.B=function(){return this.root.B()},Object.defineProperty(ts.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),ts.prototype.Ve=function(){return this.root.Ve()},ts.prototype.ge=function(){return this.root.ge()},ts.prototype.pe=function(t){return this.root.pe(t)},ts.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},ts.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ts.prototype.ye=function(t){return this.root.ye(t)},ts.prototype.be=function(){return new Xo(this.root,null,this.N,!1)},ts.prototype.ve=function(t){return new Xo(this.root,t,this.N,!1)},ts.prototype.Se=function(){return new Xo(this.root,null,this.N,!0)},ts.prototype.De=function(t){return new Xo(this.root,t,this.N,!0)},ts),Xo=(Zo.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},Zo.prototype.ke=function(){return 0<this.Fe.length},Zo.prototype.$e=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},Zo),$o=(Jo.prototype.me=function(t,e,n,r,i){return new Jo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Jo.prototype.B=function(){return!1},Jo.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},Jo.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},Jo.prototype.min=function(){return this.left.B()?this:this.left.min()},Jo.prototype.Ve=function(){return this.min().key},Jo.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},Jo.prototype.Ae=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.me(null,null,null,r.left.Ae(t,e,n),null):0===i?r.me(null,e,null,null,null):r.me(null,null,null,null,r.right.Ae(t,e,n))).Me()},Jo.prototype.Le=function(){if(this.left.B())return Jo.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.xe()),(t=t.me(null,null,null,t.left.Le(),null)).Me()},Jo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.Oe()||r.left.left.Oe()||(r=r.xe()),r=r.me(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Be()),r.right.B()||r.right.Oe()||r.right.left.Oe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return Jo.EMPTY;n=r.right.min(),r=r.me(n.key,n.value,null,null,r.right.Le())}r=r.me(null,null,null,null,r.right.remove(t,e))}return r.Me()},Jo.prototype.Oe=function(){return this.color},Jo.prototype.Me=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Ue()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Be()),t.left.Oe()&&t.right.Oe()&&(t=t.Qe()),t},Jo.prototype.xe=function(){var t=this.Qe();return t.right.left.Oe()&&(t=(t=(t=t.me(null,null,null,null,t.right.Be())).Ue()).Qe()),t},Jo.prototype.qe=function(){var t=this.Qe();return t.left.left.Oe()&&(t=(t=t.Be()).Qe()),t},Jo.prototype.Ue=function(){var t=this.me(null,null,Jo.RED,null,this.right.left);return this.right.me(null,null,this.color,t,null)},Jo.prototype.Be=function(){var t=this.me(null,null,Jo.RED,this.left.right,null);return this.left.me(null,null,this.color,null,t)},Jo.prototype.Qe=function(){var t=this.left.me(null,null,!this.left.color,null,null),e=this.right.me(null,null,!this.right.color,null,null);return this.me(null,null,!this.color,t,e)},Jo.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},Jo.prototype.je=function(){if(this.Oe()&&this.left.Oe())throw zs();if(this.right.Oe())throw zs();var t=this.left.je();if(t!==this.right.je())throw zs();return t+(this.Oe()?0:1)},Jo);function Jo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Jo.RED,this.left=null!=r?r:Jo.EMPTY,this.right=null!=i?i:Jo.EMPTY,this.size=this.left.size+1+this.right.size}function Zo(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function ts(t,e){this.N=t,this.root=e||$o.EMPTY}function es(){this.size=0}$o.EMPTY=null,$o.RED=!0,$o.Pe=!1,$o.EMPTY=(Object.defineProperty(es.prototype,"key",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"value",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"color",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"left",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"right",{get:function(){throw zs()},enumerable:!0,configurable:!0}),es.prototype.me=function(t,e,n,r,i){return this},es.prototype.Ae=function(t,e,n){return new $o(t,e)},es.prototype.remove=function(t,e){return this},es.prototype.B=function(){return!0},es.prototype.pe=function(t){return!1},es.prototype.ye=function(t){return!1},es.prototype.Ve=function(){return null},es.prototype.ge=function(){return null},es.prototype.Oe=function(){return!1},es.prototype.We=function(){return!0},es.prototype.je=function(){return 0},new es);var ns=(ss.prototype.has=function(t){return null!==this.data.get(t)},ss.prototype.first=function(){return this.data.Ve()},ss.prototype.last=function(){return this.data.ge()},Object.defineProperty(ss.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),ss.prototype.indexOf=function(t){return this.data.indexOf(t)},ss.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},ss.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.ke();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},ss.prototype.Ge=function(t,e){for(var n=void 0!==e?this.data.ve(e):this.data.be();n.ke();)if(!t(n.Ne().key))return},ss.prototype.ze=function(t){var e=this.data.ve(t);return e.ke()?e.Ne().key:null},ss.prototype.be=function(){return new rs(this.data.be())},ss.prototype.ve=function(t){return new rs(this.data.ve(t))},ss.prototype.add=function(t){return this.me(this.data.remove(t).Ae(t,!0))},ss.prototype.delete=function(t){return this.has(t)?this.me(this.data.remove(t)):this},ss.prototype.B=function(){return this.data.B()},ss.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},ss.prototype.isEqual=function(t){if(!(t instanceof ss))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},ss.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ss.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ss.prototype.me=function(t){var e=new ss(this.N);return e.data=t,e},ss),rs=(os.prototype.Ne=function(){return this.Ye.Ne().key},os.prototype.ke=function(){return this.Ye.ke()},os),is=new Yo(Kr.N);function os(t){this.Ye=t}function ss(t){this.N=t,this.data=new Yo(this.N)}var us=new Yo(Kr.N);var as=new Yo(Kr.N);var hs=new ns(Kr.N);function cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var fs=new ns(Hs);function ls(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function ps(t,e){this.targetId=t,this.As=e}function ds(t,e,n,r){void 0===n&&(n=Jr.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ys=(ks.Ze=function(t){return new ks(t.N)},ks.prototype.has=function(t){return null!=this.Je.get(t)},ks.prototype.get=function(t){return this.Je.get(t)},ks.prototype.first=function(){return this.Xe.Ve()},ks.prototype.last=function(){return this.Xe.ge()},ks.prototype.B=function(){return this.Xe.B()},ks.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(ks.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),ks.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},ks.prototype.add=function(t){var e=this.delete(t.key);return e.me(e.Je.Ae(t.key,t),e.Xe.Ae(t,null))},ks.prototype.delete=function(t){var e=this.get(t);return e?this.me(this.Je.remove(t),this.Xe.remove(e)):this},ks.prototype.isEqual=function(t){if(!(t instanceof ks))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},ks.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ks.prototype.me=function(t,e){var n=new ks;return n.N=this.N,n.Je=t,n.Xe=e,n},ks),vs=(Ss.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.Ae(e,t):3===t.type&&1!==n.type?this.ts=this.ts.Ae(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.Ae(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.Ae(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.Ae(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.Ae(e,{type:2,doc:t.doc}):zs()},Ss.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},Ss),gs=(_s.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new _s(t,e,ys.Ze(e),i,n,r,!0,!1)},Object.defineProperty(_s.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),_s.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},_s),ms=(As.ls=function(t,e){var n=new Map;return n.set(t,ws.ds(t,e)),new As(Or.min(),n,fs,is,cs())},As),ws=(Ns.ds=function(t,e){return new Ns(Jr.ht,e,cs(),cs(),cs())},Ns),bs=(Object.defineProperty(Is.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"ys",{get:function(){return 0!==this.ms},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Is.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Is.prototype.Ss=function(){var n=cs(),r=cs(),i=cs();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:zs()}}),new ws(this.Vs,this.gs,n,r,i)},Is.prototype.Ds=function(){this.ps=!1,this.Ps=xs()},Is.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.Ae(t,e)},Is.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Is.prototype.Ns=function(){this.ms+=1},Is.prototype.ks=function(){--this.ms},Is.prototype.$s=function(){this.ps=!0,this.gs=!0},Is),Es=(Ts.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof wo?this.Us(r,t.Rs):t.Rs instanceof bo&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},Ts.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.ks(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.ks(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.$s(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:zs()}})},Ts.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ls.forEach(function(t,e){r.Gs(e)&&n(e)})},Ts.prototype.Hs=function(t){var e,n,r=t.targetId,i=t.As.count,o=this.Ys(r);o&&((e=o.target).Ot()?0===i?(n=new Kr(e.path),this.Qs(r,n,new bo(n,Or.min()))):Ws(1===i):this.Js(r)!==i&&(this.zs(r),this.Bs=this.Bs.add(r)))},Ts.prototype.Xs=function(i){var o=this,s=new Map;this.Ls.forEach(function(t,e){var n,r=o.Ys(e);r&&(t.fs&&r.target.Ot()&&(n=new Kr(r.target.path),null!==o.Os.get(n)||o.Zs(e,n)||o.Qs(e,n,new bo(n,i))),t.bs&&(s.set(e,t.Ss()),t.Ds()))});var r=cs();this.xs.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new ms(i,s,this.Bs,this.Os,r);return this.Os=is,this.xs=Ds(),this.Bs=new ns(Hs),t},Ts.prototype.Us=function(t,e){var n;this.Gs(t)&&(n=this.Zs(t,e.key)?2:0,this.Ks(t).Cs(e.key,n),this.Os=this.Os.Ae(e.key,e),this.xs=this.xs.Ae(e.key,this.ti(e.key).add(t)))},Ts.prototype.Qs=function(t,e,n){var r;this.Gs(t)&&(r=this.Ks(t),this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.xs=this.xs.Ae(e,this.ti(e).delete(t)),n&&(this.Os=this.Os.Ae(e,n)))},Ts.prototype.removeTarget=function(t){this.Ls.delete(t)},Ts.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ms.ei(t).size+e.Ts.size-e.Is.size},Ts.prototype.Ns=function(t){this.Ks(t).Ns()},Ts.prototype.Ks=function(t){var e=this.Ls.get(t);return e||(e=new bs,this.Ls.set(t,e)),e},Ts.prototype.ti=function(t){var e=this.xs.get(t);return e||(e=new ns(Hs),this.xs=this.xs.Ae(t,e)),e},Ts.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Fs("WatchChangeAggregator","Detected inactive target",t),e},Ts.prototype.Ys=function(t){var e=this.Ls.get(t);return e&&e.ys?null:this.Ms.si(t)},Ts.prototype.zs=function(e){var n=this;this.Ls.set(e,new bs),this.Ms.ei(e).forEach(function(t){n.Qs(e,t,null)})},Ts.prototype.Zs=function(t,e){return this.Ms.ei(t).has(e)},Ts);function Ts(t){this.Ms=t,this.Ls=new Map,this.Os=is,this.xs=Ds(),this.Bs=new ns(Hs)}function Is(){this.ms=0,this.Ps=xs(),this.Vs=Jr.ht,this.gs=!1,this.ps=!0}function Ns(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function As(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function _s(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Ss(){this.ts=new Yo(Kr.N)}function ks(n){this.N=n?function(t,e){return n(t,e)||Kr.N(t.key,e.key)}:function(t,e){return Kr.N(t.key,e.key)},this.Je=us,this.Xe=new Yo(this.N)}function Ds(){return new Yo(Kr.N)}function xs(){return new Yo(Kr.N)}var Os={asc:"ASCENDING",desc:"DESCENDING"},Rs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ps=(Vs.prototype.ni=function(t){var e=void 0===t.code?Nr.UNKNOWN:Ho(t.code);return new Ar(e,t.message||"")},Vs.prototype.ri=function(t){return this.options.hi||ti(t)?t:{value:t}},Vs.prototype.oi=function(t){var e;return ti(e="object"==typeof t?t.value:t)?null:e},Vs.prototype._t=function(t){return{integerValue:""+t}},Vs.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(t)?"-0":t}},Vs.prototype.ai=function(t){return ni(t)?this._t(t):this.lt(t)},Vs.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Vs.prototype.v=function(t){var e=li(t);return new xr(e.seconds,e.nanos)},Vs.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Vs.prototype.ci=function(t){return this.options.hi?(Ws(void 0===t||"string"==typeof t),Jr.fromBase64String(t||"")):(Ws(void 0===t||t instanceof Uint8Array),Jr.fromUint8Array(t||new Uint8Array))},Vs.prototype.toVersion=function(t){return this.C(t.C())},Vs.prototype.fromVersion=function(t){return Ws(!!t),Or.v(this.v(t))},Vs.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Vs.prototype.di=function(t){var e=Pr.K(t);return Ws(Ls(e)),e},Vs.prototype.fi=function(t){return this._i(t.path)},Vs.prototype.Z=function(t){var e=this.di(t);return Ws(e.get(1)===this.ii.projectId),Ws(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Kr(this.Ti(e))},Vs.prototype.Ei=function(t){return this._i(t)},Vs.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Pr.G:this.Ti(e)},Object.defineProperty(Vs.prototype,"wi",{get:function(){return new Pr(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Vs.prototype.li=function(t){return new Pr(["projects",t.projectId,"databases",t.database])},Vs.prototype.Ti=function(t){return Ws(4<t.length&&"documents"===t.get(4)),t.$(5)},Vs.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Vs.prototype.Ai=function(t){return{name:this.fi(t.key),fields:t.Mt().mapValue.fields,updateTime:this.C(t.version.C())}},Vs.prototype.mi=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Wi({mapValue:{fields:t.fields}});return new wo(n,r,i,{hasCommittedMutations:!!e})},Vs.prototype.Pi=function(t){Ws(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Wi({mapValue:{fields:t.found.fields}});return new wo(e,n,r,{})},Vs.prototype.Vi=function(t){Ws(!!t.missing),Ws(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new bo(e,n)},Vs.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):zs()},Vs.prototype.pi=function(t){if("targetChange"in t){t.targetChange;var e=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],r=this.ci(t.targetChange.resumeToken),i=t.targetChange.cause,o=new ds(e,n,r,i&&this.ni(i)||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var u=this.Z(s.document.name),a=this.fromVersion(s.document.updateTime),h=new Wi({mapValue:{fields:s.document.fields}}),c=new wo(u,a,h,{});o=new ls(s.targetIds||[],s.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){t.documentDelete;var f=t.documentDelete;f.document;var l=this.Z(f.document),p=f.readTime?this.fromVersion(f.readTime):Or.min(),d=new bo(l,p);o=new ls([],f.removedTargetIds||[],d.key,d)}else if("documentRemove"in t){t.documentRemove;var y=t.documentRemove;y.document;var v=this.Z(y.document);o=new ls([],y.removedTargetIds||[],v,null)}else{if(!("filter"in t))return zs();t.filter;var g=t.filter;g.targetId;var m=new so(g.count||0);o=new ps(g.targetId,m)}return o},Vs.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:zs()},Vs.prototype.bi=function(t){if(!("targetChange"in t))return Or.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Or.min():this.fromVersion(e.readTime)},Vs.prototype.vi=function(t){var e,n=this;if(t instanceof qi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Gi)e={delete:this.fi(t.key)};else if(t instanceof Fi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Bi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof zi))return zs();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Vs.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):Ui.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Wi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.ki(t.updateMask);return new Fi(r,i,o,n)}return new qi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Gi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.$i(t)});return Ws(!0===n.exists),new Bi(u,a)}if(t.verify){var h=this.Z(t.verify);return new zi(h,n)}return zs()},Vs.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zs()},Vs.prototype.Ni=function(t){return void 0!==t.updateTime?Ui.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Ui.exists(t.exists):Ui.ft()},Vs.prototype.Mi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Or.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new xi(n,r)},Vs.prototype.Li=function(t,e){var n=this;return t&&0<t.length?(Ws(void 0!==e),t.map(function(t){return n.Mi(t,e)})):[]},Vs.prototype.Di=function(t){var e=t.transform;if(e instanceof Ei)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ii)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Ni)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof Ai)return{fieldPath:t.field.j(),increment:e.ct};throw zs()},Vs.prototype.$i=function(t){var e,n,r=null;"setToServerValue"in t?(Ws("REQUEST_TIME"===t.setToServerValue),r=Ei.instance):"appendMissingElements"in t?(e=t.appendMissingElements.values||[],r=new Ii(e)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Ni(n)):"increment"in t?r=new Ai(this,t.increment):zs();var i=Wr.X(t.fieldPath);return new Mi(i,r)},Vs.prototype.Oi=function(t){return{documents:[this.Ei(t.path)]}},Vs.prototype.xi=function(t){Ws(1===t.documents.length);var e=t.documents[0];return Io.Wt(this.Ii(e)).ee()},Vs.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.M()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Vs.prototype.Wi=function(t){var e,n=this.Ii(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Ws(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=this.ji(r.where));var u=[];r.orderBy&&(u=this.Ki(r.orderBy));var a=null;r.limit&&(a=this.oi(r.limit));var h=null;r.startAt&&(h=this.Gi(r.startAt));var c=null;return r.endAt&&(c=this.Gi(r.endAt)),new Io(n,o,u,s,a,"F",h,c).ee()},Vs.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Vs.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zs()}},Vs.prototype.ee=function(t){var e,n=t.target;return(e=n.Ot()?{documents:this.Oi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Vs.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof No?e.Yi(t):zs()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Vs.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):zs():[]},Vs.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Vs.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Vs.prototype.Qi=function(t){return{before:t.before,values:t.position}},Vs.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new xo(n,e)},Vs.prototype.en=function(t){return Os[t]},Vs.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Vs.prototype.nn=function(t){return Rs[t]},Vs.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return zs()}},Vs.prototype.hn=function(t){return{fieldPath:t.j()}},Vs.prototype.on=function(t){return Wr.X(t.fieldPath)},Vs.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Vs.prototype.tn=function(t){return new Oo(this.on(t.field),this.sn(t.direction))},Vs.prototype.Xi=function(t){return No.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Vs.prototype.Yi=function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(mi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Vs.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return No.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return No.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return zs()}},Vs.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Vs.prototype.ki=function(t){var e=t.fieldPaths||[];return new Ci(e.map(function(t){return Wr.X(t)}))},Vs);function Vs(t,e){this.ii=t,this.options=e}function Ls(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Cs=(Us.an=function(t){Us.platform&&zs(),Us.platform=t},Us.nt=function(){return Us.platform||zs(),Us.platform},Us),Ms=new h("@firebase/firestore");function Us(){}function js(){return Ms.logLevel}function qs(t){Ms.logLevel=t}function Fs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ms.logLevel<=l.DEBUG&&(e=n.map(Gs),Ms.debug.apply(Ms,i(["Firestore ("+mr+"): "+t],e)))}function Bs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ms.logLevel<=l.ERROR&&(e=n.map(Gs),Ms.error.apply(Ms,i(["Firestore ("+mr+"): "+t],e)))}function Gs(t){if("string"==typeof t)return t;var e=Cs.nt();try{return e.un(t)}catch(e){return t}}function zs(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+mr+") INTERNAL ASSERTION FAILED: "+t;throw Bs(e),new Error(e)}function Ws(t){t||zs()}var Qs=(Ks.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Cs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ks);function Ks(){}function Hs(t,e){return t<e?-1:e<t?1:0}function Ys(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Xs(t){return t+"\0"}function $s(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Js=(Object.defineProperty(mu.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),mu.prototype.isEqual=function(t){return t instanceof mu&&t.projectId===this.projectId&&t.database===this.database},mu.prototype.S=function(t){return Hs(this.projectId,t.projectId)||Hs(this.database,t.database)},mu),Zs=(gu.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},gu.prototype.has=function(t){return void 0!==this.get(t)},gu.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},gu.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},gu.prototype.forEach=function(u){Xr(this.fn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},gu.prototype.B=function(){return $r(this.fn)},gu),tu=(vu.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o,s=this.mutations[i];s.key.isEqual(t)&&(o=r[i],e=s.at(e,o))}return e},vu.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},vu.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.Ae(t.key,e))}),i},vu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cs())},vu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ys(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Ys(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},vu),eu=(yu.from=function(t,e,n,r){Ws(t.mutations.length===n.length);for(var i=as,o=t.mutations,s=0;s<o.length;s++)i=i.Ae(o[s].key,n[s].version);return new yu(t,e,n,r,i)},yu),nu=(du.prototype.catch=function(t){return this.next(void 0,t)},du.prototype.next=function(r,i){var o=this;return this.Vn&&zs(),this.Vn=!0,this.Pn?this.error?this.gn(i,this.error):this.pn(r,this.result):new du(function(e,n){o.An=function(t){o.pn(r,t).next(e,n)},o.mn=function(t){o.gn(i,t).next(e,n)}})},du.prototype.yn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},du.prototype.bn=function(t){try{var e=t();return e instanceof du?e:du.resolve(e)}catch(t){return du.reject(t)}},du.prototype.pn=function(t,e){return t?this.bn(function(){return t(e)}):du.resolve(e)},du.prototype.gn=function(t,e){return t?this.bn(function(){return t(e)}):du.reject(e)},du.resolve=function(n){return new du(function(t,e){t(n)})},du.reject=function(n){return new du(function(t,e){e(n)})},du.vn=function(t){return new du(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},du.Sn=function(t){for(var n=du.resolve(!1),e=function(e){n=n.next(function(t){return t?du.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},du.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.vn(i)},du),ru=(Object.defineProperty(pu.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!0,configurable:!0}),pu.prototype.Nn=function(t,e){this.kn(),this.readTime=e,this.Dn.set(t.key,t)},pu.prototype.$n=function(t,e){this.kn(),e&&(this.readTime=e),this.Dn.set(t,null)},pu.prototype.Mn=function(t,e){this.kn();var n=this.Dn.get(e);return void 0!==n?nu.resolve(n):this.Ln(t,e)},pu.prototype.getEntries=function(t,e){return this.On(t,e)},pu.prototype.apply=function(t){return this.kn(),this.Cn=!0,this.xn(t)},pu.prototype.kn=function(){},pu),iu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ou=(lu.prototype.qn=function(t){this.Bn.push(t)},lu.prototype.Un=function(){this.Bn.forEach(function(t){return t()})},lu),su=(fu.prototype.Kn=function(e,n){var r=this;return this.Wn.Gn(e,n).next(function(t){return r.zn(e,n,t)})},fu.prototype.zn=function(t,r,i){return this.Qn.Mn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},fu.prototype.Hn=function(t,e,i){var o=is;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.Ae(t,e)}),o},fu.prototype.Yn=function(e,t){var n=this;return this.Qn.getEntries(e,t).next(function(t){return n.Jn(e,t)})},fu.prototype.Jn=function(r,i){var o=this;return this.Wn.Xn(r,i).next(function(t){var e=o.Hn(r,i,t),n=is;return e.forEach(function(t,e){e=e||new bo(t,Or.min()),n=n.Ae(t,e)}),n})},fu.prototype.Zn=function(t,e,n){return e.Ot()?this.tr(t,e.path):e._e()?this.er(t,e,n):this.sr(t,e,n)},fu.prototype.tr=function(t,e){return this.Kn(t,new Kr(e)).next(function(t){var e=us;return t instanceof wo&&(e=e.Ae(t.key,t)),e})},fu.prototype.er=function(n,r,i){var o=this,s=r.collectionGroup,u=us;return this.jn.ir(n,s).next(function(t){return nu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.sr(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ae(t,e)})})}).next(function(){return u})})},fu.prototype.sr=function(e,n,t){var c,f,r=this;return this.Qn.Zn(e,n,t).next(function(t){return c=t,r.Wn.nr(e,n)}).next(function(t){return f=t,r.rr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.Tn);c=h instanceof wo?c.Ae(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},fu.prototype.rr=function(t,e,n){for(var r=cs(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Fi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Qn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof wo&&(h=h.Ae(t,e))}),h})},fu),uu=(cu.ar=function(t,e){for(var n=cs(),r=cs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new cu(t,e.fromCache,n,r)},cu),au=(hu.prototype.cr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},hu.prototype.next=function(){var t=++this.previousValue;return this._r&&this._r(t),t},hu);function hu(t,e){var n=this;this.previousValue=t,e&&(e.ur=function(t){return n.cr(t)},this._r=function(t){return e.lr(t)})}function cu(t,e,n,r){this.targetId=t,this.fromCache=e,this.hr=n,this.or=r}function fu(t,e,n){this.Qn=t,this.Wn=e,this.jn=n}function lu(){this.Bn=[]}function pu(){this.Dn=new Zs(function(t){return t.toString()}),this.Cn=!1}function du(t){var e=this;this.An=null,this.mn=null,this.result=void 0,this.error=void 0,this.Pn=!1,this.Vn=!1,t(function(t){e.Pn=!0,e.result=t,e.An&&e.An(t)},function(t){e.Pn=!0,e.error=t,e.mn&&e.mn(t)})}function yu(t,e,n,r,i){this.batch=t,this.wn=e,this.En=n,this.streamToken=r,this.Rn=i}function vu(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function gu(t){this.dn=t,this.fn={}}function mu(t,e){this.projectId=t,this.database=e||"(default)"}function wu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}au.dr=-1;var bu=(Au.prototype.reset=function(){this.Ar=0},Au.prototype.Vr=function(){this.Ar=this.Rr},Au.prototype.gr=function(t){var e=this;this.cancel();var n=Math.floor(this.Ar+this.pr()),r=Math.max(0,Date.now()-this.Pr),i=Math.max(0,n-r);0<i&&Fs("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ar+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mr=this.Tr.yr(this.Er,i,function(){return e.Pr=Date.now(),t()}),this.Ar*=this.wr,this.Ar<this.Ir&&(this.Ar=this.Ir),this.Ar>this.Rr&&(this.Ar=this.Rr)},Au.prototype.cancel=function(){null!==this.mr&&(this.mr.cancel(),this.mr=null)},Au.prototype.pr=function(){return(Math.random()-.5)*this.Ar},Au),Eu=(Nu.Cr=function(t,e,n,r,i){var o=new Nu(t,e,Date.now()+n,r,i);return o.start(n),o},Nu.prototype.start=function(t){var e=this;this.Fr=setTimeout(function(){return e.Nr()},t)},Nu.prototype.kr=function(){return this.Nr()},Nu.prototype.cancel=function(t){null!==this.Fr&&(this.clearTimeout(),this.Dr.reject(new Ar(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Nu.prototype.Nr=function(){var e=this;this.br.$r(function(){return null!==e.Fr?(e.clearTimeout(),e.op().then(function(t){return e.Dr.resolve(t)})):Promise.resolve()})},Nu.prototype.clearTimeout=function(){null!==this.Fr&&(this.Sr(this),clearTimeout(this.Fr),this.Fr=null)},Nu),Tu=(Object.defineProperty(Iu.prototype,"Kr",{get:function(){return this.Or},enumerable:!0,configurable:!0}),Iu.prototype.$r=function(t){this.enqueue(t)},Iu.prototype.Gr=function(t){this.zr(),this.Hr(t)},Iu.prototype.Yr=function(t){return this.zr(),this.Hr(t)},Iu.prototype.Jr=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.zr(),this.Or?[3,2]:(this.Or=!0,(e=Cs.nt().window)&&e.removeEventListener("visibilitychange",this.Wr),[4,this.Yr(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Iu.prototype.enqueue=function(t){return this.zr(),this.Or?new Promise(function(t){}):this.Hr(t)},Iu.prototype.Xr=function(i){var t=this;this.zr(),this.Or||(this.Lr=this.Lr.then(function(){var n=new wu,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.Qr.reset(),[3,3];case 2:if("IndexedDbTransactionError"!==(e=t.sent()).name)throw n.resolve(),e;return Fs("AsyncQueue","Operation failed with retryable error: "+e),this.Qr.gr(r),[3,3];case 3:return[2]}})})};return t.$r(r),n.promise}))},Iu.prototype.Hr=function(t){var e=this,n=this.Mr.then(function(){return e.qr=!0,t().catch(function(t){throw e.Br=t,e.qr=!1,Bs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.qr=!1,t})});return this.Mr=n},Iu.prototype.yr=function(t,e,n){var r=this;this.zr(),-1<this.Ur.indexOf(t)&&(e=0);var i=Eu.Cr(this,t,e,n,function(t){return r.Zr(t)});return this.xr.push(i),i},Iu.prototype.zr=function(){this.Br&&zs()},Iu.prototype.th=function(){},Iu.prototype.eh=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Mr];case 1:t.sent(),t.label=2;case 2:if(e!==this.Mr)return[3,0];t.label=3;case 3:return[2]}})})},Iu.prototype.sh=function(t){for(var e=0,n=this.xr;e<n.length;e++)if(n[e].Er===t)return!0;return!1},Iu.prototype.jr=function(r){var i=this;return this.eh().then(function(){i.xr.sort(function(t,e){return t.vr-e.vr});for(var t=0,e=i.xr;t<e.length;t++){var n=e[t];if(n.kr(),"all"!==r&&n.Er===r)break}return i.eh()})},Iu.prototype.ih=function(t){this.Ur.push(t)},Iu.prototype.Zr=function(t){var e=this.xr.indexOf(t);this.xr.splice(e,1)},Iu);function Iu(){var t=this;this.Mr=Promise.resolve(),this.Lr=Promise.resolve(),this.Or=!1,this.xr=[],this.Br=null,this.qr=!1,this.Ur=[],this.Qr=new bu(this,"async_queue_retry"),this.Wr=function(){t.jr("async_queue_retry")};var e=Cs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wr)}function Nu(t,e,n,r,i){this.br=t,this.Er=e,this.vr=n,this.op=r,this.Sr=i,this.Dr=new wu,this.then=this.Dr.promise.then.bind(this.Dr.promise),this.catch=this.Dr.promise.catch.bind(this.Dr.promise),this.Dr.promise.catch(function(t){})}function Au(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Tr=t,this.Er=e,this.Ir=n,this.wr=r,this.Rr=i,this.Ar=0,this.mr=null,this.Pr=Date.now(),this.reset()}function _u(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Hs(n,i);return 0===s?Hs(r,o):s}var Su=(Ou.prototype.hh=function(){return++this.rh},Ou.prototype.oh=function(t){var e,n=[t,this.hh()];this.buffer.size<this.nh?this.buffer=this.buffer.add(n):_u(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Ou.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Ou),ku={ah:!1,uh:0,_h:0,lh:0},Du=(xu.Eh=function(t){return new xu(t,xu.Ih,xu.wh)},xu);function xu(t,e,n){this.dh=t,this.fh=e,this.Th=n}function Ou(t){this.nh=t,this.buffer=new ns(_u),this.rh=0}Du.Rh=-1,Du.Ah=1048576,Du.mh=41943040,Du.Ih=10,Du.wh=1e3,Du.Ph=new Du(Du.mh,Du.Ih,Du.wh),Du.DISABLED=new Du(Du.Rh,0,0);var Ru=(Lu.prototype.start=function(t){this.Vh.yh.dh!==Du.Rh&&this.bh(t)},Lu.prototype.stop=function(){this.ph&&(this.ph.cancel(),this.ph=null)},Object.defineProperty(Lu.prototype,"vh",{get:function(){return null!==this.ph},enumerable:!0,configurable:!0}),Lu.prototype.bh=function(n){var t=this,e=this.gh?3e5:6e4;Fs("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.ph=this.br.yr("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.ph=null,this.gh=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Sh(this.Vh)];case 2:return t.sent(),[3,7];case 3:return"IndexedDbTransactionError"!==(e=t.sent()).name?[3,4]:(Fs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]);case 4:return[4,dh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.bh(n)];case 8:return t.sent(),[2]}})})})},Lu),Pu=(Vu.prototype.Ch=function(t,e){return this.Dh.Fh(t).next(function(t){return Math.floor(e/100*t)})},Vu.prototype.Nh=function(t,e){var n=this;if(0===e)return nu.resolve(au.dr);var r=new Su(e);return this.Dh.js(t,function(t){return r.oh(t.sequenceNumber)}).next(function(){return n.Dh.kh(t,function(t){return r.oh(t)})}).next(function(){return r.maxValue})},Vu.prototype.$h=function(t,e,n){return this.Dh.$h(t,e,n)},Vu.prototype.Mh=function(t,e){return this.Dh.Mh(t,e)},Vu.prototype.Lh=function(e,n){var r=this;return this.yh.dh===Du.Rh?(Fs("LruGarbageCollector","Garbage collection skipped; disabled"),nu.resolve(ku)):this.Oh(e).next(function(t){return t<r.yh.dh?(Fs("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.yh.dh),ku):r.xh(e,n)})},Vu.prototype.Oh=function(t){return this.Dh.Oh(t)},Vu.prototype.xh=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Ch(e,this.yh.fh).next(function(t){return i=t>c.yh.Th?(Fs("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.yh.Th+" from "+t),c.yh.Th):t,s=Date.now(),c.Nh(e,i)}).next(function(t){return r=t,u=Date.now(),c.$h(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Mh(e,r)}).next(function(t){return h=Date.now(),js()<=l.DEBUG&&Fs("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),nu.resolve({ah:!0,uh:i,_h:o,lh:t})})},Vu);function Vu(t,e){this.Dh=t,this.yh=e}function Lu(t,e){this.Vh=t,this.br=e,this.gh=!1,this.ph=null}function Cu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Uu(e)),e=Mu(t.get(n),e);return Uu(e)}function Mu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Uu(t){return t+""}function ju(t){var e=t.length;if(Ws(2<=e),2===e)return Ws(""===t.charAt(0)&&""===t.charAt(1)),Pr.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&zs(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:zs()}o=s+2}return new Pr(r)}var qu,Fu=(Xu.qh=function(o,t,s){return Fs("SimpleDb","Opening database:",o),new nu(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Xu(e))},i.onblocked=function(){r(new Ar(Nr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Ar(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Fs("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,_a).next(function(){Fs("SimpleDb","Database upgrade to version "+_a+" complete")})}}).yn()},Xu.delete=function(t){return Fs("SimpleDb","Removing database:",t),$u(window.indexedDB.deleteDatabase(t)).yn()},Xu.Uh=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Xu.Qh())return!0;if(void 0===window.navigator)return!1;var t=p(),e=Xu.Bh(t),n=0<e&&e<10,r=Xu.Wh(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Xu.Qh=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.jh)},Xu.Kh=function(t,e){return t.store(e)},Xu.Bh=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Xu.Wh=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Xu.prototype.Gh=function(e){this.db.onversionchange=function(t){return e(t)}},Xu.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=zu.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),nu.reject(t)}).yn(),r={},n.catch(function(){}),[4,e.zh];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Fs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Xu.prototype.close=function(){this.db.close()},Xu),Bu=(Object.defineProperty(Yu.prototype,"Pn",{get:function(){return this.Yh},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"Xh",{get:function(){return this.Jh},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"cursor",{set:function(t){this.Hh=t},enumerable:!0,configurable:!0}),Yu.prototype.done=function(){this.Yh=!0},Yu.prototype.Zh=function(t){this.Jh=t},Yu.prototype.delete=function(){return $u(this.Hh.delete())},Yu),Gu=(n(Hu,qu=Ar),Hu),zu=(Ku.open=function(t,e,n){return new Ku(t.transaction(n,e))},Object.defineProperty(Ku.prototype,"zh",{get:function(){return this.to.promise},enumerable:!0,configurable:!0}),Ku.prototype.abort=function(t){t&&this.to.reject(t),this.aborted||(Fs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ku.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Wu(e)},Ku),Wu=(Qu.prototype.put=function(t,e){return $u(void 0!==e?(Fs("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Fs("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Qu.prototype.add=function(t){return Fs("SimpleDb","ADD",this.store.name,t,t),$u(this.store.add(t))},Qu.prototype.get=function(e){var n=this;return $u(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Fs("SimpleDb","GET",n.store.name,e,t),t})},Qu.prototype.delete=function(t){return Fs("SimpleDb","DELETE",this.store.name,t),$u(this.store.delete(t))},Qu.prototype.count=function(){return Fs("SimpleDb","COUNT",this.store.name),$u(this.store.count())},Qu.prototype.eo=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.so(n,function(t,e){r.push(e)}).next(function(){return r})},Qu.prototype.io=function(t,e){Fs("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.no=!1;var r=this.cursor(n);return this.so(r,function(t,e,n){return n.delete()})},Qu.prototype.ro=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.so(r,e)},Qu.prototype.ho=function(i){var t=this.cursor({});return new nu(function(n,r){t.onerror=function(t){var e=Zu(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Qu.prototype.so=function(t,s){var u=[];return new nu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Bu(i),(n=s(i.primaryKey,i.value,e))instanceof nu&&(r=n.catch(function(t){return e.done(),nu.reject(t)}),u.push(r)),e.Pn?o():null===e.Xh?i.continue():i.continue(e.Xh)):o()}}).next(function(){return nu.vn(u)})},Qu.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Qu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.no?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Qu);function Qu(t){this.store=t}function Ku(t){var n=this;this.transaction=t,this.aborted=!1,this.to=new wu,this.transaction.oncomplete=function(){n.to.resolve()},this.transaction.onabort=function(){t.error?n.to.reject(new Gu(t.error)):n.to.resolve()},this.transaction.onerror=function(t){var e=Zu(t.target.error);n.to.reject(new Gu(e))}}function Hu(t){var e=this;return(e=qu.call(this,Nr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Yu(t){this.Hh=t,this.Yh=!1,this.Jh=null}function Xu(t){this.db=t,12.2===Xu.Bh(p())&&Bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function $u(t){return new nu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Zu(t.target.error);r(e)}})}var Ju=!1;function Zu(t){var e=Fu.Bh(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Ar("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ju||(Ju=!0,setTimeout(function(){throw r},0)),r}}return t}var ta=(ea.uo=function(t,e,n,r){return Ws(""!==t.uid),new ea(t.t()?t.uid:"",e,n,r)},ea.prototype.co=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ia(t).ro({index:Pa.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},ea.prototype._o=function(e,t,n){return this.lo(e).next(function(t){return t.lastStreamToken=n.toBase64(),sa(e).put(t)})},ea.prototype.do=function(t){return this.lo(t).next(function(t){return Jr.fromBase64String(t.lastStreamToken)})},ea.prototype.fo=function(e,n){return this.lo(e).next(function(t){return t.lastStreamToken=n.toBase64(),sa(e).put(t)})},ea.prototype.To=function(h,c,f,l){var p=this,d=oa(h),y=ia(h);return y.add({}).next(function(t){Ws("number"==typeof t);for(var e=new tu(t,c,f,l),n=p.serializer.Eo(p.userId,e),r=[],i=new ns(function(t,e){return Hs(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=Va.key(p.userId,u.key.path,t),i=i.add(u.key.path.M());r.push(y.put(n)),r.push(d.put(a,Va.PLACEHOLDER))}return i.forEach(function(t){r.push(p.jn.Io(h,t))}),h.qn(function(){p.ao[t]=e.keys()}),nu.vn(r).next(function(){return e})})},ea.prototype.wo=function(t,e){var n=this;return ia(t).get(e).next(function(t){return t?(Ws(t.userId===n.userId),n.serializer.Ro(t)):null})},ea.prototype.Ao=function(t,n){var r=this;return this.ao[n]?nu.resolve(this.ao[n]):this.wo(t,n).next(function(t){if(t){var e=t.keys();return r.ao[n]=e}return null})},ea.prototype.mo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return ia(t).ro({index:Pa.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Ws(e.batchId>=i),o=r.serializer.Ro(e)),n.done()}).next(function(){return o})},ea.prototype.Po=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return ia(t).ro({index:Pa.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},ea.prototype.Vo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ia(t).eo(Pa.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Ro(t)})})},ea.prototype.Gn=function(u,a){var h=this,t=Va.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return oa(u).ro({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ju(i);if(r===h.userId&&a.path.isEqual(s))return ia(u).get(o).next(function(t){if(!t)throw zs();Ws(t.userId===h.userId),c.push(h.serializer.Ro(t))});n.done()}).next(function(){return c})},ea.prototype.Xn=function(r,t){var a=this,h=new ns(Hs),i=[];return t.forEach(function(u){var t=Va.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=oa(r).ro({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ju(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),nu.vn(i).next(function(){return a.po(r,h)})},ea.prototype.nr=function(t,e){var u=this,a=e.path,h=a.length+1,n=Va.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new ns(Hs);return oa(t).ro({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ju(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.po(t,c)})},ea.prototype.po=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(ia(e).get(t).next(function(t){if(null===t)throw zs();Ws(t.userId===n.userId),r.push(n.serializer.Ro(t))}))}),nu.vn(i).next(function(){return r})},ea.prototype.yo=function(e,n){var r=this;return ra(e.bo,this.userId,n).next(function(t){return e.qn(function(){r.vo(n.batchId)}),nu.forEach(t,function(t){return r.oo.So(e,t)})})},ea.prototype.vo=function(t){delete this.ao[t]},ea.prototype.Do=function(n){var o=this;return this.co(n).next(function(t){if(!t)return nu.resolve();var e=IDBKeyRange.lowerBound(Va.prefixForUser(o.userId)),i=[];return oa(n).ro({range:e},function(t,e,n){var r;t[0]===o.userId?(r=ju(t[1]),i.push(r)):n.done()}).next(function(){Ws(0===i.length)})})},ea.prototype.Co=function(t,e){return na(t,this.userId,e)},ea.prototype.lo=function(t){var e=this;return sa(t).get(this.userId).next(function(t){return t||new Ra(e.userId,-1,"")})},ea);function ea(t,e,n,r){this.userId=t,this.serializer=e,this.jn=n,this.oo=r,this.ao={}}function na(t,o,e){var n=Va.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return oa(t).ro({range:r,no:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function ra(t,e,n){var r=t.store(Pa.store),i=t.store(Va.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ro({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Ws(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Va.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return nu.vn(o).next(function(){return h})}function ia(t){return th.Kh(t,Pa.store)}function oa(t){return th.Kh(t,Va.store)}function sa(t){return th.Kh(t,Ra.store)}var ua=(ca.prototype.next=function(){return this.Fo+=2,this.Fo},ca.No=function(){return new ca(0)},ca.ko=function(){return new ca(-1)},ca),aa=(ha.prototype.$o=function(n){var r=this;return this.Mo(n).next(function(t){var e=new ua(t.highestTargetId);return t.highestTargetId=e.next(),r.Lo(n,t).next(function(){return t.highestTargetId})})},ha.prototype.Oo=function(t){return this.Mo(t).next(function(t){return Or.v(new xr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},ha.prototype.xo=function(t){return pa(t.bo)},ha.prototype.Bo=function(e,n,r){var i=this;return this.Mo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Lo(e,t)})},ha.prototype.qo=function(e,n){var r=this;return this.Uo(e,n).next(function(){return r.Mo(e).next(function(t){return t.targetCount+=1,r.Qo(n,t),r.Lo(e,t)})})},ha.prototype.Wo=function(t,e){return this.Uo(t,e)},ha.prototype.jo=function(e,t){var n=this;return this.Ko(e,t.targetId).next(function(){return fa(e).delete(t.targetId)}).next(function(){return n.Mo(e)}).next(function(t){return Ws(0<t.targetCount),--t.targetCount,n.Lo(e,t)})},ha.prototype.$h=function(r,i,o){var s=this,u=0,a=[];return fa(r).ro(function(t,e){var n=s.serializer.Go(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.jo(r,n)))}).next(function(){return nu.vn(a)}).next(function(){return u})},ha.prototype.js=function(t,r){var i=this;return fa(t).ro(function(t,e){var n=i.serializer.Go(e);r(n)})},ha.prototype.Mo=function(t){return la(t.bo)},ha.prototype.Lo=function(t,e){return th.Kh(t,Ba.store).put(Ba.key,e)},ha.prototype.Uo=function(t,e){return fa(t).put(this.serializer.zo(e))},ha.prototype.Qo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},ha.prototype.Ho=function(t){return this.Mo(t).next(function(t){return t.targetCount})},ha.prototype.Yo=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return fa(t).ro({range:n,index:qa.queryTargetsIndexName},function(t,e,n){var r=o.serializer.Go(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},ha.prototype.Jo=function(n,t,r){var i=this,o=[],s=da(n);return t.forEach(function(t){var e=Cu(t.path);o.push(s.put(new Fa(r,e))),o.push(i.oo.Xo(n,r,t))}),nu.vn(o)},ha.prototype.Zo=function(n,t,r){var i=this,o=da(n);return nu.forEach(t,function(t){var e=Cu(t.path);return nu.vn([o.delete([r,e]),i.oo.ta(n,r,t)])})},ha.prototype.Ko=function(t,e){var n=da(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},ha.prototype.ea=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=da(t),o=cs();return r.ro({range:n,no:!0},function(t,e,n){var r=ju(t[1]),i=new Kr(r);o=o.add(i)}).next(function(){return o})},ha.prototype.Co=function(t,e){var n=Cu(e.path),r=IDBKeyRange.bound([n],[Xs(n)],!1,!0),i=0;return da(t).ro({index:Fa.documentTargetsIndex,no:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},ha.prototype.si=function(t,e){var n=this;return fa(t).get(e).next(function(t){return t?n.serializer.Go(t):null})},ha);function ha(t,e){this.oo=t,this.serializer=e}function ca(t){this.Fo=t}function fa(t){return th.Kh(t,qa.store)}function la(t){return Fu.Kh(t,Ba.store).get(Ba.key).next(function(t){return Ws(null!==t),t})}function pa(t){return la(t).next(function(t){return t.highestListenSequenceNumber})}function da(t){return th.Kh(t,Fa.store)}var ya,va=(ga.prototype.Nn=function(t,e,n){return wa(t).put(ba(e),n)},ga.prototype.$n=function(t,e){var n=wa(t),r=ba(e);return n.delete(r)},ga.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.sa(e,t)})},ga.prototype.Mn=function(t,e){var n=this;return wa(t).get(ba(e)).next(function(t){return n.ia(t)})},ga.prototype.na=function(t,e){var n=this;return wa(t).get(ba(e)).next(function(t){var e=n.ia(t);return e?{ra:e,size:Ea(t)}:null})},ga.prototype.getEntries=function(t,e){var r=this,i=is;return this.ha(t,e,function(t,e){var n=r.ia(e);i=i.Ae(t,n)}).next(function(){return i})},ga.prototype.oa=function(t,e){var r=this,i=is,o=new Yo(Kr.N);return this.ha(t,e,function(t,e){var n=r.ia(e);o=n?(i=i.Ae(t,n),o.Ae(t,Ea(e))):(i=i.Ae(t,null),o.Ae(t,0))}).next(function(){return{aa:i,ua:o}})},ga.prototype.ha=function(t,e,i){if(e.B())return nu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return wa(t).ro({range:n},function(t,e,n){for(var r=Kr.st(t);s&&Kr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.ke()?o.Ne():null),s?n.Zh(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.ke()?o.Ne():null})},ga.prototype.Zn=function(t,i,e){var n,r,o,s=this,u=us,a=i.path.length+1,h={};return e.isEqual(Or.min())?(n=i.path.W(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.W(),o=this.serializer.ca(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Ua.collectionReadTimeIndex),wa(t).ro(h,function(t,e,n){var r;t.length===a&&(r=s.serializer._a(e),i.path.q(r.key.path)?r instanceof wo&&i.matches(r)&&(u=u.Ae(r.key,r)):n.done())}).next(function(){return u})},ga.prototype.la=function(t,e){var r=this,i=is,o=this.serializer.ca(e),n=wa(t),s=IDBKeyRange.lowerBound(o,!0);return n.ro({index:Ua.readTimeIndex,range:s},function(t,e){var n=r.serializer._a(e);i=i.Ae(n.key,n),o=e.readTime}).next(function(){return{da:i,readTime:r.serializer.fa(o)}})},ga.prototype.Ta=function(t){var r=this,e=wa(t),i=Or.min();return e.ro({index:Ua.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.fa(e.readTime)),n.done()}).next(function(){return i})},ga.prototype.Ea=function(t){return new ga.Ia(this,!!t&&t.wa)},ga.prototype.Ra=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},ga.prototype.getMetadata=function(t){return ma(t).get(ja.key).next(function(t){return Ws(!!t),t})},ga.prototype.sa=function(t,e){return ma(t).put(ja.key,e)},ga.prototype.ia=function(t){if(t){var e=this.serializer._a(t);return e instanceof bo&&e.version.isEqual(Or.min())?null:e}return null},ga);function ga(t,e){this.serializer=t,this.jn=e}function ma(t){return th.Kh(t,ja.store)}function wa(t){return th.Kh(t,Ua.store)}function ba(t){return t.path.W()}function Ea(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw zs();e=t.noDocument}return JSON.stringify(e).length}function Ta(t,e){var n=this;return(n=ya.call(this)||this).Aa=t,n.wa=e,n.ma=new Zs(function(t){return t.toString()}),n}function Ia(t,e){this.seconds=t,this.nanoseconds=e}va.Ia=(n(Ta,ya=ru),Ta.prototype.xn=function(s){var u=this,a=[],h=0,c=new ns(function(t,e){return Hs(t.j(),e.j())});return this.Dn.forEach(function(t,e){var n,r,i,o=u.ma.get(t);e?(n=u.Aa.serializer.Pa(e,u.readTime),c=c.add(t.path.M()),r=Ea(n),h+=r-o,a.push(u.Aa.Nn(s,t,n))):(h-=o,u.wa?(i=u.Aa.serializer.Pa(new bo(t,Or.min()),u.readTime),a.push(u.Aa.Nn(s,t,i))):a.push(u.Aa.$n(s,t)))}),c.forEach(function(t){a.push(u.Aa.jn.Io(s,t))}),a.push(this.Aa.updateMetadata(s,h)),nu.vn(a)},Ta.prototype.Ln=function(t,e){var n=this;return this.Aa.na(t,e).next(function(t){return null===t?(n.ma.set(e,0),null):(n.ma.set(e,t.size),t.ra)})},Ta.prototype.On=function(t,e){var n=this;return this.Aa.oa(t,e).next(function(t){var e=t.aa;return t.ua.forEach(function(t,e){n.ma.set(t,e)}),e})},Ta);var Na=(Oa.prototype.Io=function(t,e){return this.Va.add(e),nu.resolve()},Oa.prototype.ir=function(t,e){return nu.resolve(this.Va.getEntries(e))},Oa),Aa=(xa.prototype.add=function(t){var e=t.O(),n=t.M(),r=this.index[e]||new ns(Pr.N),i=!r.has(n);return this.index[e]=r.add(n),i},xa.prototype.has=function(t){var e=t.O(),n=t.M(),r=this.index[e];return r&&r.has(n)},xa.prototype.getEntries=function(t){return(this.index[t]||new ns(Pr.N)).W()},xa),_a=10,Sa=(Da.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Ws(t<e&&0<=t&&e<=_a);var o,s=new zu(r);t<1&&1<=e&&(n.createObjectStore(ka.store),(o=n).createObjectStore(Ra.store,{keyPath:Ra.keyPath}),o.createObjectStore(Pa.store,{keyPath:Pa.keyPath,autoIncrement:!0}).createIndex(Pa.userMutationsIndex,Pa.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Va.store),za(n),n.createObjectStore(Ua.store));var u,a=nu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Fa.store),u.deleteObjectStore(qa.store),u.deleteObjectStore(Ba.store),za(n)),a=a.next(function(){return t=s.store(Ba.store),e=new Ba(0,0,Or.min().C(),0),t.put(Ba.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Pa.store).eo().next(function(t){r.deleteObjectStore(Pa.store),r.createObjectStore(Pa.store,{keyPath:Pa.keyPath,autoIncrement:!0}).createIndex(Pa.userMutationsIndex,Pa.userMutationsKeyPath,{unique:!0});var e=i.store(Pa.store),n=t.map(function(t){return e.put(t)});return nu.vn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Wa.store,{keyPath:Wa.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(ja.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Ua.store)).createIndex(Ua.readTimeIndex,Ua.readTimeIndexPath,{unique:!1}),t.createIndex(Ua.collectionReadTimeIndex,Ua.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Da.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ua.store).ro(function(t,e){n+=Ea(e)}).next(function(){var t=new ja(n);return e.store(ja.store).put(ja.key,t)})},Da.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Ra.store),e=r.store(Pa.store);return t.eo().next(function(t){return nu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.eo(Pa.userMutationsIndex,t).next(function(t){return nu.forEach(t,function(t){Ws(t.userId===n.userId);var e=i.serializer.Ro(t);return ra(r,n.userId,e).next(function(){})})})})})},Da.prototype.ensureSequenceNumbers=function(t){var s=t.store(Fa.store),e=t.store(Ua.store);return pa(t).next(function(i){var o=[];return e.ro(function(t,e){var n=new Pr(t),r=[0,Cu(n)];o.push(s.get(r).next(function(t){return t?nu.resolve():s.put(new Fa(0,Cu(n),i))}))}).next(function(){return nu.vn(o)})})},Da.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.O(),n=t.M();return i.put({collectionId:e,parent:Cu(n)})}}t.createObjectStore(Ga.store,{keyPath:Ga.keyPath});var i=e.store(Ga.store),o=new Aa;return e.store(Ua.store).ro({no:!0},function(t,e){return r(new Pr(t).M())}).next(function(){return e.store(Va.store).ro({no:!0},function(t,e){t[0];var n=t[1];return r((t[2],ju(n)).M())})})},Da.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(qa.store);return o.ro(function(t,e){var n=i.serializer.Go(e),r=i.serializer.zo(n);return o.put(r)})},Da),ka=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Da(t){this.serializer=t}function xa(){this.index={}}function Oa(){this.Va=new Aa}ka.store="owner",ka.key="owner";var Ra=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ra.store="mutationQueues",Ra.keyPath="userId";var Pa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Pa.store="mutations",Pa.keyPath="batchId",Pa.userMutationsIndex="userMutationsIndex",Pa.userMutationsKeyPath=["userId","batchId"];var Va=(La.prefixForUser=function(t){return[t]},La.prefixForPath=function(t,e){return[t,Cu(e)]},La.key=function(t,e,n){return[t,Cu(e),n]},La);function La(){}function Ca(t,e){this.path=t,this.readTime=e}function Ma(t,e){this.path=t,this.version=e}Va.store="documentMutations",Va.PLACEHOLDER=new Va;var Ua=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ua.store="remoteDocuments",Ua.readTimeIndex="readTimeIndex",Ua.readTimeIndexPath="readTime",Ua.collectionReadTimeIndex="collectionReadTimeIndex",Ua.collectionReadTimeIndexPath=["parentPath","readTime"];var ja=function(t){this.byteSize=t};ja.store="remoteDocumentGlobal",ja.key="remoteDocumentGlobalKey";var qa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};qa.store="targets",qa.keyPath="targetId",qa.queryTargetsIndexName="queryTargetsIndex",qa.queryTargetsKeyPath=["canonicalId","targetId"];var Fa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Fa.store="targetDocuments",Fa.keyPath=["targetId","path"],Fa.documentTargetsIndex="documentTargetsIndex",Fa.documentTargetsKeyPath=["path","targetId"];var Ba=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ba.key="targetGlobalKey",Ba.store="targetGlobal";var Ga=function(t,e){this.collectionId=t,this.parent=e};function za(t){t.createObjectStore(Fa.store,{keyPath:Fa.keyPath}).createIndex(Fa.documentTargetsIndex,Fa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(qa.store,{keyPath:qa.keyPath}).createIndex(qa.queryTargetsIndexName,qa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ba.store)}Ga.store="collectionParents",Ga.keyPath=["collectionId","parent"];var Wa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Wa.store="clientMetadata",Wa.keyPath="clientId";var Qa=i(i(i([Ra.store,Pa.store,Va.store,Ua.store,qa.store,ka.store,Ba.store,Fa.store],[Wa.store]),[ja.store]),[Ga.store]),Ka=(Ha.prototype.Io=function(t,e){var n=this;if(this.ga.has(e))return nu.resolve();var r=e.O(),i=e.M();t.qn(function(){n.ga.add(e)});var o={collectionId:r,parent:Cu(i)};return Ya(t).put(o)},Ha.prototype.ir=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Xs(i),""],!1,!0);return Ya(t).eo(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(ju(r.parent))}return o})},Ha);function Ha(){this.ga=new Aa}function Ya(t){return th.Kh(t,Ga.store)}var Xa,$a=(rh.prototype._a=function(t){if(t.document)return this.pa.mi(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Kr.st(t.noDocument.path),n=this.ya(t.noDocument.readTime);return new bo(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Kr.st(t.unknownDocument.path),i=this.ya(t.unknownDocument.version);return new Eo(r,i)}return zs()},rh.prototype.Pa=function(t,e){var n=this.ca(e),r=t.key.path.M().W();if(t instanceof wo){var i=this.pa.Ai(t),o=t.hasCommittedMutations;return new Ua(null,null,i,o,n,r)}if(t instanceof bo){var s=t.key.path.W(),u=this.ba(t.version),a=t.hasCommittedMutations;return new Ua(null,new Ca(s,u),null,a,n,r)}if(t instanceof Eo){var h=t.key.path.W(),c=this.ba(t.version);return new Ua(new Ma(h,c),null,null,!0,n,r)}return zs()},rh.prototype.ca=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},rh.prototype.fa=function(t){var e=new xr(t[0],t[1]);return Or.v(e)},rh.prototype.ba=function(t){var e=t.C();return new Ia(e.seconds,e.nanoseconds)},rh.prototype.ya=function(t){var e=new xr(t.seconds,t.nanoseconds);return Or.v(e)},rh.prototype.Eo=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.pa.vi(t)}),i=e.mutations.map(function(t){return n.pa.vi(t)});return new Pa(t,e.batchId,e.Tn.toMillis(),r,i)},rh.prototype.Ro=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.pa.Fi(t)}),r=t.mutations.map(function(t){return e.pa.Fi(t)}),i=xr.fromMillis(t.localWriteTimeMs);return new tu(t.batchId,i,n,r)},rh.prototype.Go=function(t){var e=this.ya(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?this.ya(t.lastLimboFreeSnapshotVersion):Or.min(),r=void 0!==t.query.documents?this.pa.xi(t.query):this.pa.Wi(t.query);return new Ro(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Jr.fromBase64String(t.resumeToken))},rh.prototype.zo=function(t){var e=this.ba(t.Ee),n=this.ba(t.lastLimboFreeSnapshotVersion),r=t.target.Ot()?this.pa.Oi(t.target):this.pa.Bi(t.target),i=t.resumeToken.toBase64();return new qa(t.targetId,t.target.canonicalId(),e,i,t.sequenceNumber,n,r)},rh),Ja="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Za=(n(nh,Xa=ou),nh),th=(eh.Kh=function(t,e){if(t instanceof Za)return Fu.Kh(t.bo,e);throw zs()},eh.prototype.start=function(){var e=this;return Fu.qh(this.Ma,_a,new Sa(this.serializer)).then(function(t){return e.Ba=t,e.qa()}).then(function(){return e.Ua(),e.Qa(),e.Wa(),e.Ba.runTransaction("readonly",[Ba.store],pa)}).then(function(t){e.ja=new au(t,e.Sa)}).then(function(){e.Da=!0}).catch(function(t){return e.Ba&&e.Ba.close(),Promise.reject(t)})},eh.prototype.Ka=function(n){var t=this;return this.$a=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.vh?[2,n(e)]:[2]})})},n(this.isPrimary)},eh.prototype.Ga=function(n){var t=this;this.Ba.Gh(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},eh.prototype.za=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Tr.$r(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.vh?[4,this.qa()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},eh.prototype.qa=function(){var n=this;return this.Ba.runTransaction("readwrite",Qa,function(e){return oh(e).put(new Wa(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Ha(e).next(function(t){t||(n.isPrimary=!1,n.Tr.$r(function(){return n.$a(!1)}))})}).next(function(){return n.Ya(e)}).next(function(t){return n.isPrimary&&!t?n.Ja(e).next(function(){return!1}):!!t&&n.Xa(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Fs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Tr.$r(function(){return n.$a(t)}),n.isPrimary=t})},eh.prototype.Ha=function(t){var e=this;return ih(t).get(ka.key).next(function(t){return nu.resolve(e.Za(t))})},eh.prototype.tu=function(t){return oh(t).delete(this.clientId)},eh.prototype.eu=function(){return y(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.su(this.ka,18e5)?[3,2]:(this.ka=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=eh.Kh(t,Wa.store);return r.eo().next(function(t){var e=i.iu(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return nu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.nu(t.clientId))}),t.label=2;case 2:return[2]}})})},eh.prototype.Wa=function(){var t=this;this.Na=this.Tr.yr("client_metadata_refresh",4e3,function(){return t.qa().then(function(){return t.eu()}).then(function(){return t.Wa()})})},eh.prototype.Za=function(t){return!!t&&t.ownerId===this.clientId},eh.prototype.Ya=function(e){var i=this;return ih(e).get(ka.key).next(function(t){if(null!==t&&i.su(t.leaseTimestampMs,5e3)&&!i.ru(t.ownerId)){if(i.Za(t)&&i.networkEnabled)return!0;if(!i.Za(t)){if(!t.allowTabSynchronization)throw new Ar(Nr.FAILED_PRECONDITION,Ja);return!1}}return!(!i.networkEnabled||!i.inForeground)||oh(e).eo().next(function(t){return void 0===i.iu(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Fs("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},eh.prototype.hu=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Da=!1,this.ou(),this.Na&&(this.Na.cancel(),this.Na=null),this.au(),this.uu(),[4,this.Ba.runTransaction("readwrite",[ka.store,Wa.store],function(t){return e.Ja(t).next(function(){return e.tu(t)})})];case 1:return t.sent(),this.Ba.close(),this.cu(),[2]}})})},eh.prototype.iu=function(t,e){var n=this;return t.filter(function(t){return n.su(t.updateTimeMs,e)&&!n.ru(t.clientId)})},eh.prototype._u=function(){var e=this;return this.Ba.runTransaction("readonly",[Wa.store],function(t){return oh(t).eo().next(function(t){return e.iu(t,18e5).map(function(t){return t.clientId})})})},eh.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return eh.Uh()?(e=n+eh.La,[4,Fu.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(eh.prototype,"vh",{get:function(){return this.Da},enumerable:!0,configurable:!0}),eh.prototype.lu=function(t){return ta.uo(t,this.serializer,this.jn,this.oo)},eh.prototype.du=function(){return this.Oa},eh.prototype.fu=function(){return this.Qn},eh.prototype.Tu=function(){return this.jn},eh.prototype.runTransaction=function(n,t,r){var i=this;Fs("IndexedDbPersistence","Starting transaction:",n);var o,e="readonly"===t?"readonly":"readwrite";return this.Ba.runTransaction(e,Qa,function(e){return o=new Za(e,i.ja.next()),"readwrite-primary"===t?i.Ha(e).next(function(t){return!!t||i.Ya(e)}).next(function(t){if(!t)throw Bs("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Tr.$r(function(){return i.$a(!1)}),new Ar(Nr.FAILED_PRECONDITION,iu);return r(o)}).next(function(t){return i.Xa(e).next(function(){return t})}):i.Eu(e).next(function(){return r(o)})}).then(function(t){return o.Un(),t})},eh.prototype.Eu=function(t){var e=this;return ih(t).get(ka.key).next(function(t){if(null!==t&&e.su(t.leaseTimestampMs,5e3)&&!e.ru(t.ownerId)&&!e.Za(t)&&!t.allowTabSynchronization)throw new Ar(Nr.FAILED_PRECONDITION,Ja)})},eh.prototype.Xa=function(t){var e=new ka(this.clientId,this.allowTabSynchronization,Date.now());return ih(t).put(ka.key,e)},eh.Uh=function(){return Fu.Uh()},eh.Iu=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},eh.prototype.Ja=function(t){var e=this,n=ih(t);return n.get(ka.key).next(function(t){return e.Za(t)?(Fs("IndexedDbPersistence","Releasing primary lease."),n.delete(ka.key)):nu.resolve()})},eh.prototype.su=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Bs("Detected an update time that is in the future: "+t+" > "+n),1))},eh.prototype.Ua=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fa=function(){t.Tr.$r(function(){return t.inForeground="visible"===t.document.visibilityState,t.qa()})},this.document.addEventListener("visibilitychange",this.Fa),this.inForeground="visible"===this.document.visibilityState)},eh.prototype.au=function(){this.Fa&&(this.document.removeEventListener("visibilitychange",this.Fa),this.Fa=null)},eh.prototype.Qa=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Ca=function(){t.ou(),t.Tr.$r(function(){return t.hu()})},this.window.addEventListener("unload",this.Ca))},eh.prototype.uu=function(){this.Ca&&(this.window.removeEventListener("unload",this.Ca),this.Ca=null)},eh.prototype.ru=function(t){try{var e=null!==this.xa.getItem(this.nu(t));return Fs("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},eh.prototype.ou=function(){try{this.xa.setItem(this.nu(this.clientId),String(Date.now()))}catch(t){Bs("Failed to set zombie client id.",t)}},eh.prototype.cu=function(){try{this.xa.removeItem(this.nu(this.clientId))}catch(t){}},eh.prototype.nu=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},eh);function eh(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Tr=o,this.Sa=u,this.Da=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ca=null,this.inForeground=!1,this.Fa=null,this.Na=null,this.ka=Number.NEGATIVE_INFINITY,this.$a=function(t){return Promise.resolve()},!eh.Uh())throw new Ar(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.oo=new sh(this,i),this.Ma=e+eh.La,this.serializer=new $a(s),this.document=r.document,this.Oa=new aa(this.oo,this.serializer),this.jn=new Ka,this.Qn=new va(this.serializer,this.jn),!r.window||!r.window.localStorage)throw new Ar(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.xa=this.window.localStorage}function nh(t,e){var n=this;return(n=Xa.call(this)||this).bo=t,n.va=e,n}function rh(t){this.pa=t}function ih(t){return t.store(ka.store)}function oh(t){return t.store(Wa.store)}th.La="main";var sh=(uh.prototype.Fh=function(t){var n=this.wu(t);return this.db.du().Ho(t).next(function(e){return n.next(function(t){return e+t})})},uh.prototype.wu=function(t){var e=0;return this.kh(t,function(t){e++}).next(function(){return e})},uh.prototype.js=function(t,e){return this.db.du().js(t,e)},uh.prototype.kh=function(t,n){return this.Ru(t,function(t,e){return n(e)})},uh.prototype.Xo=function(t,e,n){return ah(t,n)},uh.prototype.ta=function(t,e,n){return ah(t,n)},uh.prototype.$h=function(t,e,n){return this.db.du().$h(t,e,n)},uh.prototype.So=ah,uh.prototype.Au=function(t,e){return r=e,i=!1,sa(n=t).ho(function(t){return na(n,t,r).next(function(t){return t&&(i=!0),nu.resolve(!t)})}).next(function(){return i});var n,r,i},uh.prototype.Mh=function(r,i){var o=this,s=this.db.fu().Ea(),u=[],a=0;return this.Ru(r,function(e,t){var n;t<=i&&(n=o.Au(r,e).next(function(t){if(!t)return a++,s.Mn(r,e).next(function(){return s.$n(e),da(r).delete([0,Cu(e.path)])})}),u.push(n))}).next(function(){return nu.vn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},uh.prototype.removeTarget=function(t,e){var n=e.Ie(t.va);return this.db.du().Wo(t,n)},uh.prototype.mu=ah,uh.prototype.Ru=function(t,o){var s,e=da(t),u=au.dr;return e.ro({index:Fa.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==au.dr&&o(new Kr(ju(s)),u),u=i,s=r):u=au.dr}).next(function(){u!==au.dr&&o(new Kr(ju(s)),u)})},uh.prototype.Oh=function(t){return this.db.fu().Ra(t)},uh);function uh(t,e){this.db=t,this.Vh=new Pu(this,e)}function ah(t,e){return da(t).put((n=t.va,new Fa(0,Cu(e.path),n)));var n}var hh=(ch.prototype.start=function(){return Promise.resolve()},ch.prototype.Su=function(i){return y(this,void 0,void 0,function(){var e,m,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Wn,m=this.bu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.Wn.Vo(v).next(function(t){return g=t,e=r.persistence.lu(i),m=new su(r.yu,e,r.persistence.Tu()),e.Vo(v)}).next(function(t){for(var e=[],n=[],r=cs(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Yn(v,r).next(function(t){return{Du:t,Cu:e,Fu:n}})})})];case 1:return n=t.sent(),[2,(this.Wn=e,this.bu=m,this.Pu.vu(this.bu),n)]}})})},ch.prototype.Nu=function(u){var a,h=this,c=xr.now(),t=u.reduce(function(t,e){return t.add(e.key)},cs());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.bu.Yn(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new Fi(i.key,o,io(o.proto.mapValue),Ui.exists(!0)))}return h.Wn.To(s,c,e,u)})}).then(function(t){var e=t.In(a);return{batchId:t.batchId,Dn:e}})},ch.prototype._o=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.yu.Ea({wa:!0});return i.Wn._o(t,r.batch,r.streamToken).next(function(){return i.ku(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Wn.Do(t)}).next(function(){return i.bu.Yn(t,e)})})},ch.prototype.$u=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.Wn.wo(e,t).next(function(t){return Ws(null!==t),n=t.keys(),r.Wn.yo(e,t)}).next(function(){return r.Wn.Do(e)}).next(function(){return r.bu.Yn(e,n)})})},ch.prototype.Po=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Wn.Po(t)})},ch.prototype.do=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.Wn.do(t)})},ch.prototype.fo=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.Wn.fo(t,e)})},ch.prototype.Oo=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Oa.Oo(t)})},ch.prototype.Mu=function(a){var h=this,c=a.Ee,f=this.Vu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.yu.Ea({wa:!0});f=h.Vu;var s=[];a.as.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.Oa.Zo(o,t.Is,e).next(function(){return h.Oa.Jo(o,t.Ts,e)})),0<(n=t.resumeToken).rt()&&(r=i.we(n,c).Ie(o.va),f=f.Ae(e,r),ch.Lu(i,r,t)&&s.push(h.Oa.Wo(o,r))))});var t,u=is,n=cs();return a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof bo&&e.version.isEqual(Or.min())?(i.$n(t,c),u=u.Ae(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Nn(e,c),u=u.Ae(t,e)):Fs("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.oo.mu(o,t))})})),c.isEqual(Or.min())||(t=h.Oa.Oo(o).next(function(t){return h.Oa.Bo(o,o.va,c)}),s.push(t)),nu.vn(s).next(function(){return i.apply(o)}).next(function(){return h.bu.Jn(o,u)})}).then(function(t){return h.Vu=f,t})},ch.Lu=function(t,e,n){return Ws(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Ou||0<n.Ts.size+n.Es.size+n.Is.size},ch.prototype.xu=function(u){var a=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return nu.forEach(u,function(e){return nu.forEach(e.hr,function(t){return a.persistence.oo.Xo(n,e.targetId,t)}).next(function(){return nu.forEach(e.or,function(t){return a.persistence.oo.ta(n,e.targetId,t)})})})}).then(function(){for(var t=0,e=u;t<e.length;t++){var n,r,i,o=e[t],s=o.targetId;o.fromCache||(r=(n=a.Vu.get(s)).Ee,i=n.Re(r),a.Vu=a.Vu.Ae(s,i))}})},ch.prototype.Bu=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Wn.mo(t,e)})},ch.prototype.qu=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.bu.Kn(t,e)})},ch.prototype.Uu=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Oa.Yo(e,r).next(function(t){return t?(n=t,nu.resolve(n)):i.Oa.$o(e).next(function(t){return n=new Ro(r,t,0,e.va),i.Oa.qo(e,n).next(function(){return n})})})}).then(function(t){return null===i.Vu.get(t.targetId)&&(i.Vu=i.Vu.Ae(t.targetId,t),i.gu.set(r,t.targetId)),t})},ch.prototype.Yo=function(t,e){var n=this.gu.get(e);return void 0!==n?nu.resolve(this.Vu.get(n)):this.Oa.Yo(t,e)},ch.prototype.Qu=function(t,e){var n=this,r=this.Vu.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,function(t){return e?nu.resolve():n.persistence.oo.removeTarget(t,r)}).then(function(){n.Vu=n.Vu.remove(t),n.gu.delete(r.target)})},ch.prototype.Wu=function(t,n){var r=this,i=Or.min(),o=cs();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.Yo(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Oa.ea(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Pu.Zn(e,t,n?i:Or.min(),n?o:cs())}).next(function(t){return{documents:t,ju:o}})})},ch.prototype.ku=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=nu.resolve();return n.forEach(function(r){u=u.next(function(){return o.Mn(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Ws(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Nn(e,i.wn)})}),u.next(function(){return e.Wn.yo(t,s)})},ch.prototype.Sh=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Lh(t,n.Vu)})},ch);function ch(t,e,n){this.persistence=t,this.Pu=e,this.Vu=new Yo(Hs),this.gu=new Zs(function(t){return t.canonicalId()}),this.pu=Or.min(),this.Wn=t.lu(n),this.yu=t.fu(),this.Oa=t.du(),this.bu=new su(this.yu,this.Wn,this.persistence.Tu()),this.Pu.vu(this.bu)}hh.Ou=3e8;var fh,lh=(n(ph,fh=hh),ph.prototype.start=function(){return this.Ku()},ph.prototype.Gu=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.Wn.Ao(e,t).next(function(t){return t?n.bu.Yn(e,t):nu.resolve(null)})})},ph.prototype.zu=function(t){this.Wn.vo(t)},ph.prototype.za=function(t){this.persistence.za(t)},ph.prototype._u=function(){return this.persistence._u()},ph.prototype.Hu=function(e){var n=this,t=this.Vu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.Oa.si(t,e).next(function(t){return t?t.target:null})})},ph.prototype.la=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.yu.la(t,r.pu)}).then(function(t){var e=t.da,n=t.readTime;return r.pu=n,e})},ph.prototype.Ku=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.yu.Ta(t)})];case 1:return e.pu=t.sent(),[2]}})})},ph);function ph(t,e,n){var r=this;return(r=fh.call(this,t,e,n)||this).persistence=t,r.Wn=t.lu(n),r.yu=t.fu(),r.Oa=t.du(),r}function dh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Nr.FAILED_PRECONDITION||e.message!==iu)throw e;return Fs("LocalStore","Unexpectedly lost primary lease"),[2]})})}var yh=(mh.prototype.B=function(){return this.Yu.B()},mh.prototype.Xo=function(t,e){var n=new vh(t,e);this.Yu=this.Yu.add(n),this.Xu=this.Xu.add(n)},mh.prototype.tc=function(t,e){var n=this;t.forEach(function(t){return n.Xo(t,e)})},mh.prototype.ta=function(t,e){this.ec(new vh(t,e))},mh.prototype.sc=function(t,e){var n=this;t.forEach(function(t){return n.ta(t,e)})},mh.prototype.ic=function(t){var e=this,n=Kr.EMPTY,r=new vh(n,t),i=new vh(n,t+1),o=[];return this.Xu.Ke([r,i],function(t){e.ec(t),o.push(t.key)}),o},mh.prototype.nc=function(){var e=this;this.Yu.forEach(function(t){return e.ec(t)})},mh.prototype.ec=function(t){this.Yu=this.Yu.delete(t),this.Xu=this.Xu.delete(t)},mh.prototype.rc=function(t){var e=Kr.EMPTY,n=new vh(e,t),r=new vh(e,t+1),i=cs();return this.Xu.Ke([n,r],function(t){i=i.add(t.key)}),i},mh.prototype.Co=function(t){var e=new vh(t,0),n=this.Yu.ze(e);return null!==n&&t.isEqual(n.key)},mh),vh=(gh.Ju=function(t,e){return Kr.N(t.key,e.key)||Hs(t.hc,e.hc)},gh.Zu=function(t,e){return Hs(t.hc,e.hc)||Kr.N(t.key,e.key)},gh);function gh(t,e){this.key=t,this.hc=e}function mh(){this.Yu=new ns(vh.Ju),this.Xu=new ns(vh.Zu)}function wh(t,e){if(0!==e.length)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ch(e.length,"argument")+".")}function bh(t,e,n){if(e.length!==n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires "+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function Eh(t,e,n){if(e.length<n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function Th(t,e,n,r){if(e.length<n||e.length>r)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ch(e.length,"argument")+".")}function Ih(t,e,n,r){kh(t,e,Lh(n)+" argument",r)}function Nh(t,e,n,r){void 0!==r&&Ih(t,e,n,r)}function Ah(t,e,n,r){kh(t,e,n+" option",r)}function _h(t,e,n,r){void 0!==r&&Ah(t,e,n,r)}function Sh(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(xh(s))}var u=xh(n);throw new Ar(Nr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function kh(t,e,n,r){if(!("object"===e?Dh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=xh(r);throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Dh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function xh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":zs();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Oh(t,e,n){if(void 0===n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Lh(e)+" argument, but it was undefined.")}function Rh(n,t,r){Xr(t,function(t,e){if(r.indexOf(t)<0)throw new Ar(Nr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Ph(t,e,n,r){var i=xh(r);return new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Lh(n)+" argument to be a "+e+", but it was: "+i)}function Vh(t,e,n){if(n<=0)throw new Ar(Nr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Lh(e)+" argument to be a positive number, but it was: "+n+".")}function Lh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ch(t,e){return t+" "+e+(1===t?"":"s")}function Mh(){if("undefined"==typeof Uint8Array)throw new Ar(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Uh(){if(!Cs.nt().oc)throw new Ar(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var jh=(Bh.fromBase64String=function(t){bh("Blob.fromBase64String",arguments,1),Ih("Blob.fromBase64String","string",1,t),Uh();try{return new Bh(Jr.fromBase64String(t))}catch(t){throw new Ar(Nr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Bh.fromUint8Array=function(t){if(bh("Blob.fromUint8Array",arguments,1),Mh(),!(t instanceof Uint8Array))throw Ph("Blob.fromUint8Array","Uint8Array",1,t);return new Bh(Jr.fromUint8Array(t))},Bh.prototype.toBase64=function(){return bh("Blob.toBase64",arguments,0),Uh(),this.ac.toBase64()},Bh.prototype.toUint8Array=function(){return bh("Blob.toUint8Array",arguments,0),Mh(),this.ac.toUint8Array()},Bh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Bh.prototype.isEqual=function(t){return this.ac.isEqual(t.ac)},Bh),qh=(Fh.documentId=function(){return Fh.cc},Fh.prototype.isEqual=function(t){if(!(t instanceof Fh))throw Ph("isEqual","FieldPath",1,t);return this.uc.isEqual(t.uc)},Fh);function Fh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new Ar(Nr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(Ih("FieldPath","string",n,t[n]),0===t[n].length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.uc=new Wr(t)}function Bh(t){Uh(),this.ac=t}qh.cc=new qh(Wr.J().j());var Gh,zh,Wh,Qh,Kh,Hh=new RegExp("[~\\*/\\[\\]]"),Yh=function(t){this._c=t},Xh=(n(lc,Kh=Yh),lc.prototype.Di=function(t){if(2!==t.lc)throw 1===t.lc?t.dc("FieldValue.delete() can only appear at the top level of your update data"):t.dc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},lc.prototype.isEqual=function(t){return t instanceof lc},lc),$h=(n(fc,Qh=Yh),fc.prototype.Di=function(t){return new Mi(t.path,Ei.instance)},fc.prototype.isEqual=function(t){return t instanceof fc},fc),Jh=(n(cc,Wh=Yh),cc.prototype.Di=function(t){var e=new dc({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map(function(t){return mc(t,e)}),r=new Ii(n);return new Mi(t.path,r)},cc.prototype.isEqual=function(t){return this===t},cc),Zh=(n(hc,zh=Yh),hc.prototype.Di=function(t){var e=new dc({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map(function(t){return mc(t,e)}),r=new Ni(n);return new Mi(t.path,r)},hc.prototype.isEqual=function(t){return this===t},hc),tc=(n(ac,Gh=Yh),ac.prototype.Di=function(t){var e=new dc({lc:3,methodName:this._c},t.ii,t.serializer),n=mc(this.Ec,e),r=new Ai(t.serializer,n);return new Mi(t.path,r)},ac.prototype.isEqual=function(t){return this===t},ac),ec=(Object.defineProperty(uc.prototype,"latitude",{get:function(){return this.Ic},enumerable:!0,configurable:!0}),Object.defineProperty(uc.prototype,"longitude",{get:function(){return this.wc},enumerable:!0,configurable:!0}),uc.prototype.isEqual=function(t){return this.Ic===t.Ic&&this.wc===t.wc},uc.prototype.p=function(t){return Hs(this.Ic,t.Ic)||Hs(this.wc,t.wc)},uc),nc=/^__.*__$/,rc=(sc.prototype.Rc=function(t,e){var n=[];return null!==this.Vt?n.push(new Fi(t,this.data,this.Vt,e)):n.push(new qi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},sc),ic=(oc.prototype.Rc=function(t,e){var n=[new Fi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},oc);function oc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function sc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function uc(t,e){if(bh("GeoPoint",arguments,2),Ih("GeoPoint","number",1,t),Ih("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Ar(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Ar(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ic=t,this.wc=e}function ac(t){var e=this;return(e=Gh.call(this,"FieldValue.increment")||this).Ec=t,e}function hc(t){var e=this;return(e=zh.call(this,"FieldValue.arrayRemove")||this).fc=t,e}function cc(t){var e=this;return(e=Wh.call(this,"FieldValue.arrayUnion")||this).fc=t,e}function fc(){return Qh.call(this,"FieldValue.serverTimestamp")||this}function lc(){return Kh.call(this,"FieldValue.delete")||this}function pc(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw zs()}}var dc=(Object.defineProperty(gc.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(gc.prototype,"lc",{get:function(){return this.settings.lc},enumerable:!0,configurable:!0}),gc.prototype.mc=function(t){return new gc(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.fieldTransforms,this.Vt)},gc.prototype.Pc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mc({path:n,Tc:!1});return r.Vc(t),r},gc.prototype.gc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mc({path:n,Tc:!1});return r.Ac(),r},gc.prototype.pc=function(t){return this.mc({path:void 0,Tc:!0})},gc.prototype.dc=function(t){var e=!this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new Ar(Nr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},gc.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},gc.prototype.Ac=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Vc(this.path.get(t))},gc.prototype.Vc=function(t){if(0===t.length)throw this.dc("Document fields must not be empty");if(pc(this.lc)&&nc.test(t))throw this.dc('Document fields cannot begin and end with "__"')},gc),yc=(vc.prototype.bc=function(t,e){var n=this.vc(0,t);Ec("Data must be an object, but it was:",n,e);var r=wc(e,n);return new rc(new Wi(r),null,n.fieldTransforms)},vc.prototype.Sc=function(t,e,n){var r=this.vc(2,t);Ec("Data must be an object, but it was:",r,e);var i,o,s=wc(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof qh)f=c.uc;else{if("string"!=typeof c)throw zs();f=Ic(t,c)}if(!r.contains(f))throw new Ar(Nr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Nc(u,f)||u.push(f)}i=new Ci(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=new Ci(r.Vt),o=r.fieldTransforms;return new rc(new Wi(s),i,o)},vc.prototype.Dc=function(o,t){var s=this.vc(1,o);Ec("Data must be an object, but it was:",s,t);var u=[],a=new Qi;Xr(t,function(t,e){var n,r=Ic(o,t),i=s.gc(r);e instanceof Xh?u.push(r):null!=(n=mc(e,i))&&(u.push(r),a.set(r,n))});var e=new Ci(u);return new ic(a.yt(),e,s.fieldTransforms)},vc.prototype.Cc=function(t,e,n,r){var i=this.vc(1,t),o=[Tc(t,e)],s=[n];if(r.length%2!=0)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Tc(t,r[u])),s.push(r[u+1]);for(var a,h,c,f,l=[],p=new Qi,d=o.length-1;0<=d;--d){Nc(l,o[d])||(a=o[d],h=s[d],c=i.gc(a),h instanceof Xh?l.push(a):null!=(f=mc(h,c))&&(l.push(a),p.set(a,f)))}var y=new Ci(l);return new ic(p.yt(),y,i.fieldTransforms)},vc.prototype.vc=function(t,e){return new dc({lc:t,methodName:e,path:Wr.G,Tc:!1},this.ii,this.serializer)},vc.prototype.Fc=function(t,e,n){return void 0===n&&(n=!1),mc(e,this.vc(n?4:3,t))},vc);function vc(t,e){this.ii=t,this.serializer=e||Cs.nt().yc(t)}function gc(t,e,n,r,i){this.settings=t,this.ii=e,this.serializer=n,void 0===r&&this.Ac(),this.fieldTransforms=r||[],this.Vt=i||[]}function mc(s,t){if(bc(s))return Ec("Unsupported field value:",t,s),wc(s,t);if(s instanceof Yh)return function(t,e){if(!pc(e.lc))throw e.dc(t._c+"() can only be used with update() and set()");if(null===e.path)throw e.dc(t._c+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.Tc&&4!==t.lc)throw t.dc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=mc(i[r],t.pc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=xr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof xr){var r=new xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof ec)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof jh)return{bytesValue:e.serializer.ui(t)};if(t instanceof ol){var i=e.ii,o=t.firestore.Nc;if(!o.isEqual(i))throw e.dc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.kc.path,t.firestore.Nc)}}throw e.dc("Unsupported field value: "+xh(t))}(s,t)}function wc(t,r){var i={};return $r(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):Xr(t,function(t,e){var n=mc(e,r.Pc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function bc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof xr||t instanceof ec||t instanceof jh||t instanceof ol||t instanceof Yh)}function Ec(t,e,n){if(!bc(n)||!Dh(n)){var r=xh(n);throw"an object"===r?e.dc(t+" a custom object"):e.dc(t+" "+r)}}function Tc(t,e){if(e instanceof qh)return e.uc;if("string"==typeof e)return Ic(t,e);throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Ic(t,e){try{return function(e){if(0<=e.search(Hh))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(qh.bind.apply(qh,i([void 0],e.split("."))))}catch(t){throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).uc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Nc(t,e){return t.some(function(t){return t.isEqual(e)})}var Ac,_c,Sc,kc=(Fc.prototype.Bc=function(){return 1===this.state||2===this.state||4===this.state},Fc.prototype.qc=function(){return 2===this.state},Fc.prototype.start=function(){3!==this.state?this.auth():this.Uc()},Fc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Bc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Fc.prototype.Qc=function(){this.state=0,this.Qr.reset()},Fc.prototype.Wc=function(){var t=this;this.qc()&&null===this.xc&&(this.xc=this.Tr.yr(this.$c,6e4,function(){return t.jc()}))},Fc.prototype.Kc=function(t){this.Gc(),this.stream.send(t)},Fc.prototype.jc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.qc()?[2,this.close(0)]:[2]})})},Fc.prototype.Gc=function(){this.xc&&(this.xc.cancel(),this.xc=null)},Fc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Gc(),this.Qr.cancel(),this.Oc++,3!==e?this.Qr.reset():n&&n.code===Nr.RESOURCE_EXHAUSTED?(Bs(n.toString()),Bs("Using maximum backoff delay to prevent overloading the backend."),this.Qr.Vr()):n&&n.code===Nr.UNAUTHENTICATED&&this.Lc._(),null!==this.stream&&(this.zc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Hc(n)];case 1:return t.sent(),[2]}})})},Fc.prototype.zc=function(){},Fc.prototype.auth=function(){var n=this;this.state=1;var t=this.Yc(this.Oc),e=this.Oc;this.Lc.getToken().then(function(t){n.Oc===e&&n.Jc(t)},function(e){t(function(){var t=new Ar(Nr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Xc(t)})})},Fc.prototype.Jc=function(t){var e=this,n=this.Yc(this.Oc);this.stream=this.Zc(t),this.stream.t_(function(){n(function(){return e.state=2,e.listener.t_()})}),this.stream.Hc(function(t){n(function(){return e.Xc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Fc.prototype.Uc=function(){var t=this;this.state=4,this.Qr.gr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Fc.prototype.Xc=function(t){return Fs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Fc.prototype.Yc=function(e){var n=this;return function(t){n.Tr.$r(function(){return n.Oc===e?t():(Fs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Fc),Dc=(n(qc,Sc=kc),qc.prototype.Zc=function(t){return this.Mc.e_("Listen",t)},qc.prototype.onMessage=function(t){this.Qr.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.s_(e,n)},qc.prototype.i_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Kc(e)},qc.prototype.n_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Kc(e)},qc),xc=(n(jc,_c=kc),Object.defineProperty(jc.prototype,"h_",{get:function(){return this.r_},enumerable:!0,configurable:!0}),jc.prototype.start=function(){this.r_=!1,_c.prototype.start.call(this)},jc.prototype.zc=function(){this.r_&&this.o_([])},jc.prototype.Zc=function(t){return this.Mc.e_("Write",t)},jc.prototype.onMessage=function(t){if(Ws(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.r_){this.Qr.reset();var e=this.serializer.Li(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.a_(n,e)}return Ws(!t.writeResults||0===t.writeResults.length),this.r_=!0,this.listener.u_()},jc.prototype.c_=function(){var t={};t.database=this.serializer.wi,this.Kc(t)},jc.prototype.o_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.Kc(n)},jc),Oc=(n(Uc,Ac=function(){this.__=void 0}),Uc.prototype.l_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.l_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},Uc.prototype.d_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.d_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},Uc),Rc=(Mc.prototype.R_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.A_(),0<this.mutations.length)throw new Ar(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e={database:(n=s).serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.d_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Ws(!!e),o.push(e)}),o)]}})})}(this.f_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof bo||t instanceof wo?n.m_(t):zs()}),e)]}})})},Mc.prototype.set=function(t,e){this.write(e.Rc(t,this.Rt(t))),this.w_.add(t)},Mc.prototype.update=function(t,e){try{this.write(e.Rc(t,this.P_(t)))}catch(t){this.I_=t}this.w_.add(t)},Mc.prototype.delete=function(t){this.write([new Gi(t,this.Rt(t))]),this.w_.add(t)},Mc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.A_(),this.I_)throw this.I_;return e=this.T_,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new zi(t,n.Rt(t)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n={database:(e=i).serializer.wi,writes:o.map(function(t){return e.serializer.vi(t)})},[4,e.l_("Commit",n)];case 1:return r=t.sent(),[2,e.serializer.Li(r.writeResults,r.commitTime)]}})})}(this.f_,this.mutations)];case 1:return t.sent(),this.E_=!0,[2]}})})},Mc.prototype.m_=function(t){var e;if(t instanceof wo)e=t.version;else{if(!(t instanceof bo))throw zs();e=Or.min()}var n=this.T_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Ar(Nr.ABORTED,"Document version changed between two reads.")}else this.T_=this.T_.Ae(t.key,e)},Mc.prototype.Rt=function(t){var e=this.T_.get(t);return!this.w_.has(t)&&e?Ui.updateTime(e):Ui.ft()},Mc.prototype.P_=function(t){var e=this.T_.get(t);if(this.w_.has(t)||!e)return Ui.exists(!0);if(e.isEqual(Or.min()))throw new Ar(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ui.updateTime(e)},Mc.prototype.write=function(t){this.A_(),this.mutations=this.mutations.concat(t)},Mc.prototype.A_=function(){},Mc),Pc=(Cc.prototype.b_=function(){var t=this;0===this.g_&&(this.v_("Unknown"),this.p_=this.br.yr("online_state_timeout",1e4,function(){return t.p_=null,t.S_("Backend didn't respond within 10 seconds."),t.v_("Offline"),Promise.resolve()}))},Cc.prototype.D_=function(t){"Online"===this.state?this.v_("Unknown"):(this.g_++,1<=this.g_&&(this.C_(),this.S_("Connection failed 1 times. Most recent error: "+t.toString()),this.v_("Offline")))},Cc.prototype.set=function(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.v_(t)},Cc.prototype.v_=function(t){t!==this.state&&(this.state=t,this.V_(t))},Cc.prototype.S_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.y_?(Bs(e),this.y_=!1):Fs("OnlineStateTracker",e)},Cc.prototype.C_=function(){null!==this.p_&&(this.p_.cancel(),this.p_=null)},Cc),Vc=(Lc.prototype.start=function(){return this.enableNetwork()},Lc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.J_()},Lc.prototype.J_=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.B_()?(e=this.G_,[4,this.F_.do()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.X_()?this.Z_():this.U_.set("Unknown"),[4,this.tl()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Lc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),[2]}})})},Lc.prototype.el=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.G_.stop()];case 1:return t.sent(),[4,this.Q_.stop()];case 2:return t.sent(),0<this.N_.length&&(Fs("RemoteStore","Stopping write stream with "+this.N_.length+" pending writes"),this.N_=[]),this.sl(),[2]}})})},Lc.prototype.hu=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.O_.hu(),this.U_.set("Unknown"),[2]}})})},Lc.prototype.listen=function(t){this.k_.has(t.targetId)||(this.k_.set(t.targetId,t),this.X_()?this.Z_():this.Q_.qc()&&this.il(t))},Lc.prototype.nl=function(t){this.k_.delete(t),this.Q_.qc()&&this.rl(t),0===this.k_.size&&(this.Q_.qc()?this.Q_.Wc():this.B_()&&this.U_.set("Unknown"))},Lc.prototype.si=function(t){return this.k_.get(t)||null},Lc.prototype.ei=function(t){return this.hl.ei(t)},Lc.prototype.il=function(t){this.M_.Ns(t.targetId),this.Q_.i_(t)},Lc.prototype.rl=function(t){this.M_.Ns(t),this.Q_.n_(t)},Lc.prototype.Z_=function(){this.M_=new Es(this),this.Q_.start(),this.U_.b_()},Lc.prototype.X_=function(){return this.B_()&&!this.Q_.Bc()&&0<this.k_.size},Lc.prototype.B_=function(){return!this.L_&&this.isPrimary&&this.networkEnabled},Lc.prototype.sl=function(){this.M_=null},Lc.prototype.W_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.k_.forEach(function(t,e){n.il(t)}),[2]})})},Lc.prototype.j_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.sl(),this.X_()?(this.U_.D_(e),this.Z_()):this.U_.set("Unknown"),[2]})})},Lc.prototype.K_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.U_.set("Online"),!(i instanceof ds&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.ol(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Fs("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.al(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof ls?this.M_.qs(i):i instanceof ps?this.M_.Hs(i):this.M_.Ws(i),o.isEqual(Or.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.F_.Oo()];case 8:return n=t.sent(),0<=o.S(n)?[4,this.ul(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Fs("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.al(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Lc.prototype.al=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if("IndexedDbTransactionError"!==n.name)throw n;return this.L_=!0,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),this.br.Xr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","Retrying IndexedDB access"),[4,this.F_.Oo()];case 1:return t.sent(),this.L_=!1,[4,this.J_()];case 2:return t.sent(),[2]}})})}),[2]}})})},Lc.prototype.ul=function(r){var i=this,t=this.M_.Xs(r);return t.as.forEach(function(t,e){var n;0<t.resumeToken.rt()&&((n=i.k_.get(e))&&i.k_.set(e,n.we(t.resumeToken,r)))}),t.us.forEach(function(t){var e,n=i.k_.get(t);n&&(i.k_.set(t,n.we(Jr.ht,n.Ee)),i.rl(t),e=new Ro(n.target,t,1,n.sequenceNumber),i.il(e))}),this.hl.Mu(t)},Lc.prototype.ol=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.k_.has(i)?[4,this.hl.cl(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.k_.delete(i),this.M_.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Lc.prototype.tl=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this._l()?(e=0<this.N_.length?this.N_[this.N_.length-1].batchId:-1,[4,this.F_.Bu(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.N_.length&&this.G_.Wc(),[3,4]);case 2:return this.ll(n),[4,this.tl()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.dl()&&this.fl(),[2]}})})},Lc.prototype._l=function(){return this.B_()&&this.N_.length<10},Lc.prototype.Tl=function(){return this.N_.length},Lc.prototype.ll=function(t){this.N_.push(t),this.G_.qc()&&this.G_.h_&&this.G_.o_(t.mutations)},Lc.prototype.dl=function(){return this.B_()&&!this.G_.Bc()&&0<this.N_.length},Lc.prototype.fl=function(){this.G_.start()},Lc.prototype.z_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.G_.c_(),[2]})})},Lc.prototype.Y_=function(){var r=this;return this.F_.fo(this.G_.lastStreamToken).then(function(){for(var t=0,e=r.N_;t<e.length;t++){var n=e[t];r.G_.o_(n.mutations)}}).catch(dh)},Lc.prototype.a_=function(t,e){var n=this,r=this.N_.shift(),i=eu.from(r,t,e,this.G_.lastStreamToken);return this.hl.El(i).then(function(){return n.tl()})},Lc.prototype.H_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&0<this.N_.length?this.G_.h_?[4,this.Il(e)]:[3,2]:[3,5];case 1:return t.sent(),[3,4];case 2:return[4,this.wl(e)];case 3:t.sent(),t.label=4;case 4:this.dl()&&this.fl(),t.label=5;case 5:return[2]}})})},Lc.prototype.wl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Ko(e.code)?[2,(Fs("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.G_.lastStreamToken),this.G_.lastStreamToken=Jr.ht,this.F_.fo(Jr.ht).catch(dh))]:[2]})})},Lc.prototype.Il=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Ko(n=i.code)&&n!==Nr.ABORTED?(e=this.N_.shift(),[2,(this.G_.Qc(),this.hl.Rl(e.batchId,i).then(function(){return r.tl()}))]):[2]})})},Lc.prototype.Al=function(){return new Rc(this.f_)},Lc.prototype.q_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Lc.prototype.ml=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.B_()?(Fs("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Lc.prototype.Pl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.el()];case 3:t.sent(),this.U_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Lc);function Lc(t,e,n,r,i){var o,s,u,a,h,c,f=this;this.F_=t,this.f_=e,this.br=n,this.N_=[],this.k_=new Map,this.M_=null,this.networkEnabled=!1,this.isPrimary=!1,this.L_=!1,this.O_=i,this.O_.x_(function(t){n.$r(function(){return y(f,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.B_()?(Fs("RemoteStore","Restarting streams for network reachability change."),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.U_=new Pc(n,r),this.Q_=(a=this.f_,h=n,c={t_:this.W_.bind(this),Hc:this.j_.bind(this),s_:this.K_.bind(this)},new Dc(h,a.Mc,a.credentials,a.serializer,c)),this.G_=(o=this.f_,s=n,u={t_:this.z_.bind(this),Hc:this.H_.bind(this),u_:this.Y_.bind(this),a_:this.a_.bind(this)},new xc(s,o.Mc,o.credentials,o.serializer,u))}function Cc(t,e){this.br=t,this.V_=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}function Mc(t){this.f_=t,this.T_=as,this.mutations=[],this.E_=!1,this.I_=null,this.w_=new Set}function Uc(t,e,n){var r=this;return(r=Ac.call(this)||this).Mc=t,r.credentials=e,r.serializer=n,r}function jc(t,e,n,r,i){var o=this;return(o=_c.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.r_=!1,o.lastStreamToken=Jr.ht,o}function qc(t,e,n,r,i){var o=this;return(o=Sc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Fc(t,e,n,r,i,o){this.Tr=t,this.$c=n,this.Mc=r,this.Lc=i,this.listener=o,this.state=0,this.Oc=0,this.xc=null,this.stream=null,this.Qr=new bu(t,e)}function Bc(t,e){return"firestore_clients_"+t+"_"+e}function Gc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function zc(t,e){return"firestore_targets_"+t+"_"+e}function Wc(t){this.key=t}function Qc(t){this.key=t}function Kc(t,e,n){this.query=t,this.targetId=e,this.view=n}function Hc(t){this.key=t,this.Bd=!1}function Yc(){this.Pf=void 0,this.Vf=[]}var Xc,$c,Jc=(xf.Vl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Ar(r.error.code,r.error.message)),i?new xf(t,e,r.state,o):(Bs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},xf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},xf),Zc=(Df.Vl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Ar(n.error.code,n.error.message)),r?new Df(t,n.state,i):(Bs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Df.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Df),tf=(kf.Vl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fs,o=0;r&&o<n.activeTargetIds.length;++o)r=ni(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new kf(t,i):(Bs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},kf),ef=(Sf.Vl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Sf(e.clientId,e.onlineState):(Bs("SharedClientState","Failed to parse online state: "+t),null)},Sf),nf=(_f.prototype.pl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},_f.prototype.yl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},_f.prototype.gl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},_f),rf=(Af.Uh=function(t){return!(!t.window||null==t.window.localStorage)},Af.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.hl._u()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.bl&&(o=this.getItem(Bc(this.persistenceKey,i)))&&(s=tf.Vl(i,o))&&(this.Dl=this.Dl.Ae(s.clientId,s));for(this.Ol(),(u=this.storage.getItem(this.Ll))&&(a=this.xl(u))&&this.Bl(a),h=0,c=this.Cl;h<c.length;h++)f=c[h],this.Sl(f);return this.Cl=[],this.platform.window.addEventListener("unload",function(){return l.hu()}),this.vh=!0,[2]}})})},Af.prototype.lr=function(t){this.setItem(this.Nl,JSON.stringify(t))},Af.prototype.ql=function(){return this.Ul(this.Dl)},Af.prototype.Ql=function(n){var r=!1;return this.Dl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Af.prototype.Wl=function(t){this.jl(t,"pending")},Af.prototype.Kl=function(t,e,n){this.jl(t,e,n),this.Gl(t)},Af.prototype.zl=function(t){var e,n,r="not-current";return this.Ql(t)&&(!(e=this.storage.getItem(zc(this.persistenceKey,t)))||(n=Zc.Vl(t,e))&&(r=n.state)),this.Hl.pl(t),this.Ol(),r},Af.prototype.Yl=function(t){this.Hl.yl(t),this.Ol()},Af.prototype.Jl=function(t){return this.Hl.activeTargetIds.has(t)},Af.prototype.Xl=function(t){this.removeItem(zc(this.persistenceKey,t))},Af.prototype.Zl=function(t,e,n){this.td(t,e,n)},Af.prototype.Su=function(t,e,n){var r=this;e.forEach(function(t){r.Gl(t)}),this.currentUser=t,n.forEach(function(t){r.Wl(t)})},Af.prototype.ed=function(t){this.sd(t)},Af.prototype.hu=function(){this.vh&&(this.platform.window.removeEventListener("storage",this.vl),this.removeItem(this.Fl),this.vh=!1)},Af.prototype.getItem=function(t){var e=this.storage.getItem(t);return Fs("SharedClientState","READ",t,e),e},Af.prototype.setItem=function(t,e){Fs("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Af.prototype.removeItem=function(t){Fs("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Af.prototype.Sl=function(u){var t=this;if(u.storageArea===this.storage){if(Fs("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Fl)return void Bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Tr.Xr(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.vh){if(null!==u.key)if(this.kl.test(u.key)){if(null==u.newValue)return e=this.nd(u.key),[2,this.rd(e,null)];if(n=this.hd(u.key,u.newValue))return[2,this.rd(n.clientId,n)]}else if(this.$l.test(u.key)){if(null!==u.newValue&&(r=this.od(u.key,u.newValue)))return[2,this.ad(r)]}else if(this.Ml.test(u.key)){if(null!==u.newValue&&(i=this.ud(u.key,u.newValue)))return[2,this._d(i)]}else if(u.key===this.Ll){if(null!==u.newValue&&(o=this.xl(u.newValue)))return[2,this.Bl(o)]}else u.key===this.Nl&&(s=function(t){var e=au.dr;if(null!=t)try{var n=JSON.parse(t);Ws("number"==typeof n),e=n}catch(t){Bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==au.dr&&this.ur(s)}else this.Cl.push(u);return[2]})})})}},Object.defineProperty(Af.prototype,"Hl",{get:function(){return this.Dl.get(this.bl)},enumerable:!0,configurable:!0}),Af.prototype.Ol=function(){this.setItem(this.Fl,this.Hl.gl())},Af.prototype.jl=function(t,e,n){var r=new Jc(this.currentUser,t,e,n),i=Gc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gl())},Af.prototype.Gl=function(t){var e=Gc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Af.prototype.sd=function(t){var e={clientId:this.bl,onlineState:t};this.storage.setItem(this.Ll,JSON.stringify(e))},Af.prototype.td=function(t,e,n){var r=zc(this.persistenceKey,t),i=new Zc(t,e,n);this.setItem(r,i.gl())},Af.prototype.nd=function(t){var e=this.kl.exec(t);return e?e[1]:null},Af.prototype.hd=function(t,e){var n=this.nd(t);return tf.Vl(n,e)},Af.prototype.od=function(t,e){var n=this.$l.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Jc.Vl(new wr(i),r,e)},Af.prototype.ud=function(t,e){var n=this.Ml.exec(t),r=Number(n[1]);return Zc.Vl(r,e)},Af.prototype.xl=function(t){return ef.Vl(t)},Af.prototype.ad=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.hl.ld(e.batchId,e.state,e.error)]:(Fs("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Af.prototype._d=function(t){return this.hl.dd(t.targetId,t.state,t.error)},Af.prototype.rd=function(t,e){var n=this,r=e?this.Dl.Ae(t,e):this.Dl.remove(t),i=this.Ul(this.Dl),o=this.Ul(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.hl.fd(s,u).then(function(){n.Dl=r})},Af.prototype.Bl=function(t){this.Dl.get(t.clientId)&&this.V_(t.onlineState)},Af.prototype.Ul=function(t){var n=fs;return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},Af),of=(Nf.prototype.Wl=function(t){},Nf.prototype.Kl=function(t,e,n){},Nf.prototype.zl=function(t){return this.Td.pl(t),this.Ed[t]||"not-current"},Nf.prototype.Zl=function(t,e,n){this.Ed[t]=e},Nf.prototype.Yl=function(t){this.Td.yl(t)},Nf.prototype.Jl=function(t){return this.Td.activeTargetIds.has(t)},Nf.prototype.Xl=function(t){delete this.Ed[t]},Nf.prototype.ql=function(){return this.Td.activeTargetIds},Nf.prototype.Ql=function(t){return this.Td.activeTargetIds.has(t)},Nf.prototype.start=function(){return this.Td=new nf,Promise.resolve()},Nf.prototype.Su=function(t,e,n){},Nf.prototype.ed=function(t){},Nf.prototype.hu=function(){},Nf.prototype.lr=function(t){},Nf),sf=(Object.defineProperty(If.prototype,"md",{get:function(){return this.Id},enumerable:!0,configurable:!0}),If.prototype.Pd=function(t,e){var u=this,a=e?e.Vd:new vs,h=e?e.Ad:this.Ad,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=(r=e instanceof wo?e:null)&&(u.query.matches(r)?r:null),i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.gd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{Ad:f,Vd:a,pd:l,ns:c}},If.prototype.gd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},If.prototype.xn=function(t,e,n){var o=this,r=this.Ad;this.Ad=t.Ad,this.ns=t.ns;var i=t.Vd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zs()}}var r,i}),this.yd(n);var s=e?this.bd():[],u=0===this.Rd.size&&this.fs?1:0,a=u!==this.wd;return this.wd=u,0!==i.length||a?{snapshot:new gs(this.query,t.Ad,r,i,t.ns,0==u,a,!1),vd:s}:{vd:s}},If.prototype.Sd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.xn({Ad:this.Ad,Vd:new vs,ns:this.ns,pd:!1},!1)):{vd:[]}},If.prototype.Dd=function(t){return!this.Id.has(t)&&!!this.Ad.has(t)&&!this.Ad.get(t).At},If.prototype.yd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.Id=e.Id.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.Id=e.Id.delete(t)}),this.fs=t.fs)},If.prototype.bd=function(){var e=this;if(!this.fs)return[];var n=this.Rd;this.Rd=cs(),this.Ad.forEach(function(t){e.Dd(t.key)&&(e.Rd=e.Rd.add(t.key))});var r=[];return n.forEach(function(t){e.Rd.has(t)||r.push(new Qc(t))}),this.Rd.forEach(function(t){n.has(t)||r.push(new Wc(t))}),r},If.prototype.Cd=function(t){this.Id=t.ju,this.Rd=cs();var e=this.Pd(t.documents);return this.xn(e,!0)},If.prototype.Fd=function(){return gs.os(this.query,this.Ad,this.ns,0===this.wd)},If),uf=(Tf.prototype.$d=function(){this.Md()},Tf.prototype.Md=function(){var t=this;this.Qr.gr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.Nd.Al(),(n=this.Ld(e))&&n.then(function(t){r.br.$r(function(){return e.commit().then(function(){r.Dr.resolve(t)}).catch(function(t){r.Od(t)})})}).catch(function(t){r.Od(t)}),[2]})})})},Tf.prototype.Ld=function(t){try{var e=this.updateFunction(t);return!ti(e)&&e.catch&&e.then?e:(this.Dr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Dr.reject(t),null}},Tf.prototype.Od=function(t){var e=this;0<this.kd&&this.xd(t)?(--this.kd,this.br.$r(function(){return e.Md(),Promise.resolve()})):this.Dr.reject(t)},Tf.prototype.xd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ko(e)},Tf),af=(Object.defineProperty(Ef.prototype,"Zd",{get:function(){return!0},enumerable:!0,configurable:!0}),Ef.prototype.subscribe=function(t){this.Qd=t},Ef.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.tf("listen()"),(r=this.Wd.get(s))?(e=r.targetId,this.qd.zl(e),n=r.view.Fd(),[3,4]):[3,1];case 1:return[4,this.F_.Uu(s.ee())];case 2:return i=t.sent(),o=this.qd.zl(i.targetId),e=i.targetId,[4,this.ef(s,e,"current"===o)];case 3:n=t.sent(),this.Zd&&this.Nd.listen(i),t.label=4;case 4:return[2,n]}})})},Ef.prototype.ef=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(u,!0)];case 1:return e=t.sent(),n=new sf(u,e.ju),r=n.Pd(e.documents),i=ws.ds(a,h&&"Offline"!==this.onlineState),o=n.xn(r,this.Zd,i),this.sf(a,o.vd),s=new Kc(u,a,n),[2,(this.Wd.set(u,s),this.jd.has(a)?this.jd.get(a).push(u):this.jd.set(a,[u]),o.snapshot)]}})})},Ef.prototype.nl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.tf("unlisten()"),e=this.Wd.get(i),1<(n=this.jd.get(e.targetId)).length?[2,(this.jd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.Wd.delete(i))]:this.Zd?(this.qd.Yl(e.targetId),this.qd.Ql(e.targetId)?[3,2]:[4,this.F_.Qu(e.targetId,!1).then(function(){r.qd.Xl(e.targetId),r.Nd.nl(e.targetId),r.if(e.targetId)}).catch(dh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.if(e.targetId),[4,this.F_.Qu(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Ef.prototype.write=function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.tf("write()"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.F_.Nu(r)];case 2:return e=t.sent(),[3,4];case 3:if("IndexedDbTransactionError"===(n=t.sent()).name)return[2,(Bs("SyncEngine","Dropping write that cannot be persisted: "+n),void i.reject(new Ar(Nr.UNAVAILABLE,"Failed to persist write: "+n)))];throw n;case 4:return this.qd.Wl(e.batchId),this.nf(e.batchId,i),[4,this.rf(e.Dn)];case 5:return t.sent(),[4,this.Nd.tl()];case 6:return t.sent(),[2]}})})},Ef.prototype.runTransaction=function(t,e,n){new uf(t,this.Nd,e,n).$d()},Ef.prototype.Mu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.tf("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.Mu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.zd.get(e);n&&(Ws(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.Bd=!0:0<t.Es.size?Ws(n.Bd):0<t.Is.size&&(Ws(n.Bd),n.Bd=!1))}),[4,this.rf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,dh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Ef.prototype.Sd=function(r,t){this.tf("applyOnlineStateChange()");var i=[];this.Wd.forEach(function(t,e){var n=e.view.Sd(r);n.snapshot&&i.push(n.snapshot)}),this.Qd.hf(r),this.Qd.s_(i),this.onlineState=r},Ef.prototype.cl=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.tf("rejectListens()"),this.qd.Zl(u,"rejected",a),e=this.zd.get(u),(n=e&&e.key)?(this.Gd=this.Gd.remove(n),this.zd.delete(u),this.af(),r=(r=new Yo(Kr.N)).Ae(n,new bo(n,Or.min())),i=cs().add(n),o=new ms(Or.min(),new Map,new ns(Hs),r,i),[2,this.Mu(o)]):[4,this.F_.Qu(u,!1).then(function(){return s.if(u,a)}).catch(dh)];case 1:return t.sent(),[2]}})})},Ef.prototype.El=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.tf("applySuccessfulWrite()"),e=r.batch.batchId,this.uf(e,null),this.cf(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_._o(r)];case 2:return n=t.sent(),this.qd.Kl(e,"acknowledged"),[4,this.rf(n)];case 3:return t.sent(),[3,6];case 4:return[4,dh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Ef.prototype.Rl=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.tf("rejectFailedWrite()"),this.uf(n,r),this.cf(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.$u(n)];case 2:return e=t.sent(),this.qd.Kl(n,"rejected",r),[4,this.rf(e)];case 3:return t.sent(),[3,6];case 4:return[4,dh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Ef.prototype._f=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Nd.B_()||Fs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.F_.Po()];case 1:return-1===(e=t.sent())?[2,void r.resolve()]:((n=this.Jd.get(e)||[]).push(r),this.Jd.set(e,n),[2])}})})},Ef.prototype.cf=function(t){(this.Jd.get(t)||[]).forEach(function(t){t.resolve()}),this.Jd.delete(t)},Ef.prototype.lf=function(e){this.Jd.forEach(function(t){t.forEach(function(t){t.reject(new Ar(Nr.CANCELLED,e))})}),this.Jd.clear()},Ef.prototype.nf=function(t,e){var n=(n=(n=this.Yd[this.currentUser.s()])||new Yo(Hs)).Ae(t,e);this.Yd[this.currentUser.s()]=n},Ef.prototype.uf=function(t,e){var n,r=this.Yd[this.currentUser.s()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.Yd[this.currentUser.s()]=r)},Ef.prototype.if=function(t,e){var n=this;void 0===e&&(e=null),this.qd.Yl(t);for(var r=0,i=this.jd.get(t);r<i.length;r++){var o=i[r];this.Wd.delete(o),e&&this.Qd.df(o,e)}this.jd.delete(t),this.Zd&&this.Hd.ic(t).forEach(function(t){n.Hd.Co(t)||n.ff(t)})},Ef.prototype.ff=function(t){var e=this.Gd.get(t);null!==e&&(this.Nd.nl(e),this.Gd=this.Gd.remove(t),this.zd.delete(e),this.af())},Ef.prototype.sf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Wc?(this.Hd.Xo(i.key,t),this.Tf(i)):i instanceof Qc?(Fs("SyncEngine","Document no longer in limbo: "+i.key),this.Hd.ta(i.key,t),this.Hd.Co(i.key)||this.ff(i.key)):zs()}},Ef.prototype.Tf=function(t){var e=t.key;this.Gd.get(e)||(Fs("SyncEngine","New document in limbo: "+e),this.Kd.push(e),this.af())},Ef.prototype.af=function(){for(;0<this.Kd.length&&this.Gd.size<this.Ud;){var t=this.Kd.shift(),e=this.Xd.next();this.zd.set(e,new Hc(t)),this.Gd=this.Gd.Ae(t,e),this.Nd.listen(new Ro(Io.Wt(t.path).ee(),e,2,au.dr))}},Ef.prototype.Ef=function(){return this.Gd},Ef.prototype.If=function(){return this.Kd},Ef.prototype.rf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Wd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Pd(r);return n.pd?u.F_.Wu(i.query,!1).then(function(t){var e=t.documents;return i.view.Pd(e,n)}):n}).then(function(t){var e,n=a&&a.as.get(i.targetId),r=i.view.xn(t,u.Zd,n);u.sf(i.targetId,r.vd),r.snapshot&&(u.Zd&&u.qd.Zl(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=uu.ar(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Qd.s_(o),[4,this.F_.xu(s)];case 2:return t.sent(),[2]}})})},Ef.prototype.tf=function(t){},Ef.prototype.ml=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.lf("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.F_.Su(r)]):[3,3];case 1:return n=t.sent(),this.qd.Su(r,n.Cu,n.Fu),[4,this.rf(n.Du)];case 2:t.sent(),t.label=3;case 3:return[4,this.Nd.ml()];case 4:return t.sent(),[2]}})})},Ef.prototype.enableNetwork=function(){return this.Nd.enableNetwork()},Ef.prototype.disableNetwork=function(){return this.Nd.disableNetwork()},Ef.prototype.ei=function(t){var e=this.zd.get(t);if(e&&e.Bd)return cs().add(e.key);var n=cs(),r=this.jd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.Wd.get(s),n=n.He(u.view.md);return n},Ef),hf=(n(bf,Xc=af),Object.defineProperty(bf.prototype,"Zd",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),bf.prototype.enableNetwork=function(){return this.F_.za(!0),Xc.prototype.enableNetwork.call(this)},bf.prototype.disableNetwork=function(){return this.F_.za(!1),Xc.prototype.disableNetwork.call(this)},bf.prototype.wf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(r.query,!0)];case 1:return e=t.sent(),n=r.view.Cd(e),[2,(this.isPrimary&&this.sf(r.targetId,n.vd),n)]}})})},bf.prototype.Sd=function(t,e){this.Zd&&0===e&&(Xc.prototype.Sd.call(this,t,e),this.qd.ed(t)),this.Zd||1!==e||Xc.prototype.Sd.call(this,t,e)},bf.prototype.ld=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.tf("applyBatchState()"),[4,this.F_.Gu(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Nd.tl()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.uf(n,i||null),this.F_.zu(n)):zs(),t.label=4;case 4:return[4,this.rf(e)];case 5:return t.sent(),[3,7];case 6:Fs("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},bf.prototype.Pl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Nd.Pl(!0)]);case 1:return t.sent(),e=this.qd.ql(),[4,this.Rf(e.W())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Nd.listen(o);return[3,7];case 3:return!1!==h||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),this.jd.forEach(function(t,e){a.qd.Jl(e)?s.push(e):u=u.then(function(){return a.if(e),a.F_.Qu(e,!0)}),a.Nd.nl(e)}),[4,u]);case 4:return t.sent(),[4,this.Rf(s)];case 5:return t.sent(),this.Af(),[4,this.Nd.Pl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},bf.prototype.Af=function(){var n=this;this.zd.forEach(function(t,e){n.Nd.nl(e)}),this.Hd.nc(),this.zd=new Map,this.Gd=new Yo(Kr.N)},bf.prototype.Rf=function(d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.jd.get(o))&&0!==u.length?[4,this.F_.Qu(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.F_.Uu(u[0].ee())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.Wd.get(c),[4,this.wf(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.F_.Hu(o)];case 9:return p=t.sent(),[4,this.F_.Uu(p)];case 10:return s=t.sent(),[4,this.ef(this.mf(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Qd.s_(n),e)]}})})},bf.prototype.mf=function(t){return new Io(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},bf.prototype._u=function(){return this.F_._u()},bf.prototype.dd=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.isPrimary?(Fs("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.jd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.F_.la()];case 3:return e=t.sent(),n=ms.ls(r,"current"===i),[4,this.rf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.F_.Qu(r,!0)];case 6:return t.sent(),this.if(r,o),[3,8];case 7:zs(),t.label=8;case 8:return[2]}})})},bf.prototype.fd=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.jd.has(r)?(Fs("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.F_.Hu(r)]):[3,6];case 2:return i=t.sent(),[4,this.F_.Uu(i)];case 3:return o=t.sent(),[4,this.ef(this.mf(i),o.targetId,!1)];case 4:t.sent(),this.Nd.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.jd.has(e)?[4,u.F_.Qu(e,!1).then(function(){f.Nd.nl(e),f.if(e)}).catch(dh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},bf),cf=(wf.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.gf.get(e))||(n=!0,r=new Yc),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.hl.listen(e)];case 2:return i.Pf=t.sent(),[3,4];case 3:if(o=t.sent(),Bs("EventManager",s="Initialization of query '"+e+"' failed: "+o),"IndexedDbTransactionError"!==o.name)throw o;return[2,void u.onError(new Ar(Nr.UNAVAILABLE,s))];case 4:return this.gf.set(e,r),r.Vf.push(u),u.Sd(this.onlineState),r.Pf&&u.yf(r.Pf)&&this.bf(),[2]}})})},wf.prototype.nl=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.gf.get(e))&&0<=(i=r.Vf.indexOf(o))&&(r.Vf.splice(i,1),n=0===r.Vf.length),n?[2,(this.gf.delete(e),this.hl.nl(e))]:[2]})})},wf.prototype.s_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.gf.get(o);if(s){for(var u=0,a=s.Vf;u<a.length;u++)a[u].yf(i)&&(e=!0);s.Pf=i}}e&&this.bf()},wf.prototype.df=function(t,e){var n=this.gf.get(t);if(n)for(var r=0,i=n.Vf;r<i.length;r++)i[r].onError(e);this.gf.delete(t)},wf.prototype.hf=function(i){this.onlineState=i;var o=!1;this.gf.forEach(function(t,e){for(var n=0,r=e.Vf;n<r.length;n++)r[n].Sd(i)&&(o=!0)}),o&&this.bf()},wf.prototype.vf=function(t){this.pf.add(t),t.next()},wf.prototype.Sf=function(t){this.pf.delete(t)},wf.prototype.bf=function(){this.pf.forEach(function(t){t.next()})},wf),ff=(mf.prototype.yf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new gs(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.Cf?this.Nf(t)&&(this.Df.next(t),o=!0):this.kf(t,this.onlineState)&&(this.$f(t),o=!0),this.Ff=t,o},mf.prototype.onError=function(t){this.Df.error(t)},mf.prototype.Sd=function(t){this.onlineState=t;var e=!1;return this.Ff&&!this.Cf&&this.kf(this.Ff,t)&&(this.$f(this.Ff),e=!0),e},mf.prototype.kf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Mf&&n||t.docs.B()&&"Offline"!==e)},mf.prototype.Nf=function(t){if(0<t.docChanges.length)return!0;var e=this.Ff&&this.Ff.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},mf.prototype.$f=function(t){t=gs.os(t.query,t.docs,t.ns,t.fromCache),this.Cf=!0,this.Df.next(t)},mf),lf=(gf.prototype.vu=function(t){this.Lf=t},gf.prototype.Zn=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Or.min())?this.Of(e,r):this.Lf.Yn(e,o).next(function(t){var n=s.xf(r,t);return(r.oe()||r.ae())&&s.pd(r.Bt,n,o,i)?s.Of(e,r):(js()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Lf.Zn(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ae(t.key,t)}),e}))})},gf.prototype.xf=function(n,t){var r=new ns(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof wo&&n.matches(e)&&(r=r.add(e))}),r},gf.prototype.pd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},gf.prototype.Of=function(t,e){return js()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Lf.Zn(t,e,Or.min())},gf),pf=(vf.prototype.co=function(t){return nu.resolve(0===this.Wn.length)},vf.prototype._o=function(t,e,n){var r=e.batchId,i=this.Uf(r,"acknowledged");return Ws(0===i),this.Wn[i],this.lastStreamToken=n,nu.resolve()},vf.prototype.do=function(t){return nu.resolve(this.lastStreamToken)},vf.prototype.fo=function(t,e){return this.lastStreamToken=e,nu.resolve()},vf.prototype.To=function(t,e,n,r){var i=this.Bf;this.Bf++,0<this.Wn.length&&this.Wn[this.Wn.length-1];var o=new tu(i,e,n,r);this.Wn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.qf=this.qf.add(new vh(a.key,i)),this.jn.Io(t,a.key.path.M())}return nu.resolve(o)},vf.prototype.wo=function(t,e){return nu.resolve(this.Qf(e))},vf.prototype.mo=function(t,e){var n=e+1,r=this.Wf(n),i=r<0?0:r;return nu.resolve(this.Wn.length>i?this.Wn[i]:null)},vf.prototype.Po=function(){return nu.resolve(0===this.Wn.length?-1:this.Bf-1)},vf.prototype.Vo=function(t){return nu.resolve(this.Wn.slice())},vf.prototype.Gn=function(t,e){var n=this,r=new vh(e,0),i=new vh(e,Number.POSITIVE_INFINITY),o=[];return this.qf.Ke([r,i],function(t){var e=n.Qf(t.hc);o.push(e)}),nu.resolve(o)},vf.prototype.Xn=function(t,e){var r=this,i=new ns(Hs);return e.forEach(function(t){var e=new vh(t,0),n=new vh(t,Number.POSITIVE_INFINITY);r.qf.Ke([e,n],function(t){i=i.add(t.hc)})}),nu.resolve(this.jf(i))},vf.prototype.nr=function(t,e){var n=e.path,r=n.length+1,i=n;Kr.et(i)||(i=i.child(""));var o=new vh(new Kr(i),0),s=new ns(Hs);return this.qf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.hc)),!0)},o),nu.resolve(this.jf(s))},vf.prototype.jf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Qf(t);null!==e&&r.push(e)}),r},vf.prototype.yo=function(n,r){var i=this;Ws(0===this.Uf(r.batchId,"removed")),this.Wn.shift();var o=this.qf;return nu.forEach(r.mutations,function(t){var e=new vh(t.key,r.batchId);return o=o.delete(e),i.oo.So(n,t.key)}).next(function(){i.qf=o})},vf.prototype.vo=function(t){},vf.prototype.Co=function(t,e){var n=new vh(e,0),r=this.qf.ze(n);return nu.resolve(e.isEqual(r&&r.key))},vf.prototype.Do=function(t){return this.Wn.length,nu.resolve()},vf.prototype.Uf=function(t,e){return this.Wf(t)},vf.prototype.Wf=function(t){return 0===this.Wn.length?0:t-this.Wn[0].batchId},vf.prototype.Qf=function(t){var e=this.Wf(t);return e<0||e>=this.Wn.length?null:this.Wn[e]},vf),df=(yf.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Kf(e);return this.docs=this.docs.Ae(r,{ra:e,size:s,readTime:n}),this.size+=s-o,this.jn.Io(t,r.path.M())},yf.prototype.$n=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},yf.prototype.Mn=function(t,e){var n=this.docs.get(e);return nu.resolve(n?n.ra:null)},yf.prototype.getEntries=function(t,e){var n=this,r=is;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ae(t,e?e.ra:null)}),nu.resolve(r)},yf.prototype.Zn=function(t,e,n){for(var r=us,i=new Kr(e.path.child("")),o=this.docs.ve(i);o.ke();){var s=o.Ne(),u=s.key,a=s.value,h=a.ra,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof wo&&e.matches(h)&&(r=r.Ae(h.key,h))}return nu.resolve(r)},yf.prototype.Gf=function(t,e){return nu.forEach(this.docs,function(t){return e(t)})},yf.prototype.Ea=function(t){return new yf.Ia(this)},yf.prototype.Ra=function(t){return nu.resolve(this.size)},yf);function yf(t,e){this.jn=t,this.Kf=e,this.docs=new Yo(Kr.N),this.size=0}function vf(t,e){this.jn=t,this.oo=e,this.Wn=[],this.Bf=1,this.lastStreamToken=Jr.ht,this.qf=new ns(vh.Ju)}function gf(){}function mf(t,e,n){this.query=t,this.Df=e,this.Cf=!1,this.Ff=null,this.onlineState="Unknown",this.options=n||{}}function wf(t){this.hl=t,this.gf=new Zs(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.pf=new Set,this.hl.subscribe(this)}function bf(t,e,n,r,i){var o=this;return(o=Xc.call(this,t,e,n,r,i)||this).F_=t,o.isPrimary=void 0,o}function Ef(t,e,n,r,i){this.F_=t,this.Nd=e,this.qd=n,this.currentUser=r,this.Ud=i,this.Qd=null,this.Wd=new Zs(function(t){return t.canonicalId()}),this.jd=new Map,this.Kd=[],this.Gd=new Yo(Kr.N),this.zd=new Map,this.Hd=new yh,this.Yd={},this.Jd=new Map,this.Xd=ua.ko(),this.onlineState="Unknown"}function Tf(t,e,n,r){this.br=t,this.Nd=e,this.updateFunction=n,this.Dr=r,this.kd=5,this.Qr=new bu(this.br,"transaction_retry")}function If(t,e){this.query=t,this.Id=e,this.wd=null,this.fs=!1,this.Rd=cs(),this.ns=cs(),this.Ad=new ys(t.se.bind(t))}function Nf(){this.Td=new nf,this.Ed={},this.hl=null,this.V_=null,this.ur=null}function Af(t,e,n,r,i){if(this.Tr=t,this.platform=e,this.persistenceKey=n,this.bl=r,this.hl=null,this.V_=null,this.ur=null,this.vl=this.Sl.bind(this),this.Dl=new Yo(Hs),this.vh=!1,this.Cl=[],!Af.Uh(this.platform))throw new Ar(Nr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Fl=Bc(this.persistenceKey,this.bl),this.Nl="firestore_sequence_number_"+this.persistenceKey,this.Dl=this.Dl.Ae(this.bl,new nf),this.kl=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.$l=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ml=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Ll="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.vl)}function _f(){this.activeTargetIds=fs}function Sf(t,e){this.clientId=t,this.onlineState=e}function kf(t,e){this.clientId=t,this.activeTargetIds=e}function Df(t,e,n){this.targetId=t,this.state=e,this.error=n}function xf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Of(t){var e=this;return(e=$c.call(this)||this).Aa=t,e}df.Ia=(n(Of,$c=ru),Of.prototype.xn=function(n){var r=this,i=[];return this.Dn.forEach(function(t,e){e?i.push(r.Aa.Nn(n,e,r.readTime)):r.Aa.$n(t)}),nu.vn(i)},Of.prototype.Ln=function(t,e){return this.Aa.Mn(t,e)},Of.prototype.On=function(t,e){return this.Aa.getEntries(t,e)},Of);var Rf,Pf,Vf=(Yf.prototype.js=function(t,n){return this.zf.forEach(function(t,e){return n(e)}),nu.resolve()},Yf.prototype.Oo=function(t){return nu.resolve(this.lastRemoteSnapshotVersion)},Yf.prototype.xo=function(t){return nu.resolve(this.Hf)},Yf.prototype.$o=function(t){return this.highestTargetId=this.Jf.next(),nu.resolve(this.highestTargetId)},Yf.prototype.Bo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Hf&&(this.Hf=e),nu.resolve()},Yf.prototype.Uo=function(t){this.zf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Jf=new ua(e),this.highestTargetId=e),t.sequenceNumber>this.Hf&&(this.Hf=t.sequenceNumber)},Yf.prototype.qo=function(t,e){return this.Uo(e),this.targetCount+=1,nu.resolve()},Yf.prototype.Wo=function(t,e){return this.Uo(e),nu.resolve()},Yf.prototype.jo=function(t,e){return this.zf.delete(e.target),this.Yf.ic(e.targetId),--this.targetCount,nu.resolve()},Yf.prototype.$h=function(n,r,i){var o=this,s=0,u=[];return this.zf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.zf.delete(t),u.push(o.Ko(n,e.targetId)),s++)}),nu.vn(u).next(function(){return s})},Yf.prototype.Ho=function(t){return nu.resolve(this.targetCount)},Yf.prototype.Yo=function(t,e){var n=this.zf.get(e)||null;return nu.resolve(n)},Yf.prototype.Jo=function(t,e,n){return this.Yf.tc(e,n),nu.resolve()},Yf.prototype.Zo=function(e,t,n){this.Yf.sc(t,n);var r=this.persistence.oo,i=[];return r&&t.forEach(function(t){i.push(r.So(e,t))}),nu.vn(i)},Yf.prototype.Ko=function(t,e){return this.Yf.ic(e),nu.resolve()},Yf.prototype.ea=function(t,e){var n=this.Yf.rc(e);return nu.resolve(n)},Yf.prototype.Co=function(t,e){return nu.resolve(this.Yf.Co(e))},Yf),Lf=(Hf.prototype.start=function(){return Promise.resolve()},Hf.prototype.hu=function(){return this.Da=!1,Promise.resolve()},Object.defineProperty(Hf.prototype,"vh",{get:function(){return this.Da},enumerable:!0,configurable:!0}),Hf.prototype.Ga=function(){},Hf.prototype.Tu=function(){return this.jn},Hf.prototype.lu=function(t){var e=this.Xf[t.s()];return e||(e=new pf(this.jn,this.oo),this.Xf[t.s()]=e),e},Hf.prototype.du=function(){return this.Oa},Hf.prototype.fu=function(){return this.Qn},Hf.prototype.runTransaction=function(t,e,n){var r=this;Fs("MemoryPersistence","Starting transaction:",t);var i=new Cf(this.ja.next());return this.oo.tT(),n(i).next(function(t){return r.oo.eT(i).next(function(){return t})}).yn().then(function(t){return i.Un(),t})},Hf.prototype.sT=function(e,n){return nu.Sn(Object.values(this.Xf).map(function(t){return function(){return t.Co(e,n)}}))},Hf),Cf=(n(Kf,Pf=ou),Kf),Mf=(Qf.rT=function(t){return new Qf(t)},Object.defineProperty(Qf.prototype,"hT",{get:function(){if(this.nT)return this.nT;throw zs()},enumerable:!0,configurable:!0}),Qf.prototype.Xo=function(t,e,n){return this.iT.Xo(n,e),this.hT.delete(n),nu.resolve()},Qf.prototype.ta=function(t,e,n){return this.iT.ta(n,e),this.hT.add(n),nu.resolve()},Qf.prototype.So=function(t,e){return this.hT.add(e),nu.resolve()},Qf.prototype.removeTarget=function(t,e){var n=this;this.iT.ic(e.targetId).forEach(function(t){return n.hT.add(t)});var r=this.persistence.du();return r.ea(t,e.targetId).next(function(t){t.forEach(function(t){return n.hT.add(t)})}).next(function(){return r.jo(t,e)})},Qf.prototype.tT=function(){this.nT=new Set},Qf.prototype.eT=function(t){var n=this,r=this.persistence.fu().Ea();return nu.forEach(this.hT,function(e){return n.oT(t,e).next(function(t){t||r.$n(e)})}).next(function(){return n.nT=null,r.apply(t)})},Qf.prototype.mu=function(t,e){var n=this;return this.oT(t,e).next(function(t){t?n.hT.delete(e):n.hT.add(e)})},Qf.prototype.Zf=function(t){return 0},Qf.prototype.oT=function(t,e){var n=this;return nu.Sn([function(){return nu.resolve(n.iT.Co(e))},function(){return n.persistence.du().Co(t,e)},function(){return n.persistence.sT(t,e)}])},Qf),Uf=(Wf.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.qd=this.aT(n),this.persistence=this.uT(n),[4,this.persistence.start()];case 1:return t.sent(),this.cT=this._T(n),this.F_=this.lT(n),this.Nd=this.dT(n),this.hl=this.fT(n),this.TT=this.ET(n),this.qd.V_=function(t){return e.hl.Sd(t,1)},this.Nd.hl=this.hl,[4,this.F_.start()];case 2:return t.sent(),[4,this.qd.start()];case 3:return t.sent(),[4,this.Nd.start()];case 4:return t.sent(),[4,this.Nd.Pl(this.hl.Zd)];case 5:return t.sent(),[2]}})})},Wf.prototype.ET=function(t){return new cf(this.hl)},Wf.prototype._T=function(t){return null},Wf.prototype.lT=function(t){return new hh(this.persistence,new lf,t.IT)},Wf.prototype.uT=function(t){return new Lf(Mf.rT)},Wf.prototype.dT=function(t){var e=this;return new Vc(this.F_,t.f_,t.br,function(t){return e.hl.Sd(t,0)},t.platform.wT())},Wf.prototype.aT=function(t){return new of},Wf.prototype.fT=function(t){return new af(this.F_,this.Nd,this.qd,t.IT,t.Ud)},Wf.prototype.clearPersistence=function(t){throw new Ar(Nr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},Wf),jf=(n(zf,Rf=Uf),zf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Rf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.Ka(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.hl.Pl(e)];case 1:return t.sent(),this.cT&&(e&&!this.cT.vh?this.cT.start(this.F_):e||this.cT.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},zf.prototype.lT=function(t){return new lh(this.persistence,new lf,t.IT)},zf.prototype.fT=function(t){var e=new hf(this.F_,this.Nd,this.qd,t.IT,t.Ud);return this.qd instanceof rf&&(this.qd.hl=e),e},zf.prototype._T=function(t){var e=this.persistence.oo.Vh;return new Ru(e,t.br)},zf.prototype.uT=function(t){var e=th.Iu(t.RT),n=t.platform.yc(t.RT.ii);return new th(t.AT.synchronizeTabs,e,t.clientId,t.platform,Du.Eh(t.AT.cacheSizeBytes),t.br,n,this.qd)},zf.prototype.aT=function(t){if(t.AT.mT&&t.AT.synchronizeTabs){if(!rf.Uh(t.platform))throw new Ar(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=th.Iu(t.RT);return new rf(t.br,t.platform,e,t.clientId,t.IT)}return new of},zf.prototype.clearPersistence=function(t){var e=th.Iu(t);return th.clearPersistence(e)},zf),qf=(Gf.prototype.start=function(e,n){var r=this;this.PT();var i=new wu,o=new wu,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,Fs("FirestoreClient","Initializing. user=",t.uid),r.VT(e,n,t,o).then(i.resolve,i.reject);r.br.$r(function(){return r.ml(t)})}),this.br.$r(function(){return i.promise}),o.promise},Gf.prototype.enableNetwork=function(){var t=this;return this.PT(),this.br.enqueue(function(){return t.hl.enableNetwork()})},Gf.prototype.VT=function(u,a,h,c){return y(this,void 0,void 0,function(){var n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.gT(this.RT)];case 1:return n=t.sent(),r=this.platform.yc(this.RT.ii),e=this.credentials,i=new Oc(n,e,r),[4,u.initialize({br:this.br,RT:this.RT,platform:this.platform,f_:i,clientId:this.clientId,IT:h,Ud:100,AT:a})];case 2:return t.sent(),this.persistence=u.persistence,this.qd=u.qd,this.F_=u.F_,this.Nd=u.Nd,this.hl=u.hl,this.cT=u.cT,this.pT=u.TT,this.persistence.Ga(function(){return y(s,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),c.resolve(),[3,4];case 3:if(o=t.sent(),c.reject(o),!this.yT(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.VT(new Uf,{mT:!1},h,c))];case 4:return[2]}var e})})},Gf.prototype.yT=function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Gf.prototype.PT=function(){if(this.br.Kr)throw new Ar(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},Gf.prototype.ml=function(t){return this.br.th(),Fs("FirestoreClient","Credential Changed. Current user: "+t.uid),this.hl.ml(t)},Gf.prototype.disableNetwork=function(){var t=this;return this.PT(),this.br.enqueue(function(){return t.hl.disableNetwork()})},Gf.prototype.terminate=function(){var t=this;return this.br.Jr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cT&&this.cT.stop(),[4,this.Nd.hu()];case 1:return t.sent(),[4,this.qd.hu()];case 2:return t.sent(),[4,this.persistence.hu()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},Gf.prototype.waitForPendingWrites=function(){var t=this;this.PT();var e=new wu;return this.br.$r(function(){return t.hl._f(e)}),e.promise},Gf.prototype.listen=function(t,e,n){var r=this;this.PT();var i=new ff(t,e,n);return this.br.$r(function(){return r.pT.listen(i)}),i},Gf.prototype.nl=function(t){var e=this;this.bT||this.br.$r(function(){return e.pT.nl(t)})},Gf.prototype.vT=function(t){var e=this;return this.PT(),this.br.enqueue(function(){return e.F_.qu(t)}).then(function(t){if(t instanceof wo)return t;if(t instanceof bo)return null;throw new Ar(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Gf.prototype.ST=function(i){var t=this;return this.PT(),this.br.enqueue(function(){return y(t,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(i,!0)];case 1:return e=t.sent(),n=new sf(i,e.ju),r=n.Pd(e.documents),[2,n.xn(r,!1).snapshot]}})})})},Gf.prototype.write=function(t){var e=this;this.PT();var n=new wu;return this.br.$r(function(){return e.hl.write(t,n)}),n.promise},Gf.prototype.ii=function(){return this.RT.ii},Gf.prototype.vf=function(t){var e=this;this.PT(),this.br.$r(function(){return e.pT.vf(t),Promise.resolve()})},Gf.prototype.Sf=function(t){this.bT||this.pT.Sf(t)},Object.defineProperty(Gf.prototype,"bT",{get:function(){return this.br.Kr},enumerable:!0,configurable:!0}),Gf.prototype.transaction=function(t){var e=this;this.PT();var n=new wu;return this.br.$r(function(){return e.hl.runTransaction(e.br,t,n),Promise.resolve()}),n.promise},Gf),Ff=(Bf.prototype.next=function(t){this.DT(this.observer.next,t)},Bf.prototype.error=function(t){this.DT(this.observer.error,t)},Bf.prototype.CT=function(){this.muted=!0},Bf.prototype.DT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Bf);function Bf(t){this.observer=t,this.muted=!1}function Gf(t,e,n,r){this.platform=t,this.RT=e,this.credentials=n,this.br=r,this.clientId=Qs.cn()}function zf(){return null!==Rf&&Rf.apply(this,arguments)||this}function Wf(){}function Qf(t){this.persistence=t,this.iT=new yh,this.nT=null}function Kf(t){var e=this;return(e=Pf.call(this)||this).va=t,e}function Hf(t){var e=this;this.Xf={},this.ja=new au(0),this.Da=!1,this.Da=!0,this.oo=t(this),this.Oa=new Vf(this),this.jn=new Na,this.Qn=new df(this.jn,function(t){return e.oo.Zf(t)})}function Yf(t){this.persistence=t,this.zf=new Zs(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Or.min(),this.highestTargetId=0,this.Hf=0,this.Yf=new yh,this.targetCount=0,this.Jf=ua.No()}function Xf(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var $f,Jf,Zf=(Il.prototype.NT=function(t){switch(si(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pi(t.integerValue||t.doubleValue);case 3:return this.kT(t.timestampValue);case 4:return this.$T(t);case 5:return t.stringValue;case 6:return new jh(di(t.bytesValue));case 7:return this.MT(t.referenceValue);case 8:return this.LT(t.geoPointValue);case 9:return this.OT(t.arrayValue);case 10:return this.xT(t.mapValue);default:throw zs()}},Il.prototype.xT=function(t){var n=this,r={};return Xr(t.fields||{},function(t,e){r[t]=n.NT(e)}),r},Il.prototype.LT=function(t){return new ec(pi(t.latitude),pi(t.longitude))},Il.prototype.OT=function(t){var e=this;return(t.values||[]).map(function(t){return e.NT(t)})},Il.prototype.$T=function(t){switch(this.FT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return ri(n)?t(n):n}(t);return null==e?null:this.NT(e);case"estimate":return this.kT(ii(t));default:return null}},Il.prototype.kT=function(t){var e=li(t),n=new xr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Il.prototype.MT=function(t){var e=Pr.K(t);Ws(Ls(e));var n=new Js(e.get(1),e.get(3)),r=new Kr(e.$(5));return n.isEqual(this.firestore.Nc)||Bs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.Nc.projectId+"/"+this.firestore.Nc.database+") instead."),new ol(r,this.firestore,this.converter)},Il),tl=Du.Rh,el=(Tl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Tl),nl=(El.prototype.settings=function(t){bh("Firestore.settings",arguments,1),Ih("Firestore.settings","object",1,t);var e=new el(t);if(this.QT&&!this.zT.isEqual(e))throw new Ar(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.zT=e).credentials&&(this.KT=function(t){if(!t)return new _r;switch(t.type){case"gapi":var e=t.YT;return Ws(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Dr(e,t.V||"0");case"provider":return t.YT;default:throw new Ar(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},El.prototype.enableNetwork=function(){return this.UT(),this.QT.enableNetwork()},El.prototype.disableNetwork=function(){return this.UT(),this.QT.disableNetwork()},El.prototype.enablePersistence=function(t){var e,n;if(this.QT)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Bs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.JT(this.GT,{mT:!0,cacheSizeBytes:this.zT.cacheSizeBytes,synchronizeTabs:r})},El.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.QT&&!this.QT.bT)throw new Ar(Nr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new wu,[2,(this.qT.Gr(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.XT(),[4,this.GT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},El.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(El.prototype,"ZT",{get:function(){return this.UT(),this.QT.bT},enumerable:!0,configurable:!0}),El.prototype.waitForPendingWrites=function(){return this.UT(),this.QT.waitForPendingWrites()},El.prototype.onSnapshotsInSync=function(t){if(this.UT(),Xf(t))return this.tE(t);Ih("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.tE(e)},El.prototype.tE=function(t){var e=this,n=new Ff({next:function(){t.next&&t.next()},error:function(t){throw zs()}});return this.QT.vf(n),function(){n.CT(),e.QT.Sf(n)}},El.prototype.UT=function(){return this.QT||this.JT(new Uf,{mT:!1}),this.QT},El.prototype.XT=function(){return new $s(this.Nc,this.jT,this.zT.host,this.zT.ssl,this.zT.forceLongPolling)},El.prototype.JT=function(t,e){var n=this.XT();return this.QT=new qf(Cs.nt(),n,this.KT,this.qT),this.QT.start(t,e)},El.WT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Ar(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Ar(Nr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Js(n)},Object.defineProperty(El.prototype,"app",{get:function(){if(!this.BT)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.BT},enumerable:!0,configurable:!0}),El.prototype.collection=function(t){return bh("Firestore.collection",arguments,1),Ih("Firestore.collection","non-empty string",1,t),this.UT(),new fl(Pr.K(t),this)},El.prototype.doc=function(t){return bh("Firestore.doc",arguments,1),Ih("Firestore.doc","non-empty string",1,t),this.UT(),ol.eE(Pr.K(t),this)},El.prototype.collectionGroup=function(t){if(bh("Firestore.collectionGroup",arguments,1),Ih("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.UT(),new hl(new Io(Pr.G,t),this)},El.prototype.runTransaction=function(e){var n=this;return bh("Firestore.runTransaction",arguments,1),Ih("Firestore.runTransaction","function",1,e),this.UT().transaction(function(t){return e(new rl(n,t))})},El.prototype.batch=function(){return this.UT(),new il(this)},Object.defineProperty(El,"logLevel",{get:function(){switch(js()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),El.setLogLevel=function(t){switch(bh("Firestore.setLogLevel",arguments,1),Ih("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":qs(l.DEBUG);break;case"error":qs(l.ERROR);break;case"silent":qs(l.SILENT);break;default:throw new Ar(Nr.INVALID_ARGUMENT,"Invalid log level: "+t)}},El.prototype.sE=function(){return this.zT.timestampsInSnapshots},El),rl=(bl.prototype.get=function(t){var n=this;bh("Transaction.get",arguments,1);var r=Sl("Transaction.get",t,this.iE);return this.nE.R_([r.kc]).then(function(t){if(!t||1!==t.length)return zs();var e=t[0];if(e instanceof bo)return new ul(n.iE,r.kc,null,!1,!1,r.rE);if(e instanceof wo)return new ul(n.iE,r.kc,e,!1,!1,r.rE);throw zs()})},bl.prototype.set=function(t,e,n){Th("Transaction.set",arguments,2,3);var r=Sl("Transaction.set",t,this.iE);n=Nl("Transaction.set",n);var i=kl(r.rE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.iE.HT.Sc(s,o,n.mergeFields):this.iE.HT.bc(s,o);return this.nE.set(r.kc,u),this},bl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof qh?(Eh("Transaction.update",arguments,3),r=Sl("Transaction.update",t,this.iE),this.iE.HT.Cc("Transaction.update",e,n,o)):(bh("Transaction.update",arguments,2),r=Sl("Transaction.update",t,this.iE),this.iE.HT.Dc("Transaction.update",e)),this.nE.update(r.kc,i),this},bl.prototype.delete=function(t){bh("Transaction.delete",arguments,1);var e=Sl("Transaction.delete",t,this.iE);return this.nE.delete(e.kc),this},bl),il=(wl.prototype.set=function(t,e,n){Th("WriteBatch.set",arguments,2,3),this.aE();var r=Sl("WriteBatch.set",t,this.iE);n=Nl("WriteBatch.set",n);var i=kl(r.rE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.iE.HT.Sc(s,o,n.mergeFields):this.iE.HT.bc(s,o);return this.hE=this.hE.concat(u.Rc(r.kc,Ui.ft())),this},wl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.aE(),i="string"==typeof e||e instanceof qh?(Eh("WriteBatch.update",arguments,3),r=Sl("WriteBatch.update",t,this.iE),this.iE.HT.Cc("WriteBatch.update",e,n,o)):(bh("WriteBatch.update",arguments,2),r=Sl("WriteBatch.update",t,this.iE),this.iE.HT.Dc("WriteBatch.update",e)),this.hE=this.hE.concat(i.Rc(r.kc,Ui.exists(!0))),this},wl.prototype.delete=function(t){bh("WriteBatch.delete",arguments,1),this.aE();var e=Sl("WriteBatch.delete",t,this.iE);return this.hE=this.hE.concat(new Gi(e.kc,Ui.ft())),this},wl.prototype.commit=function(){return this.aE(),this.oE=!0,0<this.hE.length?this.iE.UT().write(this.hE):Promise.resolve()},wl.prototype.aE=function(){if(this.oE)throw new Ar(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},wl),ol=(ml.eE=function(t,e,n){if(t.length%2!=0)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new ml(new Kr(t),e,n)},Object.defineProperty(ml.prototype,"id",{get:function(){return this.kc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(ml.prototype,"parent",{get:function(){return new fl(this.kc.path.M(),this.firestore,this.rE)},enumerable:!0,configurable:!0}),Object.defineProperty(ml.prototype,"path",{get:function(){return this.kc.path.j()},enumerable:!0,configurable:!0}),ml.prototype.collection=function(t){if(bh("DocumentReference.collection",arguments,1),Ih("DocumentReference.collection","non-empty string",1,t),!t)throw new Ar(Nr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Pr.K(t);return new fl(this.kc.path.child(e),this.firestore)},ml.prototype.isEqual=function(t){if(!(t instanceof ml))throw Ph("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.kc.isEqual(t.kc)&&this.rE===t.rE},ml.prototype.set=function(t,e){Th("DocumentReference.set",arguments,1,2),e=Nl("DocumentReference.set",e);var n=kl(this.rE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.HT.Sc(i,r,e.mergeFields):this.firestore.HT.bc(i,r);return this.QT.write(o.Rc(this.kc,Ui.ft()))},ml.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof qh?(Eh("DocumentReference.update",arguments,2),this.firestore.HT.Cc("DocumentReference.update",t,e,r)):(bh("DocumentReference.update",arguments,1),this.firestore.HT.Dc("DocumentReference.update",t)),this.QT.write(n.Rc(this.kc,Ui.exists(!0)))},ml.prototype.delete=function(){return bh("DocumentReference.delete",arguments,0),this.QT.write([new Gi(this.kc,Ui.ft())])},ml.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Th("DocumentReference.onSnapshot",arguments,1,4);var n={includeMetadataChanges:!1},r=0;"object"!=typeof t[r]||Xf(t[r])||(Rh("DocumentReference.onSnapshot",n=t[r],["includeMetadataChanges"]),_h("DocumentReference.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges),r++);var i={includeMetadataChanges:n.includeMetadataChanges},o=Xf(t[r])?t[r]:(Ih("DocumentReference.onSnapshot","function",r,t[r]),Nh("DocumentReference.onSnapshot","function",r+1,t[r+1]),Nh("DocumentReference.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]});return this.uE(i,o)},ml.prototype.uE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Ff({next:function(t){var e;n.next&&(e=t.docs.get(r.kc),n.next(new ul(r.firestore,r.kc,e,t.fromCache,t.hasPendingWrites,r.rE)))},error:e}),o=this.QT.listen(Io.Wt(this.kc.path),i,t);return function(){i.CT(),r.QT.nl(o)}},ml.prototype.get=function(n){var r=this;return Th("DocumentReference.get",arguments,0,1),_l("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.UT().vT(r.kc).then(function(t){e(new ul(r.firestore,r.kc,t,!0,t instanceof wo&&t.At,r.rE))},t):r.cE(e,t,n)})},ml.prototype.cE=function(e,n,r){var i=this.uE({includeMetadataChanges:!0,Mf:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Ar(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Ar(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},ml.prototype.withConverter=function(t){return new ml(this.kc,this.firestore,t)},ml),sl=(gl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},gl),ul=(vl.prototype.data=function(t){if(Th("DocumentSnapshot.data",arguments,0,1),t=Al("DocumentSnapshot.data",t),this._E){if(this.rE){var e=new al(this.iE,this.kc,this._E,this.lE,this.dE);return this.rE.fromFirestore(e,t)}return new Zf(this.iE,this.iE.sE(),t.serverTimestamps,void 0).NT(this._E.Mt())}},vl.prototype.get=function(t,e){if(Th("DocumentSnapshot.get",arguments,1,2),e=Al("DocumentSnapshot.get",e),this._E){var n=this._E.data().field(Tc("DocumentSnapshot.get",t));if(null!==n)return new Zf(this.iE,this.iE.sE(),e.serverTimestamps,this.rE).NT(n)}},Object.defineProperty(vl.prototype,"id",{get:function(){return this.kc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(vl.prototype,"ref",{get:function(){return new ol(this.kc,this.iE,this.rE)},enumerable:!0,configurable:!0}),Object.defineProperty(vl.prototype,"exists",{get:function(){return null!==this._E},enumerable:!0,configurable:!0}),Object.defineProperty(vl.prototype,"metadata",{get:function(){return new sl(this.dE,this.lE)},enumerable:!0,configurable:!0}),vl.prototype.isEqual=function(t){if(!(t instanceof vl))throw Ph("isEqual","DocumentSnapshot",1,t);return this.iE===t.iE&&this.lE===t.lE&&this.kc.isEqual(t.kc)&&(null===this._E?null===t._E:this._E.isEqual(t._E))&&this.rE===t.rE},vl),al=(n(yl,Jf=ul),yl.prototype.data=function(t){return Jf.prototype.data.call(this,t)},yl),hl=(dl.prototype.where=function(t,e,n){bh("Query.where",arguments,3),Oh("Query.where",3,n);var r,i=function(t,e){if(!t.some(function(t){return t===e}))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid value "+xh(e)+" provided to function Query.where() for its "+Lh(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Tc("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.TE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.EE(h))}r={arrayValue:{values:s}}}else r=this.EE(n)}else"in"!==i&&"array-contains-any"!==i||this.TE(n,i),r=this.firestore.HT.Fc("Query.where",n,"in"===i);var c=No.create(o,i,r);return this.IE(c),new dl(this.fE.Gt(c),this.firestore,this.rE)},dl.prototype.orderBy=function(t,e){var n;if(Th("Query.orderBy",arguments,1,2),Nh("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.fE.startAt)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.fE.endAt)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Tc("Query.orderBy",t),i=new Oo(r,n);return this.wE(i),new dl(this.fE.zt(i),this.firestore,this.rE)},dl.prototype.limit=function(t){return bh("Query.limit",arguments,1),Ih("Query.limit","number",1,t),Vh("Query.limit",1,t),new dl(this.fE.Ht(t),this.firestore,this.rE)},dl.prototype.limitToLast=function(t){return bh("Query.limitToLast",arguments,1),Ih("Query.limitToLast","number",1,t),Vh("Query.limitToLast",1,t),new dl(this.fE.Yt(t),this.firestore,this.rE)},dl.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.startAt",arguments,1);var r=this.RE("Query.startAt",t,e,!0);return new dl(this.fE.Jt(r),this.firestore,this.rE)},dl.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.startAfter",arguments,1);var r=this.RE("Query.startAfter",t,e,!1);return new dl(this.fE.Jt(r),this.firestore,this.rE)},dl.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.endBefore",arguments,1);var r=this.RE("Query.endBefore",t,e,!0);return new dl(this.fE.Xt(r),this.firestore,this.rE)},dl.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Eh("Query.endAt",arguments,1);var r=this.RE("Query.endAt",t,e,!1);return new dl(this.fE.Xt(r),this.firestore,this.rE)},dl.prototype.isEqual=function(t){if(!(t instanceof dl))throw Ph("isEqual","Query",1,t);return this.firestore===t.firestore&&this.fE.isEqual(t.fE)},dl.prototype.withConverter=function(t){return new dl(this.fE,this.firestore,t)},dl.prototype.RE=function(t,e,n,r){if(Oh(t,1,e),e instanceof ul){if(0<n.length)throw new Ar(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Ar(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.AE(i._E,r)}var o=[e].concat(n);return this.mE(t,o,r)},dl.prototype.AE=function(t,e){for(var n=[],r=0,i=this.fE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(yi(this.firestore.Nc,t.key));else{var s=t.field(o.field);if(ri(s))throw new Ar(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new xo(n,e)},dl.prototype.mE=function(t,e,n){var r=this.fE.xt;if(e.length>r.length)throw new Ar(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.fE._e()&&-1!==s.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.fE.path.child(Pr.K(s));if(!Kr.et(u))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Kr(u);i.push(yi(this.firestore.Nc,a))}else{var h=this.firestore.HT.Fc(t,s);i.push(h)}}return new xo(i,n)},dl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Th("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Xf(t[i])||(Rh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),_h("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Xf(t[i])?t[i]:(Ih("Query.onSnapshot","function",i,t[i]),Nh("Query.onSnapshot","function",i+1,t[i+1]),Nh("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.PE(this.fE),this.uE(r,n)},dl.prototype.uE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Ff({next:function(t){e.next&&e.next(new cl(n.firestore,n.fE,t,n.rE))},error:r}),o=this.firestore.UT(),s=o.listen(this.fE,i,t);return function(){i.CT(),o.nl(s)}},dl.prototype.PE=function(t){if(t.ae()&&0===t.xt.length)throw new Ar(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},dl.prototype.get=function(n){var r=this;return Th("Query.get",arguments,0,1),_l("Query.get",n),this.PE(this.fE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.UT().ST(r.fE).then(function(t){e(new cl(r.firestore,r.fE,t,r.rE))},t):r.cE(e,t,n)})},dl.prototype.cE=function(e,n,r){var i=this.uE({includeMetadataChanges:!0,Mf:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Ar(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},dl.prototype.EE=function(t){if("string"==typeof t){if(""===t)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.fE._e()&&-1!==t.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.fE.path.child(Pr.K(t));if(!Kr.et(e))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return yi(this.firestore.Nc,new Kr(e))}if(t instanceof ol)return yi(this.firestore.Nc,t.kc);throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+xh(t)+".")},dl.prototype.TE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},dl.prototype.IE=function(t){if(t instanceof No){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.fE.jt();if(null!==o&&!o.isEqual(t.field))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.fE.Kt();null!==s&&this.VE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.fE.ce(n)),null===u&&r&&(u=this.fE.ce(e)),null!=u)throw u===t.op?new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},dl.prototype.wE=function(t){var e;null!==this.fE.Kt()||null!==(e=this.fE.jt())&&this.VE(e,t.field)},dl.prototype.VE=function(t,e){if(!e.isEqual(t))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},dl),cl=(Object.defineProperty(pl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"empty",{get:function(){return this.pE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"size",{get:function(){return this.pE.docs.size},enumerable:!0,configurable:!0}),pl.prototype.forEach=function(e,n){var r=this;Th("QuerySnapshot.forEach",arguments,1,2),Ih("QuerySnapshot.forEach","function",1,e),this.pE.docs.forEach(function(t){e.call(n,r.vE(t))})},Object.defineProperty(pl.prototype,"query",{get:function(){return new hl(this.gE,this.iE,this.rE)},enumerable:!0,configurable:!0}),pl.prototype.docChanges=function(t){t&&(Rh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),_h("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.pE.hs)throw new Ar(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.yE&&this.bE===e||(this.yE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new al(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new al(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zs()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.iE,e,this.pE,this.rE),this.bE=e),this.yE},pl.prototype.isEqual=function(t){if(!(t instanceof pl))throw Ph("isEqual","QuerySnapshot",1,t);return this.iE===t.iE&&this.gE.isEqual(t.gE)&&this.pE.isEqual(t.pE)&&this.rE===t.rE},pl.prototype.vE=function(t){return new al(this.iE,t.key,t,this.metadata.fromCache,this.pE.ns.has(t.key),this.rE)},pl),fl=(n(ll,$f=hl),Object.defineProperty(ll.prototype,"id",{get:function(){return this.fE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"parent",{get:function(){var t=this.fE.path.M();return t.B()?null:new ol(new Kr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(ll.prototype,"path",{get:function(){return this.fE.path.j()},enumerable:!0,configurable:!0}),ll.prototype.doc=function(t){if(Th("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Qs.cn()),Ih("CollectionReference.doc","non-empty string",1,t),""===t)throw new Ar(Nr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Pr.K(t);return ol.eE(this.fE.path.child(e),this.firestore,this.rE)},ll.prototype.add=function(t){bh("CollectionReference.add",arguments,1),Ih("CollectionReference.add","object",1,this.rE?this.rE.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},ll.prototype.withConverter=function(t){return new ll(this.SE,this.firestore,t)},ll);function ll(t,e,n){var r=this;if(((r=$f.call(this,Io.Wt(t),e,n)||this).SE=t).length%2!=1)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function pl(t,e,n,r){this.iE=t,this.gE=e,this.pE=n,this.rE=r,this.yE=null,this.bE=null,this.metadata=new sl(n.hasPendingWrites,n.fromCache)}function dl(t,e,n){this.fE=t,this.firestore=e,this.rE=n}function yl(){return null!==Jf&&Jf.apply(this,arguments)||this}function vl(t,e,n,r,i,o){this.iE=t,this.kc=e,this._E=n,this.lE=r,this.dE=i,this.rE=o}function gl(t,e){this.hasPendingWrites=t,this.fromCache=e}function ml(t,e,n){this.kc=t,this.firestore=e,this.rE=n,this.QT=this.firestore.UT()}function wl(t){this.iE=t,this.hE=[],this.oE=!1}function bl(t,e){this.iE=t,this.nE=e}function El(t,e,n){var r=this;if(void 0===n&&(n=new Uf),this.BT=null,this.qT=new Tu,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.UT(),[4,this.QT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.BT=i,this.Nc=El.WT(i),this.jT=i.name,this.KT=new Sr(e)}else{var o=t;if(!o.projectId)throw new Ar(Nr.INVALID_ARGUMENT,"Must provide projectId");this.Nc=new Js(o.projectId,o.database),this.jT="[DEFAULT]",this.KT=new _r}this.GT=n,this.zT=new el({}),this.HT=new yc(this.Nc)}function Tl(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Ar(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ah("settings","non-empty string","host",t.host),this.host=t.host,_h("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Rh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),_h("settings","object","credentials",t.credentials),this.credentials=t.credentials,_h("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Bs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Bs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,_h("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Du.mh;else{if(t.cacheSizeBytes!==tl&&t.cacheSizeBytes<Du.Ah)throw new Ar(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Du.Ah);this.cacheSizeBytes=t.cacheSizeBytes}_h("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function Il(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.FT=n,this.converter=r}function Nl(t,e){if(void 0===e)return{merge:!1};if(Rh(t,e,["merge","mergeFields"]),_h(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+xh(n));for(var r,i=0;i<n.length;++i)if(!("string"==typeof(r=n[i])||r instanceof qh))throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+xh(n[i]))}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Al(t,e){return void 0===e?{}:(Rh(t,e,["serverTimestamps"]),Sh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function _l(t,e){Nh(t,"object",1,e),e&&(Rh(t,e,["source"]),Sh(t,0,"source",e.source,["default","server","cache"]))}function Sl(t,e,n){if(e instanceof ol){if(e.firestore!==n)throw new Ar(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Ph(t,"DocumentReference",1,e)}function kl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function Dl(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Ar(Nr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var xl,Ol=Dl(nl,"Use firebase.firestore() instead."),Rl=Dl(rl,"Use firebase.firestore().runTransaction() instead."),Pl=Dl(il,"Use firebase.firestore().batch() instead."),Vl=Dl(ol,"Use firebase.firestore().doc() instead."),Ll=Dl(ul),Cl=Dl(al),Ml=Dl(hl),Ul=Dl(cl),jl=Dl(fl,"Use firebase.firestore().collection() instead."),ql=Dl((Zl.delete=function(){return wh("FieldValue.delete",arguments),new Xh},Zl.serverTimestamp=function(){return wh("FieldValue.serverTimestamp",arguments),new $h},Zl.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Eh("FieldValue.arrayUnion",arguments,1),new Jh(t)},Zl.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Eh("FieldValue.arrayRemove",arguments,1),new Zh(t)},Zl.increment=function(t){return Ih("FieldValue.increment","number",1,t),bh("FieldValue.increment",arguments,1),new tc(t)},Zl.prototype.isEqual=function(t){return this===t},Zl),"Use FieldValue.<field>() instead."),Fl=Dl(jh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Bl={Firestore:Ol,GeoPoint:ec,Timestamp:xr,Blob:Fl,Transaction:Rl,WriteBatch:Pl,DocumentReference:Vl,DocumentSnapshot:Ll,Query:Ml,QueryDocumentSnapshot:Cl,QuerySnapshot:Ul,CollectionReference:jl,FieldPath:qh,FieldValue:ql,setLogLevel:nl.setLogLevel,CACHE_SIZE_UNLIMITED:tl},Gl=(Jl.prototype.x_=function(t){},Jl.prototype.hu=function(){},Jl),zl=($l.prototype.x_=function(t){this.kE.push(t)},$l.prototype.hu=function(){window.removeEventListener("online",this.DE),window.removeEventListener("offline",this.FE)},$l.prototype.$E=function(){window.addEventListener("online",this.DE),window.addEventListener("offline",this.FE)},$l.prototype.CE=function(){Fs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(0)},$l.prototype.NE=function(){Fs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(1)},$l.Uh=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},$l),Wl=(Xl.prototype.t_=function(t){this.OE=t},Xl.prototype.Hc=function(t){this.xE=t},Xl.prototype.onMessage=function(t){this.BE=t},Xl.prototype.close=function(){this.LE()},Xl.prototype.send=function(t){this.ME(t)},Xl.prototype.qE=function(){this.OE()},Xl.prototype.UE=function(t){this.xE(t)},Xl.prototype.QE=function(t){this.BE(t)},Xl),Ql={BatchGetDocuments:"batchGet",Commit:"commit"},Kl="gl-js/ fire/"+mr,Hl=(Yl.prototype.jE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=Kl},Yl.prototype.l_=function(a,r,i){var h=this,c=this.KE(a);return new Promise(function(o,s){var u=new gr;u.listenOnce(yr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case dr.NO_ERROR:var t=u.getResponseJson();Fs("Connection","XHR received:",JSON.stringify(t)),o(t);break;case dr.TIMEOUT:Fs("Connection",'RPC "'+a+'" timed out'),s(new Ar(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var e,n,r=u.getStatus();Fs("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Nr).indexOf(i)?i:Nr.UNKNOWN,s(new Ar(n,e.message))):s(new Ar(Nr.UNKNOWN,"Server responded with status "+u.getStatus())):(Fs("Connection",'RPC "'+a+'" failed'),s(new Ar(Nr.UNAVAILABLE,"Connection failed.")));break;default:zs()}}finally{Fs("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Fs("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.jE(n,i),u.send(c,"POST",e,n,15)})},Yl.prototype.d_=function(t,e,n){return this.l_(t,e,n)},Yl.prototype.e_=function(t,e){var n,r,i=[this.WE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=pr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.jE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Fs("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new Wl({ME:function(t){f?Fs("Connection","Not sending because WebChannel is closed:",t):(c||(Fs("Connection","Opening WebChannel transport."),h.open(),c=!0),Fs("Connection","WebChannel sending:",t),h.send(t))},LE:function(){return h.close()}});return a(vr.EventType.OPEN,function(){f||Fs("Connection","WebChannel transport opened.")}),a(vr.EventType.CLOSE,function(){f||(f=!0,Fs("Connection","WebChannel transport closed"),l.UE())}),a(vr.EventType.ERROR,function(t){f||(f=!0,Fs("Connection","WebChannel transport errored:",t),l.UE(new Ar(Nr.UNAVAILABLE,"The operation could not be completed")))}),a(vr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Ws(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Fs("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=uo[i];if(void 0!==t)return Ho(t)}(),s=r.message,void 0===o&&(o=Nr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.UE(new Ar(o,s)),h.close()):(Fs("Connection","WebChannel received:",n),l.QE(n)))}),setTimeout(function(){l.qE()},0),l},Yl.prototype.KE=function(t){var e=Ql[t];return this.WE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},Yl);function Yl(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.WE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Xl(t){this.ME=t.ME,this.LE=t.LE}function $l(){var t=this;this.DE=function(){return t.CE()},this.FE=function(){return t.NE()},this.kE=[],this.$E()}function Jl(){}function Zl(){}function tp(){this.oc="undefined"!=typeof atob}Cs.an((Object.defineProperty(tp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(tp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),tp.prototype.gT=function(t){return Promise.resolve(new Hl(t))},tp.prototype.wT=function(){return new(zl.Uh()?zl:Gl)},tp.prototype.yc=function(t){return new Ps(t,{hi:!0})},tp.prototype.un=function(t){return JSON.stringify(t)},tp.prototype.atob=function(t){return atob(t)},tp.prototype.btoa=function(t){return btoa(t)},tp.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new tp)),(xl=ep).INTERNAL.registerComponent(new E("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new nl(e,n,new jf);var e,n},"PUBLIC").setServiceProps(Object.assign({},Bl))),xl.registerVersion("@firebase/firestore","1.14.4-0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});