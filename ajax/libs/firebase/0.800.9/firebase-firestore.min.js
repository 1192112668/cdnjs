!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(Vv,Mv){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e,l,n,r=t(Mv),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function m(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(n=l=l||{})[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT";function a(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=f[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,u(["["+i+"]  "+t.name+":"],n))}}var c={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},h=l.INFO,f=((e={})[l.DEBUG]="log",e[l.VERBOSE]="log",e[l.INFO]="info",e[l.WARN]="warn",e[l.ERROR]="error",e),p=(Object.defineProperty(d.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),d.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?c[t]:t},Object.defineProperty(d.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),d.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.DEBUG],t)),this._logHandler.apply(this,u([this,l.DEBUG],t))},d.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.VERBOSE],t)),this._logHandler.apply(this,u([this,l.VERBOSE],t))},d.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.INFO],t)),this._logHandler.apply(this,u([this,l.INFO],t))},d.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.WARN],t)),this._logHandler.apply(this,u([this,l.WARN],t))},d.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.ERROR],t)),this._logHandler.apply(this,u([this,l.ERROR],t))},d);function d(t){this.name=t,this._logLevel=h,this._logHandler=a,this._userLogHandler=null}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var y,g=(o(b,y=Error),b);function b(t,e){var n=y.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,I.prototype.create),n}var I=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(T,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new g(o,a),h=0,f=Object.keys(i);h<f.length;h++){var l=f[h];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D=D||{},x=S||self;function O(){}function R(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function k(t){var e=R(t);return"array"==e||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var C="closure_uid_"+(1e9*Math.random()>>>0),P=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:V).apply(null,arguments)}function F(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var q=Date.now;function j(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function G(){this.j=this.j,this.i=this.i}G.prototype.j=!1,G.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,C)&&t[C]||(t[C]=++P))},G.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function H(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var W,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:e<t?1:0}t:{var J=x.navigator;if(J){var Z=J.userAgent;if(Z){W=Z;break t}}W=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e={};for(var n in t)e[n]=t[n];return e}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=O;var ot,st,ut=X(W,"Opera"),at=X(W,"Trident")||X(W,"MSIE"),ct=X(W,"Edge"),ht=ct||at,ft=X(W,"Gecko")&&!(X(W.toLowerCase(),"webkit")&&!X(W,"Edge"))&&!(X(W,"Trident")||X(W,"MSIE"))&&!X(W,"Edge"),lt=X(W.toLowerCase(),"webkit")&&!X(W,"Edge");function pt(){var t=x.document;return t?t.documentMode:void 0}t:{var dt="",vt=(st=W,ft?/rv:([^\);]+)(\)|;)/.exec(st):ct?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(vt&&(dt=vt?vt[1]:""),at){var yt=pt();if(null!=yt&&yt>parseFloat(dt)){ot=String(yt);break t}}ot=dt}var gt={};function mt(u){return t=u,e=function(){for(var t=0,e=Y(String(ot)).split("."),n=Y(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=$(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||$(0==o[2].length,0==s[2].length)||$(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=gt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var wt=x.document&&at?pt()||(parseInt(ot,10)||void 0):void 0,bt=!at||9<=Number(wt),It=at&&!mt("9"),Et=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{x.addEventListener("test",O,e),x.removeEventListener("test",O,e)}catch(t){}return t}();function Tt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function _t(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:At[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Tt.prototype.b=function(){this.defaultPrevented=!0},j(_t,Tt);var At={2:"touch",3:"pen",4:"mouse"};_t.prototype.b=function(){_t.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++St,this.Y=this.Z=!1}function xt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Ot(t){this.src=t,this.a={},this.b=0}function Rt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(xt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function kt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Ot.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=kt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Ct={};function Pt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Bt(r);return e&&e[Nt]?e.wa(n,r,L(i)?!!i.capture:!!i,o):Ut(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Pt(t,e[o],n,r,i);return null}return n=Bt(n),t&&t[Nt]?t.va(e,n,L(r)?!!r.capture:!!r,i):Ut(t,e,n,!1,r,i)}function Ut(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=L(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,c=jt(t);if(c||(t[Lt]=c=new Ot(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Et||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[Nt]?Rt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Rt(n,t),0==n.b&&(n.src=null,e[Lt]=null)):xt(t)))}function Mt(t){return t in Ct?Ct[t]:Ct[t]="on"+t}function Ft(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Vt(t),n.call(r,e)}function qt(t,e){if(t.Y)return!0;if(bt)return Ft(t,new _t(e,this));if(!e)t:{e=["window","event"];for(var n=x,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ft(t,e=new _t(e,this))}function jt(t){return(t=t[Lt])instanceof Ot?t:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(e){return"function"==R(e)?e:(e[Gt]||(e[Gt]=function(t){return e.handleEvent(t)}),e[Gt])}function zt(){G.call(this),this.c=new Ot(this),(this.J=this).C=null}function Ht(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Rt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(zt,G),zt.prototype[Nt]=!0,(N=zt.prototype).addEventListener=function(t,e,n,r){Pt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=Bt(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=kt(s=e.a[n],r,i,o))&&(xt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=kt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Tt(t,n):t instanceof Tt?t.target=t.target||n:(s=t,rt(t=new Tt(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Ht(o,r,!0,t)&&s;if(s=Ht(o=t.a=n,r,!0,t)&&s,s=Ht(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Ht(o=t.a=e[i],r,!1,t)&&s;return s},N.G=function(){if(zt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)xt(n[r]);delete e.a[t],e.b--}}this.C=null},N.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=x.JSON.stringify;function Kt(){this.b=this.a=null}var Wt,Yt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt(function(){return new $t},function(t){t.reset()},100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function $t(){this.next=this.b=this.a=null}function Jt(t){x.setTimeout(function(){throw t},0)}function Zt(t,e){var n;Wt||(n=x.Promise.resolve(void 0),Wt=function(){n.then(ne)}),te||(Wt(),te=!0),ee.add(t,e)}Kt.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Kt;function ne(){for(var t,e,n;n=e=void 0,n=null,(e=ee).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Jt(t)}var r=Yt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}te=!1}function re(t,e){zt.call(this),this.b=t||1,this.a=e||x,this.f=M(this.Ya,this),this.g=q()}function ie(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function oe(t,e,n){if("function"==R(t))n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:x.setTimeout(t,e||0)}j(re,zt),(N=re.prototype).aa=!1,N.M=null,N.Ya=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(ie(this),this.start())))},N.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},N.G=function(){re.S.G.call(this),ie(this),delete this.a};var se,ue,ae,ce=(_(ue=fe,ae=se=G),ue.prototype=null===ae?Object.create(ae):(he.prototype=ae.prototype,new he),fe.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=oe(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},fe.prototype.G=function(){se.prototype.G.call(this),this.a&&(x.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},fe);function he(){this.constructor=ue}function fe(t,e,n){var r=se.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function le(t){G.call(this),this.b=t,this.a={}}j(le,G);var pe=[];function de(t,e,n,r){Array.isArray(n)||(n&&(pe[0]=n.toString()),n=pe);for(var i=0;i<n.length;i++){var o=Pt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ve(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function ye(){this.a=!0}function ge(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}le.prototype.G=function(){le.S.G.call(this),ve(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ye.prototype.info=function(){};var me=null;function we(){return me=me||new zt}function be(t){Tt.call(this,"serverreachability",t)}function Ie(t){var e=we();e.dispatchEvent(new be(e))}function Ee(t){Tt.call(this,"statevent",t)}function Te(t){var e=we();e.dispatchEvent(new Ee(e))}function _e(t){Tt.call(this,"timingevent",t)}function Ae(t,e){if("function"!=R(t))throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){t()},e)}j(be,Tt),j(Ee,Tt),j(_e,Tt);var Ne={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Se={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function De(){}function xe(t){var e;return(e=t.a)||(e=t.a={}),e}function Oe(){}De.prototype.a=null;var Re,ke={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Le(){Tt.call(this,"d")}function Ce(){Tt.call(this,"c")}function Pe(){}function Ue(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new le(this),this.P=Ve,t=ht?125:void 0,this.R=new re(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}j(Le,Tt),j(Ce,Tt),j(Pe,De),Re=new Pe;var Ve=45e3,Me={},Fe={};function qe(t,e,n){t.H=1,t.i=cn(nn(e)),t.j=n,t.I=!0,je(t,null)}function je(t,e){t.u=q(),ze(t),t.l=nn(t.i);var s,u,a,c,h,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),En(n.b,"t",r),t.D=0,t.a=yr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ce(M(t.Ca,t,t.a),t.O)),de(t.J,t.a,"readystatechange",t.Wa),e=t.B?et(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ie(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Ge(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Be(t,n);if(i==Fe){4==e&&(t.h=4,Te(14),r=!1),ge(t.c,t.f,null,"[Incomplete Response]");break}if(i==Me){t.h=4,Te(15),ge(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}ge(t.c,t.f,i,null),Ye(t,i)}4==e&&0==n.length&&(t.h=1,Te(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),ar(e),e.F=!0)):(ge(t.c,t.f,n,"[Invalid Chunked Response]"),We(t),Ke(t))}function Be(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Fe:(n=Number(e.substring(n,r)),isNaN(n)?Me:(r+=1)+n>e.length?Fe:(e=e.substr(r,n),t.D=r+n,e))}function ze(t){t.U=q()+t.P,He(t,t.P)}function He(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ae(M(t.Ua,t),e)}function Qe(t){t.o&&(x.clearTimeout(t.o),t.o=null)}function Ke(t){0==t.g.v||t.A||fr(t.g,t)}function We(t){Qe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ie(t.R),ve(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ye(t,e){try{var n,r,i,o,s,u,a,c,h,f,l,p=t.g;if(0!=p.v&&(p.a==t||xn(p.b,t)))if(p.I=t.N,!t.C&&xn(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var v=d;if(0==v[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;hr(p),Zn(p)}ur(p),Te(18)}}else p.oa=v[1],0<p.oa-p.P&&v[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=Ae(M(p.Ra,p),6e3));if(Dn(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else pr(p,11)}else if(!t.C&&p.a!=t||hr(p),!K(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++){v=e[d],p.P=v[0],v=v[1],2==p.v?"c"==v[0]?(p.J=v[1],p.ga=v[2],null!=(n=v[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=v[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=v[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&(X(u,"spdy")||X(u,"quic")||X(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(On(a,a.b),a.b=null)),!o.A||(c=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=c,an(o.B,o.A,c))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=q()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),h=t,(o=p).la=vr(o,o.C?o.ga:null,o.fa),h.C?(Rn(o.b,h),f=h,(l=o.D)&&f.setTimeout(l),f.o&&(Qe(f),ze(f)),o.a=h):sr(o),0<p.g.length&&nr(p)):"stop"!=v[0]&&"close"!=v[0]||pr(p,7):3==p.v&&("stop"==v[0]||"close"==v[0]?"stop"==v[0]?pr(p,7):Jn(p):"noop"!=v[0]&&p.f&&p.f.sa(v),p.o=0)}Ie(4)}catch(t){}}function Xe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)z(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(k(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function $e(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof $e)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ze(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Ze(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Ue.prototype).setTimeout=function(t){this.P=t},N.Wa=function(t){t=t.target;var e=this.F;e&&3==Wn(t)?e.f():this.Ca(t)},N.Ca=function(t){try{if(t==this.a)t:{var e=Wn(this.a),n=this.a.ua(),r=this.a.X();if(!(e<3||3==e&&!ht&&!this.a.$())){this.A||4!=e||7==n||Ie(8==n||r<=0?3:2),Qe(this);var i=this.a.X();this.N=i;var o=this.a.$();if(this.b=200==i,c=this.c,h=this.m,f=this.l,l=this.f,p=this.T,d=e,v=i,c.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+p+"]: "+h+"\n"+f+"\n"+d+" "+v}),this.b){if(this.V&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,Te(12),We(this),Ke(this);break t}ge(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ye(this,a)}this.I?(Ge(this,e,o),ht&&this.b&&3==e&&(de(this.J,this.R,"tick",this.Va),this.R.start())):(ge(this.c,this.f,o,null),Ye(this,o)),4==e&&We(this),this.b&&!this.A&&(4==e?fr(this.g,this):(this.b=!1,ze(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Te(12)):(this.h=0,Te(13)),We(this),Ke(this)}}}catch(t){}var c,h,f,l,p,d,v},N.Va=function(){var t,e;this.a&&(t=Wn(this.a),e=this.a.$(),this.D<e.length&&(Qe(this),Ge(this,t,e),this.b&&4!=t&&ze(this)))},N.cancel=function(){this.A=!0,We(this)},N.Ua=function(){this.o=null;var t,e,n=q();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(Ie(3),Te(17)),We(this),this.h=2,Ke(this)):He(this,this.U-n)},(N=$e.prototype).K=function(){Je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.L=function(){return Je(this),this.a.concat()},N.get=function(t,e){return Ze(this.b,t)?this.b[t]:e},N.set=function(t,e){Ze(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var tn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function en(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof en?(this.a=void 0!==e?e:t.a,rn(this,t.f),this.j=t.j,on(this,t.c),sn(this,t.h),this.g=t.g,e=t.b,(n=new mn).c=e.c,e.a&&(n.a=new $e(e.a),n.b=e.b),un(this,n),this.i=t.i):t&&(n=String(t).match(tn))?(this.a=!!e,rn(this,n[1]||"",!0),this.j=hn(n[2]||""),on(this,n[3]||"",!0),sn(this,n[4]),this.g=hn(n[5]||"",!0),un(this,n[6]||"",!0),this.i=hn(n[7]||"")):(this.a=!!e,this.b=new mn(null,this.a))}function nn(t){return new en(t)}function rn(t,e,n){t.f=n?hn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function on(t,e,n){t.c=n?hn(e,!0):e}function sn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function un(t,e,n){var r,i;e instanceof mn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(wn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(bn(this,e),En(this,n,t))},r)),r.f=i):(n||(e=fn(e,yn)),t.b=new mn(e,t.a))}function an(t,e,n){t.b.set(e,n)}function cn(t){return an(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function hn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function fn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ln),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ln(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}en.prototype.toString=function(){var t=[],e=this.f;e&&t.push(fn(e,pn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(fn(e,pn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(fn(n,"/"==n.charAt(0)?vn:dn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",fn(n,gn)),t.join("")};var pn=/[#\/\?@]/g,dn=/[#\?:]/g,vn=/[#\?]/g,yn=/[#\?@]/g,gn=/#/g;function mn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function wn(n){n.a||(n.a=new $e,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function bn(t,e){wn(t),e=Tn(t,e),Ze(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ze((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Je(t)))}function In(t,e){return wn(t),e=Tn(t,e),Ze(t.a.b,e)}function En(t,e,n){bn(t,e),0<n.length&&(t.c=null,t.a.set(Tn(t,e),Q(n)),t.b+=n.length)}function Tn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function _n(t,e){this.b=t,this.a=e}function An(t){this.g=t||Nn,t=x.PerformanceNavigationTiming?0<(t=x.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(x.ia&&x.ia.ya&&x.ia.ya()&&x.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=mn.prototype).add=function(t,e){wn(this),this.c=null,t=Tn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){wn(this),this.a.forEach(function(t,e){z(t,function(t){n.call(r,t,e,this)},this)},this)},N.L=function(){wn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.K=function(t){wn(this);var e=[];if("string"==typeof t)In(this,t)&&(e=H(e,this.a.get(Tn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},N.set=function(t,e){return wn(this),this.c=null,In(this,t=Tn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var Nn=10;function Sn(t){return t.b||t.a&&t.a.size>=t.f}function Dn(t){return t.b?1:t.a?t.a.size:0}function xn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function On(t,e){t.a?t.a.add(e):t.b=e}function Rn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function kn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return Q(t.c);var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Ln(){}function Cn(){this.a=new Ln}function Pn(t,r,e){var i=e||"";try{Xe(t,function(t,e){var n=t;L(t)&&(n=Qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Un(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}An.prototype.cancel=function(){var e,t;if(this.c=kn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Ln.prototype.stringify=function(t){return x.JSON.stringify(t,void 0)},Ln.prototype.parse=function(t){return x.JSON.parse(t,void 0)};var Vn=x.JSON.parse;function Mn(t){zt.call(this),this.headers=new $e,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Fn,this.D=this.F=!1}j(Mn,zt);var Fn="",qn=/^https?$/i,jn=["POST","PUT"];function Gn(t){return"content-type"==t.toLowerCase()}function Bn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,zn(t),Qn(t)}function zn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Hn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=Wn(t)||2!=t.X()))if(t.l&&4==Wn(t))oe(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Wn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(tn)[1]||null)&&x.self&&x.self.location&&(i=(r=x.self.location.protocol).substr(0,r.length-1)),n=!qn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Wn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",zn(t)}}finally{Qn(t)}}}function Qn(t,e){if(t.a){Kn(t);var n=t.a,r=t.s[0]?O:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Kn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(x.clearTimeout(t.m),t.m=null)}function Wn(t){return t.a?t.a.readyState:0}function Yn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",tt(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):an(t,e,n))}function Xn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function $n(t){this.pa=0,this.g=[],this.c=new ye,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Xn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Xn("baseRetryDelayMs",5e3,t),this.Ma=Xn("retryDelaySeedMs",1e4,t),this.Ja=Xn("forwardChannelMaxRetries",2,t),this.ma=Xn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new An(t&&t.concurrentRequestLimit),this.ka=new Cn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Jn(t){var e,n;tr(t),3==t.v&&(e=t.R++,an(n=nn(t.B),"SID",t.J),an(n,"RID",e),an(n,"TYPE","terminate"),ir(t,n),(e=new Ue(t,t.c,e,void 0)).H=2,e.i=cn(nn(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(e.i.toString(),"")),!n&&x.Image&&((new Image).src=e.i,n=!0),n||(e.a=yr(e.g,null),e.a.ba(e.i)),e.u=q(),ze(e)),dr(t)}function Zn(t){t.a&&(ar(t),t.a.cancel(),t.a=null)}function tr(t){Zn(t),t.j&&(x.clearTimeout(t.j),t.j=null),hr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&x.clearTimeout(t.h),t.h=null)}function er(t,e){t.g.push(new _n(t.La++,e)),3==t.v&&nr(t)}function nr(t){Sn(t.b)||t.h||(t.h=!0,Zt(t.Ba,t),t.u=0)}function rr(t,e){var n=e?e.f:t.R++,r=nn(t.B);an(r,"SID",t.J),an(r,"RID",n),an(r,"AID",t.P),ir(t,r),t.i&&t.l&&Yn(r,t.i,t.l),n=new Ue(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=or(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),On(t.b,n),qe(n,r,e)}function ir(t,n){t.f&&Xe({},function(t,e){an(n,e,t)})}function or(t,e,n){n=Math.min(t.g.length,n);var r=t.f?M(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Pn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function sr(t){t.a||t.j||(t.U=1,Zt(t.Aa,t),t.o=0)}function ur(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=Ae(M(t.Aa,t),lr(t,t.o)),t.o++,1)}function ar(t){null!=t.s&&(x.clearTimeout(t.s),t.s=null)}function cr(t){t.a=new Ue(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=nn(t.la);an(e,"RID","rpc"),an(e,"SID",t.J),an(e,"CI",t.H?"0":"1"),an(e,"AID",t.P),ir(t,e),an(e,"TYPE","xmlhttp"),t.i&&t.l&&Yn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=cn(nn(e)),n.j=null,n.I=!0,je(n,t)}function hr(t){null!=t.m&&(x.clearTimeout(t.m),t.m=null)}function fr(t,e){var n,r=null;if(t.a==e){hr(t),ar(t),t.a=null;var i=2}else{if(!xn(t.b,e))return;r=e.s,Rn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=q()-e.u,n=t.u,(i=we()).dispatchEvent(new _e(i)),nr(t)):sr(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(Dn(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=Ae(M(t.Ba,t,e),lr(t,t.u)),t.u++,1}}(t,e)||2==i&&ur(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:pr(t,5);break;case 4:pr(t,10);break;case 3:pr(t,6);break;default:pr(t,2)}}function lr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function pr(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=M(t.Xa,t),n||(n=new en("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||rn(n,"https"),cn(n)),i=n.toString(),o=r,u=new ye,x.Image?((s=new Image).onload=F(Un,u,s,"TestLoadImage: loaded",!0,o),s.onerror=F(Un,u,s,"TestLoadImage: error",!1,o),s.onabort=F(Un,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=F(Un,u,s,"TestLoadImage: timeout",!1,o),x.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):Te(2),t.v=0,t.f&&t.f.ra(e),dr(t),tr(t)}function dr(t){t.v=0,t.I=-1,t.f&&(0==kn(t.b).length&&0==t.g.length||(t.b.c.length=0,Q(t.g),t.g.length=0),t.f.qa())}function vr(t,e,n){var r,i,o,s,u,a,c,h=(r=n)instanceof en?nn(r):new en(r,void 0);return""!=h.c?(e&&on(h,e+"."+h.c),sn(h,h.h)):(i=x.location,o=i.protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,c=new en(null,void 0),o&&rn(c,o),s&&on(c,s),u&&sn(c,u),a&&(c.g=a),h=c),t.W&&tt(t.W,function(t,e){an(h,e,t)}),e=t.A,n=t.na,e&&n&&an(h,e,n),an(h,"VER",t.ha),ir(t,h),h}function yr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Mn(t.Ka)).F=t.C,e}function gr(){}function mr(){if(at&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function wr(t,e){zt.call(this),this.a=new $n(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Er(this)}function br(t){Le.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Ce.call(this),this.status=1}function Er(t){this.a=t}(N=Mn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?xe(this.H):xe(Re),this.a.onreadystatechange=M(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Bn(this,t)}t=n||"";var i,o=new $e(this.headers);r&&Xe(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Gn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=x.FormData&&t instanceof x.FormData,0<=B(jn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Kn(this),0<this.o&&((this.D=(i=this.a,at&&mt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=M(this.xa,this)):this.m=oe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Bn(this,t)}},N.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Qn(this))},N.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Qn(this,!0)),Mn.S.G.call(this)},N.za=function(){this.j||(this.A||this.l||this.g?Hn(this):this.Ta())},N.Ta=function(){Hn(this)},N.X=function(){try{return 2<Wn(this)?this.a.status:-1}catch(t){return-1}},N.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Vn(e)}},N.ua=function(){return this.h},N.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=$n.prototype).ha=8,N.v=1,N.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ue(this,this.c,t,void 0),r=this.l;if(this.O&&(r?rt(r=et(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=or(this,n,e),an(i=nn(this.B),"RID",t),an(i,"CVER",22),this.A&&an(i,"X-HTTP-Session-Id",this.A),ir(this,i),this.i&&r&&Yn(i,this.i,r),On(this.b,n),this.Ga&&an(i,"TYPE","init"),this.da?(an(i,"$req",e),an(i,"SID","null"),n.V=!0,qe(n,i,null)):qe(n,i,e),this.v=2}}else 3==this.v&&(t?rr(this,t):0==this.g.length||Sn(this.b)||rr(this))},N.Aa=function(){var t;this.j=null,cr(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ae(M(this.Sa,this),t))},N.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Zn(this),cr(this))},N.Ra=function(){null!=this.m&&(this.m=null,Zn(this),ur(this),Te(19))},N.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),Te(2)):(this.c.info("Failed to ping google.com"),Te(1))},(N=gr.prototype).ta=function(){},N.sa=function(){},N.ra=function(){},N.qa=function(){},N.Ha=function(){},mr.prototype.a=function(t,e){return new wr(t,e)},j(wr,zt),(N=wr.prototype).addEventListener=function(t,e,n,r){wr.S.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){wr.S.removeEventListener.call(this,t,e,n,r)},N.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;Te(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=vr(t,null,t.fa),nr(t)},N.close=function(){Jn(this.a)},N.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,er(this.a,e)):this.g?((e={}).__data__=Qt(t),er(this.a,e)):er(this.a,t)},N.G=function(){this.a.f=null,delete this.f,Jn(this.a),delete this.a,wr.S.G.call(this)},j(br,Le),j(Ir,Ce),j(Er,gr),Er.prototype.ta=function(){this.a.dispatchEvent("a")},Er.prototype.sa=function(t){this.a.dispatchEvent(new br(t))},Er.prototype.ra=function(t){this.a.dispatchEvent(new Ir)},Er.prototype.qa=function(){this.a.dispatchEvent("b")},mr.prototype.createWebChannel=mr.prototype.a,wr.prototype.send=wr.prototype.Pa,wr.prototype.open=wr.prototype.Oa,wr.prototype.close=wr.prototype.close,Ne.NO_ERROR=0,Ne.TIMEOUT=8,Ne.HTTP_ERROR=6,Se.COMPLETE="complete",(Oe.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",zt.prototype.listen=zt.prototype.va,Mn.prototype.listenOnce=Mn.prototype.wa,Mn.prototype.getLastError=Mn.prototype.Qa,Mn.prototype.getLastErrorCode=Mn.prototype.ua,Mn.prototype.getStatus=Mn.prototype.X,Mn.prototype.getResponseJson=Mn.prototype.Na,Mn.prototype.getResponseText=Mn.prototype.$,Mn.prototype.send=Mn.prototype.ba;var Tr={createWebChannelTransport:function(){return new mr},ErrorCode:Ne,EventType:Se,WebChannel:Oe,XhrIo:Mn},_r=Tr.createWebChannelTransport,Ar=Tr.ErrorCode,Nr=Tr.EventType,Sr=Tr.WebChannel,Dr=Tr.XhrIo,xr=(Or.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Or.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Or.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Or);function Or(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Rr,kr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Lr=(o(Pr,Rr=Error),Pr),Cr=new p("@firebase/firestore");function Pr(t,e){var n=this;return(n=Rr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Ur(){return Cr.logLevel}function Vr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cr.logLevel<=l.DEBUG&&(e=n.map(qr),Cr.debug.apply(Cr,s(["Firestore (7.21.1): "+t],e)))}function Mr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cr.logLevel<=l.ERROR&&(e=n.map(qr),Cr.error.apply(Cr,s(["Firestore (7.21.1): "+t],e)))}function Fr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cr.logLevel<=l.WARN&&(e=n.map(qr),Cr.warn.apply(Cr,s(["Firestore (7.21.1): "+t],e)))}function qr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function jr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.21.1) INTERNAL ASSERTION FAILED: "+t;throw Mr(e),new Error(e)}function Gr(t){t||jr()}function Br(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Hr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Qr,Kr,Wr=(Object.defineProperty(ni.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),ni.prototype.isEqual=function(t){return 0===ni.i(this,t)},ni.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ni?t.forEach(function(t){e.push(t)}):e.push(t),this.o(e)},ni.prototype.limit=function(){return this.offset+this.length},ni.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},ni.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},ni.prototype.l=function(){return this.segments[this.offset]},ni.prototype._=function(){return this.get(this.length-1)},ni.prototype.get=function(t){return this.segments[this.offset+t]},ni.prototype.m=function(){return 0===this.length},ni.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ni.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ni.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ni.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},ni.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ni),Yr=(o(ei,Kr=Wr),ei.prototype.o=function(t,e,n){return new ei(t,e,n)},ei.prototype.R=function(){return this.A().join("/")},ei.prototype.toString=function(){return this.R()},ei.P=function(t){if(0<=t.indexOf("//"))throw new Lr(kr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ei(t.split("/").filter(function(t){return 0<t.length}))},ei.g=function(){return new ei([])},ei),Xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,$r=(o(ti,Qr=Wr),ti.prototype.o=function(t,e,n){return new ti(t,e,n)},ti.V=function(t){return Xr.test(t)},ti.prototype.R=function(){return this.A().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),ti.V(t)||(t="`"+t+"`"),t}).join(".")},ti.prototype.toString=function(){return this.R()},ti.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},ti.v=function(){return new ti(["__name__"])},ti.S=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Lr(kr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Lr(kr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Lr(kr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Lr(kr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ti(e)},ti.g=function(){return new ti([])},ti),Jr=(Zr.D=function(t){return new Zr(Yr.P(t))},Zr.C=function(t){return new Zr(Yr.P(t).u(5))},Zr.prototype.N=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Zr.prototype.isEqual=function(t){return null!==t&&0===Yr.i(this.path,t.path)},Zr.prototype.toString=function(){return this.path.toString()},Zr.i=function(t,e){return Yr.i(t.path,e.path)},Zr.F=function(t){return t.length%2==0},Zr.$=function(t){return new Zr(new Yr(t.slice()))},Zr);function Zr(t){this.path=t}function ti(){return null!==Qr&&Qr.apply(this,arguments)||this}function ei(){return null!==Kr&&Kr.apply(this,arguments)||this}function ni(t,e,n){void 0===e?e=0:e>t.length&&jr(),void 0===n?n=t.length-e:n>t.length-e&&jr(),this.segments=t,this.offset=e,this.t=n}function ri(t,e){if(0!==e.length)throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ii(e.length,"argument")+".")}function ii(t,e,n){if(e.length!==n)throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires "+Ii(n,"argument")+", but was called with "+Ii(e.length,"argument")+".")}function oi(t,e,n){if(e.length<n)throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ii(n,"argument")+", but was called with "+Ii(e.length,"argument")+".")}function si(t,e,n,r){if(e.length<n||e.length>r)throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ii(e.length,"argument")+".")}function ui(t,e,n,r){pi(t,e,bi(n)+" argument",r)}function ai(t,e,n,r){void 0!==r&&ui(t,e,n,r)}function ci(t,e,n,r){pi(t,e,n+" option",r)}function hi(t,e,n,r){void 0!==r&&ci(t,e,n,r)}function fi(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(vi(s))}var u=vi(n);throw new Lr(kr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function li(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Lr(kr.INVALID_ARGUMENT,"Invalid value "+vi(r)+" provided to function "+t+"() for its "+bi(n)+" argument. Acceptable values: "+e.join(", "));return r}function pi(t,e,n,r){if(!("object"===e?di(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=vi(r);throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function di(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function vi(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":jr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function yi(t,e,n){if(void 0===n)throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+bi(e)+" argument, but it was undefined.")}function gi(n,t,r){zr(t,function(t,e){if(r.indexOf(t)<0)throw new Lr(kr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function mi(t,e,n,r){var i=vi(r);return new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires its "+bi(n)+" argument to be a "+e+", but it was: "+i)}function wi(t,e,n){if(n<=0)throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires its "+bi(e)+" argument to be a positive number, but it was: "+n+".")}function bi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ii(t,e){return t+" "+e+(1===t?"":"s")}function Ei(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ti=(_i.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Ei(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},_i);function _i(){}function Ai(t,e){return t<e?-1:e<t?1:0}function Ni(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Si(t){return t+"\0"}var Di=(xi.fromBase64String=function(t){return new xi(atob(t))},xi.fromUint8Array=function(t){return new xi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},xi.prototype.toBase64=function(){return t=this.M,btoa(t);var t},xi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},xi.prototype.O=function(){return 2*this.M.length},xi.prototype.L=function(t){return Ai(this.M,t.M)},xi.prototype.isEqual=function(t){return this.M===t.M},xi);function xi(t){this.M=t}Di.B=new Di("");var Oi=(Ri.fromBase64String=function(t){try{return new Ri(Di.fromBase64String(t))}catch(t){throw new Lr(kr.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Ri.fromUint8Array=function(t){return new Ri(Di.fromUint8Array(t))},Ri.prototype.toBase64=function(){return this.q.toBase64()},Ri.prototype.toUint8Array=function(){return this.q.toUint8Array()},Ri.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Ri.prototype.isEqual=function(t){return this.q.isEqual(t.q)},Ri);function Ri(t){this.q=t}function ki(){if("undefined"==typeof Uint8Array)throw new Lr(kr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Li(){if("undefined"==typeof atob)throw new Lr(kr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Ci(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Pi,Ui=(o(Hi,Pi=Oi),Hi.fromBase64String=function(t){ii("Blob.fromBase64String",arguments,1),ui("Blob.fromBase64String","string",1,t),Li();try{return new Hi(Di.fromBase64String(t))}catch(t){throw new Lr(kr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Hi.fromUint8Array=function(t){if(ii("Blob.fromUint8Array",arguments,1),ki(),!(t instanceof Uint8Array))throw mi("Blob.fromUint8Array","Uint8Array",1,t);return new Hi(Di.fromUint8Array(t))},Hi.prototype.toBase64=function(){return ii("Blob.toBase64",arguments,0),Li(),Pi.prototype.toBase64.call(this)},Hi.prototype.toUint8Array=function(){return ii("Blob.toUint8Array",arguments,0),ki(),Pi.prototype.toUint8Array.call(this)},Hi.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Hi),Vi=(Object.defineProperty(zi.prototype,"W",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),zi.prototype.isEqual=function(t){return t instanceof zi&&t.projectId===this.projectId&&t.database===this.database},zi.prototype.L=function(t){return Ai(this.projectId,t.projectId)||Ai(this.database,t.database)},zi),Mi=(Bi.prototype.get=function(t){var e=this.j(t),n=this.G[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.K(s,t))return u}},Bi.prototype.has=function(t){return void 0!==this.get(t)},Bi.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},Bi.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},Bi.prototype.forEach=function(u){zr(this.G,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},Bi.prototype.m=function(){return Hr(this.G)},Bi),Fi=(Gi.now=function(){return Gi.fromMillis(Date.now())},Gi.fromDate=function(t){return Gi.fromMillis(t.getTime())},Gi.fromMillis=function(t){var e=Math.floor(t/1e3);return new Gi(e,1e6*(t-1e3*e))},Gi.prototype.toDate=function(){return new Date(this.toMillis())},Gi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Gi.prototype.H=function(t){return this.seconds===t.seconds?Ai(this.nanoseconds,t.nanoseconds):Ai(this.seconds,t.seconds)},Gi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Gi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Gi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Gi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Gi),qi=(ji.Y=function(t){return new ji(t)},ji.min=function(){return new ji(new Fi(0,0))},ji.prototype.L=function(t){return this.timestamp.H(t.timestamp)},ji.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ji.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ji.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ji.prototype.X=function(){return this.timestamp},ji);function ji(t){this.timestamp=t}function Gi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Lr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Lr(kr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Lr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Lr(kr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Bi(t,e){this.j=t,this.K=e,this.G={}}function zi(t,e){this.projectId=t,this.database=e||"(default)"}function Hi(){return null!==Pi&&Pi.apply(this,arguments)||this}function Qi(t){return null==t}function Ki(t){return 0===t&&1/t==-1/0}function Wi(t){return"number"==typeof t&&Number.isInteger(t)&&!Ki(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Yi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function Xi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Yi(t,e,n,r,i,o,s)}function $i(t){var e,n=t;return null===n.Z&&(e=n.path.R(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.R()+e.op.toString()+Jo(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.R()+e.dir;var e}).join(","),Qi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=La(n.startAt)),n.endAt&&(e+="|ub:",e+=La(n.endAt)),n.Z=e),n.Z}function Ji(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!Wo(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Pa(t.startAt,e.startAt)&&Pa(t.endAt,e.endAt)}function Zi(t){return Jr.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}function to(t){this.count=t}var eo,no,ro=(io.prototype.nt=function(t){return new io(this.target,this.targetId,this.tt,t,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},io.prototype.st=function(t,e){return new io(this.target,this.targetId,this.tt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},io.prototype.it=function(t){return new io(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,t,this.resumeToken)},io);function io(t,e,n,r,i,o,s){void 0===i&&(i=qi.min()),void 0===o&&(o=qi.min()),void 0===s&&(s=Di.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function oo(t){switch(t){case kr.OK:return jr();case kr.CANCELLED:case kr.UNKNOWN:case kr.DEADLINE_EXCEEDED:case kr.RESOURCE_EXHAUSTED:case kr.INTERNAL:case kr.UNAVAILABLE:case kr.UNAUTHENTICATED:return;case kr.INVALID_ARGUMENT:case kr.NOT_FOUND:case kr.ALREADY_EXISTS:case kr.PERMISSION_DENIED:case kr.FAILED_PRECONDITION:case kr.ABORTED:case kr.OUT_OF_RANGE:case kr.UNIMPLEMENTED:case kr.DATA_LOSS:return 1;default:return jr()}}function so(t){if(void 0===t)return Mr("GRPC error has no .code"),kr.UNKNOWN;switch(t){case eo.OK:return kr.OK;case eo.CANCELLED:return kr.CANCELLED;case eo.UNKNOWN:return kr.UNKNOWN;case eo.DEADLINE_EXCEEDED:return kr.DEADLINE_EXCEEDED;case eo.RESOURCE_EXHAUSTED:return kr.RESOURCE_EXHAUSTED;case eo.INTERNAL:return kr.INTERNAL;case eo.UNAVAILABLE:return kr.UNAVAILABLE;case eo.UNAUTHENTICATED:return kr.UNAUTHENTICATED;case eo.INVALID_ARGUMENT:return kr.INVALID_ARGUMENT;case eo.NOT_FOUND:return kr.NOT_FOUND;case eo.ALREADY_EXISTS:return kr.ALREADY_EXISTS;case eo.PERMISSION_DENIED:return kr.PERMISSION_DENIED;case eo.FAILED_PRECONDITION:return kr.FAILED_PRECONDITION;case eo.ABORTED:return kr.ABORTED;case eo.OUT_OF_RANGE:return kr.OUT_OF_RANGE;case eo.UNIMPLEMENTED:return kr.UNIMPLEMENTED;case eo.DATA_LOSS:return kr.DATA_LOSS;default:return jr()}}(no=eo=eo||{})[no.OK=0]="OK",no[no.CANCELLED=1]="CANCELLED",no[no.UNKNOWN=2]="UNKNOWN",no[no.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",no[no.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",no[no.NOT_FOUND=5]="NOT_FOUND",no[no.ALREADY_EXISTS=6]="ALREADY_EXISTS",no[no.PERMISSION_DENIED=7]="PERMISSION_DENIED",no[no.UNAUTHENTICATED=16]="UNAUTHENTICATED",no[no.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",no[no.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",no[no.ABORTED=10]="ABORTED",no[no.OUT_OF_RANGE=11]="OUT_OF_RANGE",no[no.UNIMPLEMENTED=12]="UNIMPLEMENTED",no[no.INTERNAL=13]="INTERNAL",no[no.UNAVAILABLE=14]="UNAVAILABLE",no[no.DATA_LOSS=15]="DATA_LOSS";var uo=(lo.prototype.rt=function(t,e){return new lo(this.i,this.root.rt(t,e,this.i).copy(null,null,co.ot,null,null))},lo.prototype.remove=function(t){return new lo(this.i,this.root.remove(t,this.i).copy(null,null,co.ot,null,null))},lo.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},lo.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},lo.prototype.m=function(){return this.root.m()},Object.defineProperty(lo.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),lo.prototype.at=function(){return this.root.at()},lo.prototype.ct=function(){return this.root.ct()},lo.prototype.ut=function(t){return this.root.ut(t)},lo.prototype.forEach=function(n){this.ut(function(t,e){return n(t,e),!1})},lo.prototype.toString=function(){var n=[];return this.ut(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},lo.prototype.ht=function(t){return this.root.ht(t)},lo.prototype.lt=function(){return new ao(this.root,null,this.i,!1)},lo.prototype._t=function(t){return new ao(this.root,t,this.i,!1)},lo.prototype.ft=function(){return new ao(this.root,null,this.i,!0)},lo.prototype.dt=function(t){return new ao(this.root,t,this.i,!0)},lo),ao=(fo.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},fo.prototype.It=function(){return 0<this.Tt.length},fo.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},fo),co=(ho.prototype.copy=function(t,e,n,r,i){return new ho(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},ho.prototype.m=function(){return!1},ho.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},ho.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},ho.prototype.min=function(){return this.left.m()?this:this.left.min()},ho.prototype.at=function(){return this.min().key},ho.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},ho.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},ho.prototype.Pt=function(){if(this.left.m())return ho.EMPTY;var t=this;return t.left.gt()||t.left.left.gt()||(t=t.yt()),(t=t.copy(null,null,null,t.left.Pt(),null)).Rt()},ho.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.m()||r.left.gt()||r.left.left.gt()||(r=r.yt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.gt()&&(r=r.Vt()),r.right.m()||r.right.gt()||r.right.left.gt()||(r=r.bt()),0===e(t,r.key)){if(r.right.m())return ho.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Pt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Rt()},ho.prototype.gt=function(){return this.color},ho.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},ho.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},ho.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},ho.prototype.vt=function(){var t=this.copy(null,null,ho.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},ho.prototype.Vt=function(){var t=this.copy(null,null,ho.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},ho.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},ho.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},ho.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw jr();if(this.right.gt())throw jr();var t=this.left.Ct();if(t!==this.right.Ct())throw jr();return t+(this.gt()?0:1)},ho);function ho(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ho.RED,this.left=null!=r?r:ho.EMPTY,this.right=null!=i?i:ho.EMPTY,this.size=this.left.size+1+this.right.size}function fo(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}function lo(t,e){this.i=t,this.root=e||co.EMPTY}function po(){this.size=0}co.EMPTY=null,co.RED=!0,co.ot=!1,co.EMPTY=(Object.defineProperty(po.prototype,"key",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(po.prototype,"value",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(po.prototype,"color",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(po.prototype,"left",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(po.prototype,"right",{get:function(){throw jr()},enumerable:!1,configurable:!0}),po.prototype.copy=function(t,e,n,r,i){return this},po.prototype.rt=function(t,e,n){return new co(t,e)},po.prototype.remove=function(t,e){return this},po.prototype.m=function(){return!0},po.prototype.ut=function(t){return!1},po.prototype.ht=function(t){return!1},po.prototype.at=function(){return null},po.prototype.ct=function(){return null},po.prototype.gt=function(){return!1},po.prototype.Dt=function(){return!0},po.prototype.Ct=function(){return 0},new po);var vo=(wo.prototype.has=function(t){return null!==this.data.get(t)},wo.prototype.first=function(){return this.data.at()},wo.prototype.last=function(){return this.data.ct()},Object.defineProperty(wo.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),wo.prototype.indexOf=function(t){return this.data.indexOf(t)},wo.prototype.forEach=function(n){this.data.ut(function(t,e){return n(t),!1})},wo.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(0<=this.i(r.key,t[1]))return;e(r.key)}},wo.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},wo.prototype.xt=function(t){var e=this.data._t(t);return e.It()?e.Et().key:null},wo.prototype.lt=function(){return new yo(this.data.lt())},wo.prototype._t=function(t){return new yo(this.data._t(t))},wo.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},wo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},wo.prototype.m=function(){return this.data.m()},wo.prototype.$t=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},wo.prototype.isEqual=function(t){if(!(t instanceof wo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.lt(),n=t.data.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(0!==this.i(r,i))return!1}return!0},wo.prototype.A=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},wo.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},wo.prototype.copy=function(t){var e=new wo(this.i);return e.data=t,e},wo),yo=(mo.prototype.Et=function(){return this.kt.Et().key},mo.prototype.It=function(){return this.kt.It()},mo),go=new uo(Jr.i);function mo(t){this.kt=t}function wo(t){this.i=t,this.data=new uo(this.i)}var bo=new uo(Jr.i);var Io=new uo(Jr.i),Eo=new vo(Jr.i);function To(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Eo,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var _o=new vo(Ai);var Ao=(jo.Lt=function(t){return new jo(t.i)},jo.prototype.has=function(t){return null!=this.Mt.get(t)},jo.prototype.get=function(t){return this.Mt.get(t)},jo.prototype.first=function(){return this.Ot.at()},jo.prototype.last=function(){return this.Ot.ct()},jo.prototype.m=function(){return this.Ot.m()},jo.prototype.indexOf=function(t){var e=this.Mt.get(t);return e?this.Ot.indexOf(e):-1},Object.defineProperty(jo.prototype,"size",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),jo.prototype.forEach=function(n){this.Ot.ut(function(t,e){return n(t),!1})},jo.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},jo.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},jo.prototype.isEqual=function(t){if(!(t instanceof jo))return!1;if(this.size!==t.size)return!1;for(var e=this.Ot.lt(),n=t.Ot.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(!r.isEqual(i))return!1}return!0},jo.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},jo.prototype.copy=function(t,e){var n=new jo;return n.i=this.i,n.Mt=t,n.Ot=e,n},jo),No=(qo.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);!n||0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):jr()},qo.prototype.qt=function(){var n=[];return this.Bt.ut(function(t,e){n.push(e)}),n},qo),So=(Fo.Kt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Fo(t,e,Ao.Lt(e),i,n,r,!0,!1)},Object.defineProperty(Fo.prototype,"hasPendingWrites",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),Fo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&na(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Fo),Do=(Mo.Jt=function(t,e){var n=new Map;return n.set(t,xo.Xt(t,e)),new Mo(qi.min(),n,_o,go,To())},Mo),xo=(Vo.Xt=function(t,e){return new Vo(Di.B,e,To(),To(),To())},Vo),Oo=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},Ro=function(t,e){this.targetId=t,this.re=e},ko=function(t,e,n,r){void 0===n&&(n=Di.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Lo=(Object.defineProperty(Uo.prototype,"Zt",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(Uo.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(Uo.prototype,"le",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(Uo.prototype,"_e",{get:function(){return this.he},enumerable:!1,configurable:!0}),Uo.prototype.fe=function(t){0<t.O()&&(this.he=!0,this.ce=t)},Uo.prototype.de=function(){var n=To(),r=To(),i=To();return this.ae.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:jr()}}),new xo(this.ce,this.ue,n,r,i)},Uo.prototype.we=function(){this.he=!1,this.ae=Bo()},Uo.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},Uo.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},Uo.prototype.Ee=function(){this.oe+=1},Uo.prototype.Ie=function(){--this.oe},Uo.prototype.Ae=function(){this.he=!0,this.ue=!0},Uo),Co=(Po.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof Vu?this.be(r,t.ie):t.ie instanceof Mu&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},Po.prototype.Se=function(n){var r=this;this.De(n,function(t){var e=r.Ce(t);switch(n.state){case 0:r.Ne(t)&&e.fe(n.resumeToken);break;case 1:e.Ie(),e.le||e.we(),e.fe(n.resumeToken);break;case 2:e.Ie(),e.le||r.removeTarget(t);break;case 3:r.Ne(t)&&(e.Ae(),e.fe(n.resumeToken));break;case 4:r.Ne(t)&&(r.Fe(t),e.fe(n.resumeToken));break;default:jr()}})},Po.prototype.De=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Pe.forEach(function(t,e){r.Ne(e)&&n(e)})},Po.prototype.xe=function(t){var e,n,r=t.targetId,i=t.re.count,o=this.$e(r);o&&(Zi(e=o.target)?0===i?(n=new Jr(e.path),this.ve(r,n,new Mu(n,qi.min()))):Gr(1===i):this.ke(r)!==i&&(this.Fe(r),this.Ve=this.Ve.add(r)))},Po.prototype.Me=function(i){var o=this,s=new Map;this.Pe.forEach(function(t,e){var n,r=o.$e(e);r&&(t.Zt&&Zi(r.target)&&(n=new Jr(r.target.path),null!==o.ge.get(n)||o.Oe(e,n)||o.ve(e,n,new Mu(n,i))),t._e&&(s.set(e,t.de()),t.we()))});var r=To();this.ye.forEach(function(t,e){var n=!0;e.Ft(function(t){var e=o.$e(t);return!e||2===e.tt||(n=!1)}),n&&(r=r.add(t))});var t=new Do(i,s,this.Ve,this.ge,r);return this.ge=go,this.ye=Go(),this.Ve=new vo(Ai),t},Po.prototype.be=function(t,e){var n;this.Ne(t)&&(n=this.Oe(t,e.key)?2:0,this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t)))},Po.prototype.ve=function(t,e,n){var r;this.Ne(t)&&(r=this.Ce(t),this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n)))},Po.prototype.removeTarget=function(t){this.Pe.delete(t)},Po.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},Po.prototype.Ee=function(t){this.Ce(t).Ee()},Po.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new Lo,this.Pe.set(t,e)),e},Po.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new vo(Ai),this.ye=this.ye.rt(t,e)),e},Po.prototype.Ne=function(t){var e=null!==this.$e(t);return e||Vr("WatchChangeAggregator","Detected inactive target",t),e},Po.prototype.$e=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},Po.prototype.Fe=function(e){var n=this;this.Pe.set(e,new Lo),this.Re.Be(e).forEach(function(t){n.ve(e,t,null)})},Po.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},Po);function Po(t){this.Re=t,this.Pe=new Map,this.ge=go,this.ye=Go(),this.Ve=new vo(Ai)}function Uo(){this.oe=0,this.ae=Bo(),this.ce=Di.B,this.ue=!1,this.he=!0}function Vo(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}function Mo(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}function Fo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function qo(){this.Bt=new uo(Jr.i)}function jo(n){this.i=n?function(t,e){return n(t,e)||Jr.i(t.key,e.key)}:function(t,e){return Jr.i(t.key,e.key)},this.Mt=bo,this.Ot=new uo(this.i)}function Go(){return new uo(Jr.i)}function Bo(){return new uo(Jr.i)}function zo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ho(t){var e=Zo(t.mapValue.fields.__local_write_time__.timestampValue);return new Fi(e.seconds,e.nanos)}var Qo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ko(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?zo(t)?4:10:jr()}function Wo(r,i){var t,e,n,o=Ko(r);if(o!==Ko(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Ho(r).isEqual(Ho(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Zo(r.timestampValue),n=Zo(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,es(r.bytesValue).isEqual(es(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,ts((t=r).geoPointValue.latitude)===ts(e.geoPointValue.latitude)&&ts(t.geoPointValue.longitude)===ts(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ts(t.integerValue)===ts(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ts(t.doubleValue),r=ts(e.doubleValue);return n===r?Ki(n)===Ki(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Ni(r.arrayValue.values||[],i.arrayValue.values||[],Wo);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Br(t)!==Br(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!Wo(t[n],e[n])))return!1;return!0}();default:return jr()}}function Yo(t,e){return void 0!==(t.values||[]).find(function(t){return Wo(t,e)})}function Xo(t,e){var n,r,i,o,s,u,a,c,h,f,l=Ko(t),p=Ko(e);if(l!==p)return Ai(l,p);switch(l){case 0:return 0;case 1:return Ai(t.booleanValue,e.booleanValue);case 2:return c=e,h=ts(t.integerValue||t.doubleValue),f=ts(c.integerValue||c.doubleValue),h<f?-1:f<h?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1;case 3:return $o(t.timestampValue,e.timestampValue);case 4:return $o(Ho(t),Ho(e));case 5:return Ai(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=es(o),a=es(s),u.L(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ai(n[i],r[i]);if(0!==o)return o}return Ai(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Ai(ts(n.latitude),ts(r.latitude)))?i:Ai(ts(n.longitude),ts(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Xo(n[i],r[i]);if(o)return o}return Ai(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Ai(r[s],o[s]);if(0!==u)return u;var a=Xo(n[r[s]],i[o[s]]);if(0!==a)return a}return Ai(r.length,o.length)}(t.mapValue,e.mapValue);default:throw jr()}}function $o(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ai(t,e);var n=Zo(t),r=Zo(e),i=Ai(n.seconds,r.seconds);return 0!==i?i:Ai(n.nanos,r.nanos)}function Jo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Zo(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?es(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Jr.C(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):jr();var t,e,n}(t)}function Zo(t){if(Gr(!!t),"string"!=typeof t)return{seconds:ts(t.seconds),nanos:ts(t.nanos)};var e,n=0,r=Qo.exec(t);Gr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function ts(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function es(t){return"string"==typeof t?Di.fromBase64String(t):Di.fromUint8Array(t)}function ns(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function rs(t){return t&&"integerValue"in t}function is(t){return!!t&&"arrayValue"in t}function os(t){return t&&"nullValue"in t}function ss(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function us(t){return t&&"mapValue"in t}var as={asc:"ASCENDING",desc:"DESCENDING"},cs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hs=function(t,e){this.U=t,this.Ue=e};function fs(t){return{integerValue:""+t}}function ls(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ki(e)?"-0":e}}function ps(t,e){return Wi(e)?fs(e):ls(t,e)}function ds(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function vs(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function ys(t){return Gr(!!t),qi.Y((e=Zo(t),new Fi(e.seconds,e.nanos)));var e}function gs(t,e){return new Yr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).R()}function ms(t){var e=Yr.P(t);return Gr(Cs(e)),e}function ws(t,e){return gs(t.U,e.path)}function bs(t,e){var n=ms(e);return Gr(n.get(1)===t.U.projectId),Gr(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new Jr(_s(n))}function Is(t,e){return gs(t.U,e)}function Es(t){var e=ms(t);return 4===e.length?Yr.g():_s(e)}function Ts(t){return new Yr(["projects",t.U.projectId,"databases",t.U.database]).R()}function _s(t){return Gr(4<t.length&&"documents"===t.get(4)),t.u(5)}function As(t,e,n){return{name:ws(t,e),fields:n.proto.mapValue.fields}}function Ns(t,e){var n,r,i,o,s,u;if(e instanceof pu)n={update:As(t,e.key,e.value)};else if(e instanceof _u)n={delete:ws(t,e.key)};else if(e instanceof du)n={update:As(t,e.key,e.data),updateMask:(r=e.Qe,i=[],r.fields.forEach(function(t){return i.push(t.R())}),{fieldPaths:i})};else if(e instanceof wu)n={transform:{document:ws(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Fs)return{fieldPath:t.field.R(),setToServerValue:"REQUEST_TIME"};if(e instanceof qs)return{fieldPath:t.field.R(),appendMissingElements:{values:e.elements}};if(e instanceof Hs)return{fieldPath:t.field.R(),removeAllFromArray:{values:e.elements}};if(e instanceof Ys)return{fieldPath:t.field.R(),increment:e.We};throw jr()})}};else{if(!(e instanceof Au))return jr();n={verify:ws(t,e.key)}}return e.Ke.je||(n.currentDocument=void 0!==(o=e.Ke).updateTime?{updateTime:(s=t,u=o.updateTime,ds(s,u.X()))}:void 0!==o.exists?{exists:o.exists}:jr()),n}function Ss(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?ru.updateTime(ys(n.updateTime)):void 0!==n.exists?ru.exists(n.exists):ru.Ge():ru.Ge();if(t.update){t.update.name;var o=bs(e,t.update.name),s=new Nu({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Zs(r.map(function(t){return $r.S(t)})));return new du(o,s,u,i)}return new pu(o,s,i)}if(t.delete){var a=bs(e,t.delete);return new _u(a,i)}if(t.transform){var c=bs(e,t.transform.document),h=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(Gr("REQUEST_TIME"===e.setToServerValue),i=new Fs):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new qs(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new Hs(r)):"increment"in e?i=new Ys(t,e.increment):jr();var o=$r.S(e.fieldPath);return new tu(o,i)}(e,t)});return Gr(!0===i.exists),new wu(c,h)}if(t.verify){var f=bs(e,t.verify);return new Au(f,i)}return jr()}function Ds(t,e){return{documents:[Is(t,e.path)]}}function xs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Is(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Is(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){if("=="===t.op){if(ss(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NAN"}};if(os(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ss(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NOT_NAN"}};if(os(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ks(t.field),op:(e=t.op,cs[e]),value:t.value}};var e});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:ks((e=t).field),direction:(n=e.dir,as[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Ue||Qi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Os(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Os(e.endAt)),n}function Os(t){return{before:t.before,values:t.position}}function Rs(t){var e=!!t.before,n=t.values||[];return new Da(n,e)}function ks(t){return{fieldPath:t.R()}}function Ls(t){return $r.S(t.fieldPath)}function Cs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ps(){this.ze=void 0}function Us(t,e){return t instanceof Ys?rs(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Vs,Ms,Fs=(o(Gs,Ms=Ps),Gs),qs=(o(js,Vs=Ps),js);function js(t){var e=this;return(e=Vs.call(this)||this).elements=t,e}function Gs(){return null!==Ms&&Ms.apply(this,arguments)||this}function Bs(t,e){for(var n=Js(e),r=function(e){n.some(function(t){return Wo(t,e)})||n.push(e)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var zs,Hs=(o(Qs,zs=Ps),Qs);function Qs(t){var e=this;return(e=zs.call(this)||this).elements=t,e}function Ks(t,e){for(var n=Js(e),r=function(e){n=n.filter(function(t){return!Wo(t,e)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ws,Ys=(o(Xs,Ws=Ps),Xs);function Xs(t,e){var n=this;return(n=Ws.call(this)||this).serializer=t,n.We=e,n}function $s(t){return ts(t.integerValue||t.doubleValue)}function Js(t){return is(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Zs=(eu.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},eu.prototype.isEqual=function(t){return Ni(this.fields,t.fields,function(t,e){return t.isEqual(e)})},eu),tu=function(t,e){this.field=t,this.transform=e};function eu(t){(this.fields=t).sort($r.i)}function nu(t,e){this.version=t,this.transformResults=e}var ru=(iu.Ge=function(){return new iu},iu.exists=function(t){return new iu(void 0,t)},iu.updateTime=function(t){return new iu(t)},Object.defineProperty(iu.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),iu.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},iu);function iu(t,e){this.updateTime=t,this.exists=e}function ou(t,e){return void 0!==t.updateTime?e instanceof Vu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Vu}function su(){}function uu(t,e,n){return t instanceof pu?new Vu(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof du?function(t,e,n){if(!ou(t.Ke,e))return new Fu(t.key,n.version);var r=gu(t,e);return new Vu(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof wu?function(t,e,n){if(Gr(null!=n.transformResults),!ou(t.Ke,e))return new Fu(t.key,n.version);var r=e,i=function(t,e,n){var r=[];Gr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],c=a.transform,h=null;e instanceof Vu&&(h=e.field(a.field)),r.push((i=c,o=h,s=n[u],i instanceof qs?Bs(i,o):i instanceof Hs?Ks(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Iu(t,r.data(),i);return new Vu(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):new Mu(t.key,n.version,{hasCommittedMutations:!0})}function au(t,e,n,r){return t instanceof pu?function(t,e){if(!ou(t.Ke,e))return e;var n=hu(e);return new Vu(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof du?function(t,e){if(!ou(t.Ke,e))return e;var n=hu(e),r=gu(t,e);return new Vu(t.key,n,r,{Ye:!0})}(t,e):t instanceof wu?function(t,e,n,r){if(!ou(t.Ke,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,c,h,f=[],l=0,p=t;l<p.length;l++){var d=p[l],v=d.transform,y=null;n instanceof Vu&&(y=n.field(d.field)),null===y&&r instanceof Vu&&(y=r.field(d.field)),f.push((o=y,s=e,h=c=a=u=void 0,(i=v)instanceof Fs?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof qs?Bs(i,o):i instanceof Hs?Ks(i,o):(a=Us(u=i,o),c=$s(a)+$s(u.We),rs(a)&&rs(u.We)?fs(c):ls(u.serializer,c))))}return f}(t.fieldTransforms,n,e,r),s=Iu(t,i.data(),o);return new Vu(t.key,i.version,s,{Ye:!0})}(t,e,r,n):(o=e,ou((i=t).Ke,o)?new Mu(i.key,qi.min()):o);var i,o}function cu(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||Ni(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof qs&&o instanceof qs||i instanceof Hs&&o instanceof Hs?Ni(i.elements,o.elements,Wo):i instanceof Ys&&o instanceof Ys?Wo(i.We,o.We):i instanceof Fs&&o instanceof Fs);var n,r,i,o}))}function hu(t){return t instanceof Vu?t.version:qi.min()}var fu,lu,pu=(o(yu,lu=su),yu),du=(o(vu,fu=su),vu);function vu(t,e,n,r){var i=this;return(i=fu.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ke=r,i.type=1,i}function yu(t,e,n){var r=this;return(r=lu.call(this)||this).key=t,r.value=e,r.Ke=n,r.type=0,r}function gu(t,e){return n=t,r=e instanceof Vu?e.data():Nu.empty(),i=new Su(r),n.Qe.fields.forEach(function(t){var e;t.m()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.Je();var n,r,i}var mu,wu=(o(bu,mu=su),bu);function bu(t,e){var n=this;return(n=mu.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ke=ru.exists(!0),n}function Iu(t,e,n){for(var r=new Su(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var Eu,Tu,_u=(o(Ru,Tu=su),Ru),Au=(o(Ou,Eu=su),Ou),Nu=(xu.empty=function(){return new xu({mapValue:{}})},xu.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!us(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},xu.prototype.isEqual=function(t){return Wo(this.proto,t.proto)},xu),Su=(Du.prototype.set=function(t,e){return this.tn(t,e),this},Du.prototype.delete=function(t){return this.tn(t,null),this},Du.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Ko(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t._(),e)},Du.prototype.Je=function(){var t=this.en($r.g(),this.Ze);return null!=t?new Nu(t):this.Xe},Du.prototype.en=function(r,t){var i=this,o=!1,e=this.Xe.field(r),s=us(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.en(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Du);function Du(t){void 0===t&&(t=Nu.empty()),this.Xe=t,this.Ze=new Map}function xu(t){this.proto=t}function Ou(t,e){var n=this;return(n=Eu.call(this)||this).key=t,n.Ke=e,n.type=4,n}function Ru(t,e){var n=this;return(n=Tu.call(this)||this).key=t,n.Ke=e,n.type=3,n}function ku(t){var u=[];return zr(t.fields||{},function(t,e){var n=new $r([t]);if(us(e)){var r=ku(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Zs(u)}function Lu(t,e){this.key=t,this.version=e}var Cu,Pu,Uu,Vu=(o(Bu,Uu=Lu),Bu.prototype.field=function(t){return this.nn.field(t)},Bu.prototype.data=function(){return this.nn},Bu.prototype.sn=function(){return this.nn.proto},Bu.prototype.isEqual=function(t){return t instanceof Bu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},Bu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.nn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Bu.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Bu),Mu=(o(Gu,Pu=Lu),Gu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Gu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Gu.prototype.isEqual=function(t){return t instanceof Gu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Gu),Fu=(o(ju,Cu=Lu),ju.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ju.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),ju.prototype.isEqual=function(t){return t instanceof ju&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ju),qu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function ju(){return null!==Cu&&Cu.apply(this,arguments)||this}function Gu(t,e,n){var r=this;return(r=Pu.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Bu(t,e,n,r){var i=this;return(i=Uu.call(this,t,e)||this).nn=n,i.Ye=!!r.Ye,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function zu(t,e,n,r,i,o,s,u){return new qu(t,e,n,r,i,o,s,u)}function Hu(t){return new qu(t)}function Qu(t){return!Qi(t.limit)&&"F"===t.on}function Ku(t){return!Qi(t.limit)&&"L"===t.on}function Wu(t){return 0<t.rn.length?t.rn[0].field:null}function Yu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function Xu(t){return null!==t.collectionGroup}function $u(t){var e=t;if(null===e.an){e.an=[];var n=Yu(e),r=Wu(e);if(null!==n&&null===r)n.p()||e.an.push(new Ua(n)),e.an.push(new Ua($r.v(),"asc"));else{for(var i,o=!1,s=0,u=e.rn;s<u.length;s++){var a=u[s];e.an.push(a),a.field.p()&&(o=!0)}o||(i=0<e.rn.length?e.rn[e.rn.length-1].dir:"asc",e.an.push(new Ua($r.v(),i)))}}return e.an}function Ju(t){var e=t;if(!e.cn)if("F"===e.on)e.cn=Xi(e.path,e.collectionGroup,$u(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=$u(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ua(o.field,s))}var u=e.endAt?new Da(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Da(e.startAt.position,!e.startAt.before):null;e.cn=Xi(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function Zu(t,e,n){return new qu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ta(t,e){return new qu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function ea(t,e){return new qu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function na(t,e){return Ji(Ju(t),Ju(e))&&t.on===e.on}function ra(t){return $i(Ju(t))+"|lt:"+t.on}function ia(t){return"Query(target="+(e=Ju(t),n=e.path.R(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.R()+" "+e.op+" "+Jo(e.value);var e}).join(", ")+"]"),Qi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.R()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+La(e.startAt)),e.endAt&&(n+=", endAt: "+La(e.endAt)),"Target("+n+")")+"; limitType="+t.on+")";var e,n}function oa(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.N(r.collectionGroup)&&r.path.T(o):Jr.F(r.path)?r.path.isEqual(o):r.path.I(o))&&function(t){for(var e=0,n=i.rn;e<n.length;e++){var r=n[e];if(!r.field.p()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||Ca(e.startAt,$u(e),n))&&(!e.endAt||!Ca(e.endAt,$u(e),n)));var e,n,r,o}function sa(u){return function(t,e){for(var n=!1,r=0,i=$u(u);r<i.length;r++){var o=i[r],s=Va(o,t,e);if(0!==s)return s;n=n||o.field.p()}return 0}}var ua,aa=(o(ca,ua=function(){}),ca.create=function(t,e,n){if(t.p())return"in"===e||"not-in"===e?this.hn(t,e,n):new pa(t,e,n);if(os(n)){if("=="!==e&&"!="!==e)throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new ca(t,e,n)}if(ss(n)){if("=="!==e&&"!="!==e)throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new ca(t,e,n)}return"array-contains"===e?new _a(t,n):"in"===e?new Aa(t,n):"not-in"===e?new Na(t,n):"array-contains-any"===e?new Sa(t,n):new ca(t,e,n)},ca.hn=function(t,e,n){return new("in"===e?da:va)(t,n)},ca.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.ln(Xo(e,this.value)):null!==e&&Ko(this.value)===Ko(e)&&this.ln(Xo(e,this.value))},ca.prototype.ln=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return jr()}},ca.prototype.un=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},ca);function ca(t,e,n){var r=this;return(r=ua.call(this)||this).field=t,r.op=e,r.value=n,r}var ha,fa,la,pa=(o(ma,la=aa),ma.prototype.matches=function(t){var e=Jr.i(t.key,this.key);return this.ln(e)},ma),da=(o(ga,fa=aa),ga.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},ga),va=(o(ya,ha=aa),ya.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},ya);function ya(t,e){var n=this;return(n=ha.call(this,t,"not-in",e)||this).keys=wa(0,e),n}function ga(t,e){var n=this;return(n=fa.call(this,t,"in",e)||this).keys=wa(0,e),n}function ma(t,e,n){var r=this;return(r=la.call(this,t,e,n)||this).key=Jr.C(n.referenceValue),r}function wa(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Jr.C(t.referenceValue)})}var ba,Ia,Ea,Ta,_a=(o(ka,Ta=aa),ka.prototype.matches=function(t){var e=t.field(this.field);return is(e)&&Yo(e.arrayValue,this.value)},ka),Aa=(o(Ra,Ea=aa),Ra.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Yo(this.value.arrayValue,e)},Ra),Na=(o(Oa,Ia=aa),Oa.prototype.matches=function(t){if(Yo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!Yo(this.value.arrayValue,e)},Oa),Sa=(o(xa,ba=aa),xa.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!is(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Yo(e.value.arrayValue,t)})},xa),Da=function(t,e){this.position=t,this.before=e};function xa(t,e){return ba.call(this,t,"array-contains-any",e)||this}function Oa(t,e){return Ia.call(this,t,"not-in",e)||this}function Ra(t,e){return Ea.call(this,t,"in",e)||this}function ka(t,e){return Ta.call(this,t,"array-contains",e)||this}function La(t){return(t.before?"b":"a")+":"+t.position.map(Jo).join(",")}function Ca(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.p()?Jr.i(Jr.C(s.referenceValue),n.key):Xo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Pa(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Wo(t.position[n],e.position[n]))return!1;return!0}var Ua=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Va(t,e,n){var r,i,o,s,u=t.field.p()?Jr.i(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?Xo(o,s):jr());switch(t.dir){case"asc":return u;case"desc":return-1*u;default:return jr()}}function Ma(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Fa,qa=(Ya.prototype.reset=function(){this.Tn=0},Ya.prototype.An=function(){this.Tn=this.mn},Ya.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);0<i&&Vr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Tn+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.En=this._n.gn(this.fn,i,function(){return e.In=Date.now(),t()}),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},Ya.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},Ya.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},Ya.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},Ya),ja=(Wa.prototype.catch=function(t){return this.next(void 0,t)},Wa.prototype.next=function(r,i){var o=this;return this.Sn&&jr(),this.Sn=!0,this.vn?this.error?this.Dn(i,this.error):this.Cn(r,this.result):new Wa(function(e,n){o.pn=function(t){o.Cn(r,t).next(e,n)},o.bn=function(t){o.Dn(i,t).next(e,n)}})},Wa.prototype.Nn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Wa.prototype.Fn=function(t){try{var e=t();return e instanceof Wa?e:Wa.resolve(e)}catch(t){return Wa.reject(t)}},Wa.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):Wa.resolve(e)},Wa.prototype.Dn=function(t,e){return t?this.Fn(function(){return t(e)}):Wa.reject(e)},Wa.resolve=function(n){return new Wa(function(t,e){t(n)})},Wa.reject=function(n){return new Wa(function(t,e){e(n)})},Wa.xn=function(t){return new Wa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Wa.$n=function(t){for(var n=Wa.resolve(!1),e=function(e){n=n.next(function(t){return t?Wa.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Wa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.xn(i)},Wa),Ga=(Ka.delete=function(t){return Vr("SimpleDb","Removing database:",t),ec(window.indexedDB.deleteDatabase(t)).Nn()},Ka.On=function(){if("undefined"==typeof indexedDB)return!1;if(Ka.Ln())return!0;var t=v(),e=Ka.Mn(t),n=0<e&&e<10,r=Ka.Bn(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ka.Ln=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.qn)},Ka.Un=function(t,e){return t.store(e)},Ka.Mn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ka.Bn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ka.prototype.Qn=function(){return m(this,void 0,void 0,function(){var e,o=this;return w(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Vr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(n,r){var i=indexedDB.open(o.name,o.version);i.onsuccess=function(t){var e=t.target.result;n(e)},i.onblocked=function(){r(new za("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Lr(kr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new za(e))},i.onupgradeneeded=function(t){Vr("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;o.kn.createOrUpgrade(e,i.transaction,t.oldVersion,o.version).next(function(){Vr("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return o.Wn(t)}),this.db)]}})})},Ka.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Ka.prototype.runTransaction=function(r,c,h){return m(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,a.Qn()];case 2:return a.db=t.sent(),e=$a.open(a.db,s?"readonly":"readwrite",c),n=h(e).catch(function(t){return e.abort(t),ja.reject(t)}).Nn(),r={},n.catch(function(){}),[4,e.Kn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Vr("SimpleDb","Transaction failed with error:",i.message,"Retrying:",o),a.close(),o?[3,5]:[2,{value:Promise.reject(i)}];case 5:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Ka.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Ka),Ba=(Object.defineProperty(Qa.prototype,"vn",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(Qa.prototype,"Yn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(Qa.prototype,"cursor",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),Qa.prototype.done=function(){this.zn=!0},Qa.prototype.Jn=function(t){this.Hn=t},Qa.prototype.delete=function(){return ec(this.Gn.delete())},Qa),za=(o(Ha,Fa=Lr),Ha);function Ha(t){var e=this;return(e=Fa.call(this,kr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Qa(t){this.Gn=t,this.zn=!1,this.Hn=null}function Ka(t,e,n){this.name=t,this.version=e,this.kn=n,12.2===Ka.Mn(v())&&Mr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Wa(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t(function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)},function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)})}function Ya(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}function Xa(t){return"IndexedDbTransactionError"===t.name}var $a=(tc.open=function(t,e,n){try{return new tc(t.transaction(n,e))}catch(t){throw new za(t)}},Object.defineProperty(tc.prototype,"Kn",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),tc.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(Vr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},tc.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ja(e)},tc),Ja=(Za.prototype.put=function(t,e){var n=void 0!==e?(Vr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Vr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return ec(n)},Za.prototype.add=function(t){return Vr("SimpleDb","ADD",this.store.name,t,t),ec(this.store.add(t))},Za.prototype.get=function(e){var n=this;return ec(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Vr("SimpleDb","GET",n.store.name,e,t),t})},Za.prototype.delete=function(t){return Vr("SimpleDb","DELETE",this.store.name,t),ec(this.store.delete(t))},Za.prototype.count=function(){return Vr("SimpleDb","COUNT",this.store.name),ec(this.store.count())},Za.prototype.Zn=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ts(n,function(t,e){r.push(e)}).next(function(){return r})},Za.prototype.es=function(t,e){Vr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ns=!1;var r=this.cursor(n);return this.ts(r,function(t,e,n){return n.delete()})},Za.prototype.ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ts(r,e)},Za.prototype.rs=function(i){var t=this.cursor({});return new ja(function(n,r){t.onerror=function(t){var e=rc(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Za.prototype.ts=function(t,s){var u=[];return new ja(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Ba(i),(n=s(i.primaryKey,i.value,e))instanceof ja&&(r=n.catch(function(t){return e.done(),ja.reject(t)}),u.push(r)),e.vn?o():null===e.Yn?i.continue():i.continue(e.Yn)):o()}}).next(function(){return ja.xn(u)})},Za.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Za.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Za);function Za(t){this.store=t}function tc(t){var n=this;this.transaction=t,this.aborted=!1,this.Xn=new Ma,this.transaction.oncomplete=function(){n.Xn.resolve()},this.transaction.onabort=function(){t.error?n.Xn.reject(new za(t.error)):n.Xn.resolve()},this.transaction.onerror=function(t){var e=rc(t.target.error);n.Xn.reject(new za(e))}}function ec(t){return new ja(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=rc(t.target.error);r(e)}})}var nc=!1;function rc(t){var e=Ga.Mn(v());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Lr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return nc||(nc=!0,setTimeout(function(){throw r},0)),r}}return t}function ic(){return"undefined"!=typeof window?window:null}function oc(){return"undefined"!=typeof document?document:null}var sc=(cc.ls=function(t,e,n,r,i){var o=new cc(t,e,Date.now()+n,r,i);return o.start(n),o},cc.prototype.start=function(t){var e=this;this._s=setTimeout(function(){return e.fs()},t)},cc.prototype.Vn=function(){return this.fs()},cc.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new Lr(kr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},cc.prototype.fs=function(){var e=this;this.os.ds(function(){return null!==e._s?(e.clearTimeout(),e.op().then(function(t){return e.hs.resolve(t)})):Promise.resolve()})},cc.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},cc),uc=(Object.defineProperty(ac.prototype,"Vs",{get:function(){return this.Es},enumerable:!1,configurable:!0}),ac.prototype.ds=function(t){this.enqueue(t)},ac.prototype.ps=function(t){this.bs(),this.vs(t)},ac.prototype.Ss=function(){var t;this.Es||(this.Es=!0,(t=oc())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys))},ac.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise(function(t){}):this.vs(t)},ac.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds(function(){return e.Cs()})},ac.prototype.Cs=function(){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!Xa(e=t.sent()))throw e;return Vr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.gs.Rn(function(){return n.Cs()}),t.label=5;case 5:return[2]}})})},ac.prototype.vs=function(t){var r=this,e=this.ws.then(function(){return r.Rs=!0,t().catch(function(t){throw r.As=t,r.Rs=!1,Mr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Rs=!1,t})});return this.ws=e},ac.prototype.gn=function(t,e,n){var r=this;this.bs(),-1<this.Ps.indexOf(t)&&(e=0);var i=sc.ls(this,t,e,n,function(t){return r.Ns(t)});return this.Is.push(i),i},ac.prototype.bs=function(){this.As&&jr()},ac.prototype.Fs=function(){},ac.prototype.xs=function(){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.ws];case 1:t.sent(),t.label=2;case 2:if(e!==this.ws)return[3,0];t.label=3;case 3:return[2]}})})},ac.prototype.$s=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},ac.prototype.ks=function(r){var i=this;return this.xs().then(function(){i.Is.sort(function(t,e){return t.cs-e.cs});for(var t=0,e=i.Is;t<e.length;t++){var n=e[t];if(n.Vn(),"all"!==r&&n.fn===r)break}return i.xs()})},ac.prototype.Ms=function(t){this.Ps.push(t)},ac.prototype.Ns=function(t){var e=this.Is.indexOf(t);this.Is.splice(e,1)},ac);function ac(){var e=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new qa(this,"async_queue_retry"),this.ys=function(){var t=oc();t&&Vr("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.gs.yn()};var t=oc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ys)}function cc(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new Ma,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch(function(t){})}function hc(t,e){if(Mr("AsyncQueue",e+": "+t),Xa(t))return new Lr(kr.UNAVAILABLE,e+": "+t);throw t}function fc(){this.Os=void 0,this.listeners=[]}function lc(){this.Ls=new Mi(ra,na),this.onlineState="Unknown",this.Bs=new Set}function pc(a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u;return w(this,function(t){switch(t.label){case 0:if(e=a,n=c.query,r=!1,(i=e.Ls.get(n))||(r=!0,i=new fc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.qs(n)];case 2:return o.Os=t.sent(),[3,4];case 3:return s=t.sent(),u=hc(s,"Initialization of query '"+ia(c.query)+"' failed"),[2,void c.onError(u)];case 4:return e.Ls.set(n,i),i.listeners.push(c),c.Us(e.onlineState),i.Os&&c.Qs(i.Os)&&vc(e),[2]}})})}function dc(s,u){return m(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){return e=s,n=u.query,r=!1,(i=e.Ls.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Ls.delete(n),e.Ws(n))]:[2]})})}function vc(t){t.Bs.forEach(function(t){t.next()})}var yc=(wc.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new So(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},wc.prototype.onError=function(t){this.js.error(t)},wc.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},wc.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Js&&n||t.docs.m()&&"Offline"!==e)},wc.prototype.zs=function(t){if(0<t.docChanges.length)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},wc.prototype.Ys=function(t){t=So.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},wc),gc=(mc.prototype.Xs=function(){return null!=this.uid},mc.prototype.Zs=function(){return this.Xs()?"uid:"+this.uid:"anonymous-user"},mc.prototype.isEqual=function(t){return t.uid===this.uid},mc);function mc(t){this.uid=t}function wc(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState="Unknown",this.options=n||{}}gc.UNAUTHENTICATED=new gc(null),gc.ti=new gc("google-credentials-uid"),gc.ei=new gc("first-party-uid");var bc=(Ic.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ic.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},Ic);function Ic(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}function Ec(t,e){return"firestore_clients_"+t+"_"+e}function Tc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Xs()&&(r+="_"+e.uid),r}function _c(t,e){return"firestore_targets_"+t+"_"+e}bc.oi=-1;var Ac=($c.ai=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Lr(r.error.code,r.error.message)),i?new $c(t,e,r.state,o):(Mr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},$c.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},$c),Nc=(Xc.ai=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Lr(n.error.code,n.error.message)),r?new Xc(t,n.state,i):(Mr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Xc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Xc),Sc=(Yc.ai=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=_o,o=0;r&&o<n.activeTargetIds.length;++o)r=Wi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Yc(t,i):(Mr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Yc),Dc=(Wc.ai=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Wc(e.clientId,e.onlineState):(Mr("SharedClientState","Failed to parse online state: "+t),null)},Wc),xc=(Kc.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Kc.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Kc.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},Kc),Oc=(Qc.On=function(t){return!(!t||!t.localStorage)},Qc.prototype.start=function(){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this._i.Vi()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.li&&(o=this.getItem(Ec(this.persistenceKey,i)))&&(s=Sc.ai(i,o))&&(this.mi=this.mi.rt(s.clientId,s));for(this.pi(),(u=this.storage.getItem(this.yi))&&(a=this.bi(u))&&this.vi(a),c=0,h=this.Ei;c<h.length;c++)f=h[c],this.wi(f);return this.Ei=[],this.window.addEventListener("unload",function(){return l.Si()}),this.Ti=!0,[2]}})})},Qc.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},Qc.prototype.Di=function(){return this.Ci(this.mi)},Qc.prototype.Ni=function(n){var r=!1;return this.mi.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Qc.prototype.Fi=function(t){this.xi(t,"pending")},Qc.prototype.$i=function(t,e,n){this.xi(t,e,n),this.ki(t)},Qc.prototype.Mi=function(t){var e,n,r="not-current";return this.Ni(t)&&(!(e=this.storage.getItem(_c(this.persistenceKey,t)))||(n=Nc.ai(t,e))&&(r=n.state)),this.Oi.ui(t),this.pi(),r},Qc.prototype.Li=function(t){this.Oi.hi(t),this.pi()},Qc.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},Qc.prototype.qi=function(t){this.removeItem(_c(this.persistenceKey,t))},Qc.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},Qc.prototype.Wi=function(t,e,n){var r=this;e.forEach(function(t){r.ki(t)}),this.currentUser=t,n.forEach(function(t){r.Fi(t)})},Qc.prototype.ji=function(t){this.Ki(t)},Qc.prototype.Si=function(){this.Ti&&(this.window.removeEventListener("storage",this.di),this.removeItem(this.Ii),this.Ti=!1)},Qc.prototype.getItem=function(t){var e=this.storage.getItem(t);return Vr("SharedClientState","READ",t,e),e},Qc.prototype.setItem=function(t,e){Vr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Qc.prototype.removeItem=function(t){Vr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Qc.prototype.wi=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Vr("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Ii)return void Mr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this._n.Ds(function(){return m(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.Ti){if(null!==u.key)if(this.Ri.test(u.key)){if(null==u.newValue)return e=this.Gi(u.key),[2,this.zi(e,null)];if(n=this.Hi(u.key,u.newValue))return[2,this.zi(n.clientId,n)]}else if(this.Pi.test(u.key)){if(null!==u.newValue&&(r=this.Yi(u.key,u.newValue)))return[2,this.Ji(r)]}else if(this.gi.test(u.key)){if(null!==u.newValue&&(i=this.Xi(u.key,u.newValue)))return[2,this.Zi(i)]}else if(u.key===this.yi){if(null!==u.newValue&&(o=this.bi(u.newValue)))return[2,this.vi(o)]}else u.key===this.Ai&&(s=function(t){var e=bc.oi;if(null!=t)try{var n=JSON.parse(t);Gr("number"==typeof n),e=n}catch(t){Mr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==bc.oi&&this.ni(s)}else this.Ei.push(u);return[2]})})})}},Object.defineProperty(Qc.prototype,"Oi",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),Qc.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},Qc.prototype.xi=function(t,e,n){var r=new Ac(this.currentUser,t,e,n),i=Tc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},Qc.prototype.ki=function(t){var e=Tc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Qc.prototype.Ki=function(t){var e={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},Qc.prototype.Qi=function(t,e,n){var r=_c(this.persistenceKey,t),i=new Nc(t,e,n);this.setItem(r,i.ci())},Qc.prototype.Gi=function(t){var e=this.Ri.exec(t);return e?e[1]:null},Qc.prototype.Hi=function(t,e){var n=this.Gi(t);return Sc.ai(n,e)},Qc.prototype.Yi=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ac.ai(new gc(i),r,e)},Qc.prototype.Xi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]);return Nc.ai(r,e)},Qc.prototype.bi=function(t){return Dc.ai(t)},Qc.prototype.Ji=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this._i.tr(e.batchId,e.state,e.error)]:(Vr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Qc.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},Qc.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this._i.nr(s,u).then(function(){n.mi=r})},Qc.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},Qc.prototype.Ci=function(t){var n=_o;return t.forEach(function(t,e){n=n.$t(e.activeTargetIds)}),n},Qc),Rc=(Hc.prototype.Fi=function(t){},Hc.prototype.$i=function(t,e,n){},Hc.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||"not-current"},Hc.prototype.Ui=function(t,e,n){this.ir[t]=e},Hc.prototype.Li=function(t){this.sr.hi(t)},Hc.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},Hc.prototype.qi=function(t){delete this.ir[t]},Hc.prototype.Di=function(){return this.sr.activeTargetIds},Hc.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},Hc.prototype.start=function(){return this.sr=new xc,Promise.resolve()},Hc.prototype.Wi=function(t,e,n){},Hc.prototype.ji=function(t){},Hc.prototype.Si=function(){},Hc.prototype.ri=function(t){},Hc),kc=(zc.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=uu(o,e,r[i]))}return e},zc.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=au(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=au(a,e,o,this.rr))}return e},zc.prototype.hr=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ur(t.key,n.get(t.key));e&&(i=i.rt(t.key,e))}),i},zc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},To())},zc.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ni(this.mutations,t.mutations,cu)&&Ni(this.baseMutations,t.baseMutations,cu)},zc),Lc=(Bc.from=function(t,e,n){Gr(t.mutations.length===n.length);for(var r=Io,i=t.mutations,o=0;o<i.length;o++)r=r.rt(i[o].key,n[o].version);return new Bc(t,e,n,r)},Bc),Cc=(Object.defineProperty(Gc.prototype,"readTime",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),Gc.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},Gc.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},Gc.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?ja.resolve(n):this.Rr(t,e)},Gc.prototype.getEntries=function(t,e){return this.Pr(t,e)},Gc.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},Gc.prototype.Er=function(){},Gc),Pc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Uc=(jc.prototype.Vr=function(t){this.yr.push(t)},jc.prototype.pr=function(){this.yr.forEach(function(t){return t()})},jc),Vc=(qc.prototype.Dr=function(e,n){var r=this;return this.vr.Cr(e,n).next(function(t){return r.Nr(e,n,t)})},qc.prototype.Nr=function(t,r,i){return this.br.Ar(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ur(r,t);return t})},qc.prototype.Fr=function(t,e,i){var o=go;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ur(t,e);o=o.rt(t,e)}),o},qc.prototype.$r=function(e,t){var n=this;return this.br.getEntries(e,t).next(function(t){return n.kr(e,t)})},qc.prototype.kr=function(r,i){var o=this;return this.vr.Mr(r,i).next(function(t){var e=o.Fr(r,i,t),n=go;return e.forEach(function(t,e){e=e||new Mu(t,qi.min()),n=n.rt(t,e)}),n})},qc.prototype.Or=function(t,e,n){return r=e,Jr.F(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Lr(t,e.path):Xu(e)?this.Br(t,e,n):this.qr(t,e,n);var r},qc.prototype.Lr=function(t,e){return this.Dr(t,new Jr(e)).next(function(t){var e=bo;return t instanceof Vu&&(e=e.rt(t.key,t)),e})},qc.prototype.Br=function(i,o,s){var u=this,a=o.collectionGroup,c=bo;return this.Sr.Ur(i,a).next(function(t){return ja.forEach(t,function(t){var e,n,r=(e=o,n=t.child(a),new qu(n,null,e.rn.slice(),e.filters.slice(),e.limit,e.on,e.startAt,e.endAt));return u.qr(i,r,s).next(function(t){t.forEach(function(t,e){c=c.rt(t,e)})})}).next(function(){return c})})},qc.prototype.qr=function(e,n,t){var h,f,r=this;return this.br.Or(e,n,t).next(function(t){return h=t,r.vr.Qr(e,n)}).next(function(t){return f=t,r.Wr(e,f,h).next(function(t){h=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=h.get(u),c=au(s,a,a,r.rr);h=c instanceof Vu?h.rt(u,c):h.remove(u)}})}).next(function(){return h.forEach(function(t,e){oa(n,e)||(h=h.remove(t))}),h})},qc.prototype.Wr=function(t,e,n){for(var r=To(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof du&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Vu&&(c=c.rt(t,e))}),c})},qc),Mc=(Fc.Gr=function(t,e){for(var n=To(),r=To(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Fc(t,e.fromCache,n,r)},Fc);function Fc(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}function qc(t,e,n){this.br=t,this.vr=e,this.Sr=n}function jc(){this.yr=[]}function Gc(){this.dr=new Mi(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.wr=!1}function Bc(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}function zc(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}function Hc(){this.sr=new xc,this.ir={},this.fi=null,this.ni=null}function Qc(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new uo(Ai),this.Ti=!1,this.Ei=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=Ec(this.persistenceKey,this.li),this.Ai="firestore_sequence_number_"+this.persistenceKey,this.mi=this.mi.rt(this.li,new xc),this.Ri=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.gi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.yi="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.di)}function Kc(){this.activeTargetIds=_o}function Wc(t,e){this.clientId=t,this.onlineState=e}function Yc(t,e){this.clientId=t,this.activeTargetIds=e}function Xc(t,e,n){this.targetId=t,this.state=e,this.error=n}function $c(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Jc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ai(n,i);return 0===s?Ai(r,o):s}var Zc=(rh.prototype.Yr=function(){return++this.Hr},rh.prototype.Jr=function(t){var e,n=[t,this.Yr()];this.buffer.size<this.zr?this.buffer=this.buffer.add(n):Jc(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(rh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),rh),th={Xr:!1,Zr:0,eo:0,no:0},eh=(nh.oo=function(t){return new nh(t,nh.ao,nh.co)},nh);function nh(t,e,n){this.so=t,this.io=e,this.ro=n}function rh(t){this.zr=t,this.buffer=new vo(Jc),this.Hr=0}eh.uo=-1,eh.ho=1048576,eh.lo=41943040,eh.ao=10,eh.co=1e3,eh._o=new eh(eh.lo,eh.ao,eh.co),eh.fo=new eh(eh.uo,0,0);var ih=(uh.prototype.start=function(t){this.do.params.so!==eh.uo&&this.To(t)},uh.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(uh.prototype,"Ti",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),uh.prototype.To=function(n){var t=this,e=this.wo?3e5:6e4;Vr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.mo=this.os.gn("lru_garbage_collection",e,function(){return m(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.mo=null,this.wo=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Eo(this.do)];case 2:return t.sent(),[3,7];case 3:return Xa(e=t.sent())?(Vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Mf(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.To(n)];case 8:return t.sent(),[2]}})})})},uh),oh=(sh.prototype.Ao=function(t,e){return this.Io.Ro(t).next(function(t){return Math.floor(e/100*t)})},sh.prototype.Po=function(t,e){var n=this;if(0===e)return ja.resolve(bc.oi);var r=new Zc(e);return this.Io.De(t,function(t){return r.Jr(t.sequenceNumber)}).next(function(){return n.Io.yo(t,function(t){return r.Jr(t)})}).next(function(){return r.maxValue})},sh.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},sh.prototype.po=function(t,e){return this.Io.po(t,e)},sh.prototype.bo=function(e,n){var r=this;return this.params.so===eh.uo?(Vr("LruGarbageCollector","Garbage collection skipped; disabled"),ja.resolve(th)):this.vo(e).next(function(t){return t<r.params.so?(Vr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.so),th):r.So(e,n)})},sh.prototype.vo=function(t){return this.Io.vo(t)},sh.prototype.So=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Ao(e,this.params.io).next(function(t){return i=t>h.params.ro?(Vr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.ro+" from "+t),h.params.ro):t,s=Date.now(),h.Po(e,i)}).next(function(t){return r=t,u=Date.now(),h.Vo(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.po(e,r)}).next(function(t){return c=Date.now(),Ur()<=l.DEBUG&&Vr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),ja.resolve({Xr:!0,Zr:i,eo:o,no:t})})},sh);function sh(t,e){this.Io=t,this.params=e}function uh(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}function ah(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=hh(e)),e=ch(t.get(n),e);return hh(e)}function ch(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function hh(t){return t+""}function fh(t){var e=t.length;if(Gr(2<=e),2===e)return Gr(""===t.charAt(0)&&""===t.charAt(1)),Yr.g();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&jr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:jr()}o=s+2}return new Yr(r)}function lh(t){this.Do=t}function ph(t,e){if(e.document)return n=t.Do,r=e.document,i=!!e.hasCommittedMutations,o=bs(n,r.name),s=ys(r.updateTime),u=new Nu({mapValue:{fields:r.fields}}),new Vu(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=Jr.$(e.noDocument.path),c=mh(e.noDocument.readTime);return new Mu(a,c,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var h=Jr.$(e.unknownDocument.path),f=mh(e.unknownDocument.version);return new Fu(h,f)}return jr()}function dh(t,e,n){var r,i,o=vh(n),s=e.key.path.h().A();if(e instanceof Vu){var u={name:ws(r=t.Do,(i=e).key),fields:i.sn().mapValue.fields,updateTime:ds(r,i.version.X())},a=e.hasCommittedMutations;return new $h(null,null,u,a,o,s)}if(e instanceof Mu){var c=e.key.path.A(),h=gh(e.version),f=e.hasCommittedMutations;return new $h(null,new Yh(c,h),null,f,o,s)}if(e instanceof Fu){var l=e.key.path.A(),p=gh(e.version);return new $h(new Xh(l,p),null,null,!0,o,s)}return jr()}function vh(t){var e=t.X();return[e.seconds,e.nanoseconds]}function yh(t){var e=new Fi(t[0],t[1]);return qi.Y(e)}function gh(t){var e=t.X();return new qh(e.seconds,e.nanoseconds)}function mh(t){var e=new Fi(t.seconds,t.nanoseconds);return qi.Y(e)}function wh(e,t){var n=(t.baseMutations||[]).map(function(t){return Ss(e.Do,t)}),r=t.mutations.map(function(t){return Ss(e.Do,t)}),i=Fi.fromMillis(t.localWriteTimeMs);return new kc(t.batchId,i,n,r)}function bh(t){var e,n=mh(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?mh(t.lastLimboFreeSnapshotVersion):qi.min(),i=void 0!==t.query.documents?(Gr(1===(e=t.query).documents.length),Ju(Hu(Es(e.documents[0])))):function(t){var e,n=Es(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Gr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ls(t.unaryFilter.field);return aa.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ls(t.unaryFilter.field);return aa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ls(t.unaryFilter.field);return aa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ls(t.unaryFilter.field);return aa.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return jr()}}(e)]:void 0!==e.fieldFilter?[(n=e,aa.create(Ls(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return jr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):jr():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new Ua(Ls((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,c,h=null;r.limit&&(a=r.limit,h=Qi(c="object"==typeof a?a.value:a)?null:c);var f=null;r.startAt&&(f=Rs(r.startAt));var l=null;return r.endAt&&(l=Rs(r.endAt)),Ju(zu(n,o,u,s,h,"F",f,l))}(t.query);return new ro(i,t.targetId,0,t.lastListenSequenceNumber,n,r,Di.fromBase64String(t.resumeToken))}function Ih(t,e){var n=gh(e.et),r=gh(e.lastLimboFreeSnapshotVersion),i=(Zi(e.target)?Ds:xs)(t.Do,e.target),o=e.resumeToken.toBase64();return new Zh(e.targetId,$i(e.target),n,o,e.sequenceNumber,r,i)}var Eh=(Th.Fo=function(t,e,n,r){return Gr(""!==t.uid),new Th(t.Xs()?t.uid:"",e,n,r)},Th.prototype.xo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Nh(t).ss({index:Qh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Th.prototype.$o=function(d,v,y,g){var m=this,w=Sh(d),b=Nh(d);return b.add({}).next(function(t){Gr("number"==typeof t);for(var e,n,r,i,o,s=new kc(t,v,y,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Ns(e.Do,t)}),o=r.mutations.map(function(t){return Ns(e.Do,t)}),new Qh(n,r.batchId,r.rr.toMillis(),i,o)),a=[],c=new vo(function(t,e){return Ai(t.R(),e.R())}),h=0,f=g;h<f.length;h++){var l=f[h],p=Kh.key(m.userId,l.key.path,t),c=c.add(l.key.path.h());a.push(b.put(u)),a.push(w.put(p,Kh.PLACEHOLDER))}return c.forEach(function(t){a.push(m.Sr.ko(d,t))}),d.Vr(function(){m.No[t]=s.keys()}),ja.xn(a).next(function(){return s})})},Th.prototype.Mo=function(t,e){var n=this;return Nh(t).get(e).next(function(t){return t?(Gr(t.userId===n.userId),wh(n.serializer,t)):null})},Th.prototype.Oo=function(t,n){var r=this;return this.No[n]?ja.resolve(this.No[n]):this.Mo(t,n).next(function(t){if(t){var e=t.keys();return r.No[n]=e}return null})},Th.prototype.Lo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Nh(t).ss({index:Qh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Gr(e.batchId>=i),o=wh(r.serializer,e)),n.done()}).next(function(){return o})},Th.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Nh(t).ss({index:Qh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Th.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Nh(t).Zn(Qh.userMutationsIndex,n).next(function(t){return t.map(function(t){return wh(e.serializer,t)})})},Th.prototype.Cr=function(u,a){var c=this,t=Kh.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),h=[];return Sh(u).ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=fh(i);if(r===c.userId&&a.path.isEqual(s))return Nh(u).get(o).next(function(t){if(!t)throw jr();Gr(t.userId===c.userId),h.push(wh(c.serializer,t))});n.done()}).next(function(){return h})},Th.prototype.Mr=function(r,t){var a=this,c=new vo(Ai),i=[];return t.forEach(function(u){var t=Kh.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Sh(r).ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=fh(i);r===a.userId&&u.path.isEqual(s)?c=c.add(o):n.done()});i.push(n)}),ja.xn(i).next(function(){return a.Uo(r,c)})},Th.prototype.Qr=function(t,e){var u=this,a=e.path,c=a.length+1,n=Kh.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),h=new vo(Ai);return Sh(t).ss({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=fh(i);r===u.userId&&a.T(s)?s.length===c&&(h=h.add(o)):n.done()}).next(function(){return u.Uo(t,h)})},Th.prototype.Uo=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Nh(e).get(t).next(function(t){if(null===t)throw jr();Gr(t.userId===n.userId),r.push(wh(n.serializer,t))}))}),ja.xn(i).next(function(){return r})},Th.prototype.Qo=function(e,n){var r=this;return Ah(e.Wo,this.userId,n).next(function(t){return e.Vr(function(){r.jo(n.batchId)}),ja.forEach(t,function(t){return r.Co.Ko(e,t)})})},Th.prototype.jo=function(t){delete this.No[t]},Th.prototype.Go=function(n){var o=this;return this.xo(n).next(function(t){if(!t)return ja.resolve();var e=IDBKeyRange.lowerBound(Kh.prefixForUser(o.userId)),i=[];return Sh(n).ss({range:e},function(t,e,n){var r;t[0]===o.userId?(r=fh(t[1]),i.push(r)):n.done()}).next(function(){Gr(0===i.length)})})},Th.prototype.zo=function(t,e){return _h(t,this.userId,e)},Th.prototype.Ho=function(t){var e=this;return Dh(t).get(this.userId).next(function(t){return t||new Hh(e.userId,-1,"")})},Th);function Th(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}function _h(t,o,e){var n=Kh.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Sh(t).ss({range:r,ns:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Ah(t,e,n){var r=t.store(Qh.store),i=t.store(Kh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ss({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Gr(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Kh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return ja.xn(o).next(function(){return c})}function Nh(t){return bf.Un(t,Qh.store)}function Sh(t){return bf.Un(t,Kh.store)}function Dh(t){return bf.Un(t,Hh.store)}var xh,Oh=(Rh.prototype.Tr=function(t,e,n){return Lh(t).put(Ch(e),n)},Rh.prototype.Ir=function(t,e){var n=Lh(t),r=Ch(e);return n.delete(r)},Rh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Yo(e,t)})},Rh.prototype.Ar=function(t,e){var n=this;return Lh(t).get(Ch(e)).next(function(t){return n.Jo(t)})},Rh.prototype.Xo=function(t,e){var n=this;return Lh(t).get(Ch(e)).next(function(t){var e=n.Jo(t);return e?{Zo:e,size:Ph(t)}:null})},Rh.prototype.getEntries=function(t,e){var r=this,i=go;return this.ta(t,e,function(t,e){var n=r.Jo(e);i=i.rt(t,n)}).next(function(){return i})},Rh.prototype.ea=function(t,e){var r=this,i=go,o=new uo(Jr.i);return this.ta(t,e,function(t,e){var n=r.Jo(e);o=n?(i=i.rt(t,n),o.rt(t,Ph(e))):(i=i.rt(t,null),o.rt(t,0))}).next(function(){return{na:i,sa:o}})},Rh.prototype.ta=function(t,e,i){if(e.m())return ja.resolve();var n=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),o=e.lt(),s=o.Et();return Lh(t).ss({range:n},function(t,e,n){for(var r=Jr.$(t);s&&Jr.i(s,r)<0;)i(s,null),s=o.Et();s&&s.isEqual(r)&&(i(s,e),s=o.It()?o.Et():null),s?n.Jn(s.path.A()):n.done()}).next(function(){for(;s;)i(s,null),s=o.It()?o.Et():null})},Rh.prototype.Or=function(t,i,e){var n,r,o,s=this,u=bo,a=i.path.length+1,c={};return e.isEqual(qi.min())?(n=i.path.A(),c.range=IDBKeyRange.lowerBound(n)):(r=i.path.A(),o=vh(e),c.range=IDBKeyRange.lowerBound([r,o],!0),c.index=$h.collectionReadTimeIndex),Lh(t).ss(c,function(t,e,n){var r;t.length===a&&(r=ph(s.serializer,e),i.path.T(r.key.path)?r instanceof Vu&&oa(i,r)&&(u=u.rt(r.key,r)):n.done())}).next(function(){return u})},Rh.prototype.ia=function(t,e){var r=this,i=go,o=vh(e),n=Lh(t),s=IDBKeyRange.lowerBound(o,!0);return n.ss({index:$h.readTimeIndex,range:s},function(t,e){var n=ph(r.serializer,e);i=i.rt(n.key,n),o=e.readTime}).next(function(){return{ra:i,readTime:yh(o)}})},Rh.prototype.oa=function(t){var e=Lh(t),r=qi.min();return e.ss({index:$h.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=yh(e.readTime)),n.done()}).next(function(){return r})},Rh.prototype.aa=function(t){return new Rh.ca(this,!!t&&t.ua)},Rh.prototype.ha=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Rh.prototype.getMetadata=function(t){return kh(t).get(Jh.key).next(function(t){return Gr(!!t),t})},Rh.prototype.Yo=function(t,e){return kh(t).put(Jh.key,e)},Rh.prototype.Jo=function(t){if(t){var e=ph(this.serializer,t);return e instanceof Mu&&e.version.isEqual(qi.min())?null:e}return null},Rh);function Rh(t,e){this.serializer=t,this.Sr=e}function kh(t){return bf.Un(t,Jh.store)}function Lh(t){return bf.Un(t,$h.store)}function Ch(t){return t.path.A()}function Ph(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw jr();e=t.noDocument}return JSON.stringify(e).length}function Uh(t,e){var n=this;return(n=xh.call(this)||this).la=t,n.ua=e,n._a=new Mi(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}Oh.ca=(o(Uh,xh=Cc),Uh.prototype.gr=function(s){var u=this,a=[],c=0,h=new vo(function(t,e){return Ai(t.R(),e.R())});return this.dr.forEach(function(t,e){var n,r,i,o=u._a.get(t);e?(n=dh(u.la.serializer,e,u.readTime),h=h.add(t.path.h()),r=Ph(n),c+=r-o,a.push(u.la.Tr(s,t,n))):(c-=o,u.ua?(i=dh(u.la.serializer,new Mu(t,qi.min()),u.readTime),a.push(u.la.Tr(s,t,i))):a.push(u.la.Ir(s,t)))}),h.forEach(function(t){a.push(u.la.Sr.ko(s,t))}),a.push(this.la.updateMetadata(s,c)),ja.xn(a)},Uh.prototype.Rr=function(t,e){var n=this;return this.la.Xo(t,e).next(function(t){return null===t?(n._a.set(e,0),null):(n._a.set(e,t.size),t.Zo)})},Uh.prototype.Pr=function(t,e){var n=this;return this.la.ea(t,e).next(function(t){var e=t.na;return t.sa.forEach(function(t,e){n._a.set(t,e)}),e})},Uh);var Vh=(zh.prototype.ko=function(t,e){return this.fa.add(e),ja.resolve()},zh.prototype.Ur=function(t,e){return ja.resolve(this.fa.getEntries(e))},zh),Mh=(Bh.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new vo(Yr.i),i=!r.has(n);return this.index[e]=r.add(n),i},Bh.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},Bh.prototype.getEntries=function(t){return(this.index[t]||new vo(Yr.i)).A()},Bh),Fh=(Gh.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Gr(t<e&&0<=t&&e<=10);var o,s=new $a(r);t<1&&1<=e&&(n.createObjectStore(jh.store),(o=n).createObjectStore(Hh.store,{keyPath:Hh.keyPath}),o.createObjectStore(Qh.store,{keyPath:Qh.keyPath,autoIncrement:!0}).createIndex(Qh.userMutationsIndex,Qh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Kh.store),rf(n),n.createObjectStore($h.store));var u,a=ja.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(tf.store),u.deleteObjectStore(Zh.store),u.deleteObjectStore(ef.store),rf(n)),a=a.next(function(){return t=s.store(ef.store),e=new ef(0,0,qi.min().X(),0),t.put(ef.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Qh.store).Zn().next(function(t){r.deleteObjectStore(Qh.store),r.createObjectStore(Qh.store,{keyPath:Qh.keyPath,autoIncrement:!0}).createIndex(Qh.userMutationsIndex,Qh.userMutationsKeyPath,{unique:!0});var e=i.store(Qh.store),n=t.map(function(t){return e.put(t)});return ja.xn(n)});var r,i})),a=a.next(function(){n.createObjectStore(of.store,{keyPath:of.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Jh.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore($h.store)).createIndex($h.readTimeIndex,$h.readTimeIndexPath,{unique:!1}),t.createIndex($h.collectionReadTimeIndex,$h.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Gh.prototype.addDocumentGlobal=function(e){var n=0;return e.store($h.store).ss(function(t,e){n+=Ph(e)}).next(function(){var t=new Jh(n);return e.store(Jh.store).put(Jh.key,t)})},Gh.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Hh.store),e=r.store(Qh.store);return t.Zn().next(function(t){return ja.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Zn(Qh.userMutationsIndex,t).next(function(t){return ja.forEach(t,function(t){Gr(t.userId===n.userId);var e=wh(i.serializer,t);return Ah(r,n.userId,e).next(function(){})})})})})},Gh.prototype.ensureSequenceNumbers=function(t){var s=t.store(tf.store),e=t.store($h.store);return t.store(ef.store).get(ef.key).next(function(i){var o=[];return e.ss(function(t,e){var n=new Yr(t),r=[0,ah(n)];o.push(s.get(r).next(function(t){return t?ja.resolve():s.put(new tf(0,ah(n),i.highestListenSequenceNumber))}))}).next(function(){return ja.xn(o)})})},Gh.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t._(),n=t.h();return r.put({collectionId:e,parent:ah(n)})}}t.createObjectStore(nf.store,{keyPath:nf.keyPath});var r=e.store(nf.store),o=new Mh;return e.store($h.store).ss({ns:!0},function(t,e){var n=new Yr(t);return i(n.h())}).next(function(){return e.store(Kh.store).ss({ns:!0},function(t,e){t[0];var n=t[1],r=(t[2],fh(n));return i(r.h())})})},Gh.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Zh.store);return o.ss(function(t,e){var n=bh(e),r=Ih(i.serializer,n);return o.put(r)})},Gh),qh=function(t,e){this.seconds=t,this.nanoseconds=e},jh=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Gh(t){this.serializer=t}function Bh(){this.index={}}function zh(){this.fa=new Mh}jh.store="owner",jh.key="owner";var Hh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Hh.store="mutationQueues",Hh.keyPath="userId";var Qh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Qh.store="mutations",Qh.keyPath="batchId",Qh.userMutationsIndex="userMutationsIndex",Qh.userMutationsKeyPath=["userId","batchId"];var Kh=(Wh.prefixForUser=function(t){return[t]},Wh.prefixForPath=function(t,e){return[t,ah(e)]},Wh.key=function(t,e,n){return[t,ah(e),n]},Wh);function Wh(){}Kh.store="documentMutations",Kh.PLACEHOLDER=new Kh;var Yh=function(t,e){this.path=t,this.readTime=e},Xh=function(t,e){this.path=t,this.version=e},$h=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};$h.store="remoteDocuments",$h.readTimeIndex="readTimeIndex",$h.readTimeIndexPath="readTime",$h.collectionReadTimeIndex="collectionReadTimeIndex",$h.collectionReadTimeIndexPath=["parentPath","readTime"];var Jh=function(t){this.byteSize=t};Jh.store="remoteDocumentGlobal",Jh.key="remoteDocumentGlobalKey";var Zh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Zh.store="targets",Zh.keyPath="targetId",Zh.queryTargetsIndexName="queryTargetsIndex",Zh.queryTargetsKeyPath=["canonicalId","targetId"];var tf=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};tf.store="targetDocuments",tf.keyPath=["targetId","path"],tf.documentTargetsIndex="documentTargetsIndex",tf.documentTargetsKeyPath=["path","targetId"];var ef=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ef.key="targetGlobalKey",ef.store="targetGlobal";var nf=function(t,e){this.collectionId=t,this.parent=e};function rf(t){t.createObjectStore(tf.store,{keyPath:tf.keyPath}).createIndex(tf.documentTargetsIndex,tf.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Zh.store,{keyPath:Zh.keyPath}).createIndex(Zh.queryTargetsIndexName,Zh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ef.store)}nf.store="collectionParents",nf.keyPath=["collectionId","parent"];var of=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};of.store="clientMetadata",of.keyPath="clientId";var sf=s(s(s([Hh.store,Qh.store,Kh.store,$h.store,Zh.store,jh.store,ef.store,tf.store],[of.store]),[Jh.store]),[nf.store]),uf=(af.prototype.ko=function(t,e){var n=this;if(this.da.has(e))return ja.resolve();var r=e._(),i=e.h();t.Vr(function(){n.da.add(e)});var o={collectionId:r,parent:ah(i)};return cf(t).put(o)},af.prototype.Ur=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Si(i),""],!1,!0);return cf(t).Zn(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(fh(r.parent))}return o})},af);function af(){this.da=new Mh}function cf(t){return bf.Un(t,nf.store)}var hf=(pf.prototype.next=function(){return this.wa+=2,this.wa},pf.ma=function(){return new pf(0)},pf.Ta=function(){return new pf(-1)},pf),ff=(lf.prototype.Ea=function(n){var r=this;return this.Ia(n).next(function(t){var e=new hf(t.highestTargetId);return t.highestTargetId=e.next(),r.Aa(n,t).next(function(){return t.highestTargetId})})},lf.prototype.Ra=function(t){return this.Ia(t).next(function(t){return qi.Y(new Fi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},lf.prototype.Pa=function(t){return this.Ia(t).next(function(t){return t.highestListenSequenceNumber})},lf.prototype.ga=function(e,n,r){var i=this;return this.Ia(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.X()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Aa(e,t)})},lf.prototype.ya=function(e,n){var r=this;return this.Va(e,n).next(function(){return r.Ia(e).next(function(t){return t.targetCount+=1,r.pa(n,t),r.Aa(e,t)})})},lf.prototype.ba=function(t,e){return this.Va(t,e)},lf.prototype.va=function(e,t){var n=this;return this.Sa(e,t.targetId).next(function(){return df(e).delete(t.targetId)}).next(function(){return n.Ia(e)}).next(function(t){return Gr(0<t.targetCount),--t.targetCount,n.Aa(e,t)})},lf.prototype.Vo=function(r,i,o){var s=this,u=0,a=[];return df(r).ss(function(t,e){var n=bh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.va(r,n)))}).next(function(){return ja.xn(a)}).next(function(){return u})},lf.prototype.De=function(t,r){return df(t).ss(function(t,e){var n=bh(e);r(n)})},lf.prototype.Ia=function(t){return vf(t).get(ef.key).next(function(t){return Gr(null!==t),t})},lf.prototype.Aa=function(t,e){return vf(t).put(ef.key,e)},lf.prototype.Va=function(t,e){return df(t).put(Ih(this.serializer,e))},lf.prototype.pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},lf.prototype.Da=function(t){return this.Ia(t).next(function(t){return t.targetCount})},lf.prototype.Ca=function(t,i){var e=$i(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return df(t).ss({range:n,index:Zh.queryTargetsIndexName},function(t,e,n){var r=bh(e);Ji(i,r.target)&&(o=r,n.done())}).next(function(){return o})},lf.prototype.Na=function(n,t,r){var i=this,o=[],s=yf(n);return t.forEach(function(t){var e=ah(t.path);o.push(s.put(new tf(r,e))),o.push(i.Co.Fa(n,r,t))}),ja.xn(o)},lf.prototype.xa=function(n,t,r){var i=this,o=yf(n);return ja.forEach(t,function(t){var e=ah(t.path);return ja.xn([o.delete([r,e]),i.Co.$a(n,r,t)])})},lf.prototype.Sa=function(t,e){var n=yf(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},lf.prototype.ka=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=yf(t),o=To();return r.ss({range:n,ns:!0},function(t,e,n){var r=fh(t[1]),i=new Jr(r);o=o.add(i)}).next(function(){return o})},lf.prototype.zo=function(t,e){var n=ah(e.path),r=IDBKeyRange.bound([n],[Si(n)],!1,!0),i=0;return yf(t).ss({index:tf.documentTargetsIndex,ns:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},lf.prototype.qe=function(t,e){return df(t).get(e).next(function(t){return t?bh(t):null})},lf);function lf(t,e){this.Co=t,this.serializer=e}function pf(t){this.wa=t}function df(t){return bf.Un(t,Zh.store)}function vf(t){return bf.Un(t,ef.store)}function yf(t){return bf.Un(t,tf.store)}var gf,mf="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",wf=(o(Ef,gf=Uc),Ef),bf=(If.Un=function(t,e){if(t instanceof wf)return Ga.Un(t.Wo,e);throw jr()},If.prototype.start=function(){var e=this;return this.Ja().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Lr(kr.FAILED_PRECONDITION,mf);return e.Xa(),e.Za(),e.tc(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Ha.Pa(t)})}).then(function(t){e.Ba=new bc(t,e.Oa)}).then(function(){e.qa=!0}).catch(function(t){return e.za&&e.za.close(),Promise.reject(t)})},If.prototype.ec=function(n){var t=this;return this.Ka=function(e){return m(t,void 0,void 0,function(){return w(this,function(t){return this.Ti?[2,n(e)]:[2]})})},n(this.isPrimary)},If.prototype.nc=function(n){var t=this;this.za.jn(function(e){return m(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},If.prototype.sc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ti?[4,this.Ja()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},If.prototype.Ja=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return _f(e).put(new of(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ic(e).next(function(t){t||(n.isPrimary=!1,n._n.Ds(function(){return n.Ka(!1)}))})}).next(function(){return n.rc(e)}).next(function(t){return n.isPrimary&&!t?n.oc(e).next(function(){return!1}):!!t&&n.ac(e).next(function(){return!0})})}).catch(function(t){if(Xa(t))return Vr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n._n.Ds(function(){return n.Ka(t)}),n.isPrimary=t})},If.prototype.ic=function(t){var e=this;return Tf(t).get(jh.key).next(function(t){return ja.resolve(e.cc(t))})},If.prototype.uc=function(t){return _f(t).delete(this.clientId)},If.prototype.hc=function(){return m(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.lc(this.ja,18e5)?[3,2]:(this.ja=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=If.Un(t,of.store);return r.Zn().next(function(t){var e=o._c(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return ja.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Ya)for(n=0,r=e;n<r.length;n++)i=r[n],this.Ya.removeItem(this.fc(i.clientId));t.label=2;case 2:return[2]}})})},If.prototype.tc=function(){var t=this;this.Wa=this._n.gn("client_metadata_refresh",4e3,function(){return t.Ja().then(function(){return t.hc()}).then(function(){return t.tc()})})},If.prototype.cc=function(t){return!!t&&t.ownerId===this.clientId},If.prototype.rc=function(e){var i=this;return this.La?ja.resolve(!0):Tf(e).get(jh.key).next(function(t){if(null!==t&&i.lc(t.leaseTimestampMs,5e3)&&!i.dc(t.ownerId)){if(i.cc(t)&&i.networkEnabled)return!0;if(!i.cc(t)){if(!t.allowTabSynchronization)throw new Lr(kr.FAILED_PRECONDITION,mf);return!1}}return!(!i.networkEnabled||!i.inForeground)||_f(e).Zn().next(function(t){return void 0===i._c(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Vr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},If.prototype.Si=function(){return m(this,void 0,void 0,function(){var n=this;return w(this,function(t){switch(t.label){case 0:return this.qa=!1,this.wc(),this.Wa&&(this.Wa.cancel(),this.Wa=null),this.mc(),this.Tc(),[4,this.za.runTransaction("readwrite",[jh.store,of.store],function(t){var e=new wf(t,bc.oi);return n.oc(e).next(function(){return n.uc(e)})})];case 1:return t.sent(),this.za.close(),this.Ec(),[2]}})})},If.prototype._c=function(t,e){var n=this;return t.filter(function(t){return n.lc(t.updateTimeMs,e)&&!n.dc(t.clientId)})},If.prototype.Vi=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return _f(t).Zn().next(function(t){return e._c(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(If.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),If.prototype.Ic=function(t){return Eh.Fo(t,this.serializer,this.Sr,this.Co)},If.prototype.Ac=function(){return this.Ha},If.prototype.Rc=function(){return this.br},If.prototype.Pc=function(){return this.Sr},If.prototype.runTransaction=function(e,n,r){var i=this;Vr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.za.runTransaction(t,sf,function(t){return o=new wf(t,i.Ba?i.Ba.next():bc.oi),"readwrite-primary"===n?i.ic(o).next(function(t){return!!t||i.rc(o)}).next(function(t){if(!t)throw Mr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i._n.Ds(function(){return i.Ka(!1)}),new Lr(kr.FAILED_PRECONDITION,Pc);return r(o)}).next(function(t){return i.ac(o).next(function(){return t})}):i.gc(o).next(function(){return r(o)})}).then(function(t){return o.pr(),t})},If.prototype.gc=function(t){var e=this;return Tf(t).get(jh.key).next(function(t){if(null!==t&&e.lc(t.leaseTimestampMs,5e3)&&!e.dc(t.ownerId)&&!e.cc(t)&&!(e.La||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Lr(kr.FAILED_PRECONDITION,mf)})},If.prototype.ac=function(t){var e=new jh(this.clientId,this.allowTabSynchronization,Date.now());return Tf(t).put(jh.key,e)},If.On=function(){return Ga.On()},If.prototype.oc=function(t){var e=this,n=Tf(t);return n.get(jh.key).next(function(t){return e.cc(t)?(Vr("IndexedDbPersistence","Releasing primary lease."),n.delete(jh.key)):ja.resolve()})},If.prototype.lc=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Mr("Detected an update time that is in the future: "+t+" > "+n),1))},If.prototype.Xa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qa=function(){t._n.ds(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ja()})},this.document.addEventListener("visibilitychange",this.Qa),this.inForeground="visible"===this.document.visibilityState)},If.prototype.mc=function(){this.Qa&&(this.document.removeEventListener("visibilitychange",this.Qa),this.Qa=null)},If.prototype.Za=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ua=function(){e.wc(),e._n.ds(function(){return e.Si()})},this.window.addEventListener("unload",this.Ua))},If.prototype.Tc=function(){this.Ua&&(this.window.removeEventListener("unload",this.Ua),this.Ua=null)},If.prototype.dc=function(t){var e;try{var n=null!==(null===(e=this.Ya)||void 0===e?void 0:e.getItem(this.fc(t)));return Vr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Mr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},If.prototype.wc=function(){if(this.Ya)try{this.Ya.setItem(this.fc(this.clientId),String(Date.now()))}catch(t){Mr("Failed to set zombie client id.",t)}},If.prototype.Ec=function(){if(this.Ya)try{this.Ya.removeItem(this.fc(this.clientId))}catch(t){}},If.prototype.fc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},If);function If(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this._n=i,this.window=o,this.document=s,this.Oa=a,this.La=c,this.Ba=null,this.qa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ua=null,this.inForeground=!1,this.Qa=null,this.Wa=null,this.ja=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!If.On())throw new Lr(kr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Co=new Af(this,r),this.Ga=e+"main",this.serializer=new lh(u),this.za=new Ga(this.Ga,10,new Fh(this.serializer)),this.Ha=new ff(this.Co,this.serializer),this.Sr=new uf,this.br=new Oh(this.serializer,this.Sr),this.window&&this.window.localStorage?this.Ya=this.window.localStorage:(this.Ya=null,!1===c&&Mr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Ef(t,e){var n=this;return(n=gf.call(this)||this).Wo=t,n.Ma=e,n}function Tf(t){return bf.Un(t,jh.store)}function _f(t){return bf.Un(t,of.store)}var Af=(Nf.prototype.Ro=function(t){var n=this.yc(t);return this.db.Ac().Da(t).next(function(e){return n.next(function(t){return e+t})})},Nf.prototype.yc=function(t){var e=0;return this.yo(t,function(t){e++}).next(function(){return e})},Nf.prototype.De=function(t,e){return this.db.Ac().De(t,e)},Nf.prototype.yo=function(t,n){return this.Vc(t,function(t,e){return n(e)})},Nf.prototype.Fa=function(t,e,n){return Sf(t,n)},Nf.prototype.$a=function(t,e,n){return Sf(t,n)},Nf.prototype.Vo=function(t,e,n){return this.db.Ac().Vo(t,e,n)},Nf.prototype.Ko=Sf,Nf.prototype.bc=function(t,e){return r=e,i=!1,Dh(n=t).rs(function(t){return _h(n,t,r).next(function(t){return t&&(i=!0),ja.resolve(!t)})}).next(function(){return i});var n,r,i},Nf.prototype.po=function(r,i){var o=this,s=this.db.Rc().aa(),u=[],a=0;return this.Vc(r,function(e,t){var n;t<=i&&(n=o.bc(r,e).next(function(t){if(!t)return a++,s.Ar(r,e).next(function(){return s.Ir(e),yf(r).delete([0,ah(e.path)])})}),u.push(n))}).next(function(){return ja.xn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},Nf.prototype.removeTarget=function(t,e){var n=e.nt(t.Ma);return this.db.Ac().ba(t,n)},Nf.prototype.vc=Sf,Nf.prototype.Vc=function(t,o){var s,e=yf(t),u=bc.oi;return e.ss({index:tf.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==bc.oi&&o(new Jr(fh(s)),u),u=i,s=r):u=bc.oi}).next(function(){u!==bc.oi&&o(new Jr(fh(s)),u)})},Nf.prototype.vo=function(t){return this.db.Rc().ha(t)},Nf);function Nf(t,e){this.db=t,this.do=new oh(this,e)}function Sf(t,e){return yf(t).put((n=t.Ma,new tf(0,ah(e.path),n)));var n}function Df(t,e){var n=t.projectId;return t.W||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var xf=(Of.prototype.Eo=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.bo(t,n.Dc)})},Of);function Of(t,e,n){this.persistence=t,this.Sc=e,this.Dc=new uo(Ai),this.Cc=new Mi($i,Ji),this.Nc=qi.min(),this.vr=t.Ic(n),this.Fc=t.Rc(),this.Ha=t.Ac(),this.xc=new Vc(this.Fc,this.vr,this.persistence.Pc()),this.Sc.$c(this.xc)}function Rf(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,n,i,o,s,r,u,a=h.batch.keys(),c=f.Fc.aa({ua:!0});return e=f,n=t,o=c,s=(i=h).batch,r=s.keys(),u=ja.resolve(),r.forEach(function(r){u=u.next(function(){return o.Ar(n,r)}).next(function(t){var e=t,n=i._r.get(r);Gr(null!==n),(!e||e.version.L(n)<0)&&(e=s.ar(r,e,i))&&o.Tr(e,i.lr)})}),u.next(function(){return e.vr.Qo(n,s)}).next(function(){return c.apply(t)}).next(function(){return f.vr.Go(t)}).next(function(){return f.xc.$r(t,a)})})}function kf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ha.Ra(t)})}function Lf(t,s){var h=t,f=s.et,l=h.Dc;return h.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var i=h.Fc.aa({ua:!0});l=h.Dc;var c=[];s.Gt.forEach(function(t,e){var n,r,i,o,s,u=l.get(e);u&&(c.push(h.Ha.xa(a,t.ne,e).next(function(){return h.Ha.Na(a,t.te,e)})),0<(n=t.resumeToken).O()&&(r=u.st(n,f).nt(a.Ma),l=l.rt(e,r),i=u,s=t,Gr(0<(o=r).resumeToken.O()),(0===i.resumeToken.O()||3e8<=o.et.J()-i.et.J()||0<s.te.size+s.ee.size+s.ne.size)&&c.push(h.Ha.ba(a,r))))});var t,o=go,n=To();return s.Ht.forEach(function(t,e){n=n.add(t)}),c.push(i.getEntries(a,n).next(function(r){s.Ht.forEach(function(t,e){var n=r.get(t);e instanceof Mu&&e.version.isEqual(qi.min())?(i.Ir(t,f),o=o.rt(t,e)):null==n||0<e.version.L(n.version)||0===e.version.L(n.version)&&n.hasPendingWrites?(i.Tr(e,f),o=o.rt(t,e)):Vr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.Yt.has(t)&&c.push(h.persistence.Co.vc(a,t))})})),f.isEqual(qi.min())||(t=h.Ha.Ra(a).next(function(t){return h.Ha.ga(a,a.Ma,f)}),c.push(t)),ja.xn(c).next(function(){return i.apply(a)}).next(function(){return h.xc.kr(a,o)})}).then(function(t){return h.Dc=l,t})}function Cf(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ha.Ca(e,r).next(function(t){return t?(n=t,ja.resolve(n)):i.Ha.Ea(e).next(function(t){return n=new ro(r,t,0,e.Ma),i.Ha.ya(e,n).next(function(){return n})})})}).then(function(t){var e=i.Dc.get(t.targetId);return(null===e||0<t.et.L(e.et))&&(i.Dc=i.Dc.rt(t.targetId,t),i.Cc.set(r,t.targetId)),t})}function Pf(o,s,u){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:n=(e=o).Dc.get(s),r=u?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),u?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Co.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Xa(i=t.sent()))throw i;return Vr("LocalStore","Failed to update sequence numbers for target "+s+": "+i),[3,5];case 5:return e.Dc=e.Dc.remove(s),e.Cc.delete(n.target),[2]}})})}function Uf(t,s,u){var a=t,c=qi.min(),h=To();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Ju(s),(void 0!==(o=(i=t).Cc.get(r))?ja.resolve(i.Dc.get(o)):i.Ha.Ca(n,r)).next(function(t){if(t)return c=t.lastLimboFreeSnapshotVersion,a.Ha.ka(e,t.targetId).next(function(t){h=t})}).next(function(){return a.Sc.Or(e,s,u?c:qi.min(),u?h:To())}).next(function(t){return{documents:t,kc:h}});var t,n,r,i,o})}function Vf(t,e){var n=t,r=n.Ha,i=n.Dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.qe(t,e).next(function(t){return t?t.target:null})})}function Mf(e){return m(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==kr.FAILED_PRECONDITION||e.message!==Pc)throw e;return Vr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ff(t,e){this.user=e,this.type="OAuth",this.zc={},this.zc.Authorization="Bearer "+t}function qf(t,e,n,r,i){var o=this;this.Gu=t,this.zu=e,this.os=n,this.Hu={},this.Yu=[],this.Ju=new Map,this.Xu=new Set,this.Zu=[],this.th=i,this.th.eh(function(t){n.ds(function(){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Il(this)?(Vr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return(e=n).Xu.add(4),[4,pl(e)];case 1:return t.sent(),e.nh.set("Unknown"),e.Xu.delete(4),[4,ll(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.nh=new tl(n,r)}var jf,Gf,Bf,zf=(fl.prototype.m=function(){return this.Mc.m()},fl.prototype.Fa=function(t,e){var n=new Hf(t,e);this.Mc=this.Mc.add(n),this.Lc=this.Lc.add(n)},fl.prototype.qc=function(t,e){var n=this;t.forEach(function(t){return n.Fa(t,e)})},fl.prototype.$a=function(t,e){this.Uc(new Hf(t,e))},fl.prototype.Qc=function(t,e){var n=this;t.forEach(function(t){return n.$a(t,e)})},fl.prototype.Wc=function(t){var e=this,n=new Jr(new Yr([])),r=new Hf(n,t),i=new Hf(n,t+1),o=[];return this.Lc.Nt([r,i],function(t){e.Uc(t),o.push(t.key)}),o},fl.prototype.jc=function(){var e=this;this.Mc.forEach(function(t){return e.Uc(t)})},fl.prototype.Uc=function(t){this.Mc=this.Mc.delete(t),this.Lc=this.Lc.delete(t)},fl.prototype.Kc=function(t){var e=new Jr(new Yr([])),n=new Hf(e,t),r=new Hf(e,t+1),i=To();return this.Lc.Nt([n,r],function(t){i=i.add(t.key)}),i},fl.prototype.zo=function(t){var e=new Hf(t,0),n=this.Mc.xt(e);return null!==n&&t.isEqual(n.key)},fl),Hf=(hl.Oc=function(t,e){return Jr.i(t.key,e.key)||Ai(t.Gc,e.Gc)},hl.Bc=function(t,e){return Ai(t.Gc,e.Gc)||Jr.i(t.key,e.key)},hl),Qf=(cl.prototype.getToken=function(){return Promise.resolve(null)},cl.prototype.Yc=function(){},cl.prototype.Jc=function(t){(this.Hc=t)(gc.UNAUTHENTICATED)},cl.prototype.Xc=function(){this.Hc=null},cl),Kf=(al.prototype.getToken=function(){var e=this,n=this.eu,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.eu!==n?(Vr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Gr("string"==typeof t.accessToken),new Ff(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},al.prototype.Yc=function(){this.forceRefresh=!0},al.prototype.Jc=function(t){this.Hc=t,this.tu&&t(this.currentUser)},al.prototype.Xc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Zc),this.Zc=null,this.Hc=null},al.prototype.nu=function(){var t=this.auth&&this.auth.getUid();return Gr(null===t||"string"==typeof t),new gc(t)},al),Wf=(Object.defineProperty(ul.prototype,"zc",{get:function(){var t={"X-Goog-AuthUser":this.iu},e=this.su.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),ul),Yf=(sl.prototype.getToken=function(){return Promise.resolve(new Wf(this.su,this.iu))},sl.prototype.Jc=function(t){t(gc.ei)},sl.prototype.Xc=function(){},sl.prototype.Yc=function(){},sl),Xf=(ol.prototype.hu=function(){return 1===this.state||2===this.state||4===this.state},ol.prototype.lu=function(){return 2===this.state},ol.prototype.start=function(){3!==this.state?this.auth():this._u()},ol.prototype.stop=function(){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.hu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},ol.prototype.fu=function(){this.state=0,this.gs.reset()},ol.prototype.du=function(){var t=this;this.lu()&&null===this.uu&&(this.uu=this._n.gn(this.ru,6e4,function(){return t.wu()}))},ol.prototype.mu=function(t){this.Tu(),this.stream.send(t)},ol.prototype.wu=function(){return m(this,void 0,void 0,function(){return w(this,function(t){return this.lu()?[2,this.close(0)]:[2]})})},ol.prototype.Tu=function(){this.uu&&(this.uu.cancel(),this.uu=null)},ol.prototype.close=function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Tu(),this.gs.cancel(),this.cu++,3!==e?this.gs.reset():n&&n.code===kr.RESOURCE_EXHAUSTED?(Mr(n.toString()),Mr("Using maximum backoff delay to prevent overloading the backend."),this.gs.An()):n&&n.code===kr.UNAUTHENTICATED&&this.au.Yc(),null!==this.stream&&(this.Eu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Iu(n)];case 1:return t.sent(),[2]}})})},ol.prototype.Eu=function(){},ol.prototype.auth=function(){var n=this;this.state=1;var t=this.Au(this.cu),e=this.cu;this.au.getToken().then(function(t){n.cu===e&&n.Ru(t)},function(e){t(function(){var t=new Lr(kr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Pu(t)})})},ol.prototype.Ru=function(t){var e=this,n=this.Au(this.cu);this.stream=this.gu(t),this.stream.yu(function(){n(function(){return e.state=2,e.listener.yu()})}),this.stream.Iu(function(t){n(function(){return e.Pu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},ol.prototype._u=function(){var t=this;this.state=4,this.gs.Rn(function(){return m(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},ol.prototype.Pu=function(t){return Vr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},ol.prototype.Au=function(e){var n=this;return function(t){n._n.ds(function(){return n.cu===e?t():(Vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},ol),$f=(o(il,Bf=Xf),il.prototype.gu=function(t){return this.ou.Vu("Listen",t)},il.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:jr(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Ue?(Gr(void 0===i||"string"==typeof i),Di.fromBase64String(i||"")):(Gr(void 0===i||i instanceof Uint8Array),Di.fromUint8Array(i||new Uint8Array))),c=e.targetChange.cause,h=c&&(r=void 0===(n=c).code?kr.UNKNOWN:so(n.code),new Lr(r,n.message||"")),f=new ko(s,u,a,h||null)}else if("documentChange"in e){e.documentChange;var l=e.documentChange;l.document,l.document.name,l.document.updateTime;var p=bs(t,l.document.name),d=ys(l.document.updateTime),v=new Nu({mapValue:{fields:l.document.fields}}),y=new Vu(p,d,v,{}),g=l.targetIds||[],m=l.removedTargetIds||[];f=new Oo(g,m,y.key,y)}else if("documentDelete"in e){e.documentDelete;var w=e.documentDelete;w.document;var b=bs(t,w.document),I=w.readTime?ys(w.readTime):qi.min(),E=new Mu(b,I),T=w.removedTargetIds||[];f=new Oo([],T,E.key,E)}else if("documentRemove"in e){e.documentRemove;var _=e.documentRemove;_.document;var A=bs(t,_.document),N=_.removedTargetIds||[];f=new Oo([],N,A,null)}else{if(!("filter"in e))return jr();e.filter;var S=e.filter;S.targetId;var D=S.count||0,x=new to(D),O=S.targetId;f=new Ro(O,x)}return f}(this.serializer,t),n=function(t){if(!("targetChange"in t))return qi.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?qi.min():ys(e.readTime)}(t);return this.listener.pu(e,n)},il.prototype.bu=function(t){var e,n,r,i,o={};o.database=Ts(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=Zi(i)?{documents:Ds(e,i)}:{query:xs(e,i)}).targetId=n.targetId,0<n.resumeToken.O()&&(r.resumeToken=vs(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.tt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return jr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.mu(o)},il.prototype.vu=function(t){var e={};e.database=Ts(this.serializer),e.removeTarget=t,this.mu(e)},il),Jf=(o(rl,Gf=Xf),Object.defineProperty(rl.prototype,"Du",{get:function(){return this.Su},enumerable:!1,configurable:!0}),rl.prototype.start=function(){this.Su=!1,this.lastStreamToken=void 0,Gf.prototype.start.call(this)},rl.prototype.Eu=function(){this.Su&&this.Cu([])},rl.prototype.gu=function(t){return this.ou.Vu("Write",t)},rl.prototype.onMessage=function(t){if(Gr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Su){this.gs.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(Gr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?ys(t.updateTime):ys(e);n.isEqual(qi.min())&&(n=ys(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new nu(n,r)}(t,i)})):[]),n=ys(t.commitTime);return this.listener.Nu(n,e)}var r,i;return Gr(!t.writeResults||0===t.writeResults.length),this.Su=!0,this.listener.Fu()},rl.prototype.xu=function(){var t={};t.database=Ts(this.serializer),this.mu(t)},rl.prototype.Cu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ns(e.serializer,t)})};this.mu(n)},rl),Zf=(o(nl,jf=function(){}),nl.prototype.ku=function(){if(this.$u)throw new Lr(kr.FAILED_PRECONDITION,"The client has already been terminated.")},nl.prototype.Mu=function(e,n,r){var i=this;return this.ku(),this.credentials.getToken().then(function(t){return i.ou.Mu(e,n,r,t)}).catch(function(t){throw t.code===kr.UNAUTHENTICATED&&i.credentials.Yc(),t})},nl.prototype.Ou=function(e,n,r){var i=this;return this.ku(),this.credentials.getToken().then(function(t){return i.ou.Ou(e,n,r,t)}).catch(function(t){throw t.code===kr.UNAUTHENTICATED&&i.credentials.Yc(),t})},nl.prototype.terminate=function(){this.$u=!1},nl),tl=(el.prototype.Uu=function(){var t=this;0===this.Lu&&(this.Qu("Unknown"),this.Bu=this.os.gn("online_state_timeout",1e4,function(){return t.Bu=null,t.Wu("Backend didn't respond within 10 seconds."),t.Qu("Offline"),Promise.resolve()}))},el.prototype.ju=function(t){"Online"===this.state?this.Qu("Unknown"):(this.Lu++,1<=this.Lu&&(this.Ku(),this.Wu("Connection failed 1 times. Most recent error: "+t.toString()),this.Qu("Offline")))},el.prototype.set=function(t){this.Ku(),this.Lu=0,"Online"===t&&(this.qu=!1),this.Qu(t)},el.prototype.Qu=function(t){t!==this.state&&(this.state=t,this.fi(t))},el.prototype.Wu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.qu?(Mr(e),this.qu=!1):Vr("OnlineStateTracker",e)},el.prototype.Ku=function(){null!==this.Bu&&(this.Bu.cancel(),this.Bu=null)},el);function el(t,e){this.os=t,this.fi=e,this.state="Unknown",this.Lu=0,this.Bu=null,this.qu=!0}function nl(t,e,n){var r=this;return(r=jf.call(this)||this).credentials=t,r.ou=e,r.serializer=n,r.$u=!1,r}function rl(t,e,n,r,i){var o=this;return(o=Gf.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Su=!1,o}function il(t,e,n,r,i){var o=this;return(o=Bf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function ol(t,e,n,r,i,o){this._n=t,this.ru=n,this.ou=r,this.au=i,this.listener=o,this.state=0,this.cu=0,this.uu=null,this.stream=null,this.gs=new qa(t,e)}function sl(t,e){this.su=t,this.iu=e}function ul(t,e){this.su=t,this.iu=e,this.type="FirstParty",this.user=gc.ei}function al(t){var e=this;this.Zc=null,this.currentUser=gc.UNAUTHENTICATED,this.tu=!1,this.eu=0,this.Hc=null,this.forceRefresh=!1,this.Zc=function(){e.eu++,e.currentUser=e.nu(),e.tu=!0,e.Hc&&e.Hc(e.currentUser)},this.eu=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Zc):(this.Zc(null),t.get().then(function(t){e.auth=t,e.Zc&&e.auth.addAuthTokenListener(e.Zc)},function(){}))}function cl(){this.Hc=null}function hl(t,e){this.key=t,this.Gc=e}function fl(){this.Mc=new vo(Hf.Oc),this.Lc=new vo(Hf.Bc)}function ll(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:if(!Il(r))return[3,4];e=0,n=r.Zu,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function pl(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:e=0,n=r.Zu,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function dl(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return e=n,Vr("RemoteStore","RemoteStore shutting down."),e.Xu.add(5),[4,pl(e)];case 1:return t.sent(),e.th.Si(),e.nh.set("Unknown"),[2]}})})}function vl(t,e){var n=t;n.Ju.has(e.targetId)||(n.Ju.set(e.targetId,e),bl(n)?wl(n):Ol(n).lu()&&gl(n,e))}function yl(t,e){var n=t,r=Ol(n);n.Ju.delete(e),r.lu()&&ml(n,e),0===n.Ju.size&&(r.lu()?r.du():Il(n)&&n.nh.set("Unknown"))}function gl(t,e){t.sh.Ee(e.targetId),Ol(t).bu(e)}function ml(t,e){t.sh.Ee(e),Ol(t).vu(e)}function wl(e){e.sh=new Co({Be:function(t){return e.Hu.Be(t)},qe:function(t){return e.Ju.get(t)||null}}),Ol(e).start(),e.nh.Uu()}function bl(t){return Il(t)&&!Ol(t).hu()&&0<t.Ju.size}function Il(t){return 0===t.Xu.size}function El(t){t.sh=void 0}function Tl(u,a,c){return m(this,void 0,void 0,function(){var n,o,s;return w(this,function(t){switch(t.label){case 0:if(u.nh.set("Online"),!(a instanceof ko&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Ju.has(i)?[4,o.Hu.ih(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Ju.delete(i),o.sh.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(u,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Vr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,_l(u,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Oo?u.sh.pe(a):a instanceof Ro?u.sh.xe(a):u.sh.Se(a),c.isEqual(qi.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,kf(u.Gu)];case 8:return o=t.sent(),0<=c.L(o)?[4,(i=c,(e=(r=u).sh.Me(i)).Gt.forEach(function(t,e){var n;0<t.resumeToken.O()&&(n=r.Ju.get(e))&&r.Ju.set(e,n.st(t.resumeToken,i))}),e.zt.forEach(function(t){var e,n=r.Ju.get(t);n&&(r.Ju.set(t,n.st(Di.B,n.et)),ml(r,t),e=new ro(n.target,t,1,n.sequenceNumber),gl(r,e))}),r.Hu.rh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Vr("RemoteStore","Failed to raise snapshot:",s=t.sent()),[4,_l(u,s)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function _l(n,r,i){return m(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!Xa(r))throw r;return n.Xu.add(1),[4,pl(n)];case 1:return t.sent(),n.nh.set("Offline"),i=i||function(){return kf(n.Gu)},n.os.Ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Vr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Xu.delete(1),[4,ll(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Al(e,n){return n().catch(function(t){return _l(e,t,n)})}function Nl(c){return m(this,void 0,void 0,function(){var i,o,s,u,a;return w(this,function(t){switch(t.label){case 0:o=Rl(i=c),s=0<i.Yu.length?i.Yu[i.Yu.length-1].batchId:-1,t.label=1;case 1:if(!(Il(i)&&i.Yu.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.Gu,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.vr.Lo(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Yu.length&&o.du(),[3,7]):(s=u.batchId,function(t,e){t.Yu.push(e);var n=Rl(t);n.lu()&&n.Du&&n.Cu(e.mutations)}(i,u),[3,6]);case 4:return a=t.sent(),[4,_l(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Sl(i)&&Dl(i),[2]}var e,n,r})})}function Sl(t){return Il(t)&&!Rl(t).hu()&&0<t.Yu.length}function Dl(t){Rl(t).start()}function xl(n,r){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return e=n,r?(e.Xu.delete(2),[4,ll(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Xu.add(2),[4,pl(e)]);case 3:t.sent(),e.nh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Ol(n){var t,e,r,i,o=this;return n.uh||(n.uh=(t=n.zu,e=n.os,r={yu:function(n){return m(this,void 0,void 0,function(){return w(this,function(t){return n.Ju.forEach(function(t,e){gl(n,t)}),[2]})})}.bind(null,n),Iu:function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){return El(e),bl(e)?(e.nh.ju(n),wl(e)):e.nh.set("Unknown"),[2]})})}.bind(null,n),pu:Tl.bind(null,n)},(i=t).ku(),new $f(e,i.ou,i.credentials,i.serializer,r)),n.Zu.push(function(e){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(n.uh.fu(),bl(n)?wl(n):n.nh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.uh.stop()];case 2:t.sent(),El(n),t.label=3;case 3:return[2]}})})})),n.uh}function Rl(n){var t,e,r,i,o=this;return n.hh||(n.hh=(t=n.zu,e=n.os,r={yu:function(e){return m(this,void 0,void 0,function(){return w(this,function(t){return Rl(e).xu(),[2]})})}.bind(null,n),Iu:function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return n&&Rl(e).Du?[4,function(r,i){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return oo(n=i.code)&&n!==kr.ABORTED?(e=r.Yu.shift(),Rl(r).fu(),[4,Al(r,function(){return r.Hu.ah(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Nl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Sl(e)&&Dl(e),[2]}})})}.bind(null,n),Fu:function(o){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){for(e=Rl(o),n=0,r=o.Yu;n<r.length;n++)i=r[n],e.Cu(i.mutations);return[2]})})}.bind(null,n),Nu:function(r,i,o){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return e=r.Yu.shift(),n=Lc.from(e,i,o),[4,Al(r,function(){return r.Hu.oh(n)})];case 1:return t.sent(),[4,Nl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},(i=t).ku(),new Jf(e,i.ou,i.credentials,i.serializer,r)),n.Zu.push(function(e){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(n.hh.fu(),[4,Nl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.hh.stop()];case 3:t.sent(),0<n.Yu.length&&(Vr("RemoteStore","Stopping write stream with "+n.Yu.length+" pending writes"),n.Yu=[]),t.label=4;case 4:return[2]}})})})),n.hh}var kl=function(t){this.key=t},Ll=function(t){this.key=t},Cl=(Object.defineProperty(Fl.prototype,"mh",{get:function(){return this.lh},enumerable:!1,configurable:!0}),Fl.prototype.Th=function(t,e){var u=this,a=e?e.Eh:new No,c=e?e.wh:this.wh,h=e?e.Qt:this.Qt,f=c,l=!1,p=Qu(this.query)&&c.size===this.query.limit?c.last():null,d=Ku(this.query)&&c.size===this.query.limit?c.first():null;if(t.ut(function(t,e){var n=c.get(t),r=(r=e instanceof Vu?e:null)&&(oa(u.query,r)?r:null),i=!!n&&u.Qt.has(n.key),o=!!r&&(r.Ye||u.Qt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Ih(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.dh(r,p)||d&&u.dh(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(h=r?(f=f.add(r),o?h.add(t):h.delete(t)):(f=f.delete(t),h.delete(t)))}),Qu(this.query)||Ku(this.query))for(;f.size>this.query.limit;){var n=Qu(this.query)?f.last():f.first(),f=f.delete(n.key),h=h.delete(n.key);a.track({type:1,doc:n})}return{wh:f,Eh:a,Ah:l,Qt:h}},Fl.prototype.Ih=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},Fl.prototype.gr=function(t,e,n){var o=this,r=this.wh;this.wh=t.wh,this.Qt=t.Qt;var i=t.Eh.qt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.dh(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jr()}}var r,i}),this.Rh(n);var s=e?this.Ph():[],u=0===this.fh.size&&this.Zt?1:0,a=u!==this._h;return this._h=u,0!==i.length||a?{snapshot:new So(this.query,t.wh,r,i,t.Qt,0==u,a,!1),gh:s}:{gh:s}},Fl.prototype.Us=function(t){return this.Zt&&"Offline"===t?(this.Zt=!1,this.gr({wh:this.wh,Eh:new No,Qt:this.Qt,Ah:!1},!1)):{gh:[]}},Fl.prototype.yh=function(t){return!this.lh.has(t)&&!!this.wh.has(t)&&!this.wh.get(t).Ye},Fl.prototype.Rh=function(t){var e=this;t&&(t.te.forEach(function(t){return e.lh=e.lh.add(t)}),t.ee.forEach(function(t){}),t.ne.forEach(function(t){return e.lh=e.lh.delete(t)}),this.Zt=t.Zt)},Fl.prototype.Ph=function(){var e=this;if(!this.Zt)return[];var n=this.fh;this.fh=To(),this.wh.forEach(function(t){e.yh(t.key)&&(e.fh=e.fh.add(t.key))});var r=[];return n.forEach(function(t){e.fh.has(t)||r.push(new Ll(t))}),this.fh.forEach(function(t){n.has(t)||r.push(new kl(t))}),r},Fl.prototype.Vh=function(t){this.lh=t.kc,this.fh=To();var e=this.Th(t.documents);return this.gr(e,!0)},Fl.prototype.ph=function(){return So.Kt(this.query,this.wh,this.Qt,0===this._h)},Fl),Pl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ul=function(t){this.key=t,this.bh=!1},Vl=(Object.defineProperty(Ml.prototype,"Wh",{get:function(){return!0===this.Qh},enumerable:!1,configurable:!0}),Ml);function Ml(t,e,n,r,i,o){this.Gu=t,this.Sh=e,this.Dh=n,this.Ch=r,this.currentUser=i,this.Nh=o,this.Fh={},this.xh=new Mi(ra,na),this.$h=new Map,this.kh=[],this.Mh=new uo(Jr.i),this.Oh=new Map,this.Lh=new zf,this.Bh={},this.qh=new Map,this.Uh=hf.Ta(),this.onlineState="Unknown",this.Qh=void 0}function Fl(t,e){this.query=t,this.lh=e,this._h=null,this.Zt=!1,this.fh=To(),this.Qt=To(),this.dh=sa(t),this.wh=new Ao(this.dh)}function ql(u,a,c,h){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return u.jh=function(t,e,n){return function(i,o,s,u){return m(this,void 0,void 0,function(){var n,e,r;return w(this,function(t){switch(t.label){case 0:return(n=o.view.Th(s)).Ah?[4,Uf(i.Gu,o.query,!1).then(function(t){var e=t.documents;return o.view.Th(e,n)})]:[3,2];case 1:n=t.sent(),t.label=2;case 2:return e=u&&u.Gt.get(o.targetId),r=o.view.gr(n,i.Wh,e),[2,(Wl(i,o.targetId,r.gh),r.snapshot)]}})})}(u,t,e,n)},[4,Uf(u.Gu,a,!0)];case 1:return e=t.sent(),n=new Cl(a,e.kc),r=n.Th(e.documents),i=xo.Xt(c,h&&"Offline"!==u.onlineState),o=n.gr(r,u.Wh,i),Wl(u,c,o.gh),s=new Pl(a,c,n),[2,(u.xh.set(a,s),u.$h.has(c)?u.$h.get(c).push(a):u.$h.set(c,[a]),o.snapshot)]}})})}function jl(n,i){return m(this,void 0,void 0,function(){var r,e;return w(this,function(t){switch(t.label){case 0:r=n,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Lf(r.Gu,i)];case 2:return e=t.sent(),i.Gt.forEach(function(t,e){var n=r.Oh.get(e);n&&(Gr(t.te.size+t.ee.size+t.ne.size<=1),0<t.te.size?n.bh=!0:0<t.ee.size?Gr(n.bh):0<t.ne.size&&(Gr(n.bh),n.bh=!1))}),[4,Xl(r,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Mf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Gl(t,r,e){var i,n=t;(n.Wh&&0===e||!n.Wh&&1===e)&&(i=[],n.xh.forEach(function(t,e){var n=e.view.Us(r);n.snapshot&&i.push(n.snapshot)}),function(t,i){var e=t;e.onlineState=i;var o=!1;e.Ls.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Us(i)&&(o=!0)}),o&&vc(e)}(n.Dh,r),i.length&&n.Fh.pu(i),n.onlineState=r,n.Wh&&n.Ch.ji(r))}function Bl(s,u,a){return m(this,void 0,void 0,function(){var n,o;return w(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.Gu,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.vr.Mo(e,r).next(function(t){return Gr(null!==t),n=t.keys(),i.vr.Qo(e,t)}).next(function(){return i.vr.Go(e)}).next(function(){return i.xc.$r(e,n)})}))];case 2:return o=t.sent(),Hl(n,u,a),zl(n,u),n.Ch.$i(u,"rejected",a),[4,Xl(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Mf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function zl(t,e){(t.qh.get(e)||[]).forEach(function(t){t.resolve()}),t.qh.delete(e)}function Hl(t,e,n){var r,i=t,o=i.Bh[i.currentUser.Zs()];o&&((r=o.get(e))&&(n?r.reject(n):r.resolve(),o=o.remove(e)),i.Bh[i.currentUser.Zs()]=o)}function Ql(e,t,n){void 0===n&&(n=null),e.Ch.Li(t);for(var r=0,i=e.$h.get(t);r<i.length;r++){var o=i[r];e.xh.delete(o),n&&e.Fh.Kh(o,n)}e.$h.delete(t),e.Wh&&e.Lh.Wc(t).forEach(function(t){e.Lh.zo(t)||Kl(e,t)})}function Kl(t,e){var n=t.Mh.get(e);null!==n&&(yl(t.Sh,n),t.Mh=t.Mh.remove(e),t.Oh.delete(n),Yl(t))}function Wl(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof kl?(t.Lh.Fa(u.key,e),r=t,i=u.key,r.Mh.get(i)||(Vr("SyncEngine","New document in limbo: "+i),r.kh.push(i),Yl(r))):u instanceof Ll?(Vr("SyncEngine","Document no longer in limbo: "+u.key),t.Lh.$a(u.key,e),t.Lh.zo(u.key)||Kl(t,u.key)):jr()}}function Yl(t){for(;0<t.kh.length&&t.Mh.size<t.Nh;){var e=t.kh.shift(),n=t.Uh.next();t.Oh.set(n,new Ul(e)),t.Mh=t.Mh.rt(e,n),vl(t.Sh,new ro(Ju(Hu(e.path)),n,2,bc.oi))}}function Xl(n,s,u){return m(this,void 0,void 0,function(){var r,i,o,e;return w(this,function(t){switch(t.label){case 0:return i=[],o=[],e=[],(r=n).xh.m()?[3,3]:(r.xh.forEach(function(t,n){e.push(r.jh(n,s,u).then(function(t){var e;t&&(r.Wh&&r.Ch.Ui(n.targetId,t.fromCache?"not-current":"current"),i.push(t),e=Mc.Gr(n.targetId,t),o.push(e))}))}),[4,Promise.all(e)]);case 1:return t.sent(),r.Fh.pu(i),[4,function(h,f){return m(this,void 0,void 0,function(){var r,e,n,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:r=h,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return ja.forEach(f,function(e){return ja.forEach(e.jr,function(t){return r.persistence.Co.Fa(n,e.targetId,t)}).next(function(){return ja.forEach(e.Kr,function(t){return r.persistence.Co.$a(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Xa(e=t.sent()))throw e;return Vr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=f;n<i.length;n++)o=i[n],s=o.targetId,o.fromCache||(u=r.Dc.get(s),a=u.et,c=u.it(a),r.Dc=r.Dc.rt(s,c));return[2]}})})}(r.Gu,o)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function $l(i,o){return m(this,void 0,void 0,function(){var n,r;return w(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Vr("SyncEngine","User change. New user:",o.Zs()),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,m,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).vr,m=e.xc,[4,e.persistence.runTransaction("Handle user change","readonly",function(y){var g;return e.vr.qo(y).next(function(t){return g=t,n=e.persistence.Ic(o),m=new Vc(e.Fc,n,e.persistence.Pc()),n.qo(y)}).next(function(t){for(var e=[],n=[],r=To(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var v=d[p];r=r.add(v.key)}}return m.$r(y,r).next(function(t){return{Gh:t,zh:e,Hh:n}})})})];case 1:return r=t.sent(),[2,(e.vr=n,e.xc=m,e.Sc.$c(e.xc),r)]}})})}(n.Gu,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).qh.forEach(function(t){t.forEach(function(t){t.reject(new Lr(kr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.qh.clear(),n.Ch.Wi(o,r.zh,r.Hh),[4,Xl(n,r.Gh)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Jl(u,a,c,h){return m(this,void 0,void 0,function(){var o,s;return w(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).Gu,n=a,i=(r=e).vr,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Oo(e,n).next(function(t){return t?r.xc.$r(e,t):ja.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Nl(o.Sh)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Hl(o,a,h||null),zl(o,a),o.Gu.vr.jo(a)):jr(),t.label=4;case 4:return[4,Xl(o,s)];case 5:return t.sent(),[3,7];case 6:Vr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Zl(h,f){return m(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:return rp(r=h),ip(r),!0!==f||!0===r.Qh?[3,3]:(e=r.Ch.Di(),[4,tp(r,e.A())]);case 1:return i=t.sent(),r.Qh=!0,[4,xl(r.Sh,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],vl(r.Sh,u);return[3,7];case 3:return!1!==f||!1===r.Qh?[3,7]:(a=[],c=Promise.resolve(),r.$h.forEach(function(t,e){r.Ch.Bi(e)?a.push(e):c=c.then(function(){return Ql(r,e),Pf(r.Gu,e,!0)}),yl(r.Sh,e)}),[4,c]);case 4:return t.sent(),[4,tp(r,a)];case 5:return t.sent(),(n=r).Oh.forEach(function(t,e){yl(n.Sh,e)}),n.Lh.jc(),n.Oh=new Map,n.Mh=new uo(Jr.i),r.Qh=!1,[4,xl(r.Sh,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function tp(v,y){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=v,n=[],r=[],i=0,o=y,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.$h.get(s))&&0!==a.length?[4,Cf(e.Gu,Ju(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],l=e.xh.get(f),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,Uf((e=i).Gu,o.query,!0)];case 1:return n=t.sent(),r=o.view.Vh(n),[2,(e.Wh&&Wl(e,o.targetId,r.gh),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Vf(e.Gu,s)];case 8:return d=t.sent(),[4,Cf(e.Gu,d)];case 9:return u=t.sent(),[4,ql(e,ep(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Fh.pu(r),n)]}})})}function ep(t){return zu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function np(s,u,a,c){return m(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=s).Qh?(Vr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.$h.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=n.Gu,e=r.Fc,r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.ia(t,r.Nc)}).then(function(t){var e=t.ra,n=t.readTime;return r.Nc=n,e}))];case 3:return i=t.sent(),o=Do.Jt(u,"current"===a),[4,Xl(n,i,o)];case 4:return t.sent(),[3,8];case 5:return[4,Pf(n.Gu,u,!0)];case 6:return t.sent(),Ql(n,u,c),[3,8];case 7:jr(),t.label=8;case 8:return[2]}var r,e})})}function rp(t){var e=t;return e.Sh.Hu.rh=jl.bind(null,e),e.Sh.Hu.Be=function(t,e){var n=t,r=n.Oh.get(e);if(r&&r.bh)return To().add(r.key);var i=To(),o=n.$h.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++)var a=u[s],c=n.xh.get(a),i=i.$t(c.view.mh);return i}.bind(null,e),e.Sh.Hu.ih=function(u,a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return(e=u).Ch.Ui(a,"rejected",c),n=e.Oh.get(a),(r=n&&n.key)?(i=(i=new uo(Jr.i)).rt(r,new Mu(r,qi.min())),o=To().add(r),s=new Do(qi.min(),new Map,new vo(Ai),i,o),[4,jl(e,s)]):[3,2];case 1:return t.sent(),e.Mh=e.Mh.remove(r),e.Oh.delete(a),Yl(e),[3,4];case 2:return[4,Pf(e.Gu,a,!1).then(function(){return Ql(e,a,c)}).catch(Mf)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.Fh.pu=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Ls.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Os=s}}r&&vc(n)}.bind(null,e.Dh),e.Fh.Kh=function(t,e,n){var r=t,i=r.Ls.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Ls.delete(e)}.bind(null,e.Dh),e}function ip(t){var e=t;return e.Sh.Hu.oh=function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Rf(e.Gu,o)];case 2:return r=t.sent(),Hl(e,n,null),zl(e,n),e.Ch.$i(n,"acknowledged"),[4,Xl(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Mf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,e),e.Sh.Hu.ah=Bl.bind(null,e),e}var op,sp=(fp.prototype.$c=function(t){this.Yh=t},fp.prototype.Or=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.rn.length||1===r.rn.length&&r.rn[0].field.p())||i.isEqual(qi.min())?this.Jh(e,r):this.Yh.$r(e,o).next(function(t){var n=s.Xh(r,t);return(Qu(r)||Ku(r))&&s.Ah(r.on,n,o,i)?s.Jh(e,r):(Ur()<=l.DEBUG&&Vr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ia(r)),s.Yh.Or(e,r,i).next(function(e){return n.forEach(function(t){e=e.rt(t.key,t)}),e}))})},fp.prototype.Xh=function(n,t){var r=new vo(sa(n));return t.forEach(function(t,e){e instanceof Vu&&oa(n,e)&&(r=r.add(e))}),r},fp.prototype.Ah=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.L(r))},fp.prototype.Jh=function(t,e){return Ur()<=l.DEBUG&&Vr("IndexFreeQueryEngine","Using full collection scan to execute query:",ia(e)),this.Yh.Or(t,e,qi.min())},fp),up=(hp.prototype.xo=function(t){return ja.resolve(0===this.vr.length)},hp.prototype.$o=function(t,e,n,r){var i=this.Zh;this.Zh++,0<this.vr.length&&this.vr[this.vr.length-1];var o=new kc(i,e,n,r);this.vr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.tl=this.tl.add(new Hf(a.key,i)),this.Sr.ko(t,a.key.path.h())}return ja.resolve(o)},hp.prototype.Mo=function(t,e){return ja.resolve(this.el(e))},hp.prototype.Lo=function(t,e){var n=e+1,r=this.nl(n),i=r<0?0:r;return ja.resolve(this.vr.length>i?this.vr[i]:null)},hp.prototype.Bo=function(){return ja.resolve(0===this.vr.length?-1:this.Zh-1)},hp.prototype.qo=function(t){return ja.resolve(this.vr.slice())},hp.prototype.Cr=function(t,e){var n=this,r=new Hf(e,0),i=new Hf(e,Number.POSITIVE_INFINITY),o=[];return this.tl.Nt([r,i],function(t){var e=n.el(t.Gc);o.push(e)}),ja.resolve(o)},hp.prototype.Mr=function(t,e){var r=this,i=new vo(Ai);return e.forEach(function(t){var e=new Hf(t,0),n=new Hf(t,Number.POSITIVE_INFINITY);r.tl.Nt([e,n],function(t){i=i.add(t.Gc)})}),ja.resolve(this.sl(i))},hp.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;Jr.F(i)||(i=i.child(""));var o=new Hf(new Jr(i),0),s=new vo(Ai);return this.tl.Ft(function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.Gc)),!0)},o),ja.resolve(this.sl(s))},hp.prototype.sl=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.el(t);null!==e&&r.push(e)}),r},hp.prototype.Qo=function(n,r){var i=this;Gr(0===this.il(r.batchId,"removed")),this.vr.shift();var o=this.tl;return ja.forEach(r.mutations,function(t){var e=new Hf(t.key,r.batchId);return o=o.delete(e),i.Co.Ko(n,t.key)}).next(function(){i.tl=o})},hp.prototype.jo=function(t){},hp.prototype.zo=function(t,e){var n=new Hf(e,0),r=this.tl.xt(n);return ja.resolve(e.isEqual(r&&r.key))},hp.prototype.Go=function(t){return this.vr.length,ja.resolve()},hp.prototype.il=function(t,e){return this.nl(t)},hp.prototype.nl=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},hp.prototype.el=function(t){var e=this.nl(t);return e<0||e>=this.vr.length?null:this.vr[e]},hp),ap=(cp.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.rl(e);return this.docs=this.docs.rt(r,{Zo:e,size:s,readTime:n}),this.size+=s-o,this.Sr.ko(t,r.path.h())},cp.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},cp.prototype.Ar=function(t,e){var n=this.docs.get(e);return ja.resolve(n?n.Zo:null)},cp.prototype.getEntries=function(t,e){var n=this,r=go;return e.forEach(function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)}),ja.resolve(r)},cp.prototype.Or=function(t,e,n){for(var r=bo,i=new Jr(e.path.child("")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,c=a.Zo,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof Vu&&oa(e,c)&&(r=r.rt(c.key,c))}return ja.resolve(r)},cp.prototype.ol=function(t,e){return ja.forEach(this.docs,function(t){return e(t)})},cp.prototype.aa=function(t){return new cp.ca(this)},cp.prototype.ha=function(t){return ja.resolve(this.size)},cp);function cp(t,e){this.Sr=t,this.rl=e,this.docs=new uo(Jr.i),this.size=0}function hp(t,e){this.Sr=t,this.Co=e,this.vr=[],this.Zh=1,this.tl=new vo(Hf.Oc)}function fp(){}function lp(t){var e=this;return(e=op.call(this)||this).la=t,e}ap.ca=(o(lp,op=Cc),lp.prototype.gr=function(n){var r=this,i=[];return this.dr.forEach(function(t,e){e?i.push(r.la.Tr(n,e,r.readTime)):r.la.Ir(t)}),ja.xn(i)},lp.prototype.Rr=function(t,e){return this.la.Ar(t,e)},lp.prototype.Pr=function(t,e){return this.la.getEntries(t,e)},lp);var pp,dp,vp=(kp.prototype.De=function(t,n){return this.al.forEach(function(t,e){return n(e)}),ja.resolve()},kp.prototype.Ra=function(t){return ja.resolve(this.lastRemoteSnapshotVersion)},kp.prototype.Pa=function(t){return ja.resolve(this.cl)},kp.prototype.Ea=function(t){return this.highestTargetId=this.hl.next(),ja.resolve(this.highestTargetId)},kp.prototype.ga=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.cl&&(this.cl=e),ja.resolve()},kp.prototype.Va=function(t){this.al.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.hl=new hf(e),this.highestTargetId=e),t.sequenceNumber>this.cl&&(this.cl=t.sequenceNumber)},kp.prototype.ya=function(t,e){return this.Va(e),this.targetCount+=1,ja.resolve()},kp.prototype.ba=function(t,e){return this.Va(e),ja.resolve()},kp.prototype.va=function(t,e){return this.al.delete(e.target),this.ul.Wc(e.targetId),--this.targetCount,ja.resolve()},kp.prototype.Vo=function(n,r,i){var o=this,s=0,u=[];return this.al.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.al.delete(t),u.push(o.Sa(n,e.targetId)),s++)}),ja.xn(u).next(function(){return s})},kp.prototype.Da=function(t){return ja.resolve(this.targetCount)},kp.prototype.Ca=function(t,e){var n=this.al.get(e)||null;return ja.resolve(n)},kp.prototype.Na=function(t,e,n){return this.ul.qc(e,n),ja.resolve()},kp.prototype.xa=function(e,t,n){this.ul.Qc(t,n);var r=this.persistence.Co,i=[];return r&&t.forEach(function(t){i.push(r.Ko(e,t))}),ja.xn(i)},kp.prototype.Sa=function(t,e){return this.ul.Wc(e),ja.resolve()},kp.prototype.ka=function(t,e){var n=this.ul.Kc(e);return ja.resolve(n)},kp.prototype.zo=function(t,e){return ja.resolve(this.ul.zo(e))},kp),yp=(Rp.prototype.start=function(){return Promise.resolve()},Rp.prototype.Si=function(){return this.qa=!1,Promise.resolve()},Object.defineProperty(Rp.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),Rp.prototype.nc=function(){},Rp.prototype.sc=function(){},Rp.prototype.Pc=function(){return this.Sr},Rp.prototype.Ic=function(t){var e=this.ll[t.Zs()];return e||(e=new up(this.Sr,this.Co),this.ll[t.Zs()]=e),e},Rp.prototype.Ac=function(){return this.Ha},Rp.prototype.Rc=function(){return this.br},Rp.prototype.runTransaction=function(t,e,n){var r=this;Vr("MemoryPersistence","Starting transaction:",t);var i=new gp(this.Ba.next());return this.Co.fl(),n(i).next(function(t){return r.Co.dl(i).next(function(){return t})}).Nn().then(function(t){return i.pr(),t})},Rp.prototype.wl=function(e,n){return ja.$n(Object.values(this.ll).map(function(t){return function(){return t.zo(e,n)}}))},Rp),gp=(o(Op,dp=Uc),Op),mp=(xp.El=function(t){return new xp(t)},Object.defineProperty(xp.prototype,"Il",{get:function(){if(this.Tl)return this.Tl;throw jr()},enumerable:!1,configurable:!0}),xp.prototype.Fa=function(t,e,n){return this.ml.Fa(n,e),this.Il.delete(n.toString()),ja.resolve()},xp.prototype.$a=function(t,e,n){return this.ml.$a(n,e),this.Il.add(n.toString()),ja.resolve()},xp.prototype.Ko=function(t,e){return this.Il.add(e.toString()),ja.resolve()},xp.prototype.removeTarget=function(t,e){var n=this;this.ml.Wc(e.targetId).forEach(function(t){return n.Il.add(t.toString())});var r=this.persistence.Ac();return r.ka(t,e.targetId).next(function(t){t.forEach(function(t){return n.Il.add(t.toString())})}).next(function(){return r.va(t,e)})},xp.prototype.fl=function(){this.Tl=new Set},xp.prototype.dl=function(n){var r=this,i=this.persistence.Rc().aa();return ja.forEach(this.Il,function(t){var e=Jr.D(t);return r.Al(n,e).next(function(t){t||i.Ir(e)})}).next(function(){return r.Tl=null,i.apply(n)})},xp.prototype.vc=function(t,e){var n=this;return this.Al(t,e).next(function(t){t?n.Il.delete(e.toString()):n.Il.add(e.toString())})},xp.prototype._l=function(t){return 0},xp.prototype.Al=function(t,e){var n=this;return ja.$n([function(){return ja.resolve(n.ml.zo(e))},function(){return n.persistence.Ac().zo(t,e)},function(){return n.persistence.wl(t,e)}])},xp),wp=(Dp.prototype.yu=function(t){this.gl=t},Dp.prototype.Iu=function(t){this.yl=t},Dp.prototype.onMessage=function(t){this.Vl=t},Dp.prototype.close=function(){this.Pl()},Dp.prototype.send=function(t){this.Rl(t)},Dp.prototype.pl=function(){this.gl()},Dp.prototype.bl=function(t){this.yl(t)},Dp.prototype.vl=function(t){this.Vl(t)},Dp),bp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ip=(Sp.prototype.Mu=function(e,t,n,r){var i=this.Nl(e,t);Vr("RestConnection","Sending: ",i,n);var o={};return this.Fl(o,r),this.xl(e,i,o,n).then(function(t){return Vr("RestConnection","Received: ",t),t},function(t){throw Fr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Sp.prototype.Ou=function(t,e,n,r){return this.Mu(t,e,n,r)},Sp.prototype.Fl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.21.1",t["Content-Type"]="text/plain",e)for(var n in e.zc)e.zc.hasOwnProperty(n)&&(t[n]=e.zc[n])},Sp.prototype.Nl=function(t,e){var n=bp[t];return this.Dl+"/v1/"+e+":"+n},o(Np,pp=Sp),Np.prototype.xl=function(a,e,n,r){return new Promise(function(o,s){var u=new Dr;u.listenOnce(Nr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Ar.NO_ERROR:var t=u.getResponseJson();Vr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Ar.TIMEOUT:Vr("Connection",'RPC "'+a+'" timed out'),s(new Lr(kr.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:var e,n,r=u.getStatus();Vr("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(kr).indexOf(i)?i:kr.UNKNOWN,s(new Lr(n,e.message))):s(new Lr(kr.UNKNOWN,"Server responded with status "+u.getStatus())):s(new Lr(kr.UNAVAILABLE,"Connection failed."));break;default:jr()}}finally{Vr("Connection",'RPC "'+a+'" completed.')}var i});var t=JSON.stringify(r);u.send(e,"POST",t,n,15)})},Np.prototype.Vu=function(t,e){var n,r,i=[this.Dl,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=_r(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Fl(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=v().indexOf("Electron/")||0<=(r=v()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=v().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){c.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Vr("Connection","Creating WebChannel: "+u,s);var c=o.createWebChannel(u,s),h=!1,f=!1,l=new wp({Rl:function(t){f?Vr("Connection","Not sending because WebChannel is closed:",t):(h||(Vr("Connection","Opening WebChannel transport."),c.open(),h=!0),Vr("Connection","WebChannel sending:",t),c.send(t))},Pl:function(){return c.close()}});return a(Sr.EventType.OPEN,function(){f||Vr("Connection","WebChannel transport opened.")}),a(Sr.EventType.CLOSE,function(){f||(f=!0,Vr("Connection","WebChannel transport closed"),l.bl())}),a(Sr.EventType.ERROR,function(t){f||(f=!0,Fr("Connection","WebChannel transport errored:",t),l.bl(new Lr(kr.UNAVAILABLE,"The operation could not be completed")))}),a(Sr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Gr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Vr("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=eo[i];if(void 0!==t)return so(t)}(),s=r.message,void 0===o&&(o=kr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.bl(new Lr(o,s)),c.close()):(Vr("Connection","WebChannel received:",n),l.vl(n)))}),setTimeout(function(){l.pl()},0),l},Np),Ep=(Ap.prototype.eh=function(t){this.Ll.push(t)},Ap.prototype.Si=function(){window.removeEventListener("online",this.$l),window.removeEventListener("offline",this.Ml)},Ap.prototype.Bl=function(){window.addEventListener("online",this.$l),window.addEventListener("offline",this.Ml)},Ap.prototype.kl=function(){Vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ll;t<e.length;t++)(0,e[t])(0)},Ap.prototype.Ol=function(){Vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ll;t<e.length;t++)(0,e[t])(1)},Ap.On=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Ap),Tp=(_p.prototype.eh=function(t){},_p.prototype.Si=function(){},_p);function _p(){}function Ap(){var t=this;this.$l=function(){return t.kl()},this.Ml=function(){return t.Ol()},this.Ll=[],this.Bl()}function Np(t){var e=this;return(e=pp.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function Sp(t){this.Sl=t,this.U=t.U;var e=t.ssl?"https":"http";this.Dl=e+"://"+t.host,this.Cl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}function Dp(t){this.Rl=t.Rl,this.Pl=t.Pl}function xp(t){this.persistence=t,this.ml=new zf,this.Tl=null}function Op(t){var e=this;return(e=dp.call(this)||this).Ma=t,e}function Rp(t){var e=this;this.ll={},this.Ba=new bc(0),this.qa=!1,this.qa=!0,this.Co=t(this),this.Ha=new vp(this),this.Sr=new Vh,this.br=new ap(this.Sr,function(t){return e.Co._l(t)})}function kp(t){this.persistence=t,this.al=new Mi($i,Ji),this.lastRemoteSnapshotVersion=qi.min(),this.highestTargetId=0,this.cl=0,this.ul=new zf,this.targetCount=0,this.hl=hf.ma()}function Lp(t){return new hs(t,!0)}var Cp,Pp,Up,Vp,Mp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Fp=(td.prototype.initialize=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ch=this.ql(e),this.persistence=this.Ul(e),[4,this.persistence.start()];case 1:return t.sent(),this.Ql=this.Wl(e),this.Gu=this.jl(e),[2]}})})},td.prototype.Wl=function(t){return null},td.prototype.jl=function(t){return e=this.persistence,n=new sp,r=t.Kl,new xf(e,n,r);var e,n,r},td.prototype.Ul=function(t){if(t.persistenceSettings.Gl)throw new Lr(kr.FAILED_PRECONDITION,Mp);return new yp(mp.El)},td.prototype.ql=function(t){return new Rc},td.prototype.terminate=function(){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ql&&this.Ql.stop(),[4,this.Ch.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}})})},td.prototype.clearPersistence=function(t,e){throw new Lr(kr.FAILED_PRECONDITION,Mp)},td),qp=(o(Zp,Vp=Fp),Zp.prototype.initialize=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Vp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){return n=(e=r).Fc,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.oa(t)}).then(function(t){e.Nc=t})]})})}(this.Gu)];case 2:return t.sent(),[4,this.zl.initialize(this,e)];case 3:return t.sent(),[4,ip(this.zl._i)];case 4:return t.sent(),[4,Nl(this.zl.Sh)];case 5:return t.sent(),[2]}})})},Zp.prototype.Wl=function(t){var e=this.persistence.Co.do;return new ih(e,t.os)},Zp.prototype.Ul=function(t){var e=Df(t.Sl.U,t.Sl.persistenceKey),n=Lp(t.Sl.U);return new bf(t.persistenceSettings.synchronizeTabs,e,t.clientId,eh.oo(t.persistenceSettings.cacheSizeBytes),t.os,ic(),oc(),n,this.Ch,t.persistenceSettings.La)},Zp.prototype.ql=function(t){return new Rc},Zp.prototype.clearPersistence=function(t,e){return function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Ga.On()?(e=n+"main",[4,Ga.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Df(t,e))},o(Jp,Up=Zp),Jp.prototype.initialize=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return[4,Up.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.zl._i,this.Ch instanceof Oc?(this.Ch._i={tr:Jl.bind(null,e),er:np.bind(null,e),nr:function(f,l,p){return m(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,c,h;return w(this,function(t){switch(t.label){case 0:if(!(n=rp(f)).Qh)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.$h.has(i)?(Vr("SyncEngine","Adding an already active target "+i),[3,5]):[4,Vf(n.Gu,i)]):[3,6];case 2:return o=t.sent(),[4,Cf(n.Gu,o)];case 3:return s=t.sent(),[4,ql(n,ep(o),s.targetId,!1)];case 4:t.sent(),vl(n.Sh,s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.$h.has(e)?[4,Pf(n.Gu,e,!1).then(function(){yl(n.Sh,e),Ql(n,e)}).catch(Mf)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,c=p,t.label=7;case 7:return a<c.length?(h=c[a],[5,u(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),Vi:function(t){return t.Gu.persistence.Vi()}.bind(null,e)},[4,this.Ch.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.ec(function(e){return m(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Zl(this.zl._i,e)];case 1:return t.sent(),this.Ql&&(e&&!this.Ql.Ti?this.Ql.start(this.Gu):e||this.Ql.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Jp.prototype.ql=function(t){if(t.persistenceSettings.Gl&&t.persistenceSettings.synchronizeTabs){var e=ic();if(!Oc.On(e))throw new Lr(kr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Df(t.Sl.U,t.Sl.persistenceKey);return new Oc(e,t.os,n,t.clientId,t.Kl)}return new Rc},Jp),jp=($p.prototype.initialize=function(n,r){return m(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.Gu?[3,2]:(this.Gu=n.Gu,this.Ch=n.Ch,this.zu=this.Hl(r),this.Sh=this.Yl(r),this.Dh=this.Jl(r),this._i=this.Xl(r),this.Ch.fi=function(t){return Gl(e._i,t,1)},this.Sh.Hu.Zl=$l.bind(null,this._i),[4,xl(this.Sh,this._i.Wh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},$p.prototype.Jl=function(t){return new lc},$p.prototype.Hl=function(t){var e,n,r=Lp(t.Sl.U),i=(e=t.Sl,new Ip(e));return n=t.credentials,new Zf(n,i,r)},$p.prototype.Yl=function(t){function e(t){return Gl(n._i,t,0)}var n=this,r=this.Gu,i=this.zu,o=t.os,s=new(Ep.On()?Ep:Tp);return new qf(r,i,o,e,s)},$p.prototype.Xl=function(t){return e=this.Gu,n=this.Sh,r=this.Dh,i=this.Ch,o=t.Kl,s=t.Nh,u=!t.persistenceSettings.Gl||!t.persistenceSettings.synchronizeTabs,a=new Vl(e,n,r,i,o,s),u&&(a.Qh=!0),a;var e,n,r,i,o,s,u,a},$p.prototype.terminate=function(){return dl(this.Sh)},$p),Gp=(Xp.prototype.next=function(t){this.observer.next&&this.t_(this.observer.next,t)},Xp.prototype.error=function(t){this.observer.error?this.t_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Xp.prototype.e_=function(){this.muted=!0},Xp.prototype.t_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Xp),Bp=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Lr(kr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(ui("FieldPath","string",e,t[e]),0===t[e].length)throw new Lr(kr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.n_=new $r(t)},zp=(o(Yp,Pp=Bp),Yp.documentId=function(){return new Yp($r.v().R())},Yp.prototype.isEqual=function(t){if(!(t instanceof Yp))throw mi("isEqual","FieldPath",1,t);return this.n_.isEqual(t.n_)},Yp),Hp=new RegExp("[~\\*/\\[\\]]"),Qp=function(){this.s_=this},Kp=(o(Wp,Cp=Qp),Wp.prototype.r_=function(t){if(2!==t.o_)throw 1===t.o_?t.a_(this.i_+"() can only appear at the top level of your update data"):t.a_(this.i_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},Wp.prototype.isEqual=function(t){return t instanceof Wp},Wp);function Wp(t){var e=this;return(e=Cp.call(this)||this).i_=t,e}function Yp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Pp.call(this,t)||this}function Xp(t){this.observer=t,this.muted=!1}function $p(){}function Jp(){return null!==Up&&Up.apply(this,arguments)||this}function Zp(t){var e=this;return(e=Vp.call(this)||this).zl=t,e}function td(){}function ed(t,e,n){return new xd({o_:3,c_:e.settings.c_,methodName:t.i_,u_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var nd,rd,id,od,sd,ud,ad=(o(Sd,ud=Qp),Sd.prototype.r_=function(t){return new tu(t.path,new Fs)},Sd.prototype.isEqual=function(t){return t instanceof Sd},Sd),cd=(o(Nd,sd=Qp),Nd.prototype.r_=function(t){var e=ed(this,t,!0),n=this.h_.map(function(t){return Vd(t,e)}),r=new qs(n);return new tu(t.path,r)},Nd.prototype.isEqual=function(t){return this===t},Nd),hd=(o(Ad,od=Qp),Ad.prototype.r_=function(t){var e=ed(this,t,!0),n=this.h_.map(function(t){return Vd(t,e)}),r=new Hs(n);return new tu(t.path,r)},Ad.prototype.isEqual=function(t){return this===t},Ad),fd=(o(_d,id=Qp),_d.prototype.r_=function(t){var e=new Ys(t.serializer,ps(t.serializer,this.l_));return new tu(t.path,e)},_d.prototype.isEqual=function(t){return this===t},_d),ld=(o(Td,rd=Qp),Td.delete=function(){return ri("FieldValue.delete",arguments),new pd(new Kp("FieldValue.delete"))},Td.serverTimestamp=function(){return ri("FieldValue.serverTimestamp",arguments),new pd(new ad("FieldValue.serverTimestamp"))},Td.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return oi("FieldValue.arrayUnion",arguments,1),new pd(new cd("FieldValue.arrayUnion",t))},Td.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return oi("FieldValue.arrayRemove",arguments,1),new pd(new hd("FieldValue.arrayRemove",t))},Td.increment=function(t){return ui("FieldValue.increment","number",1,t),ii("FieldValue.increment",arguments,1),new pd(new fd("FieldValue.increment",t))},Td),pd=(o(Ed,nd=ld),Ed.prototype.r_=function(t){return this.s_.r_(t)},Ed.prototype.isEqual=function(t){return t instanceof Ed&&this.s_.isEqual(t.s_)},Ed),dd=(Object.defineProperty(Id.prototype,"latitude",{get:function(){return this.__},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"longitude",{get:function(){return this.f_},enumerable:!1,configurable:!0}),Id.prototype.isEqual=function(t){return this.__===t.__&&this.f_===t.f_},Id.prototype.toJSON=function(){return{latitude:this.__,longitude:this.f_}},Id.prototype.H=function(t){return Ai(this.__,t.__)||Ai(this.f_,t.f_)},Id),vd=/^__.*__$/,yd=function(t,e,n){this.d_=t,this.w_=e,this.m_=n},gd=(bd.prototype.T_=function(t,e){var n=[];return null!==this.Qe?n.push(new du(t,this.data,this.Qe,e)):n.push(new pu(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new wu(t,this.fieldTransforms)),n},bd),md=(wd.prototype.T_=function(t,e){var n=[new du(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&n.push(new wu(t,this.fieldTransforms)),n},wd);function wd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function bd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function Id(t,e){if(ii("GeoPoint",arguments,2),ui("GeoPoint","number",1,t),ui("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Lr(kr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Lr(kr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.__=t,this.f_=e}function Ed(t){var e=this;return(e=nd.call(this)||this).s_=t,e.i_=t.i_,e}function Td(){return rd.call(this)||this}function _d(t,e){var n=this;return(n=id.call(this)||this).i_=t,n.l_=e,n}function Ad(t,e){var n=this;return(n=od.call(this)||this).i_=t,n.h_=e,n}function Nd(t,e){var n=this;return(n=sd.call(this)||this).i_=t,n.h_=e,n}function Sd(t){var e=this;return(e=ud.call(this)||this).i_=t,e}function Dd(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw jr()}}var xd=(Object.defineProperty(kd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"o_",{get:function(){return this.settings.o_},enumerable:!1,configurable:!0}),kd.prototype.I_=function(t){return new kd(Object.assign(Object.assign({},this.settings),t),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},kd.prototype.A_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.I_({path:n,u_:!1});return r.R_(t),r},kd.prototype.P_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.I_({path:n,u_:!1});return r.E_(),r},kd.prototype.g_=function(t){return this.I_({path:void 0,u_:!0})},kd.prototype.a_=function(t){return Bd(t,this.settings.methodName,this.settings.y_||!1,this.path,this.settings.c_)},kd.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.T(t)})||void 0!==this.fieldTransforms.find(function(t){return e.T(t.field)})},kd.prototype.E_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.R_(this.path.get(t))},kd.prototype.R_=function(t){if(0===t.length)throw this.a_("Document fields must not be empty");if(Dd(this.o_)&&vd.test(t))throw this.a_('Document fields cannot begin and end with "__"')},kd),Od=(Rd.prototype.V_=function(t,e,n,r){return void 0===r&&(r=!1),new xd({o_:t,methodName:e,c_:n,path:$r.g(),u_:!1,y_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},Rd);function Rd(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||Lp(t)}function kd(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.E_(),this.fieldTransforms=i||[],this.Qe=o||[]}function Ld(t,e,n,r,i,o){void 0===o&&(o={});var s=t.V_(o.merge||o.mergeFields?2:0,e,n,i);qd("Data must be an object, but it was:",s,r);var u,a,c=Md(r,s);if(o.merge)u=new Zs(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Bp)d=p.n_;else{if("string"!=typeof p)throw jr();d=Gd(e,p,n)}if(!s.contains(d))throw new Lr(kr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");zd(h,d)||h.push(d)}u=new Zs(h),a=s.fieldTransforms.filter(function(t){return u.He(t.field)})}else u=null,a=s.fieldTransforms;return new gd(new Nu(c),u,a)}function Cd(t,o,s,e){var u=t.V_(1,o,s);qd("Data must be an object, but it was:",u,e);var a=[],c=new Su;zr(e,function(t,e){var n,r=Gd(o,t,s),i=u.P_(r);e instanceof Qp&&e.s_ instanceof Kp?a.push(r):null!=(n=Vd(e,i))&&(a.push(r),c.set(r,n))});var n=new Zs(a);return new md(c.Je(),n,u.fieldTransforms)}function Pd(t,e,n,r,i,o){var s=t.V_(1,e,n),u=[jd(e,r,n)],a=[i];if(o.length%2!=0)throw new Lr(kr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(jd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p,d=[],v=new Su,y=u.length-1;0<=y;--y){zd(d,u[y])||(h=u[y],f=a[y],l=s.P_(h),f instanceof Qp&&f.s_ instanceof Kp?d.push(h):null!=(p=Vd(f,l))&&(d.push(h),v.set(h,p)))}var g=new Zs(d);return new md(v.Je(),g,s.fieldTransforms)}function Ud(t,e,n,r){return void 0===r&&(r=!1),Vd(n,t.V_(r?4:3,e))}function Vd(s,t){if(Fd(s))return qd("Unsupported field value:",t,s),Md(s,t);if(s instanceof Qp)return function(t,e){if(!Dd(e.o_))throw e.a_(t.i_+"() can only be used with update() and set()");if(!e.path)throw e.a_(t.i_+"() is not currently supported inside arrays");var n=t.r_(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.u_&&4!==t.o_)throw t.a_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Vd(i[r],t.g_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ps(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Fi.fromDate(t);return{timestampValue:ds(e.serializer,n)}}if(t instanceof Fi){var r=new Fi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ds(e.serializer,r)}}if(t instanceof dd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Oi)return{bytesValue:vs(e.serializer,t.q)};if(t instanceof yd){var i=e.U,o=t.d_;if(!o.isEqual(i))throw e.a_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:gs(t.d_||e.U,t.w_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.a_("Unsupported field value: "+vi(t))}(s,t)}function Md(t,r){var i={};return Hr(t)?r.path&&0<r.path.length&&r.Qe.push(r.path):zr(t,function(t,e){var n=Vd(e,r.A_(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Fd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Fi||t instanceof dd||t instanceof Oi||t instanceof yd||t instanceof Qp)}function qd(t,e,n){if(!Fd(n)||!di(n)){var r=vi(n);throw"an object"===r?e.a_(t+" a custom object"):e.a_(t+" "+r)}}function jd(t,e,n){if(e instanceof Bp)return e.n_;if("string"==typeof e)return Gd(t,e);throw Bd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Gd(t,e,n){try{return function(e){if(0<=e.search(Hp))throw new Lr(kr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(zp.bind.apply(zp,s([void 0],e.split("."))))}catch(t){throw new Lr(kr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).n_}catch(e){throw Bd(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Bd(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Lr(kr.INVALID_ARGUMENT,(u+=". ")+t+a)}function zd(t,e){return t.some(function(t){return t.isEqual(e)})}var Hd=(Xd.prototype.D_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.C_(),0<this.mutations.length)throw new Lr(kr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return m(this,void 0,void 0,function(){var i,e,n,r,o,s;return w(this,function(t){switch(t.label){case 0:return e=Ts((i=u).serializer)+"/documents",n={documents:a.map(function(t){return ws(i.serializer,t)})},[4,i.Ou("BatchGetDocuments",e,n)];case 1:return r=t.sent(),o=new Map,r.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){Gr(!!e.found),e.found.name,e.found.updateTime;var n=bs(t,e.found.name),r=ys(e.found.updateTime),i=new Nu({mapValue:{fields:e.found.fields}});return new Vu(n,r,i,{})}(e,n):"missing"in n?function(t,e){Gr(!!e.missing),Gr(!!e.readTime);var n=bs(t,e.missing),r=ys(e.readTime);return new Mu(n,r)}(e,n):jr());o.set(r.key.toString(),r)}),s=[],[2,(a.forEach(function(t){var e=o.get(t.toString());Gr(!!e),s.push(e)}),s)]}})})}(this.zu,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Mu||t instanceof Vu?n.N_(t):jr()}),e)]}})})},Xd.prototype.set=function(t,e){this.write(e.T_(t,this.Ke(t))),this.S_.add(t.toString())},Xd.prototype.update=function(t,e){try{this.write(e.T_(t,this.F_(t)))}catch(t){this.v_=t}this.S_.add(t.toString())},Xd.prototype.delete=function(t){this.write([new _u(t,this.Ke(t))]),this.S_.add(t.toString())},Xd.prototype.commit=function(){return m(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.C_(),this.v_)throw this.v_;return e=this.p_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=Jr.D(e);r.mutations.push(new Au(n,r.Ke(n)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=Ts((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Ns(e.serializer,t)})},[4,e.Mu("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.zu,this.mutations)];case 1:return t.sent(),this.b_=!0,[2]}})})},Xd.prototype.N_=function(t){var e;if(t instanceof Vu)e=t.version;else{if(!(t instanceof Mu))throw jr();e=qi.min()}var n=this.p_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Lr(kr.ABORTED,"Document version changed between two reads.")}else this.p_.set(t.key.toString(),e)},Xd.prototype.Ke=function(t){var e=this.p_.get(t.toString());return!this.S_.has(t.toString())&&e?ru.updateTime(e):ru.Ge()},Xd.prototype.F_=function(t){var e=this.p_.get(t.toString());if(this.S_.has(t.toString())||!e)return ru.exists(!0);if(e.isEqual(qi.min()))throw new Lr(kr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ru.updateTime(e)},Xd.prototype.write=function(t){this.C_(),this.mutations=this.mutations.concat(t)},Xd.prototype.C_=function(){},Xd),Qd=(Yd.prototype.run=function(){this.k_()},Yd.prototype.k_=function(){var t=this;this.gs.Rn(function(){return m(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new Hd(this.zu),(n=this.M_(e))&&n.then(function(t){r.os.ds(function(){return e.commit().then(function(){r.hs.resolve(t)}).catch(function(t){r.O_(t)})})}).catch(function(t){r.O_(t)}),[2]})})})},Yd.prototype.M_=function(t){try{var e=this.updateFunction(t);return!Qi(e)&&e.catch&&e.then?e:(this.hs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hs.reject(t),null}},Yd.prototype.O_=function(t){var e=this;0<this.x_&&this.L_(t)?(--this.x_,this.os.ds(function(){return e.k_(),Promise.resolve()})):this.hs.reject(t)},Yd.prototype.L_=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!oo(e)},Yd),Kd=(Wd.prototype.start=function(t,e,n,r){var i=this;this.q_(),this.Sl=t;var o=new Ma,s=!1;return this.credentials.Jc(function(t){if(!s)return s=!0,Vr("FirestoreClient","Initializing. user=",t.uid),i.U_(e,n,r,t,o).then(i.B_.resolve,i.B_.reject);i.os.Ds(function(){return function(r,i){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return(e=r).os.Fs(),Vr("RemoteStore","RemoteStore received new credentials"),n=Il(e),e.Xu.add(3),[4,pl(e)];case 1:return t.sent(),n&&e.nh.set("Unknown"),[4,e.Hu.Zl(i)];case 2:return t.sent(),e.Xu.delete(3),[4,ll(e)];case 3:return t.sent(),[2]}})})}(i.Sh,t)})}),this.os.ds(function(){return i.B_.promise}),o.promise},Wd.prototype.enableNetwork=function(){var e=this;return this.q_(),this.os.enqueue(function(){return e.persistence.sc(!0),(t=e.Sh).Xu.delete(0),ll(t);var t})},Wd.prototype.U_=function(i,o,s,u,a){return m(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={os:this.os,Sl:this.Sl,clientId:this.clientId,credentials:this.credentials,Kl:u,Nh:100,persistenceSettings:s},[4,i.initialize(e)];case 1:return t.sent(),[4,o.initialize(i,e)];case 2:return t.sent(),this.persistence=i.persistence,this.Ch=i.Ch,this.Gu=i.Gu,this.Ql=i.Ql,this.zu=o.zu,this.Sh=o.Sh,this._i=o._i,this.Q_=o.Dh,this.Q_.qs=function(u,a){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return e=rp(u),(i=e.xh.get(a))?(n=i.targetId,e.Ch.Mi(n),r=i.view.ph(),[3,4]):[3,1];case 1:return[4,Cf(e.Gu,Ju(a))];case 2:return o=t.sent(),s=e.Ch.Mi(o.targetId),n=o.targetId,[4,ql(e,a,n,"current"===s)];case 3:r=t.sent(),e.Wh&&vl(e.Sh,o),t.label=4;case 4:return[2,r]}})})}.bind(null,this._i),this.Q_.Ws=function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).xh.get(o),1<(r=e.$h.get(n.targetId)).length?[2,(e.$h.set(n.targetId,r.filter(function(t){return!na(t,o)})),void e.xh.delete(o))]:e.Wh?(e.Ch.Li(n.targetId),e.Ch.Ni(n.targetId)?[3,2]:[4,Pf(e.Gu,n.targetId,!1).then(function(){e.Ch.qi(n.targetId),yl(e.Sh,n.targetId),Ql(e,n.targetId)}).catch(Mf)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Ql(e,n.targetId),[4,Pf(e.Gu,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,this._i),this.persistence.nc(function(){return m(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),a.resolve(),[3,4];case 3:if(n=t.sent(),a.reject(n),!this.W_(n))throw n;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),this.U_(new Fp,new jp,{Gl:!1},u,a))];case 4:return[2]}})})},Wd.prototype.W_=function(t){return"FirebaseError"===t.name?t.code===kr.FAILED_PRECONDITION||t.code===kr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Wd.prototype.q_=function(){if(this.os.Vs)throw new Lr(kr.FAILED_PRECONDITION,"The client has already been terminated.")},Wd.prototype.disableNetwork=function(){var t=this;return this.q_(),this.os.enqueue(function(){return t.persistence.sc(!1),function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return(e=n).Xu.add(0),[4,pl(e)];case 1:return t.sent(),e.nh.set("Offline"),[2]}})})}(t.Sh)})},Wd.prototype.terminate=function(){var t=this;this.os.Ss();var r=new Ma;return this.os.ps(function(){return m(t,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.Ql&&this.Ql.stop(),[4,dl(this.Sh)];case 1:return t.sent(),[4,this.Ch.Si()];case 2:return t.sent(),[4,this.persistence.Si()];case 3:return t.sent(),this.credentials.Xc(),r.resolve(),[3,5];case 4:return e=t.sent(),n=hc(e,"Failed to shutdown persistence"),r.reject(n),[3,5];case 5:return[2]}})})}),r.promise},Wd.prototype.waitForPendingWrites=function(){var t=this;this.q_();var e=new Ma;return this.os.ds(function(){return function(u,a){return m(this,void 0,void 0,function(){var n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:Il((n=u).Sh)||Vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.Gu).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.vr.Bo(t)})];case 2:return-1===(r=t.sent())?[2,void a.resolve()]:((i=n.qh.get(r)||[]).push(a),n.qh.set(r,i),[3,4]);case 3:return o=t.sent(),s=hc(o,"Initialization of waitForPendingWrites() operation failed"),a.reject(s),[3,4];case 4:return[2]}var e})})}(t._i,e)}),e.promise},Wd.prototype.listen=function(t,e,n){var r=this;this.q_();var i=new Gp(n),o=new yc(t,i,e);return this.os.ds(function(){return pc(r.Q_,o)}),function(){i.e_(),r.os.ds(function(){return dc(r.Q_,o)})}},Wd.prototype.j_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return t.sent(),e=new Ma,[2,(this.os.ds(function(){return function(s,u,a){return m(this,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=u,(n=s).persistence.runTransaction("read document","readonly",function(t){return n.xc.Dr(t,e)}))];case 1:return(r=t.sent())instanceof Vu?a.resolve(r):r instanceof Mu?a.resolve(null):a.reject(new Lr(kr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=t.sent(),o=hc(i,"Failed to get document '"+u+" from cache"),a.reject(o),[3,3];case 3:return[2]}var e,n})})}(n.Gu,r,e)}),e.promise)]}})})},Wd.prototype.K_=function(c,h){return void 0===h&&(h={}),m(this,void 0,void 0,function(){var e,a=this;return w(this,function(t){switch(t.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return t.sent(),e=new Ma,[2,(this.os.ds(function(){return n=a.Q_,r=a.os,i=c,o=h,s=e,t=new Gp({next:function(t){r.ds(function(){return dc(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Lr(kr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Lr(kr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new yc(Hu(i.path),t,{includeMetadataChanges:!0,Js:!0}),pc(n,u);var n,r,i,o,s,t,u}),e.promise)]}})})},Wd.prototype.G_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return t.sent(),e=new Ma,[2,(this.os.ds(function(){return function(u,a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Uf(u,a,!0)];case 1:return e=t.sent(),n=new Cl(a,e.kc),r=n.Th(e.documents),i=n.gr(r,!1),c.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=hc(o,"Failed to execute query '"+a+" against cache"),c.reject(s),[3,3];case 3:return[2]}})})}(n.Gu,r,e)}),e.promise)]}})})},Wd.prototype.z_=function(c,h){return void 0===h&&(h={}),m(this,void 0,void 0,function(){var u,a=this;return w(this,function(t){switch(t.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return t.sent(),u=new Ma,[2,(this.os.ds(function(){return e=a.Q_,n=a.os,t=c,r=h,i=u,o=new Gp({next:function(t){n.ds(function(){return dc(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Lr(kr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new yc(t,o,{includeMetadataChanges:!0,Js:!0}),pc(e,s);var e,n,t,r,i,o,s}),u.promise)]}})})},Wd.prototype.write=function(t){var e=this;this.q_();var n=new Ma;return this.os.ds(function(){return function(v,y,g){return m(this,void 0,void 0,function(){var u,a,p,d;return w(this,function(t){switch(t.label){case 0:u=ip(v),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(o=u.Gu,c=y,f=o,l=Fi.now(),s=c.reduce(function(t,e){return t.add(e.key)},To()),f.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.xc.$r(a,s).next(function(t){h=t;for(var u,e,n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=(u=o,e=h.get(o.key),u instanceof wu?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Vu?t.field(i.field):void 0,s=Us(i.transform,o||null);null!=s&&(e=null==e?(new Su).set(i.field,s):e.set(i.field,s))}return e?e.Je():null}(e):null);null!=s&&n.push(new du(o.key,s,ku(s.proto.mapValue),ru.exists(!0)))}return f.vr.$o(a,l,n,c)})}).then(function(t){var e=t.hr(h);return{batchId:t.batchId,dr:e}}))];case 2:return a=t.sent(),u.Ch.Fi(a.batchId),e=u,n=a.batchId,r=g,i=(i=(i=e.Bh[e.currentUser.Zs()])||new uo(Ai)).rt(n,r),e.Bh[e.currentUser.Zs()]=i,[4,Xl(u,a.dr)];case 3:return t.sent(),[4,Nl(u.Sh)];case 4:return t.sent(),[3,6];case 5:return p=t.sent(),d=hc(p,"Failed to persist write"),g.reject(d),[3,6];case 6:return[2]}var e,n,r,i,o,c,h,f,l,s})})}(e._i,t,n)}),n.promise},Wd.prototype.U=function(){return this.Sl.U},Wd.prototype.H_=function(t){var e=this;this.q_();var r=new Gp(t);return this.os.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){return[2,(e=this.Q_,n=r,e.Bs.add(n),void n.next())];var e,n})})}),function(){r.e_(),e.os.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){return[2,void this.Q_.Bs.delete(r)]})})})}},Object.defineProperty(Wd.prototype,"Y_",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),Wd.prototype.transaction=function(t){var e=this;this.q_();var n=new Ma;return this.os.ds(function(){return new Qd(e.os,e.zu,t,n).run(),Promise.resolve()}),n.promise},Wd);function Wd(t,e){this.credentials=t,this.os=e,this.clientId=Ti.k(),this.B_=new Ma}function Yd(t,e,n,r){this.os=t,this.zu=e,this.updateFunction=n,this.hs=r,this.x_=5,this.gs=new qa(this.os,"transaction_retry")}function Xd(t){this.zu=t,this.p_=new Map,this.mutations=[],this.b_=!1,this.v_=null,this.S_=new Set}function $d(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Jd,Zd,tv=(mv.prototype.tf=function(t){switch(Ko(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ts(t.integerValue||t.doubleValue);case 3:return this.ef(t.timestampValue);case 4:return this.nf(t);case 5:return t.stringValue;case 6:return this.Z_(es(t.bytesValue));case 7:return this.sf(t.referenceValue);case 8:return this.if(t.geoPointValue);case 9:return this.rf(t.arrayValue);case 10:return this.af(t.mapValue);default:throw jr()}},mv.prototype.af=function(t){var n=this,r={};return zr(t.fields||{},function(t,e){r[t]=n.tf(e)}),r},mv.prototype.if=function(t){return new dd(ts(t.latitude),ts(t.longitude))},mv.prototype.rf=function(t){var e=this;return(t.values||[]).map(function(t){return e.tf(t)})},mv.prototype.nf=function(t){switch(this.J_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return zo(n)?t(n):n}(t);return null==e?null:this.tf(e);case"estimate":return this.ef(Ho(t));default:return null}},mv.prototype.ef=function(t){var e=Zo(t),n=new Fi(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},mv.prototype.sf=function(t){var e=Yr.P(t);Gr(Cs(e));var n=new Vi(e.get(1),e.get(3)),r=new Jr(e.u(5));return n.isEqual(this.U)||Mr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.X_(r)},mv),ev=eh.uo,nv=(gv.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},gv),rv=(Object.defineProperty(yv.prototype,"Ef",{get:function(){return this.If||(this.If=new Od(this.d_,this.Tf.ignoreUndefinedProperties)),this.If},enumerable:!1,configurable:!0}),yv.prototype.settings=function(t){ii("Firestore.settings",arguments,1),ui("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.Tf),t)).merge;var e=new nv(t);if(this.ff&&!this.Tf.isEqual(e))throw new Lr(kr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Tf=e).credentials&&(this.mf=function(t){if(!t)return new Qf;switch(t.type){case"gapi":var e=t.client;return Gr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Yf(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Lr(kr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},yv.prototype.enableNetwork=function(){return this._f(),this.ff.enableNetwork()},yv.prototype.disableNetwork=function(){return this._f(),this.ff.disableNetwork()},yv.prototype.enablePersistence=function(t){var e,n;if(this.ff)throw new Lr(kr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Mr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Lr(kr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Af(this.cf,this.uf,{Gl:!0,cacheSizeBytes:this.Tf.cacheSizeBytes,synchronizeTabs:r,La:i})},yv.prototype.clearPersistence=function(){return m(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.ff&&!this.ff.Y_)throw new Lr(kr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new Ma,[2,(this.lf.ps(function(){return m(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.cf.clearPersistence(this.d_,this.wf)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},yv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(yv.prototype,"Rf",{get:function(){return this._f(),this.ff.Y_},enumerable:!1,configurable:!0}),yv.prototype.waitForPendingWrites=function(){return this._f(),this.ff.waitForPendingWrites()},yv.prototype.onSnapshotsInSync=function(t){if(this._f(),$d(t))return this.ff.H_(t);ui("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.ff.H_(e)},yv.prototype._f=function(){return this.ff||this.Af(new Fp,new jp,{Gl:!1}),this.ff},yv.prototype.Pf=function(){return new Ci(this.d_,this.wf,this.Tf.host,this.Tf.ssl,this.Tf.experimentalForceLongPolling)},yv.prototype.Af=function(t,e,n){var r=this.Pf();return this.ff=new Kd(this.mf,this.lf),this.ff.start(r,t,e,n)},yv.df=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Lr(kr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Lr(kr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Vi(n)},Object.defineProperty(yv.prototype,"app",{get:function(){if(!this.hf)throw new Lr(kr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.hf},enumerable:!1,configurable:!0}),yv.prototype.collection=function(t){return ii("Firestore.collection",arguments,1),ui("Firestore.collection","non-empty string",1,t),this._f(),new Nv(Yr.P(t),this,null)},yv.prototype.doc=function(t){return ii("Firestore.doc",arguments,1),ui("Firestore.doc","non-empty string",1,t),this._f(),sv.gf(Yr.P(t),this,null)},yv.prototype.collectionGroup=function(t){if(ii("Firestore.collectionGroup",arguments,1),ui("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Lr(kr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this._f(),new _v((e=t,new qu(Yr.g(),e)),this,null);var e},yv.prototype.runTransaction=function(e){var n=this;return ii("Firestore.runTransaction",arguments,1),ui("Firestore.runTransaction","function",1,e),this._f().transaction(function(t){return e(new iv(n,t))})},yv.prototype.batch=function(){return this._f(),new ov(this)},Object.defineProperty(yv,"logLevel",{get:function(){switch(Ur()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),yv.setLogLevel=function(t){ii("Firestore.setLogLevel",arguments,1),li("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Cr.setLogLevel(t)},yv.prototype.yf=function(){return this.Tf.timestampsInSnapshots},yv.prototype.Vf=function(){return this.Tf},yv),iv=(vv.prototype.get=function(t){var n=this;ii("Transaction.get",arguments,1);var r=Lv("Transaction.get",t,this.pf);return this.bf.D_([r.w_]).then(function(t){if(!t||1!==t.length)return jr();var e=t[0];if(e instanceof Mu)return new av(n.pf,r.w_,null,!1,!1,r.m_);if(e instanceof Vu)return new av(n.pf,r.w_,e,!1,!1,r.m_);throw jr()})},vv.prototype.set=function(t,e,n){si("Transaction.set",arguments,2,3);var r=Lv("Transaction.set",t,this.pf);n=Ov("Transaction.set",n);var i=Cv(r.m_,e,n),o=Ld(this.pf.Ef,"Transaction.set",r.w_,i,null!==r.m_,n);return this.bf.set(r.w_,o),this},vv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof zp?(oi("Transaction.update",arguments,3),r=Lv("Transaction.update",t,this.pf),Pd(this.pf.Ef,"Transaction.update",r.w_,e,n,o)):(ii("Transaction.update",arguments,2),r=Lv("Transaction.update",t,this.pf),Cd(this.pf.Ef,"Transaction.update",r.w_,e)),this.bf.update(r.w_,i),this},vv.prototype.delete=function(t){ii("Transaction.delete",arguments,1);var e=Lv("Transaction.delete",t,this.pf);return this.bf.delete(e.w_),this},vv),ov=(dv.prototype.set=function(t,e,n){si("WriteBatch.set",arguments,2,3),this.Df();var r=Lv("WriteBatch.set",t,this.pf);n=Ov("WriteBatch.set",n);var i=Cv(r.m_,e,n),o=Ld(this.pf.Ef,"WriteBatch.set",r.w_,i,null!==r.m_,n);return this.vf=this.vf.concat(o.T_(r.w_,ru.Ge())),this},dv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Df(),i="string"==typeof e||e instanceof zp?(oi("WriteBatch.update",arguments,3),r=Lv("WriteBatch.update",t,this.pf),Pd(this.pf.Ef,"WriteBatch.update",r.w_,e,n,o)):(ii("WriteBatch.update",arguments,2),r=Lv("WriteBatch.update",t,this.pf),Cd(this.pf.Ef,"WriteBatch.update",r.w_,e)),this.vf=this.vf.concat(i.T_(r.w_,ru.exists(!0))),this},dv.prototype.delete=function(t){ii("WriteBatch.delete",arguments,1),this.Df();var e=Lv("WriteBatch.delete",t,this.pf);return this.vf=this.vf.concat(new _u(e.w_,ru.Ge())),this},dv.prototype.commit=function(){return this.Df(),this.Sf=!0,0<this.vf.length?this.pf._f().write(this.vf):Promise.resolve()},dv.prototype.Df=function(){if(this.Sf)throw new Lr(kr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},dv),sv=(o(pv,Zd=yd),pv.gf=function(t,e,n){if(t.length%2!=0)throw new Lr(kr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new pv(new Jr(t),e,n)},Object.defineProperty(pv.prototype,"id",{get:function(){return this.w_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(pv.prototype,"parent",{get:function(){return new Nv(this.w_.path.h(),this.firestore,this.m_)},enumerable:!1,configurable:!0}),Object.defineProperty(pv.prototype,"path",{get:function(){return this.w_.path.R()},enumerable:!1,configurable:!0}),pv.prototype.collection=function(t){if(ii("DocumentReference.collection",arguments,1),ui("DocumentReference.collection","non-empty string",1,t),!t)throw new Lr(kr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Yr.P(t);return new Nv(this.w_.path.child(e),this.firestore,null)},pv.prototype.isEqual=function(t){if(!(t instanceof pv))throw mi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.w_.isEqual(t.w_)&&this.m_===t.m_},pv.prototype.set=function(t,e){si("DocumentReference.set",arguments,1,2),e=Ov("DocumentReference.set",e);var n=Cv(this.m_,t,e),r=Ld(this.firestore.Ef,"DocumentReference.set",this.w_,n,null!==this.m_,e);return this.ff.write(r.T_(this.w_,ru.Ge()))},pv.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof zp?(oi("DocumentReference.update",arguments,2),Pd(this.firestore.Ef,"DocumentReference.update",this.w_,t,e,r)):(ii("DocumentReference.update",arguments,1),Cd(this.firestore.Ef,"DocumentReference.update",this.w_,t)),this.ff.write(n.T_(this.w_,ru.exists(!0)))},pv.prototype.delete=function(){return ii("DocumentReference.delete",arguments,0),this.ff.write([new _u(this.w_,ru.Ge())])},pv.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];si("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||$d(i[u])||(gi("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),hi("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,c={includeMetadataChanges:s.includeMetadataChanges};$d(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(ui("DocumentReference.onSnapshot","function",u,i[u]),ai("DocumentReference.onSnapshot","function",u+1,i[u+1]),ai("DocumentReference.onSnapshot","function",u+2,i[u+2]));var h={next:function(t){i[u]&&i[u](r.Cf(t))},error:i[u+1],complete:i[u+2]};return this.ff.listen(Hu(this.w_.path),c,h)},pv.prototype.get=function(t){var e=this;si("DocumentReference.get",arguments,0,1),kv("DocumentReference.get",t);var n=this.firestore._f();return t&&"cache"===t.source?n.j_(this.w_).then(function(t){return new av(e.firestore,e.w_,t,!0,t instanceof Vu&&t.Ye,e.m_)}):n.K_(this.w_,t).then(function(t){return e.Cf(t)})},pv.prototype.withConverter=function(t){return new pv(this.w_,this.firestore,t)},pv.prototype.Cf=function(t){var e=t.docs.get(this.w_);return new av(this.firestore,this.w_,e,t.fromCache,t.hasPendingWrites,this.m_)},pv),uv=(lv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},lv),av=(fv.prototype.data=function(t){var e=this;if(si("DocumentSnapshot.data",arguments,0,1),t=Rv("DocumentSnapshot.data",t),this.Nf){if(this.m_){var n=new cv(this.pf,this.w_,this.Nf,this.Ff,this.xf,null);return this.m_.fromFirestore(n,t)}return new tv(this.pf.d_,this.pf.yf(),t.serverTimestamps||"none",function(t){return new sv(t,e.pf,null)},function(t){return new Ui(t)}).tf(this.Nf.sn())}},fv.prototype.get=function(t,e){var n=this;if(si("DocumentSnapshot.get",arguments,1,2),e=Rv("DocumentSnapshot.get",e),this.Nf){var r=this.Nf.data().field(jd("DocumentSnapshot.get",t,this.w_));if(null!==r)return new tv(this.pf.d_,this.pf.yf(),e.serverTimestamps||"none",function(t){return new sv(t,n.pf,n.m_)},function(t){return new Ui(t)}).tf(r)}},Object.defineProperty(fv.prototype,"id",{get:function(){return this.w_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"ref",{get:function(){return new sv(this.w_,this.pf,this.m_)},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"exists",{get:function(){return null!==this.Nf},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"metadata",{get:function(){return new uv(this.xf,this.Ff)},enumerable:!1,configurable:!0}),fv.prototype.isEqual=function(t){if(!(t instanceof fv))throw mi("isEqual","DocumentSnapshot",1,t);return this.pf===t.pf&&this.Ff===t.Ff&&this.w_.isEqual(t.w_)&&(null===this.Nf?null===t.Nf:this.Nf.isEqual(t.Nf))&&this.m_===t.m_},fv),cv=(o(hv,Jd=av),hv.prototype.data=function(t){return Jd.prototype.data.call(this,t)},hv);function hv(){return null!==Jd&&Jd.apply(this,arguments)||this}function fv(t,e,n,r,i,o){this.pf=t,this.w_=e,this.Nf=n,this.Ff=r,this.xf=i,this.m_=o}function lv(t,e){this.hasPendingWrites=t,this.fromCache=e}function pv(t,e,n){var r=this;return(r=Zd.call(this,e.d_,t,n)||this).w_=t,r.firestore=e,r.m_=n,r.ff=r.firestore._f(),r}function dv(t){this.pf=t,this.vf=[],this.Sf=!1}function vv(t,e){this.pf=t,this.bf=e}function yv(t,e,n,r){var i=this;if(void 0===n&&(n=new Fp),void 0===r&&(r=new jp),this.cf=n,this.uf=r,this.hf=null,this.lf=new uc,this.INTERNAL={delete:function(){return m(i,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this._f(),[4,this.ff.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var o=t;this.hf=o,this.d_=yv.df(o),this.wf=o.name,this.mf=new Kf(e)}else{var s=t;if(!s.projectId)throw new Lr(kr.INVALID_ARGUMENT,"Must provide projectId");this.d_=new Vi(s.projectId,s.database),this.wf="[DEFAULT]",this.mf=new Qf}this.Tf=new nv({})}function gv(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Lr(kr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ci("settings","non-empty string","host",t.host),this.host=t.host,hi("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(gi("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),hi("settings","object","credentials",t.credentials),this.credentials=t.credentials,hi("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),hi("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Mr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Mr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,hi("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=eh.lo;else{if(t.cacheSizeBytes!==ev&&t.cacheSizeBytes<eh.ho)throw new Lr(kr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+eh.ho);this.cacheSizeBytes=t.cacheSizeBytes}hi("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function mv(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.J_=n,this.X_=r,this.Z_=i}function wv(t,e,n){if("string"==typeof n){if(""===n)throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xu(e)&&-1!==n.indexOf("/"))throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Yr.P(n));if(!Jr.F(r))throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ns(t,new Jr(r))}if(n instanceof yd)return ns(t,n.w_);throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+vi(n)+".")}function bv(t,e){if(!Array.isArray(t)||0===t.length)throw new Lr(kr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Lr(kr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Lr(kr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Lr(kr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function Iv(t,e,n){if(!n.isEqual(e))throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Ev(t){if(Ku(t)&&0===t.rn.length)throw new Lr(kr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Tv,_v=(xv.prototype.where=function(t,e,n){ii("Query.where",arguments,3),yi("Query.where",3,n);var r,i,o=li("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,e),s=jd("Query.where",t),u=function(t,e,n,r,i,o,s){var u;if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new Lr(kr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){bv(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(wv(r,t,f))}u={arrayValue:{values:a}}}else u=wv(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||bv(s,o),u=Ud(n,e,s,"in"===o||"not-in"===o);var l=aa.create(i,o,u);return function(t,e){if(e.un()){var n=Yu(t);if(null!==n&&!n.isEqual(e.field))throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Wu(t);null!==r&&Iv(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new Lr(kr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Lr(kr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(this.$f,"Query.where",this.firestore.Ef,this.firestore.d_,s,o,n);return new xv((r=this.$f,i=r.filters.concat([u]),new qu(r.path,r.collectionGroup,r.rn.slice(),i,r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.m_)},xv.prototype.orderBy=function(t,e){var n;if(si("Query.orderBy",arguments,1,2),ai("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Lr(kr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=jd("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o,s=new Ua(e,n);return i=s,null!==Wu(r=t)||null!==(o=Yu(r))&&Iv(0,o,i.field),s}(this.$f,o,n);return new xv((r=this.$f,i=r.rn.concat([s]),new qu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.m_)},xv.prototype.limit=function(t){return ii("Query.limit",arguments,1),ui("Query.limit","number",1,t),wi("Query.limit",1,t),new xv(Zu(this.$f,t,"F"),this.firestore,this.m_)},xv.prototype.limitToLast=function(t){return ii("Query.limitToLast",arguments,1),ui("Query.limitToLast","number",1,t),wi("Query.limitToLast",1,t),new xv(Zu(this.$f,t,"L"),this.firestore,this.m_)},xv.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.startAt",arguments,1);var r=this.kf("Query.startAt",t,e,!0);return new xv(ta(this.$f,r),this.firestore,this.m_)},xv.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.startAfter",arguments,1);var r=this.kf("Query.startAfter",t,e,!1);return new xv(ta(this.$f,r),this.firestore,this.m_)},xv.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.endBefore",arguments,1);var r=this.kf("Query.endBefore",t,e,!0);return new xv(ea(this.$f,r),this.firestore,this.m_)},xv.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];oi("Query.endAt",arguments,1);var r=this.kf("Query.endAt",t,e,!1);return new xv(ea(this.$f,r),this.firestore,this.m_)},xv.prototype.isEqual=function(t){if(!(t instanceof xv))throw mi("isEqual","Query",1,t);return this.firestore===t.firestore&&na(this.$f,t.$f)&&this.m_===t.m_},xv.prototype.withConverter=function(t){return new xv(this.$f,this.firestore,t)},xv.prototype.kf=function(h,t,e,n){if(yi(h,1,t),t instanceof av)return ii(h,s([t],e),1),function(t,e,n,r){if(!n)throw new Lr(kr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+h+"().");for(var i=[],o=0,s=$u(t);o<s.length;o++){var u=s[o];if(u.field.p())i.push(ns(e,n.key));else{var a=n.field(u.field);if(zo(a))throw new Lr(kr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var c=u.field.R();throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+c+"' (used as the orderBy) does not exist.")}i.push(a)}}return new Da(i,r)}(this.$f,this.firestore.d_,t.Nf,n);var r=[t].concat(e);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new Lr(kr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.p()){if("string"!=typeof c)throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Xu(t)&&-1!==c.indexOf("/"))throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Yr.P(c));if(!Jr.F(h))throw new Lr(kr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new Jr(h);u.push(ns(e,f))}else{var l=Ud(n,r,c);u.push(l)}}return new Da(u,o)}(this.$f,this.firestore.d_,this.firestore.Ef,h,r,n)},xv.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];si("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||$d(i[a])||(gi("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),hi("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),$d(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(ui("Query.onSnapshot","function",a,i[a]),ai("Query.onSnapshot","function",a+1,i[a+1]),ai("Query.onSnapshot","function",a+2,i[a+2]));var c={next:function(t){i[a]&&i[a](new Av(r.firestore,r.$f,t,r.m_))},error:i[a+1],complete:i[a+2]};return Ev(this.$f),this.firestore._f().listen(this.$f,u,c)},xv.prototype.get=function(t){var e=this;si("Query.get",arguments,0,1),kv("Query.get",t),Ev(this.$f);var n=this.firestore._f();return(t&&"cache"===t.source?n.G_(this.$f):n.z_(this.$f,t)).then(function(t){return new Av(e.firestore,e.$f,t,e.m_)})},xv),Av=(Object.defineProperty(Dv.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Dv.prototype,"empty",{get:function(){return this.Of.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(Dv.prototype,"size",{get:function(){return this.Of.docs.size},enumerable:!1,configurable:!0}),Dv.prototype.forEach=function(e,n){var r=this;si("QuerySnapshot.forEach",arguments,1,2),ui("QuerySnapshot.forEach","function",1,e),this.Of.docs.forEach(function(t){e.call(n,r.qf(t,r.metadata.fromCache,r.Of.Qt.has(t.key)))})},Object.defineProperty(Dv.prototype,"query",{get:function(){return new _v(this.Mf,this.pf,this.m_)},enumerable:!1,configurable:!0}),Dv.prototype.docChanges=function(t){t&&(gi("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),hi("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Of.jt)throw new Lr(kr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Lf&&this.Bf===e||(this.Lf=function(i,e,o){if(i.Ut.m()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ut;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.Of,e,this.qf.bind(this)),this.Bf=e),this.Lf},Dv.prototype.isEqual=function(t){if(!(t instanceof Dv))throw mi("isEqual","QuerySnapshot",1,t);return this.pf===t.pf&&na(this.Mf,t.Mf)&&this.Of.isEqual(t.Of)&&this.m_===t.m_},Dv.prototype.qf=function(t,e,n){return new cv(this.pf,t.key,t,e,n,this.m_)},Dv),Nv=(o(Sv,Tv=_v),Object.defineProperty(Sv.prototype,"id",{get:function(){return this.$f.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(Sv.prototype,"parent",{get:function(){var t=this.$f.path.h();return t.m()?null:new sv(new Jr(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Sv.prototype,"path",{get:function(){return this.$f.path.R()},enumerable:!1,configurable:!0}),Sv.prototype.doc=function(t){si("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Ti.k()),ui("CollectionReference.doc","non-empty string",1,t);var e=Yr.P(t);return sv.gf(this.$f.path.child(e),this.firestore,this.m_)},Sv.prototype.add=function(t){ii("CollectionReference.add",arguments,1);var e=this.m_?this.m_.toFirestore(t):t;ui("CollectionReference.add","object",1,e);var n=this.doc();return new sv(n.w_,this.firestore,null).set(e).then(function(){return n})},Sv.prototype.withConverter=function(t){return new Sv(this.Uf,this.firestore,t)},Sv);function Sv(t,e,n){var r=this;if(((r=Tv.call(this,Hu(t),e,n)||this).Uf=t).length%2!=1)throw new Lr(kr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.R()+" has "+t.length);return r}function Dv(t,e,n,r){this.pf=t,this.Mf=e,this.Of=n,this.m_=r,this.Lf=null,this.Bf=null,this.metadata=new uv(n.hasPendingWrites,n.fromCache)}function xv(t,e,n){this.$f=t,this.firestore=e,this.m_=n}function Ov(t,e){if(void 0===e)return{merge:!1};if(gi(t,e,["merge","mergeFields"]),hi(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+vi(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Lr(kr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+vi(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof zp}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Lr(kr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Rv(t,e){return void 0===e?{}:(gi(t,e,["serverTimestamps"]),fi(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function kv(t,e){ai(t,"object",1,e),e&&(gi(t,e,["source"]),fi(t,0,"source",e.source,["default","server","cache"]))}function Lv(t,e,n){if(e instanceof yd){if(e.firestore!==n)throw new Lr(kr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw mi(t,"DocumentReference",1,e)}function Cv(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Pv={Firestore:rv,GeoPoint:dd,Timestamp:Fi,Blob:Ui,Transaction:iv,WriteBatch:ov,DocumentReference:sv,DocumentSnapshot:av,Query:_v,QueryDocumentSnapshot:cv,QuerySnapshot:Av,CollectionReference:Nv,FieldPath:zp,FieldValue:ld,setLogLevel:rv.setLogLevel,CACHE_SIZE_UNLIMITED:ev};function Uv(t){t.INTERNAL.registerComponent(new xr("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new jp,i=new qp(r),new rv(e,n,i,r);var e,n,r,i},"PUBLIC").setServiceProps(Object.assign({},Pv))),t.registerVersion("@firebase/firestore","1.17.1")}Uv(r.default),Vv.__PRIVATE_registerFirestore=Uv,Object.defineProperty(Vv,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});