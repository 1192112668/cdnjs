!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(rp){"use strict";try{(function(){rp=rp&&Object.prototype.hasOwnProperty.call(rp,"default")?rp.default:rp;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(m,f=Error),m);function m(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,g.prototype.create),n}var g=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,E=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},S=_||self;function D(){}function k(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),V=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function L(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:L).apply(null,arguments)}function M(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var j=Date.now||function(){return+new Date};function U(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.da=function(){!this.j&&(this.j=!0,this.C(),0)&&(Object.prototype.hasOwnProperty.call(this,R)&&this[R]||(this[R]=++V))},q.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Q,H=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function K(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var X=S.navigator;if(X){var $=X.userAgent;if($){Q=$;break t}}Q=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=D;var rt,it,ot=K(Q,"Opera"),st=K(Q,"Trident")||K(Q,"MSIE"),ut=K(Q,"Edge"),at=ut||st,ht=K(Q,"Gecko")&&!(K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge"))&&!(K(Q,"Trident")||K(Q,"MSIE"))&&!K(Q,"Edge"),ct=K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=Q,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt={};function vt(u){return t=u,e=function(){for(var t=0,e=H(String(rt)).split("."),n=H(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=yt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var mt=S.document&&st&&(ft()||parseInt(rt,10))||void 0,gt=!st||9<=Number(mt),wt=st&&!vt("9"),bt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",D,e),S.removeEventListener("test",D,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},U(Tt,Et);var It={2:"touch",3:"pen",4:"mouse"};Tt.prototype.b=function(){Tt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,wt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),_t=0;function At(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++_t,this.V=this.X=!1}function St(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function Dt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n,r,i,o=e.type;o in t.a&&(r=t.a[o],(n=0<=(i=F(r,e)))&&Array.prototype.splice.call(r,i,1),n&&(St(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}Dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=xt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new At(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Rt={};function Vt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ft(r),e&&e[Nt]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Pt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vt(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[Nt]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Pt(t,e,n,!1,r,i)}function Pt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!gt)return null;var u,a,h=Ut(t);if(h||(t[Ot]=h=new Dt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=jt,r=a=gt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)bt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.V&&((e=t.src)&&e[Nt]?kt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ut(e))?(kt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):St(t)))}function Ct(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Lt(t),n.call(r,e)}function jt(t,e){if(t.V)return!0;if(gt)return Mt(t,new Tt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new Tt(e,this))}function Ut(t){return(t=t[Ot])instanceof Dt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==k(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Bt(){q.call(this),this.c=new Dt(this),(this.J=this).A=null}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.V&&a.capture==n&&(s=a.listener,u=a.aa||a.src,a.X&&kt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}U(Bt,q),Bt.prototype[Nt]=!0,(N=Bt.prototype).addEventListener=function(t,e,n,r){Vt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ft(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ut(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&Lt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Et(t,n):t instanceof Et?t.target=t.target||n:(s=t,et(t=new Et(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Gt(o,r,!0,t)&&s;if(s=Gt(o=t.a=n,r,!0,t)&&s,s=Gt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Gt(o=t.a=e[i],r,!1,t)&&s;return s},N.C=function(){if(Bt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.A=null},N.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=S.JSON.stringify;function Wt(){this.b=this.a=null}var Qt,Ht=(Kt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Kt(function(){return new Yt},function(t){t.reset()},100));function Kt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Yt(){this.next=this.b=this.a=null}function Xt(t){S.setTimeout(function(){throw t},0)}function $t(t,e){var n;Qt||(n=S.Promise.resolve(void 0),Qt=function(){n.then(te)}),Jt||(Qt(),Jt=!0),Zt.add(t,e)}Wt.prototype.add=function(t,e){var n=Ht.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Jt=!(Yt.prototype.reset=function(){this.next=this.b=this.a=null}),Zt=new Wt;function te(){for(var t,e,n;n=e=void 0,n=null,(e=Zt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Xt(t)}var r=Ht;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Jt=!1}function ee(t,e){Bt.call(this),this.b=t||1,this.a=e||S,this.f=C(this.Ua,this),this.g=j()}function ne(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function re(t,e,n){if("function"==k(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function ie(t,e,n){q.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function oe(t){t.T=re(t.b,t.c),t.f.apply(null,t.a)}function se(t){q.call(this),this.b=t,this.a={}}U(ee,Bt),(N=ee.prototype).Z=!1,N.L=null,N.Ua=function(){var t;this.Z&&(0<(t=j()-this.g)&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ne(this),this.start())))},N.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=j())},N.C=function(){ee.M.C.call(this),ne(this),delete this.a},U(ie,q),(N=ie.prototype).ba=!1,N.T=null,N.Ia=function(t){this.a=arguments,this.T?this.ba=!0:oe(this)},N.C=function(){ie.M.C.call(this),this.T&&(S.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},N.Pa=function(){this.T=null,this.ba&&(this.ba=!1,oe(this))},U(se,q);var ue=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=Vt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function ce(){}se.prototype.C=function(){se.M.C.call(this),he(this)},se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=null;function le(){return fe=fe||new Bt}function pe(t){Et.call(this,"serverreachability",t)}function de(){var t=le();t.dispatchEvent(new pe(t))}function ye(t){Et.call(this,"statevent",t)}function ve(){var t=le();t.dispatchEvent(new ye(t))}function me(t){Et.call(this,"timingevent",t)}function ge(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}U(pe,Et),U(ye,Et),U(me,Et);var we={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},be={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ee(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ie(){}Ee.prototype.a=null;var Ne,_e={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function Ae(){Et.call(this,"d")}function Se(){Et.call(this,"c")}function De(){}function ke(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new se(this),this.N=xe,t=at?125:void 0,this.O=new ee(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}U(Ae,Et),U(Se,Et),U(De,Ee),Ne=new De;var xe=45e3,Oe={},Re={};function Ve(t,e,n){t.B=1,t.f=tn(Ke(e)),t.j=n,t.F=!0,Pe(t,null)}function Pe(t,e){t.s=j(),Ce(t),t.A=Ke(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),dn(n.b,"t",r),t.w=0,t.a=or(t.g,t.g.w?e:null),0<t.J&&(t.D=new ie(C(t.ya,t,t.a),t.J)),ae(t.G,t.a,"readystatechange",t.Sa),e=t.m?Z(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),de()}function Le(t,e,n){for(var r,i,o,s,u=!0;!t.l&&t.w<n.length;){var a=(i=n,s=o=void 0,o=(r=t).w,-1==(s=i.indexOf("\n",o))?Re:(o=Number(i.substring(o,s)),isNaN(o)?Oe:(s+=1)+o>i.length?Re:(i=i.substr(s,o),r.w=s+o,i)));if(a==Re){4==e&&(t.c=4,ve(),u=!1);break}if(a==Oe){t.c=4,ve(),u=!1;break}Fe(t,a)}4==e&&0==n.length&&(t.c=1,ve(),u=!1),t.b=t.b&&u,u||(qe(t),Ue(t))}function Ce(t){t.P=j()+t.N,Me(t,t.N)}function Me(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=ge(C(t.Qa,t),e)}function je(t){t.h&&(S.clearTimeout(t.h),t.h=null)}function Ue(t){0==t.g.u||t.l||tr(t.g,t)}function qe(t){je(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ne(t.O),he(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Fe(t,e){try{var n,r,i,o,s,u,a,h,c,f,l=t.g;if(0!=l.u&&(l.a==t||En(l.b,t)))if(l.A=t.H,!t.o&&En(l.b,t)&&3==l.u){try{var p=l.ja.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var d=p;if(0==d[0]){t:if(!l.i){if(l.a){if(!(l.a.s+3e3<t.s))break t;Zn(l),l.a.cancel(),l.a=null}Jn(l),ve()}}else l.ia=d[1],0<l.ia-l.G&&d[2]<37500&&l.U&&0==l.m&&!l.l&&(l.l=ge(C(l.Na,l),6e3));if(bn(l.b)<=1&&l.O){try{l.O()}catch(t){}l.O=void 0}}else nr(l,11)}else if(!t.o&&l.a!=t||Zn(l),!W(e))for(e=p=l.ja.a.parse(e),p=0;p<e.length;p++){d=e[p],l.G=d[0],d=d[1],2==l.u?"c"==d[0]?(l.B=d[1],l.R=d[2],null!=(n=d[3])&&(l.oa=n),null!=(r=d[5])&&"number"==typeof r&&0<r&&(l.D=1.5*r),i=l,(o=t.a)&&(!(s=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=i.b).a&&(K(s,"spdy")||K(s,"quic")||K(s,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(Tn(u,u.b),u.b=null)),!i.s||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(i.ha=a,Ze(i.v,i.s,a))),l.u=3,l.c&&l.c.na(),h=t,(i=l).ea=ir(i,i.w?i.R:null,i.P),h.o?(In(i.b,h),c=h,(f=i.D)&&c.setTimeout(f),c.h&&(je(c),Ce(c)),i.a=h):$n(i),0<l.f.length&&Hn(l)):"stop"!=d[0]&&"close"!=d[0]||nr(l,7):3==l.u&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?nr(l,7):zn(l):"noop"!=d[0]&&l.c&&l.c.ma(d),l.m=0)}de()}catch(t){}}function Be(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)B(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ge(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ge)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=ke.prototype).setTimeout=function(t){this.N=t},N.Sa=function(t){t=t.target;var e=this.D;e&&3==qn(t)?e.Ia():this.ya(t)},N.ya=function(t){try{if(t==this.a)t:{var e=qn(this.a),n=this.a.qa();this.a.S();if(!(e<3||3==e&&!at&&!this.a.Y())){this.l||4!=e||7==n||de(),je(this);var r=this.a.S();this.H=r;var i=this.a.Y();if(this.b=200==r){if(this.R&&!this.o){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.c=3,ve(),qe(this),Ue(this);break t}this.o=!0,Fe(this,u)}this.F?(Le(this,e,i),at&&this.b&&3==e&&(ae(this.G,this.O,"tick",this.Ra),this.O.start())):Fe(this,i),4==e&&qe(this),this.b&&!this.l&&(4==e?tr(this.g,this):(this.b=!1,Ce(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.c=3:this.c=0,ve(),qe(this),Ue(this)}}}catch(t){}},N.Ra=function(){var t,e;this.a&&(t=qn(this.a),e=this.a.Y(),this.w<e.length&&(je(this),Le(this,t,e),this.b&&4!=t&&Ce(this)))},N.cancel=function(){this.l=!0,qe(this)},N.Qa=function(){this.h=null;var t=j();0<=t-this.P?(2!=this.B&&(de(),ve()),qe(this),this.c=2,Ue(this)):Me(this,this.P-t)},(N=Ge.prototype).I=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return ze(this),this.a.concat()},N.get=function(t,e){return We(this.b,t)?this.b[t]:e},N.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function He(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof He?(this.a=void 0!==e?e:t.a,Ye(this,t.f),this.j=t.j,Xe(this,t.c),$e(this,t.h),this.g=t.g,e=t.b,(n=new cn).c=e.c,e.a&&(n.a=new Ge(e.a),n.b=e.b),Je(this,n),this.i=t.i):t&&(n=String(t).match(Qe))?(this.a=!!e,Ye(this,n[1]||"",!0),this.j=en(n[2]||""),Xe(this,n[3]||"",!0),$e(this,n[4]),this.g=en(n[5]||"",!0),Je(this,n[6]||"",!0),this.i=en(n[7]||"")):(this.a=!!e,this.b=new cn(null,this.a))}function Ke(t){return new He(t)}function Ye(t,e,n){t.f=n?en(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Xe(t,e,n){t.c=n?en(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Je(t,e,n){var r,i;e instanceof cn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(fn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ln(this,e),dn(this,n,t))},r)),r.f=i):(n||(e=nn(e,an)),t.b=new cn(e,t.a))}function Ze(t,e,n){t.b.set(e,n)}function tn(t){return Ze(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^j()).toString(36)),t}function en(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function nn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}He.prototype.toString=function(){var t=[],e=this.f;e&&t.push(nn(e,on,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(nn(e,on,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(nn(n,"/"==n.charAt(0)?un:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",nn(n,hn)),t.join("")};var on=/[#\/\?@]/g,sn=/[#\?:]/g,un=/[#\?]/g,an=/[#\?@]/g,hn=/#/g;function cn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(u){u.a||(u.a=new Ge,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],o=n,s=i?decodeURIComponent(i.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function ln(t,e){fn(t),e=yn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function pn(t,e){return fn(t),e=yn(t,e),We(t.a.b,e)}function dn(t,e,n){ln(t,e),0<n.length&&(t.c=null,t.a.set(yn(t,e),z(n)),t.b+=n.length)}function yn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function vn(t,e){this.b=t,this.a=e}function mn(t){this.g=t||gn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ca&&S.ca.ua&&S.ca.ua()&&S.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=cn.prototype).add=function(t,e){fn(this),this.c=null,t=yn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){fn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},N.K=function(){fn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.I=function(t){fn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=G(e,this.a.get(yn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},N.set=function(t,e){return fn(this),this.c=null,pn(this,t=yn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.I(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var gn=10;function wn(t){return t.b||t.a&&t.a.size>=t.f}function bn(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Tn(t,e){t.a?t.a.add(e):t.b=e}function In(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.i)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function _n(){}function An(){this.a=new _n}function Sn(t,r,e){var i=e||"";try{Be(t,function(t,e){var n=t;O(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Dn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}mn.prototype.cancel=function(){var t,e;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},_n.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},_n.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var kn=S.JSON.parse;function xn(t){Bt.call(this),this.headers=new Ge,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=On,this.B=this.F=!1}U(xn,Bt);var On="",Rn=/^https?$/i,Vn=["POST","PUT"];function Pn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),jn(t)}function Cn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Mn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=qn(t)||2!=t.S()))if(t.l&&4==qn(t))re(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==qn(t)){t.b=!1;try{var e,n,r,i,o=t.S();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.D).match(Qe)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<qn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Cn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Un(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Un(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function qn(t){return t.a?t.a.readyState:0}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ze(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Bn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Bn("baseRetryDelayMs",5e3,t),this.Ga=Bn("retryDelaySeedMs",1e4,t),this.Da=Bn("forwardChannelMaxRetries",2,t),this.ga=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new mn(t&&t.concurrentRequestLimit),this.ja=new An,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function zn(t){var e,n;Wn(t),3==t.u&&(e=t.H++,Ze(n=Ke(t.v),"SID",t.B),Ze(n,"RID",e),Ze(n,"TYPE","terminate"),Yn(t,n),(e=new ke(t,e,void 0)).B=2,e.f=tn(Ke(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.f.toString(),"")),!n&&S.Image&&((new Image).src=e.f,n=!0),n||(e.a=or(e.g,null),e.a.$(e.f)),e.s=j(),Ce(e)),rr(t)}function Wn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(S.clearTimeout(t.i),t.i=null),Zn(t),t.b.cancel(),t.g&&("number"==typeof t.g&&S.clearTimeout(t.g),t.g=null)}function Qn(t,e){t.f.push(new vn(t.Fa++,e)),3==t.u&&Hn(t)}function Hn(t){wn(t.b)||t.g||(t.g=!0,$t(t.xa,t),t.o=0)}function Kn(t,e){var n=e?e.W:t.H++,r=Ke(t.v);Ze(r,"SID",t.B),Ze(r,"RID",n),Ze(r,"AID",t.G),Yn(t,r),t.h&&t.j&&Fn(r,t.h,t.j),n=new ke(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Xn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),Tn(t.b,n),Ve(n,r,e)}function Yn(t,n){t.c&&Be({},function(t,e){Ze(n,e,t)})}function Xn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Sn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function $n(t){t.a||t.i||(t.J=1,$t(t.wa,t),t.m=0)}function Jn(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=ge(C(t.wa,t),er(t,t.m)),t.m++,1)}function Zn(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function tr(t,e){var n,r=null;if(t.a==e){Zn(t),t.a=null;var i=2}else{if(!En(t.b,e))return;r=e.i,In(t.b,e),i=1}if(t.A=e.H,0!=t.u)if(e.b){1==i?(r=e.j?e.j.length:0,e=j()-e.s,n=t.o,(i=le()).dispatchEvent(new me(i)),Hn(t)):$n(t)}else if(3==(n=e.c)||0==n&&0<t.A||!(1==i&&function(t,e){if(!(bn(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=ge(C(t.xa,t,e),er(t,t.o)),t.o++,1}}(t,e)||2==i&&Jn(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function nr(t,e){var n,r,i,o,s,u;2==e?(n=null,t.c&&(n=null),r=C(t.Ta,t),n||(n=new He("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||Ye(n,"https"),tn(n)),i=n.toString(),o=r,u=new ce,S.Image?((s=new Image).onload=M(Dn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=M(Dn,u,s,"TestLoadImage: error",!1,o),s.onabort=M(Dn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=M(Dn,u,s,"TestLoadImage: timeout",!1,o),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):ve(),t.u=0,t.c&&t.c.la(e),rr(t),Wn(t)}function rr(t){t.u=0,t.A=-1,t.c&&(0==Nn(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.ka())}function ir(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof He?Ke(r):new He(r,void 0);return""!=c.c?(e&&Xe(c,e+"."+c.c),$e(c,c.h)):(o=(i=S.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new He(null,void 0),o&&Ye(h,o),s&&Xe(h,s),u&&$e(h,u),a&&(h.g=a),c=h),t.N&&J(t.N,function(t,e){Ze(c,e,t)}),e=t.s,n=t.ha,e&&n&&Ze(c,e,n),Ze(c,"VER",t.oa),Yn(t,c),c}function or(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Ea)).F=t.w,e}function sr(){}function ur(){if(st&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function ar(t,e){Bt.call(this),this.a=new Gn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new fr(this)}function hr(t){Ae.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Se.call(this),this.status=1}function fr(t){this.a=t}(N=xn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Te(this.G):Te(Ne),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Ln(this,t)}t=n||"";var i,o=new Ge(this.headers);r&&Be(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Pn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=S.FormData&&t instanceof S.FormData,0<=F(Vn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.B=(i=this.a,st&&vt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=re(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},N.ta=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jn(this))},N.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),xn.M.C.call(this)},N.va=function(){this.j||(this.w||this.l||this.g?Mn(this):this.Oa())},N.Oa=function(){Mn(this)},N.S=function(){try{return 2<qn(this)?this.a.status:-1}catch(t){return-1}},N.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),kn(e)}},N.qa=function(){return this.h},N.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Gn.prototype).oa=8,N.u=1,N.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new ke(this,t,void 0),r=this.j;if(this.F&&(r?et(r=Z(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xn(this,n,e),Ze(i=Ke(this.v),"RID",t),Ze(i,"CVER",22),this.s&&Ze(i,"X-HTTP-Session-Id",this.s),Yn(this,i),this.h&&r&&Fn(i,this.h,r),Tn(this.b,n),this.fa?(Ze(i,"$req",e),Ze(i,"SID","null"),n.R=!0,Ve(n,i,null)):Ve(n,i,e),this.u=2}}else 3==this.u&&(t?Kn(this,t):0==this.f.length||wn(this.b)||Kn(this))},N.wa=function(){this.i=null,this.a=new ke(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Ke(this.ea);Ze(t,"RID","rpc"),Ze(t,"SID",this.B),Ze(t,"CI",this.U?"0":"1"),Ze(t,"AID",this.G),Yn(this,t),Ze(t,"TYPE","xmlhttp"),this.h&&this.j&&Fn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=tn(Ke(t)),e.j=null,e.F=!0,Pe(e,n)},N.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Jn(this),ve())},N.Ta=function(t){ve()},(N=sr.prototype).na=function(){},N.ma=function(){},N.la=function(){},N.ka=function(){},N.Ha=function(){},ur.prototype.a=function(t,e){return new ar(t,e)},U(ar,Bt),(N=ar.prototype).addEventListener=function(t,e,n,r){ar.M.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){ar.M.removeEventListener.call(this,t,e,n,r)},N.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ve(),t.P=e,t.N=n||{},t.U=t.W,t.v=ir(t,null,t.P),Hn(t)},N.close=function(){zn(this.a)},N.La=function(t){var e;"string"==typeof t?((e={}).__data__=t,Qn(this.a,e)):this.g?((e={}).__data__=zt(t),Qn(this.a,e)):Qn(this.a,t)},N.C=function(){this.a.c=null,delete this.f,zn(this.a),delete this.a,ar.M.C.call(this)},U(hr,Ae),U(cr,Se),U(fr,sr),fr.prototype.na=function(){this.a.dispatchEvent("a")},fr.prototype.ma=function(t){this.a.dispatchEvent(new hr(t))},fr.prototype.la=function(t){this.a.dispatchEvent(new cr)},fr.prototype.ka=function(){this.a.dispatchEvent("b")},ur.prototype.createWebChannel=ur.prototype.a,ar.prototype.send=ar.prototype.La,ar.prototype.open=ar.prototype.Ka,ar.prototype.close=ar.prototype.close,we.NO_ERROR=0,we.TIMEOUT=8,we.HTTP_ERROR=6,be.COMPLETE="complete",(Ie.EventType=_e).OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",Bt.prototype.listen=Bt.prototype.ra,xn.prototype.listenOnce=xn.prototype.sa,xn.prototype.getLastError=xn.prototype.Ma,xn.prototype.getLastErrorCode=xn.prototype.qa,xn.prototype.getStatus=xn.prototype.S,xn.prototype.getResponseJson=xn.prototype.Ja,xn.prototype.getResponseText=xn.prototype.Y,xn.prototype.send=xn.prototype.$;var lr={createWebChannelTransport:function(){return new ur},ErrorCode:we,EventType:be,WebChannel:Ie,XhrIo:xn},pr=lr.createWebChannelTransport,dr=lr.ErrorCode,yr=lr.EventType,vr=lr.WebChannel,mr=lr.XhrIo,gr=rp.SDK_VERSION,wr=(br.prototype.t=function(){return null!=this.uid},br.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},br.prototype.isEqual=function(t){return t.uid===this.uid},br);function br(t){this.uid=t}function Er(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}wr.UNAUTHENTICATED=new wr(null),wr.i=new wr("google-credentials-uid"),wr.h=new wr("first-party-uid");var Tr,Ir,Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_r=(n(Br,Ir=Error),Br),Ar=(Fr.prototype.getToken=function(){return Promise.resolve(null)},Fr.prototype._=function(){},Fr.prototype.l=function(t){(this.u=t)(wr.UNAUTHENTICATED)},Fr.prototype.T=function(){this.u=null},Fr),Sr=(qr.prototype.getToken=function(){var e=this,n=this.m,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.m!==n)throw new _r(Nr.ABORTED,"getToken aborted due to token change.");return t?(Ws("string"==typeof t.accessToken),new Er(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},qr.prototype._=function(){this.forceRefresh=!0},qr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},qr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},qr.prototype.A=function(){var t=this.auth&&this.auth.getUid();return Ws(null===t||"string"==typeof t),new wr(t)},qr),Dr=(Object.defineProperty(Ur.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Ur),kr=(jr.prototype.getToken=function(){return Promise.resolve(new Dr(this.P,this.V))},jr.prototype.l=function(t){t(wr.h)},jr.prototype.T=function(){},jr.prototype._=function(){},jr),xr=(Mr.now=function(){return Mr.fromMillis(Date.now())},Mr.fromDate=function(t){return Mr.fromMillis(t.getTime())},Mr.fromMillis=function(t){var e=Math.floor(t/1e3);return new Mr(e,1e6*(t-1e3*e))},Mr.prototype.toDate=function(){return new Date(this.toMillis())},Mr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Mr.prototype.p=function(t){return this.seconds===t.seconds?Ks(this.nanoseconds,t.nanoseconds):Ks(this.seconds,t.seconds)},Mr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Mr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Mr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Mr),Or=(Cr.v=function(t){return new Cr(t)},Cr.min=function(){return new Cr(new xr(0,0))},Cr.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Cr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Cr.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Cr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Cr.prototype.C=function(){return this.timestamp},Cr),Rr=(Object.defineProperty(Lr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),Lr.prototype.isEqual=function(t){return 0===Lr.N(this,t)},Lr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Lr?t.forEach(function(t){e.push(t)}):e.push(t),this.$(e)},Lr.prototype.limit=function(){return this.offset+this.length},Lr.prototype.k=function(t){return t=void 0===t?1:t,this.$(this.segments,this.offset+t,this.length-t)},Lr.prototype.M=function(){return this.$(this.segments,this.offset,this.length-1)},Lr.prototype.L=function(){return this.segments[this.offset]},Lr.prototype.O=function(){return this.get(this.length-1)},Lr.prototype.get=function(t){return this.segments[this.offset+t]},Lr.prototype.B=function(){return 0===this.length},Lr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Lr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Lr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Lr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},Lr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Lr),Vr=(n(Pr,Tr=Rr),Pr.prototype.$=function(t,e,n){return new Pr(t,e,n)},Pr.prototype.j=function(){return this.W().join("/")},Pr.prototype.toString=function(){return this.j()},Pr.K=function(t){if(0<=t.indexOf("//"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Pr(t.split("/").filter(function(t){return 0<t.length}))},Pr);function Pr(){return null!==Tr&&Tr.apply(this,arguments)||this}function Lr(t,e,n){void 0===e?e=0:e>t.length&&zs(),void 0===n?n=t.length-e:n>t.length-e&&zs(),this.segments=t,this.offset=e,this.F=n}function Cr(t){this.timestamp=t}function Mr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function jr(t,e){this.P=t,this.V=e}function Ur(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=wr.h}function qr(t){var e=this;this.I=null,this.currentUser=wr.UNAUTHENTICATED,this.R=!1,this.m=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.m++,e.currentUser=e.A(),e.R=!0,e.u&&e.u(e.currentUser)},this.m=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function Fr(){this.u=null}function Br(t,e){var n=this;return(n=Ir.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Vr.G=new Vr([]);var Gr,zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Wr=(n(Qr,Gr=Rr),Qr.prototype.$=function(t,e,n){return new Qr(t,e,n)},Qr.H=function(t){return zr.test(t)},Qr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Qr.H(t)||(t="`"+t+"`"),t}).join(".")},Qr.prototype.toString=function(){return this.j()},Qr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Qr.J=function(){return new Qr(["__name__"])},Qr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new _r(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _r(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new _r(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Qr(e)},Qr);function Qr(){return null!==Gr&&Gr.apply(this,arguments)||this}Wr.G=new Wr([]);var Hr=(Kr.Z=function(t){return new Kr(Vr.K(t).k(5))},Kr.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Kr.prototype.isEqual=function(t){return null!==t&&0===Vr.N(this.path,t.path)},Kr.prototype.toString=function(){return this.path.toString()},Kr.N=function(t,e){return Vr.N(t.path,e.path)},Kr.et=function(t){return t.length%2==0},Kr.st=function(t){return new Kr(new Vr(t.slice()))},Kr);function Kr(t){this.path=t}function Yr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function $r(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Hr.EMPTY=new Hr(new Vr([]));var Jr=(Zr.fromBase64String=function(t){return new Zr(Cs.nt().atob(t))},Zr.fromUint8Array=function(t){return new Zr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Zr.prototype.toBase64=function(){return Cs.nt().btoa(this.it)},Zr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},Zr.prototype.rt=function(){return 2*this.it.length},Zr.prototype.S=function(t){return Ks(this.it,t.it)},Zr.prototype.isEqual=function(t){return this.it===t.it},Zr);function Zr(t){this.it=t}function ti(t){return null==t}function ei(t){return-0===t&&1/t==-1/0}function ni(t){return"number"==typeof t&&Number.isInteger(t)&&!ei(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function ri(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ii(t){var e=li(t.mapValue.fields.__local_write_time__.timestampValue);return new xr(e.seconds,e.nanos)}Jr.ht=new Jr("");var oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ri(t)?4:10:zs()}function ui(r,i){var t,e,n,o=si(r);if(o!==si(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ii(r).isEqual(ii(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=li(r.timestampValue),n=li(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,di(r.bytesValue).isEqual(di(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,pi((t=r).geoPointValue.latitude)===pi(e.geoPointValue.latitude)&&pi(t.geoPointValue.longitude)===pi(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return pi(t.integerValue)===pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=pi(t.doubleValue),r=pi(e.doubleValue);return n===r?ei(n)===ei(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Ys(r.arrayValue.values||[],i.arrayValue.values||[],ui);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Yr(t)!==Yr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!ui(t[n],e[n])))return!1;return!0}();default:return zs()}}function ai(t,e){return void 0!==(t.values||[]).find(function(t){return ui(t,e)})}function hi(t,e){var n,r,i,o,s,u,a,h,c,f,l=si(t),p=si(e);if(l!==p)return Ks(l,p);switch(l){case 0:return 0;case 1:return Ks(t.booleanValue,e.booleanValue);case 2:return h=e,(c=pi(t.integerValue||t.doubleValue))<(f=pi(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return ci(t.timestampValue,e.timestampValue);case 4:return ci(ii(t),ii(e));case 5:return Ks(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=di(o),a=di(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ks(n[i],r[i]);if(0!==o)return o}return Ks(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Ks(pi(n.latitude),pi(r.latitude)))?i:Ks(pi(n.longitude),pi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=hi(n[i],r[i]);if(o)return o}return Ks(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Ks(r[s],o[s]);if(0!==u)return u;var a=hi(n[r[s]],i[o[s]]);if(0!==a)return a}return Ks(r.length,o.length)}(t.mapValue,e.mapValue);default:throw zs()}}function ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ks(t,e);var n=li(t),r=li(e),i=Ks(n.seconds,r.seconds);return 0!==i?i:Ks(n.nanos,r.nanos)}function fi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=li(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?di(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Hr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):zs();var t,e,n}(t)}function li(t){if(Ws(!!t),"string"!=typeof t)return{seconds:pi(t.seconds),nanos:pi(t.nanos)};var e,n=0,r=oi.exec(t);Ws(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function di(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}function yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function vi(t){return t&&"integerValue"in t}function mi(t){return!!t&&"arrayValue"in t}function gi(t){return t&&"nullValue"in t}function wi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bi(t){return t&&"mapValue"in t}var Ei=(Ti.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},Ti.prototype.at=function(t,e){return e},Ti.prototype.ut=function(t){return null},Ti.prototype.isEqual=function(t){return t instanceof Ti},Ti);function Ti(){}Ei.instance=new Ei;var Ii=(Di.prototype.ot=function(t,e){return this.apply(t)},Di.prototype.at=function(t,e){return this.apply(t)},Di.prototype.apply=function(t){for(var n=ki(t),e=function(e){n.some(function(t){return ui(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Di.prototype.ut=function(t){return null},Di.prototype.isEqual=function(t){return t instanceof Di&&Ys(this.elements,t.elements,ui)},Di),Ni=(Si.prototype.ot=function(t,e){return this.apply(t)},Si.prototype.at=function(t,e){return this.apply(t)},Si.prototype.apply=function(t){for(var n=ki(t),e=function(e){n=n.filter(function(t){return!ui(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Si.prototype.ut=function(t){return null},Si.prototype.isEqual=function(t){return t instanceof Si&&Ys(this.elements,t.elements,ui)},Si),_i=(Ai.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return vi(n)&&vi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},Ai.prototype.at=function(t,e){return e},Ai.prototype.ut=function(t){return vi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},Ai.prototype.isEqual=function(t){return t instanceof Ai&&ui(this.ct,t.ct)},Ai.prototype.asNumber=function(t){return pi(t.integerValue||t.doubleValue)},Ai);function Ai(t,e){this.serializer=t,this.ct=e}function Si(t){this.elements=t}function Di(t){this.elements=t}function ki(t){return mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function xi(t,e){this.version=t,this.transformResults=e}var Oi,Ri,Vi,Pi,Li,Ci=(ro.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},ro.prototype.isEqual=function(t){return Ys(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ro),Mi=(no.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},no),ji=(eo.ft=function(){return new eo},eo.exists=function(t){return new eo(void 0,t)},eo.updateTime=function(t){return new eo(t)},Object.defineProperty(eo.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),eo.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof wo&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof wo},eo.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},eo),Ui=(to.prototype.It=function(t){},to.wt=function(t){return t instanceof wo?t.version:Or.min()},to),qi=(n(Zi,Li=Ui),Zi.prototype.at=function(t,e){this.It(t);var n=e.version;return new wo(this.key,n,this.value,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Ui.wt(t);return new wo(this.key,r,this.value,{At:!0})},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},Zi),Fi=(n(Ji,Pi=Ui),Ji.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.gt(t);return new wo(this.key,e.version,n,{hasCommittedMutations:!0})},Ji.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Ui.wt(t),i=this.gt(t);return new wo(this.key,r,i,{At:!0})},Ji.prototype.Pt=function(t){return null},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},Ji.prototype.gt=function(t){var e=t instanceof wo?t.data():Wi.empty();return this.pt(e)},Ji.prototype.pt=function(t){var n=this,r=new Qi(t);return this.Vt.fields.forEach(function(t){var e;t.B()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.yt()},Ji),Bi=(n($i,Vi=Ui),$i.prototype.at=function(t,e){if(this.It(t),Ws(null!=e.transformResults),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new wo(this.key,i,o,{hasCommittedMutations:!0})},$i.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new wo(this.key,r.version,o,{At:!0})},$i.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof wo?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Qi).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},$i.prototype.isEqual=function(t){return t instanceof $i&&this.key.isEqual(t.key)&&Ys(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},$i.prototype.bt=function(t){return t},$i.prototype.vt=function(t,e){var n=[];Ws(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof wo&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},$i.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof wo&&(a=e.field(s.field)),null===a&&n instanceof wo&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},$i.prototype.St=function(t,e){for(var n=new Qi(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},$i),Gi=(n(Xi,Ri=Ui),Xi.prototype.at=function(t,e){return this.It(t),new bo(this.key,e.version,{hasCommittedMutations:!0})},Xi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new bo(this.key,Or.min()):t},Xi.prototype.Pt=function(t){return null},Xi.prototype.isEqual=function(t){return t instanceof Xi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Xi),zi=(n(Yi,Oi=Ui),Yi.prototype.at=function(t,e){zs()},Yi.prototype.ot=function(t,e,n){zs()},Yi.prototype.Pt=function(t){zs()},Yi.prototype.isEqual=function(t){return t instanceof Yi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Yi),Wi=(Ki.empty=function(){return new Ki({mapValue:{}})},Ki.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!bi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},Ki.prototype.isEqual=function(t){return ui(this.proto,t.proto)},Ki),Qi=(Hi.prototype.set=function(t,e){return this.Nt(t,e),this},Hi.prototype.delete=function(t){return this.Nt(t,null),this},Hi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===si(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Hi.prototype.yt=function(){var t=this.$t(Wr.G,this.Ft);return null!=t?new Wi(t):this.Ct},Hi.prototype.$t=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=bi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.$t(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Hi);function Hi(t){void 0===t&&(t=Wi.empty()),this.Ct=t,this.Ft=new Map}function Ki(t){this.proto=t}function Yi(t,e){var n=this;return(n=Oi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Xi(t,e){var n=this;return(n=Ri.call(this)||this).key=t,n.Rt=e,n.type=3,n}function $i(t,e){var n=this;return(n=Vi.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=ji.exists(!0),n}function Ji(t,e,n,r){var i=this;return(i=Pi.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function Zi(t,e,n){var r=this;return(r=Li.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function to(){}function eo(t,e){this.updateTime=t,this.exists=e}function no(t,e){this.field=t,this.transform=e}function ro(t){(this.fields=t).sort(Wr.N)}function io(t){var u=[];return Xr(t.fields||{},function(t,e){var n=new Wr([t]);if(bi(e)){var r=io(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ci(u)}function oo(t,e){this.key=t,this.version=e}function so(t){this.count=t}var uo,ao,ho,co,fo,lo,po,yo,vo,mo,go,wo=(n(Qo,go=oo),Qo.prototype.field=function(t){return this.kt.field(t)},Qo.prototype.data=function(){return this.kt},Qo.prototype.Mt=function(){return this.kt.proto},Qo.prototype.isEqual=function(t){return t instanceof Qo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.kt.isEqual(t.kt)},Qo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.kt.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Qo.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Qo),bo=(n(Wo,mo=oo),Wo.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Wo.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Wo.prototype.isEqual=function(t){return t instanceof Wo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Wo),Eo=(n(zo,vo=oo),zo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),zo.prototype.isEqual=function(t){return t instanceof zo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zo),To=(Go.prototype.canonicalId=function(){var t;return null===this.Lt&&(t=this.path.j(),null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ti(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Lt=t),this.Lt},Go.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ti(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Go.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Go.prototype.Ot=function(){return Hr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Go),Io=(Bo.Wt=function(t){return new Bo(t)},Object.defineProperty(Bo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Oo(t)),this.qt.push(new Oo(Wr.J(),"asc"));else{for(var n,r=!1,i=0,o=this.xt;i<o.length;i++){var s=o[i];this.qt.push(s),s.field.Y()&&(r=!0)}r||(n=0<this.xt.length?this.xt[this.xt.length-1].dir:"asc",this.qt.push(new Oo(Wr.J(),n)))}}return this.qt},enumerable:!0,configurable:!0}),Bo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Bo(this.path,this.collectionGroup,this.xt.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.zt=function(t){var e=this.xt.concat([t]);return new Bo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.Ht=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Bo.prototype.Yt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Bo.prototype.Jt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Bo.prototype.Xt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Bo.prototype.Zt=function(t){return new Bo(t,null,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.xt.length||1===this.xt.length&&this.xt[0].field.Y())},Bo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Bo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Bo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Bo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Bo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Bo.prototype.oe=function(){return!ti(this.limit)&&"F"===this.Bt},Bo.prototype.ae=function(){return!ti(this.limit)&&"L"===this.Bt},Bo.prototype.Kt=function(){return 0<this.xt.length?this.xt[0].field:null},Bo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof No&&n.ue())return n.field}return null},Bo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof No&&0<=t.indexOf(r.op))return r.op}return null},Bo.prototype.Ot=function(){return this.ee().Ot()},Bo.prototype._e=function(){return null!==this.collectionGroup},Bo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new To(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Oo(r.field,i))}var o=this.endAt?new xo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new xo(this.startAt.position,!this.startAt.before):null;this.Ut=new To(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Bo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Hr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Bo.prototype.ne=function(t){for(var e=0,n=this.xt;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Bo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Bo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Bo.prototype.Qt=function(t){},Bo),No=(n(Fo,yo=function(){}),Fo.create=function(t,e,n){if(t.Y())return"in"===e?new Ao(t,n):new _o(t,e,n);if(gi(n)){if("=="!==e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fo(t,e,n)}if(wi(n)){if("=="!==e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fo(t,e,n)}return"array-contains"===e?new So(t,n):"in"===e?new Do(t,n):"array-contains-any"===e?new ko(t,n):new Fo(t,e,n)},Fo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&si(this.value)===si(e)&&this.de(hi(e,this.value))},Fo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return zs()}},Fo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Fo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+fi(this.value)},Fo.prototype.isEqual=function(t){return t instanceof Fo&&this.op===t.op&&this.field.isEqual(t.field)&&ui(this.value,t.value)},Fo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+fi(this.value)},Fo),_o=(n(qo,po=No),qo.prototype.matches=function(t){var e=Hr.N(t.key,this.key);return this.de(e)},qo),Ao=(n(Uo,lo=No),Uo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Uo),So=(n(jo,fo=No),jo.prototype.matches=function(t){var e=t.field(this.field);return mi(e)&&ai(e.arrayValue,this.value)},jo),Do=(n(Mo,co=No),Mo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ai(this.value.arrayValue,e)},Mo),ko=(n(Co,ho=No),Co.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!mi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ai(e.value.arrayValue,t)})},Co),xo=(Lo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(fi).join(",")},Lo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r],n=i.field.Y()?Hr.N(Hr.Z(o.referenceValue),e.key):hi(o,e.field(i.field));if("desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Lo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ui(this.position[e],t.position[e]))return!1;return!0},Lo),Oo=(Po.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Hr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?hi(i,o):zs());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return zs()}},Po.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Po.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Po.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Po),Ro=(Vo.prototype.Ie=function(t){return new Vo(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Vo.prototype.we=function(t,e){return new Vo(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Vo.prototype.Re=function(t){return new Vo(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Vo);function Vo(t,e,n,r,i,o,s){void 0===i&&(i=Or.min()),void 0===o&&(o=Or.min()),void 0===s&&(s=Jr.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Po(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function Lo(t,e){this.position=t,this.before=e}function Co(t,e){return ho.call(this,t,"array-contains-any",e)||this}function Mo(t,e){return co.call(this,t,"in",e)||this}function jo(t,e){return fo.call(this,t,"array-contains",e)||this}function Uo(t,e){var n=this;return(n=lo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Hr.Z(t.referenceValue)}),n}function qo(t,e,n){var r=this;return(r=po.call(this,t,e,n)||this).key=Hr.Z(n.referenceValue),r}function Fo(t,e,n){var r=this;return(r=yo.call(this)||this).field=t,r.op=e,r.value=n,r}function Bo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Go(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Lt=null}function zo(){return null!==vo&&vo.apply(this,arguments)||this}function Wo(t,e,n){var r=this;return(r=mo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Qo(t,e,n,r){var i=this;return(i=go.call(this,t,e)||this).kt=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Ho(t){switch(t){case Nr.OK:return zs();case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return 1;default:return zs()}}function Ko(t){if(void 0===t)return Bs("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case uo.OK:return Nr.OK;case uo.CANCELLED:return Nr.CANCELLED;case uo.UNKNOWN:return Nr.UNKNOWN;case uo.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case uo.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case uo.INTERNAL:return Nr.INTERNAL;case uo.UNAVAILABLE:return Nr.UNAVAILABLE;case uo.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case uo.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case uo.NOT_FOUND:return Nr.NOT_FOUND;case uo.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case uo.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case uo.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case uo.ABORTED:return Nr.ABORTED;case uo.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case uo.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case uo.DATA_LOSS:return Nr.DATA_LOSS;default:return zs()}}(ao=uo=uo||{})[ao.OK=0]="OK",ao[ao.CANCELLED=1]="CANCELLED",ao[ao.UNKNOWN=2]="UNKNOWN",ao[ao.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ao[ao.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ao[ao.NOT_FOUND=5]="NOT_FOUND",ao[ao.ALREADY_EXISTS=6]="ALREADY_EXISTS",ao[ao.PERMISSION_DENIED=7]="PERMISSION_DENIED",ao[ao.UNAUTHENTICATED=16]="UNAUTHENTICATED",ao[ao.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ao[ao.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ao[ao.ABORTED=10]="ABORTED",ao[ao.OUT_OF_RANGE=11]="OUT_OF_RANGE",ao[ao.UNIMPLEMENTED=12]="UNIMPLEMENTED",ao[ao.INTERNAL=13]="INTERNAL",ao[ao.UNAVAILABLE=14]="UNAVAILABLE",ao[ao.DATA_LOSS=15]="DATA_LOSS";var Yo=(ts.prototype.me=function(t,e){return new ts(this.N,this.root.me(t,e,this.N).Ae(null,null,$o.Pe,null,null))},ts.prototype.remove=function(t){return new ts(this.N,this.root.remove(t,this.N).Ae(null,null,$o.Pe,null,null))},ts.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ts.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ts.prototype.B=function(){return this.root.B()},Object.defineProperty(ts.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),ts.prototype.Ve=function(){return this.root.Ve()},ts.prototype.ge=function(){return this.root.ge()},ts.prototype.pe=function(t){return this.root.pe(t)},ts.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},ts.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ts.prototype.ye=function(t){return this.root.ye(t)},ts.prototype.be=function(){return new Xo(this.root,null,this.N,!1)},ts.prototype.ve=function(t){return new Xo(this.root,t,this.N,!1)},ts.prototype.Se=function(){return new Xo(this.root,null,this.N,!0)},ts.prototype.De=function(t){return new Xo(this.root,t,this.N,!0)},ts),Xo=(Zo.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},Zo.prototype.$e=function(){return 0<this.Fe.length},Zo.prototype.ke=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},Zo),$o=(Jo.prototype.Ae=function(t,e,n,r,i){return new Jo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Jo.prototype.B=function(){return!1},Jo.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},Jo.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},Jo.prototype.min=function(){return this.left.B()?this:this.left.min()},Jo.prototype.Ve=function(){return this.min().key},Jo.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},Jo.prototype.me=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.Ae(null,null,null,r.left.me(t,e,n),null):0===i?r.Ae(null,e,null,null,null):r.Ae(null,null,null,null,r.right.me(t,e,n))).Me()},Jo.prototype.Le=function(){if(this.left.B())return Jo.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.xe()),(t=t.Ae(null,null,null,t.left.Le(),null)).Me()},Jo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.Oe()||r.left.left.Oe()||(r=r.xe()),r=r.Ae(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Be()),r.right.B()||r.right.Oe()||r.right.left.Oe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return Jo.EMPTY;n=r.right.min(),r=r.Ae(n.key,n.value,null,null,r.right.Le())}r=r.Ae(null,null,null,null,r.right.remove(t,e))}return r.Me()},Jo.prototype.Oe=function(){return this.color},Jo.prototype.Me=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Ue()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Be()),t.left.Oe()&&t.right.Oe()&&(t=t.Qe()),t},Jo.prototype.xe=function(){var t=this.Qe();return t.right.left.Oe()&&(t=(t=(t=t.Ae(null,null,null,null,t.right.Be())).Ue()).Qe()),t},Jo.prototype.qe=function(){var t=this.Qe();return t.left.left.Oe()&&(t=(t=t.Be()).Qe()),t},Jo.prototype.Ue=function(){var t=this.Ae(null,null,Jo.RED,null,this.right.left);return this.right.Ae(null,null,this.color,t,null)},Jo.prototype.Be=function(){var t=this.Ae(null,null,Jo.RED,this.left.right,null);return this.left.Ae(null,null,this.color,null,t)},Jo.prototype.Qe=function(){var t=this.left.Ae(null,null,!this.left.color,null,null),e=this.right.Ae(null,null,!this.right.color,null,null);return this.Ae(null,null,!this.color,t,e)},Jo.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},Jo.prototype.je=function(){if(this.Oe()&&this.left.Oe())throw zs();if(this.right.Oe())throw zs();var t=this.left.je();if(t!==this.right.je())throw zs();return t+(this.Oe()?0:1)},Jo);function Jo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Jo.RED,this.left=null!=r?r:Jo.EMPTY,this.right=null!=i?i:Jo.EMPTY,this.size=this.left.size+1+this.right.size}function Zo(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function ts(t,e){this.N=t,this.root=e||$o.EMPTY}function es(){this.size=0}$o.EMPTY=null,$o.RED=!0,$o.Pe=!1,$o.EMPTY=(Object.defineProperty(es.prototype,"key",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"value",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"color",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"left",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"right",{get:function(){throw zs()},enumerable:!0,configurable:!0}),es.prototype.Ae=function(t,e,n,r,i){return this},es.prototype.me=function(t,e,n){return new $o(t,e)},es.prototype.remove=function(t,e){return this},es.prototype.B=function(){return!0},es.prototype.pe=function(t){return!1},es.prototype.ye=function(t){return!1},es.prototype.Ve=function(){return null},es.prototype.ge=function(){return null},es.prototype.Oe=function(){return!1},es.prototype.We=function(){return!0},es.prototype.je=function(){return 0},new es);var ns=(ss.prototype.has=function(t){return null!==this.data.get(t)},ss.prototype.first=function(){return this.data.Ve()},ss.prototype.last=function(){return this.data.ge()},Object.defineProperty(ss.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),ss.prototype.indexOf=function(t){return this.data.indexOf(t)},ss.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},ss.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.$e();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},ss.prototype.Ge=function(t,e){for(var n=void 0!==e?this.data.ve(e):this.data.be();n.$e();)if(!t(n.Ne().key))return},ss.prototype.ze=function(t){var e=this.data.ve(t);return e.$e()?e.Ne().key:null},ss.prototype.be=function(){return new rs(this.data.be())},ss.prototype.ve=function(t){return new rs(this.data.ve(t))},ss.prototype.add=function(t){return this.Ae(this.data.remove(t).me(t,!0))},ss.prototype.delete=function(t){return this.has(t)?this.Ae(this.data.remove(t)):this},ss.prototype.B=function(){return this.data.B()},ss.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},ss.prototype.isEqual=function(t){if(!(t instanceof ss))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},ss.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ss.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ss.prototype.Ae=function(t){var e=new ss(this.N);return e.data=t,e},ss),rs=(os.prototype.Ne=function(){return this.Ye.Ne().key},os.prototype.$e=function(){return this.Ye.$e()},os),is=new Yo(Hr.N);function os(t){this.Ye=t}function ss(t){this.N=t,this.data=new Yo(this.N)}var us=new Yo(Hr.N);var as=new Yo(Hr.N);var hs=new ns(Hr.N);function cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var fs=new ns(Ks);function ls(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function ps(t,e){this.targetId=t,this.ms=e}function ds(t,e,n,r){void 0===n&&(n=Jr.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ys=(Ds.Ze=function(t){return new Ds(t.N)},Ds.prototype.has=function(t){return null!=this.Je.get(t)},Ds.prototype.get=function(t){return this.Je.get(t)},Ds.prototype.first=function(){return this.Xe.Ve()},Ds.prototype.last=function(){return this.Xe.ge()},Ds.prototype.B=function(){return this.Xe.B()},Ds.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(Ds.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),Ds.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},Ds.prototype.add=function(t){var e=this.delete(t.key);return e.Ae(e.Je.me(t.key,t),e.Xe.me(t,null))},Ds.prototype.delete=function(t){var e=this.get(t);return e?this.Ae(this.Je.remove(t),this.Xe.remove(e)):this},Ds.prototype.isEqual=function(t){if(!(t instanceof Ds))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},Ds.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Ds.prototype.Ae=function(t,e){var n=new Ds;return n.N=this.N,n.Je=t,n.Xe=e,n},Ds),vs=(Ss.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.me(e,t):3===t.type&&1!==n.type?this.ts=this.ts.me(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.me(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.me(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):zs()},Ss.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},Ss),ms=(As.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new As(t,e,ys.Ze(e),i,n,r,!0,!1)},Object.defineProperty(As.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),As.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},As),gs=(_s.ls=function(t,e){var n=new Map;return n.set(t,ws.ds(t,e)),new _s(Or.min(),n,fs,is,cs())},_s),ws=(Ns.ds=function(t,e){return new Ns(Jr.ht,e,cs(),cs(),cs())},Ns),bs=(Object.defineProperty(Is.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"ys",{get:function(){return 0!==this.As},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Is.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Is.prototype.Ss=function(){var n=cs(),r=cs(),i=cs();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:zs()}}),new ws(this.Vs,this.gs,n,r,i)},Is.prototype.Ds=function(){this.ps=!1,this.Ps=xs()},Is.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.me(t,e)},Is.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Is.prototype.Ns=function(){this.As+=1},Is.prototype.$s=function(){--this.As},Is.prototype.ks=function(){this.ps=!0,this.gs=!0},Is),Es=(Ts.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof wo?this.Us(r,t.Rs):t.Rs instanceof bo&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},Ts.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.$s(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.$s(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.ks(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:zs()}})},Ts.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ls.forEach(function(t,e){r.Gs(e)&&n(e)})},Ts.prototype.Hs=function(t){var e,n,r=t.targetId,i=t.ms.count,o=this.Ys(r);o&&((e=o.target).Ot()?0===i?(n=new Hr(e.path),this.Qs(r,n,new bo(n,Or.min()))):Ws(1===i):this.Js(r)!==i&&(this.zs(r),this.Bs=this.Bs.add(r)))},Ts.prototype.Xs=function(i){var o=this,s=new Map;this.Ls.forEach(function(t,e){var n,r=o.Ys(e);r&&(t.fs&&r.target.Ot()&&(n=new Hr(r.target.path),null!==o.Os.get(n)||o.Zs(e,n)||o.Qs(e,n,new bo(n,i))),t.bs&&(s.set(e,t.Ss()),t.Ds()))});var r=cs();this.xs.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new gs(i,s,this.Bs,this.Os,r);return this.Os=is,this.xs=ks(),this.Bs=new ns(Ks),t},Ts.prototype.Us=function(t,e){var n;this.Gs(t)&&(n=this.Zs(t,e.key)?2:0,this.Ks(t).Cs(e.key,n),this.Os=this.Os.me(e.key,e),this.xs=this.xs.me(e.key,this.ti(e.key).add(t)))},Ts.prototype.Qs=function(t,e,n){var r;this.Gs(t)&&(r=this.Ks(t),this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.xs=this.xs.me(e,this.ti(e).delete(t)),n&&(this.Os=this.Os.me(e,n)))},Ts.prototype.removeTarget=function(t){this.Ls.delete(t)},Ts.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ms.ei(t).size+e.Ts.size-e.Is.size},Ts.prototype.Ns=function(t){this.Ks(t).Ns()},Ts.prototype.Ks=function(t){var e=this.Ls.get(t);return e||(e=new bs,this.Ls.set(t,e)),e},Ts.prototype.ti=function(t){var e=this.xs.get(t);return e||(e=new ns(Ks),this.xs=this.xs.me(t,e)),e},Ts.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Fs("WatchChangeAggregator","Detected inactive target",t),e},Ts.prototype.Ys=function(t){var e=this.Ls.get(t);return e&&e.ys?null:this.Ms.si(t)},Ts.prototype.zs=function(e){var n=this;this.Ls.set(e,new bs),this.Ms.ei(e).forEach(function(t){n.Qs(e,t,null)})},Ts.prototype.Zs=function(t,e){return this.Ms.ei(t).has(e)},Ts);function Ts(t){this.Ms=t,this.Ls=new Map,this.Os=is,this.xs=ks(),this.Bs=new ns(Ks)}function Is(){this.As=0,this.Ps=xs(),this.Vs=Jr.ht,this.gs=!1,this.ps=!0}function Ns(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function _s(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function As(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Ss(){this.ts=new Yo(Hr.N)}function Ds(n){this.N=n?function(t,e){return n(t,e)||Hr.N(t.key,e.key)}:function(t,e){return Hr.N(t.key,e.key)},this.Je=us,this.Xe=new Yo(this.N)}function ks(){return new Yo(Hr.N)}function xs(){return new Yo(Hr.N)}var Os={asc:"ASCENDING",desc:"DESCENDING"},Rs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vs=(Ps.prototype.ni=function(t){var e=void 0===t.code?Nr.UNKNOWN:Ko(t.code);return new _r(e,t.message||"")},Ps.prototype.ri=function(t){return this.options.hi||ti(t)?t:{value:t}},Ps.prototype.oi=function(t){var e;return ti(e="object"==typeof t?t.value:t)?null:e},Ps.prototype._t=function(t){return{integerValue:""+t}},Ps.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(t)?"-0":t}},Ps.prototype.ai=function(t){return ni(t)?this._t(t):this.lt(t)},Ps.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Ps.prototype.v=function(t){var e=li(t);return new xr(e.seconds,e.nanos)},Ps.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Ps.prototype.ci=function(t){return this.options.hi?(Ws(void 0===t||"string"==typeof t),Jr.fromBase64String(t||"")):(Ws(void 0===t||t instanceof Uint8Array),Jr.fromUint8Array(t||new Uint8Array))},Ps.prototype.toVersion=function(t){return this.C(t.C())},Ps.prototype.fromVersion=function(t){return Ws(!!t),Or.v(this.v(t))},Ps.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Ps.prototype.di=function(t){var e=Vr.K(t);return Ws(Ls(e)),e},Ps.prototype.fi=function(t){return this._i(t.path)},Ps.prototype.Z=function(t){var e=this.di(t);return Ws(e.get(1)===this.ii.projectId),Ws(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Hr(this.Ti(e))},Ps.prototype.Ei=function(t){return this._i(t)},Ps.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Vr.G:this.Ti(e)},Object.defineProperty(Ps.prototype,"wi",{get:function(){return new Vr(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Ps.prototype.li=function(t){return new Vr(["projects",t.projectId,"databases",t.database])},Ps.prototype.Ti=function(t){return Ws(4<t.length&&"documents"===t.get(4)),t.k(5)},Ps.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Ps.prototype.mi=function(t){return{name:this.fi(t.key),fields:t.Mt().mapValue.fields,updateTime:this.C(t.version.C())}},Ps.prototype.Ai=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Wi({mapValue:{fields:t.fields}});return new wo(n,r,i,{hasCommittedMutations:!!e})},Ps.prototype.Pi=function(t){Ws(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Wi({mapValue:{fields:t.found.fields}});return new wo(e,n,r,{})},Ps.prototype.Vi=function(t){Ws(!!t.missing),Ws(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new bo(e,n)},Ps.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):zs()},Ps.prototype.pi=function(t){if("targetChange"in t){t.targetChange;var e=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],r=this.ci(t.targetChange.resumeToken),i=t.targetChange.cause,o=new ds(e,n,r,i&&this.ni(i)||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var u=this.Z(s.document.name),a=this.fromVersion(s.document.updateTime),h=new Wi({mapValue:{fields:s.document.fields}}),c=new wo(u,a,h,{});o=new ls(s.targetIds||[],s.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){t.documentDelete;var f=t.documentDelete;f.document;var l=this.Z(f.document),p=f.readTime?this.fromVersion(f.readTime):Or.min(),d=new bo(l,p);o=new ls([],f.removedTargetIds||[],d.key,d)}else if("documentRemove"in t){t.documentRemove;var y=t.documentRemove;y.document;var v=this.Z(y.document);o=new ls([],y.removedTargetIds||[],v,null)}else{if(!("filter"in t))return zs();t.filter;var m=t.filter;m.targetId;var g=new so(m.count||0);o=new ps(m.targetId,g)}return o},Ps.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:zs()},Ps.prototype.bi=function(t){if(!("targetChange"in t))return Or.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Or.min():this.fromVersion(e.readTime)},Ps.prototype.vi=function(t){var e,n=this;if(t instanceof qi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Gi)e={delete:this.fi(t.key)};else if(t instanceof Fi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Bi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof zi))return zs();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Ps.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):ji.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Wi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.$i(t.updateMask);return new Fi(r,i,o,n)}return new qi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Gi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.ki(t)});return Ws(!0===n.exists),new Bi(u,a)}if(t.verify){var h=this.Z(t.verify);return new zi(h,n)}return zs()},Ps.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zs()},Ps.prototype.Ni=function(t){return void 0!==t.updateTime?ji.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ji.exists(t.exists):ji.ft()},Ps.prototype.Mi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Or.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new xi(n,r)},Ps.prototype.Li=function(t,e){var n=this;return t&&0<t.length?(Ws(void 0!==e),t.map(function(t){return n.Mi(t,e)})):[]},Ps.prototype.Di=function(t){var e=t.transform;if(e instanceof Ei)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ii)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Ni)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof _i)return{fieldPath:t.field.j(),increment:e.ct};throw zs()},Ps.prototype.ki=function(t){var e,n,r=null;"setToServerValue"in t?(Ws("REQUEST_TIME"===t.setToServerValue),r=Ei.instance):"appendMissingElements"in t?(e=t.appendMissingElements.values||[],r=new Ii(e)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Ni(n)):"increment"in t?r=new _i(this,t.increment):zs();var i=Wr.X(t.fieldPath);return new Mi(i,r)},Ps.prototype.Oi=function(t){return{documents:[this.Ei(t.path)]}},Ps.prototype.xi=function(t){Ws(1===t.documents.length);var e=t.documents[0];return Io.Wt(this.Ii(e)).ee()},Ps.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.M()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Ps.prototype.Wi=function(t){var e,n=this.Ii(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Ws(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=this.ji(r.where));var u=[];r.orderBy&&(u=this.Ki(r.orderBy));var a=null;r.limit&&(a=this.oi(r.limit));var h=null;r.startAt&&(h=this.Gi(r.startAt));var c=null;return r.endAt&&(c=this.Gi(r.endAt)),new Io(n,o,u,s,a,"F",h,c).ee()},Ps.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Ps.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zs()}},Ps.prototype.ee=function(t){var e,n=t.target;return(e=n.Ot()?{documents:this.Oi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Ps.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof No?e.Yi(t):zs()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Ps.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):zs():[]},Ps.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Ps.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Ps.prototype.Qi=function(t){return{before:t.before,values:t.position}},Ps.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new xo(n,e)},Ps.prototype.en=function(t){return Os[t]},Ps.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Ps.prototype.nn=function(t){return Rs[t]},Ps.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return zs()}},Ps.prototype.hn=function(t){return{fieldPath:t.j()}},Ps.prototype.on=function(t){return Wr.X(t.fieldPath)},Ps.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Ps.prototype.tn=function(t){return new Oo(this.on(t.field),this.sn(t.direction))},Ps.prototype.Xi=function(t){return No.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Ps.prototype.Yi=function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(gi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Ps.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return No.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return No.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return zs()}},Ps.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Ps.prototype.$i=function(t){var e=t.fieldPaths||[];return new Ci(e.map(function(t){return Wr.X(t)}))},Ps);function Ps(t,e){this.ii=t,this.options=e}function Ls(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Cs=(js.an=function(t){js.platform&&zs(),js.platform=t},js.nt=function(){return js.platform||zs(),js.platform},js),Ms=new h("@firebase/firestore");function js(){}function Us(){return Ms.logLevel}function qs(t){Ms.logLevel=t}function Fs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ms.logLevel<=l.DEBUG&&(e=n.map(Gs),Ms.debug.apply(Ms,i(["Firestore ("+gr+"): "+t],e)))}function Bs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ms.logLevel<=l.ERROR&&(e=n.map(Gs),Ms.error.apply(Ms,i(["Firestore ("+gr+"): "+t],e)))}function Gs(t){if("string"==typeof t)return t;var e=Cs.nt();try{return e.un(t)}catch(e){return t}}function zs(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+gr+") INTERNAL ASSERTION FAILED: "+t;throw Bs(e),new Error(e)}function Ws(t){t||zs()}var Qs=(Hs.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Cs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Hs);function Hs(){}function Ks(t,e){return t<e?-1:e<t?1:0}function Ys(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Xs(t){return t+"\0"}function $s(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Js=(Object.defineProperty(gu.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),gu.prototype.isEqual=function(t){return t instanceof gu&&t.projectId===this.projectId&&t.database===this.database},gu.prototype.S=function(t){return Ks(this.projectId,t.projectId)||Ks(this.database,t.database)},gu),Zs=(mu.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},mu.prototype.has=function(t){return void 0!==this.get(t)},mu.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},mu.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},mu.prototype.forEach=function(u){Xr(this.fn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},mu.prototype.B=function(){return $r(this.fn)},mu),tu=(vu.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o,s=this.mutations[i];s.key.isEqual(t)&&(o=r[i],e=s.at(e,o))}return e},vu.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},vu.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.me(t.key,e))}),i},vu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cs())},vu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ys(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Ys(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},vu),eu=(yu.from=function(t,e,n,r){Ws(t.mutations.length===n.length);for(var i=as,o=t.mutations,s=0;s<o.length;s++)i=i.me(o[s].key,n[s].version);return new yu(t,e,n,r,i)},yu),nu=(du.prototype.catch=function(t){return this.next(void 0,t)},du.prototype.next=function(r,i){var o=this;return this.Vn&&zs(),this.Vn=!0,this.Pn?this.error?this.gn(i,this.error):this.pn(r,this.result):new du(function(e,n){o.mn=function(t){o.pn(r,t).next(e,n)},o.An=function(t){o.gn(i,t).next(e,n)}})},du.prototype.yn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},du.prototype.bn=function(t){try{var e=t();return e instanceof du?e:du.resolve(e)}catch(t){return du.reject(t)}},du.prototype.pn=function(t,e){return t?this.bn(function(){return t(e)}):du.resolve(e)},du.prototype.gn=function(t,e){return t?this.bn(function(){return t(e)}):du.reject(e)},du.resolve=function(n){return new du(function(t,e){t(n)})},du.reject=function(n){return new du(function(t,e){e(n)})},du.vn=function(t){return new du(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},du.Sn=function(t){for(var n=du.resolve(!1),e=function(e){n=n.next(function(t){return t?du.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},du.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.vn(i)},du),ru=(Object.defineProperty(pu.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!0,configurable:!0}),pu.prototype.Nn=function(t,e){this.$n(),this.readTime=e,this.Dn.set(t.key,t)},pu.prototype.kn=function(t,e){this.$n(),e&&(this.readTime=e),this.Dn.set(t,null)},pu.prototype.Mn=function(t,e){this.$n();var n=this.Dn.get(e);return void 0!==n?nu.resolve(n):this.Ln(t,e)},pu.prototype.getEntries=function(t,e){return this.On(t,e)},pu.prototype.apply=function(t){return this.$n(),this.Cn=!0,this.xn(t)},pu.prototype.$n=function(){},pu),iu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ou=(lu.prototype.qn=function(t){this.Bn.push(t)},lu.prototype.Un=function(){this.Bn.forEach(function(t){return t()})},lu),su=(fu.prototype.Kn=function(e,n){var r=this;return this.Wn.Gn(e,n).next(function(t){return r.zn(e,n,t)})},fu.prototype.zn=function(t,r,i){return this.Qn.Mn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},fu.prototype.Hn=function(t,e,i){var o=is;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.me(t,e)}),o},fu.prototype.Yn=function(e,t){var n=this;return this.Qn.getEntries(e,t).next(function(t){return n.Jn(e,t)})},fu.prototype.Jn=function(r,i){var o=this;return this.Wn.Xn(r,i).next(function(t){var e=o.Hn(r,i,t),n=is;return e.forEach(function(t,e){e=e||new bo(t,Or.min()),n=n.me(t,e)}),n})},fu.prototype.Zn=function(t,e,n){return e.Ot()?this.tr(t,e.path):e._e()?this.er(t,e,n):this.sr(t,e,n)},fu.prototype.tr=function(t,e){return this.Kn(t,new Hr(e)).next(function(t){var e=us;return t instanceof wo&&(e=e.me(t.key,t)),e})},fu.prototype.er=function(n,r,i){var o=this,s=r.collectionGroup,u=us;return this.jn.ir(n,s).next(function(t){return nu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.sr(n,e,i).next(function(t){t.forEach(function(t,e){u=u.me(t,e)})})}).next(function(){return u})})},fu.prototype.sr=function(e,n,t){var c,f,r=this;return this.Qn.Zn(e,n,t).next(function(t){return c=t,r.Wn.nr(e,n)}).next(function(t){return f=t,r.rr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.Tn);c=h instanceof wo?c.me(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},fu.prototype.rr=function(t,e,n){for(var r=cs(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Fi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Qn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof wo&&(h=h.me(t,e))}),h})},fu),uu=(cu.ar=function(t,e){for(var n=cs(),r=cs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new cu(t,e.fromCache,n,r)},cu),au=(hu.prototype.cr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},hu.prototype.next=function(){var t=++this.previousValue;return this._r&&this._r(t),t},hu);function hu(t,e){var n=this;this.previousValue=t,e&&(e.ur=function(t){return n.cr(t)},this._r=function(t){return e.lr(t)})}function cu(t,e,n,r){this.targetId=t,this.fromCache=e,this.hr=n,this.or=r}function fu(t,e,n){this.Qn=t,this.Wn=e,this.jn=n}function lu(){this.Bn=[]}function pu(){this.Dn=new Zs(function(t){return t.toString()}),this.Cn=!1}function du(t){var e=this;this.mn=null,this.An=null,this.result=void 0,this.error=void 0,this.Pn=!1,this.Vn=!1,t(function(t){e.Pn=!0,e.result=t,e.mn&&e.mn(t)},function(t){e.Pn=!0,e.error=t,e.An&&e.An(t)})}function yu(t,e,n,r,i){this.batch=t,this.wn=e,this.En=n,this.streamToken=r,this.Rn=i}function vu(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function mu(t){this.dn=t,this.fn={}}function gu(t,e){this.projectId=t,this.database=e||"(default)"}function wu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}au.dr=-1;var bu=(Eu.prototype.reset=function(){this.mr=0},Eu.prototype.Vr=function(){this.mr=this.Rr},Eu.prototype.gr=function(t){var e=this;this.cancel();var n=Math.floor(this.mr+this.pr()),r=Math.max(0,Date.now()-this.Pr),i=Math.max(0,n-r);0<i&&Fs("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.mr+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ar=this.Tr.yr(this.Er,i,function(){return e.Pr=Date.now(),t()}),this.mr*=this.wr,this.mr<this.Ir&&(this.mr=this.Ir),this.mr>this.Rr&&(this.mr=this.Rr)},Eu.prototype.cancel=function(){null!==this.Ar&&(this.Ar.cancel(),this.Ar=null)},Eu.prototype.pr=function(){return(Math.random()-.5)*this.mr},Eu);function Eu(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Tr=t,this.Er=e,this.Ir=n,this.wr=r,this.Rr=i,this.mr=0,this.Ar=null,this.Pr=Date.now(),this.reset()}function Tu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Nu(e)),e=Iu(t.get(n),e);return Nu(e)}function Iu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Nu(t){return t+""}function _u(t){var e=t.length;if(Ws(2<=e),2===e)return Ws(""===t.charAt(0)&&""===t.charAt(1)),Vr.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&zs(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:zs()}o=s+2}return new Vr(r)}var Au=(Ou.prototype.vr=function(t,e){return this.br.add(e),nu.resolve()},Ou.prototype.ir=function(t,e){return nu.resolve(this.br.getEntries(e))},Ou),Su=(xu.prototype.add=function(t){var e=t.O(),n=t.M(),r=this.index[e]||new ns(Vr.N),i=!r.has(n);return this.index[e]=r.add(n),i},xu.prototype.has=function(t){var e=t.O(),n=t.M(),r=this.index[e];return r&&r.has(n)},xu.prototype.getEntries=function(t){return(this.index[t]||new ns(Vr.N)).W()},xu),Du=(ku.prototype.vr=function(t,e){var n=this;if(this.Sr.has(e))return nu.resolve();var r=e.O(),i=e.M();t.qn(function(){n.Sr.add(e)});var o={collectionId:r,parent:Tu(i)};return Ru(t).put(o)},ku.prototype.ir=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Xs(i),""],!1,!0);return Ru(t).Dr(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(_u(r.parent))}return o})},ku);function ku(){this.Sr=new Su}function xu(){this.index={}}function Ou(){this.br=new Su}function Ru(t){return Zu.Cr(t,Oa.store)}var Vu,Pu=(Lu.prototype.Nn=function(t,e,n){return Mu(t).put(ju(e),n)},Lu.prototype.kn=function(t,e){var n=Mu(t),r=ju(e);return n.delete(r)},Lu.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Fr(e,t)})},Lu.prototype.Mn=function(t,e){var n=this;return Mu(t).get(ju(e)).next(function(t){return n.Nr(t)})},Lu.prototype.$r=function(t,e){var n=this;return Mu(t).get(ju(e)).next(function(t){var e=n.Nr(t);return e?{kr:e,size:Uu(t)}:null})},Lu.prototype.getEntries=function(t,e){var r=this,i=is;return this.Mr(t,e,function(t,e){var n=r.Nr(e);i=i.me(t,n)}).next(function(){return i})},Lu.prototype.Lr=function(t,e){var r=this,i=is,o=new Yo(Hr.N);return this.Mr(t,e,function(t,e){var n=r.Nr(e);o=n?(i=i.me(t,n),o.me(t,Uu(e))):(i=i.me(t,null),o.me(t,0))}).next(function(){return{Or:i,xr:o}})},Lu.prototype.Mr=function(t,e,i){if(e.B())return nu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return Mu(t).Br({range:n},function(t,e,n){for(var r=Hr.st(t);s&&Hr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.$e()?o.Ne():null),s?n.qr(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.$e()?o.Ne():null})},Lu.prototype.Zn=function(t,i,e){var n,r,o,s=this,u=us,a=i.path.length+1,h={};return e.isEqual(Or.min())?(n=i.path.W(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.W(),o=this.serializer.Ur(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Aa.collectionReadTimeIndex),Mu(t).Br(h,function(t,e,n){var r;t.length===a&&(r=s.serializer.Qr(e),i.path.q(r.key.path)?r instanceof wo&&i.matches(r)&&(u=u.me(r.key,r)):n.done())}).next(function(){return u})},Lu.prototype.Wr=function(t,e){var r=this,i=is,o=this.serializer.Ur(e),n=Mu(t),s=IDBKeyRange.lowerBound(o,!0);return n.Br({index:Aa.readTimeIndex,range:s},function(t,e){var n=r.serializer.Qr(e);i=i.me(n.key,n),o=e.readTime}).next(function(){return{jr:i,readTime:r.serializer.Kr(o)}})},Lu.prototype.Gr=function(t){var r=this,e=Mu(t),i=Or.min();return e.Br({index:Aa.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.Kr(e.readTime)),n.done()}).next(function(){return i})},Lu.prototype.zr=function(t){return new Lu.Hr(this,!!t&&t.Yr)},Lu.prototype.Jr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Lu.prototype.getMetadata=function(t){return Cu(t).get(Sa.key).next(function(t){return Ws(!!t),t})},Lu.prototype.Fr=function(t,e){return Cu(t).put(Sa.key,e)},Lu.prototype.Nr=function(t){if(t){var e=this.serializer.Qr(t);return e instanceof bo&&e.version.isEqual(Or.min())?null:e}return null},Lu);function Lu(t,e){this.serializer=t,this.jn=e}function Cu(t){return Zu.Cr(t,Sa.store)}function Mu(t){return Zu.Cr(t,Aa.store)}function ju(t){return t.path.W()}function Uu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw zs();e=t.noDocument}return JSON.stringify(e).length}function qu(t,e){var n=this;return(n=Vu.call(this)||this).Xr=t,n.Yr=e,n.Zr=new Zs(function(t){return t.toString()}),n}Pu.Hr=(n(qu,Vu=ru),qu.prototype.xn=function(s){var u=this,a=[],h=0,c=new ns(function(t,e){return Ks(t.j(),e.j())});return this.Dn.forEach(function(t,e){var n,r,i,o=u.Zr.get(t);e?(n=u.Xr.serializer.th(e,u.readTime),c=c.add(t.path.M()),r=Uu(n),h+=r-o,a.push(u.Xr.Nn(s,t,n))):(h-=o,u.Yr?(i=u.Xr.serializer.th(new bo(t,Or.min()),u.readTime),a.push(u.Xr.Nn(s,t,i))):a.push(u.Xr.kn(s,t)))}),c.forEach(function(t){a.push(u.Xr.jn.vr(s,t))}),a.push(this.Xr.updateMetadata(s,h)),nu.vn(a)},qu.prototype.Ln=function(t,e){var n=this;return this.Xr.$r(t,e).next(function(t){return null===t?(n.Zr.set(e,0),null):(n.Zr.set(e,t.size),t.kr)})},qu.prototype.On=function(t,e){var n=this;return this.Xr.Lr(t,e).next(function(t){var e=t.Or;return t.xr.forEach(function(t,e){n.Zr.set(t,e)}),e})},qu);var Fu=(zu.prototype.next=function(){return this.eh+=2,this.eh},zu.sh=function(){return new zu(0)},zu.ih=function(){return new zu(-1)},zu),Bu=(Gu.prototype.rh=function(n){var r=this;return this.hh(n).next(function(t){var e=new Fu(t.highestTargetId);return t.highestTargetId=e.next(),r.oh(n,t).next(function(){return t.highestTargetId})})},Gu.prototype.ah=function(t){return this.hh(t).next(function(t){return Or.v(new xr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Gu.prototype.uh=function(t){return Hu(t._h)},Gu.prototype.lh=function(e,n,r){var i=this;return this.hh(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.oh(e,t)})},Gu.prototype.dh=function(e,n){var r=this;return this.fh(e,n).next(function(){return r.hh(e).next(function(t){return t.targetCount+=1,r.Th(n,t),r.oh(e,t)})})},Gu.prototype.Eh=function(t,e){return this.fh(t,e)},Gu.prototype.Ih=function(e,t){var n=this;return this.wh(e,t.targetId).next(function(){return Wu(e).delete(t.targetId)}).next(function(){return n.hh(e)}).next(function(t){return Ws(0<t.targetCount),--t.targetCount,n.oh(e,t)})},Gu.prototype.Rh=function(r,i,o){var s=this,u=0,a=[];return Wu(r).Br(function(t,e){var n=s.serializer.mh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.Ih(r,n)))}).next(function(){return nu.vn(a)}).next(function(){return u})},Gu.prototype.js=function(t,r){var i=this;return Wu(t).Br(function(t,e){var n=i.serializer.mh(e);r(n)})},Gu.prototype.hh=function(t){return Qu(t._h)},Gu.prototype.oh=function(t,e){return Zu.Cr(t,xa.store).put(xa.key,e)},Gu.prototype.fh=function(t,e){return Wu(t).put(this.serializer.Ah(e))},Gu.prototype.Th=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Gu.prototype.Ph=function(t){return this.hh(t).next(function(t){return t.targetCount})},Gu.prototype.Vh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Wu(t).Br({range:n,index:Da.queryTargetsIndexName},function(t,e,n){var r=o.serializer.mh(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Gu.prototype.gh=function(n,t,r){var i=this,o=[],s=Ku(n);return t.forEach(function(t){var e=Tu(t.path);o.push(s.put(new ka(r,e))),o.push(i.nh.ph(n,r,t))}),nu.vn(o)},Gu.prototype.yh=function(n,t,r){var i=this,o=Ku(n);return nu.forEach(t,function(t){var e=Tu(t.path);return nu.vn([o.delete([r,e]),i.nh.bh(n,r,t)])})},Gu.prototype.wh=function(t,e){var n=Ku(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Gu.prototype.vh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ku(t),o=cs();return r.Br({range:n,Sh:!0},function(t,e,n){var r=_u(t[1]),i=new Hr(r);o=o.add(i)}).next(function(){return o})},Gu.prototype.Dh=function(t,e){var n=Tu(e.path),r=IDBKeyRange.bound([n],[Xs(n)],!1,!0),i=0;return Ku(t).Br({index:ka.documentTargetsIndex,Sh:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Gu.prototype.si=function(t,e){var n=this;return Wu(t).get(e).next(function(t){return t?n.serializer.mh(t):null})},Gu);function Gu(t,e){this.nh=t,this.serializer=e}function zu(t){this.eh=t}function Wu(t){return Zu.Cr(t,Da.store)}function Qu(t){return Ca.Cr(t,xa.store).get(xa.key).next(function(t){return Ws(null!==t),t})}function Hu(t){return Qu(t).next(function(t){return t.highestListenSequenceNumber})}function Ku(t){return Zu.Cr(t,ka.store)}var Yu,Xu=(na.prototype.Qr=function(t){if(t.document)return this.Ch.Ai(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Hr.st(t.noDocument.path),n=this.Fh(t.noDocument.readTime);return new bo(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Hr.st(t.unknownDocument.path),i=this.Fh(t.unknownDocument.version);return new Eo(r,i)}return zs()},na.prototype.th=function(t,e){var n=this.Ur(e),r=t.key.path.M().W();if(t instanceof wo){var i=this.Ch.mi(t),o=t.hasCommittedMutations;return new Aa(null,null,i,o,n,r)}if(t instanceof bo){var s=t.key.path.W(),u=this.Nh(t.version),a=t.hasCommittedMutations;return new Aa(null,new Na(s,u),null,a,n,r)}if(t instanceof Eo){var h=t.key.path.W(),c=this.Nh(t.version);return new Aa(new _a(h,c),null,null,!0,n,r)}return zs()},na.prototype.Ur=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},na.prototype.Kr=function(t){var e=new xr(t[0],t[1]);return Or.v(e)},na.prototype.Nh=function(t){var e=t.C();return new ma(e.seconds,e.nanoseconds)},na.prototype.Fh=function(t){var e=new xr(t.seconds,t.nanoseconds);return Or.v(e)},na.prototype.$h=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Ch.vi(t)}),i=e.mutations.map(function(t){return n.Ch.vi(t)});return new Ea(t,e.batchId,e.Tn.toMillis(),r,i)},na.prototype.kh=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Ch.Fi(t)}),r=t.mutations.map(function(t){return e.Ch.Fi(t)}),i=xr.fromMillis(t.localWriteTimeMs);return new tu(t.batchId,i,n,r)},na.prototype.mh=function(t){var e=this.Fh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?this.Fh(t.lastLimboFreeSnapshotVersion):Or.min(),r=void 0!==t.query.documents?this.Ch.xi(t.query):this.Ch.Wi(t.query);return new Ro(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Jr.fromBase64String(t.resumeToken))},na.prototype.Ah=function(t){var e=this.Nh(t.Ee),n=this.Nh(t.lastLimboFreeSnapshotVersion),r=t.target.Ot()?this.Ch.Oi(t.target):this.Ch.Bi(t.target),i=t.resumeToken.toBase64();return new Da(t.targetId,t.target.canonicalId(),e,i,t.sequenceNumber,n,r)},na),$u="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Ju=(n(ea,Yu=ou),ea),Zu=(ta.Cr=function(t,e){if(t instanceof Ju)return Ca.Cr(t._h,e);throw zs()},ta.prototype.start=function(){var e=this;return Ca.Yh(this.Kh,ya,new va(this.serializer)).then(function(t){return e.Jh=t,e.Xh()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new _r(Nr.FAILED_PRECONDITION,$u);return e.Zh(),e.to(),e.eo(),e.Jh.runTransaction("readonly",[xa.store],Hu)}).then(function(t){e.Oh=new au(t,e.Lh)}).then(function(){e.xh=!0}).catch(function(t){return e.Jh&&e.Jh.close(),Promise.reject(t)})},ta.prototype.so=function(n){var t=this;return this.Wh=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.io?[2,n(e)]:[2]})})},n(this.isPrimary)},ta.prototype.no=function(n){var t=this;this.Jh.ro(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},ta.prototype.ho=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Tr.oo(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.io?[4,this.Xh()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},ta.prototype.Xh=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return ia(e).put(new Va(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ao(e).next(function(t){t||(n.isPrimary=!1,n.Tr.oo(function(){return n.Wh(!1)}))})}).next(function(){return n.uo(e)}).next(function(t){return n.isPrimary&&!t?n.co(e).next(function(){return!1}):!!t&&n._o(e).next(function(){return!0})})}).catch(function(t){if(n.allowTabSynchronization)return Fs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1;if(Ba(t))return Fs("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;throw t}).then(function(t){n.isPrimary!==t&&n.Tr.oo(function(){return n.Wh(t)}),n.isPrimary=t})},ta.prototype.ao=function(t){var e=this;return ra(t).get(ga.key).next(function(t){return nu.resolve(e.lo(t))})},ta.prototype.do=function(t){return ia(t).delete(this.clientId)},ta.prototype.fo=function(){return y(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.To(this.Qh,18e5)?[3,2]:(this.Qh=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=ta.Cr(t,Va.store);return r.Dr().next(function(t){var e=i.Eo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return nu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.Io(t.clientId))}),t.label=2;case 2:return[2]}})})},ta.prototype.eo=function(){var t=this;this.Uh=this.Tr.yr("client_metadata_refresh",4e3,function(){return t.Xh().then(function(){return t.fo()}).then(function(){return t.eo()})})},ta.prototype.lo=function(t){return!!t&&t.ownerId===this.clientId},ta.prototype.uo=function(e){var i=this;return ra(e).get(ga.key).next(function(t){if(null!==t&&i.To(t.leaseTimestampMs,5e3)&&!i.wo(t.ownerId)){if(i.lo(t)&&i.networkEnabled)return!0;if(!i.lo(t)){if(!t.allowTabSynchronization)throw new _r(Nr.FAILED_PRECONDITION,$u);return!1}}return!(!i.networkEnabled||!i.inForeground)||ia(e).Dr().next(function(t){return void 0===i.Eo(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Fs("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},ta.prototype.Ro=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.xh=!1,this.mo(),this.Uh&&(this.Uh.cancel(),this.Uh=null),this.Ao(),this.Po(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.co(t).next(function(){return e.do(t)})}).catch(function(t){Fs("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.Jh.close(),this.Vo(),[2]}})})},ta.prototype.Eo=function(t,e){var n=this;return t.filter(function(t){return n.To(t.updateTimeMs,e)&&!n.wo(t.clientId)})},ta.prototype.po=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return ia(t).Dr().next(function(t){return e.Eo(t,18e5).map(function(t){return t.clientId})})})},ta.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return ta.jh()?(e=n+ta.Gh,[4,Ca.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(ta.prototype,"io",{get:function(){return this.xh},enumerable:!0,configurable:!0}),ta.prototype.yo=function(t){return aa.bo(t,this.serializer,this.jn,this.nh)},ta.prototype.vo=function(){return this.zh},ta.prototype.So=function(){return this.Qn},ta.prototype.Do=function(){return this.jn},ta.prototype.runTransaction=function(e,n,r){var i=this;Fs("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Jh.runTransaction(t,La,function(t){return o=new Ju(t,i.Oh?i.Oh.next():au.dr),"readwrite-primary"===n?i.ao(o).next(function(t){return!!t||i.uo(o)}).next(function(t){if(!t)throw Bs("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Tr.oo(function(){return i.Wh(!1)}),new _r(Nr.FAILED_PRECONDITION,iu);return r(o)}).next(function(t){return i._o(o).next(function(){return t})}):i.Co(o).next(function(){return r(o)})}).then(function(t){return o.Un(),t})},ta.prototype.Co=function(t){var e=this;return ra(t).get(ga.key).next(function(t){if(null!==t&&e.To(t.leaseTimestampMs,5e3)&&!e.wo(t.ownerId)&&!e.lo(t)&&(!e.allowTabSynchronization||!t.allowTabSynchronization))throw new _r(Nr.FAILED_PRECONDITION,$u)})},ta.prototype._o=function(t){var e=new ga(this.clientId,this.allowTabSynchronization,Date.now());return ra(t).put(ga.key,e)},ta.jh=function(){return Ca.jh()},ta.Fo=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},ta.prototype.co=function(t){var e=this,n=ra(t);return n.get(ga.key).next(function(t){return e.lo(t)?(Fs("IndexedDbPersistence","Releasing primary lease."),n.delete(ga.key)):nu.resolve()})},ta.prototype.To=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Bs("Detected an update time that is in the future: "+t+" > "+n),1))},ta.prototype.Zh=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qh=function(){t.Tr.oo(function(){return t.inForeground="visible"===t.document.visibilityState,t.Xh()})},this.document.addEventListener("visibilitychange",this.qh),this.inForeground="visible"===this.document.visibilityState)},ta.prototype.Ao=function(){this.qh&&(this.document.removeEventListener("visibilitychange",this.qh),this.qh=null)},ta.prototype.to=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Bh=function(){t.mo(),t.Tr.oo(function(){return t.Ro()})},this.window.addEventListener("unload",this.Bh))},ta.prototype.Po=function(){this.Bh&&(this.window.removeEventListener("unload",this.Bh),this.Bh=null)},ta.prototype.wo=function(t){try{var e=null!==this.Hh.getItem(this.Io(t));return Fs("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},ta.prototype.mo=function(){try{this.Hh.setItem(this.Io(this.clientId),String(Date.now()))}catch(t){Bs("Failed to set zombie client id.",t)}},ta.prototype.Vo=function(){try{this.Hh.removeItem(this.Io(this.clientId))}catch(t){}},ta.prototype.Io=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},ta);function ta(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Tr=o,this.Lh=u,this.Oh=null,this.xh=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bh=null,this.inForeground=!1,this.qh=null,this.Uh=null,this.Qh=Number.NEGATIVE_INFINITY,this.Wh=function(t){return Promise.resolve()},!ta.jh())throw new _r(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.nh=new oa(this,i),this.Kh=e+ta.Gh,this.serializer=new Xu(s),this.document=r.document,this.zh=new Bu(this.nh,this.serializer),this.jn=new Du,this.Qn=new Pu(this.serializer,this.jn),!r.window||!r.window.localStorage)throw new _r(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Hh=this.window.localStorage}function ea(t,e){var n=this;return(n=Yu.call(this)||this)._h=t,n.Mh=e,n}function na(t){this.Ch=t}function ra(t){return Zu.Cr(t,ga.store)}function ia(t){return Zu.Cr(t,Va.store)}Zu.Gh="main";var oa=(sa.prototype.$o=function(t){var n=this.ko(t);return this.db.vo().Ph(t).next(function(e){return n.next(function(t){return e+t})})},sa.prototype.ko=function(t){var e=0;return this.Mo(t,function(t){e++}).next(function(){return e})},sa.prototype.js=function(t,e){return this.db.vo().js(t,e)},sa.prototype.Mo=function(t,n){return this.Lo(t,function(t,e){return n(e)})},sa.prototype.ph=function(t,e,n){return ua(t,n)},sa.prototype.bh=function(t,e,n){return ua(t,n)},sa.prototype.Rh=function(t,e,n){return this.db.vo().Rh(t,e,n)},sa.prototype.Oo=ua,sa.prototype.xo=function(t,e){return r=e,i=!1,da(n=t).Bo(function(t){return ca(n,t,r).next(function(t){return t&&(i=!0),nu.resolve(!t)})}).next(function(){return i});var n,r,i},sa.prototype.qo=function(r,i){var o=this,s=this.db.So().zr(),u=[],a=0;return this.Lo(r,function(e,t){var n;t<=i&&(n=o.xo(r,e).next(function(t){if(!t)return a++,s.Mn(r,e).next(function(){return s.kn(e),Ku(r).delete([0,Tu(e.path)])})}),u.push(n))}).next(function(){return nu.vn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},sa.prototype.removeTarget=function(t,e){var n=e.Ie(t.Mh);return this.db.vo().Eh(t,n)},sa.prototype.Uo=ua,sa.prototype.Lo=function(t,o){var s,e=Ku(t),u=au.dr;return e.Br({index:ka.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==au.dr&&o(new Hr(_u(s)),u),u=i,s=r):u=au.dr}).next(function(){u!==au.dr&&o(new Hr(_u(s)),u)})},sa.prototype.Qo=function(t){return this.db.So().Jr(t)},sa);function sa(t,e){this.db=t,this.No=new ah(this,e)}function ua(t,e){return Ku(t).put((n=t.Mh,new ka(0,Tu(e.path),n)));var n}var aa=(ha.bo=function(t,e,n,r){return Ws(""!==t.uid),new ha(t.t()?t.uid:"",e,n,r)},ha.prototype.jo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return la(t).Br({index:Ea.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},ha.prototype.Ko=function(e,t,n){return this.Go(e).next(function(t){return t.lastStreamToken=n.toBase64(),da(e).put(t)})},ha.prototype.zo=function(t){return this.Go(t).next(function(t){return Jr.fromBase64String(t.lastStreamToken)})},ha.prototype.Ho=function(e,n){return this.Go(e).next(function(t){return t.lastStreamToken=n.toBase64(),da(e).put(t)})},ha.prototype.Yo=function(h,c,f,l){var p=this,d=pa(h),y=la(h);return y.add({}).next(function(t){Ws("number"==typeof t);for(var e=new tu(t,c,f,l),n=p.serializer.$h(p.userId,e),r=[],i=new ns(function(t,e){return Ks(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=Ta.key(p.userId,u.key.path,t),i=i.add(u.key.path.M());r.push(y.put(n)),r.push(d.put(a,Ta.PLACEHOLDER))}return i.forEach(function(t){r.push(p.jn.vr(h,t))}),h.qn(function(){p.Wo[t]=e.keys()}),nu.vn(r).next(function(){return e})})},ha.prototype.Jo=function(t,e){var n=this;return la(t).get(e).next(function(t){return t?(Ws(t.userId===n.userId),n.serializer.kh(t)):null})},ha.prototype.Xo=function(t,n){var r=this;return this.Wo[n]?nu.resolve(this.Wo[n]):this.Jo(t,n).next(function(t){if(t){var e=t.keys();return r.Wo[n]=e}return null})},ha.prototype.Zo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return la(t).Br({index:Ea.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Ws(e.batchId>=i),o=r.serializer.kh(e)),n.done()}).next(function(){return o})},ha.prototype.ta=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return la(t).Br({index:Ea.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},ha.prototype.ea=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return la(t).Dr(Ea.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.kh(t)})})},ha.prototype.Gn=function(u,a){var h=this,t=Ta.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return pa(u).Br({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=_u(i);if(r===h.userId&&a.path.isEqual(s))return la(u).get(o).next(function(t){if(!t)throw zs();Ws(t.userId===h.userId),c.push(h.serializer.kh(t))});n.done()}).next(function(){return c})},ha.prototype.Xn=function(r,t){var a=this,h=new ns(Ks),i=[];return t.forEach(function(u){var t=Ta.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=pa(r).Br({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=_u(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),nu.vn(i).next(function(){return a.sa(r,h)})},ha.prototype.nr=function(t,e){var u=this,a=e.path,h=a.length+1,n=Ta.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new ns(Ks);return pa(t).Br({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=_u(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.sa(t,c)})},ha.prototype.sa=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(la(e).get(t).next(function(t){if(null===t)throw zs();Ws(t.userId===n.userId),r.push(n.serializer.kh(t))}))}),nu.vn(i).next(function(){return r})},ha.prototype.ia=function(e,n){var r=this;return fa(e._h,this.userId,n).next(function(t){return e.qn(function(){r.na(n.batchId)}),nu.forEach(t,function(t){return r.nh.Oo(e,t)})})},ha.prototype.na=function(t){delete this.Wo[t]},ha.prototype.ra=function(n){var o=this;return this.jo(n).next(function(t){if(!t)return nu.resolve();var e=IDBKeyRange.lowerBound(Ta.prefixForUser(o.userId)),i=[];return pa(n).Br({range:e},function(t,e,n){var r;t[0]===o.userId?(r=_u(t[1]),i.push(r)):n.done()}).next(function(){Ws(0===i.length)})})},ha.prototype.Dh=function(t,e){return ca(t,this.userId,e)},ha.prototype.Go=function(t){var e=this;return da(t).get(this.userId).next(function(t){return t||new ba(e.userId,-1,"")})},ha);function ha(t,e,n,r){this.userId=t,this.serializer=e,this.jn=n,this.nh=r,this.Wo={}}function ca(t,o,e){var n=Ta.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return pa(t).Br({range:r,Sh:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function fa(t,e,n){var r=t.store(Ea.store),i=t.store(Ta.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Br({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Ws(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Ta.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return nu.vn(o).next(function(){return h})}function la(t){return Zu.Cr(t,Ea.store)}function pa(t){return Zu.Cr(t,Ta.store)}function da(t){return Zu.Cr(t,ba.store)}var ya=10,va=(wa.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Ws(t<e&&0<=t&&e<=ya);var o,s=new Ga(r);t<1&&1<=e&&(n.createObjectStore(ga.store),(o=n).createObjectStore(ba.store,{keyPath:ba.keyPath}),o.createObjectStore(Ea.store,{keyPath:Ea.keyPath,autoIncrement:!0}).createIndex(Ea.userMutationsIndex,Ea.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Ta.store),Ra(n),n.createObjectStore(Aa.store));var u,a=nu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(ka.store),u.deleteObjectStore(Da.store),u.deleteObjectStore(xa.store),Ra(n)),a=a.next(function(){return t=s.store(xa.store),e=new xa(0,0,Or.min().C(),0),t.put(xa.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Ea.store).Dr().next(function(t){r.deleteObjectStore(Ea.store),r.createObjectStore(Ea.store,{keyPath:Ea.keyPath,autoIncrement:!0}).createIndex(Ea.userMutationsIndex,Ea.userMutationsKeyPath,{unique:!0});var e=i.store(Ea.store),n=t.map(function(t){return e.put(t)});return nu.vn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Va.store,{keyPath:Va.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Sa.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Aa.store)).createIndex(Aa.readTimeIndex,Aa.readTimeIndexPath,{unique:!1}),t.createIndex(Aa.collectionReadTimeIndex,Aa.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},wa.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Aa.store).Br(function(t,e){n+=Uu(e)}).next(function(){var t=new Sa(n);return e.store(Sa.store).put(Sa.key,t)})},wa.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(ba.store),e=r.store(Ea.store);return t.Dr().next(function(t){return nu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Dr(Ea.userMutationsIndex,t).next(function(t){return nu.forEach(t,function(t){Ws(t.userId===n.userId);var e=i.serializer.kh(t);return fa(r,n.userId,e).next(function(){})})})})})},wa.prototype.ensureSequenceNumbers=function(t){var s=t.store(ka.store),e=t.store(Aa.store);return Hu(t).next(function(i){var o=[];return e.Br(function(t,e){var n=new Vr(t),r=[0,Tu(n)];o.push(s.get(r).next(function(t){return t?nu.resolve():s.put(new ka(0,Tu(n),i))}))}).next(function(){return nu.vn(o)})})},wa.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.O(),n=t.M();return i.put({collectionId:e,parent:Tu(n)})}}t.createObjectStore(Oa.store,{keyPath:Oa.keyPath});var i=e.store(Oa.store),o=new Su;return e.store(Aa.store).Br({Sh:!0},function(t,e){return r(new Vr(t).M())}).next(function(){return e.store(Ta.store).Br({Sh:!0},function(t,e){t[0];var n=t[1];return r((t[2],_u(n)).M())})})},wa.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Da.store);return o.Br(function(t,e){var n=i.serializer.mh(e),r=i.serializer.Ah(n);return o.put(r)})},wa),ma=function(t,e){this.seconds=t,this.nanoseconds=e},ga=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function wa(t){this.serializer=t}ga.store="owner",ga.key="owner";var ba=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ba.store="mutationQueues",ba.keyPath="userId";var Ea=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ea.store="mutations",Ea.keyPath="batchId",Ea.userMutationsIndex="userMutationsIndex",Ea.userMutationsKeyPath=["userId","batchId"];var Ta=(Ia.prefixForUser=function(t){return[t]},Ia.prefixForPath=function(t,e){return[t,Tu(e)]},Ia.key=function(t,e,n){return[t,Tu(e),n]},Ia);function Ia(){}Ta.store="documentMutations",Ta.PLACEHOLDER=new Ta;var Na=function(t,e){this.path=t,this.readTime=e},_a=function(t,e){this.path=t,this.version=e},Aa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Aa.store="remoteDocuments",Aa.readTimeIndex="readTimeIndex",Aa.readTimeIndexPath="readTime",Aa.collectionReadTimeIndex="collectionReadTimeIndex",Aa.collectionReadTimeIndexPath=["parentPath","readTime"];var Sa=function(t){this.byteSize=t};Sa.store="remoteDocumentGlobal",Sa.key="remoteDocumentGlobalKey";var Da=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Da.store="targets",Da.keyPath="targetId",Da.queryTargetsIndexName="queryTargetsIndex",Da.queryTargetsKeyPath=["canonicalId","targetId"];var ka=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ka.store="targetDocuments",ka.keyPath=["targetId","path"],ka.documentTargetsIndex="documentTargetsIndex",ka.documentTargetsKeyPath=["path","targetId"];var xa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};xa.key="targetGlobalKey",xa.store="targetGlobal";var Oa=function(t,e){this.collectionId=t,this.parent=e};function Ra(t){t.createObjectStore(ka.store,{keyPath:ka.keyPath}).createIndex(ka.documentTargetsIndex,ka.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Da.store,{keyPath:Da.keyPath}).createIndex(Da.queryTargetsIndexName,Da.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(xa.store)}Oa.store="collectionParents",Oa.keyPath=["collectionId","parent"];var Va=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Va.store="clientMetadata",Va.keyPath="clientId";var Pa,La=i(i(i([ba.store,Ea.store,Ta.store,Aa.store,Da.store,ga.store,xa.store,ka.store],[Va.store]),[Sa.store]),[Oa.store]),Ca=(Fa.Yh=function(o,t,s){return Fs("SimpleDb","Opening database:",o),new nu(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Fa(e))},i.onblocked=function(){r(new _r(Nr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new _r(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Fs("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,ya).next(function(){Fs("SimpleDb","Database upgrade to version "+ya+" complete")})}}).yn()},Fa.delete=function(t){return Fs("SimpleDb","Removing database:",t),Ha(window.indexedDB.deleteDatabase(t)).yn()},Fa.jh=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Fa.oa())return!0;if(void 0===window.navigator)return!1;var t=p(),e=Fa.ha(t),n=0<e&&e<10,r=Fa.aa(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Fa.oa=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.ua)},Fa.Cr=function(t,e){return t.store(e)},Fa.ha=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Fa.aa=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Fa.prototype.ro=function(e){this.db.onversionchange=function(t){return e(t)}},Fa.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Ga.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),nu.reject(t)}).yn(),r={},n.catch(function(){}),[4,e.ca];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Fs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Fa.prototype.close=function(){this.db.close()},Fa),Ma=(Object.defineProperty(qa.prototype,"Pn",{get:function(){return this.la},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"fa",{get:function(){return this.da},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"cursor",{set:function(t){this._a=t},enumerable:!0,configurable:!0}),qa.prototype.done=function(){this.la=!0},qa.prototype.qr=function(t){this.da=t},qa.prototype.delete=function(){return Ha(this._a.delete())},qa),ja=(n(Ua,Pa=_r),Ua);function Ua(t){var e=this;return(e=Pa.call(this,Nr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function qa(t){this._a=t,this.la=!1,this.da=null}function Fa(t){this.db=t,12.2===Fa.ha(p())&&Bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Ba(t){return"IndexedDbTransactionError"===t.name}var Ga=(Qa.open=function(t,e,n){return new Qa(t.transaction(n,e))},Object.defineProperty(Qa.prototype,"ca",{get:function(){return this.Ta.promise},enumerable:!0,configurable:!0}),Qa.prototype.abort=function(t){t&&this.Ta.reject(t),this.aborted||(Fs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Qa.prototype.store=function(t){var e=this.transaction.objectStore(t);return new za(e)},Qa),za=(Wa.prototype.put=function(t,e){return Ha(void 0!==e?(Fs("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Fs("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Wa.prototype.add=function(t){return Fs("SimpleDb","ADD",this.store.name,t,t),Ha(this.store.add(t))},Wa.prototype.get=function(e){var n=this;return Ha(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Fs("SimpleDb","GET",n.store.name,e,t),t})},Wa.prototype.delete=function(t){return Fs("SimpleDb","DELETE",this.store.name,t),Ha(this.store.delete(t))},Wa.prototype.count=function(){return Fs("SimpleDb","COUNT",this.store.name),Ha(this.store.count())},Wa.prototype.Dr=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ea(n,function(t,e){r.push(e)}).next(function(){return r})},Wa.prototype.Ia=function(t,e){Fs("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Sh=!1;var r=this.cursor(n);return this.Ea(r,function(t,e,n){return n.delete()})},Wa.prototype.Br=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ea(r,e)},Wa.prototype.Bo=function(i){var t=this.cursor({});return new nu(function(n,r){t.onerror=function(t){var e=Ya(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Wa.prototype.Ea=function(t,s){var u=[];return new nu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Ma(i),(n=s(i.primaryKey,i.value,e))instanceof nu&&(r=n.catch(function(t){return e.done(),nu.reject(t)}),u.push(r)),e.Pn?o():null===e.fa?i.continue():i.continue(e.fa)):o()}}).next(function(){return nu.vn(u)})},Wa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Wa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Sh?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Wa);function Wa(t){this.store=t}function Qa(t){var n=this;this.transaction=t,this.aborted=!1,this.Ta=new wu,this.transaction.oncomplete=function(){n.Ta.resolve()},this.transaction.onabort=function(){t.error?n.Ta.reject(new ja(t.error)):n.Ta.resolve()},this.transaction.onerror=function(t){var e=Ya(t.target.error);n.Ta.reject(new ja(e))}}function Ha(t){return new nu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Ya(t.target.error);r(e)}})}var Ka=!1;function Ya(t){var e=Ca.ha(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new _r("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ka||(Ka=!0,setTimeout(function(){throw r},0)),r}}return t}var Xa=(Za.Pa=function(t,e,n,r,i){var o=new Za(t,e,Date.now()+n,r,i);return o.start(n),o},Za.prototype.start=function(t){var e=this;this.Va=setTimeout(function(){return e.ga()},t)},Za.prototype.pa=function(){return this.ga()},Za.prototype.cancel=function(t){null!==this.Va&&(this.clearTimeout(),this.Aa.reject(new _r(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Za.prototype.ga=function(){var e=this;this.wa.oo(function(){return null!==e.Va?(e.clearTimeout(),e.op().then(function(t){return e.Aa.resolve(t)})):Promise.resolve()})},Za.prototype.clearTimeout=function(){null!==this.Va&&(this.ma(this),clearTimeout(this.Va),this.Va=null)},Za),$a=(Object.defineProperty(Ja.prototype,"Ma",{get:function(){return this.va},enumerable:!0,configurable:!0}),Ja.prototype.oo=function(t){this.enqueue(t)},Ja.prototype.La=function(t){this.Oa(),this.xa(t)},Ja.prototype.Ba=function(t){return this.Oa(),this.xa(t)},Ja.prototype.qa=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Oa(),this.va?[3,2]:(this.va=!0,(e=Cs.nt().window)&&e.removeEventListener("visibilitychange",this.$a),[4,this.Ba(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ja.prototype.enqueue=function(t){return this.Oa(),this.va?new Promise(function(t){}):this.xa(t)},Ja.prototype.Ua=function(i){var t=this;this.Oa(),this.va||(this.ba=this.ba.then(function(){var n=new wu,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.Na.reset(),[3,3];case 2:if(!Ba(e=t.sent()))throw n.resolve(),e;return Fs("AsyncQueue","Operation failed with retryable error: "+e),this.Na.gr(r),[3,3];case 3:return[2]}})})};return t.oo(r),n.promise}))},Ja.prototype.xa=function(t){var e=this,n=this.ya.then(function(){return e.Ca=!0,t().catch(function(t){throw e.Da=t,e.Ca=!1,Bs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.Ca=!1,t})});return this.ya=n},Ja.prototype.yr=function(t,e,n){var r=this;this.Oa(),-1<this.Fa.indexOf(t)&&(e=0);var i=Xa.Pa(this,t,e,n,function(t){return r.Qa(t)});return this.Sa.push(i),i},Ja.prototype.Oa=function(){this.Da&&zs()},Ja.prototype.Wa=function(){},Ja.prototype.ja=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.ya];case 1:t.sent(),t.label=2;case 2:if(e!==this.ya)return[3,0];t.label=3;case 3:return[2]}})})},Ja.prototype.Ka=function(t){for(var e=0,n=this.Sa;e<n.length;e++)if(n[e].Er===t)return!0;return!1},Ja.prototype.ka=function(r){var i=this;return this.ja().then(function(){i.Sa.sort(function(t,e){return t.Ra-e.Ra});for(var t=0,e=i.Sa;t<e.length;t++){var n=e[t];if(n.pa(),"all"!==r&&n.Er===r)break}return i.ja()})},Ja.prototype.Ga=function(t){this.Fa.push(t)},Ja.prototype.Qa=function(t){var e=this.Sa.indexOf(t);this.Sa.splice(e,1)},Ja);function Ja(){var t=this;this.ya=Promise.resolve(),this.ba=Promise.resolve(),this.va=!1,this.Sa=[],this.Da=null,this.Ca=!1,this.Fa=[],this.Na=new bu(this,"async_queue_retry"),this.$a=function(){t.ka("async_queue_retry")};var e=Cs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.$a)}function Za(t,e,n,r,i){this.wa=t,this.Er=e,this.Ra=n,this.op=r,this.ma=i,this.Aa=new wu,this.then=this.Aa.promise.then.bind(this.Aa.promise),this.catch=this.Aa.promise.catch.bind(this.Aa.promise),this.Aa.promise.catch(function(t){})}function th(t,e){if(Bs("AsyncQueue",e+": "+t),Ba(t))return new _r(Nr.UNAVAILABLE,e+": "+t);throw t}function eh(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ks(n,i);return 0===s?Ks(r,o):s}var nh=(sh.prototype.Ya=function(){return++this.Ha},sh.prototype.Ja=function(t){var e,n=[t,this.Ya()];this.buffer.size<this.za?this.buffer=this.buffer.add(n):eh(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(sh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),sh),rh={Xa:!1,Za:0,tu:0,eu:0},ih=(oh.ru=function(t){return new oh(t,oh.hu,oh.ou)},oh);function oh(t,e,n){this.su=t,this.iu=e,this.nu=n}function sh(t){this.za=t,this.buffer=new ns(eh),this.Ha=0}ih.au=-1,ih.uu=1048576,ih.cu=41943040,ih.hu=10,ih.ou=1e3,ih._u=new ih(ih.cu,ih.hu,ih.ou),ih.DISABLED=new ih(ih.au,0,0);var uh=(lh.prototype.start=function(t){this.No.fu.su!==ih.au&&this.Tu(t)},lh.prototype.stop=function(){this.du&&(this.du.cancel(),this.du=null)},Object.defineProperty(lh.prototype,"io",{get:function(){return null!==this.du},enumerable:!0,configurable:!0}),lh.prototype.Tu=function(n){var t=this,e=this.lu?3e5:6e4;Fs("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.du=this.wa.yr("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.du=null,this.lu=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Eu(this.No)];case 2:return t.sent(),[3,7];case 3:return Ba(e=t.sent())?(Fs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,vh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Tu(n)];case 8:return t.sent(),[2]}})})})},lh),ah=(fh.prototype.wu=function(t,e){return this.Iu.$o(t).next(function(t){return Math.floor(e/100*t)})},fh.prototype.Ru=function(t,e){var n=this;if(0===e)return nu.resolve(au.dr);var r=new nh(e);return this.Iu.js(t,function(t){return r.Ja(t.sequenceNumber)}).next(function(){return n.Iu.Mo(t,function(t){return r.Ja(t)})}).next(function(){return r.maxValue})},fh.prototype.Rh=function(t,e,n){return this.Iu.Rh(t,e,n)},fh.prototype.qo=function(t,e){return this.Iu.qo(t,e)},fh.prototype.mu=function(e,n){var r=this;return this.fu.su===ih.au?(Fs("LruGarbageCollector","Garbage collection skipped; disabled"),nu.resolve(rh)):this.Qo(e).next(function(t){return t<r.fu.su?(Fs("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.fu.su),rh):r.Au(e,n)})},fh.prototype.Qo=function(t){return this.Iu.Qo(t)},fh.prototype.Au=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.wu(e,this.fu.iu).next(function(t){return i=t>c.fu.nu?(Fs("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.fu.nu+" from "+t),c.fu.nu):t,s=Date.now(),c.Ru(e,i)}).next(function(t){return r=t,u=Date.now(),c.Rh(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.qo(e,r)}).next(function(t){return h=Date.now(),Us()<=l.DEBUG&&Fs("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),nu.resolve({Xa:!0,Za:i,tu:o,eu:t})})},fh),hh=(ch.prototype.start=function(){return Promise.resolve()},ch.prototype.Su=function(i){return y(this,void 0,void 0,function(){var e,g,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Wn,g=this.bu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var m;return r.Wn.ea(v).next(function(t){return m=t,e=r.persistence.yo(i),g=new su(r.yu,e,r.persistence.Do()),e.ea(v)}).next(function(t){for(var e=[],n=[],r=cs(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return g.Yn(v,r).next(function(t){return{Du:t,Cu:e,Fu:n}})})})];case 1:return n=t.sent(),[2,(this.Wn=e,this.bu=g,this.Pu.vu(this.bu),n)]}})})},ch.prototype.Nu=function(u){var a,h=this,c=xr.now(),t=u.reduce(function(t,e){return t.add(e.key)},cs());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.bu.Yn(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new Fi(i.key,o,io(o.proto.mapValue),ji.exists(!0)))}return h.Wn.Yo(s,c,e,u)})}).then(function(t){var e=t.In(a);return{batchId:t.batchId,Dn:e}})},ch.prototype.Ko=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.yu.zr({Yr:!0});return i.Wn.Ko(t,r.batch,r.streamToken).next(function(){return i.$u(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Wn.ra(t)}).next(function(){return i.bu.Yn(t,e)})})},ch.prototype.ku=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.Wn.Jo(e,t).next(function(t){return Ws(null!==t),n=t.keys(),r.Wn.ia(e,t)}).next(function(){return r.Wn.ra(e)}).next(function(){return r.bu.Yn(e,n)})})},ch.prototype.ta=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Wn.ta(t)})},ch.prototype.zo=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.Wn.zo(t)})},ch.prototype.Ho=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.Wn.Ho(t,e)})},ch.prototype.ah=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.zh.ah(t)})},ch.prototype.Mu=function(a){var h=this,c=a.Ee,f=this.Vu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.yu.zr({Yr:!0});f=h.Vu;var s=[];a.as.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.zh.yh(o,t.Is,e).next(function(){return h.zh.gh(o,t.Ts,e)})),0<(n=t.resumeToken).rt()&&(r=i.we(n,c).Ie(o.Mh),f=f.me(e,r),ch.Lu(i,r,t)&&s.push(h.zh.Eh(o,r))))});var t,u=is,n=cs();return a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof bo&&e.version.isEqual(Or.min())?(i.kn(t,c),u=u.me(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Nn(e,c),u=u.me(t,e)):Fs("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.nh.Uo(o,t))})})),c.isEqual(Or.min())||(t=h.zh.ah(o).next(function(t){return h.zh.lh(o,o.Mh,c)}),s.push(t)),nu.vn(s).next(function(){return i.apply(o)}).next(function(){return h.bu.Jn(o,u)})}).then(function(t){return h.Vu=f,t})},ch.Lu=function(t,e,n){return Ws(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Ou||0<n.Ts.size+n.Es.size+n.Is.size},ch.prototype.xu=function(c){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return nu.forEach(c,function(e){return nu.forEach(e.hr,function(t){return h.persistence.nh.ph(n,e.targetId,t)}).next(function(){return nu.forEach(e.or,function(t){return h.persistence.nh.bh(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!Ba(e=t.sent()))throw e;return Fs("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.Vu.get(o),u=s.Ee,a=s.Re(u),this.Vu=this.Vu.me(o,a));return[2]}})})},ch.prototype.Bu=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Wn.Zo(t,e)})},ch.prototype.qu=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.bu.Kn(t,e)})},ch.prototype.Uu=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.zh.Vh(e,r).next(function(t){return t?(n=t,nu.resolve(n)):i.zh.rh(e).next(function(t){return n=new Ro(r,t,0,e.Mh),i.zh.dh(e,n).next(function(){return n})})})}).then(function(t){return null===i.Vu.get(t.targetId)&&(i.Vu=i.Vu.me(t.targetId,t),i.gu.set(r,t.targetId)),t})},ch.prototype.Vh=function(t,e){var n=this.gu.get(e);return void 0!==n?nu.resolve(this.Vu.get(n)):this.zh.Vh(t,e)},ch.prototype.Qu=function(t,e){var n=this,r=this.Vu.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,function(t){return e?nu.resolve():n.persistence.nh.removeTarget(t,r)}).then(function(){n.Vu=n.Vu.remove(t),n.gu.delete(r.target)})},ch.prototype.Wu=function(t,n){var r=this,i=Or.min(),o=cs();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.Vh(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.zh.vh(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Pu.Zn(e,t,n?i:Or.min(),n?o:cs())}).next(function(t){return{documents:t,ju:o}})})},ch.prototype.$u=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=nu.resolve();return n.forEach(function(r){u=u.next(function(){return o.Mn(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Ws(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Nn(e,i.wn)})}),u.next(function(){return e.Wn.ia(t,s)})},ch.prototype.Eu=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.mu(t,n.Vu)})},ch);function ch(t,e,n){this.persistence=t,this.Pu=e,this.Vu=new Yo(Ks),this.gu=new Zs(function(t){return t.canonicalId()}),this.pu=Or.min(),this.Wn=t.yo(n),this.yu=t.So(),this.zh=t.vo(),this.bu=new su(this.yu,this.Wn,this.persistence.Do()),this.Pu.vu(this.bu)}function fh(t,e){this.Iu=t,this.fu=e}function lh(t,e){this.No=t,this.wa=e,this.lu=!1,this.du=null}hh.Ou=3e8;var ph,dh=(n(yh,ph=hh),yh.prototype.start=function(){return this.Ku()},yh.prototype.Gu=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.Wn.Xo(e,t).next(function(t){return t?n.bu.Yn(e,t):nu.resolve(null)})})},yh.prototype.zu=function(t){this.Wn.na(t)},yh.prototype.ho=function(t){this.persistence.ho(t)},yh.prototype.po=function(){return this.persistence.po()},yh.prototype.Hu=function(e){var n=this,t=this.Vu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.zh.si(t,e).next(function(t){return t?t.target:null})})},yh.prototype.Wr=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.yu.Wr(t,r.pu)}).then(function(t){var e=t.jr,n=t.readTime;return r.pu=n,e})},yh.prototype.Ku=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.yu.Gr(t)})];case 1:return e.pu=t.sent(),[2]}})})},yh);function yh(t,e,n){var r=this;return(r=ph.call(this,t,e,n)||this).persistence=t,r.Wn=t.yo(n),r.yu=t.So(),r.zh=t.vo(),r}function vh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Nr.FAILED_PRECONDITION||e.message!==iu)throw e;return Fs("LocalStore","Unexpectedly lost primary lease"),[2]})})}var mh=(bh.prototype.B=function(){return this.Yu.B()},bh.prototype.ph=function(t,e){var n=new gh(t,e);this.Yu=this.Yu.add(n),this.Xu=this.Xu.add(n)},bh.prototype.tc=function(t,e){var n=this;t.forEach(function(t){return n.ph(t,e)})},bh.prototype.bh=function(t,e){this.ec(new gh(t,e))},bh.prototype.sc=function(t,e){var n=this;t.forEach(function(t){return n.bh(t,e)})},bh.prototype.ic=function(t){var e=this,n=Hr.EMPTY,r=new gh(n,t),i=new gh(n,t+1),o=[];return this.Xu.Ke([r,i],function(t){e.ec(t),o.push(t.key)}),o},bh.prototype.nc=function(){var e=this;this.Yu.forEach(function(t){return e.ec(t)})},bh.prototype.ec=function(t){this.Yu=this.Yu.delete(t),this.Xu=this.Xu.delete(t)},bh.prototype.rc=function(t){var e=Hr.EMPTY,n=new gh(e,t),r=new gh(e,t+1),i=cs();return this.Xu.Ke([n,r],function(t){i=i.add(t.key)}),i},bh.prototype.Dh=function(t){var e=new gh(t,0),n=this.Yu.ze(e);return null!==n&&t.isEqual(n.key)},bh),gh=(wh.Ju=function(t,e){return Hr.N(t.key,e.key)||Ks(t.hc,e.hc)},wh.Zu=function(t,e){return Ks(t.hc,e.hc)||Hr.N(t.key,e.key)},wh);function wh(t,e){this.key=t,this.hc=e}function bh(){this.Yu=new ns(gh.Ju),this.Xu=new ns(gh.Zu)}function Eh(t,e){if(0!==e.length)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+jh(e.length,"argument")+".")}function Th(t,e,n){if(e.length!==n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires "+jh(n,"argument")+", but was called with "+jh(e.length,"argument")+".")}function Ih(t,e,n){if(e.length<n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+jh(n,"argument")+", but was called with "+jh(e.length,"argument")+".")}function Nh(t,e,n,r){if(e.length<n||e.length>r)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+jh(e.length,"argument")+".")}function _h(t,e,n,r){xh(t,e,Mh(n)+" argument",r)}function Ah(t,e,n,r){void 0!==r&&_h(t,e,n,r)}function Sh(t,e,n,r){xh(t,e,n+" option",r)}function Dh(t,e,n,r){void 0!==r&&Sh(t,e,n,r)}function kh(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Rh(s))}var u=Rh(n);throw new _r(Nr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function xh(t,e,n,r){if(!("object"===e?Oh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Rh(r);throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Oh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Rh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":zs();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Vh(t,e,n){if(void 0===n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Mh(e)+" argument, but it was undefined.")}function Ph(n,t,r){Xr(t,function(t,e){if(r.indexOf(t)<0)throw new _r(Nr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Lh(t,e,n,r){var i=Rh(r);return new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Mh(n)+" argument to be a "+e+", but it was: "+i)}function Ch(t,e,n){if(n<=0)throw new _r(Nr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Mh(e)+" argument to be a positive number, but it was: "+n+".")}function Mh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function jh(t,e){return t+" "+e+(1===t?"":"s")}function Uh(){if("undefined"==typeof Uint8Array)throw new _r(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function qh(){if(!Cs.nt().oc)throw new _r(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Fh=(zh.fromBase64String=function(t){Th("Blob.fromBase64String",arguments,1),_h("Blob.fromBase64String","string",1,t),qh();try{return new zh(Jr.fromBase64String(t))}catch(t){throw new _r(Nr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},zh.fromUint8Array=function(t){if(Th("Blob.fromUint8Array",arguments,1),Uh(),!(t instanceof Uint8Array))throw Lh("Blob.fromUint8Array","Uint8Array",1,t);return new zh(Jr.fromUint8Array(t))},zh.prototype.toBase64=function(){return Th("Blob.toBase64",arguments,0),qh(),this.ac.toBase64()},zh.prototype.toUint8Array=function(){return Th("Blob.toUint8Array",arguments,0),Uh(),this.ac.toUint8Array()},zh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},zh.prototype.isEqual=function(t){return this.ac.isEqual(t.ac)},zh),Bh=(Gh.documentId=function(){return Gh.cc},Gh.prototype.isEqual=function(t){if(!(t instanceof Gh))throw Lh("isEqual","FieldPath",1,t);return this.uc.isEqual(t.uc)},Gh);function Gh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new _r(Nr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(_h("FieldPath","string",n,t[n]),0===t[n].length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.uc=new Wr(t)}function zh(t){qh(),this.ac=t}Bh.cc=new Bh(Wr.J().j());var Wh,Qh,Hh,Kh,Yh,Xh=new RegExp("[~\\*/\\[\\]]"),$h=function(t){this._c=t},Jh=(n(dc,Yh=$h),dc.prototype.Di=function(t){if(2!==t.lc)throw 1===t.lc?t.dc("FieldValue.delete() can only appear at the top level of your update data"):t.dc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},dc.prototype.isEqual=function(t){return t instanceof dc},dc),Zh=(n(pc,Kh=$h),pc.prototype.Di=function(t){return new Mi(t.path,Ei.instance)},pc.prototype.isEqual=function(t){return t instanceof pc},pc),tc=(n(lc,Hh=$h),lc.prototype.Di=function(t){var e=new vc({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map(function(t){return bc(t,e)}),r=new Ii(n);return new Mi(t.path,r)},lc.prototype.isEqual=function(t){return this===t},lc),ec=(n(fc,Qh=$h),fc.prototype.Di=function(t){var e=new vc({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map(function(t){return bc(t,e)}),r=new Ni(n);return new Mi(t.path,r)},fc.prototype.isEqual=function(t){return this===t},fc),nc=(n(cc,Wh=$h),cc.prototype.Di=function(t){var e=new vc({lc:3,methodName:this._c},t.ii,t.serializer),n=bc(this.Ec,e),r=new _i(t.serializer,n);return new Mi(t.path,r)},cc.prototype.isEqual=function(t){return this===t},cc),rc=(Object.defineProperty(hc.prototype,"latitude",{get:function(){return this.Ic},enumerable:!0,configurable:!0}),Object.defineProperty(hc.prototype,"longitude",{get:function(){return this.wc},enumerable:!0,configurable:!0}),hc.prototype.isEqual=function(t){return this.Ic===t.Ic&&this.wc===t.wc},hc.prototype.p=function(t){return Ks(this.Ic,t.Ic)||Ks(this.wc,t.wc)},hc),ic=/^__.*__$/,oc=(ac.prototype.Rc=function(t,e){var n=[];return null!==this.Vt?n.push(new Fi(t,this.data,this.Vt,e)):n.push(new qi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},ac),sc=(uc.prototype.Rc=function(t,e){var n=[new Fi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},uc);function uc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function ac(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function hc(t,e){if(Th("GeoPoint",arguments,2),_h("GeoPoint","number",1,t),_h("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new _r(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new _r(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ic=t,this.wc=e}function cc(t){var e=this;return(e=Wh.call(this,"FieldValue.increment")||this).Ec=t,e}function fc(t){var e=this;return(e=Qh.call(this,"FieldValue.arrayRemove")||this).fc=t,e}function lc(t){var e=this;return(e=Hh.call(this,"FieldValue.arrayUnion")||this).fc=t,e}function pc(){return Kh.call(this,"FieldValue.serverTimestamp")||this}function dc(){return Yh.call(this,"FieldValue.delete")||this}function yc(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw zs()}}var vc=(Object.defineProperty(wc.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(wc.prototype,"lc",{get:function(){return this.settings.lc},enumerable:!0,configurable:!0}),wc.prototype.Ac=function(t){return new wc(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.fieldTransforms,this.Vt)},wc.prototype.Pc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ac({path:n,Tc:!1});return r.Vc(t),r},wc.prototype.gc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ac({path:n,Tc:!1});return r.mc(),r},wc.prototype.pc=function(t){return this.Ac({path:void 0,Tc:!0})},wc.prototype.dc=function(t){var e=!this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new _r(Nr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},wc.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},wc.prototype.mc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Vc(this.path.get(t))},wc.prototype.Vc=function(t){if(0===t.length)throw this.dc("Document fields must not be empty");if(yc(this.lc)&&ic.test(t))throw this.dc('Document fields cannot begin and end with "__"')},wc),mc=(gc.prototype.bc=function(t,e){var n=this.vc(0,t);Ic("Data must be an object, but it was:",n,e);var r=Ec(e,n);return new oc(new Wi(r),null,n.fieldTransforms)},gc.prototype.Sc=function(t,e,n){var r=this.vc(2,t);Ic("Data must be an object, but it was:",r,e);var i,o,s=Ec(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof Bh)f=c.uc;else{if("string"!=typeof c)throw zs();f=_c(t,c)}if(!r.contains(f))throw new _r(Nr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Ac(u,f)||u.push(f)}i=new Ci(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=new Ci(r.Vt),o=r.fieldTransforms;return new oc(new Wi(s),i,o)},gc.prototype.Dc=function(o,t){var s=this.vc(1,o);Ic("Data must be an object, but it was:",s,t);var u=[],a=new Qi;Xr(t,function(t,e){var n,r=_c(o,t),i=s.gc(r);e instanceof Jh?u.push(r):null!=(n=bc(e,i))&&(u.push(r),a.set(r,n))});var e=new Ci(u);return new sc(a.yt(),e,s.fieldTransforms)},gc.prototype.Cc=function(t,e,n,r){var i=this.vc(1,t),o=[Nc(t,e)],s=[n];if(r.length%2!=0)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Nc(t,r[u])),s.push(r[u+1]);for(var a,h,c,f,l=[],p=new Qi,d=o.length-1;0<=d;--d){Ac(l,o[d])||(a=o[d],h=s[d],c=i.gc(a),h instanceof Jh?l.push(a):null!=(f=bc(h,c))&&(l.push(a),p.set(a,f)))}var y=new Ci(l);return new sc(p.yt(),y,i.fieldTransforms)},gc.prototype.vc=function(t,e){return new vc({lc:t,methodName:e,path:Wr.G,Tc:!1},this.ii,this.serializer)},gc.prototype.Fc=function(t,e,n){return void 0===n&&(n=!1),bc(e,this.vc(n?4:3,t))},gc);function gc(t,e){this.ii=t,this.serializer=e||Cs.nt().yc(t)}function wc(t,e,n,r,i){this.settings=t,this.ii=e,this.serializer=n,void 0===r&&this.mc(),this.fieldTransforms=r||[],this.Vt=i||[]}function bc(s,t){if(Tc(s))return Ic("Unsupported field value:",t,s),Ec(s,t);if(s instanceof $h)return function(t,e){if(!yc(e.lc))throw e.dc(t._c+"() can only be used with update() and set()");if(null===e.path)throw e.dc(t._c+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.Tc&&4!==t.lc)throw t.dc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=bc(i[r],t.pc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=xr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof xr){var r=new xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof rc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Fh)return{bytesValue:e.serializer.ui(t)};if(t instanceof ul){var i=e.ii,o=t.firestore.Nc;if(!o.isEqual(i))throw e.dc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.$c.path,t.firestore.Nc)}}throw e.dc("Unsupported field value: "+Rh(t))}(s,t)}function Ec(t,r){var i={};return $r(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):Xr(t,function(t,e){var n=bc(e,r.Pc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Tc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof xr||t instanceof rc||t instanceof Fh||t instanceof ul||t instanceof $h)}function Ic(t,e,n){if(!Tc(n)||!Oh(n)){var r=Rh(n);throw"an object"===r?e.dc(t+" a custom object"):e.dc(t+" "+r)}}function Nc(t,e){if(e instanceof Bh)return e.uc;if("string"==typeof e)return _c(t,e);throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function _c(t,e){try{return function(e){if(0<=e.search(Xh))throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Bh.bind.apply(Bh,i([void 0],e.split("."))))}catch(t){throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).uc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Ac(t,e){return t.some(function(t){return t.isEqual(e)})}var Sc,Dc,kc,xc=(Gc.prototype.Bc=function(){return 1===this.state||2===this.state||4===this.state},Gc.prototype.qc=function(){return 2===this.state},Gc.prototype.start=function(){3!==this.state?this.auth():this.Uc()},Gc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Bc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gc.prototype.Qc=function(){this.state=0,this.Na.reset()},Gc.prototype.Wc=function(){var t=this;this.qc()&&null===this.xc&&(this.xc=this.Tr.yr(this.kc,6e4,function(){return t.jc()}))},Gc.prototype.Kc=function(t){this.Gc(),this.stream.send(t)},Gc.prototype.jc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.qc()?[2,this.close(0)]:[2]})})},Gc.prototype.Gc=function(){this.xc&&(this.xc.cancel(),this.xc=null)},Gc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Gc(),this.Na.cancel(),this.Oc++,3!==e?this.Na.reset():n&&n.code===Nr.RESOURCE_EXHAUSTED?(Bs(n.toString()),Bs("Using maximum backoff delay to prevent overloading the backend."),this.Na.Vr()):n&&n.code===Nr.UNAUTHENTICATED&&this.Lc._(),null!==this.stream&&(this.zc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Hc(n)];case 1:return t.sent(),[2]}})})},Gc.prototype.zc=function(){},Gc.prototype.auth=function(){var n=this;this.state=1;var t=this.Yc(this.Oc),e=this.Oc;this.Lc.getToken().then(function(t){n.Oc===e&&n.Jc(t)},function(e){t(function(){var t=new _r(Nr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Xc(t)})})},Gc.prototype.Jc=function(t){var e=this,n=this.Yc(this.Oc);this.stream=this.Zc(t),this.stream.t_(function(){n(function(){return e.state=2,e.listener.t_()})}),this.stream.Hc(function(t){n(function(){return e.Xc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Gc.prototype.Uc=function(){var t=this;this.state=4,this.Na.gr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Gc.prototype.Xc=function(t){return Fs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Gc.prototype.Yc=function(e){var n=this;return function(t){n.Tr.oo(function(){return n.Oc===e?t():(Fs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Gc),Oc=(n(Bc,kc=xc),Bc.prototype.Zc=function(t){return this.Mc.e_("Listen",t)},Bc.prototype.onMessage=function(t){this.Na.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.s_(e,n)},Bc.prototype.i_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Kc(e)},Bc.prototype.n_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Kc(e)},Bc),Rc=(n(Fc,Dc=xc),Object.defineProperty(Fc.prototype,"h_",{get:function(){return this.r_},enumerable:!0,configurable:!0}),Fc.prototype.start=function(){this.r_=!1,Dc.prototype.start.call(this)},Fc.prototype.zc=function(){this.r_&&this.o_([])},Fc.prototype.Zc=function(t){return this.Mc.e_("Write",t)},Fc.prototype.onMessage=function(t){if(Ws(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.r_){this.Na.reset();var e=this.serializer.Li(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.a_(n,e)}return Ws(!t.writeResults||0===t.writeResults.length),this.r_=!0,this.listener.u_()},Fc.prototype.c_=function(){var t={};t.database=this.serializer.wi,this.Kc(t)},Fc.prototype.o_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.Kc(n)},Fc),Vc=(n(qc,Sc=function(){this.__=void 0}),qc.prototype.l_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.l_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},qc.prototype.d_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.d_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},qc),Pc=(Uc.prototype.R_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.m_(),0<this.mutations.length)throw new _r(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e={database:(n=s).serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.d_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Ws(!!e),o.push(e)}),o)]}})})}(this.f_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof bo||t instanceof wo?n.A_(t):zs()}),e)]}})})},Uc.prototype.set=function(t,e){this.write(e.Rc(t,this.Rt(t))),this.w_.add(t)},Uc.prototype.update=function(t,e){try{this.write(e.Rc(t,this.P_(t)))}catch(t){this.I_=t}this.w_.add(t)},Uc.prototype.delete=function(t){this.write([new Gi(t,this.Rt(t))]),this.w_.add(t)},Uc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.m_(),this.I_)throw this.I_;return e=this.T_,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new zi(t,n.Rt(t)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n={database:(e=i).serializer.wi,writes:o.map(function(t){return e.serializer.vi(t)})},[4,e.l_("Commit",n)];case 1:return r=t.sent(),[2,e.serializer.Li(r.writeResults,r.commitTime)]}})})}(this.f_,this.mutations)];case 1:return t.sent(),this.E_=!0,[2]}})})},Uc.prototype.A_=function(t){var e;if(t instanceof wo)e=t.version;else{if(!(t instanceof bo))throw zs();e=Or.min()}var n=this.T_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new _r(Nr.ABORTED,"Document version changed between two reads.")}else this.T_=this.T_.me(t.key,e)},Uc.prototype.Rt=function(t){var e=this.T_.get(t);return!this.w_.has(t)&&e?ji.updateTime(e):ji.ft()},Uc.prototype.P_=function(t){var e=this.T_.get(t);if(this.w_.has(t)||!e)return ji.exists(!0);if(e.isEqual(Or.min()))throw new _r(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ji.updateTime(e)},Uc.prototype.write=function(t){this.m_(),this.mutations=this.mutations.concat(t)},Uc.prototype.m_=function(){},Uc),Lc=(jc.prototype.b_=function(){var t=this;0===this.g_&&(this.v_("Unknown"),this.p_=this.wa.yr("online_state_timeout",1e4,function(){return t.p_=null,t.S_("Backend didn't respond within 10 seconds."),t.v_("Offline"),Promise.resolve()}))},jc.prototype.D_=function(t){"Online"===this.state?this.v_("Unknown"):(this.g_++,1<=this.g_&&(this.C_(),this.S_("Connection failed 1 times. Most recent error: "+t.toString()),this.v_("Offline")))},jc.prototype.set=function(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.v_(t)},jc.prototype.v_=function(t){t!==this.state&&(this.state=t,this.V_(t))},jc.prototype.S_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.y_?(Bs(e),this.y_=!1):Fs("OnlineStateTracker",e)},jc.prototype.C_=function(){null!==this.p_&&(this.p_.cancel(),this.p_=null)},jc),Cc=(Mc.prototype.start=function(){return this.enableNetwork()},Mc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.J_()},Mc.prototype.J_=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.B_()?(e=this.G_,[4,this.F_.zo()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.X_()?this.Z_():this.U_.set("Unknown"),[4,this.tl()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Mc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),[2]}})})},Mc.prototype.el=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.G_.stop()];case 1:return t.sent(),[4,this.Q_.stop()];case 2:return t.sent(),0<this.N_.length&&(Fs("RemoteStore","Stopping write stream with "+this.N_.length+" pending writes"),this.N_=[]),this.sl(),[2]}})})},Mc.prototype.Ro=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.O_.Ro(),this.U_.set("Unknown"),[2]}})})},Mc.prototype.listen=function(t){this.k_.has(t.targetId)||(this.k_.set(t.targetId,t),this.X_()?this.Z_():this.Q_.qc()&&this.il(t))},Mc.prototype.nl=function(t){this.k_.delete(t),this.Q_.qc()&&this.rl(t),0===this.k_.size&&(this.Q_.qc()?this.Q_.Wc():this.B_()&&this.U_.set("Unknown"))},Mc.prototype.si=function(t){return this.k_.get(t)||null},Mc.prototype.ei=function(t){return this.hl.ei(t)},Mc.prototype.il=function(t){this.M_.Ns(t.targetId),this.Q_.i_(t)},Mc.prototype.rl=function(t){this.M_.Ns(t),this.Q_.n_(t)},Mc.prototype.Z_=function(){this.M_=new Es(this),this.Q_.start(),this.U_.b_()},Mc.prototype.X_=function(){return this.B_()&&!this.Q_.Bc()&&0<this.k_.size},Mc.prototype.B_=function(){return!this.L_&&this.isPrimary&&this.networkEnabled},Mc.prototype.sl=function(){this.M_=null},Mc.prototype.W_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.k_.forEach(function(t,e){n.il(t)}),[2]})})},Mc.prototype.j_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.sl(),this.X_()?(this.U_.D_(e),this.Z_()):this.U_.set("Unknown"),[2]})})},Mc.prototype.K_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.U_.set("Online"),!(i instanceof ds&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.ol(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Fs("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.al(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof ls?this.M_.qs(i):i instanceof ps?this.M_.Hs(i):this.M_.Ws(i),o.isEqual(Or.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.F_.ah()];case 8:return n=t.sent(),0<=o.S(n)?[4,this.ul(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Fs("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.al(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Mc.prototype.al=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Ba(n))throw n;return this.L_=!0,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),this.wa.Ua(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","Retrying IndexedDB access"),[4,this.F_.ah()];case 1:return t.sent(),this.L_=!1,[4,this.J_()];case 2:return t.sent(),[2]}})})}),[2]}})})},Mc.prototype.ul=function(r){var i=this,t=this.M_.Xs(r);return t.as.forEach(function(t,e){var n;0<t.resumeToken.rt()&&((n=i.k_.get(e))&&i.k_.set(e,n.we(t.resumeToken,r)))}),t.us.forEach(function(t){var e,n=i.k_.get(t);n&&(i.k_.set(t,n.we(Jr.ht,n.Ee)),i.rl(t),e=new Ro(n.target,t,1,n.sequenceNumber),i.il(e))}),this.hl.Mu(t)},Mc.prototype.ol=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.k_.has(i)?[4,this.hl.cl(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.k_.delete(i),this.M_.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Mc.prototype.tl=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this._l()?(e=0<this.N_.length?this.N_[this.N_.length-1].batchId:-1,[4,this.F_.Bu(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.N_.length&&this.G_.Wc(),[3,4]);case 2:return this.ll(n),[4,this.tl()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.dl()&&this.fl(),[2]}})})},Mc.prototype._l=function(){return this.B_()&&this.N_.length<10},Mc.prototype.Tl=function(){return this.N_.length},Mc.prototype.ll=function(t){this.N_.push(t),this.G_.qc()&&this.G_.h_&&this.G_.o_(t.mutations)},Mc.prototype.dl=function(){return this.B_()&&!this.G_.Bc()&&0<this.N_.length},Mc.prototype.fl=function(){this.G_.start()},Mc.prototype.z_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.G_.c_(),[2]})})},Mc.prototype.Y_=function(){var r=this;return this.F_.Ho(this.G_.lastStreamToken).then(function(){for(var t=0,e=r.N_;t<e.length;t++){var n=e[t];r.G_.o_(n.mutations)}}).catch(vh)},Mc.prototype.a_=function(t,e){var n=this,r=this.N_.shift(),i=eu.from(r,t,e,this.G_.lastStreamToken);return this.hl.El(i).then(function(){return n.tl()})},Mc.prototype.H_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&0<this.N_.length?this.G_.h_?[4,this.Il(e)]:[3,2]:[3,5];case 1:return t.sent(),[3,4];case 2:return[4,this.wl(e)];case 3:t.sent(),t.label=4;case 4:this.dl()&&this.fl(),t.label=5;case 5:return[2]}})})},Mc.prototype.wl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Ho(e.code)?[2,(Fs("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.G_.lastStreamToken),this.G_.lastStreamToken=Jr.ht,this.F_.Ho(Jr.ht).catch(vh))]:[2]})})},Mc.prototype.Il=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Ho(n=i.code)&&n!==Nr.ABORTED?(e=this.N_.shift(),[2,(this.G_.Qc(),this.hl.Rl(e.batchId,i).then(function(){return r.tl()}))]):[2]})})},Mc.prototype.ml=function(){return new Pc(this.f_)},Mc.prototype.q_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Mc.prototype.Al=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.B_()?(Fs("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Mc.prototype.Pl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.el()];case 3:t.sent(),this.U_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Mc);function Mc(t,e,n,r,i){var o,s,u,a,h,c,f=this;this.F_=t,this.f_=e,this.wa=n,this.N_=[],this.k_=new Map,this.M_=null,this.networkEnabled=!1,this.isPrimary=!1,this.L_=!1,this.O_=i,this.O_.x_(function(t){n.oo(function(){return y(f,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.B_()?(Fs("RemoteStore","Restarting streams for network reachability change."),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.U_=new Lc(n,r),this.Q_=(a=this.f_,h=n,c={t_:this.W_.bind(this),Hc:this.j_.bind(this),s_:this.K_.bind(this)},new Oc(h,a.Mc,a.credentials,a.serializer,c)),this.G_=(o=this.f_,s=n,u={t_:this.z_.bind(this),Hc:this.H_.bind(this),u_:this.Y_.bind(this),a_:this.a_.bind(this)},new Rc(s,o.Mc,o.credentials,o.serializer,u))}function jc(t,e){this.wa=t,this.V_=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}function Uc(t){this.f_=t,this.T_=as,this.mutations=[],this.E_=!1,this.I_=null,this.w_=new Set}function qc(t,e,n){var r=this;return(r=Sc.call(this)||this).Mc=t,r.credentials=e,r.serializer=n,r}function Fc(t,e,n,r,i){var o=this;return(o=Dc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.r_=!1,o.lastStreamToken=Jr.ht,o}function Bc(t,e,n,r,i){var o=this;return(o=kc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Gc(t,e,n,r,i,o){this.Tr=t,this.kc=n,this.Mc=r,this.Lc=i,this.listener=o,this.state=0,this.Oc=0,this.xc=null,this.stream=null,this.Na=new bu(t,e)}function zc(t,e){return"firestore_clients_"+t+"_"+e}function Wc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function Qc(t,e){return"firestore_targets_"+t+"_"+e}function Hc(t){this.key=t}function Kc(t){this.key=t}function Yc(t,e,n){this.query=t,this.targetId=e,this.view=n}function Xc(t){this.key=t,this.Bd=!1}function $c(){this.Vf=void 0,this.gf=[]}var Jc,Zc,tf=(Rf.Vl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new _r(r.error.code,r.error.message)),i?new Rf(t,e,r.state,o):(Bs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Rf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Rf),ef=(Of.Vl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new _r(n.error.code,n.error.message)),r?new Of(t,n.state,i):(Bs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Of.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Of),nf=(xf.Vl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fs,o=0;r&&o<n.activeTargetIds.length;++o)r=ni(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new xf(t,i):(Bs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},xf),rf=(kf.Vl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new kf(e.clientId,e.onlineState):(Bs("SharedClientState","Failed to parse online state: "+t),null)},kf),of=(Df.prototype.pl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Df.prototype.yl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Df.prototype.gl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Df),sf=(Sf.jh=function(t){return!(!t.window||null==t.window.localStorage)},Sf.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.hl.po()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.bl&&(o=this.getItem(zc(this.persistenceKey,i)))&&(s=nf.Vl(i,o))&&(this.Dl=this.Dl.me(s.clientId,s));for(this.Ol(),(u=this.storage.getItem(this.Ll))&&(a=this.xl(u))&&this.Bl(a),h=0,c=this.Cl;h<c.length;h++)f=c[h],this.Sl(f);return this.Cl=[],this.platform.window.addEventListener("unload",function(){return l.Ro()}),this.io=!0,[2]}})})},Sf.prototype.lr=function(t){this.setItem(this.Nl,JSON.stringify(t))},Sf.prototype.ql=function(){return this.Ul(this.Dl)},Sf.prototype.Ql=function(n){var r=!1;return this.Dl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Sf.prototype.Wl=function(t){this.jl(t,"pending")},Sf.prototype.Kl=function(t,e,n){this.jl(t,e,n),this.Gl(t)},Sf.prototype.zl=function(t){var e,n,r="not-current";return this.Ql(t)&&(!(e=this.storage.getItem(Qc(this.persistenceKey,t)))||(n=ef.Vl(t,e))&&(r=n.state)),this.Hl.pl(t),this.Ol(),r},Sf.prototype.Yl=function(t){this.Hl.yl(t),this.Ol()},Sf.prototype.Jl=function(t){return this.Hl.activeTargetIds.has(t)},Sf.prototype.Xl=function(t){this.removeItem(Qc(this.persistenceKey,t))},Sf.prototype.Zl=function(t,e,n){this.td(t,e,n)},Sf.prototype.Su=function(t,e,n){var r=this;e.forEach(function(t){r.Gl(t)}),this.currentUser=t,n.forEach(function(t){r.Wl(t)})},Sf.prototype.ed=function(t){this.sd(t)},Sf.prototype.Ro=function(){this.io&&(this.platform.window.removeEventListener("storage",this.vl),this.removeItem(this.Fl),this.io=!1)},Sf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Fs("SharedClientState","READ",t,e),e},Sf.prototype.setItem=function(t,e){Fs("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Sf.prototype.removeItem=function(t){Fs("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Sf.prototype.Sl=function(u){var t=this;if(u.storageArea===this.storage){if(Fs("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Fl)return void Bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Tr.Ua(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.io){if(null!==u.key)if(this.$l.test(u.key)){if(null==u.newValue)return e=this.nd(u.key),[2,this.rd(e,null)];if(n=this.hd(u.key,u.newValue))return[2,this.rd(n.clientId,n)]}else if(this.kl.test(u.key)){if(null!==u.newValue&&(r=this.od(u.key,u.newValue)))return[2,this.ad(r)]}else if(this.Ml.test(u.key)){if(null!==u.newValue&&(i=this.ud(u.key,u.newValue)))return[2,this._d(i)]}else if(u.key===this.Ll){if(null!==u.newValue&&(o=this.xl(u.newValue)))return[2,this.Bl(o)]}else u.key===this.Nl&&(s=function(t){var e=au.dr;if(null!=t)try{var n=JSON.parse(t);Ws("number"==typeof n),e=n}catch(t){Bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==au.dr&&this.ur(s)}else this.Cl.push(u);return[2]})})})}},Object.defineProperty(Sf.prototype,"Hl",{get:function(){return this.Dl.get(this.bl)},enumerable:!0,configurable:!0}),Sf.prototype.Ol=function(){this.setItem(this.Fl,this.Hl.gl())},Sf.prototype.jl=function(t,e,n){var r=new tf(this.currentUser,t,e,n),i=Wc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gl())},Sf.prototype.Gl=function(t){var e=Wc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Sf.prototype.sd=function(t){var e={clientId:this.bl,onlineState:t};this.storage.setItem(this.Ll,JSON.stringify(e))},Sf.prototype.td=function(t,e,n){var r=Qc(this.persistenceKey,t),i=new ef(t,e,n);this.setItem(r,i.gl())},Sf.prototype.nd=function(t){var e=this.$l.exec(t);return e?e[1]:null},Sf.prototype.hd=function(t,e){var n=this.nd(t);return nf.Vl(n,e)},Sf.prototype.od=function(t,e){var n=this.kl.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return tf.Vl(new wr(i),r,e)},Sf.prototype.ud=function(t,e){var n=this.Ml.exec(t),r=Number(n[1]);return ef.Vl(r,e)},Sf.prototype.xl=function(t){return rf.Vl(t)},Sf.prototype.ad=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.hl.ld(e.batchId,e.state,e.error)]:(Fs("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Sf.prototype._d=function(t){return this.hl.dd(t.targetId,t.state,t.error)},Sf.prototype.rd=function(t,e){var n=this,r=e?this.Dl.me(t,e):this.Dl.remove(t),i=this.Ul(this.Dl),o=this.Ul(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.hl.fd(s,u).then(function(){n.Dl=r})},Sf.prototype.Bl=function(t){this.Dl.get(t.clientId)&&this.V_(t.onlineState)},Sf.prototype.Ul=function(t){var n=fs;return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},Sf),uf=(Af.prototype.Wl=function(t){},Af.prototype.Kl=function(t,e,n){},Af.prototype.zl=function(t){return this.Td.pl(t),this.Ed[t]||"not-current"},Af.prototype.Zl=function(t,e,n){this.Ed[t]=e},Af.prototype.Yl=function(t){this.Td.yl(t)},Af.prototype.Jl=function(t){return this.Td.activeTargetIds.has(t)},Af.prototype.Xl=function(t){delete this.Ed[t]},Af.prototype.ql=function(){return this.Td.activeTargetIds},Af.prototype.Ql=function(t){return this.Td.activeTargetIds.has(t)},Af.prototype.start=function(){return this.Td=new of,Promise.resolve()},Af.prototype.Su=function(t,e,n){},Af.prototype.ed=function(t){},Af.prototype.Ro=function(){},Af.prototype.lr=function(t){},Af),af=(Object.defineProperty(_f.prototype,"Ad",{get:function(){return this.Id},enumerable:!0,configurable:!0}),_f.prototype.Pd=function(t,e){var u=this,a=e?e.Vd:new vs,h=e?e.md:this.md,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=(r=e instanceof wo?e:null)&&(u.query.matches(r)?r:null),i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.gd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{md:f,Vd:a,pd:l,ns:c}},_f.prototype.gd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},_f.prototype.xn=function(t,e,n){var o=this,r=this.md;this.md=t.md,this.ns=t.ns;var i=t.Vd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zs()}}var r,i}),this.yd(n);var s=e?this.bd():[],u=0===this.Rd.size&&this.fs?1:0,a=u!==this.wd;return this.wd=u,0!==i.length||a?{snapshot:new ms(this.query,t.md,r,i,t.ns,0==u,a,!1),vd:s}:{vd:s}},_f.prototype.Sd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.xn({md:this.md,Vd:new vs,ns:this.ns,pd:!1},!1)):{vd:[]}},_f.prototype.Dd=function(t){return!this.Id.has(t)&&!!this.md.has(t)&&!this.md.get(t).At},_f.prototype.yd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.Id=e.Id.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.Id=e.Id.delete(t)}),this.fs=t.fs)},_f.prototype.bd=function(){var e=this;if(!this.fs)return[];var n=this.Rd;this.Rd=cs(),this.md.forEach(function(t){e.Dd(t.key)&&(e.Rd=e.Rd.add(t.key))});var r=[];return n.forEach(function(t){e.Rd.has(t)||r.push(new Kc(t))}),this.Rd.forEach(function(t){n.has(t)||r.push(new Hc(t))}),r},_f.prototype.Cd=function(t){this.Id=t.ju,this.Rd=cs();var e=this.Pd(t.documents);return this.xn(e,!0)},_f.prototype.Fd=function(){return ms.os(this.query,this.md,this.ns,0===this.wd)},_f),hf=(Nf.prototype.kd=function(){this.Md()},Nf.prototype.Md=function(){var t=this;this.Na.gr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.Nd.ml(),(n=this.Ld(e))&&n.then(function(t){r.wa.oo(function(){return e.commit().then(function(){r.Aa.resolve(t)}).catch(function(t){r.Od(t)})})}).catch(function(t){r.Od(t)}),[2]})})})},Nf.prototype.Ld=function(t){try{var e=this.updateFunction(t);return!ti(e)&&e.catch&&e.then?e:(this.Aa.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Aa.reject(t),null}},Nf.prototype.Od=function(t){var e=this;0<this.$d&&this.xd(t)?(--this.$d,this.wa.oo(function(){return e.Md(),Promise.resolve()})):this.Aa.reject(t)},Nf.prototype.xd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ho(e)},Nf),cf=(Object.defineProperty(If.prototype,"Zd",{get:function(){return!0},enumerable:!0,configurable:!0}),If.prototype.subscribe=function(t){this.Qd=t},If.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.tf("listen()"),(r=this.Wd.get(s))?(e=r.targetId,this.qd.zl(e),n=r.view.Fd(),[3,4]):[3,1];case 1:return[4,this.F_.Uu(s.ee())];case 2:return i=t.sent(),o=this.qd.zl(i.targetId),e=i.targetId,[4,this.ef(s,e,"current"===o)];case 3:n=t.sent(),this.Zd&&this.Nd.listen(i),t.label=4;case 4:return[2,n]}})})},If.prototype.ef=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(u,!0)];case 1:return e=t.sent(),n=new af(u,e.ju),r=n.Pd(e.documents),i=ws.ds(a,h&&"Offline"!==this.onlineState),o=n.xn(r,this.Zd,i),this.sf(a,o.vd),s=new Yc(u,a,n),[2,(this.Wd.set(u,s),this.jd.has(a)?this.jd.get(a).push(u):this.jd.set(a,[u]),o.snapshot)]}})})},If.prototype.nl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.tf("unlisten()"),e=this.Wd.get(i),1<(n=this.jd.get(e.targetId)).length?[2,(this.jd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.Wd.delete(i))]:this.Zd?(this.qd.Yl(e.targetId),this.qd.Ql(e.targetId)?[3,2]:[4,this.F_.Qu(e.targetId,!1).then(function(){r.qd.Xl(e.targetId),r.Nd.nl(e.targetId),r.if(e.targetId)}).catch(vh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.if(e.targetId),[4,this.F_.Qu(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},If.prototype.write=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:this.tf("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.F_.Nu(i)];case 2:return e=t.sent(),this.qd.Wl(e.batchId),this.nf(e.batchId,o),[4,this.rf(e.Dn)];case 3:return t.sent(),[4,this.Nd.tl()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=th(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},If.prototype.runTransaction=function(t,e,n){new hf(t,this.Nd,e,n).kd()},If.prototype.Mu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.tf("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.Mu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.zd.get(e);n&&(Ws(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.Bd=!0:0<t.Es.size?Ws(n.Bd):0<t.Is.size&&(Ws(n.Bd),n.Bd=!1))}),[4,this.rf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,vh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},If.prototype.Sd=function(r,t){this.tf("applyOnlineStateChange()");var i=[];this.Wd.forEach(function(t,e){var n=e.view.Sd(r);n.snapshot&&i.push(n.snapshot)}),this.Qd.hf(r),this.Qd.s_(i),this.onlineState=r},If.prototype.cl=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.tf("rejectListens()"),this.qd.Zl(u,"rejected",a),e=this.zd.get(u),(n=e&&e.key)?(r=(r=new Yo(Hr.N)).me(n,new bo(n,Or.min())),i=cs().add(n),o=new gs(Or.min(),new Map,new ns(Ks),r,i),[4,this.Mu(o)]):[3,2];case 1:return t.sent(),this.Gd=this.Gd.remove(n),this.zd.delete(u),this.af(),[3,4];case 2:return[4,this.F_.Qu(u,!1).then(function(){return s.if(u,a)}).catch(vh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},If.prototype.El=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.tf("applySuccessfulWrite()"),e=r.batch.batchId,this.uf(e,null),this.cf(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.Ko(r)];case 2:return n=t.sent(),this.qd.Kl(e,"acknowledged"),[4,this.rf(n)];case 3:return t.sent(),[3,6];case 4:return[4,vh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},If.prototype.Rl=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.tf("rejectFailedWrite()"),this.uf(n,r),this.cf(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.ku(n)];case 2:return e=t.sent(),this.qd.Kl(n,"rejected",r),[4,this.rf(e)];case 3:return t.sent(),[3,6];case 4:return[4,vh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},If.prototype._f=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:this.Nd.B_()||Fs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.F_.ta()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.Jd.get(e)||[]).push(o),this.Jd.set(e,n),[3,4]);case 3:return r=t.sent(),i=th(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},If.prototype.cf=function(t){(this.Jd.get(t)||[]).forEach(function(t){t.resolve()}),this.Jd.delete(t)},If.prototype.lf=function(e){this.Jd.forEach(function(t){t.forEach(function(t){t.reject(new _r(Nr.CANCELLED,e))})}),this.Jd.clear()},If.prototype.nf=function(t,e){var n=(n=(n=this.Yd[this.currentUser.s()])||new Yo(Ks)).me(t,e);this.Yd[this.currentUser.s()]=n},If.prototype.uf=function(t,e){var n,r=this.Yd[this.currentUser.s()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.Yd[this.currentUser.s()]=r)},If.prototype.if=function(t,e){var n=this;void 0===e&&(e=null),this.qd.Yl(t);for(var r=0,i=this.jd.get(t);r<i.length;r++){var o=i[r];this.Wd.delete(o),e&&this.Qd.df(o,e)}this.jd.delete(t),this.Zd&&this.Hd.ic(t).forEach(function(t){n.Hd.Dh(t)||n.ff(t)})},If.prototype.ff=function(t){var e=this.Gd.get(t);null!==e&&(this.Nd.nl(e),this.Gd=this.Gd.remove(t),this.zd.delete(e),this.af())},If.prototype.sf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Hc?(this.Hd.ph(i.key,t),this.Tf(i)):i instanceof Kc?(Fs("SyncEngine","Document no longer in limbo: "+i.key),this.Hd.bh(i.key,t),this.Hd.Dh(i.key)||this.ff(i.key)):zs()}},If.prototype.Tf=function(t){var e=t.key;this.Gd.get(e)||(Fs("SyncEngine","New document in limbo: "+e),this.Kd.push(e),this.af())},If.prototype.af=function(){for(;0<this.Kd.length&&this.Gd.size<this.Ud;){var t=this.Kd.shift(),e=this.Xd.next();this.zd.set(e,new Xc(t)),this.Gd=this.Gd.me(t,e),this.Nd.listen(new Ro(Io.Wt(t.path).ee(),e,2,au.dr))}},If.prototype.Ef=function(){return this.Gd},If.prototype.If=function(){return this.Kd},If.prototype.rf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Wd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Pd(r);return n.pd?u.F_.Wu(i.query,!1).then(function(t){var e=t.documents;return i.view.Pd(e,n)}):n}).then(function(t){var e,n=a&&a.as.get(i.targetId),r=i.view.xn(t,u.Zd,n);u.sf(i.targetId,r.vd),r.snapshot&&(u.Zd&&u.qd.Zl(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=uu.ar(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Qd.s_(o),[4,this.F_.xu(s)];case 2:return t.sent(),[2]}})})},If.prototype.tf=function(t){},If.prototype.Al=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.lf("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.F_.Su(r)]):[3,3];case 1:return n=t.sent(),this.qd.Su(r,n.Cu,n.Fu),[4,this.rf(n.Du)];case 2:t.sent(),t.label=3;case 3:return[4,this.Nd.Al()];case 4:return t.sent(),[2]}})})},If.prototype.enableNetwork=function(){return this.Nd.enableNetwork()},If.prototype.disableNetwork=function(){return this.Nd.disableNetwork()},If.prototype.ei=function(t){var e=this.zd.get(t);if(e&&e.Bd)return cs().add(e.key);var n=cs(),r=this.jd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.Wd.get(s),n=n.He(u.view.Ad);return n},If),ff=(n(Tf,Jc=cf),Object.defineProperty(Tf.prototype,"Zd",{get:function(){return!0===this.wf},enumerable:!0,configurable:!0}),Tf.prototype.enableNetwork=function(){return this.F_.ho(!0),Jc.prototype.enableNetwork.call(this)},Tf.prototype.disableNetwork=function(){return this.F_.ho(!1),Jc.prototype.disableNetwork.call(this)},Tf.prototype.Rf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(r.query,!0)];case 1:return e=t.sent(),n=r.view.Cd(e),[2,(this.wf&&this.sf(r.targetId,n.vd),n)]}})})},Tf.prototype.Sd=function(t,e){this.Zd&&0===e&&(Jc.prototype.Sd.call(this,t,e),this.qd.ed(t)),this.Zd||1!==e||Jc.prototype.Sd.call(this,t,e)},Tf.prototype.ld=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.tf("applyBatchState()"),[4,this.F_.Gu(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Nd.tl()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.uf(n,i||null),this.F_.zu(n)):zs(),t.label=4;case 4:return[4,this.rf(e)];case 5:return t.sent(),[3,7];case 6:Fs("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},Tf.prototype.Pl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.wf?[3,3]:(e=this.qd.ql(),[4,this.mf(e.W(),!0)]);case 1:return n=t.sent(),this.wf=!0,[4,this.Nd.Pl(!0)];case 2:for(t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Nd.listen(o);return[3,7];case 3:return!1!==h||!1===this.wf?[3,7]:(s=[],u=Promise.resolve(),this.jd.forEach(function(t,e){a.qd.Jl(e)?s.push(e):u=u.then(function(){return a.if(e),a.F_.Qu(e,!0)}),a.Nd.nl(e)}),[4,u]);case 4:return t.sent(),[4,this.mf(s,!1)];case 5:return t.sent(),this.Af(),this.wf=!1,[4,this.Nd.Pl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Tf.prototype.Af=function(){var n=this;this.zd.forEach(function(t,e){n.Nd.nl(e)}),this.Hd.nc(),this.zd=new Map,this.Gd=new Yo(Hr.N)},Tf.prototype.mf=function(d,t){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.jd.get(o))&&0!==u.length?[4,this.F_.Qu(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.F_.Uu(u[0].ee())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.Wd.get(c),[4,this.Rf(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.F_.Hu(o)];case 9:return p=t.sent(),[4,this.F_.Uu(p)];case 10:return s=t.sent(),[4,this.ef(this.Pf(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Qd.s_(n),e)]}})})},Tf.prototype.Pf=function(t){return new Io(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Tf.prototype.po=function(){return this.F_.po()},Tf.prototype.dd=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.wf?(Fs("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.jd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.F_.Wr()];case 3:return e=t.sent(),n=gs.ls(r,"current"===i),[4,this.rf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.F_.Qu(r,!0)];case 6:return t.sent(),this.if(r,o),[3,8];case 7:zs(),t.label=8;case 8:return[2]}})})},Tf.prototype.fd=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.wf)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.jd.has(r)?(Fs("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.F_.Hu(r)]):[3,6];case 2:return i=t.sent(),[4,this.F_.Uu(i)];case 3:return o=t.sent(),[4,this.ef(this.Pf(i),o.targetId,!1)];case 4:t.sent(),this.Nd.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.jd.has(e)?[4,u.F_.Qu(e,!1).then(function(){f.Nd.nl(e),f.if(e)}).catch(vh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Tf),lf=(Ef.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.pf.get(e))||(n=!0,r=new $c),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.hl.listen(e)];case 2:return i.Vf=t.sent(),[3,4];case 3:return o=t.sent(),s=th(o,"Initialization of query '"+u.query+"' failed"),[2,void u.onError(s)];case 4:return this.pf.set(e,r),r.gf.push(u),u.Sd(this.onlineState),r.Vf&&u.bf(r.Vf)&&this.vf(),[2]}})})},Ef.prototype.nl=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.pf.get(e))&&0<=(i=r.gf.indexOf(o))&&(r.gf.splice(i,1),n=0===r.gf.length),n?[2,(this.pf.delete(e),this.hl.nl(e))]:[2]})})},Ef.prototype.s_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.pf.get(o);if(s){for(var u=0,a=s.gf;u<a.length;u++)a[u].bf(i)&&(e=!0);s.Vf=i}}e&&this.vf()},Ef.prototype.df=function(t,e){var n=this.pf.get(t);if(n)for(var r=0,i=n.gf;r<i.length;r++)i[r].onError(e);this.pf.delete(t)},Ef.prototype.hf=function(i){this.onlineState=i;var o=!1;this.pf.forEach(function(t,e){for(var n=0,r=e.gf;n<r.length;n++)r[n].Sd(i)&&(o=!0)}),o&&this.vf()},Ef.prototype.Sf=function(t){this.yf.add(t),t.next()},Ef.prototype.Df=function(t){this.yf.delete(t)},Ef.prototype.vf=function(){this.yf.forEach(function(t){t.next()})},Ef),pf=(bf.prototype.bf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ms(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.Ff?this.$f(t)&&(this.Cf.next(t),o=!0):this.kf(t,this.onlineState)&&(this.Mf(t),o=!0),this.Nf=t,o},bf.prototype.onError=function(t){this.Cf.error(t)},bf.prototype.Sd=function(t){this.onlineState=t;var e=!1;return this.Nf&&!this.Ff&&this.kf(this.Nf,t)&&(this.Mf(this.Nf),e=!0),e},bf.prototype.kf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Lf&&n||t.docs.B()&&"Offline"!==e)},bf.prototype.$f=function(t){if(0<t.docChanges.length)return!0;var e=this.Nf&&this.Nf.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},bf.prototype.Mf=function(t){t=ms.os(t.query,t.docs,t.ns,t.fromCache),this.Ff=!0,this.Cf.next(t)},bf),df=(wf.prototype.vu=function(t){this.Of=t},wf.prototype.Zn=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Or.min())?this.xf(e,r):this.Of.Yn(e,o).next(function(t){var n=s.Bf(r,t);return(r.oe()||r.ae())&&s.pd(r.Bt,n,o,i)?s.xf(e,r):(Us()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Of.Zn(e,r,i).next(function(e){return n.forEach(function(t){e=e.me(t.key,t)}),e}))})},wf.prototype.Bf=function(n,t){var r=new ns(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof wo&&n.matches(e)&&(r=r.add(e))}),r},wf.prototype.pd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},wf.prototype.xf=function(t,e){return Us()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Of.Zn(t,e,Or.min())},wf),yf=(gf.prototype.jo=function(t){return nu.resolve(0===this.Wn.length)},gf.prototype.Ko=function(t,e,n){var r=e.batchId,i=this.Qf(r,"acknowledged");return Ws(0===i),this.Wn[i],this.lastStreamToken=n,nu.resolve()},gf.prototype.zo=function(t){return nu.resolve(this.lastStreamToken)},gf.prototype.Ho=function(t,e){return this.lastStreamToken=e,nu.resolve()},gf.prototype.Yo=function(t,e,n,r){var i=this.qf;this.qf++,0<this.Wn.length&&this.Wn[this.Wn.length-1];var o=new tu(i,e,n,r);this.Wn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Uf=this.Uf.add(new gh(a.key,i)),this.jn.vr(t,a.key.path.M())}return nu.resolve(o)},gf.prototype.Jo=function(t,e){return nu.resolve(this.Wf(e))},gf.prototype.Zo=function(t,e){var n=e+1,r=this.jf(n),i=r<0?0:r;return nu.resolve(this.Wn.length>i?this.Wn[i]:null)},gf.prototype.ta=function(){return nu.resolve(0===this.Wn.length?-1:this.qf-1)},gf.prototype.ea=function(t){return nu.resolve(this.Wn.slice())},gf.prototype.Gn=function(t,e){var n=this,r=new gh(e,0),i=new gh(e,Number.POSITIVE_INFINITY),o=[];return this.Uf.Ke([r,i],function(t){var e=n.Wf(t.hc);o.push(e)}),nu.resolve(o)},gf.prototype.Xn=function(t,e){var r=this,i=new ns(Ks);return e.forEach(function(t){var e=new gh(t,0),n=new gh(t,Number.POSITIVE_INFINITY);r.Uf.Ke([e,n],function(t){i=i.add(t.hc)})}),nu.resolve(this.Kf(i))},gf.prototype.nr=function(t,e){var n=e.path,r=n.length+1,i=n;Hr.et(i)||(i=i.child(""));var o=new gh(new Hr(i),0),s=new ns(Ks);return this.Uf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.hc)),!0)},o),nu.resolve(this.Kf(s))},gf.prototype.Kf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Wf(t);null!==e&&r.push(e)}),r},gf.prototype.ia=function(n,r){var i=this;Ws(0===this.Qf(r.batchId,"removed")),this.Wn.shift();var o=this.Uf;return nu.forEach(r.mutations,function(t){var e=new gh(t.key,r.batchId);return o=o.delete(e),i.nh.Oo(n,t.key)}).next(function(){i.Uf=o})},gf.prototype.na=function(t){},gf.prototype.Dh=function(t,e){var n=new gh(e,0),r=this.Uf.ze(n);return nu.resolve(e.isEqual(r&&r.key))},gf.prototype.ra=function(t){return this.Wn.length,nu.resolve()},gf.prototype.Qf=function(t,e){return this.jf(t)},gf.prototype.jf=function(t){return 0===this.Wn.length?0:t-this.Wn[0].batchId},gf.prototype.Wf=function(t){var e=this.jf(t);return e<0||e>=this.Wn.length?null:this.Wn[e]},gf),vf=(mf.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Gf(e);return this.docs=this.docs.me(r,{kr:e,size:s,readTime:n}),this.size+=s-o,this.jn.vr(t,r.path.M())},mf.prototype.kn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},mf.prototype.Mn=function(t,e){var n=this.docs.get(e);return nu.resolve(n?n.kr:null)},mf.prototype.getEntries=function(t,e){var n=this,r=is;return e.forEach(function(t){var e=n.docs.get(t);r=r.me(t,e?e.kr:null)}),nu.resolve(r)},mf.prototype.Zn=function(t,e,n){for(var r=us,i=new Hr(e.path.child("")),o=this.docs.ve(i);o.$e();){var s=o.Ne(),u=s.key,a=s.value,h=a.kr,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof wo&&e.matches(h)&&(r=r.me(h.key,h))}return nu.resolve(r)},mf.prototype.zf=function(t,e){return nu.forEach(this.docs,function(t){return e(t)})},mf.prototype.zr=function(t){return new mf.Hr(this)},mf.prototype.Jr=function(t){return nu.resolve(this.size)},mf);function mf(t,e){this.jn=t,this.Gf=e,this.docs=new Yo(Hr.N),this.size=0}function gf(t,e){this.jn=t,this.nh=e,this.Wn=[],this.qf=1,this.lastStreamToken=Jr.ht,this.Uf=new ns(gh.Ju)}function wf(){}function bf(t,e,n){this.query=t,this.Cf=e,this.Ff=!1,this.Nf=null,this.onlineState="Unknown",this.options=n||{}}function Ef(t){this.hl=t,this.pf=new Zs(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.yf=new Set,this.hl.subscribe(this)}function Tf(t,e,n,r,i){var o=this;return(o=Jc.call(this,t,e,n,r,i)||this).F_=t,o.wf=void 0,o}function If(t,e,n,r,i){this.F_=t,this.Nd=e,this.qd=n,this.currentUser=r,this.Ud=i,this.Qd=null,this.Wd=new Zs(function(t){return t.canonicalId()}),this.jd=new Map,this.Kd=[],this.Gd=new Yo(Hr.N),this.zd=new Map,this.Hd=new mh,this.Yd={},this.Jd=new Map,this.Xd=Fu.ih(),this.onlineState="Unknown"}function Nf(t,e,n,r){this.wa=t,this.Nd=e,this.updateFunction=n,this.Aa=r,this.$d=5,this.Na=new bu(this.wa,"transaction_retry")}function _f(t,e){this.query=t,this.Id=e,this.wd=null,this.fs=!1,this.Rd=cs(),this.ns=cs(),this.md=new ys(t.se.bind(t))}function Af(){this.Td=new of,this.Ed={},this.hl=null,this.V_=null,this.ur=null}function Sf(t,e,n,r,i){if(this.Tr=t,this.platform=e,this.persistenceKey=n,this.bl=r,this.hl=null,this.V_=null,this.ur=null,this.vl=this.Sl.bind(this),this.Dl=new Yo(Ks),this.io=!1,this.Cl=[],!Sf.jh(this.platform))throw new _r(Nr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Fl=zc(this.persistenceKey,this.bl),this.Nl="firestore_sequence_number_"+this.persistenceKey,this.Dl=this.Dl.me(this.bl,new of),this.$l=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.kl=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ml=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Ll="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.vl)}function Df(){this.activeTargetIds=fs}function kf(t,e){this.clientId=t,this.onlineState=e}function xf(t,e){this.clientId=t,this.activeTargetIds=e}function Of(t,e,n){this.targetId=t,this.state=e,this.error=n}function Rf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Vf(t){var e=this;return(e=Zc.call(this)||this).Xr=t,e}vf.Hr=(n(Vf,Zc=ru),Vf.prototype.xn=function(n){var r=this,i=[];return this.Dn.forEach(function(t,e){e?i.push(r.Xr.Nn(n,e,r.readTime)):r.Xr.kn(t)}),nu.vn(i)},Vf.prototype.Ln=function(t,e){return this.Xr.Mn(t,e)},Vf.prototype.On=function(t,e){return this.Xr.getEntries(t,e)},Vf);var Pf,Lf,Cf=($f.prototype.js=function(t,n){return this.Hf.forEach(function(t,e){return n(e)}),nu.resolve()},$f.prototype.ah=function(t){return nu.resolve(this.lastRemoteSnapshotVersion)},$f.prototype.uh=function(t){return nu.resolve(this.Yf)},$f.prototype.rh=function(t){return this.highestTargetId=this.Xf.next(),nu.resolve(this.highestTargetId)},$f.prototype.lh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Yf&&(this.Yf=e),nu.resolve()},$f.prototype.fh=function(t){this.Hf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Xf=new Fu(e),this.highestTargetId=e),t.sequenceNumber>this.Yf&&(this.Yf=t.sequenceNumber)},$f.prototype.dh=function(t,e){return this.fh(e),this.targetCount+=1,nu.resolve()},$f.prototype.Eh=function(t,e){return this.fh(e),nu.resolve()},$f.prototype.Ih=function(t,e){return this.Hf.delete(e.target),this.Jf.ic(e.targetId),--this.targetCount,nu.resolve()},$f.prototype.Rh=function(n,r,i){var o=this,s=0,u=[];return this.Hf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Hf.delete(t),u.push(o.wh(n,e.targetId)),s++)}),nu.vn(u).next(function(){return s})},$f.prototype.Ph=function(t){return nu.resolve(this.targetCount)},$f.prototype.Vh=function(t,e){var n=this.Hf.get(e)||null;return nu.resolve(n)},$f.prototype.gh=function(t,e,n){return this.Jf.tc(e,n),nu.resolve()},$f.prototype.yh=function(e,t,n){this.Jf.sc(t,n);var r=this.persistence.nh,i=[];return r&&t.forEach(function(t){i.push(r.Oo(e,t))}),nu.vn(i)},$f.prototype.wh=function(t,e){return this.Jf.ic(e),nu.resolve()},$f.prototype.vh=function(t,e){var n=this.Jf.rc(e);return nu.resolve(n)},$f.prototype.Dh=function(t,e){return nu.resolve(this.Jf.Dh(e))},$f),Mf=(Xf.prototype.start=function(){return Promise.resolve()},Xf.prototype.Ro=function(){return this.xh=!1,Promise.resolve()},Object.defineProperty(Xf.prototype,"io",{get:function(){return this.xh},enumerable:!0,configurable:!0}),Xf.prototype.no=function(){},Xf.prototype.Do=function(){return this.jn},Xf.prototype.yo=function(t){var e=this.Zf[t.s()];return e||(e=new yf(this.jn,this.nh),this.Zf[t.s()]=e),e},Xf.prototype.vo=function(){return this.zh},Xf.prototype.So=function(){return this.Qn},Xf.prototype.runTransaction=function(t,e,n){var r=this;Fs("MemoryPersistence","Starting transaction:",t);var i=new jf(this.Oh.next());return this.nh.eT(),n(i).next(function(t){return r.nh.sT(i).next(function(){return t})}).yn().then(function(t){return i.Un(),t})},Xf.prototype.iT=function(e,n){return nu.Sn(Object.values(this.Zf).map(function(t){return function(){return t.Dh(e,n)}}))},Xf),jf=(n(Yf,Lf=ou),Yf),Uf=(Kf.hT=function(t){return new Kf(t)},Object.defineProperty(Kf.prototype,"oT",{get:function(){if(this.rT)return this.rT;throw zs()},enumerable:!0,configurable:!0}),Kf.prototype.ph=function(t,e,n){return this.nT.ph(n,e),this.oT.delete(n),nu.resolve()},Kf.prototype.bh=function(t,e,n){return this.nT.bh(n,e),this.oT.add(n),nu.resolve()},Kf.prototype.Oo=function(t,e){return this.oT.add(e),nu.resolve()},Kf.prototype.removeTarget=function(t,e){var n=this;this.nT.ic(e.targetId).forEach(function(t){return n.oT.add(t)});var r=this.persistence.vo();return r.vh(t,e.targetId).next(function(t){t.forEach(function(t){return n.oT.add(t)})}).next(function(){return r.Ih(t,e)})},Kf.prototype.eT=function(){this.rT=new Set},Kf.prototype.sT=function(t){var n=this,r=this.persistence.So().zr();return nu.forEach(this.oT,function(e){return n.aT(t,e).next(function(t){t||r.kn(e)})}).next(function(){return n.rT=null,r.apply(t)})},Kf.prototype.Uo=function(t,e){var n=this;return this.aT(t,e).next(function(t){t?n.oT.delete(e):n.oT.add(e)})},Kf.prototype.tT=function(t){return 0},Kf.prototype.aT=function(t,e){var n=this;return nu.Sn([function(){return nu.resolve(n.nT.Dh(e))},function(){return n.persistence.vo().Dh(t,e)},function(){return n.persistence.iT(t,e)}])},Kf),qf=(Hf.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.qd=this.uT(n),this.persistence=this.cT(n),[4,this.persistence.start()];case 1:return t.sent(),this._T=this.lT(n),this.F_=this.dT(n),this.Nd=this.fT(n),this.hl=this.TT(n),this.ET=this.IT(n),this.qd.V_=function(t){return e.hl.Sd(t,1)},this.Nd.hl=this.hl,[4,this.F_.start()];case 2:return t.sent(),[4,this.qd.start()];case 3:return t.sent(),[4,this.Nd.start()];case 4:return t.sent(),[4,this.Nd.Pl(this.hl.Zd)];case 5:return t.sent(),[2]}})})},Hf.prototype.IT=function(t){return new lf(this.hl)},Hf.prototype.lT=function(t){return null},Hf.prototype.dT=function(t){return new hh(this.persistence,new df,t.wT)},Hf.prototype.cT=function(t){return new Mf(Uf.hT)},Hf.prototype.fT=function(t){var e=this;return new Cc(this.F_,t.f_,t.wa,function(t){return e.hl.Sd(t,0)},t.platform.RT())},Hf.prototype.uT=function(t){return new uf},Hf.prototype.TT=function(t){return new cf(this.F_,this.Nd,this.qd,t.wT,t.Ud)},Hf.prototype.clearPersistence=function(t){throw new _r(Nr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},Hf),Ff=(n(Qf,Pf=qf),Qf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Pf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.so(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.hl.Pl(e)];case 1:return t.sent(),this._T&&(e&&!this._T.io?this._T.start(this.F_):e||this._T.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},Qf.prototype.dT=function(t){return new dh(this.persistence,new df,t.wT)},Qf.prototype.TT=function(t){var e=new ff(this.F_,this.Nd,this.qd,t.wT,t.Ud);return this.qd instanceof sf&&(this.qd.hl=e),e},Qf.prototype.lT=function(t){var e=this.persistence.nh.No;return new uh(e,t.wa)},Qf.prototype.cT=function(t){var e=Zu.Fo(t.mT),n=t.platform.yc(t.mT.ii);return new Zu(t.AT.synchronizeTabs,e,t.clientId,t.platform,ih.ru(t.AT.cacheSizeBytes),t.wa,n,this.qd)},Qf.prototype.uT=function(t){if(t.AT.PT&&t.AT.synchronizeTabs){if(!sf.jh(t.platform))throw new _r(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=Zu.Fo(t.mT);return new sf(t.wa,t.platform,e,t.clientId,t.wT)}return new uf},Qf.prototype.clearPersistence=function(t){var e=Zu.Fo(t);return Zu.clearPersistence(e)},Qf),Bf=(Wf.prototype.start=function(e,n){var r=this;this.VT();var i=new wu,o=new wu,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,Fs("FirestoreClient","Initializing. user=",t.uid),r.gT(e,n,t,o).then(i.resolve,i.reject);r.wa.oo(function(){return r.Al(t)})}),this.wa.oo(function(){return i.promise}),o.promise},Wf.prototype.enableNetwork=function(){var t=this;return this.VT(),this.wa.enqueue(function(){return t.hl.enableNetwork()})},Wf.prototype.gT=function(u,a,h,c){return y(this,void 0,void 0,function(){var n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.pT(this.mT)];case 1:return n=t.sent(),r=this.platform.yc(this.mT.ii),e=this.credentials,i=new Vc(n,e,r),[4,u.initialize({wa:this.wa,mT:this.mT,platform:this.platform,f_:i,clientId:this.clientId,wT:h,Ud:100,AT:a})];case 2:return t.sent(),this.persistence=u.persistence,this.qd=u.qd,this.F_=u.F_,this.Nd=u.Nd,this.hl=u.hl,this._T=u._T,this.yT=u.ET,this.persistence.no(function(){return y(s,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),c.resolve(),[3,4];case 3:if(o=t.sent(),c.reject(o),!this.bT(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.gT(new qf,{PT:!1},h,c))];case 4:return[2]}var e})})},Wf.prototype.bT=function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Wf.prototype.VT=function(){if(this.wa.Ma)throw new _r(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},Wf.prototype.Al=function(t){return this.wa.Wa(),Fs("FirestoreClient","Credential Changed. Current user: "+t.uid),this.hl.Al(t)},Wf.prototype.disableNetwork=function(){var t=this;return this.VT(),this.wa.enqueue(function(){return t.hl.disableNetwork()})},Wf.prototype.terminate=function(){var t=this;return this.wa.qa(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._T&&this._T.stop(),[4,this.Nd.Ro()];case 1:return t.sent(),[4,this.qd.Ro()];case 2:return t.sent(),[4,this.persistence.Ro()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},Wf.prototype.waitForPendingWrites=function(){var t=this;this.VT();var e=new wu;return this.wa.oo(function(){return t.hl._f(e)}),e.promise},Wf.prototype.listen=function(t,e,n){var r=this;this.VT();var i=new pf(t,e,n);return this.wa.oo(function(){return r.yT.listen(i)}),i},Wf.prototype.nl=function(t){var e=this;this.vT||this.wa.oo(function(){return e.yT.nl(t)})},Wf.prototype.ST=function(o){return y(this,void 0,void 0,function(){var i,e=this;return v(this,function(t){switch(t.label){case 0:return this.VT(),i=new wu,[4,this.wa.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.F_.qu(o)];case 1:return(e=t.sent())instanceof wo?i.resolve(e):e instanceof bo?i.resolve(null):i.reject(new _r(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=th(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},Wf.prototype.DT=function(a){return y(this,void 0,void 0,function(){var u,e=this;return v(this,function(t){switch(t.label){case 0:return this.VT(),u=new wu,[4,this.wa.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.F_.Wu(a,!0)];case 1:return e=t.sent(),n=new af(a,e.ju),r=n.Pd(e.documents),i=n.xn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=th(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},Wf.prototype.write=function(t){var e=this;this.VT();var n=new wu;return this.wa.oo(function(){return e.hl.write(t,n)}),n.promise},Wf.prototype.ii=function(){return this.mT.ii},Wf.prototype.Sf=function(t){var e=this;this.VT(),this.wa.oo(function(){return e.yT.Sf(t),Promise.resolve()})},Wf.prototype.Df=function(t){var e=this;this.vT||this.wa.oo(function(){return e.yT.Df(t),Promise.resolve()})},Object.defineProperty(Wf.prototype,"vT",{get:function(){return this.wa.Ma},enumerable:!0,configurable:!0}),Wf.prototype.transaction=function(t){var e=this;this.VT();var n=new wu;return this.wa.oo(function(){return e.hl.runTransaction(e.wa,t,n),Promise.resolve()}),n.promise},Wf),Gf=(zf.prototype.next=function(t){this.CT(this.observer.next,t)},zf.prototype.error=function(t){this.CT(this.observer.error,t)},zf.prototype.FT=function(){this.muted=!0},zf.prototype.CT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},zf);function zf(t){this.observer=t,this.muted=!1}function Wf(t,e,n,r){this.platform=t,this.mT=e,this.credentials=n,this.wa=r,this.clientId=Qs.cn()}function Qf(){return null!==Pf&&Pf.apply(this,arguments)||this}function Hf(){}function Kf(t){this.persistence=t,this.nT=new mh,this.rT=null}function Yf(t){var e=this;return(e=Lf.call(this)||this).Mh=t,e}function Xf(t){var e=this;this.Zf={},this.Oh=new au(0),this.xh=!1,this.xh=!0,this.nh=t(this),this.zh=new Cf(this),this.jn=new Au,this.Qn=new vf(this.jn,function(t){return e.nh.tT(t)})}function $f(t){this.persistence=t,this.Hf=new Zs(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Or.min(),this.highestTargetId=0,this.Yf=0,this.Jf=new mh,this.targetCount=0,this.Xf=Fu.sh()}function Jf(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Zf,tl,el=(_l.prototype.$T=function(t){switch(si(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pi(t.integerValue||t.doubleValue);case 3:return this.kT(t.timestampValue);case 4:return this.MT(t);case 5:return t.stringValue;case 6:return new Fh(di(t.bytesValue));case 7:return this.LT(t.referenceValue);case 8:return this.OT(t.geoPointValue);case 9:return this.xT(t.arrayValue);case 10:return this.BT(t.mapValue);default:throw zs()}},_l.prototype.BT=function(t){var n=this,r={};return Xr(t.fields||{},function(t,e){r[t]=n.$T(e)}),r},_l.prototype.OT=function(t){return new rc(pi(t.latitude),pi(t.longitude))},_l.prototype.xT=function(t){var e=this;return(t.values||[]).map(function(t){return e.$T(t)})},_l.prototype.MT=function(t){switch(this.NT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return ri(n)?t(n):n}(t);return null==e?null:this.$T(e);case"estimate":return this.kT(ii(t));default:return null}},_l.prototype.kT=function(t){var e=li(t),n=new xr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},_l.prototype.LT=function(t){var e=Vr.K(t);Ws(Ls(e));var n=new Js(e.get(1),e.get(3)),r=new Hr(e.k(5));return n.isEqual(this.firestore.Nc)||Bs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.Nc.projectId+"/"+this.firestore.Nc.database+") instead."),new ul(r,this.firestore,this.converter)},_l),nl=ih.au,rl=(Nl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Nl),il=(Il.prototype.settings=function(t){Th("Firestore.settings",arguments,1),_h("Firestore.settings","object",1,t);var e=new rl(t);if(this.WT&&!this.HT.isEqual(e))throw new _r(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.HT=e).credentials&&(this.GT=function(t){if(!t)return new Ar;switch(t.type){case"gapi":var e=t.JT;return Ws(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new kr(e,t.V||"0");case"provider":return t.JT;default:throw new _r(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Il.prototype.enableNetwork=function(){return this.QT(),this.WT.enableNetwork()},Il.prototype.disableNetwork=function(){return this.QT(),this.WT.disableNetwork()},Il.prototype.enablePersistence=function(t){var e,n;if(this.WT)throw new _r(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Bs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.XT(this.zT,{PT:!0,cacheSizeBytes:this.HT.cacheSizeBytes,synchronizeTabs:r})},Il.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.WT&&!this.WT.vT)throw new _r(Nr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new wu,[2,(this.UT.La(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.ZT(),[4,this.zT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},Il.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Il.prototype,"tE",{get:function(){return this.QT(),this.WT.vT},enumerable:!0,configurable:!0}),Il.prototype.waitForPendingWrites=function(){return this.QT(),this.WT.waitForPendingWrites()},Il.prototype.onSnapshotsInSync=function(t){if(this.QT(),Jf(t))return this.eE(t);_h("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.eE(e)},Il.prototype.eE=function(t){var e=this,n=new Gf({next:function(){t.next&&t.next()},error:function(t){throw zs()}});return this.WT.Sf(n),function(){n.FT(),e.WT.Df(n)}},Il.prototype.QT=function(){return this.WT||this.XT(new qf,{PT:!1}),this.WT},Il.prototype.ZT=function(){return new $s(this.Nc,this.KT,this.HT.host,this.HT.ssl,this.HT.forceLongPolling)},Il.prototype.XT=function(t,e){var n=this.ZT();return this.WT=new Bf(Cs.nt(),n,this.GT,this.UT),this.WT.start(t,e)},Il.jT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new _r(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new _r(Nr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Js(n)},Object.defineProperty(Il.prototype,"app",{get:function(){if(!this.qT)throw new _r(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.qT},enumerable:!0,configurable:!0}),Il.prototype.collection=function(t){return Th("Firestore.collection",arguments,1),_h("Firestore.collection","non-empty string",1,t),this.QT(),new pl(Vr.K(t),this)},Il.prototype.doc=function(t){return Th("Firestore.doc",arguments,1),_h("Firestore.doc","non-empty string",1,t),this.QT(),ul.sE(Vr.K(t),this)},Il.prototype.collectionGroup=function(t){if(Th("Firestore.collectionGroup",arguments,1),_h("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.QT(),new fl(new Io(Vr.G,t),this)},Il.prototype.runTransaction=function(e){var n=this;return Th("Firestore.runTransaction",arguments,1),_h("Firestore.runTransaction","function",1,e),this.QT().transaction(function(t){return e(new ol(n,t))})},Il.prototype.batch=function(){return this.QT(),new sl(this)},Object.defineProperty(Il,"logLevel",{get:function(){switch(Us()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),Il.setLogLevel=function(t){switch(Th("Firestore.setLogLevel",arguments,1),_h("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":qs(l.DEBUG);break;case"error":qs(l.ERROR);break;case"silent":qs(l.SILENT);break;default:throw new _r(Nr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Il.prototype.iE=function(){return this.HT.timestampsInSnapshots},Il),ol=(Tl.prototype.get=function(t){var n=this;Th("Transaction.get",arguments,1);var r=kl("Transaction.get",t,this.nE);return this.rE.R_([r.$c]).then(function(t){if(!t||1!==t.length)return zs();var e=t[0];if(e instanceof bo)return new hl(n.nE,r.$c,null,!1,!1,r.hE);if(e instanceof wo)return new hl(n.nE,r.$c,e,!1,!1,r.hE);throw zs()})},Tl.prototype.set=function(t,e,n){Nh("Transaction.set",arguments,2,3);var r=kl("Transaction.set",t,this.nE);n=Al("Transaction.set",n);var i=xl(r.hE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.nE.YT.Sc(s,o,n.mergeFields):this.nE.YT.bc(s,o);return this.rE.set(r.$c,u),this},Tl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Bh?(Ih("Transaction.update",arguments,3),r=kl("Transaction.update",t,this.nE),this.nE.YT.Cc("Transaction.update",e,n,o)):(Th("Transaction.update",arguments,2),r=kl("Transaction.update",t,this.nE),this.nE.YT.Dc("Transaction.update",e)),this.rE.update(r.$c,i),this},Tl.prototype.delete=function(t){Th("Transaction.delete",arguments,1);var e=kl("Transaction.delete",t,this.nE);return this.rE.delete(e.$c),this},Tl),sl=(El.prototype.set=function(t,e,n){Nh("WriteBatch.set",arguments,2,3),this.uE();var r=kl("WriteBatch.set",t,this.nE);n=Al("WriteBatch.set",n);var i=xl(r.hE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.nE.YT.Sc(s,o,n.mergeFields):this.nE.YT.bc(s,o);return this.oE=this.oE.concat(u.Rc(r.$c,ji.ft())),this},El.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.uE(),i="string"==typeof e||e instanceof Bh?(Ih("WriteBatch.update",arguments,3),r=kl("WriteBatch.update",t,this.nE),this.nE.YT.Cc("WriteBatch.update",e,n,o)):(Th("WriteBatch.update",arguments,2),r=kl("WriteBatch.update",t,this.nE),this.nE.YT.Dc("WriteBatch.update",e)),this.oE=this.oE.concat(i.Rc(r.$c,ji.exists(!0))),this},El.prototype.delete=function(t){Th("WriteBatch.delete",arguments,1),this.uE();var e=kl("WriteBatch.delete",t,this.nE);return this.oE=this.oE.concat(new Gi(e.$c,ji.ft())),this},El.prototype.commit=function(){return this.uE(),this.aE=!0,0<this.oE.length?this.nE.QT().write(this.oE):Promise.resolve()},El.prototype.uE=function(){if(this.aE)throw new _r(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},El),ul=(bl.sE=function(t,e,n){if(t.length%2!=0)throw new _r(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new bl(new Hr(t),e,n)},Object.defineProperty(bl.prototype,"id",{get:function(){return this.$c.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(bl.prototype,"parent",{get:function(){return new pl(this.$c.path.M(),this.firestore,this.hE)},enumerable:!0,configurable:!0}),Object.defineProperty(bl.prototype,"path",{get:function(){return this.$c.path.j()},enumerable:!0,configurable:!0}),bl.prototype.collection=function(t){if(Th("DocumentReference.collection",arguments,1),_h("DocumentReference.collection","non-empty string",1,t),!t)throw new _r(Nr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Vr.K(t);return new pl(this.$c.path.child(e),this.firestore)},bl.prototype.isEqual=function(t){if(!(t instanceof bl))throw Lh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.$c.isEqual(t.$c)&&this.hE===t.hE},bl.prototype.set=function(t,e){Nh("DocumentReference.set",arguments,1,2),e=Al("DocumentReference.set",e);var n=xl(this.hE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.YT.Sc(i,r,e.mergeFields):this.firestore.YT.bc(i,r);return this.WT.write(o.Rc(this.$c,ji.ft()))},bl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Bh?(Ih("DocumentReference.update",arguments,2),this.firestore.YT.Cc("DocumentReference.update",t,e,r)):(Th("DocumentReference.update",arguments,1),this.firestore.YT.Dc("DocumentReference.update",t)),this.WT.write(n.Rc(this.$c,ji.exists(!0)))},bl.prototype.delete=function(){return Th("DocumentReference.delete",arguments,0),this.WT.write([new Gi(this.$c,ji.ft())])},bl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Nh("DocumentReference.onSnapshot",arguments,1,4);var n={includeMetadataChanges:!1},r=0;"object"!=typeof t[r]||Jf(t[r])||(Ph("DocumentReference.onSnapshot",n=t[r],["includeMetadataChanges"]),Dh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges),r++);var i={includeMetadataChanges:n.includeMetadataChanges},o=Jf(t[r])?t[r]:(_h("DocumentReference.onSnapshot","function",r,t[r]),Ah("DocumentReference.onSnapshot","function",r+1,t[r+1]),Ah("DocumentReference.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]});return this.cE(i,o)},bl.prototype.cE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Gf({next:function(t){var e;n.next&&(e=t.docs.get(r.$c),n.next(new hl(r.firestore,r.$c,e,t.fromCache,t.hasPendingWrites,r.hE)))},error:e}),o=this.WT.listen(Io.Wt(this.$c.path),i,t);return function(){i.FT(),r.WT.nl(o)}},bl.prototype.get=function(n){var r=this;return Nh("DocumentReference.get",arguments,0,1),Dl("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.QT().ST(r.$c).then(function(t){e(new hl(r.firestore,r.$c,t,!0,t instanceof wo&&t.At,r.hE))},t):r._E(e,t,n)})},bl.prototype._E=function(e,n,r){var i=this.cE({includeMetadataChanges:!0,Lf:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new _r(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new _r(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},bl.prototype.withConverter=function(t){return new bl(this.$c,this.firestore,t)},bl),al=(wl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},wl),hl=(gl.prototype.data=function(t){if(Nh("DocumentSnapshot.data",arguments,0,1),t=Sl("DocumentSnapshot.data",t),this.lE){if(this.hE){var e=new cl(this.nE,this.$c,this.lE,this.dE,this.fE);return this.hE.fromFirestore(e,t)}return new el(this.nE,this.nE.iE(),t.serverTimestamps,void 0).$T(this.lE.Mt())}},gl.prototype.get=function(t,e){if(Nh("DocumentSnapshot.get",arguments,1,2),e=Sl("DocumentSnapshot.get",e),this.lE){var n=this.lE.data().field(Nc("DocumentSnapshot.get",t));if(null!==n)return new el(this.nE,this.nE.iE(),e.serverTimestamps,this.hE).$T(n)}},Object.defineProperty(gl.prototype,"id",{get:function(){return this.$c.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(gl.prototype,"ref",{get:function(){return new ul(this.$c,this.nE,this.hE)},enumerable:!0,configurable:!0}),Object.defineProperty(gl.prototype,"exists",{get:function(){return null!==this.lE},enumerable:!0,configurable:!0}),Object.defineProperty(gl.prototype,"metadata",{get:function(){return new al(this.fE,this.dE)},enumerable:!0,configurable:!0}),gl.prototype.isEqual=function(t){if(!(t instanceof gl))throw Lh("isEqual","DocumentSnapshot",1,t);return this.nE===t.nE&&this.dE===t.dE&&this.$c.isEqual(t.$c)&&(null===this.lE?null===t.lE:this.lE.isEqual(t.lE))&&this.hE===t.hE},gl),cl=(n(ml,tl=hl),ml.prototype.data=function(t){return tl.prototype.data.call(this,t)},ml),fl=(vl.prototype.where=function(t,e,n){Th("Query.where",arguments,3),Vh("Query.where",3,n);var r,i=function(t,e){if(!t.some(function(t){return t===e}))throw new _r(Nr.INVALID_ARGUMENT,"Invalid value "+Rh(e)+" provided to function Query.where() for its "+Mh(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Nc("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.EE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.IE(h))}r={arrayValue:{values:s}}}else r=this.IE(n)}else"in"!==i&&"array-contains-any"!==i||this.EE(n,i),r=this.firestore.YT.Fc("Query.where",n,"in"===i);var c=No.create(o,i,r);return this.wE(c),new vl(this.TE.Gt(c),this.firestore,this.hE)},vl.prototype.orderBy=function(t,e){var n;if(Nh("Query.orderBy",arguments,1,2),Ah("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new _r(Nr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.TE.startAt)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.TE.endAt)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Nc("Query.orderBy",t),i=new Oo(r,n);return this.RE(i),new vl(this.TE.zt(i),this.firestore,this.hE)},vl.prototype.limit=function(t){return Th("Query.limit",arguments,1),_h("Query.limit","number",1,t),Ch("Query.limit",1,t),new vl(this.TE.Ht(t),this.firestore,this.hE)},vl.prototype.limitToLast=function(t){return Th("Query.limitToLast",arguments,1),_h("Query.limitToLast","number",1,t),Ch("Query.limitToLast",1,t),new vl(this.TE.Yt(t),this.firestore,this.hE)},vl.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ih("Query.startAt",arguments,1);var r=this.mE("Query.startAt",t,e,!0);return new vl(this.TE.Jt(r),this.firestore,this.hE)},vl.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ih("Query.startAfter",arguments,1);var r=this.mE("Query.startAfter",t,e,!1);return new vl(this.TE.Jt(r),this.firestore,this.hE)},vl.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ih("Query.endBefore",arguments,1);var r=this.mE("Query.endBefore",t,e,!0);return new vl(this.TE.Xt(r),this.firestore,this.hE)},vl.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ih("Query.endAt",arguments,1);var r=this.mE("Query.endAt",t,e,!1);return new vl(this.TE.Xt(r),this.firestore,this.hE)},vl.prototype.isEqual=function(t){if(!(t instanceof vl))throw Lh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.TE.isEqual(t.TE)},vl.prototype.withConverter=function(t){return new vl(this.TE,this.firestore,t)},vl.prototype.mE=function(t,e,n,r){if(Vh(t,1,e),e instanceof hl){if(0<n.length)throw new _r(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new _r(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.AE(i.lE,r)}var o=[e].concat(n);return this.PE(t,o,r)},vl.prototype.AE=function(t,e){for(var n=[],r=0,i=this.TE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(yi(this.firestore.Nc,t.key));else{var s=t.field(o.field);if(ri(s))throw new _r(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new xo(n,e)},vl.prototype.PE=function(t,e,n){var r=this.TE.xt;if(e.length>r.length)throw new _r(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.TE._e()&&-1!==s.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.TE.path.child(Vr.K(s));if(!Hr.et(u))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Hr(u);i.push(yi(this.firestore.Nc,a))}else{var h=this.firestore.YT.Fc(t,s);i.push(h)}}return new xo(i,n)},vl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Nh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Jf(t[i])||(Ph("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Dh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Jf(t[i])?t[i]:(_h("Query.onSnapshot","function",i,t[i]),Ah("Query.onSnapshot","function",i+1,t[i+1]),Ah("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.VE(this.TE),this.cE(r,n)},vl.prototype.cE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Gf({next:function(t){e.next&&e.next(new ll(n.firestore,n.TE,t,n.hE))},error:r}),o=this.firestore.QT(),s=o.listen(this.TE,i,t);return function(){i.FT(),o.nl(s)}},vl.prototype.VE=function(t){if(t.ae()&&0===t.xt.length)throw new _r(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},vl.prototype.get=function(n){var r=this;return Nh("Query.get",arguments,0,1),Dl("Query.get",n),this.VE(this.TE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.QT().DT(r.TE).then(function(t){e(new ll(r.firestore,r.TE,t,r.hE))},t):r._E(e,t,n)})},vl.prototype._E=function(e,n,r){var i=this.cE({includeMetadataChanges:!0,Lf:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new _r(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},vl.prototype.IE=function(t){if("string"==typeof t){if(""===t)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.TE._e()&&-1!==t.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.TE.path.child(Vr.K(t));if(!Hr.et(e))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return yi(this.firestore.Nc,new Hr(e))}if(t instanceof ul)return yi(this.firestore.Nc,t.$c);throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Rh(t)+".")},vl.prototype.EE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},vl.prototype.wE=function(t){if(t instanceof No){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.TE.jt();if(null!==o&&!o.isEqual(t.field))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.TE.Kt();null!==s&&this.gE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.TE.ce(n)),null===u&&r&&(u=this.TE.ce(e)),null!=u)throw u===t.op?new _r(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new _r(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},vl.prototype.RE=function(t){var e;null!==this.TE.Kt()||null!==(e=this.TE.jt())&&this.gE(e,t.field)},vl.prototype.gE=function(t,e){if(!e.isEqual(t))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},vl),ll=(Object.defineProperty(yl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(yl.prototype,"empty",{get:function(){return this.yE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(yl.prototype,"size",{get:function(){return this.yE.docs.size},enumerable:!0,configurable:!0}),yl.prototype.forEach=function(e,n){var r=this;Nh("QuerySnapshot.forEach",arguments,1,2),_h("QuerySnapshot.forEach","function",1,e),this.yE.docs.forEach(function(t){e.call(n,r.SE(t))})},Object.defineProperty(yl.prototype,"query",{get:function(){return new fl(this.pE,this.nE,this.hE)},enumerable:!0,configurable:!0}),yl.prototype.docChanges=function(t){t&&(Ph("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Dh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.yE.hs)throw new _r(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.bE&&this.vE===e||(this.bE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new cl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new cl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zs()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.nE,e,this.yE,this.hE),this.vE=e),this.bE},yl.prototype.isEqual=function(t){if(!(t instanceof yl))throw Lh("isEqual","QuerySnapshot",1,t);return this.nE===t.nE&&this.pE.isEqual(t.pE)&&this.yE.isEqual(t.yE)&&this.hE===t.hE},yl.prototype.SE=function(t){return new cl(this.nE,t.key,t,this.metadata.fromCache,this.yE.ns.has(t.key),this.hE)},yl),pl=(n(dl,Zf=fl),Object.defineProperty(dl.prototype,"id",{get:function(){return this.TE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(dl.prototype,"parent",{get:function(){var t=this.TE.path.M();return t.B()?null:new ul(new Hr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(dl.prototype,"path",{get:function(){return this.TE.path.j()},enumerable:!0,configurable:!0}),dl.prototype.doc=function(t){if(Nh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Qs.cn()),_h("CollectionReference.doc","non-empty string",1,t),""===t)throw new _r(Nr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Vr.K(t);return ul.sE(this.TE.path.child(e),this.firestore,this.hE)},dl.prototype.add=function(t){Th("CollectionReference.add",arguments,1),_h("CollectionReference.add","object",1,this.hE?this.hE.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},dl.prototype.withConverter=function(t){return new dl(this.DE,this.firestore,t)},dl);function dl(t,e,n){var r=this;if(((r=Zf.call(this,Io.Wt(t),e,n)||this).DE=t).length%2!=1)throw new _r(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function yl(t,e,n,r){this.nE=t,this.pE=e,this.yE=n,this.hE=r,this.bE=null,this.vE=null,this.metadata=new al(n.hasPendingWrites,n.fromCache)}function vl(t,e,n){this.TE=t,this.firestore=e,this.hE=n}function ml(){return null!==tl&&tl.apply(this,arguments)||this}function gl(t,e,n,r,i,o){this.nE=t,this.$c=e,this.lE=n,this.dE=r,this.fE=i,this.hE=o}function wl(t,e){this.hasPendingWrites=t,this.fromCache=e}function bl(t,e,n){this.$c=t,this.firestore=e,this.hE=n,this.WT=this.firestore.QT()}function El(t){this.nE=t,this.oE=[],this.aE=!1}function Tl(t,e){this.nE=t,this.rE=e}function Il(t,e,n){var r=this;if(void 0===n&&(n=new qf),this.qT=null,this.UT=new $a,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.QT(),[4,this.WT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.qT=i,this.Nc=Il.jT(i),this.KT=i.name,this.GT=new Sr(e)}else{var o=t;if(!o.projectId)throw new _r(Nr.INVALID_ARGUMENT,"Must provide projectId");this.Nc=new Js(o.projectId,o.database),this.KT="[DEFAULT]",this.GT=new Ar}this.zT=n,this.HT=new rl({}),this.YT=new mc(this.Nc)}function Nl(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new _r(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Sh("settings","non-empty string","host",t.host),this.host=t.host,Dh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ph("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Dh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Dh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Bs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Bs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Dh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ih.cu;else{if(t.cacheSizeBytes!==nl&&t.cacheSizeBytes<ih.uu)throw new _r(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ih.uu);this.cacheSizeBytes=t.cacheSizeBytes}Dh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function _l(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.NT=n,this.converter=r}function Al(t,e){if(void 0===e)return{merge:!1};if(Ph(t,e,["merge","mergeFields"]),Dh(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Rh(n));for(var r,i=0;i<n.length;++i)if(!("string"==typeof(r=n[i])||r instanceof Bh))throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Rh(n[i]))}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new _r(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Sl(t,e){return void 0===e?{}:(Ph(t,e,["serverTimestamps"]),kh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Dl(t,e){Ah(t,"object",1,e),e&&(Ph(t,e,["source"]),kh(t,0,"source",e.source,["default","server","cache"]))}function kl(t,e,n){if(e instanceof ul){if(e.firestore!==n)throw new _r(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Lh(t,"DocumentReference",1,e)}function xl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function Ol(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new _r(Nr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var Rl,Vl=Ol(il,"Use firebase.firestore() instead."),Pl=Ol(ol,"Use firebase.firestore().runTransaction() instead."),Ll=Ol(sl,"Use firebase.firestore().batch() instead."),Cl=Ol(ul,"Use firebase.firestore().doc() instead."),Ml=Ol(hl),jl=Ol(cl),Ul=Ol(fl),ql=Ol(ll),Fl=Ol(pl,"Use firebase.firestore().collection() instead."),Bl=Ol((ep.delete=function(){return Eh("FieldValue.delete",arguments),new Jh},ep.serverTimestamp=function(){return Eh("FieldValue.serverTimestamp",arguments),new Zh},ep.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ih("FieldValue.arrayUnion",arguments,1),new tc(t)},ep.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ih("FieldValue.arrayRemove",arguments,1),new ec(t)},ep.increment=function(t){return _h("FieldValue.increment","number",1,t),Th("FieldValue.increment",arguments,1),new nc(t)},ep.prototype.isEqual=function(t){return this===t},ep),"Use FieldValue.<field>() instead."),Gl=Ol(Fh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),zl={Firestore:Vl,GeoPoint:rc,Timestamp:xr,Blob:Gl,Transaction:Pl,WriteBatch:Ll,DocumentReference:Cl,DocumentSnapshot:Ml,Query:Ul,QueryDocumentSnapshot:jl,QuerySnapshot:ql,CollectionReference:Fl,FieldPath:Bh,FieldValue:Bl,setLogLevel:il.setLogLevel,CACHE_SIZE_UNLIMITED:nl},Wl=(tp.prototype.x_=function(t){},tp.prototype.Ro=function(){},tp),Ql=(Zl.prototype.x_=function(t){this.kE.push(t)},Zl.prototype.Ro=function(){window.removeEventListener("online",this.CE),window.removeEventListener("offline",this.NE)},Zl.prototype.ME=function(){window.addEventListener("online",this.CE),window.addEventListener("offline",this.NE)},Zl.prototype.FE=function(){Fs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(0)},Zl.prototype.$E=function(){Fs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(1)},Zl.jh=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Zl),Hl=(Jl.prototype.t_=function(t){this.xE=t},Jl.prototype.Hc=function(t){this.BE=t},Jl.prototype.onMessage=function(t){this.qE=t},Jl.prototype.close=function(){this.OE()},Jl.prototype.send=function(t){this.LE(t)},Jl.prototype.UE=function(){this.xE()},Jl.prototype.QE=function(t){this.BE(t)},Jl.prototype.WE=function(t){this.qE(t)},Jl),Kl={BatchGetDocuments:"batchGet",Commit:"commit"},Yl="gl-js/ fire/"+gr,Xl=($l.prototype.KE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=Yl},$l.prototype.l_=function(a,r,i){var h=this,c=this.GE(a);return new Promise(function(o,s){var u=new mr;u.listenOnce(yr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case dr.NO_ERROR:var t=u.getResponseJson();Fs("Connection","XHR received:",JSON.stringify(t)),o(t);break;case dr.TIMEOUT:Fs("Connection",'RPC "'+a+'" timed out'),s(new _r(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var e,n,r=u.getStatus();Fs("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Nr).indexOf(i)?i:Nr.UNKNOWN,s(new _r(n,e.message))):s(new _r(Nr.UNKNOWN,"Server responded with status "+u.getStatus())):(Fs("Connection",'RPC "'+a+'" failed'),s(new _r(Nr.UNAVAILABLE,"Connection failed.")));break;default:zs()}}finally{Fs("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Fs("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.KE(n,i),u.send(c,"POST",e,n,15)})},$l.prototype.d_=function(t,e,n){return this.l_(t,e,n)},$l.prototype.e_=function(t,e){var n,r,i=[this.jE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=pr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.KE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Fs("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new Hl({LE:function(t){f?Fs("Connection","Not sending because WebChannel is closed:",t):(c||(Fs("Connection","Opening WebChannel transport."),h.open(),c=!0),Fs("Connection","WebChannel sending:",t),h.send(t))},OE:function(){return h.close()}});return a(vr.EventType.OPEN,function(){f||Fs("Connection","WebChannel transport opened.")}),a(vr.EventType.CLOSE,function(){f||(f=!0,Fs("Connection","WebChannel transport closed"),l.QE())}),a(vr.EventType.ERROR,function(t){f||(f=!0,Fs("Connection","WebChannel transport errored:",t),l.QE(new _r(Nr.UNAVAILABLE,"The operation could not be completed")))}),a(vr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Ws(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Fs("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=uo[i];if(void 0!==t)return Ko(t)}(),s=r.message,void 0===o&&(o=Nr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.QE(new _r(o,s)),h.close()):(Fs("Connection","WebChannel received:",n),l.WE(n)))}),setTimeout(function(){l.UE()},0),l},$l.prototype.GE=function(t){var e=Kl[t];return this.jE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},$l);function $l(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.jE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Jl(t){this.LE=t.LE,this.OE=t.OE}function Zl(){var t=this;this.CE=function(){return t.FE()},this.NE=function(){return t.$E()},this.kE=[],this.ME()}function tp(){}function ep(){}function np(){this.oc="undefined"!=typeof atob}Cs.an((Object.defineProperty(np.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(np.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),np.prototype.pT=function(t){return Promise.resolve(new Xl(t))},np.prototype.RT=function(){return new(Ql.jh()?Ql:Wl)},np.prototype.yc=function(t){return new Vs(t,{hi:!0})},np.prototype.un=function(t){return JSON.stringify(t)},np.prototype.atob=function(t){return atob(t)},np.prototype.btoa=function(t){return btoa(t)},np.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new np)),(Rl=rp).INTERNAL.registerComponent(new E("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new il(e,n,new Ff);var e,n},"PUBLIC").setServiceProps(Object.assign({},zl))),Rl.registerVersion("@firebase/firestore","1.14.5")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});