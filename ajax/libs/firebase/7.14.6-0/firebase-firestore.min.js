!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(np){"use strict";try{(function(){np=np&&Object.prototype.hasOwnProperty.call(np,"default")?np.default:np;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(g,f=Error),g);function g(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,E=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_=_||{},S=A||self;function k(){}function D(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){var e=D(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),P=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:V).apply(null,arguments)}function U(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var j=Date.now||function(){return+new Date};function M(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.da=function(){!this.j&&(this.j=!0,this.C(),0)&&(Object.prototype.hasOwnProperty.call(this,R)&&this[R]||(this[R]=++P))},q.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var K,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function H(t,e){return t<e?-1:e<t?1:0}t:{var $=S.navigator;if($){var X=$.userAgent;if(X){K=X;break t}}K=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=k;var rt,it,ot=Q(K,"Opera"),st=Q(K,"Trident")||Q(K,"MSIE"),ut=Q(K,"Edge"),at=ut||st,ht=Q(K,"Gecko")&&!(Q(K.toLowerCase(),"webkit")&&!Q(K,"Edge"))&&!(Q(K,"Trident")||Q(K,"MSIE"))&&!Q(K,"Edge"),ct=Q(K.toLowerCase(),"webkit")&&!Q(K,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=K,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt={};function vt(u){return t=u,e=function(){for(var t=0,e=Y(String(rt)).split("."),n=Y(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=H(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||H(0==o[2].length,0==s[2].length)||H(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=yt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var gt=S.document&&st&&(ft()||parseInt(rt,10))||void 0,mt=!st||9<=Number(gt),wt=st&&!vt("9"),bt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",k,e),S.removeEventListener("test",k,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},M(Tt,Et);var It={2:"touch",3:"pen",4:"mouse"};Tt.prototype.b=function(){Tt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,wt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),At=0;function _t(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++At,this.V=this.X=!1}function St(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function kt(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n,r,i,o=e.type;o in t.a&&(r=t.a[o],(n=0<=(i=F(r,e)))&&Array.prototype.splice.call(r,i,1),n&&(St(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}kt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=xt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new _t(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Rt={};function Pt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ft(r),e&&e[Nt]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Lt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Pt(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[Nt]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Lt(t,e,n,!1,r,i)}function Lt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!mt)return null;var u,a,h=Mt(t);if(h||(t[Ot]=h=new kt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=jt,r=a=mt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)bt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.V&&((e=t.src)&&e[Nt]?Dt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Mt(e))?(Dt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):St(t)))}function Ct(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Ut(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Vt(t),n.call(r,e)}function jt(t,e){if(t.V)return!0;if(mt)return Ut(t,new Tt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ut(t,e=new Tt(e,this))}function Mt(t){return(t=t[Ot])instanceof kt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==D(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Bt(){q.call(this),this.c=new kt(this),(this.J=this).A=null}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.V&&a.capture==n&&(s=a.listener,u=a.aa||a.src,a.X&&Dt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}M(Bt,q),Bt.prototype[Nt]=!0,(N=Bt.prototype).addEventListener=function(t,e,n,r){Pt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ft(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Mt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Et(t,n):t instanceof Et?t.target=t.target||n:(s=t,et(t=new Et(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Gt(o,r,!0,t)&&s;if(s=Gt(o=t.a=n,r,!0,t)&&s,s=Gt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Gt(o=t.a=e[i],r,!1,t)&&s;return s},N.C=function(){if(Bt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.A=null},N.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=S.JSON.stringify;function Wt(){this.b=this.a=null}var Kt,Yt=(Qt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Qt(function(){return new Ht},function(t){t.reset()},100));function Qt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Ht(){this.next=this.b=this.a=null}function $t(t){S.setTimeout(function(){throw t},0)}function Xt(t,e){var n;Kt||(n=S.Promise.resolve(void 0),Kt=function(){n.then(te)}),Jt||(Kt(),Jt=!0),Zt.add(t,e)}Wt.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ht.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Jt=!(Ht.prototype.reset=function(){this.next=this.b=this.a=null}),Zt=new Wt;function te(){for(var t,e,n;n=e=void 0,n=null,(e=Zt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){$t(t)}var r=Yt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Jt=!1}function ee(t,e){Bt.call(this),this.b=t||1,this.a=e||S,this.f=C(this.Ua,this),this.g=j()}function ne(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function re(t,e,n){if("function"==D(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function ie(t,e,n){q.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function oe(t){t.T=re(t.b,t.c),t.f.apply(null,t.a)}function se(t){q.call(this),this.b=t,this.a={}}M(ee,Bt),(N=ee.prototype).Z=!1,N.L=null,N.Ua=function(){var t;this.Z&&(0<(t=j()-this.g)&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ne(this),this.start())))},N.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=j())},N.C=function(){ee.M.C.call(this),ne(this),delete this.a},M(ie,q),(N=ie.prototype).ba=!1,N.T=null,N.Ia=function(t){this.a=arguments,this.T?this.ba=!0:oe(this)},N.C=function(){ie.M.C.call(this),this.T&&(S.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},N.Pa=function(){this.T=null,this.ba&&(this.ba=!1,oe(this))},M(se,q);var ue=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=Pt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function ce(){}se.prototype.C=function(){se.M.C.call(this),he(this)},se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=null;function le(){return fe=fe||new Bt}function pe(t){Et.call(this,"serverreachability",t)}function de(){var t=le();t.dispatchEvent(new pe(t))}function ye(t){Et.call(this,"statevent",t)}function ve(){var t=le();t.dispatchEvent(new ye(t))}function ge(t){Et.call(this,"timingevent",t)}function me(t,e){if("function"!=D(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}M(pe,Et),M(ye,Et),M(ge,Et);var we={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},be={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ee(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ie(){}Ee.prototype.a=null;var Ne,Ae={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function _e(){Et.call(this,"d")}function Se(){Et.call(this,"c")}function ke(){}function De(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new se(this),this.N=xe,t=at?125:void 0,this.O=new ee(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}M(_e,Et),M(Se,Et),M(ke,Ee),Ne=new ke;var xe=45e3,Oe={},Re={};function Pe(t,e,n){t.B=1,t.f=tn(Qe(e)),t.j=n,t.F=!0,Le(t,null)}function Le(t,e){t.s=j(),Ce(t),t.A=Qe(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),dn(n.b,"t",r),t.w=0,t.a=or(t.g,t.g.w?e:null),0<t.J&&(t.D=new ie(C(t.ya,t,t.a),t.J)),ae(t.G,t.a,"readystatechange",t.Sa),e=t.m?Z(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),de()}function Ve(t,e,n){for(var r,i,o,s,u=!0;!t.l&&t.w<n.length;){var a=(i=n,s=o=void 0,o=(r=t).w,-1==(s=i.indexOf("\n",o))?Re:(o=Number(i.substring(o,s)),isNaN(o)?Oe:(s+=1)+o>i.length?Re:(i=i.substr(s,o),r.w=s+o,i)));if(a==Re){4==e&&(t.c=4,ve(),u=!1);break}if(a==Oe){t.c=4,ve(),u=!1;break}Fe(t,a)}4==e&&0==n.length&&(t.c=1,ve(),u=!1),t.b=t.b&&u,u||(qe(t),Me(t))}function Ce(t){t.P=j()+t.N,Ue(t,t.N)}function Ue(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=me(C(t.Qa,t),e)}function je(t){t.h&&(S.clearTimeout(t.h),t.h=null)}function Me(t){0==t.g.u||t.l||tr(t.g,t)}function qe(t){je(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ne(t.O),he(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Fe(t,e){try{var n,r,i,o,s,u,a,h,c,f,l=t.g;if(0!=l.u&&(l.a==t||En(l.b,t)))if(l.A=t.H,!t.o&&En(l.b,t)&&3==l.u){try{var p=l.ja.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var d=p;if(0==d[0]){t:if(!l.i){if(l.a){if(!(l.a.s+3e3<t.s))break t;Zn(l),l.a.cancel(),l.a=null}Jn(l),ve()}}else l.ia=d[1],0<l.ia-l.G&&d[2]<37500&&l.U&&0==l.m&&!l.l&&(l.l=me(C(l.Na,l),6e3));if(bn(l.b)<=1&&l.O){try{l.O()}catch(t){}l.O=void 0}}else nr(l,11)}else if(!t.o&&l.a!=t||Zn(l),!W(e))for(e=p=l.ja.a.parse(e),p=0;p<e.length;p++){d=e[p],l.G=d[0],d=d[1],2==l.u?"c"==d[0]?(l.B=d[1],l.R=d[2],null!=(n=d[3])&&(l.oa=n),null!=(r=d[5])&&"number"==typeof r&&0<r&&(l.D=1.5*r),i=l,(o=t.a)&&(!(s=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=i.b).a&&(Q(s,"spdy")||Q(s,"quic")||Q(s,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(Tn(u,u.b),u.b=null)),!i.s||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(i.ha=a,Ze(i.v,i.s,a))),l.u=3,l.c&&l.c.na(),h=t,(i=l).ea=ir(i,i.w?i.R:null,i.P),h.o?(In(i.b,h),c=h,(f=i.D)&&c.setTimeout(f),c.h&&(je(c),Ce(c)),i.a=h):Xn(i),0<l.f.length&&Yn(l)):"stop"!=d[0]&&"close"!=d[0]||nr(l,7):3==l.u&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?nr(l,7):zn(l):"noop"!=d[0]&&l.c&&l.c.ma(d),l.m=0)}de()}catch(t){}}function Be(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)B(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ge(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ge)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=De.prototype).setTimeout=function(t){this.N=t},N.Sa=function(t){t=t.target;var e=this.D;e&&3==qn(t)?e.Ia():this.ya(t)},N.ya=function(t){try{if(t==this.a)t:{var e=qn(this.a),n=this.a.qa();this.a.S();if(!(e<3||3==e&&!at&&!this.a.Y())){this.l||4!=e||7==n||de(),je(this);var r=this.a.S();this.H=r;var i=this.a.Y();if(this.b=200==r){if(this.R&&!this.o){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.c=3,ve(),qe(this),Me(this);break t}this.o=!0,Fe(this,u)}this.F?(Ve(this,e,i),at&&this.b&&3==e&&(ae(this.G,this.O,"tick",this.Ra),this.O.start())):Fe(this,i),4==e&&qe(this),this.b&&!this.l&&(4==e?tr(this.g,this):(this.b=!1,Ce(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.c=3:this.c=0,ve(),qe(this),Me(this)}}}catch(t){}},N.Ra=function(){var t,e;this.a&&(t=qn(this.a),e=this.a.Y(),this.w<e.length&&(je(this),Ve(this,t,e),this.b&&4!=t&&Ce(this)))},N.cancel=function(){this.l=!0,qe(this)},N.Qa=function(){this.h=null;var t=j();0<=t-this.P?(2!=this.B&&(de(),ve()),qe(this),this.c=2,Me(this)):Ue(this,this.P-t)},(N=Ge.prototype).I=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return ze(this),this.a.concat()},N.get=function(t,e){return We(this.b,t)?this.b[t]:e},N.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ke=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye?(this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,$e(this,t.c),Xe(this,t.h),this.g=t.g,e=t.b,(n=new cn).c=e.c,e.a&&(n.a=new Ge(e.a),n.b=e.b),Je(this,n),this.i=t.i):t&&(n=String(t).match(Ke))?(this.a=!!e,He(this,n[1]||"",!0),this.j=en(n[2]||""),$e(this,n[3]||"",!0),Xe(this,n[4]),this.g=en(n[5]||"",!0),Je(this,n[6]||"",!0),this.i=en(n[7]||"")):(this.a=!!e,this.b=new cn(null,this.a))}function Qe(t){return new Ye(t)}function He(t,e,n){t.f=n?en(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?en(e,!0):e}function Xe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Je(t,e,n){var r,i;e instanceof cn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(fn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ln(this,e),dn(this,n,t))},r)),r.f=i):(n||(e=nn(e,an)),t.b=new cn(e,t.a))}function Ze(t,e,n){t.b.set(e,n)}function tn(t){return Ze(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^j()).toString(36)),t}function en(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function nn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(nn(e,on,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(nn(e,on,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(nn(n,"/"==n.charAt(0)?un:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",nn(n,hn)),t.join("")};var on=/[#\/\?@]/g,sn=/[#\?:]/g,un=/[#\?]/g,an=/[#\?@]/g,hn=/#/g;function cn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(u){u.a||(u.a=new Ge,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],o=n,s=i?decodeURIComponent(i.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function ln(t,e){fn(t),e=yn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function pn(t,e){return fn(t),e=yn(t,e),We(t.a.b,e)}function dn(t,e,n){ln(t,e),0<n.length&&(t.c=null,t.a.set(yn(t,e),z(n)),t.b+=n.length)}function yn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function vn(t,e){this.b=t,this.a=e}function gn(t){this.g=t||mn,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ca&&S.ca.ua&&S.ca.ua()&&S.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=cn.prototype).add=function(t,e){fn(this),this.c=null,t=yn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){fn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},N.K=function(){fn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.I=function(t){fn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=G(e,this.a.get(yn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},N.set=function(t,e){return fn(this),this.c=null,pn(this,t=yn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.I(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var mn=10;function wn(t){return t.b||t.a&&t.a.size>=t.f}function bn(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Tn(t,e){t.a?t.a.add(e):t.b=e}function In(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.i)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function An(){}function _n(){this.a=new An}function Sn(t,r,e){var i=e||"";try{Be(t,function(t,e){var n=t;O(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function kn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},An.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},An.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Dn=S.JSON.parse;function xn(t){Bt.call(this),this.headers=new Ge,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=On,this.B=this.F=!1}M(xn,Bt);var On="",Rn=/^https?$/i,Pn=["POST","PUT"];function Ln(t){return"content-type"==t.toLowerCase()}function Vn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),jn(t)}function Cn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Un(t){if(t.b&&void 0!==_&&(!t.s[1]||4!=qn(t)||2!=t.S()))if(t.l&&4==qn(t))re(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==qn(t)){t.b=!1;try{var e,n,r,i,o=t.S();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.D).match(Ke)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<qn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Cn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Mn(t);var n=t.a,r=t.s[0]?k:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Mn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function qn(t){return t.a?t.a.readyState:0}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ze(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Bn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Bn("baseRetryDelayMs",5e3,t),this.Ga=Bn("retryDelaySeedMs",1e4,t),this.Da=Bn("forwardChannelMaxRetries",2,t),this.ga=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new gn(t&&t.concurrentRequestLimit),this.ja=new _n,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function zn(t){var e,n;Wn(t),3==t.u&&(e=t.H++,Ze(n=Qe(t.v),"SID",t.B),Ze(n,"RID",e),Ze(n,"TYPE","terminate"),Hn(t,n),(e=new De(t,e,void 0)).B=2,e.f=tn(Qe(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.f.toString(),"")),!n&&S.Image&&((new Image).src=e.f,n=!0),n||(e.a=or(e.g,null),e.a.$(e.f)),e.s=j(),Ce(e)),rr(t)}function Wn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(S.clearTimeout(t.i),t.i=null),Zn(t),t.b.cancel(),t.g&&("number"==typeof t.g&&S.clearTimeout(t.g),t.g=null)}function Kn(t,e){t.f.push(new vn(t.Fa++,e)),3==t.u&&Yn(t)}function Yn(t){wn(t.b)||t.g||(t.g=!0,Xt(t.xa,t),t.o=0)}function Qn(t,e){var n=e?e.W:t.H++,r=Qe(t.v);Ze(r,"SID",t.B),Ze(r,"RID",n),Ze(r,"AID",t.G),Hn(t,r),t.h&&t.j&&Fn(r,t.h,t.j),n=new De(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),Tn(t.b,n),Pe(n,r,e)}function Hn(t,n){t.c&&Be({},function(t,e){Ze(n,e,t)})}function $n(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Sn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function Xn(t){t.a||t.i||(t.J=1,Xt(t.wa,t),t.m=0)}function Jn(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=me(C(t.wa,t),er(t,t.m)),t.m++,1)}function Zn(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function tr(t,e){var n,r=null;if(t.a==e){Zn(t),t.a=null;var i=2}else{if(!En(t.b,e))return;r=e.i,In(t.b,e),i=1}if(t.A=e.H,0!=t.u)if(e.b){1==i?(r=e.j?e.j.length:0,e=j()-e.s,n=t.o,(i=le()).dispatchEvent(new ge(i)),Yn(t)):Xn(t)}else if(3==(n=e.c)||0==n&&0<t.A||!(1==i&&function(t,e){if(!(bn(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=me(C(t.xa,t,e),er(t,t.o)),t.o++,1}}(t,e)||2==i&&Jn(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function nr(t,e){var n,r,i,o,s,u;2==e?(n=null,t.c&&(n=null),r=C(t.Ta,t),n||(n=new Ye("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||He(n,"https"),tn(n)),i=n.toString(),o=r,u=new ce,S.Image?((s=new Image).onload=U(kn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=U(kn,u,s,"TestLoadImage: error",!1,o),s.onabort=U(kn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=U(kn,u,s,"TestLoadImage: timeout",!1,o),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):ve(),t.u=0,t.c&&t.c.la(e),rr(t),Wn(t)}function rr(t){t.u=0,t.A=-1,t.c&&(0==Nn(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.ka())}function ir(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof Ye?Qe(r):new Ye(r,void 0);return""!=c.c?(e&&$e(c,e+"."+c.c),Xe(c,c.h)):(o=(i=S.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new Ye(null,void 0),o&&He(h,o),s&&$e(h,s),u&&Xe(h,u),a&&(h.g=a),c=h),t.N&&J(t.N,function(t,e){Ze(c,e,t)}),e=t.s,n=t.ha,e&&n&&Ze(c,e,n),Ze(c,"VER",t.oa),Hn(t,c),c}function or(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Ea)).F=t.w,e}function sr(){}function ur(){if(st&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function ar(t,e){Bt.call(this),this.a=new Gn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new fr(this)}function hr(t){_e.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Se.call(this),this.status=1}function fr(t){this.a=t}(N=xn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Te(this.G):Te(Ne),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Vn(this,t)}t=n||"";var i,o=new Ge(this.headers);r&&Be(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Ln,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=S.FormData&&t instanceof S.FormData,0<=F(Pn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Mn(this),0<this.o&&((this.B=(i=this.a,st&&vt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=re(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vn(this,t)}},N.ta=function(){void 0!==_&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jn(this))},N.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),xn.M.C.call(this)},N.va=function(){this.j||(this.w||this.l||this.g?Un(this):this.Oa())},N.Oa=function(){Un(this)},N.S=function(){try{return 2<qn(this)?this.a.status:-1}catch(t){return-1}},N.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Dn(e)}},N.qa=function(){return this.h},N.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Gn.prototype).oa=8,N.u=1,N.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new De(this,t,void 0),r=this.j;if(this.F&&(r?et(r=Z(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),Ze(i=Qe(this.v),"RID",t),Ze(i,"CVER",22),this.s&&Ze(i,"X-HTTP-Session-Id",this.s),Hn(this,i),this.h&&r&&Fn(i,this.h,r),Tn(this.b,n),this.fa?(Ze(i,"$req",e),Ze(i,"SID","null"),n.R=!0,Pe(n,i,null)):Pe(n,i,e),this.u=2}}else 3==this.u&&(t?Qn(this,t):0==this.f.length||wn(this.b)||Qn(this))},N.wa=function(){this.i=null,this.a=new De(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Qe(this.ea);Ze(t,"RID","rpc"),Ze(t,"SID",this.B),Ze(t,"CI",this.U?"0":"1"),Ze(t,"AID",this.G),Hn(this,t),Ze(t,"TYPE","xmlhttp"),this.h&&this.j&&Fn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=tn(Qe(t)),e.j=null,e.F=!0,Le(e,n)},N.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Jn(this),ve())},N.Ta=function(t){ve()},(N=sr.prototype).na=function(){},N.ma=function(){},N.la=function(){},N.ka=function(){},N.Ha=function(){},ur.prototype.a=function(t,e){return new ar(t,e)},M(ar,Bt),(N=ar.prototype).addEventListener=function(t,e,n,r){ar.M.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){ar.M.removeEventListener.call(this,t,e,n,r)},N.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ve(),t.P=e,t.N=n||{},t.U=t.W,t.v=ir(t,null,t.P),Yn(t)},N.close=function(){zn(this.a)},N.La=function(t){var e;"string"==typeof t?((e={}).__data__=t,Kn(this.a,e)):this.g?((e={}).__data__=zt(t),Kn(this.a,e)):Kn(this.a,t)},N.C=function(){this.a.c=null,delete this.f,zn(this.a),delete this.a,ar.M.C.call(this)},M(hr,_e),M(cr,Se),M(fr,sr),fr.prototype.na=function(){this.a.dispatchEvent("a")},fr.prototype.ma=function(t){this.a.dispatchEvent(new hr(t))},fr.prototype.la=function(t){this.a.dispatchEvent(new cr)},fr.prototype.ka=function(){this.a.dispatchEvent("b")},ur.prototype.createWebChannel=ur.prototype.a,ar.prototype.send=ar.prototype.La,ar.prototype.open=ar.prototype.Ka,ar.prototype.close=ar.prototype.close,we.NO_ERROR=0,we.TIMEOUT=8,we.HTTP_ERROR=6,be.COMPLETE="complete",(Ie.EventType=Ae).OPEN="a",Ae.CLOSE="b",Ae.ERROR="c",Ae.MESSAGE="d",Bt.prototype.listen=Bt.prototype.ra,xn.prototype.listenOnce=xn.prototype.sa,xn.prototype.getLastError=xn.prototype.Ma,xn.prototype.getLastErrorCode=xn.prototype.qa,xn.prototype.getStatus=xn.prototype.S,xn.prototype.getResponseJson=xn.prototype.Ja,xn.prototype.getResponseText=xn.prototype.Y,xn.prototype.send=xn.prototype.$;var lr={createWebChannelTransport:function(){return new ur},ErrorCode:we,EventType:be,WebChannel:Ie,XhrIo:xn},pr=lr.createWebChannelTransport,dr=lr.ErrorCode,yr=lr.EventType,vr=lr.WebChannel,gr=lr.XhrIo,mr=np.SDK_VERSION,wr=(br.prototype.t=function(){return null!=this.uid},br.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},br.prototype.isEqual=function(t){return t.uid===this.uid},br);function br(t){this.uid=t}function Er(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}wr.UNAUTHENTICATED=new wr(null),wr.i=new wr("google-credentials-uid"),wr.h=new wr("first-party-uid");var Tr,Ir,Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ar=(n(Br,Ir=Error),Br),_r=(Fr.prototype.getToken=function(){return Promise.resolve(null)},Fr.prototype._=function(){},Fr.prototype.l=function(t){(this.u=t)(wr.UNAUTHENTICATED)},Fr.prototype.T=function(){this.u=null},Fr),Sr=(qr.prototype.getToken=function(){var e=this,n=this.A,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.A!==n)throw new Ar(Nr.ABORTED,"getToken aborted due to token change.");return t?(Ws("string"==typeof t.accessToken),new Er(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},qr.prototype._=function(){this.forceRefresh=!0},qr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},qr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},qr.prototype.m=function(){var t=this.auth&&this.auth.getUid();return Ws(null===t||"string"==typeof t),new wr(t)},qr),kr=(Object.defineProperty(Mr.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Mr),Dr=(jr.prototype.getToken=function(){return Promise.resolve(new kr(this.P,this.V))},jr.prototype.l=function(t){t(wr.h)},jr.prototype.T=function(){},jr.prototype._=function(){},jr),xr=(Ur.now=function(){return Ur.fromMillis(Date.now())},Ur.fromDate=function(t){return Ur.fromMillis(t.getTime())},Ur.fromMillis=function(t){var e=Math.floor(t/1e3);return new Ur(e,1e6*(t-1e3*e))},Ur.prototype.toDate=function(){return new Date(this.toMillis())},Ur.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Ur.prototype.p=function(t){return this.seconds===t.seconds?Qs(this.nanoseconds,t.nanoseconds):Qs(this.seconds,t.seconds)},Ur.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Ur.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Ur.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Ur),Or=(Cr.v=function(t){return new Cr(t)},Cr.min=function(){return new Cr(new xr(0,0))},Cr.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Cr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Cr.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Cr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Cr.prototype.C=function(){return this.timestamp},Cr),Rr=(Object.defineProperty(Vr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),Vr.prototype.isEqual=function(t){return 0===Vr.N(this,t)},Vr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Vr?t.forEach(function(t){e.push(t)}):e.push(t),this.$(e)},Vr.prototype.limit=function(){return this.offset+this.length},Vr.prototype.k=function(t){return t=void 0===t?1:t,this.$(this.segments,this.offset+t,this.length-t)},Vr.prototype.L=function(){return this.$(this.segments,this.offset,this.length-1)},Vr.prototype.M=function(){return this.segments[this.offset]},Vr.prototype.O=function(){return this.get(this.length-1)},Vr.prototype.get=function(t){return this.segments[this.offset+t]},Vr.prototype.B=function(){return 0===this.length},Vr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Vr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},Vr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Vr),Pr=(n(Lr,Tr=Rr),Lr.prototype.$=function(t,e,n){return new Lr(t,e,n)},Lr.prototype.j=function(){return this.W().join("/")},Lr.prototype.toString=function(){return this.j()},Lr.K=function(t){if(0<=t.indexOf("//"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Lr(t.split("/").filter(function(t){return 0<t.length}))},Lr);function Lr(){return null!==Tr&&Tr.apply(this,arguments)||this}function Vr(t,e,n){void 0===e?e=0:e>t.length&&zs(),void 0===n?n=t.length-e:n>t.length-e&&zs(),this.segments=t,this.offset=e,this.F=n}function Cr(t){this.timestamp=t}function Ur(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Ar(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function jr(t,e){this.P=t,this.V=e}function Mr(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=wr.h}function qr(t){var e=this;this.I=null,this.currentUser=wr.UNAUTHENTICATED,this.R=!1,this.A=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.A++,e.currentUser=e.m(),e.R=!0,e.u&&e.u(e.currentUser)},this.A=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function Fr(){this.u=null}function Br(t,e){var n=this;return(n=Ir.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Pr.G=new Pr([]);var Gr,zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Wr=(n(Kr,Gr=Rr),Kr.prototype.$=function(t,e,n){return new Kr(t,e,n)},Kr.H=function(t){return zr.test(t)},Kr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Kr.H(t)||(t="`"+t+"`"),t}).join(".")},Kr.prototype.toString=function(){return this.j()},Kr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Kr.J=function(){return new Kr(["__name__"])},Kr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ar(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Ar(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Kr(e)},Kr);function Kr(){return null!==Gr&&Gr.apply(this,arguments)||this}Wr.G=new Wr([]);var Yr=(Qr.Z=function(t){return new Qr(Pr.K(t).k(5))},Qr.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Qr.prototype.isEqual=function(t){return null!==t&&0===Pr.N(this.path,t.path)},Qr.prototype.toString=function(){return this.path.toString()},Qr.N=function(t,e){return Pr.N(t.path,e.path)},Qr.et=function(t){return t.length%2==0},Qr.st=function(t){return new Qr(new Pr(t.slice()))},Qr);function Qr(t){this.path=t}function Hr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function $r(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Xr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Yr.EMPTY=new Yr(new Pr([]));var Jr=(Zr.fromBase64String=function(t){return new Zr(Cs.nt().atob(t))},Zr.fromUint8Array=function(t){return new Zr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Zr.prototype.toBase64=function(){return Cs.nt().btoa(this.it)},Zr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},Zr.prototype.rt=function(){return 2*this.it.length},Zr.prototype.S=function(t){return Qs(this.it,t.it)},Zr.prototype.isEqual=function(t){return this.it===t.it},Zr);function Zr(t){this.it=t}function ti(t){return null==t}function ei(t){return-0===t&&1/t==-1/0}function ni(t){return"number"==typeof t&&Number.isInteger(t)&&!ei(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function ri(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ii(t){var e=li(t.mapValue.fields.__local_write_time__.timestampValue);return new xr(e.seconds,e.nanos)}Jr.ht=new Jr("");var oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ri(t)?4:10:zs()}function ui(r,i){var t,e,n,o=si(r);if(o!==si(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ii(r).isEqual(ii(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=li(r.timestampValue),n=li(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,di(r.bytesValue).isEqual(di(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,pi((t=r).geoPointValue.latitude)===pi(e.geoPointValue.latitude)&&pi(t.geoPointValue.longitude)===pi(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return pi(t.integerValue)===pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=pi(t.doubleValue),r=pi(e.doubleValue);return n===r?ei(n)===ei(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Hs(r.arrayValue.values||[],i.arrayValue.values||[],ui);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Hr(t)!==Hr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!ui(t[n],e[n])))return!1;return!0}();default:return zs()}}function ai(t,e){return void 0!==(t.values||[]).find(function(t){return ui(t,e)})}function hi(t,e){var n,r,i,o,s,u,a,h,c,f,l=si(t),p=si(e);if(l!==p)return Qs(l,p);switch(l){case 0:return 0;case 1:return Qs(t.booleanValue,e.booleanValue);case 2:return h=e,(c=pi(t.integerValue||t.doubleValue))<(f=pi(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return ci(t.timestampValue,e.timestampValue);case 4:return ci(ii(t),ii(e));case 5:return Qs(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=di(o),a=di(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Qs(n[i],r[i]);if(0!==o)return o}return Qs(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Qs(pi(n.latitude),pi(r.latitude)))?i:Qs(pi(n.longitude),pi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=hi(n[i],r[i]);if(o)return o}return Qs(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Qs(r[s],o[s]);if(0!==u)return u;var a=hi(n[r[s]],i[o[s]]);if(0!==a)return a}return Qs(r.length,o.length)}(t.mapValue,e.mapValue);default:throw zs()}}function ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Qs(t,e);var n=li(t),r=li(e),i=Qs(n.seconds,r.seconds);return 0!==i?i:Qs(n.nanos,r.nanos)}function fi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=li(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?di(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Yr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):zs();var t,e,n}(t)}function li(t){if(Ws(!!t),"string"!=typeof t)return{seconds:pi(t.seconds),nanos:pi(t.nanos)};var e,n=0,r=oi.exec(t);Ws(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function di(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}function yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function vi(t){return t&&"integerValue"in t}function gi(t){return!!t&&"arrayValue"in t}function mi(t){return t&&"nullValue"in t}function wi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bi(t){return t&&"mapValue"in t}var Ei=(Ti.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},Ti.prototype.at=function(t,e){return e},Ti.prototype.ut=function(t){return null},Ti.prototype.isEqual=function(t){return t instanceof Ti},Ti);function Ti(){}Ei.instance=new Ei;var Ii=(ki.prototype.ot=function(t,e){return this.apply(t)},ki.prototype.at=function(t,e){return this.apply(t)},ki.prototype.apply=function(t){for(var n=Di(t),e=function(e){n.some(function(t){return ui(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},ki.prototype.ut=function(t){return null},ki.prototype.isEqual=function(t){return t instanceof ki&&Hs(this.elements,t.elements,ui)},ki),Ni=(Si.prototype.ot=function(t,e){return this.apply(t)},Si.prototype.at=function(t,e){return this.apply(t)},Si.prototype.apply=function(t){for(var n=Di(t),e=function(e){n=n.filter(function(t){return!ui(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Si.prototype.ut=function(t){return null},Si.prototype.isEqual=function(t){return t instanceof Si&&Hs(this.elements,t.elements,ui)},Si),Ai=(_i.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return vi(n)&&vi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},_i.prototype.at=function(t,e){return e},_i.prototype.ut=function(t){return vi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},_i.prototype.isEqual=function(t){return t instanceof _i&&ui(this.ct,t.ct)},_i.prototype.asNumber=function(t){return pi(t.integerValue||t.doubleValue)},_i);function _i(t,e){this.serializer=t,this.ct=e}function Si(t){this.elements=t}function ki(t){this.elements=t}function Di(t){return gi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function xi(t,e){this.version=t,this.transformResults=e}var Oi,Ri,Pi,Li,Vi,Ci=(ro.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},ro.prototype.isEqual=function(t){return Hs(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ro),Ui=(no.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},no),ji=(eo.ft=function(){return new eo},eo.exists=function(t){return new eo(void 0,t)},eo.updateTime=function(t){return new eo(t)},Object.defineProperty(eo.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),eo.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof wo&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof wo},eo.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},eo),Mi=(to.prototype.It=function(t){},to.wt=function(t){return t instanceof wo?t.version:Or.min()},to),qi=(n(Zi,Vi=Mi),Zi.prototype.at=function(t,e){this.It(t);var n=e.version;return new wo(this.key,n,this.value,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Mi.wt(t);return new wo(this.key,r,this.value,{At:!0})},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},Zi),Fi=(n(Ji,Li=Mi),Ji.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.gt(t);return new wo(this.key,e.version,n,{hasCommittedMutations:!0})},Ji.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Mi.wt(t),i=this.gt(t);return new wo(this.key,r,i,{At:!0})},Ji.prototype.Pt=function(t){return null},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},Ji.prototype.gt=function(t){var e=t instanceof wo?t.data():Wi.empty();return this.pt(e)},Ji.prototype.pt=function(t){var n=this,r=new Ki(t);return this.Vt.fields.forEach(function(t){var e;t.B()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.yt()},Ji),Bi=(n(Xi,Pi=Mi),Xi.prototype.at=function(t,e){if(this.It(t),Ws(null!=e.transformResults),!this.Rt.Et(t))return new Eo(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new wo(this.key,i,o,{hasCommittedMutations:!0})},Xi.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new wo(this.key,r.version,o,{At:!0})},Xi.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof wo?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Ki).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},Xi.prototype.isEqual=function(t){return t instanceof Xi&&this.key.isEqual(t.key)&&Hs(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},Xi.prototype.bt=function(t){return t},Xi.prototype.vt=function(t,e){var n=[];Ws(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof wo&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},Xi.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof wo&&(a=e.field(s.field)),null===a&&n instanceof wo&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},Xi.prototype.St=function(t,e){for(var n=new Ki(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},Xi),Gi=(n($i,Ri=Mi),$i.prototype.at=function(t,e){return this.It(t),new bo(this.key,e.version,{hasCommittedMutations:!0})},$i.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new bo(this.key,Or.min()):t},$i.prototype.Pt=function(t){return null},$i.prototype.isEqual=function(t){return t instanceof $i&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},$i),zi=(n(Hi,Oi=Mi),Hi.prototype.at=function(t,e){zs()},Hi.prototype.ot=function(t,e,n){zs()},Hi.prototype.Pt=function(t){zs()},Hi.prototype.isEqual=function(t){return t instanceof Hi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Hi),Wi=(Qi.empty=function(){return new Qi({mapValue:{}})},Qi.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!bi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},Qi.prototype.isEqual=function(t){return ui(this.proto,t.proto)},Qi),Ki=(Yi.prototype.set=function(t,e){return this.Nt(t,e),this},Yi.prototype.delete=function(t){return this.Nt(t,null),this},Yi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===si(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Yi.prototype.yt=function(){var t=this.$t(Wr.G,this.Ft);return null!=t?new Wi(t):this.Ct},Yi.prototype.$t=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=bi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.$t(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Yi);function Yi(t){void 0===t&&(t=Wi.empty()),this.Ct=t,this.Ft=new Map}function Qi(t){this.proto=t}function Hi(t,e){var n=this;return(n=Oi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function $i(t,e){var n=this;return(n=Ri.call(this)||this).key=t,n.Rt=e,n.type=3,n}function Xi(t,e){var n=this;return(n=Pi.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=ji.exists(!0),n}function Ji(t,e,n,r){var i=this;return(i=Li.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function Zi(t,e,n){var r=this;return(r=Vi.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function to(){}function eo(t,e){this.updateTime=t,this.exists=e}function no(t,e){this.field=t,this.transform=e}function ro(t){(this.fields=t).sort(Wr.N)}function io(t){var u=[];return $r(t.fields||{},function(t,e){var n=new Wr([t]);if(bi(e)){var r=io(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ci(u)}function oo(t,e){this.key=t,this.version=e}function so(t){this.count=t}var uo,ao,ho,co,fo,lo,po,yo,vo,go,mo,wo=(n(Ko,mo=oo),Ko.prototype.field=function(t){return this.kt.field(t)},Ko.prototype.data=function(){return this.kt},Ko.prototype.Lt=function(){return this.kt.proto},Ko.prototype.isEqual=function(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.kt.isEqual(t.kt)},Ko.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.kt.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Ko.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ko),bo=(n(Wo,go=oo),Wo.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Wo.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Wo.prototype.isEqual=function(t){return t instanceof Wo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Wo),Eo=(n(zo,vo=oo),zo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),zo.prototype.isEqual=function(t){return t instanceof zo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zo),To=(Go.prototype.canonicalId=function(){var t;return null===this.Mt&&(t=this.path.j(),null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ti(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Mt=t),this.Mt},Go.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ti(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Go.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Go.prototype.Ot=function(){return Yr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Go),Io=(Bo.Wt=function(t){return new Bo(t)},Object.defineProperty(Bo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Oo(t)),this.qt.push(new Oo(Wr.J(),"asc"));else{for(var n,r=!1,i=0,o=this.xt;i<o.length;i++){var s=o[i];this.qt.push(s),s.field.Y()&&(r=!0)}r||(n=0<this.xt.length?this.xt[this.xt.length-1].dir:"asc",this.qt.push(new Oo(Wr.J(),n)))}}return this.qt},enumerable:!0,configurable:!0}),Bo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Bo(this.path,this.collectionGroup,this.xt.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.zt=function(t){var e=this.xt.concat([t]);return new Bo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.Ht=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Bo.prototype.Yt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Bo.prototype.Jt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Bo.prototype.Xt=function(t){return new Bo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Bo.prototype.Zt=function(t){return new Bo(t,null,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Bo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.xt.length||1===this.xt.length&&this.xt[0].field.Y())},Bo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Bo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Bo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Bo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Bo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Bo.prototype.oe=function(){return!ti(this.limit)&&"F"===this.Bt},Bo.prototype.ae=function(){return!ti(this.limit)&&"L"===this.Bt},Bo.prototype.Kt=function(){return 0<this.xt.length?this.xt[0].field:null},Bo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof No&&n.ue())return n.field}return null},Bo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof No&&0<=t.indexOf(r.op))return r.op}return null},Bo.prototype.Ot=function(){return this.ee().Ot()},Bo.prototype._e=function(){return null!==this.collectionGroup},Bo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new To(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Oo(r.field,i))}var o=this.endAt?new xo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new xo(this.startAt.position,!this.startAt.before):null;this.Ut=new To(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Bo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Yr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Bo.prototype.ne=function(t){for(var e=0,n=this.xt;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Bo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Bo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Bo.prototype.Qt=function(t){},Bo),No=(n(Fo,yo=function(){}),Fo.create=function(t,e,n){if(t.Y())return"in"===e?new _o(t,n):new Ao(t,e,n);if(mi(n)){if("=="!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fo(t,e,n)}if(wi(n)){if("=="!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fo(t,e,n)}return"array-contains"===e?new So(t,n):"in"===e?new ko(t,n):"array-contains-any"===e?new Do(t,n):new Fo(t,e,n)},Fo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&si(this.value)===si(e)&&this.de(hi(e,this.value))},Fo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return zs()}},Fo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Fo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+fi(this.value)},Fo.prototype.isEqual=function(t){return t instanceof Fo&&this.op===t.op&&this.field.isEqual(t.field)&&ui(this.value,t.value)},Fo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+fi(this.value)},Fo),Ao=(n(qo,po=No),qo.prototype.matches=function(t){var e=Yr.N(t.key,this.key);return this.de(e)},qo),_o=(n(Mo,lo=No),Mo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Mo),So=(n(jo,fo=No),jo.prototype.matches=function(t){var e=t.field(this.field);return gi(e)&&ai(e.arrayValue,this.value)},jo),ko=(n(Uo,co=No),Uo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ai(this.value.arrayValue,e)},Uo),Do=(n(Co,ho=No),Co.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!gi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ai(e.value.arrayValue,t)})},Co),xo=(Vo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(fi).join(",")},Vo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r],n=i.field.Y()?Yr.N(Yr.Z(o.referenceValue),e.key):hi(o,e.field(i.field));if("desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Vo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ui(this.position[e],t.position[e]))return!1;return!0},Vo),Oo=(Lo.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Yr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?hi(i,o):zs());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return zs()}},Lo.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Lo.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Lo.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Lo),Ro=(Po.prototype.Ie=function(t){return new Po(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Po.prototype.we=function(t,e){return new Po(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Po.prototype.Re=function(t){return new Po(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Po);function Po(t,e,n,r,i,o,s){void 0===i&&(i=Or.min()),void 0===o&&(o=Or.min()),void 0===s&&(s=Jr.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Lo(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function Vo(t,e){this.position=t,this.before=e}function Co(t,e){return ho.call(this,t,"array-contains-any",e)||this}function Uo(t,e){return co.call(this,t,"in",e)||this}function jo(t,e){return fo.call(this,t,"array-contains",e)||this}function Mo(t,e){var n=this;return(n=lo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Yr.Z(t.referenceValue)}),n}function qo(t,e,n){var r=this;return(r=po.call(this,t,e,n)||this).key=Yr.Z(n.referenceValue),r}function Fo(t,e,n){var r=this;return(r=yo.call(this)||this).field=t,r.op=e,r.value=n,r}function Bo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Go(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Mt=null}function zo(){return null!==vo&&vo.apply(this,arguments)||this}function Wo(t,e,n){var r=this;return(r=go.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Ko(t,e,n,r){var i=this;return(i=mo.call(this,t,e)||this).kt=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Yo(t){switch(t){case Nr.OK:return zs();case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return 1;default:return zs()}}function Qo(t){if(void 0===t)return Bs("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case uo.OK:return Nr.OK;case uo.CANCELLED:return Nr.CANCELLED;case uo.UNKNOWN:return Nr.UNKNOWN;case uo.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case uo.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case uo.INTERNAL:return Nr.INTERNAL;case uo.UNAVAILABLE:return Nr.UNAVAILABLE;case uo.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case uo.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case uo.NOT_FOUND:return Nr.NOT_FOUND;case uo.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case uo.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case uo.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case uo.ABORTED:return Nr.ABORTED;case uo.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case uo.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case uo.DATA_LOSS:return Nr.DATA_LOSS;default:return zs()}}(ao=uo=uo||{})[ao.OK=0]="OK",ao[ao.CANCELLED=1]="CANCELLED",ao[ao.UNKNOWN=2]="UNKNOWN",ao[ao.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ao[ao.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ao[ao.NOT_FOUND=5]="NOT_FOUND",ao[ao.ALREADY_EXISTS=6]="ALREADY_EXISTS",ao[ao.PERMISSION_DENIED=7]="PERMISSION_DENIED",ao[ao.UNAUTHENTICATED=16]="UNAUTHENTICATED",ao[ao.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ao[ao.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ao[ao.ABORTED=10]="ABORTED",ao[ao.OUT_OF_RANGE=11]="OUT_OF_RANGE",ao[ao.UNIMPLEMENTED=12]="UNIMPLEMENTED",ao[ao.INTERNAL=13]="INTERNAL",ao[ao.UNAVAILABLE=14]="UNAVAILABLE",ao[ao.DATA_LOSS=15]="DATA_LOSS";var Ho=(ts.prototype.Ae=function(t,e){return new ts(this.N,this.root.Ae(t,e,this.N).me(null,null,Xo.Pe,null,null))},ts.prototype.remove=function(t){return new ts(this.N,this.root.remove(t,this.N).me(null,null,Xo.Pe,null,null))},ts.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ts.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ts.prototype.B=function(){return this.root.B()},Object.defineProperty(ts.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),ts.prototype.Ve=function(){return this.root.Ve()},ts.prototype.ge=function(){return this.root.ge()},ts.prototype.pe=function(t){return this.root.pe(t)},ts.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},ts.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ts.prototype.ye=function(t){return this.root.ye(t)},ts.prototype.be=function(){return new $o(this.root,null,this.N,!1)},ts.prototype.ve=function(t){return new $o(this.root,t,this.N,!1)},ts.prototype.Se=function(){return new $o(this.root,null,this.N,!0)},ts.prototype.De=function(t){return new $o(this.root,t,this.N,!0)},ts),$o=(Zo.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},Zo.prototype.$e=function(){return 0<this.Fe.length},Zo.prototype.ke=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},Zo),Xo=(Jo.prototype.me=function(t,e,n,r,i){return new Jo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Jo.prototype.B=function(){return!1},Jo.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},Jo.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},Jo.prototype.min=function(){return this.left.B()?this:this.left.min()},Jo.prototype.Ve=function(){return this.min().key},Jo.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},Jo.prototype.Ae=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.me(null,null,null,r.left.Ae(t,e,n),null):0===i?r.me(null,e,null,null,null):r.me(null,null,null,null,r.right.Ae(t,e,n))).Le()},Jo.prototype.Me=function(){if(this.left.B())return Jo.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.xe()),(t=t.me(null,null,null,t.left.Me(),null)).Le()},Jo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.Oe()||r.left.left.Oe()||(r=r.xe()),r=r.me(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Be()),r.right.B()||r.right.Oe()||r.right.left.Oe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return Jo.EMPTY;n=r.right.min(),r=r.me(n.key,n.value,null,null,r.right.Me())}r=r.me(null,null,null,null,r.right.remove(t,e))}return r.Le()},Jo.prototype.Oe=function(){return this.color},Jo.prototype.Le=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Ue()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Be()),t.left.Oe()&&t.right.Oe()&&(t=t.Qe()),t},Jo.prototype.xe=function(){var t=this.Qe();return t.right.left.Oe()&&(t=(t=(t=t.me(null,null,null,null,t.right.Be())).Ue()).Qe()),t},Jo.prototype.qe=function(){var t=this.Qe();return t.left.left.Oe()&&(t=(t=t.Be()).Qe()),t},Jo.prototype.Ue=function(){var t=this.me(null,null,Jo.RED,null,this.right.left);return this.right.me(null,null,this.color,t,null)},Jo.prototype.Be=function(){var t=this.me(null,null,Jo.RED,this.left.right,null);return this.left.me(null,null,this.color,null,t)},Jo.prototype.Qe=function(){var t=this.left.me(null,null,!this.left.color,null,null),e=this.right.me(null,null,!this.right.color,null,null);return this.me(null,null,!this.color,t,e)},Jo.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},Jo.prototype.je=function(){if(this.Oe()&&this.left.Oe())throw zs();if(this.right.Oe())throw zs();var t=this.left.je();if(t!==this.right.je())throw zs();return t+(this.Oe()?0:1)},Jo);function Jo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Jo.RED,this.left=null!=r?r:Jo.EMPTY,this.right=null!=i?i:Jo.EMPTY,this.size=this.left.size+1+this.right.size}function Zo(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function ts(t,e){this.N=t,this.root=e||Xo.EMPTY}function es(){this.size=0}Xo.EMPTY=null,Xo.RED=!0,Xo.Pe=!1,Xo.EMPTY=(Object.defineProperty(es.prototype,"key",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"value",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"color",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"left",{get:function(){throw zs()},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"right",{get:function(){throw zs()},enumerable:!0,configurable:!0}),es.prototype.me=function(t,e,n,r,i){return this},es.prototype.Ae=function(t,e,n){return new Xo(t,e)},es.prototype.remove=function(t,e){return this},es.prototype.B=function(){return!0},es.prototype.pe=function(t){return!1},es.prototype.ye=function(t){return!1},es.prototype.Ve=function(){return null},es.prototype.ge=function(){return null},es.prototype.Oe=function(){return!1},es.prototype.We=function(){return!0},es.prototype.je=function(){return 0},new es);var ns=(ss.prototype.has=function(t){return null!==this.data.get(t)},ss.prototype.first=function(){return this.data.Ve()},ss.prototype.last=function(){return this.data.ge()},Object.defineProperty(ss.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),ss.prototype.indexOf=function(t){return this.data.indexOf(t)},ss.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},ss.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.$e();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},ss.prototype.Ge=function(t,e){for(var n=void 0!==e?this.data.ve(e):this.data.be();n.$e();)if(!t(n.Ne().key))return},ss.prototype.ze=function(t){var e=this.data.ve(t);return e.$e()?e.Ne().key:null},ss.prototype.be=function(){return new rs(this.data.be())},ss.prototype.ve=function(t){return new rs(this.data.ve(t))},ss.prototype.add=function(t){return this.me(this.data.remove(t).Ae(t,!0))},ss.prototype.delete=function(t){return this.has(t)?this.me(this.data.remove(t)):this},ss.prototype.B=function(){return this.data.B()},ss.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},ss.prototype.isEqual=function(t){if(!(t instanceof ss))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},ss.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ss.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ss.prototype.me=function(t){var e=new ss(this.N);return e.data=t,e},ss),rs=(os.prototype.Ne=function(){return this.Ye.Ne().key},os.prototype.$e=function(){return this.Ye.$e()},os),is=new Ho(Yr.N);function os(t){this.Ye=t}function ss(t){this.N=t,this.data=new Ho(this.N)}var us=new Ho(Yr.N);var as=new Ho(Yr.N);var hs=new ns(Yr.N);function cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var fs=new ns(Qs);function ls(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function ps(t,e){this.targetId=t,this.As=e}function ds(t,e,n,r){void 0===n&&(n=Jr.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ys=(ks.Ze=function(t){return new ks(t.N)},ks.prototype.has=function(t){return null!=this.Je.get(t)},ks.prototype.get=function(t){return this.Je.get(t)},ks.prototype.first=function(){return this.Xe.Ve()},ks.prototype.last=function(){return this.Xe.ge()},ks.prototype.B=function(){return this.Xe.B()},ks.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(ks.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),ks.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},ks.prototype.add=function(t){var e=this.delete(t.key);return e.me(e.Je.Ae(t.key,t),e.Xe.Ae(t,null))},ks.prototype.delete=function(t){var e=this.get(t);return e?this.me(this.Je.remove(t),this.Xe.remove(e)):this},ks.prototype.isEqual=function(t){if(!(t instanceof ks))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},ks.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ks.prototype.me=function(t,e){var n=new ks;return n.N=this.N,n.Je=t,n.Xe=e,n},ks),vs=(Ss.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.Ae(e,t):3===t.type&&1!==n.type?this.ts=this.ts.Ae(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.Ae(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.Ae(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.Ae(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.Ae(e,{type:2,doc:t.doc}):zs()},Ss.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},Ss),gs=(_s.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new _s(t,e,ys.Ze(e),i,n,r,!0,!1)},Object.defineProperty(_s.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),_s.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},_s),ms=(As.ls=function(t,e){var n=new Map;return n.set(t,ws.ds(t,e)),new As(Or.min(),n,fs,is,cs())},As),ws=(Ns.ds=function(t,e){return new Ns(Jr.ht,e,cs(),cs(),cs())},Ns),bs=(Object.defineProperty(Is.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"ys",{get:function(){return 0!==this.ms},enumerable:!0,configurable:!0}),Object.defineProperty(Is.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Is.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Is.prototype.Ss=function(){var n=cs(),r=cs(),i=cs();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:zs()}}),new ws(this.Vs,this.gs,n,r,i)},Is.prototype.Ds=function(){this.ps=!1,this.Ps=xs()},Is.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.Ae(t,e)},Is.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Is.prototype.Ns=function(){this.ms+=1},Is.prototype.$s=function(){--this.ms},Is.prototype.ks=function(){this.ps=!0,this.gs=!0},Is),Es=(Ts.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof wo?this.Us(r,t.Rs):t.Rs instanceof bo&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},Ts.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.$s(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.$s(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.ks(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:zs()}})},Ts.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ms.forEach(function(t,e){r.Gs(e)&&n(e)})},Ts.prototype.Hs=function(t){var e,n,r=t.targetId,i=t.As.count,o=this.Ys(r);o&&((e=o.target).Ot()?0===i?(n=new Yr(e.path),this.Qs(r,n,new bo(n,Or.min()))):Ws(1===i):this.Js(r)!==i&&(this.zs(r),this.Bs=this.Bs.add(r)))},Ts.prototype.Xs=function(i){var o=this,s=new Map;this.Ms.forEach(function(t,e){var n,r=o.Ys(e);r&&(t.fs&&r.target.Ot()&&(n=new Yr(r.target.path),null!==o.Os.get(n)||o.Zs(e,n)||o.Qs(e,n,new bo(n,i))),t.bs&&(s.set(e,t.Ss()),t.Ds()))});var r=cs();this.xs.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new ms(i,s,this.Bs,this.Os,r);return this.Os=is,this.xs=Ds(),this.Bs=new ns(Qs),t},Ts.prototype.Us=function(t,e){var n;this.Gs(t)&&(n=this.Zs(t,e.key)?2:0,this.Ks(t).Cs(e.key,n),this.Os=this.Os.Ae(e.key,e),this.xs=this.xs.Ae(e.key,this.ti(e.key).add(t)))},Ts.prototype.Qs=function(t,e,n){var r;this.Gs(t)&&(r=this.Ks(t),this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.xs=this.xs.Ae(e,this.ti(e).delete(t)),n&&(this.Os=this.Os.Ae(e,n)))},Ts.prototype.removeTarget=function(t){this.Ms.delete(t)},Ts.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ls.ei(t).size+e.Ts.size-e.Is.size},Ts.prototype.Ns=function(t){this.Ks(t).Ns()},Ts.prototype.Ks=function(t){var e=this.Ms.get(t);return e||(e=new bs,this.Ms.set(t,e)),e},Ts.prototype.ti=function(t){var e=this.xs.get(t);return e||(e=new ns(Qs),this.xs=this.xs.Ae(t,e)),e},Ts.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Fs("WatchChangeAggregator","Detected inactive target",t),e},Ts.prototype.Ys=function(t){var e=this.Ms.get(t);return e&&e.ys?null:this.Ls.si(t)},Ts.prototype.zs=function(e){var n=this;this.Ms.set(e,new bs),this.Ls.ei(e).forEach(function(t){n.Qs(e,t,null)})},Ts.prototype.Zs=function(t,e){return this.Ls.ei(t).has(e)},Ts);function Ts(t){this.Ls=t,this.Ms=new Map,this.Os=is,this.xs=Ds(),this.Bs=new ns(Qs)}function Is(){this.ms=0,this.Ps=xs(),this.Vs=Jr.ht,this.gs=!1,this.ps=!0}function Ns(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function As(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function _s(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Ss(){this.ts=new Ho(Yr.N)}function ks(n){this.N=n?function(t,e){return n(t,e)||Yr.N(t.key,e.key)}:function(t,e){return Yr.N(t.key,e.key)},this.Je=us,this.Xe=new Ho(this.N)}function Ds(){return new Ho(Yr.N)}function xs(){return new Ho(Yr.N)}var Os={asc:"ASCENDING",desc:"DESCENDING"},Rs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ps=(Ls.prototype.ni=function(t){var e=void 0===t.code?Nr.UNKNOWN:Qo(t.code);return new Ar(e,t.message||"")},Ls.prototype.ri=function(t){return this.options.hi||ti(t)?t:{value:t}},Ls.prototype.oi=function(t){var e;return ti(e="object"==typeof t?t.value:t)?null:e},Ls.prototype._t=function(t){return{integerValue:""+t}},Ls.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(t)?"-0":t}},Ls.prototype.ai=function(t){return ni(t)?this._t(t):this.lt(t)},Ls.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Ls.prototype.v=function(t){var e=li(t);return new xr(e.seconds,e.nanos)},Ls.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Ls.prototype.ci=function(t){return this.options.hi?(Ws(void 0===t||"string"==typeof t),Jr.fromBase64String(t||"")):(Ws(void 0===t||t instanceof Uint8Array),Jr.fromUint8Array(t||new Uint8Array))},Ls.prototype.toVersion=function(t){return this.C(t.C())},Ls.prototype.fromVersion=function(t){return Ws(!!t),Or.v(this.v(t))},Ls.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Ls.prototype.di=function(t){var e=Pr.K(t);return Ws(Vs(e)),e},Ls.prototype.fi=function(t){return this._i(t.path)},Ls.prototype.Z=function(t){var e=this.di(t);return Ws(e.get(1)===this.ii.projectId),Ws(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Yr(this.Ti(e))},Ls.prototype.Ei=function(t){return this._i(t)},Ls.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Pr.G:this.Ti(e)},Object.defineProperty(Ls.prototype,"wi",{get:function(){return new Pr(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Ls.prototype.li=function(t){return new Pr(["projects",t.projectId,"databases",t.database])},Ls.prototype.Ti=function(t){return Ws(4<t.length&&"documents"===t.get(4)),t.k(5)},Ls.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Ls.prototype.Ai=function(t){return{name:this.fi(t.key),fields:t.Lt().mapValue.fields,updateTime:this.C(t.version.C())}},Ls.prototype.mi=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Wi({mapValue:{fields:t.fields}});return new wo(n,r,i,{hasCommittedMutations:!!e})},Ls.prototype.Pi=function(t){Ws(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Wi({mapValue:{fields:t.found.fields}});return new wo(e,n,r,{})},Ls.prototype.Vi=function(t){Ws(!!t.missing),Ws(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new bo(e,n)},Ls.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):zs()},Ls.prototype.pi=function(t){if("targetChange"in t){t.targetChange;var e=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],r=this.ci(t.targetChange.resumeToken),i=t.targetChange.cause,o=new ds(e,n,r,i&&this.ni(i)||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var u=this.Z(s.document.name),a=this.fromVersion(s.document.updateTime),h=new Wi({mapValue:{fields:s.document.fields}}),c=new wo(u,a,h,{});o=new ls(s.targetIds||[],s.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){t.documentDelete;var f=t.documentDelete;f.document;var l=this.Z(f.document),p=f.readTime?this.fromVersion(f.readTime):Or.min(),d=new bo(l,p);o=new ls([],f.removedTargetIds||[],d.key,d)}else if("documentRemove"in t){t.documentRemove;var y=t.documentRemove;y.document;var v=this.Z(y.document);o=new ls([],y.removedTargetIds||[],v,null)}else{if(!("filter"in t))return zs();t.filter;var g=t.filter;g.targetId;var m=new so(g.count||0);o=new ps(g.targetId,m)}return o},Ls.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:zs()},Ls.prototype.bi=function(t){if(!("targetChange"in t))return Or.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Or.min():this.fromVersion(e.readTime)},Ls.prototype.vi=function(t){var e,n=this;if(t instanceof qi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Gi)e={delete:this.fi(t.key)};else if(t instanceof Fi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Bi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof zi))return zs();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Ls.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):ji.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Wi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.$i(t.updateMask);return new Fi(r,i,o,n)}return new qi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Gi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.ki(t)});return Ws(!0===n.exists),new Bi(u,a)}if(t.verify){var h=this.Z(t.verify);return new zi(h,n)}return zs()},Ls.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:zs()},Ls.prototype.Ni=function(t){return void 0!==t.updateTime?ji.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ji.exists(t.exists):ji.ft()},Ls.prototype.Li=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Or.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new xi(n,r)},Ls.prototype.Mi=function(t,e){var n=this;return t&&0<t.length?(Ws(void 0!==e),t.map(function(t){return n.Li(t,e)})):[]},Ls.prototype.Di=function(t){var e=t.transform;if(e instanceof Ei)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ii)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Ni)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof Ai)return{fieldPath:t.field.j(),increment:e.ct};throw zs()},Ls.prototype.ki=function(t){var e,n,r=null;"setToServerValue"in t?(Ws("REQUEST_TIME"===t.setToServerValue),r=Ei.instance):"appendMissingElements"in t?(e=t.appendMissingElements.values||[],r=new Ii(e)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Ni(n)):"increment"in t?r=new Ai(this,t.increment):zs();var i=Wr.X(t.fieldPath);return new Ui(i,r)},Ls.prototype.Oi=function(t){return{documents:[this.Ei(t.path)]}},Ls.prototype.xi=function(t){Ws(1===t.documents.length);var e=t.documents[0];return Io.Wt(this.Ii(e)).ee()},Ls.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.L()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Ls.prototype.Wi=function(t){var e,n=this.Ii(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Ws(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=this.ji(r.where));var u=[];r.orderBy&&(u=this.Ki(r.orderBy));var a=null;r.limit&&(a=this.oi(r.limit));var h=null;r.startAt&&(h=this.Gi(r.startAt));var c=null;return r.endAt&&(c=this.Gi(r.endAt)),new Io(n,o,u,s,a,"F",h,c).ee()},Ls.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Ls.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return zs()}},Ls.prototype.ee=function(t){var e,n=t.target;return(e=n.Ot()?{documents:this.Oi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Ls.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof No?e.Yi(t):zs()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Ls.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):zs():[]},Ls.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Ls.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Ls.prototype.Qi=function(t){return{before:t.before,values:t.position}},Ls.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new xo(n,e)},Ls.prototype.en=function(t){return Os[t]},Ls.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Ls.prototype.nn=function(t){return Rs[t]},Ls.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return zs()}},Ls.prototype.hn=function(t){return{fieldPath:t.j()}},Ls.prototype.on=function(t){return Wr.X(t.fieldPath)},Ls.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Ls.prototype.tn=function(t){return new Oo(this.on(t.field),this.sn(t.direction))},Ls.prototype.Xi=function(t){return No.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Ls.prototype.Yi=function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(mi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Ls.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return No.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return No.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return zs()}},Ls.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Ls.prototype.$i=function(t){var e=t.fieldPaths||[];return new Ci(e.map(function(t){return Wr.X(t)}))},Ls);function Ls(t,e){this.ii=t,this.options=e}function Vs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Cs=(js.an=function(t){js.platform&&zs(),js.platform=t},js.nt=function(){return js.platform||zs(),js.platform},js),Us=new h("@firebase/firestore");function js(){}function Ms(){return Us.logLevel}function qs(t){Us.logLevel=t}function Fs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Us.logLevel<=l.DEBUG&&(e=n.map(Gs),Us.debug.apply(Us,i(["Firestore ("+mr+"): "+t],e)))}function Bs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Us.logLevel<=l.ERROR&&(e=n.map(Gs),Us.error.apply(Us,i(["Firestore ("+mr+"): "+t],e)))}function Gs(t){if("string"==typeof t)return t;var e=Cs.nt();try{return e.un(t)}catch(e){return t}}function zs(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+mr+") INTERNAL ASSERTION FAILED: "+t;throw Bs(e),new Error(e)}function Ws(t){t||zs()}var Ks=(Ys.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Cs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ys);function Ys(){}function Qs(t,e){return t<e?-1:e<t?1:0}function Hs(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function $s(t){return t+"\0"}function Xs(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Js=(Object.defineProperty(mu.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),mu.prototype.isEqual=function(t){return t instanceof mu&&t.projectId===this.projectId&&t.database===this.database},mu.prototype.S=function(t){return Qs(this.projectId,t.projectId)||Qs(this.database,t.database)},mu),Zs=(gu.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},gu.prototype.has=function(t){return void 0!==this.get(t)},gu.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},gu.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},gu.prototype.forEach=function(u){$r(this.fn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},gu.prototype.B=function(){return Xr(this.fn)},gu),tu=(vu.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o,s=this.mutations[i];s.key.isEqual(t)&&(o=r[i],e=s.at(e,o))}return e},vu.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},vu.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.Ae(t.key,e))}),i},vu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cs())},vu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Hs(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Hs(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},vu),eu=(yu.from=function(t,e,n,r){Ws(t.mutations.length===n.length);for(var i=as,o=t.mutations,s=0;s<o.length;s++)i=i.Ae(o[s].key,n[s].version);return new yu(t,e,n,r,i)},yu),nu=(du.prototype.catch=function(t){return this.next(void 0,t)},du.prototype.next=function(r,i){var o=this;return this.Vn&&zs(),this.Vn=!0,this.Pn?this.error?this.gn(i,this.error):this.pn(r,this.result):new du(function(e,n){o.An=function(t){o.pn(r,t).next(e,n)},o.mn=function(t){o.gn(i,t).next(e,n)}})},du.prototype.yn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},du.prototype.bn=function(t){try{var e=t();return e instanceof du?e:du.resolve(e)}catch(t){return du.reject(t)}},du.prototype.pn=function(t,e){return t?this.bn(function(){return t(e)}):du.resolve(e)},du.prototype.gn=function(t,e){return t?this.bn(function(){return t(e)}):du.reject(e)},du.resolve=function(n){return new du(function(t,e){t(n)})},du.reject=function(n){return new du(function(t,e){e(n)})},du.vn=function(t){return new du(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},du.Sn=function(t){for(var n=du.resolve(!1),e=function(e){n=n.next(function(t){return t?du.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},du.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.vn(i)},du),ru=(Object.defineProperty(pu.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!0,configurable:!0}),pu.prototype.Nn=function(t,e){this.$n(),this.readTime=e,this.Dn.set(t.key,t)},pu.prototype.kn=function(t,e){this.$n(),e&&(this.readTime=e),this.Dn.set(t,null)},pu.prototype.Ln=function(t,e){this.$n();var n=this.Dn.get(e);return void 0!==n?nu.resolve(n):this.Mn(t,e)},pu.prototype.getEntries=function(t,e){return this.On(t,e)},pu.prototype.apply=function(t){return this.$n(),this.Cn=!0,this.xn(t)},pu.prototype.$n=function(){},pu),iu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ou=(lu.prototype.qn=function(t){this.Bn.push(t)},lu.prototype.Un=function(){this.Bn.forEach(function(t){return t()})},lu),su=(fu.prototype.Kn=function(e,n){var r=this;return this.Wn.Gn(e,n).next(function(t){return r.zn(e,n,t)})},fu.prototype.zn=function(t,r,i){return this.Qn.Ln(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},fu.prototype.Hn=function(t,e,i){var o=is;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.Ae(t,e)}),o},fu.prototype.Yn=function(e,t){var n=this;return this.Qn.getEntries(e,t).next(function(t){return n.Jn(e,t)})},fu.prototype.Jn=function(r,i){var o=this;return this.Wn.Xn(r,i).next(function(t){var e=o.Hn(r,i,t),n=is;return e.forEach(function(t,e){e=e||new bo(t,Or.min()),n=n.Ae(t,e)}),n})},fu.prototype.Zn=function(t,e,n){return e.Ot()?this.tr(t,e.path):e._e()?this.er(t,e,n):this.sr(t,e,n)},fu.prototype.tr=function(t,e){return this.Kn(t,new Yr(e)).next(function(t){var e=us;return t instanceof wo&&(e=e.Ae(t.key,t)),e})},fu.prototype.er=function(n,r,i){var o=this,s=r.collectionGroup,u=us;return this.jn.ir(n,s).next(function(t){return nu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.sr(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ae(t,e)})})}).next(function(){return u})})},fu.prototype.sr=function(e,n,t){var c,f,r=this;return this.Qn.Zn(e,n,t).next(function(t){return c=t,r.Wn.nr(e,n)}).next(function(t){return f=t,r.rr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.Tn);c=h instanceof wo?c.Ae(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},fu.prototype.rr=function(t,e,n){for(var r=cs(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Fi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Qn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof wo&&(h=h.Ae(t,e))}),h})},fu),uu=(cu.ar=function(t,e){for(var n=cs(),r=cs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new cu(t,e.fromCache,n,r)},cu),au=(hu.prototype.cr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},hu.prototype.next=function(){var t=++this.previousValue;return this._r&&this._r(t),t},hu);function hu(t,e){var n=this;this.previousValue=t,e&&(e.ur=function(t){return n.cr(t)},this._r=function(t){return e.lr(t)})}function cu(t,e,n,r){this.targetId=t,this.fromCache=e,this.hr=n,this.or=r}function fu(t,e,n){this.Qn=t,this.Wn=e,this.jn=n}function lu(){this.Bn=[]}function pu(){this.Dn=new Zs(function(t){return t.toString()}),this.Cn=!1}function du(t){var e=this;this.An=null,this.mn=null,this.result=void 0,this.error=void 0,this.Pn=!1,this.Vn=!1,t(function(t){e.Pn=!0,e.result=t,e.An&&e.An(t)},function(t){e.Pn=!0,e.error=t,e.mn&&e.mn(t)})}function yu(t,e,n,r,i){this.batch=t,this.wn=e,this.En=n,this.streamToken=r,this.Rn=i}function vu(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function gu(t){this.dn=t,this.fn={}}function mu(t,e){this.projectId=t,this.database=e||"(default)"}function wu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}au.dr=-1;var bu=(Eu.prototype.reset=function(){this.Ar=0},Eu.prototype.Vr=function(){this.Ar=this.Rr},Eu.prototype.gr=function(t){var e=this;this.cancel();var n=Math.floor(this.Ar+this.pr()),r=Math.max(0,Date.now()-this.Pr),i=Math.max(0,n-r);0<i&&Fs("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ar+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mr=this.Tr.yr(this.Er,i,function(){return e.Pr=Date.now(),t()}),this.Ar*=this.wr,this.Ar<this.Ir&&(this.Ar=this.Ir),this.Ar>this.Rr&&(this.Ar=this.Rr)},Eu.prototype.br=function(){null!==this.mr&&(this.mr.vr(),this.mr=null)},Eu.prototype.cancel=function(){null!==this.mr&&(this.mr.cancel(),this.mr=null)},Eu.prototype.pr=function(){return(Math.random()-.5)*this.Ar},Eu);function Eu(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Tr=t,this.Er=e,this.Ir=n,this.wr=r,this.Rr=i,this.Ar=0,this.mr=null,this.Pr=Date.now(),this.reset()}function Tu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Nu(e)),e=Iu(t.get(n),e);return Nu(e)}function Iu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Nu(t){return t+""}function Au(t){var e=t.length;if(Ws(2<=e),2===e)return Ws(""===t.charAt(0)&&""===t.charAt(1)),Pr.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&zs(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:zs()}o=s+2}return new Pr(r)}var _u=(Ou.prototype.Dr=function(t,e){return this.Sr.add(e),nu.resolve()},Ou.prototype.ir=function(t,e){return nu.resolve(this.Sr.getEntries(e))},Ou),Su=(xu.prototype.add=function(t){var e=t.O(),n=t.L(),r=this.index[e]||new ns(Pr.N),i=!r.has(n);return this.index[e]=r.add(n),i},xu.prototype.has=function(t){var e=t.O(),n=t.L(),r=this.index[e];return r&&r.has(n)},xu.prototype.getEntries=function(t){return(this.index[t]||new ns(Pr.N)).W()},xu),ku=(Du.prototype.Dr=function(t,e){var n=this;if(this.Cr.has(e))return nu.resolve();var r=e.O(),i=e.L();t.qn(function(){n.Cr.add(e)});var o={collectionId:r,parent:Tu(i)};return Ru(t).put(o)},Du.prototype.ir=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[$s(i),""],!1,!0);return Ru(t).Fr(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Au(r.parent))}return o})},Du);function Du(){this.Cr=new Su}function xu(){this.index={}}function Ou(){this.Sr=new Su}function Ru(t){return Ju.Nr(t,xa.store)}var Pu,Lu=(Vu.prototype.Nn=function(t,e,n){return Uu(t).put(ju(e),n)},Vu.prototype.kn=function(t,e){var n=Uu(t),r=ju(e);return n.delete(r)},Vu.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.$r(e,t)})},Vu.prototype.Ln=function(t,e){var n=this;return Uu(t).get(ju(e)).next(function(t){return n.kr(t)})},Vu.prototype.Lr=function(t,e){var n=this;return Uu(t).get(ju(e)).next(function(t){var e=n.kr(t);return e?{Mr:e,size:Mu(t)}:null})},Vu.prototype.getEntries=function(t,e){var r=this,i=is;return this.Or(t,e,function(t,e){var n=r.kr(e);i=i.Ae(t,n)}).next(function(){return i})},Vu.prototype.xr=function(t,e){var r=this,i=is,o=new Ho(Yr.N);return this.Or(t,e,function(t,e){var n=r.kr(e);o=n?(i=i.Ae(t,n),o.Ae(t,Mu(e))):(i=i.Ae(t,null),o.Ae(t,0))}).next(function(){return{Br:i,qr:o}})},Vu.prototype.Or=function(t,e,i){if(e.B())return nu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return Uu(t).Ur({range:n},function(t,e,n){for(var r=Yr.st(t);s&&Yr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.$e()?o.Ne():null),s?n.Qr(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.$e()?o.Ne():null})},Vu.prototype.Zn=function(t,i,e){var n,r,o,s=this,u=us,a=i.path.length+1,h={};return e.isEqual(Or.min())?(n=i.path.W(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.W(),o=this.serializer.Wr(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Aa.collectionReadTimeIndex),Uu(t).Ur(h,function(t,e,n){var r;t.length===a&&(r=s.serializer.jr(e),i.path.q(r.key.path)?r instanceof wo&&i.matches(r)&&(u=u.Ae(r.key,r)):n.done())}).next(function(){return u})},Vu.prototype.Kr=function(t,e){var r=this,i=is,o=this.serializer.Wr(e),n=Uu(t),s=IDBKeyRange.lowerBound(o,!0);return n.Ur({index:Aa.readTimeIndex,range:s},function(t,e){var n=r.serializer.jr(e);i=i.Ae(n.key,n),o=e.readTime}).next(function(){return{Gr:i,readTime:r.serializer.zr(o)}})},Vu.prototype.Hr=function(t){var r=this,e=Uu(t),i=Or.min();return e.Ur({index:Aa.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.zr(e.readTime)),n.done()}).next(function(){return i})},Vu.prototype.Yr=function(t){return new Vu.Jr(this,!!t&&t.Xr)},Vu.prototype.Zr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Vu.prototype.getMetadata=function(t){return Cu(t).get(_a.key).next(function(t){return Ws(!!t),t})},Vu.prototype.$r=function(t,e){return Cu(t).put(_a.key,e)},Vu.prototype.kr=function(t){if(t){var e=this.serializer.jr(t);return e instanceof bo&&e.version.isEqual(Or.min())?null:e}return null},Vu);function Vu(t,e){this.serializer=t,this.jn=e}function Cu(t){return Ju.Nr(t,_a.store)}function Uu(t){return Ju.Nr(t,Aa.store)}function ju(t){return t.path.W()}function Mu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw zs();e=t.noDocument}return JSON.stringify(e).length}function qu(t,e){var n=this;return(n=Pu.call(this)||this).th=t,n.Xr=e,n.eh=new Zs(function(t){return t.toString()}),n}Lu.Jr=(n(qu,Pu=ru),qu.prototype.xn=function(s){var u=this,a=[],h=0,c=new ns(function(t,e){return Qs(t.j(),e.j())});return this.Dn.forEach(function(t,e){var n,r,i,o=u.eh.get(t);e?(n=u.th.serializer.sh(e,u.readTime),c=c.add(t.path.L()),r=Mu(n),h+=r-o,a.push(u.th.Nn(s,t,n))):(h-=o,u.Xr?(i=u.th.serializer.sh(new bo(t,Or.min()),u.readTime),a.push(u.th.Nn(s,t,i))):a.push(u.th.kn(s,t)))}),c.forEach(function(t){a.push(u.th.jn.Dr(s,t))}),a.push(this.th.updateMetadata(s,h)),nu.vn(a)},qu.prototype.Mn=function(t,e){var n=this;return this.th.Lr(t,e).next(function(t){return null===t?(n.eh.set(e,0),null):(n.eh.set(e,t.size),t.Mr)})},qu.prototype.On=function(t,e){var n=this;return this.th.xr(t,e).next(function(t){var e=t.Br;return t.qr.forEach(function(t,e){n.eh.set(t,e)}),e})},qu);var Fu=(zu.prototype.next=function(){return this.ih+=2,this.ih},zu.nh=function(){return new zu(0)},zu.rh=function(){return new zu(-1)},zu),Bu=(Gu.prototype.oh=function(n){var r=this;return this.ah(n).next(function(t){var e=new Fu(t.highestTargetId);return t.highestTargetId=e.next(),r.uh(n,t).next(function(){return t.highestTargetId})})},Gu.prototype._h=function(t){return this.ah(t).next(function(t){return Or.v(new xr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Gu.prototype.lh=function(t){return this.ah(t).next(function(t){return t.highestListenSequenceNumber})},Gu.prototype.dh=function(e,n,r){var i=this;return this.ah(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.uh(e,t)})},Gu.prototype.fh=function(e,n){var r=this;return this.Th(e,n).next(function(){return r.ah(e).next(function(t){return t.targetCount+=1,r.Eh(n,t),r.uh(e,t)})})},Gu.prototype.Ih=function(t,e){return this.Th(t,e)},Gu.prototype.wh=function(e,t){var n=this;return this.Rh(e,t.targetId).next(function(){return Wu(e).delete(t.targetId)}).next(function(){return n.ah(e)}).next(function(t){return Ws(0<t.targetCount),--t.targetCount,n.uh(e,t)})},Gu.prototype.Ah=function(r,i,o){var s=this,u=0,a=[];return Wu(r).Ur(function(t,e){var n=s.serializer.mh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.wh(r,n)))}).next(function(){return nu.vn(a)}).next(function(){return u})},Gu.prototype.js=function(t,r){var i=this;return Wu(t).Ur(function(t,e){var n=i.serializer.mh(e);r(n)})},Gu.prototype.ah=function(t){return Ku(t).get(Da.key).next(function(t){return Ws(null!==t),t})},Gu.prototype.uh=function(t,e){return Ku(t).put(Da.key,e)},Gu.prototype.Th=function(t,e){return Wu(t).put(this.serializer.Ph(e))},Gu.prototype.Eh=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Gu.prototype.Vh=function(t){return this.ah(t).next(function(t){return t.targetCount})},Gu.prototype.gh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Wu(t).Ur({range:n,index:Sa.queryTargetsIndexName},function(t,e,n){var r=o.serializer.mh(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Gu.prototype.ph=function(n,t,r){var i=this,o=[],s=Yu(n);return t.forEach(function(t){var e=Tu(t.path);o.push(s.put(new ka(r,e))),o.push(i.hh.yh(n,r,t))}),nu.vn(o)},Gu.prototype.bh=function(n,t,r){var i=this,o=Yu(n);return nu.forEach(t,function(t){var e=Tu(t.path);return nu.vn([o.delete([r,e]),i.hh.vh(n,r,t)])})},Gu.prototype.Rh=function(t,e){var n=Yu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Gu.prototype.Sh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Yu(t),o=cs();return r.Ur({range:n,Dh:!0},function(t,e,n){var r=Au(t[1]),i=new Yr(r);o=o.add(i)}).next(function(){return o})},Gu.prototype.Ch=function(t,e){var n=Tu(e.path),r=IDBKeyRange.bound([n],[$s(n)],!1,!0),i=0;return Yu(t).Ur({index:ka.documentTargetsIndex,Dh:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Gu.prototype.si=function(t,e){var n=this;return Wu(t).get(e).next(function(t){return t?n.serializer.mh(t):null})},Gu);function Gu(t,e){this.hh=t,this.serializer=e}function zu(t){this.ih=t}function Wu(t){return Ju.Nr(t,Sa.store)}function Ku(t){return Ju.Nr(t,Da.store)}function Yu(t){return Ju.Nr(t,ka.store)}var Qu,Hu=(ea.prototype.jr=function(t){if(t.document)return this.Fh.mi(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Yr.st(t.noDocument.path),n=this.Nh(t.noDocument.readTime);return new bo(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Yr.st(t.unknownDocument.path),i=this.Nh(t.unknownDocument.version);return new Eo(r,i)}return zs()},ea.prototype.sh=function(t,e){var n=this.Wr(e),r=t.key.path.L().W();if(t instanceof wo){var i=this.Fh.Ai(t),o=t.hasCommittedMutations;return new Aa(null,null,i,o,n,r)}if(t instanceof bo){var s=t.key.path.W(),u=this.$h(t.version),a=t.hasCommittedMutations;return new Aa(null,new Ia(s,u),null,a,n,r)}if(t instanceof Eo){var h=t.key.path.W(),c=this.$h(t.version);return new Aa(new Na(h,c),null,null,!0,n,r)}return zs()},ea.prototype.Wr=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},ea.prototype.zr=function(t){var e=new xr(t[0],t[1]);return Or.v(e)},ea.prototype.$h=function(t){var e=t.C();return new va(e.seconds,e.nanoseconds)},ea.prototype.Nh=function(t){var e=new xr(t.seconds,t.nanoseconds);return Or.v(e)},ea.prototype.kh=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Fh.vi(t)}),i=e.mutations.map(function(t){return n.Fh.vi(t)});return new ba(t,e.batchId,e.Tn.toMillis(),r,i)},ea.prototype.Lh=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Fh.Fi(t)}),r=t.mutations.map(function(t){return e.Fh.Fi(t)}),i=xr.fromMillis(t.localWriteTimeMs);return new tu(t.batchId,i,n,r)},ea.prototype.mh=function(t){var e=this.Nh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?this.Nh(t.lastLimboFreeSnapshotVersion):Or.min(),r=void 0!==t.query.documents?this.Fh.xi(t.query):this.Fh.Wi(t.query);return new Ro(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Jr.fromBase64String(t.resumeToken))},ea.prototype.Ph=function(t){var e=this.$h(t.Ee),n=this.$h(t.lastLimboFreeSnapshotVersion),r=t.target.Ot()?this.Fh.Oi(t.target):this.Fh.Bi(t.target),i=t.resumeToken.toBase64();return new Sa(t.targetId,t.target.canonicalId(),e,i,t.sequenceNumber,n,r)},ea),$u="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Xu=(n(ta,Qu=ou),ta),Ju=(Zu.Nr=function(t,e){if(t instanceof Xu)return Va.Nr(t.Mh,e);throw zs()},Zu.prototype.start=function(){var e=this;return Va.Xh(this.zh,da,new ya(this.serializer)).then(function(t){return e.Zh=t,e.to()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Ar(Nr.FAILED_PRECONDITION,$u);return e.eo(),e.so(),e.io(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Yh.lh(t)})}).then(function(t){e.Bh=new au(t,e.xh)}).then(function(){e.qh=!0}).catch(function(t){return e.Zh&&e.Zh.close(),Promise.reject(t)})},Zu.prototype.no=function(n){var t=this;return this.Kh=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.ro?[2,n(e)]:[2]})})},n(this.isPrimary)},Zu.prototype.ho=function(n){var t=this;this.Zh.oo(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Zu.prototype.ao=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Tr.uo(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ro?[4,this.to()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Zu.prototype.to=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return ra(e).put(new Ra(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.co(e).next(function(t){t||(n.isPrimary=!1,n.Tr.uo(function(){return n.Kh(!1)}))})}).next(function(){return n._o(e)}).next(function(t){return n.isPrimary&&!t?n.lo(e).next(function(){return!1}):!!t&&n.do(e).next(function(){return!0})})}).catch(function(t){if(n.allowTabSynchronization)return Fs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1;if(Fa(t))return Fs("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;throw t}).then(function(t){n.isPrimary!==t&&n.Tr.uo(function(){return n.Kh(t)}),n.isPrimary=t})},Zu.prototype.co=function(t){var e=this;return na(t).get(ga.key).next(function(t){return nu.resolve(e.fo(t))})},Zu.prototype.To=function(t){return ra(t).delete(this.clientId)},Zu.prototype.Eo=function(){return y(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Io(this.jh,18e5)?[3,2]:(this.jh=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Zu.Nr(t,Ra.store);return r.Fr().next(function(t){var e=i.wo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return nu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.Ro(t.clientId))}),t.label=2;case 2:return[2]}})})},Zu.prototype.io=function(){var t=this;this.Wh=this.Tr.yr("client_metadata_refresh",4e3,function(){return t.to().then(function(){return t.Eo()}).then(function(){return t.io()})})},Zu.prototype.fo=function(t){return!!t&&t.ownerId===this.clientId},Zu.prototype._o=function(e){var i=this;return na(e).get(ga.key).next(function(t){if(null!==t&&i.Io(t.leaseTimestampMs,5e3)&&!i.Ao(t.ownerId)){if(i.fo(t)&&i.networkEnabled)return!0;if(!i.fo(t)){if(!t.allowTabSynchronization)throw new Ar(Nr.FAILED_PRECONDITION,$u);return!1}}return!(!i.networkEnabled||!i.inForeground)||ra(e).Fr().next(function(t){return void 0===i.wo(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Fs("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Zu.prototype.mo=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.qh=!1,this.Po(),this.Wh&&(this.Wh.cancel(),this.Wh=null),this.Vo(),this.po(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.lo(t).next(function(){return e.To(t)})}).catch(function(t){Fs("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.Zh.close(),this.yo(),[2]}})})},Zu.prototype.wo=function(t,e){var n=this;return t.filter(function(t){return n.Io(t.updateTimeMs,e)&&!n.Ao(t.clientId)})},Zu.prototype.bo=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return ra(t).Fr().next(function(t){return e.wo(t,18e5).map(function(t){return t.clientId})})})},Zu.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Zu.Gh()?(e=n+Zu.Hh,[4,Va.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Zu.prototype,"ro",{get:function(){return this.qh},enumerable:!0,configurable:!0}),Zu.prototype.vo=function(t){return ua.So(t,this.serializer,this.jn,this.hh)},Zu.prototype.Do=function(){return this.Yh},Zu.prototype.Co=function(){return this.Qn},Zu.prototype.Fo=function(){return this.jn},Zu.prototype.runTransaction=function(e,n,r){var i=this;Fs("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Zh.runTransaction(t,La,function(t){return o=new Xu(t,i.Bh?i.Bh.next():au.dr),"readwrite-primary"===n?i.co(o).next(function(t){return!!t||i._o(o)}).next(function(t){if(!t)throw Bs("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Tr.uo(function(){return i.Kh(!1)}),new Ar(Nr.FAILED_PRECONDITION,iu);return r(o)}).next(function(t){return i.do(o).next(function(){return t})}):i.No(o).next(function(){return r(o)})}).then(function(t){return o.Un(),t})},Zu.prototype.No=function(t){var e=this;return na(t).get(ga.key).next(function(t){if(null!==t&&e.Io(t.leaseTimestampMs,5e3)&&!e.Ao(t.ownerId)&&!e.fo(t)&&(!e.allowTabSynchronization||!t.allowTabSynchronization))throw new Ar(Nr.FAILED_PRECONDITION,$u)})},Zu.prototype.do=function(t){var e=new ga(this.clientId,this.allowTabSynchronization,Date.now());return na(t).put(ga.key,e)},Zu.Gh=function(){return Va.Gh()},Zu.$o=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Zu.prototype.lo=function(t){var e=this,n=na(t);return n.get(ga.key).next(function(t){return e.fo(t)?(Fs("IndexedDbPersistence","Releasing primary lease."),n.delete(ga.key)):nu.resolve()})},Zu.prototype.Io=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Bs("Detected an update time that is in the future: "+t+" > "+n),1))},Zu.prototype.eo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qh=function(){t.Tr.uo(function(){return t.inForeground="visible"===t.document.visibilityState,t.to()})},this.document.addEventListener("visibilitychange",this.Qh),this.inForeground="visible"===this.document.visibilityState)},Zu.prototype.Vo=function(){this.Qh&&(this.document.removeEventListener("visibilitychange",this.Qh),this.Qh=null)},Zu.prototype.so=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Uh=function(){t.Po(),t.Tr.uo(function(){return t.mo()})},this.window.addEventListener("unload",this.Uh))},Zu.prototype.po=function(){this.Uh&&(this.window.removeEventListener("unload",this.Uh),this.Uh=null)},Zu.prototype.Ao=function(t){try{var e=null!==this.Jh.getItem(this.Ro(t));return Fs("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Zu.prototype.Po=function(){try{this.Jh.setItem(this.Ro(this.clientId),String(Date.now()))}catch(t){Bs("Failed to set zombie client id.",t)}},Zu.prototype.yo=function(){try{this.Jh.removeItem(this.Ro(this.clientId))}catch(t){}},Zu.prototype.Ro=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Zu);function Zu(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Tr=o,this.xh=u,this.Bh=null,this.qh=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Uh=null,this.inForeground=!1,this.Qh=null,this.Wh=null,this.jh=Number.NEGATIVE_INFINITY,this.Kh=function(t){return Promise.resolve()},!Zu.Gh())throw new Ar(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.hh=new ia(this,i),this.zh=e+Zu.Hh,this.serializer=new Hu(s),this.document=r.document,this.Yh=new Bu(this.hh,this.serializer),this.jn=new ku,this.Qn=new Lu(this.serializer,this.jn),!r.window||!r.window.localStorage)throw new Ar(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Jh=this.window.localStorage}function ta(t,e){var n=this;return(n=Qu.call(this)||this).Mh=t,n.Oh=e,n}function ea(t){this.Fh=t}function na(t){return Ju.Nr(t,ga.store)}function ra(t){return Ju.Nr(t,Ra.store)}Ju.Hh="main";var ia=(oa.prototype.Lo=function(t){var n=this.Mo(t);return this.db.Do().Vh(t).next(function(e){return n.next(function(t){return e+t})})},oa.prototype.Mo=function(t){var e=0;return this.Oo(t,function(t){e++}).next(function(){return e})},oa.prototype.js=function(t,e){return this.db.Do().js(t,e)},oa.prototype.Oo=function(t,n){return this.xo(t,function(t,e){return n(e)})},oa.prototype.yh=function(t,e,n){return sa(t,n)},oa.prototype.vh=function(t,e,n){return sa(t,n)},oa.prototype.Ah=function(t,e,n){return this.db.Do().Ah(t,e,n)},oa.prototype.Bo=sa,oa.prototype.qo=function(t,e){return r=e,i=!1,pa(n=t).Uo(function(t){return ha(n,t,r).next(function(t){return t&&(i=!0),nu.resolve(!t)})}).next(function(){return i});var n,r,i},oa.prototype.Qo=function(r,i){var o=this,s=this.db.Co().Yr(),u=[],a=0;return this.xo(r,function(e,t){var n;t<=i&&(n=o.qo(r,e).next(function(t){if(!t)return a++,s.Ln(r,e).next(function(){return s.kn(e),Yu(r).delete([0,Tu(e.path)])})}),u.push(n))}).next(function(){return nu.vn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},oa.prototype.removeTarget=function(t,e){var n=e.Ie(t.Oh);return this.db.Do().Ih(t,n)},oa.prototype.Wo=sa,oa.prototype.xo=function(t,o){var s,e=Yu(t),u=au.dr;return e.Ur({index:ka.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==au.dr&&o(new Yr(Au(s)),u),u=i,s=r):u=au.dr}).next(function(){u!==au.dr&&o(new Yr(Au(s)),u)})},oa.prototype.jo=function(t){return this.db.Co().Zr(t)},oa);function oa(t,e){this.db=t,this.ko=new uh(this,e)}function sa(t,e){return Yu(t).put((n=t.Oh,new ka(0,Tu(e.path),n)));var n}var ua=(aa.So=function(t,e,n,r){return Ws(""!==t.uid),new aa(t.t()?t.uid:"",e,n,r)},aa.prototype.Go=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fa(t).Ur({index:ba.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},aa.prototype.zo=function(e,t,n){return this.Ho(e).next(function(t){return t.lastStreamToken=n.toBase64(),pa(e).put(t)})},aa.prototype.Yo=function(t){return this.Ho(t).next(function(t){return Jr.fromBase64String(t.lastStreamToken)})},aa.prototype.Jo=function(e,n){return this.Ho(e).next(function(t){return t.lastStreamToken=n.toBase64(),pa(e).put(t)})},aa.prototype.Xo=function(h,c,f,l){var p=this,d=la(h),y=fa(h);return y.add({}).next(function(t){Ws("number"==typeof t);for(var e=new tu(t,c,f,l),n=p.serializer.kh(p.userId,e),r=[],i=new ns(function(t,e){return Qs(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=Ea.key(p.userId,u.key.path,t),i=i.add(u.key.path.L());r.push(y.put(n)),r.push(d.put(a,Ea.PLACEHOLDER))}return i.forEach(function(t){r.push(p.jn.Dr(h,t))}),h.qn(function(){p.Ko[t]=e.keys()}),nu.vn(r).next(function(){return e})})},aa.prototype.Zo=function(t,e){var n=this;return fa(t).get(e).next(function(t){return t?(Ws(t.userId===n.userId),n.serializer.Lh(t)):null})},aa.prototype.ta=function(t,n){var r=this;return this.Ko[n]?nu.resolve(this.Ko[n]):this.Zo(t,n).next(function(t){if(t){var e=t.keys();return r.Ko[n]=e}return null})},aa.prototype.ea=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return fa(t).Ur({index:ba.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Ws(e.batchId>=i),o=r.serializer.Lh(e)),n.done()}).next(function(){return o})},aa.prototype.sa=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return fa(t).Ur({index:ba.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},aa.prototype.ia=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fa(t).Fr(ba.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Lh(t)})})},aa.prototype.Gn=function(u,a){var h=this,t=Ea.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return la(u).Ur({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Au(i);if(r===h.userId&&a.path.isEqual(s))return fa(u).get(o).next(function(t){if(!t)throw zs();Ws(t.userId===h.userId),c.push(h.serializer.Lh(t))});n.done()}).next(function(){return c})},aa.prototype.Xn=function(r,t){var a=this,h=new ns(Qs),i=[];return t.forEach(function(u){var t=Ea.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=la(r).Ur({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Au(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),nu.vn(i).next(function(){return a.na(r,h)})},aa.prototype.nr=function(t,e){var u=this,a=e.path,h=a.length+1,n=Ea.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new ns(Qs);return la(t).Ur({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Au(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.na(t,c)})},aa.prototype.na=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(fa(e).get(t).next(function(t){if(null===t)throw zs();Ws(t.userId===n.userId),r.push(n.serializer.Lh(t))}))}),nu.vn(i).next(function(){return r})},aa.prototype.ra=function(e,n){var r=this;return ca(e.Mh,this.userId,n).next(function(t){return e.qn(function(){r.ha(n.batchId)}),nu.forEach(t,function(t){return r.hh.Bo(e,t)})})},aa.prototype.ha=function(t){delete this.Ko[t]},aa.prototype.oa=function(n){var o=this;return this.Go(n).next(function(t){if(!t)return nu.resolve();var e=IDBKeyRange.lowerBound(Ea.prefixForUser(o.userId)),i=[];return la(n).Ur({range:e},function(t,e,n){var r;t[0]===o.userId?(r=Au(t[1]),i.push(r)):n.done()}).next(function(){Ws(0===i.length)})})},aa.prototype.Ch=function(t,e){return ha(t,this.userId,e)},aa.prototype.Ho=function(t){var e=this;return pa(t).get(this.userId).next(function(t){return t||new wa(e.userId,-1,"")})},aa);function aa(t,e,n,r){this.userId=t,this.serializer=e,this.jn=n,this.hh=r,this.Ko={}}function ha(t,o,e){var n=Ea.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return la(t).Ur({range:r,Dh:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function ca(t,e,n){var r=t.store(ba.store),i=t.store(Ea.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Ur({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Ws(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Ea.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return nu.vn(o).next(function(){return h})}function fa(t){return Ju.Nr(t,ba.store)}function la(t){return Ju.Nr(t,Ea.store)}function pa(t){return Ju.Nr(t,wa.store)}var da=10,ya=(ma.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Ws(t<e&&0<=t&&e<=da);var o,s=new Ba(r);t<1&&1<=e&&(n.createObjectStore(ga.store),(o=n).createObjectStore(wa.store,{keyPath:wa.keyPath}),o.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Ea.store),Oa(n),n.createObjectStore(Aa.store));var u,a=nu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(ka.store),u.deleteObjectStore(Sa.store),u.deleteObjectStore(Da.store),Oa(n)),a=a.next(function(){return t=s.store(Da.store),e=new Da(0,0,Or.min().C(),0),t.put(Da.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(ba.store).Fr().next(function(t){r.deleteObjectStore(ba.store),r.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0});var e=i.store(ba.store),n=t.map(function(t){return e.put(t)});return nu.vn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Ra.store,{keyPath:Ra.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(_a.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Aa.store)).createIndex(Aa.readTimeIndex,Aa.readTimeIndexPath,{unique:!1}),t.createIndex(Aa.collectionReadTimeIndex,Aa.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},ma.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Aa.store).Ur(function(t,e){n+=Mu(e)}).next(function(){var t=new _a(n);return e.store(_a.store).put(_a.key,t)})},ma.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(wa.store),e=r.store(ba.store);return t.Fr().next(function(t){return nu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Fr(ba.userMutationsIndex,t).next(function(t){return nu.forEach(t,function(t){Ws(t.userId===n.userId);var e=i.serializer.Lh(t);return ca(r,n.userId,e).next(function(){})})})})})},ma.prototype.ensureSequenceNumbers=function(t){var s=t.store(ka.store),e=t.store(Aa.store);return t.store(Da.store).get(Da.key).next(function(i){var o=[];return e.Ur(function(t,e){var n=new Pr(t),r=[0,Tu(n)];o.push(s.get(r).next(function(t){return t?nu.resolve():s.put(new ka(0,Tu(n),i.highestListenSequenceNumber))}))}).next(function(){return nu.vn(o)})})},ma.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.O(),n=t.L();return i.put({collectionId:e,parent:Tu(n)})}}t.createObjectStore(xa.store,{keyPath:xa.keyPath});var i=e.store(xa.store),o=new Su;return e.store(Aa.store).Ur({Dh:!0},function(t,e){return r(new Pr(t).L())}).next(function(){return e.store(Ea.store).Ur({Dh:!0},function(t,e){t[0];var n=t[1];return r((t[2],Au(n)).L())})})},ma.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Sa.store);return o.Ur(function(t,e){var n=i.serializer.mh(e),r=i.serializer.Ph(n);return o.put(r)})},ma),va=function(t,e){this.seconds=t,this.nanoseconds=e},ga=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function ma(t){this.serializer=t}ga.store="owner",ga.key="owner";var wa=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};wa.store="mutationQueues",wa.keyPath="userId";var ba=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ba.store="mutations",ba.keyPath="batchId",ba.userMutationsIndex="userMutationsIndex",ba.userMutationsKeyPath=["userId","batchId"];var Ea=(Ta.prefixForUser=function(t){return[t]},Ta.prefixForPath=function(t,e){return[t,Tu(e)]},Ta.key=function(t,e,n){return[t,Tu(e),n]},Ta);function Ta(){}Ea.store="documentMutations",Ea.PLACEHOLDER=new Ea;var Ia=function(t,e){this.path=t,this.readTime=e},Na=function(t,e){this.path=t,this.version=e},Aa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Aa.store="remoteDocuments",Aa.readTimeIndex="readTimeIndex",Aa.readTimeIndexPath="readTime",Aa.collectionReadTimeIndex="collectionReadTimeIndex",Aa.collectionReadTimeIndexPath=["parentPath","readTime"];var _a=function(t){this.byteSize=t};_a.store="remoteDocumentGlobal",_a.key="remoteDocumentGlobalKey";var Sa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Sa.store="targets",Sa.keyPath="targetId",Sa.queryTargetsIndexName="queryTargetsIndex",Sa.queryTargetsKeyPath=["canonicalId","targetId"];var ka=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ka.store="targetDocuments",ka.keyPath=["targetId","path"],ka.documentTargetsIndex="documentTargetsIndex",ka.documentTargetsKeyPath=["path","targetId"];var Da=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Da.key="targetGlobalKey",Da.store="targetGlobal";var xa=function(t,e){this.collectionId=t,this.parent=e};function Oa(t){t.createObjectStore(ka.store,{keyPath:ka.keyPath}).createIndex(ka.documentTargetsIndex,ka.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Sa.store,{keyPath:Sa.keyPath}).createIndex(Sa.queryTargetsIndexName,Sa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Da.store)}xa.store="collectionParents",xa.keyPath=["collectionId","parent"];var Ra=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ra.store="clientMetadata",Ra.keyPath="clientId";var Pa,La=i(i(i([wa.store,ba.store,Ea.store,Aa.store,Sa.store,ga.store,Da.store,ka.store],[Ra.store]),[_a.store]),[xa.store]),Va=(qa.Xh=function(o,t,s){return Fs("SimpleDb","Opening database:",o),new nu(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new qa(e))},i.onblocked=function(){r(new Ar(Nr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Ar(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Fs("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,da).next(function(){Fs("SimpleDb","Database upgrade to version "+da+" complete")})}}).yn()},qa.delete=function(t){return Fs("SimpleDb","Removing database:",t),Ka(window.indexedDB.deleteDatabase(t)).yn()},qa.Gh=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(qa.ua())return!0;if(void 0===window.navigator)return!1;var t=p(),e=qa.aa(t),n=0<e&&e<10,r=qa.ca(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},qa.ua=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t._a)},qa.Nr=function(t,e){return t.store(e)},qa.aa=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},qa.ca=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},qa.prototype.oo=function(e){this.db.onversionchange=function(t){return e(t)}},qa.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Ba.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),nu.reject(t)}).yn(),r={},n.catch(function(){}),[4,e.la];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Fs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},qa.prototype.close=function(){this.db.close()},qa),Ca=(Object.defineProperty(Ma.prototype,"Pn",{get:function(){return this.fa},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"Ea",{get:function(){return this.Ta},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"cursor",{set:function(t){this.da=t},enumerable:!0,configurable:!0}),Ma.prototype.done=function(){this.fa=!0},Ma.prototype.Qr=function(t){this.Ta=t},Ma.prototype.delete=function(){return Ka(this.da.delete())},Ma),Ua=(n(ja,Pa=Ar),ja);function ja(t){var e=this;return(e=Pa.call(this,Nr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Ma(t){this.da=t,this.fa=!1,this.Ta=null}function qa(t){this.db=t,12.2===qa.aa(p())&&Bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Fa(t){return"IndexedDbTransactionError"===t.name}var Ba=(Wa.open=function(t,e,n){return new Wa(t.transaction(n,e))},Object.defineProperty(Wa.prototype,"la",{get:function(){return this.Ia.promise},enumerable:!0,configurable:!0}),Wa.prototype.abort=function(t){t&&this.Ia.reject(t),this.aborted||(Fs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Wa.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ga(e)},Wa),Ga=(za.prototype.put=function(t,e){return Ka(void 0!==e?(Fs("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Fs("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},za.prototype.add=function(t){return Fs("SimpleDb","ADD",this.store.name,t,t),Ka(this.store.add(t))},za.prototype.get=function(e){var n=this;return Ka(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Fs("SimpleDb","GET",n.store.name,e,t),t})},za.prototype.delete=function(t){return Fs("SimpleDb","DELETE",this.store.name,t),Ka(this.store.delete(t))},za.prototype.count=function(){return Fs("SimpleDb","COUNT",this.store.name),Ka(this.store.count())},za.prototype.Fr=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.wa(n,function(t,e){r.push(e)}).next(function(){return r})},za.prototype.Ra=function(t,e){Fs("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Dh=!1;var r=this.cursor(n);return this.wa(r,function(t,e,n){return n.delete()})},za.prototype.Ur=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.wa(r,e)},za.prototype.Uo=function(i){var t=this.cursor({});return new nu(function(n,r){t.onerror=function(t){var e=Qa(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},za.prototype.wa=function(t,s){var u=[];return new nu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Ca(i),(n=s(i.primaryKey,i.value,e))instanceof nu&&(r=n.catch(function(t){return e.done(),nu.reject(t)}),u.push(r)),e.Pn?o():null===e.Ea?i.continue():i.continue(e.Ea)):o()}}).next(function(){return nu.vn(u)})},za.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},za.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Dh?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},za);function za(t){this.store=t}function Wa(t){var n=this;this.transaction=t,this.aborted=!1,this.Ia=new wu,this.transaction.oncomplete=function(){n.Ia.resolve()},this.transaction.onabort=function(){t.error?n.Ia.reject(new Ua(t.error)):n.Ia.resolve()},this.transaction.onerror=function(t){var e=Qa(t.target.error);n.Ia.reject(new Ua(e))}}function Ka(t){return new nu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Qa(t.target.error);r(e)}})}var Ya=!1;function Qa(t){var e=Va.aa(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Ar("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ya||(Ya=!0,setTimeout(function(){throw r},0)),r}}return t}var Ha=(Ja.ga=function(t,e,n,r,i){var o=new Ja(t,e,Date.now()+n,r,i);return o.start(n),o},Ja.prototype.start=function(t){var e=this;this.pa=setTimeout(function(){return e.ya()},t)},Ja.prototype.vr=function(){return this.ya()},Ja.prototype.cancel=function(t){null!==this.pa&&(this.clearTimeout(),this.Va.reject(new Ar(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ja.prototype.ya=function(){var e=this;this.Aa.uo(function(){return null!==e.pa?(e.clearTimeout(),e.op().then(function(t){return e.Va.resolve(t)})):Promise.resolve()})},Ja.prototype.clearTimeout=function(){null!==this.pa&&(this.Pa(this),clearTimeout(this.pa),this.pa=null)},Ja),$a=(Object.defineProperty(Xa.prototype,"La",{get:function(){return this.Sa},enumerable:!0,configurable:!0}),Xa.prototype.uo=function(t){this.enqueue(t)},Xa.prototype.Ma=function(t){this.Oa(),this.xa(t)},Xa.prototype.Ba=function(t){return this.Oa(),this.xa(t)},Xa.prototype.qa=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Oa(),this.Sa?[3,2]:(this.Sa=!0,(e=Cs.nt().window)&&e.removeEventListener("visibilitychange",this.ka),[4,this.Ba(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Xa.prototype.enqueue=function(t){return this.Oa(),this.Sa?new Promise(function(t){}):this.xa(t)},Xa.prototype.Ua=function(i){var t=this;this.Oa(),this.Sa||(this.va=this.va.then(function(){var n=new wu,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.$a.reset(),[3,3];case 2:if(!Fa(e=t.sent()))throw n.resolve(),e;return Fs("AsyncQueue","Operation failed with retryable error: "+e),this.$a.gr(r),[3,3];case 3:return[2]}})})};return t.uo(r),n.promise}))},Xa.prototype.xa=function(t){var e=this,n=this.ba.then(function(){return e.Fa=!0,t().catch(function(t){throw e.Ca=t,e.Fa=!1,Bs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.Fa=!1,t})});return this.ba=n},Xa.prototype.yr=function(t,e,n){var r=this;this.Oa(),-1<this.Na.indexOf(t)&&(e=0);var i=Ha.ga(this,t,e,n,function(t){return r.Qa(t)});return this.Da.push(i),i},Xa.prototype.Oa=function(){this.Ca&&zs()},Xa.prototype.Wa=function(){},Xa.prototype.ja=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.ba];case 1:t.sent(),t.label=2;case 2:if(e!==this.ba)return[3,0];t.label=3;case 3:return[2]}})})},Xa.prototype.Ka=function(t){for(var e=0,n=this.Da;e<n.length;e++)if(n[e].Er===t)return!0;return!1},Xa.prototype.Ga=function(r){var i=this;return this.ja().then(function(){i.Da.sort(function(t,e){return t.ma-e.ma});for(var t=0,e=i.Da;t<e.length;t++){var n=e[t];if(n.vr(),"all"!==r&&n.Er===r)break}return i.ja()})},Xa.prototype.za=function(t){this.Na.push(t)},Xa.prototype.Qa=function(t){var e=this.Da.indexOf(t);this.Da.splice(e,1)},Xa);function Xa(){var t=this;this.ba=Promise.resolve(),this.va=Promise.resolve(),this.Sa=!1,this.Da=[],this.Ca=null,this.Fa=!1,this.Na=[],this.$a=new bu(this,"async_queue_retry"),this.ka=function(){return t.$a.br()};var e=Cs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ka)}function Ja(t,e,n,r,i){this.Aa=t,this.Er=e,this.ma=n,this.op=r,this.Pa=i,this.Va=new wu,this.then=this.Va.promise.then.bind(this.Va.promise),this.Va.promise.catch(function(t){})}function Za(t,e){if(Bs("AsyncQueue",e+": "+t),Fa(t))return new Ar(Nr.UNAVAILABLE,e+": "+t);throw t}function th(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Qs(n,i);return 0===s?Qs(r,o):s}var eh=(oh.prototype.Ja=function(){return++this.Ya},oh.prototype.Xa=function(t){var e,n=[t,this.Ja()];this.buffer.size<this.Ha?this.buffer=this.buffer.add(n):th(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(oh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),oh),nh={Za:!1,tu:0,eu:0,su:0},rh=(ih.hu=function(t){return new ih(t,ih.ou,ih.au)},ih);function ih(t,e,n){this.iu=t,this.nu=e,this.ru=n}function oh(t){this.Ha=t,this.buffer=new ns(th),this.Ya=0}rh.uu=-1,rh.cu=1048576,rh._u=41943040,rh.ou=10,rh.au=1e3,rh.lu=new rh(rh._u,rh.ou,rh.au),rh.DISABLED=new rh(rh.uu,0,0);var sh=(fh.prototype.start=function(t){this.ko.Tu.iu!==rh.uu&&this.Eu(t)},fh.prototype.stop=function(){this.fu&&(this.fu.cancel(),this.fu=null)},Object.defineProperty(fh.prototype,"ro",{get:function(){return null!==this.fu},enumerable:!0,configurable:!0}),fh.prototype.Eu=function(n){var t=this,e=this.du?3e5:6e4;Fs("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.fu=this.Aa.yr("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.fu=null,this.du=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Iu(this.ko)];case 2:return t.sent(),[3,7];case 3:return Fa(e=t.sent())?(Fs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,yh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Eu(n)];case 8:return t.sent(),[2]}})})})},fh),uh=(ch.prototype.Ru=function(t,e){return this.wu.Lo(t).next(function(t){return Math.floor(e/100*t)})},ch.prototype.Au=function(t,e){var n=this;if(0===e)return nu.resolve(au.dr);var r=new eh(e);return this.wu.js(t,function(t){return r.Xa(t.sequenceNumber)}).next(function(){return n.wu.Oo(t,function(t){return r.Xa(t)})}).next(function(){return r.maxValue})},ch.prototype.Ah=function(t,e,n){return this.wu.Ah(t,e,n)},ch.prototype.Qo=function(t,e){return this.wu.Qo(t,e)},ch.prototype.mu=function(e,n){var r=this;return this.Tu.iu===rh.uu?(Fs("LruGarbageCollector","Garbage collection skipped; disabled"),nu.resolve(nh)):this.jo(e).next(function(t){return t<r.Tu.iu?(Fs("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.Tu.iu),nh):r.Pu(e,n)})},ch.prototype.jo=function(t){return this.wu.jo(t)},ch.prototype.Pu=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Ru(e,this.Tu.nu).next(function(t){return i=t>c.Tu.ru?(Fs("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.Tu.ru+" from "+t),c.Tu.ru):t,s=Date.now(),c.Au(e,i)}).next(function(t){return r=t,u=Date.now(),c.Ah(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Qo(e,r)}).next(function(t){return h=Date.now(),Ms()<=l.DEBUG&&Fs("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),nu.resolve({Za:!0,tu:i,eu:o,su:t})})},ch),ah=(hh.prototype.start=function(){return Promise.resolve()},hh.prototype.Du=function(i){return y(this,void 0,void 0,function(){var e,m,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Wn,m=this.vu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.Wn.ia(v).next(function(t){return g=t,e=r.persistence.vo(i),m=new su(r.bu,e,r.persistence.Fo()),e.ia(v)}).next(function(t){for(var e=[],n=[],r=cs(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Yn(v,r).next(function(t){return{Cu:t,Fu:e,Nu:n}})})})];case 1:return n=t.sent(),[2,(this.Wn=e,this.vu=m,this.Vu.Su(this.vu),n)]}})})},hh.prototype.$u=function(u){var a,h=this,c=xr.now(),t=u.reduce(function(t,e){return t.add(e.key)},cs());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.vu.Yn(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new Fi(i.key,o,io(o.proto.mapValue),ji.exists(!0)))}return h.Wn.Xo(s,c,e,u)})}).then(function(t){var e=t.In(a);return{batchId:t.batchId,Dn:e}})},hh.prototype.zo=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.bu.Yr({Xr:!0});return i.Wn.zo(t,r.batch,r.streamToken).next(function(){return i.ku(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Wn.oa(t)}).next(function(){return i.vu.Yn(t,e)})})},hh.prototype.Lu=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.Wn.Zo(e,t).next(function(t){return Ws(null!==t),n=t.keys(),r.Wn.ra(e,t)}).next(function(){return r.Wn.oa(e)}).next(function(){return r.vu.Yn(e,n)})})},hh.prototype.sa=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Wn.sa(t)})},hh.prototype.Yo=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.Wn.Yo(t)})},hh.prototype.Jo=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.Wn.Jo(t,e)})},hh.prototype._h=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Yh._h(t)})},hh.prototype.Mu=function(a){var h=this,c=a.Ee,f=this.gu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.bu.Yr({Xr:!0});f=h.gu;var s=[];a.as.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.Yh.bh(o,t.Is,e).next(function(){return h.Yh.ph(o,t.Ts,e)})),0<(n=t.resumeToken).rt()&&(r=i.we(n,c).Ie(o.Oh),f=f.Ae(e,r),hh.Ou(i,r,t)&&s.push(h.Yh.Ih(o,r))))});var t,u=is,n=cs();return a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof bo&&e.version.isEqual(Or.min())?(i.kn(t,c),u=u.Ae(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Nn(e,c),u=u.Ae(t,e)):Fs("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.hh.Wo(o,t))})})),c.isEqual(Or.min())||(t=h.Yh._h(o).next(function(t){return h.Yh.dh(o,o.Oh,c)}),s.push(t)),nu.vn(s).next(function(){return i.apply(o)}).next(function(){return h.vu.Jn(o,u)})}).then(function(t){return h.gu=f,t})},hh.Ou=function(t,e,n){return Ws(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.xu||0<n.Ts.size+n.Es.size+n.Is.size},hh.prototype.Bu=function(c){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return nu.forEach(c,function(e){return nu.forEach(e.hr,function(t){return h.persistence.hh.yh(n,e.targetId,t)}).next(function(){return nu.forEach(e.or,function(t){return h.persistence.hh.vh(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!Fa(e=t.sent()))throw e;return Fs("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.gu.get(o),u=s.Ee,a=s.Re(u),this.gu=this.gu.Ae(o,a));return[2]}})})},hh.prototype.qu=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Wn.ea(t,e)})},hh.prototype.Uu=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.vu.Kn(t,e)})},hh.prototype.Qu=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Yh.gh(e,r).next(function(t){return t?(n=t,nu.resolve(n)):i.Yh.oh(e).next(function(t){return n=new Ro(r,t,0,e.Oh),i.Yh.fh(e,n).next(function(){return n})})})}).then(function(t){return null===i.gu.get(t.targetId)&&(i.gu=i.gu.Ae(t.targetId,t),i.pu.set(r,t.targetId)),t})},hh.prototype.gh=function(t,e){var n=this.pu.get(e);return void 0!==n?nu.resolve(this.gu.get(n)):this.Yh.gh(t,e)},hh.prototype.Wu=function(t,e){var n=this,r=this.gu.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,function(t){return e?nu.resolve():n.persistence.hh.removeTarget(t,r)}).then(function(){n.gu=n.gu.remove(t),n.pu.delete(r.target)})},hh.prototype.ju=function(t,n){var r=this,i=Or.min(),o=cs();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.gh(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Yh.Sh(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Vu.Zn(e,t,n?i:Or.min(),n?o:cs())}).next(function(t){return{documents:t,Ku:o}})})},hh.prototype.ku=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=nu.resolve();return n.forEach(function(r){u=u.next(function(){return o.Ln(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Ws(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Nn(e,i.wn)})}),u.next(function(){return e.Wn.ra(t,s)})},hh.prototype.Iu=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.mu(t,n.gu)})},hh);function hh(t,e,n){this.persistence=t,this.Vu=e,this.gu=new Ho(Qs),this.pu=new Zs(function(t){return t.canonicalId()}),this.yu=Or.min(),this.Wn=t.vo(n),this.bu=t.Co(),this.Yh=t.Do(),this.vu=new su(this.bu,this.Wn,this.persistence.Fo()),this.Vu.Su(this.vu)}function ch(t,e){this.wu=t,this.Tu=e}function fh(t,e){this.ko=t,this.Aa=e,this.du=!1,this.fu=null}ah.xu=3e8;var lh,ph=(n(dh,lh=ah),dh.prototype.start=function(){return this.Gu()},dh.prototype.zu=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.Wn.ta(e,t).next(function(t){return t?n.vu.Yn(e,t):nu.resolve(null)})})},dh.prototype.Hu=function(t){this.Wn.ha(t)},dh.prototype.ao=function(t){this.persistence.ao(t)},dh.prototype.bo=function(){return this.persistence.bo()},dh.prototype.Yu=function(e){var n=this,t=this.gu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.Yh.si(t,e).next(function(t){return t?t.target:null})})},dh.prototype.Kr=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.bu.Kr(t,r.yu)}).then(function(t){var e=t.Gr,n=t.readTime;return r.yu=n,e})},dh.prototype.Gu=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.bu.Hr(t)})];case 1:return e.yu=t.sent(),[2]}})})},dh);function dh(t,e,n){var r=this;return(r=lh.call(this,t,e,n)||this).persistence=t,r.Wn=t.vo(n),r.bu=t.Co(),r.Yh=t.Do(),r}function yh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Nr.FAILED_PRECONDITION||e.message!==iu)throw e;return Fs("LocalStore","Unexpectedly lost primary lease"),[2]})})}var vh=(wh.prototype.B=function(){return this.Ju.B()},wh.prototype.yh=function(t,e){var n=new gh(t,e);this.Ju=this.Ju.add(n),this.Zu=this.Zu.add(n)},wh.prototype.ec=function(t,e){var n=this;t.forEach(function(t){return n.yh(t,e)})},wh.prototype.vh=function(t,e){this.sc(new gh(t,e))},wh.prototype.ic=function(t,e){var n=this;t.forEach(function(t){return n.vh(t,e)})},wh.prototype.nc=function(t){var e=this,n=Yr.EMPTY,r=new gh(n,t),i=new gh(n,t+1),o=[];return this.Zu.Ke([r,i],function(t){e.sc(t),o.push(t.key)}),o},wh.prototype.rc=function(){var e=this;this.Ju.forEach(function(t){return e.sc(t)})},wh.prototype.sc=function(t){this.Ju=this.Ju.delete(t),this.Zu=this.Zu.delete(t)},wh.prototype.hc=function(t){var e=Yr.EMPTY,n=new gh(e,t),r=new gh(e,t+1),i=cs();return this.Zu.Ke([n,r],function(t){i=i.add(t.key)}),i},wh.prototype.Ch=function(t){var e=new gh(t,0),n=this.Ju.ze(e);return null!==n&&t.isEqual(n.key)},wh),gh=(mh.Xu=function(t,e){return Yr.N(t.key,e.key)||Qs(t.oc,e.oc)},mh.tc=function(t,e){return Qs(t.oc,e.oc)||Yr.N(t.key,e.key)},mh);function mh(t,e){this.key=t,this.oc=e}function wh(){this.Ju=new ns(gh.Xu),this.Zu=new ns(gh.tc)}function bh(t,e){if(0!==e.length)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Uh(e.length,"argument")+".")}function Eh(t,e,n){if(e.length!==n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires "+Uh(n,"argument")+", but was called with "+Uh(e.length,"argument")+".")}function Th(t,e,n){if(e.length<n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Uh(n,"argument")+", but was called with "+Uh(e.length,"argument")+".")}function Ih(t,e,n,r){if(e.length<n||e.length>r)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Uh(e.length,"argument")+".")}function Nh(t,e,n,r){Dh(t,e,Ch(n)+" argument",r)}function Ah(t,e,n,r){void 0!==r&&Nh(t,e,n,r)}function _h(t,e,n,r){Dh(t,e,n+" option",r)}function Sh(t,e,n,r){void 0!==r&&_h(t,e,n,r)}function kh(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Oh(s))}var u=Oh(n);throw new Ar(Nr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Dh(t,e,n,r){if(!("object"===e?xh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Oh(r);throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function xh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Oh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":zs();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Rh(t,e,n){if(void 0===n)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Ch(e)+" argument, but it was undefined.")}function Ph(n,t,r){$r(t,function(t,e){if(r.indexOf(t)<0)throw new Ar(Nr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Lh(t,e,n,r){var i=Oh(r);return new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Ch(n)+" argument to be a "+e+", but it was: "+i)}function Vh(t,e,n){if(n<=0)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Ch(e)+" argument to be a positive number, but it was: "+n+".")}function Ch(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Uh(t,e){return t+" "+e+(1===t?"":"s")}function jh(){if("undefined"==typeof Uint8Array)throw new Ar(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Mh(){if(!Cs.nt().ac)throw new Ar(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var qh=(Gh.fromBase64String=function(t){Eh("Blob.fromBase64String",arguments,1),Nh("Blob.fromBase64String","string",1,t),Mh();try{return new Gh(Jr.fromBase64String(t))}catch(t){throw new Ar(Nr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Gh.fromUint8Array=function(t){if(Eh("Blob.fromUint8Array",arguments,1),jh(),!(t instanceof Uint8Array))throw Lh("Blob.fromUint8Array","Uint8Array",1,t);return new Gh(Jr.fromUint8Array(t))},Gh.prototype.toBase64=function(){return Eh("Blob.toBase64",arguments,0),Mh(),this.uc.toBase64()},Gh.prototype.toUint8Array=function(){return Eh("Blob.toUint8Array",arguments,0),jh(),this.uc.toUint8Array()},Gh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Gh.prototype.isEqual=function(t){return this.uc.isEqual(t.uc)},Gh),Fh=(Bh.documentId=function(){return Bh._c},Bh.prototype.isEqual=function(t){if(!(t instanceof Bh))throw Lh("isEqual","FieldPath",1,t);return this.cc.isEqual(t.cc)},Bh);function Bh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new Ar(Nr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(Nh("FieldPath","string",n,t[n]),0===t[n].length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.cc=new Wr(t)}function Gh(t){Mh(),this.uc=t}Fh._c=new Fh(Wr.J().j());var zh,Wh,Kh,Yh,Qh,Hh=new RegExp("[~\\*/\\[\\]]"),$h=function(t){this.lc=t},Xh=(n(pc,Qh=$h),pc.prototype.Di=function(t){if(2!==t.dc)throw 1===t.dc?t.fc("FieldValue.delete() can only appear at the top level of your update data"):t.fc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},pc.prototype.isEqual=function(t){return t instanceof pc},pc),Jh=(n(lc,Yh=$h),lc.prototype.Di=function(t){return new Ui(t.path,Ei.instance)},lc.prototype.isEqual=function(t){return t instanceof lc},lc),Zh=(n(fc,Kh=$h),fc.prototype.Di=function(t){var e=new yc({dc:3,methodName:this.lc,Ec:!0},t.ii,t.serializer,t.ignoreUndefinedProperties),n=this.Tc.map(function(t){return wc(t,e)}),r=new Ii(n);return new Ui(t.path,r)},fc.prototype.isEqual=function(t){return this===t},fc),tc=(n(cc,Wh=$h),cc.prototype.Di=function(t){var e=new yc({dc:3,methodName:this.lc,Ec:!0},t.ii,t.serializer,t.ignoreUndefinedProperties),n=this.Tc.map(function(t){return wc(t,e)}),r=new Ni(n);return new Ui(t.path,r)},cc.prototype.isEqual=function(t){return this===t},cc),ec=(n(hc,zh=$h),hc.prototype.Di=function(t){var e=new yc({dc:3,methodName:this.lc},t.ii,t.serializer,t.ignoreUndefinedProperties),n=wc(this.Ic,e),r=new Ai(t.serializer,n);return new Ui(t.path,r)},hc.prototype.isEqual=function(t){return this===t},hc),nc=(Object.defineProperty(ac.prototype,"latitude",{get:function(){return this.wc},enumerable:!0,configurable:!0}),Object.defineProperty(ac.prototype,"longitude",{get:function(){return this.Rc},enumerable:!0,configurable:!0}),ac.prototype.isEqual=function(t){return this.wc===t.wc&&this.Rc===t.Rc},ac.prototype.p=function(t){return Qs(this.wc,t.wc)||Qs(this.Rc,t.Rc)},ac),rc=/^__.*__$/,ic=(uc.prototype.Ac=function(t,e){var n=[];return null!==this.Vt?n.push(new Fi(t,this.data,this.Vt,e)):n.push(new qi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},uc),oc=(sc.prototype.Ac=function(t,e){var n=[new Fi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},sc);function sc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function uc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function ac(t,e){if(Eh("GeoPoint",arguments,2),Nh("GeoPoint","number",1,t),Nh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Ar(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Ar(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.wc=t,this.Rc=e}function hc(t){var e=this;return(e=zh.call(this,"FieldValue.increment")||this).Ic=t,e}function cc(t){var e=this;return(e=Wh.call(this,"FieldValue.arrayRemove")||this).Tc=t,e}function fc(t){var e=this;return(e=Kh.call(this,"FieldValue.arrayUnion")||this).Tc=t,e}function lc(){return Yh.call(this,"FieldValue.serverTimestamp")||this}function pc(){return Qh.call(this,"FieldValue.delete")||this}function dc(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw zs()}}var yc=(Object.defineProperty(mc.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"dc",{get:function(){return this.settings.dc},enumerable:!0,configurable:!0}),mc.prototype.Pc=function(t){return new mc(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Vt)},mc.prototype.Vc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Pc({path:n,Ec:!1});return r.gc(t),r},mc.prototype.pc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Pc({path:n,Ec:!1});return r.mc(),r},mc.prototype.yc=function(t){return this.Pc({path:void 0,Ec:!0})},mc.prototype.fc=function(t){var e=!this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new Ar(Nr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},mc.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},mc.prototype.mc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.gc(this.path.get(t))},mc.prototype.gc=function(t){if(0===t.length)throw this.fc("Document fields must not be empty");if(dc(this.dc)&&rc.test(t))throw this.fc('Document fields cannot begin and end with "__"')},mc),vc=(gc.prototype.vc=function(t,e){var n=this.Sc(0,t);Tc("Data must be an object, but it was:",n,e);var r=bc(e,n);return new ic(new Wi(r),null,n.fieldTransforms)},gc.prototype.Dc=function(t,e,n){var r=this.Sc(2,t);Tc("Data must be an object, but it was:",r,e);var i,o,s=bc(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof Fh)f=c.cc;else{if("string"!=typeof c)throw zs();f=Nc(t,c)}if(!r.contains(f))throw new Ar(Nr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Ac(u,f)||u.push(f)}i=new Ci(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=new Ci(r.Vt),o=r.fieldTransforms;return new ic(new Wi(s),i,o)},gc.prototype.Cc=function(o,t){var s=this.Sc(1,o);Tc("Data must be an object, but it was:",s,t);var u=[],a=new Ki;$r(t,function(t,e){var n,r=Nc(o,t),i=s.pc(r);e instanceof Xh?u.push(r):null!=(n=wc(e,i))&&(u.push(r),a.set(r,n))});var e=new Ci(u);return new oc(a.yt(),e,s.fieldTransforms)},gc.prototype.Fc=function(t,e,n,r){var i=this.Sc(1,t),o=[Ic(t,e)],s=[n];if(r.length%2!=0)throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Ic(t,r[u])),s.push(r[u+1]);for(var a,h,c,f,l=[],p=new Ki,d=o.length-1;0<=d;--d){Ac(l,o[d])||(a=o[d],h=s[d],c=i.pc(a),h instanceof Xh?l.push(a):null!=(f=wc(h,c))&&(l.push(a),p.set(a,f)))}var y=new Ci(l);return new oc(p.yt(),y,i.fieldTransforms)},gc.prototype.Sc=function(t,e){return new yc({dc:t,methodName:e,path:Wr.G,Ec:!1},this.ii,this.serializer,this.ignoreUndefinedProperties)},gc.prototype.Nc=function(t,e,n){return void 0===n&&(n=!1),wc(e,this.Sc(n?4:3,t))},gc);function gc(t,e,n){this.ii=t,this.ignoreUndefinedProperties=e,this.serializer=n||Cs.nt().bc(t)}function mc(t,e,n,r,i,o){this.settings=t,this.ii=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.mc(),this.fieldTransforms=i||[],this.Vt=o||[]}function wc(s,t){if(Ec(s))return Tc("Unsupported field value:",t,s),bc(s,t);if(s instanceof $h)return function(t,e){if(!dc(e.dc))throw e.fc(t.lc+"() can only be used with update() and set()");if(null===e.path)throw e.fc(t.lc+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.Ec&&4!==t.dc)throw t.fc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=wc(i[r],t.yc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=xr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof xr){var r=new xr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof nc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof qh)return{bytesValue:e.serializer.ui(t)};if(t instanceof sl){var i=e.ii,o=t.firestore.$c;if(!o.isEqual(i))throw e.fc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.kc.path,t.firestore.$c)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.fc("Unsupported field value: "+Oh(t))}(s,t)}function bc(t,r){var i={};return Xr(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):$r(t,function(t,e){var n=wc(e,r.Vc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Ec(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof xr||t instanceof nc||t instanceof qh||t instanceof sl||t instanceof $h)}function Tc(t,e,n){if(!Ec(n)||!xh(n)){var r=Oh(n);throw"an object"===r?e.fc(t+" a custom object"):e.fc(t+" "+r)}}function Ic(t,e){if(e instanceof Fh)return e.cc;if("string"==typeof e)return Nc(t,e);throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Nc(t,e){try{return function(e){if(0<=e.search(Hh))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Fh.bind.apply(Fh,i([void 0],e.split("."))))}catch(t){throw new Ar(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).cc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Ac(t,e){return t.some(function(t){return t.isEqual(e)})}var _c,Sc,kc,Dc=(Bc.prototype.qc=function(){return 1===this.state||2===this.state||4===this.state},Bc.prototype.Uc=function(){return 2===this.state},Bc.prototype.start=function(){3!==this.state?this.auth():this.Qc()},Bc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.qc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Bc.prototype.Wc=function(){this.state=0,this.$a.reset()},Bc.prototype.jc=function(){var t=this;this.Uc()&&null===this.Bc&&(this.Bc=this.Tr.yr(this.Lc,6e4,function(){return t.Kc()}))},Bc.prototype.Gc=function(t){this.zc(),this.stream.send(t)},Bc.prototype.Kc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Uc()?[2,this.close(0)]:[2]})})},Bc.prototype.zc=function(){this.Bc&&(this.Bc.cancel(),this.Bc=null)},Bc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.zc(),this.$a.cancel(),this.xc++,3!==e?this.$a.reset():n&&n.code===Nr.RESOURCE_EXHAUSTED?(Bs(n.toString()),Bs("Using maximum backoff delay to prevent overloading the backend."),this.$a.Vr()):n&&n.code===Nr.UNAUTHENTICATED&&this.Oc._(),null!==this.stream&&(this.Hc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Yc(n)];case 1:return t.sent(),[2]}})})},Bc.prototype.Hc=function(){},Bc.prototype.auth=function(){var n=this;this.state=1;var t=this.Jc(this.xc),e=this.xc;this.Oc.getToken().then(function(t){n.xc===e&&n.Xc(t)},function(e){t(function(){var t=new Ar(Nr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Zc(t)})})},Bc.prototype.Xc=function(t){var e=this,n=this.Jc(this.xc);this.stream=this.t_(t),this.stream.e_(function(){n(function(){return e.state=2,e.listener.e_()})}),this.stream.Yc(function(t){n(function(){return e.Zc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Bc.prototype.Qc=function(){var t=this;this.state=4,this.$a.gr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Bc.prototype.Zc=function(t){return Fs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Bc.prototype.Jc=function(e){var n=this;return function(t){n.Tr.uo(function(){return n.xc===e?t():(Fs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Bc),xc=(n(Fc,kc=Dc),Fc.prototype.t_=function(t){return this.Mc.s_("Listen",t)},Fc.prototype.onMessage=function(t){this.$a.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.i_(e,n)},Fc.prototype.n_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Gc(e)},Fc.prototype.r_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Gc(e)},Fc),Oc=(n(qc,Sc=Dc),Object.defineProperty(qc.prototype,"o_",{get:function(){return this.h_},enumerable:!0,configurable:!0}),qc.prototype.start=function(){this.h_=!1,Sc.prototype.start.call(this)},qc.prototype.Hc=function(){this.h_&&this.a_([])},qc.prototype.t_=function(t){return this.Mc.s_("Write",t)},qc.prototype.onMessage=function(t){if(Ws(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.h_){this.$a.reset();var e=this.serializer.Mi(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.u_(n,e)}return Ws(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.c_()},qc.prototype.__=function(){var t={};t.database=this.serializer.wi,this.Gc(t)},qc.prototype.a_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.Gc(n)},qc),Rc=(n(Mc,_c=function(){this.l_=void 0}),Mc.prototype.d_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.d_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},Mc.prototype.f_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.f_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},Mc),Pc=(jc.prototype.A_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.m_(),0<this.mutations.length)throw new Ar(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e={database:(n=s).serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.f_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Ws(!!e),o.push(e)}),o)]}})})}(this.T_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof bo||t instanceof wo?n.P_(t):zs()}),e)]}})})},jc.prototype.set=function(t,e){this.write(e.Ac(t,this.Rt(t))),this.R_.add(t)},jc.prototype.update=function(t,e){try{this.write(e.Ac(t,this.V_(t)))}catch(t){this.w_=t}this.R_.add(t)},jc.prototype.delete=function(t){this.write([new Gi(t,this.Rt(t))]),this.R_.add(t)},jc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.m_(),this.w_)throw this.w_;return e=this.E_,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new zi(t,n.Rt(t)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return n={database:(e=i).serializer.wi,writes:o.map(function(t){return e.serializer.vi(t)})},[4,e.d_("Commit",n)];case 1:return r=t.sent(),[2,e.serializer.Mi(r.writeResults,r.commitTime)]}})})}(this.T_,this.mutations)];case 1:return t.sent(),this.I_=!0,[2]}})})},jc.prototype.P_=function(t){var e;if(t instanceof wo)e=t.version;else{if(!(t instanceof bo))throw zs();e=Or.min()}var n=this.E_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Ar(Nr.ABORTED,"Document version changed between two reads.")}else this.E_=this.E_.Ae(t.key,e)},jc.prototype.Rt=function(t){var e=this.E_.get(t);return!this.R_.has(t)&&e?ji.updateTime(e):ji.ft()},jc.prototype.V_=function(t){var e=this.E_.get(t);if(this.R_.has(t)||!e)return ji.exists(!0);if(e.isEqual(Or.min()))throw new Ar(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ji.updateTime(e)},jc.prototype.write=function(t){this.m_(),this.mutations=this.mutations.concat(t)},jc.prototype.m_=function(){},jc),Lc=(Uc.prototype.v_=function(){var t=this;0===this.p_&&(this.S_("Unknown"),this.y_=this.Aa.yr("online_state_timeout",1e4,function(){return t.y_=null,t.D_("Backend didn't respond within 10 seconds."),t.S_("Offline"),Promise.resolve()}))},Uc.prototype.C_=function(t){"Online"===this.state?this.S_("Unknown"):(this.p_++,1<=this.p_&&(this.F_(),this.D_("Connection failed 1 times. Most recent error: "+t.toString()),this.S_("Offline")))},Uc.prototype.set=function(t){this.F_(),this.p_=0,"Online"===t&&(this.b_=!1),this.S_(t)},Uc.prototype.S_=function(t){t!==this.state&&(this.state=t,this.g_(t))},Uc.prototype.D_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.b_?(Bs(e),this.b_=!1):Fs("OnlineStateTracker",e)},Uc.prototype.F_=function(){null!==this.y_&&(this.y_.cancel(),this.y_=null)},Uc),Vc=(Cc.prototype.start=function(){return this.enableNetwork()},Cc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.X_()},Cc.prototype.X_=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.q_()?(e=this.z_,[4,this.N_.Yo()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.Z_()?this.tl():this.Q_.set("Unknown"),[4,this.el()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Cc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.sl()];case 1:return t.sent(),this.Q_.set("Offline"),[2]}})})},Cc.prototype.sl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.z_.stop()];case 1:return t.sent(),[4,this.W_.stop()];case 2:return t.sent(),0<this.k_.length&&(Fs("RemoteStore","Stopping write stream with "+this.k_.length+" pending writes"),this.k_=[]),this.il(),[2]}})})},Cc.prototype.mo=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.sl()];case 1:return t.sent(),this.x_.mo(),this.Q_.set("Unknown"),[2]}})})},Cc.prototype.listen=function(t){this.L_.has(t.targetId)||(this.L_.set(t.targetId,t),this.Z_()?this.tl():this.W_.Uc()&&this.nl(t))},Cc.prototype.rl=function(t){this.L_.delete(t),this.W_.Uc()&&this.hl(t),0===this.L_.size&&(this.W_.Uc()?this.W_.jc():this.q_()&&this.Q_.set("Unknown"))},Cc.prototype.si=function(t){return this.L_.get(t)||null},Cc.prototype.ei=function(t){return this.ol.ei(t)},Cc.prototype.nl=function(t){this.M_.Ns(t.targetId),this.W_.n_(t)},Cc.prototype.hl=function(t){this.M_.Ns(t),this.W_.r_(t)},Cc.prototype.tl=function(){this.M_=new Es(this),this.W_.start(),this.Q_.v_()},Cc.prototype.Z_=function(){return this.q_()&&!this.W_.qc()&&0<this.L_.size},Cc.prototype.q_=function(){return!this.O_&&this.isPrimary&&this.networkEnabled},Cc.prototype.il=function(){this.M_=null},Cc.prototype.j_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.L_.forEach(function(t,e){n.nl(t)}),[2]})})},Cc.prototype.K_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.il(),this.Z_()?(this.Q_.C_(e),this.tl()):this.Q_.set("Unknown"),[2]})})},Cc.prototype.G_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.Q_.set("Online"),!(i instanceof ds&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.al(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Fs("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.ul(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof ls?this.M_.qs(i):i instanceof ps?this.M_.Hs(i):this.M_.Ws(i),o.isEqual(Or.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.N_._h()];case 8:return n=t.sent(),0<=o.S(n)?[4,this.cl(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Fs("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.ul(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Cc.prototype.ul=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Fa(n))throw n;return this.O_=!0,[4,this.sl()];case 1:return t.sent(),this.Q_.set("Offline"),this.Aa.Ua(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Fs("RemoteStore","Retrying IndexedDB access"),[4,this.N_._h()];case 1:return t.sent(),this.O_=!1,[4,this.X_()];case 2:return t.sent(),[2]}})})}),[2]}})})},Cc.prototype.cl=function(r){var i=this,t=this.M_.Xs(r);return t.as.forEach(function(t,e){var n;0<t.resumeToken.rt()&&((n=i.L_.get(e))&&i.L_.set(e,n.we(t.resumeToken,r)))}),t.us.forEach(function(t){var e,n=i.L_.get(t);n&&(i.L_.set(t,n.we(Jr.ht,n.Ee)),i.hl(t),e=new Ro(n.target,t,1,n.sequenceNumber),i.nl(e))}),this.ol.Mu(t)},Cc.prototype.al=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.L_.has(i)?[4,this.ol._l(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.L_.delete(i),this.M_.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Cc.prototype.el=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.ll()?(e=0<this.k_.length?this.k_[this.k_.length-1].batchId:-1,[4,this.N_.qu(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.k_.length&&this.z_.jc(),[3,4]);case 2:return this.dl(n),[4,this.el()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.fl()&&this.Tl(),[2]}})})},Cc.prototype.ll=function(){return this.q_()&&this.k_.length<10},Cc.prototype.El=function(){return this.k_.length},Cc.prototype.dl=function(t){this.k_.push(t),this.z_.Uc()&&this.z_.o_&&this.z_.a_(t.mutations)},Cc.prototype.fl=function(){return this.q_()&&!this.z_.qc()&&0<this.k_.length},Cc.prototype.Tl=function(){this.z_.start()},Cc.prototype.H_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.z_.__(),[2]})})},Cc.prototype.J_=function(){var r=this;return this.N_.Jo(this.z_.lastStreamToken).then(function(){for(var t=0,e=r.k_;t<e.length;t++){var n=e[t];r.z_.a_(n.mutations)}}).catch(yh)},Cc.prototype.u_=function(t,e){var n=this,r=this.k_.shift(),i=eu.from(r,t,e,this.z_.lastStreamToken);return this.ol.Il(i).then(function(){return n.el()})},Cc.prototype.Y_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&0<this.k_.length?this.z_.o_?[4,this.wl(e)]:[3,2]:[3,5];case 1:return t.sent(),[3,4];case 2:return[4,this.Rl(e)];case 3:t.sent(),t.label=4;case 4:this.fl()&&this.Tl(),t.label=5;case 5:return[2]}})})},Cc.prototype.Rl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Yo(e.code)?[2,(Fs("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.z_.lastStreamToken),this.z_.lastStreamToken=Jr.ht,this.N_.Jo(Jr.ht).catch(yh))]:[2]})})},Cc.prototype.wl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Yo(n=i.code)&&n!==Nr.ABORTED?(e=this.k_.shift(),[2,(this.z_.Wc(),this.ol.Al(e.batchId,i).then(function(){return r.el()}))]):[2]})})},Cc.prototype.ml=function(){return new Pc(this.T_)},Cc.prototype.U_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.sl()];case 1:return t.sent(),this.Q_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Cc.prototype.Pl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.q_()?(Fs("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.U_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Cc.prototype.Vl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.sl()];case 3:t.sent(),this.Q_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Cc);function Cc(t,e,n,r,i){var o,s,u,a,h,c,f=this;this.N_=t,this.T_=e,this.Aa=n,this.k_=[],this.L_=new Map,this.M_=null,this.networkEnabled=!1,this.isPrimary=!1,this.O_=!1,this.x_=i,this.x_.B_(function(t){n.uo(function(){return y(f,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.q_()?(Fs("RemoteStore","Restarting streams for network reachability change."),[4,this.U_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Q_=new Lc(n,r),this.W_=(a=this.T_,h=n,c={e_:this.j_.bind(this),Yc:this.K_.bind(this),i_:this.G_.bind(this)},new xc(h,a.Mc,a.credentials,a.serializer,c)),this.z_=(o=this.T_,s=n,u={e_:this.H_.bind(this),Yc:this.Y_.bind(this),c_:this.J_.bind(this),u_:this.u_.bind(this)},new Oc(s,o.Mc,o.credentials,o.serializer,u))}function Uc(t,e){this.Aa=t,this.g_=e,this.state="Unknown",this.p_=0,this.y_=null,this.b_=!0}function jc(t){this.T_=t,this.E_=as,this.mutations=[],this.I_=!1,this.w_=null,this.R_=new Set}function Mc(t,e,n){var r=this;return(r=_c.call(this)||this).Mc=t,r.credentials=e,r.serializer=n,r}function qc(t,e,n,r,i){var o=this;return(o=Sc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.h_=!1,o.lastStreamToken=Jr.ht,o}function Fc(t,e,n,r,i){var o=this;return(o=kc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Bc(t,e,n,r,i,o){this.Tr=t,this.Lc=n,this.Mc=r,this.Oc=i,this.listener=o,this.state=0,this.xc=0,this.Bc=null,this.stream=null,this.$a=new bu(t,e)}function Gc(t,e){return"firestore_clients_"+t+"_"+e}function zc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function Wc(t,e){return"firestore_targets_"+t+"_"+e}function Kc(t){this.key=t}function Yc(t){this.key=t}function Qc(t,e,n){this.query=t,this.targetId=e,this.view=n}function Hc(t){this.key=t,this.qd=!1}function $c(){this.gf=void 0,this.pf=[]}var Xc,Jc,Zc=(Of.gl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Ar(r.error.code,r.error.message)),i?new Of(t,e,r.state,o):(Bs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Of.prototype.pl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Of),tf=(xf.gl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Ar(n.error.code,n.error.message)),r?new xf(t,n.state,i):(Bs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},xf.prototype.pl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},xf),ef=(Df.gl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fs,o=0;r&&o<n.activeTargetIds.length;++o)r=ni(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Df(t,i):(Bs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Df),nf=(kf.gl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new kf(e.clientId,e.onlineState):(Bs("SharedClientState","Failed to parse online state: "+t),null)},kf),rf=(Sf.prototype.yl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Sf.prototype.bl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Sf.prototype.pl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Sf),of=(_f.Gh=function(t){return!(!t.window||null==t.window.localStorage)},_f.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.ol.bo()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.vl&&(o=this.getItem(Gc(this.persistenceKey,i)))&&(s=ef.gl(i,o))&&(this.Cl=this.Cl.Ae(s.clientId,s));for(this.xl(),(u=this.storage.getItem(this.Ol))&&(a=this.Bl(u))&&this.ql(a),h=0,c=this.Fl;h<c.length;h++)f=c[h],this.Dl(f);return this.Fl=[],this.platform.window.addEventListener("unload",function(){return l.mo()}),this.ro=!0,[2]}})})},_f.prototype.lr=function(t){this.setItem(this.$l,JSON.stringify(t))},_f.prototype.Ul=function(){return this.Ql(this.Cl)},_f.prototype.Wl=function(n){var r=!1;return this.Cl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},_f.prototype.jl=function(t){this.Kl(t,"pending")},_f.prototype.Gl=function(t,e,n){this.Kl(t,e,n),this.zl(t)},_f.prototype.Hl=function(t){var e,n,r="not-current";return this.Wl(t)&&(!(e=this.storage.getItem(Wc(this.persistenceKey,t)))||(n=tf.gl(t,e))&&(r=n.state)),this.Yl.yl(t),this.xl(),r},_f.prototype.Jl=function(t){this.Yl.bl(t),this.xl()},_f.prototype.Xl=function(t){return this.Yl.activeTargetIds.has(t)},_f.prototype.Zl=function(t){this.removeItem(Wc(this.persistenceKey,t))},_f.prototype.td=function(t,e,n){this.ed(t,e,n)},_f.prototype.Du=function(t,e,n){var r=this;e.forEach(function(t){r.zl(t)}),this.currentUser=t,n.forEach(function(t){r.jl(t)})},_f.prototype.sd=function(t){this.nd(t)},_f.prototype.mo=function(){this.ro&&(this.platform.window.removeEventListener("storage",this.Sl),this.removeItem(this.Nl),this.ro=!1)},_f.prototype.getItem=function(t){var e=this.storage.getItem(t);return Fs("SharedClientState","READ",t,e),e},_f.prototype.setItem=function(t,e){Fs("SharedClientState","SET",t,e),this.storage.setItem(t,e)},_f.prototype.removeItem=function(t){Fs("SharedClientState","REMOVE",t),this.storage.removeItem(t)},_f.prototype.Dl=function(u){var t=this;if(u.storageArea===this.storage){if(Fs("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Nl)return void Bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Tr.Ua(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.ro){if(null!==u.key)if(this.kl.test(u.key)){if(null==u.newValue)return e=this.rd(u.key),[2,this.hd(e,null)];if(n=this.od(u.key,u.newValue))return[2,this.hd(n.clientId,n)]}else if(this.Ll.test(u.key)){if(null!==u.newValue&&(r=this.ad(u.key,u.newValue)))return[2,this.ud(r)]}else if(this.Ml.test(u.key)){if(null!==u.newValue&&(i=this._d(u.key,u.newValue)))return[2,this.ld(i)]}else if(u.key===this.Ol){if(null!==u.newValue&&(o=this.Bl(u.newValue)))return[2,this.ql(o)]}else u.key===this.$l&&(s=function(t){var e=au.dr;if(null!=t)try{var n=JSON.parse(t);Ws("number"==typeof n),e=n}catch(t){Bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==au.dr&&this.ur(s)}else this.Fl.push(u);return[2]})})})}},Object.defineProperty(_f.prototype,"Yl",{get:function(){return this.Cl.get(this.vl)},enumerable:!0,configurable:!0}),_f.prototype.xl=function(){this.setItem(this.Nl,this.Yl.pl())},_f.prototype.Kl=function(t,e,n){var r=new Zc(this.currentUser,t,e,n),i=zc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.pl())},_f.prototype.zl=function(t){var e=zc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},_f.prototype.nd=function(t){var e={clientId:this.vl,onlineState:t};this.storage.setItem(this.Ol,JSON.stringify(e))},_f.prototype.ed=function(t,e,n){var r=Wc(this.persistenceKey,t),i=new tf(t,e,n);this.setItem(r,i.pl())},_f.prototype.rd=function(t){var e=this.kl.exec(t);return e?e[1]:null},_f.prototype.od=function(t,e){var n=this.rd(t);return ef.gl(n,e)},_f.prototype.ad=function(t,e){var n=this.Ll.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Zc.gl(new wr(i),r,e)},_f.prototype._d=function(t,e){var n=this.Ml.exec(t),r=Number(n[1]);return tf.gl(r,e)},_f.prototype.Bl=function(t){return nf.gl(t)},_f.prototype.ud=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.ol.dd(e.batchId,e.state,e.error)]:(Fs("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},_f.prototype.ld=function(t){return this.ol.fd(t.targetId,t.state,t.error)},_f.prototype.hd=function(t,e){var n=this,r=e?this.Cl.Ae(t,e):this.Cl.remove(t),i=this.Ql(this.Cl),o=this.Ql(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.ol.Td(s,u).then(function(){n.Cl=r})},_f.prototype.ql=function(t){this.Cl.get(t.clientId)&&this.g_(t.onlineState)},_f.prototype.Ql=function(t){var n=fs;return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},_f),sf=(Af.prototype.jl=function(t){},Af.prototype.Gl=function(t,e,n){},Af.prototype.Hl=function(t){return this.Ed.yl(t),this.Id[t]||"not-current"},Af.prototype.td=function(t,e,n){this.Id[t]=e},Af.prototype.Jl=function(t){this.Ed.bl(t)},Af.prototype.Xl=function(t){return this.Ed.activeTargetIds.has(t)},Af.prototype.Zl=function(t){delete this.Id[t]},Af.prototype.Ul=function(){return this.Ed.activeTargetIds},Af.prototype.Wl=function(t){return this.Ed.activeTargetIds.has(t)},Af.prototype.start=function(){return this.Ed=new rf,Promise.resolve()},Af.prototype.Du=function(t,e,n){},Af.prototype.sd=function(t){},Af.prototype.mo=function(){},Af.prototype.lr=function(t){},Af),uf=(Object.defineProperty(Nf.prototype,"Pd",{get:function(){return this.wd},enumerable:!0,configurable:!0}),Nf.prototype.Vd=function(t,e){var u=this,a=e?e.gd:new vs,h=e?e.md:this.md,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=(r=e instanceof wo?e:null)&&(u.query.matches(r)?r:null),i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.pd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{md:f,gd:a,yd:l,ns:c}},Nf.prototype.pd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},Nf.prototype.xn=function(t,e,n){var o=this,r=this.md;this.md=t.md,this.ns=t.ns;var i=t.gd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return zs()}}var r,i}),this.bd(n);var s=e?this.vd():[],u=0===this.Ad.size&&this.fs?1:0,a=u!==this.Rd;return this.Rd=u,0!==i.length||a?{snapshot:new gs(this.query,t.md,r,i,t.ns,0==u,a,!1),Sd:s}:{Sd:s}},Nf.prototype.Dd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.xn({md:this.md,gd:new vs,ns:this.ns,yd:!1},!1)):{Sd:[]}},Nf.prototype.Cd=function(t){return!this.wd.has(t)&&!!this.md.has(t)&&!this.md.get(t).At},Nf.prototype.bd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.wd=e.wd.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.wd=e.wd.delete(t)}),this.fs=t.fs)},Nf.prototype.vd=function(){var e=this;if(!this.fs)return[];var n=this.Ad;this.Ad=cs(),this.md.forEach(function(t){e.Cd(t.key)&&(e.Ad=e.Ad.add(t.key))});var r=[];return n.forEach(function(t){e.Ad.has(t)||r.push(new Yc(t))}),this.Ad.forEach(function(t){n.has(t)||r.push(new Kc(t))}),r},Nf.prototype.Fd=function(t){this.wd=t.Ku,this.Ad=cs();var e=this.Vd(t.documents);return this.xn(e,!0)},Nf.prototype.Nd=function(){return gs.os(this.query,this.md,this.ns,0===this.Rd)},Nf),af=(If.prototype.Ld=function(){this.Md()},If.prototype.Md=function(){var t=this;this.$a.gr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.$d.ml(),(n=this.Od(e))&&n.then(function(t){r.Aa.uo(function(){return e.commit().then(function(){r.Va.resolve(t)}).catch(function(t){r.xd(t)})})}).catch(function(t){r.xd(t)}),[2]})})})},If.prototype.Od=function(t){try{var e=this.updateFunction(t);return!ti(e)&&e.catch&&e.then?e:(this.Va.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Va.reject(t),null}},If.prototype.xd=function(t){var e=this;0<this.kd&&this.Bd(t)?(--this.kd,this.Aa.uo(function(){return e.Md(),Promise.resolve()})):this.Va.reject(t)},If.prototype.Bd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Yo(e)},If),hf=(Object.defineProperty(Tf.prototype,"tf",{get:function(){return!0},enumerable:!0,configurable:!0}),Tf.prototype.subscribe=function(t){this.Wd=t},Tf.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.ef("listen()"),(r=this.jd.get(s))?(e=r.targetId,this.Ud.Hl(e),n=r.view.Nd(),[3,4]):[3,1];case 1:return[4,this.N_.Qu(s.ee())];case 2:return i=t.sent(),o=this.Ud.Hl(i.targetId),e=i.targetId,[4,this.sf(s,e,"current"===o)];case 3:n=t.sent(),this.tf&&this.$d.listen(i),t.label=4;case 4:return[2,n]}})})},Tf.prototype.sf=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.N_.ju(u,!0)];case 1:return e=t.sent(),n=new uf(u,e.Ku),r=n.Vd(e.documents),i=ws.ds(a,h&&"Offline"!==this.onlineState),o=n.xn(r,this.tf,i),this.if(a,o.Sd),s=new Qc(u,a,n),[2,(this.jd.set(u,s),this.Kd.has(a)?this.Kd.get(a).push(u):this.Kd.set(a,[u]),o.snapshot)]}})})},Tf.prototype.rl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.ef("unlisten()"),e=this.jd.get(i),1<(n=this.Kd.get(e.targetId)).length?[2,(this.Kd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.jd.delete(i))]:this.tf?(this.Ud.Jl(e.targetId),this.Ud.Wl(e.targetId)?[3,2]:[4,this.N_.Wu(e.targetId,!1).then(function(){r.Ud.Zl(e.targetId),r.$d.rl(e.targetId),r.nf(e.targetId)}).catch(yh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.nf(e.targetId),[4,this.N_.Wu(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Tf.prototype.write=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:this.ef("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.N_.$u(i)];case 2:return e=t.sent(),this.Ud.jl(e.batchId),this.rf(e.batchId,o),[4,this.hf(e.Dn)];case 3:return t.sent(),[4,this.$d.el()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=Za(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},Tf.prototype.runTransaction=function(t,e,n){new af(t,this.$d,e,n).Ld()},Tf.prototype.Mu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.ef("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.N_.Mu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.Hd.get(e);n&&(Ws(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.qd=!0:0<t.Es.size?Ws(n.qd):0<t.Is.size&&(Ws(n.qd),n.qd=!1))}),[4,this.hf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,yh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Tf.prototype.Dd=function(r,t){this.ef("applyOnlineStateChange()");var i=[];this.jd.forEach(function(t,e){var n=e.view.Dd(r);n.snapshot&&i.push(n.snapshot)}),this.Wd.af(r),this.Wd.i_(i),this.onlineState=r},Tf.prototype._l=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.ef("rejectListens()"),this.Ud.td(u,"rejected",a),e=this.Hd.get(u),(n=e&&e.key)?(r=(r=new Ho(Yr.N)).Ae(n,new bo(n,Or.min())),i=cs().add(n),o=new ms(Or.min(),new Map,new ns(Qs),r,i),[4,this.Mu(o)]):[3,2];case 1:return t.sent(),this.zd=this.zd.remove(n),this.Hd.delete(u),this.uf(),[3,4];case 2:return[4,this.N_.Wu(u,!1).then(function(){return s.nf(u,a)}).catch(yh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},Tf.prototype.Il=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.ef("applySuccessfulWrite()"),e=r.batch.batchId,this.cf(e,null),this._f(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.N_.zo(r)];case 2:return n=t.sent(),this.Ud.Gl(e,"acknowledged"),[4,this.hf(n)];case 3:return t.sent(),[3,6];case 4:return[4,yh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Tf.prototype.Al=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.ef("rejectFailedWrite()"),this.cf(n,r),this._f(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.N_.Lu(n)];case 2:return e=t.sent(),this.Ud.Gl(n,"rejected",r),[4,this.hf(e)];case 3:return t.sent(),[3,6];case 4:return[4,yh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Tf.prototype.lf=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:this.$d.q_()||Fs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.N_.sa()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.Xd.get(e)||[]).push(o),this.Xd.set(e,n),[3,4]);case 3:return r=t.sent(),i=Za(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},Tf.prototype._f=function(t){(this.Xd.get(t)||[]).forEach(function(t){t.resolve()}),this.Xd.delete(t)},Tf.prototype.df=function(e){this.Xd.forEach(function(t){t.forEach(function(t){t.reject(new Ar(Nr.CANCELLED,e))})}),this.Xd.clear()},Tf.prototype.rf=function(t,e){var n=(n=(n=this.Jd[this.currentUser.s()])||new Ho(Qs)).Ae(t,e);this.Jd[this.currentUser.s()]=n},Tf.prototype.cf=function(t,e){var n,r=this.Jd[this.currentUser.s()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.Jd[this.currentUser.s()]=r)},Tf.prototype.nf=function(t,e){var n=this;void 0===e&&(e=null),this.Ud.Jl(t);for(var r=0,i=this.Kd.get(t);r<i.length;r++){var o=i[r];this.jd.delete(o),e&&this.Wd.ff(o,e)}this.Kd.delete(t),this.tf&&this.Yd.nc(t).forEach(function(t){n.Yd.Ch(t)||n.Tf(t)})},Tf.prototype.Tf=function(t){var e=this.zd.get(t);null!==e&&(this.$d.rl(e),this.zd=this.zd.remove(t),this.Hd.delete(e),this.uf())},Tf.prototype.if=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Kc?(this.Yd.yh(i.key,t),this.Ef(i)):i instanceof Yc?(Fs("SyncEngine","Document no longer in limbo: "+i.key),this.Yd.vh(i.key,t),this.Yd.Ch(i.key)||this.Tf(i.key)):zs()}},Tf.prototype.Ef=function(t){var e=t.key;this.zd.get(e)||(Fs("SyncEngine","New document in limbo: "+e),this.Gd.push(e),this.uf())},Tf.prototype.uf=function(){for(;0<this.Gd.length&&this.zd.size<this.Qd;){var t=this.Gd.shift(),e=this.Zd.next();this.Hd.set(e,new Hc(t)),this.zd=this.zd.Ae(t,e),this.$d.listen(new Ro(Io.Wt(t.path).ee(),e,2,au.dr))}},Tf.prototype.If=function(){return this.zd},Tf.prototype.wf=function(){return this.Gd},Tf.prototype.hf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.jd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Vd(r);return n.yd?u.N_.ju(i.query,!1).then(function(t){var e=t.documents;return i.view.Vd(e,n)}):n}).then(function(t){var e,n=a&&a.as.get(i.targetId),r=i.view.xn(t,u.tf,n);u.if(i.targetId,r.Sd),r.snapshot&&(u.tf&&u.Ud.td(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=uu.ar(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Wd.i_(o),[4,this.N_.Bu(s)];case 2:return t.sent(),[2]}})})},Tf.prototype.ef=function(t){},Tf.prototype.Pl=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:[4,this.N_.Du(n)];case 1:return e=t.sent(),this.currentUser=n,this.df("'waitForPendingWrites' promise is rejected due to a user change."),this.Ud.Du(n,e.Fu,e.Nu),[4,this.hf(e.Cu)];case 2:t.sent(),t.label=3;case 3:return[4,this.$d.Pl()];case 4:return t.sent(),[2]}})})},Tf.prototype.enableNetwork=function(){return this.$d.enableNetwork()},Tf.prototype.disableNetwork=function(){return this.$d.disableNetwork()},Tf.prototype.ei=function(t){var e=this.Hd.get(t);if(e&&e.qd)return cs().add(e.key);var n=cs(),r=this.Kd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.jd.get(s),n=n.He(u.view.Pd);return n},Tf),cf=(n(Ef,Xc=hf),Object.defineProperty(Ef.prototype,"tf",{get:function(){return!0===this.Rf},enumerable:!0,configurable:!0}),Ef.prototype.enableNetwork=function(){return this.N_.ao(!0),Xc.prototype.enableNetwork.call(this)},Ef.prototype.disableNetwork=function(){return this.N_.ao(!1),Xc.prototype.disableNetwork.call(this)},Ef.prototype.Af=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.N_.ju(r.query,!0)];case 1:return e=t.sent(),n=r.view.Fd(e),[2,(this.Rf&&this.if(r.targetId,n.Sd),n)]}})})},Ef.prototype.Dd=function(t,e){this.tf&&0===e&&(Xc.prototype.Dd.call(this,t,e),this.Ud.sd(t)),this.tf||1!==e||Xc.prototype.Dd.call(this,t,e)},Ef.prototype.dd=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.ef("applyBatchState()"),[4,this.N_.zu(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.$d.el()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.cf(n,i||null),this.N_.Hu(n)):zs(),t.label=4;case 4:return[4,this.hf(e)];case 5:return t.sent(),[3,7];case 6:Fs("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},Ef.prototype.Vl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.Rf?[3,3]:(e=this.Ud.Ul(),[4,this.mf(e.W(),!0)]);case 1:return n=t.sent(),this.Rf=!0,[4,this.$d.Vl(!0)];case 2:for(t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.$d.listen(o);return[3,7];case 3:return!1!==h||!1===this.Rf?[3,7]:(s=[],u=Promise.resolve(),this.Kd.forEach(function(t,e){a.Ud.Xl(e)?s.push(e):u=u.then(function(){return a.nf(e),a.N_.Wu(e,!0)}),a.$d.rl(e)}),[4,u]);case 4:return t.sent(),[4,this.mf(s,!1)];case 5:return t.sent(),this.Pf(),this.Rf=!1,[4,this.$d.Vl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Ef.prototype.Pf=function(){var n=this;this.Hd.forEach(function(t,e){n.$d.rl(e)}),this.Yd.rc(),this.Hd=new Map,this.zd=new Ho(Yr.N)},Ef.prototype.mf=function(d,t){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.Kd.get(o))&&0!==u.length?[4,this.N_.Wu(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.N_.Qu(u[0].ee())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.jd.get(c),[4,this.Af(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.N_.Yu(o)];case 9:return p=t.sent(),[4,this.N_.Qu(p)];case 10:return s=t.sent(),[4,this.sf(this.Vf(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Wd.i_(n),e)]}})})},Ef.prototype.Vf=function(t){return new Io(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Ef.prototype.bo=function(){return this.N_.bo()},Ef.prototype.fd=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Rf?(Fs("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.Kd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.N_.Kr()];case 3:return e=t.sent(),n=ms.ls(r,"current"===i),[4,this.hf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.N_.Wu(r,!0)];case 6:return t.sent(),this.nf(r,o),[3,8];case 7:zs(),t.label=8;case 8:return[2]}})})},Ef.prototype.Td=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.Rf)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.Kd.has(r)?(Fs("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.N_.Yu(r)]):[3,6];case 2:return i=t.sent(),[4,this.N_.Qu(i)];case 3:return o=t.sent(),[4,this.sf(this.Vf(i),o.targetId,!1)];case 4:t.sent(),this.$d.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.Kd.has(e)?[4,u.N_.Wu(e,!1).then(function(){f.$d.rl(e),f.nf(e)}).catch(yh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Ef),ff=(bf.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.yf.get(e))||(n=!0,r=new $c),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.ol.listen(e)];case 2:return i.gf=t.sent(),[3,4];case 3:return o=t.sent(),s=Za(o,"Initialization of query '"+u.query+"' failed"),[2,void u.onError(s)];case 4:return this.yf.set(e,r),r.pf.push(u),u.Dd(this.onlineState),r.gf&&u.vf(r.gf)&&this.Sf(),[2]}})})},bf.prototype.rl=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.yf.get(e))&&0<=(i=r.pf.indexOf(o))&&(r.pf.splice(i,1),n=0===r.pf.length),n?[2,(this.yf.delete(e),this.ol.rl(e))]:[2]})})},bf.prototype.i_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.yf.get(o);if(s){for(var u=0,a=s.pf;u<a.length;u++)a[u].vf(i)&&(e=!0);s.gf=i}}e&&this.Sf()},bf.prototype.ff=function(t,e){var n=this.yf.get(t);if(n)for(var r=0,i=n.pf;r<i.length;r++)i[r].onError(e);this.yf.delete(t)},bf.prototype.af=function(i){this.onlineState=i;var o=!1;this.yf.forEach(function(t,e){for(var n=0,r=e.pf;n<r.length;n++)r[n].Dd(i)&&(o=!0)}),o&&this.Sf()},bf.prototype.Df=function(t){this.bf.add(t),t.next()},bf.prototype.Cf=function(t){this.bf.delete(t)},bf.prototype.Sf=function(){this.bf.forEach(function(t){t.next()})},bf),lf=(wf.prototype.vf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new gs(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.Nf?this.kf(t)&&(this.Ff.next(t),o=!0):this.Lf(t,this.onlineState)&&(this.Mf(t),o=!0),this.$f=t,o},wf.prototype.onError=function(t){this.Ff.error(t)},wf.prototype.Dd=function(t){this.onlineState=t;var e=!1;return this.$f&&!this.Nf&&this.Lf(this.$f,t)&&(this.Mf(this.$f),e=!0),e},wf.prototype.Lf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Of&&n||t.docs.B()&&"Offline"!==e)},wf.prototype.kf=function(t){if(0<t.docChanges.length)return!0;var e=this.$f&&this.$f.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},wf.prototype.Mf=function(t){t=gs.os(t.query,t.docs,t.ns,t.fromCache),this.Nf=!0,this.Ff.next(t)},wf),pf=(mf.prototype.Su=function(t){this.xf=t},mf.prototype.Zn=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Or.min())?this.Bf(e,r):this.xf.Yn(e,o).next(function(t){var n=s.qf(r,t);return(r.oe()||r.ae())&&s.yd(r.Bt,n,o,i)?s.Bf(e,r):(Ms()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.xf.Zn(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ae(t.key,t)}),e}))})},mf.prototype.qf=function(n,t){var r=new ns(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof wo&&n.matches(e)&&(r=r.add(e))}),r},mf.prototype.yd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},mf.prototype.Bf=function(t,e){return Ms()<=l.DEBUG&&Fs("IndexFreeQueryEngine","Using full collection scan to execute query:",e.toString()),this.xf.Zn(t,e,Or.min())},mf),df=(gf.prototype.Go=function(t){return nu.resolve(0===this.Wn.length)},gf.prototype.zo=function(t,e,n){var r=e.batchId,i=this.Wf(r,"acknowledged");return Ws(0===i),this.Wn[i],this.lastStreamToken=n,nu.resolve()},gf.prototype.Yo=function(t){return nu.resolve(this.lastStreamToken)},gf.prototype.Jo=function(t,e){return this.lastStreamToken=e,nu.resolve()},gf.prototype.Xo=function(t,e,n,r){var i=this.Uf;this.Uf++,0<this.Wn.length&&this.Wn[this.Wn.length-1];var o=new tu(i,e,n,r);this.Wn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Qf=this.Qf.add(new gh(a.key,i)),this.jn.Dr(t,a.key.path.L())}return nu.resolve(o)},gf.prototype.Zo=function(t,e){return nu.resolve(this.jf(e))},gf.prototype.ea=function(t,e){var n=e+1,r=this.Kf(n),i=r<0?0:r;return nu.resolve(this.Wn.length>i?this.Wn[i]:null)},gf.prototype.sa=function(){return nu.resolve(0===this.Wn.length?-1:this.Uf-1)},gf.prototype.ia=function(t){return nu.resolve(this.Wn.slice())},gf.prototype.Gn=function(t,e){var n=this,r=new gh(e,0),i=new gh(e,Number.POSITIVE_INFINITY),o=[];return this.Qf.Ke([r,i],function(t){var e=n.jf(t.oc);o.push(e)}),nu.resolve(o)},gf.prototype.Xn=function(t,e){var r=this,i=new ns(Qs);return e.forEach(function(t){var e=new gh(t,0),n=new gh(t,Number.POSITIVE_INFINITY);r.Qf.Ke([e,n],function(t){i=i.add(t.oc)})}),nu.resolve(this.Gf(i))},gf.prototype.nr=function(t,e){var n=e.path,r=n.length+1,i=n;Yr.et(i)||(i=i.child(""));var o=new gh(new Yr(i),0),s=new ns(Qs);return this.Qf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.oc)),!0)},o),nu.resolve(this.Gf(s))},gf.prototype.Gf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.jf(t);null!==e&&r.push(e)}),r},gf.prototype.ra=function(n,r){var i=this;Ws(0===this.Wf(r.batchId,"removed")),this.Wn.shift();var o=this.Qf;return nu.forEach(r.mutations,function(t){var e=new gh(t.key,r.batchId);return o=o.delete(e),i.hh.Bo(n,t.key)}).next(function(){i.Qf=o})},gf.prototype.ha=function(t){},gf.prototype.Ch=function(t,e){var n=new gh(e,0),r=this.Qf.ze(n);return nu.resolve(e.isEqual(r&&r.key))},gf.prototype.oa=function(t){return this.Wn.length,nu.resolve()},gf.prototype.Wf=function(t,e){return this.Kf(t)},gf.prototype.Kf=function(t){return 0===this.Wn.length?0:t-this.Wn[0].batchId},gf.prototype.jf=function(t){var e=this.Kf(t);return e<0||e>=this.Wn.length?null:this.Wn[e]},gf),yf=(vf.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.zf(e);return this.docs=this.docs.Ae(r,{Mr:e,size:s,readTime:n}),this.size+=s-o,this.jn.Dr(t,r.path.L())},vf.prototype.kn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},vf.prototype.Ln=function(t,e){var n=this.docs.get(e);return nu.resolve(n?n.Mr:null)},vf.prototype.getEntries=function(t,e){var n=this,r=is;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ae(t,e?e.Mr:null)}),nu.resolve(r)},vf.prototype.Zn=function(t,e,n){for(var r=us,i=new Yr(e.path.child("")),o=this.docs.ve(i);o.$e();){var s=o.Ne(),u=s.key,a=s.value,h=a.Mr,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof wo&&e.matches(h)&&(r=r.Ae(h.key,h))}return nu.resolve(r)},vf.prototype.Hf=function(t,e){return nu.forEach(this.docs,function(t){return e(t)})},vf.prototype.Yr=function(t){return new vf.Jr(this)},vf.prototype.Zr=function(t){return nu.resolve(this.size)},vf);function vf(t,e){this.jn=t,this.zf=e,this.docs=new Ho(Yr.N),this.size=0}function gf(t,e){this.jn=t,this.hh=e,this.Wn=[],this.Uf=1,this.lastStreamToken=Jr.ht,this.Qf=new ns(gh.Xu)}function mf(){}function wf(t,e,n){this.query=t,this.Ff=e,this.Nf=!1,this.$f=null,this.onlineState="Unknown",this.options=n||{}}function bf(t){this.ol=t,this.yf=new Zs(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.bf=new Set,this.ol.subscribe(this)}function Ef(t,e,n,r,i){var o=this;return(o=Xc.call(this,t,e,n,r,i)||this).N_=t,o.Rf=void 0,o}function Tf(t,e,n,r,i){this.N_=t,this.$d=e,this.Ud=n,this.currentUser=r,this.Qd=i,this.Wd=null,this.jd=new Zs(function(t){return t.canonicalId()}),this.Kd=new Map,this.Gd=[],this.zd=new Ho(Yr.N),this.Hd=new Map,this.Yd=new vh,this.Jd={},this.Xd=new Map,this.Zd=Fu.rh(),this.onlineState="Unknown"}function If(t,e,n,r){this.Aa=t,this.$d=e,this.updateFunction=n,this.Va=r,this.kd=5,this.$a=new bu(this.Aa,"transaction_retry")}function Nf(t,e){this.query=t,this.wd=e,this.Rd=null,this.fs=!1,this.Ad=cs(),this.ns=cs(),this.md=new ys(t.se.bind(t))}function Af(){this.Ed=new rf,this.Id={},this.ol=null,this.g_=null,this.ur=null}function _f(t,e,n,r,i){if(this.Tr=t,this.platform=e,this.persistenceKey=n,this.vl=r,this.ol=null,this.g_=null,this.ur=null,this.Sl=this.Dl.bind(this),this.Cl=new Ho(Qs),this.ro=!1,this.Fl=[],!_f.Gh(this.platform))throw new Ar(Nr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Nl=Gc(this.persistenceKey,this.vl),this.$l="firestore_sequence_number_"+this.persistenceKey,this.Cl=this.Cl.Ae(this.vl,new rf),this.kl=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Ll=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ml=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Ol="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Sl)}function Sf(){this.activeTargetIds=fs}function kf(t,e){this.clientId=t,this.onlineState=e}function Df(t,e){this.clientId=t,this.activeTargetIds=e}function xf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Of(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Rf(t){var e=this;return(e=Jc.call(this)||this).th=t,e}yf.Jr=(n(Rf,Jc=ru),Rf.prototype.xn=function(n){var r=this,i=[];return this.Dn.forEach(function(t,e){e?i.push(r.th.Nn(n,e,r.readTime)):r.th.kn(t)}),nu.vn(i)},Rf.prototype.Mn=function(t,e){return this.th.Ln(t,e)},Rf.prototype.On=function(t,e){return this.th.getEntries(t,e)},Rf);var Pf,Lf,Vf=($f.prototype.js=function(t,n){return this.Yf.forEach(function(t,e){return n(e)}),nu.resolve()},$f.prototype._h=function(t){return nu.resolve(this.lastRemoteSnapshotVersion)},$f.prototype.lh=function(t){return nu.resolve(this.Jf)},$f.prototype.oh=function(t){return this.highestTargetId=this.Zf.next(),nu.resolve(this.highestTargetId)},$f.prototype.dh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Jf&&(this.Jf=e),nu.resolve()},$f.prototype.Th=function(t){this.Yf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Zf=new Fu(e),this.highestTargetId=e),t.sequenceNumber>this.Jf&&(this.Jf=t.sequenceNumber)},$f.prototype.fh=function(t,e){return this.Th(e),this.targetCount+=1,nu.resolve()},$f.prototype.Ih=function(t,e){return this.Th(e),nu.resolve()},$f.prototype.wh=function(t,e){return this.Yf.delete(e.target),this.Xf.nc(e.targetId),--this.targetCount,nu.resolve()},$f.prototype.Ah=function(n,r,i){var o=this,s=0,u=[];return this.Yf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Yf.delete(t),u.push(o.Rh(n,e.targetId)),s++)}),nu.vn(u).next(function(){return s})},$f.prototype.Vh=function(t){return nu.resolve(this.targetCount)},$f.prototype.gh=function(t,e){var n=this.Yf.get(e)||null;return nu.resolve(n)},$f.prototype.ph=function(t,e,n){return this.Xf.ec(e,n),nu.resolve()},$f.prototype.bh=function(e,t,n){this.Xf.ic(t,n);var r=this.persistence.hh,i=[];return r&&t.forEach(function(t){i.push(r.Bo(e,t))}),nu.vn(i)},$f.prototype.Rh=function(t,e){return this.Xf.nc(e),nu.resolve()},$f.prototype.Sh=function(t,e){var n=this.Xf.hc(e);return nu.resolve(n)},$f.prototype.Ch=function(t,e){return nu.resolve(this.Xf.Ch(e))},$f),Cf=(Hf.prototype.start=function(){return Promise.resolve()},Hf.prototype.mo=function(){return this.qh=!1,Promise.resolve()},Object.defineProperty(Hf.prototype,"ro",{get:function(){return this.qh},enumerable:!0,configurable:!0}),Hf.prototype.ho=function(){},Hf.prototype.Fo=function(){return this.jn},Hf.prototype.vo=function(t){var e=this.tT[t.s()];return e||(e=new df(this.jn,this.hh),this.tT[t.s()]=e),e},Hf.prototype.Do=function(){return this.Yh},Hf.prototype.Co=function(){return this.Qn},Hf.prototype.runTransaction=function(t,e,n){var r=this;Fs("MemoryPersistence","Starting transaction:",t);var i=new Uf(this.Bh.next());return this.hh.sT(),n(i).next(function(t){return r.hh.iT(i).next(function(){return t})}).yn().then(function(t){return i.Un(),t})},Hf.prototype.nT=function(e,n){return nu.Sn(Object.values(this.tT).map(function(t){return function(){return t.Ch(e,n)}}))},Hf),Uf=(n(Qf,Lf=ou),Qf),jf=(Yf.oT=function(t){return new Yf(t)},Object.defineProperty(Yf.prototype,"aT",{get:function(){if(this.hT)return this.hT;throw zs()},enumerable:!0,configurable:!0}),Yf.prototype.yh=function(t,e,n){return this.rT.yh(n,e),this.aT.delete(n),nu.resolve()},Yf.prototype.vh=function(t,e,n){return this.rT.vh(n,e),this.aT.add(n),nu.resolve()},Yf.prototype.Bo=function(t,e){return this.aT.add(e),nu.resolve()},Yf.prototype.removeTarget=function(t,e){var n=this;this.rT.nc(e.targetId).forEach(function(t){return n.aT.add(t)});var r=this.persistence.Do();return r.Sh(t,e.targetId).next(function(t){t.forEach(function(t){return n.aT.add(t)})}).next(function(){return r.wh(t,e)})},Yf.prototype.sT=function(){this.hT=new Set},Yf.prototype.iT=function(t){var n=this,r=this.persistence.Co().Yr();return nu.forEach(this.aT,function(e){return n.uT(t,e).next(function(t){t||r.kn(e)})}).next(function(){return n.hT=null,r.apply(t)})},Yf.prototype.Wo=function(t,e){var n=this;return this.uT(t,e).next(function(t){t?n.aT.delete(e):n.aT.add(e)})},Yf.prototype.eT=function(t){return 0},Yf.prototype.uT=function(t,e){var n=this;return nu.Sn([function(){return nu.resolve(n.rT.Ch(e))},function(){return n.persistence.Do().Ch(t,e)},function(){return n.persistence.nT(t,e)}])},Yf),Mf=(Kf.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Ud=this.cT(n),this.persistence=this._T(n),[4,this.persistence.start()];case 1:return t.sent(),this.lT=this.dT(n),this.N_=this.fT(n),this.$d=this.TT(n),this.ol=this.ET(n),this.IT=this.wT(n),this.Ud.g_=function(t){return e.ol.Dd(t,1)},this.$d.ol=this.ol,[4,this.N_.start()];case 2:return t.sent(),[4,this.Ud.start()];case 3:return t.sent(),[4,this.$d.start()];case 4:return t.sent(),[4,this.$d.Vl(this.ol.tf)];case 5:return t.sent(),[2]}})})},Kf.prototype.wT=function(t){return new ff(this.ol)},Kf.prototype.dT=function(t){return null},Kf.prototype.fT=function(t){return new ah(this.persistence,new pf,t.RT)},Kf.prototype._T=function(t){return new Cf(jf.oT)},Kf.prototype.TT=function(t){var e=this;return new Vc(this.N_,t.T_,t.Aa,function(t){return e.ol.Dd(t,0)},t.platform.AT())},Kf.prototype.cT=function(t){return new sf},Kf.prototype.ET=function(t){return new hf(this.N_,this.$d,this.Ud,t.RT,t.Qd)},Kf.prototype.clearPersistence=function(t){throw new Ar(Nr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},Kf),qf=(n(Wf,Pf=Mf),Wf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Pf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.no(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.ol.Vl(e)];case 1:return t.sent(),this.lT&&(e&&!this.lT.ro?this.lT.start(this.N_):e||this.lT.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},Wf.prototype.fT=function(t){return new ph(this.persistence,new pf,t.RT)},Wf.prototype.ET=function(t){var e=new cf(this.N_,this.$d,this.Ud,t.RT,t.Qd);return this.Ud instanceof of&&(this.Ud.ol=e),e},Wf.prototype.dT=function(t){var e=this.persistence.hh.ko;return new sh(e,t.Aa)},Wf.prototype._T=function(t){var e=Ju.$o(t.mT),n=t.platform.bc(t.mT.ii);return new Ju(t.PT.synchronizeTabs,e,t.clientId,t.platform,rh.hu(t.PT.cacheSizeBytes),t.Aa,n,this.Ud)},Wf.prototype.cT=function(t){if(t.PT.VT&&t.PT.synchronizeTabs){if(!of.Gh(t.platform))throw new Ar(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=Ju.$o(t.mT);return new of(t.Aa,t.platform,e,t.clientId,t.RT)}return new sf},Wf.prototype.clearPersistence=function(t){var e=Ju.$o(t);return Ju.clearPersistence(e)},Wf),Ff=(zf.prototype.start=function(e,n){var r=this;this.gT();var i=new wu,o=new wu,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,Fs("FirestoreClient","Initializing. user=",t.uid),r.pT(e,n,t,o).then(i.resolve,i.reject);r.Aa.Ua(function(){return r.Pl(t)})}),this.Aa.uo(function(){return i.promise}),o.promise},zf.prototype.enableNetwork=function(){var t=this;return this.gT(),this.Aa.enqueue(function(){return t.ol.enableNetwork()})},zf.prototype.pT=function(u,a,h,c){return y(this,void 0,void 0,function(){var n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.yT(this.mT)];case 1:return n=t.sent(),r=this.platform.bc(this.mT.ii),e=this.credentials,i=new Rc(n,e,r),[4,u.initialize({Aa:this.Aa,mT:this.mT,platform:this.platform,T_:i,clientId:this.clientId,RT:h,Qd:100,PT:a})];case 2:return t.sent(),this.persistence=u.persistence,this.Ud=u.Ud,this.N_=u.N_,this.$d=u.$d,this.ol=u.ol,this.lT=u.lT,this.bT=u.IT,this.persistence.ho(function(){return y(s,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),c.resolve(),[3,4];case 3:if(o=t.sent(),c.reject(o),!this.vT(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.pT(new Mf,{VT:!1},h,c))];case 4:return[2]}var e})})},zf.prototype.vT=function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},zf.prototype.gT=function(){if(this.Aa.La)throw new Ar(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},zf.prototype.Pl=function(t){return this.Aa.Wa(),Fs("FirestoreClient","Credential Changed. Current user: "+t.uid),this.ol.Pl(t)},zf.prototype.disableNetwork=function(){var t=this;return this.gT(),this.Aa.enqueue(function(){return t.ol.disableNetwork()})},zf.prototype.terminate=function(){var t=this;return this.Aa.qa(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.lT&&this.lT.stop(),[4,this.$d.mo()];case 1:return t.sent(),[4,this.Ud.mo()];case 2:return t.sent(),[4,this.persistence.mo()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},zf.prototype.waitForPendingWrites=function(){var t=this;this.gT();var e=new wu;return this.Aa.uo(function(){return t.ol.lf(e)}),e.promise},zf.prototype.listen=function(t,e,n){var r=this;this.gT();var i=new lf(t,e,n);return this.Aa.uo(function(){return r.bT.listen(i)}),i},zf.prototype.rl=function(t){var e=this;this.ST||this.Aa.uo(function(){return e.bT.rl(t)})},zf.prototype.DT=function(o){return y(this,void 0,void 0,function(){var i,e=this;return v(this,function(t){switch(t.label){case 0:return this.gT(),i=new wu,[4,this.Aa.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.N_.Uu(o)];case 1:return(e=t.sent())instanceof wo?i.resolve(e):e instanceof bo?i.resolve(null):i.reject(new Ar(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=Za(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},zf.prototype.CT=function(a){return y(this,void 0,void 0,function(){var u,e=this;return v(this,function(t){switch(t.label){case 0:return this.gT(),u=new wu,[4,this.Aa.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.N_.ju(a,!0)];case 1:return e=t.sent(),n=new uf(a,e.Ku),r=n.Vd(e.documents),i=n.xn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=Za(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},zf.prototype.write=function(t){var e=this;this.gT();var n=new wu;return this.Aa.uo(function(){return e.ol.write(t,n)}),n.promise},zf.prototype.ii=function(){return this.mT.ii},zf.prototype.Df=function(t){var e=this;this.gT(),this.Aa.uo(function(){return e.bT.Df(t),Promise.resolve()})},zf.prototype.Cf=function(t){var e=this;this.ST||this.Aa.uo(function(){return e.bT.Cf(t),Promise.resolve()})},Object.defineProperty(zf.prototype,"ST",{get:function(){return this.Aa.La},enumerable:!0,configurable:!0}),zf.prototype.transaction=function(t){var e=this;this.gT();var n=new wu;return this.Aa.uo(function(){return e.ol.runTransaction(e.Aa,t,n),Promise.resolve()}),n.promise},zf),Bf=(Gf.prototype.next=function(t){this.FT(this.observer.next,t)},Gf.prototype.error=function(t){this.FT(this.observer.error,t)},Gf.prototype.NT=function(){this.muted=!0},Gf.prototype.FT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Gf);function Gf(t){this.observer=t,this.muted=!1}function zf(t,e,n,r){this.platform=t,this.mT=e,this.credentials=n,this.Aa=r,this.clientId=Ks.cn()}function Wf(){return null!==Pf&&Pf.apply(this,arguments)||this}function Kf(){}function Yf(t){this.persistence=t,this.rT=new vh,this.hT=null}function Qf(t){var e=this;return(e=Lf.call(this)||this).Oh=t,e}function Hf(t){var e=this;this.tT={},this.Bh=new au(0),this.qh=!1,this.qh=!0,this.hh=t(this),this.Yh=new Vf(this),this.jn=new _u,this.Qn=new yf(this.jn,function(t){return e.hh.eT(t)})}function $f(t){this.persistence=t,this.Yf=new Zs(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Or.min(),this.highestTargetId=0,this.Jf=0,this.Xf=new vh,this.targetCount=0,this.Zf=Fu.nh()}function Xf(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Jf,Zf,tl=(Nl.prototype.kT=function(t){switch(si(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pi(t.integerValue||t.doubleValue);case 3:return this.LT(t.timestampValue);case 4:return this.MT(t);case 5:return t.stringValue;case 6:return new qh(di(t.bytesValue));case 7:return this.OT(t.referenceValue);case 8:return this.xT(t.geoPointValue);case 9:return this.BT(t.arrayValue);case 10:return this.qT(t.mapValue);default:throw zs()}},Nl.prototype.qT=function(t){var n=this,r={};return $r(t.fields||{},function(t,e){r[t]=n.kT(e)}),r},Nl.prototype.xT=function(t){return new nc(pi(t.latitude),pi(t.longitude))},Nl.prototype.BT=function(t){var e=this;return(t.values||[]).map(function(t){return e.kT(t)})},Nl.prototype.MT=function(t){switch(this.$T){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return ri(n)?t(n):n}(t);return null==e?null:this.kT(e);case"estimate":return this.LT(ii(t));default:return null}},Nl.prototype.LT=function(t){var e=li(t),n=new xr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Nl.prototype.OT=function(t){var e=Pr.K(t);Ws(Vs(e));var n=new Js(e.get(1),e.get(3)),r=new Yr(e.k(5));return n.isEqual(this.firestore.$c)||Bs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.$c.projectId+"/"+this.firestore.$c.database+") instead."),new sl(r,this.firestore,this.converter)},Nl),el=rh.uu,nl=(Il.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Il),rl=(Object.defineProperty(Tl.prototype,"JT",{get:function(){return this.XT||(this.XT=new vc(this.$c,this.YT.ignoreUndefinedProperties)),this.XT},enumerable:!0,configurable:!0}),Tl.prototype.settings=function(t){Eh("Firestore.settings",arguments,1),Nh("Firestore.settings","object",1,t);var e=new nl(t);if(this.jT&&!this.YT.isEqual(e))throw new Ar(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.YT=e).credentials&&(this.zT=function(t){if(!t)return new _r;switch(t.type){case"gapi":var e=t.ZT;return Ws(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Dr(e,t.V||"0");case"provider":return t.ZT;default:throw new Ar(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Tl.prototype.enableNetwork=function(){return this.WT(),this.jT.enableNetwork()},Tl.prototype.disableNetwork=function(){return this.WT(),this.jT.disableNetwork()},Tl.prototype.enablePersistence=function(t){var e,n;if(this.jT)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Bs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.tE(this.HT,{VT:!0,cacheSizeBytes:this.YT.cacheSizeBytes,synchronizeTabs:r})},Tl.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.jT&&!this.jT.ST)throw new Ar(Nr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new wu,[2,(this.QT.Ma(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.eE(),[4,this.HT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},Tl.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Tl.prototype,"sE",{get:function(){return this.WT(),this.jT.ST},enumerable:!0,configurable:!0}),Tl.prototype.waitForPendingWrites=function(){return this.WT(),this.jT.waitForPendingWrites()},Tl.prototype.onSnapshotsInSync=function(t){if(this.WT(),Xf(t))return this.iE(t);Nh("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.iE(e)},Tl.prototype.iE=function(t){var e=this,n=new Bf({next:function(){t.next&&t.next()},error:function(t){throw zs()}});return this.jT.Df(n),function(){n.NT(),e.jT.Cf(n)}},Tl.prototype.WT=function(){return this.jT||this.tE(new Mf,{VT:!1}),this.jT},Tl.prototype.eE=function(){return new Xs(this.$c,this.GT,this.YT.host,this.YT.ssl,this.YT.forceLongPolling)},Tl.prototype.tE=function(t,e){var n=this.eE();return this.jT=new Ff(Cs.nt(),n,this.zT,this.QT),this.jT.start(t,e)},Tl.KT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Ar(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Ar(Nr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Js(n)},Object.defineProperty(Tl.prototype,"app",{get:function(){if(!this.UT)throw new Ar(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.UT},enumerable:!0,configurable:!0}),Tl.prototype.collection=function(t){return Eh("Firestore.collection",arguments,1),Nh("Firestore.collection","non-empty string",1,t),this.WT(),new ll(Pr.K(t),this)},Tl.prototype.doc=function(t){return Eh("Firestore.doc",arguments,1),Nh("Firestore.doc","non-empty string",1,t),this.WT(),sl.nE(Pr.K(t),this)},Tl.prototype.collectionGroup=function(t){if(Eh("Firestore.collectionGroup",arguments,1),Nh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.WT(),new cl(new Io(Pr.G,t),this)},Tl.prototype.runTransaction=function(e){var n=this;return Eh("Firestore.runTransaction",arguments,1),Nh("Firestore.runTransaction","function",1,e),this.WT().transaction(function(t){return e(new il(n,t))})},Tl.prototype.batch=function(){return this.WT(),new ol(this)},Object.defineProperty(Tl,"logLevel",{get:function(){switch(Ms()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),Tl.setLogLevel=function(t){switch(Eh("Firestore.setLogLevel",arguments,1),Nh("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":qs(l.DEBUG);break;case"error":qs(l.ERROR);break;case"silent":qs(l.SILENT);break;default:throw new Ar(Nr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Tl.prototype.rE=function(){return this.YT.timestampsInSnapshots},Tl),il=(El.prototype.get=function(t){var n=this;Eh("Transaction.get",arguments,1);var r=kl("Transaction.get",t,this.hE);return this.oE.A_([r.kc]).then(function(t){if(!t||1!==t.length)return zs();var e=t[0];if(e instanceof bo)return new al(n.hE,r.kc,null,!1,!1,r.aE);if(e instanceof wo)return new al(n.hE,r.kc,e,!1,!1,r.aE);throw zs()})},El.prototype.set=function(t,e,n){Ih("Transaction.set",arguments,2,3);var r=kl("Transaction.set",t,this.hE);n=Al("Transaction.set",n);var i=Dl(r.aE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.hE.JT.Dc(s,o,n.mergeFields):this.hE.JT.vc(s,o);return this.oE.set(r.kc,u),this},El.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Fh?(Th("Transaction.update",arguments,3),r=kl("Transaction.update",t,this.hE),this.hE.JT.Fc("Transaction.update",e,n,o)):(Eh("Transaction.update",arguments,2),r=kl("Transaction.update",t,this.hE),this.hE.JT.Cc("Transaction.update",e)),this.oE.update(r.kc,i),this},El.prototype.delete=function(t){Eh("Transaction.delete",arguments,1);var e=kl("Transaction.delete",t,this.hE);return this.oE.delete(e.kc),this},El),ol=(bl.prototype.set=function(t,e,n){Ih("WriteBatch.set",arguments,2,3),this._E();var r=kl("WriteBatch.set",t,this.hE);n=Al("WriteBatch.set",n);var i=Dl(r.aE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.hE.JT.Dc(s,o,n.mergeFields):this.hE.JT.vc(s,o);return this.uE=this.uE.concat(u.Ac(r.kc,ji.ft())),this},bl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this._E(),i="string"==typeof e||e instanceof Fh?(Th("WriteBatch.update",arguments,3),r=kl("WriteBatch.update",t,this.hE),this.hE.JT.Fc("WriteBatch.update",e,n,o)):(Eh("WriteBatch.update",arguments,2),r=kl("WriteBatch.update",t,this.hE),this.hE.JT.Cc("WriteBatch.update",e)),this.uE=this.uE.concat(i.Ac(r.kc,ji.exists(!0))),this},bl.prototype.delete=function(t){Eh("WriteBatch.delete",arguments,1),this._E();var e=kl("WriteBatch.delete",t,this.hE);return this.uE=this.uE.concat(new Gi(e.kc,ji.ft())),this},bl.prototype.commit=function(){return this._E(),this.cE=!0,0<this.uE.length?this.hE.WT().write(this.uE):Promise.resolve()},bl.prototype._E=function(){if(this.cE)throw new Ar(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},bl),sl=(wl.nE=function(t,e,n){if(t.length%2!=0)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new wl(new Yr(t),e,n)},Object.defineProperty(wl.prototype,"id",{get:function(){return this.kc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(wl.prototype,"parent",{get:function(){return new ll(this.kc.path.L(),this.firestore,this.aE)},enumerable:!0,configurable:!0}),Object.defineProperty(wl.prototype,"path",{get:function(){return this.kc.path.j()},enumerable:!0,configurable:!0}),wl.prototype.collection=function(t){if(Eh("DocumentReference.collection",arguments,1),Nh("DocumentReference.collection","non-empty string",1,t),!t)throw new Ar(Nr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Pr.K(t);return new ll(this.kc.path.child(e),this.firestore)},wl.prototype.isEqual=function(t){if(!(t instanceof wl))throw Lh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.kc.isEqual(t.kc)&&this.aE===t.aE},wl.prototype.set=function(t,e){Ih("DocumentReference.set",arguments,1,2),e=Al("DocumentReference.set",e);var n=Dl(this.aE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.JT.Dc(i,r,e.mergeFields):this.firestore.JT.vc(i,r);return this.jT.write(o.Ac(this.kc,ji.ft()))},wl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Fh?(Th("DocumentReference.update",arguments,2),this.firestore.JT.Fc("DocumentReference.update",t,e,r)):(Eh("DocumentReference.update",arguments,1),this.firestore.JT.Cc("DocumentReference.update",t)),this.jT.write(n.Ac(this.kc,ji.exists(!0)))},wl.prototype.delete=function(){return Eh("DocumentReference.delete",arguments,0),this.jT.write([new Gi(this.kc,ji.ft())])},wl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ih("DocumentReference.onSnapshot",arguments,1,4);var n={includeMetadataChanges:!1},r=0;"object"!=typeof t[r]||Xf(t[r])||(Ph("DocumentReference.onSnapshot",n=t[r],["includeMetadataChanges"]),Sh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges),r++);var i={includeMetadataChanges:n.includeMetadataChanges},o=Xf(t[r])?t[r]:(Nh("DocumentReference.onSnapshot","function",r,t[r]),Ah("DocumentReference.onSnapshot","function",r+1,t[r+1]),Ah("DocumentReference.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]});return this.lE(i,o)},wl.prototype.lE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Bf({next:function(t){var e;n.next&&(e=t.docs.get(r.kc),n.next(new al(r.firestore,r.kc,e,t.fromCache,t.hasPendingWrites,r.aE)))},error:e}),o=this.jT.listen(Io.Wt(this.kc.path),i,t);return function(){i.NT(),r.jT.rl(o)}},wl.prototype.get=function(n){var r=this;return Ih("DocumentReference.get",arguments,0,1),Sl("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.WT().DT(r.kc).then(function(t){e(new al(r.firestore,r.kc,t,!0,t instanceof wo&&t.At,r.aE))},t):r.dE(e,t,n)})},wl.prototype.dE=function(e,n,r){var i=this.lE({includeMetadataChanges:!0,Of:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Ar(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Ar(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},wl.prototype.withConverter=function(t){return new wl(this.kc,this.firestore,t)},wl),ul=(ml.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ml),al=(gl.prototype.data=function(t){if(Ih("DocumentSnapshot.data",arguments,0,1),t=_l("DocumentSnapshot.data",t),this.fE){if(this.aE){var e=new hl(this.hE,this.kc,this.fE,this.TE,this.EE);return this.aE.fromFirestore(e,t)}return new tl(this.hE,this.hE.rE(),t.serverTimestamps,void 0).kT(this.fE.Lt())}},gl.prototype.get=function(t,e){if(Ih("DocumentSnapshot.get",arguments,1,2),e=_l("DocumentSnapshot.get",e),this.fE){var n=this.fE.data().field(Ic("DocumentSnapshot.get",t));if(null!==n)return new tl(this.hE,this.hE.rE(),e.serverTimestamps,this.aE).kT(n)}},Object.defineProperty(gl.prototype,"id",{get:function(){return this.kc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(gl.prototype,"ref",{get:function(){return new sl(this.kc,this.hE,this.aE)},enumerable:!0,configurable:!0}),Object.defineProperty(gl.prototype,"exists",{get:function(){return null!==this.fE},enumerable:!0,configurable:!0}),Object.defineProperty(gl.prototype,"metadata",{get:function(){return new ul(this.EE,this.TE)},enumerable:!0,configurable:!0}),gl.prototype.isEqual=function(t){if(!(t instanceof gl))throw Lh("isEqual","DocumentSnapshot",1,t);return this.hE===t.hE&&this.TE===t.TE&&this.kc.isEqual(t.kc)&&(null===this.fE?null===t.fE:this.fE.isEqual(t.fE))&&this.aE===t.aE},gl),hl=(n(vl,Zf=al),vl.prototype.data=function(t){return Zf.prototype.data.call(this,t)},vl),cl=(yl.prototype.where=function(t,e,n){Eh("Query.where",arguments,3),Rh("Query.where",3,n);var r,i=function(t,e){if(!t.some(function(t){return t===e}))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid value "+Oh(e)+" provided to function Query.where() for its "+Ch(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Ic("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.wE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.RE(h))}r={arrayValue:{values:s}}}else r=this.RE(n)}else"in"!==i&&"array-contains-any"!==i||this.wE(n,i),r=this.firestore.JT.Nc("Query.where",n,"in"===i);var c=No.create(o,i,r);return this.AE(c),new yl(this.IE.Gt(c),this.firestore,this.aE)},yl.prototype.orderBy=function(t,e){var n;if(Ih("Query.orderBy",arguments,1,2),Ah("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Ar(Nr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.IE.startAt)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.IE.endAt)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Ic("Query.orderBy",t),i=new Oo(r,n);return this.mE(i),new yl(this.IE.zt(i),this.firestore,this.aE)},yl.prototype.limit=function(t){return Eh("Query.limit",arguments,1),Nh("Query.limit","number",1,t),Vh("Query.limit",1,t),new yl(this.IE.Ht(t),this.firestore,this.aE)},yl.prototype.limitToLast=function(t){return Eh("Query.limitToLast",arguments,1),Nh("Query.limitToLast","number",1,t),Vh("Query.limitToLast",1,t),new yl(this.IE.Yt(t),this.firestore,this.aE)},yl.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Th("Query.startAt",arguments,1);var r=this.PE("Query.startAt",t,e,!0);return new yl(this.IE.Jt(r),this.firestore,this.aE)},yl.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Th("Query.startAfter",arguments,1);var r=this.PE("Query.startAfter",t,e,!1);return new yl(this.IE.Jt(r),this.firestore,this.aE)},yl.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Th("Query.endBefore",arguments,1);var r=this.PE("Query.endBefore",t,e,!0);return new yl(this.IE.Xt(r),this.firestore,this.aE)},yl.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Th("Query.endAt",arguments,1);var r=this.PE("Query.endAt",t,e,!1);return new yl(this.IE.Xt(r),this.firestore,this.aE)},yl.prototype.isEqual=function(t){if(!(t instanceof yl))throw Lh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.IE.isEqual(t.IE)},yl.prototype.withConverter=function(t){return new yl(this.IE,this.firestore,t)},yl.prototype.PE=function(t,e,n,r){if(Rh(t,1,e),e instanceof al){if(0<n.length)throw new Ar(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Ar(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.VE(i.fE,r)}var o=[e].concat(n);return this.gE(t,o,r)},yl.prototype.VE=function(t,e){for(var n=[],r=0,i=this.IE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(yi(this.firestore.$c,t.key));else{var s=t.field(o.field);if(ri(s))throw new Ar(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new xo(n,e)},yl.prototype.gE=function(t,e,n){var r=this.IE.xt;if(e.length>r.length)throw new Ar(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.IE._e()&&-1!==s.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.IE.path.child(Pr.K(s));if(!Yr.et(u))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Yr(u);i.push(yi(this.firestore.$c,a))}else{var h=this.firestore.JT.Nc(t,s);i.push(h)}}return new xo(i,n)},yl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ih("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Xf(t[i])||(Ph("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Sh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Xf(t[i])?t[i]:(Nh("Query.onSnapshot","function",i,t[i]),Ah("Query.onSnapshot","function",i+1,t[i+1]),Ah("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.pE(this.IE),this.lE(r,n)},yl.prototype.lE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Bf({next:function(t){e.next&&e.next(new fl(n.firestore,n.IE,t,n.aE))},error:r}),o=this.firestore.WT(),s=o.listen(this.IE,i,t);return function(){i.NT(),o.rl(s)}},yl.prototype.pE=function(t){if(t.ae()&&0===t.xt.length)throw new Ar(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},yl.prototype.get=function(n){var r=this;return Ih("Query.get",arguments,0,1),Sl("Query.get",n),this.pE(this.IE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.WT().CT(r.IE).then(function(t){e(new fl(r.firestore,r.IE,t,r.aE))},t):r.dE(e,t,n)})},yl.prototype.dE=function(e,n,r){var i=this.lE({includeMetadataChanges:!0,Of:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Ar(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},yl.prototype.RE=function(t){if("string"==typeof t){if(""===t)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.IE._e()&&-1!==t.indexOf("/"))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.IE.path.child(Pr.K(t));if(!Yr.et(e))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return yi(this.firestore.$c,new Yr(e))}if(t instanceof sl)return yi(this.firestore.$c,t.kc);throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Oh(t)+".")},yl.prototype.wE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},yl.prototype.AE=function(t){if(t instanceof No){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.IE.jt();if(null!==o&&!o.isEqual(t.field))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.IE.Kt();null!==s&&this.yE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.IE.ce(n)),null===u&&r&&(u=this.IE.ce(e)),null!=u)throw u===t.op?new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},yl.prototype.mE=function(t){var e;null!==this.IE.Kt()||null!==(e=this.IE.jt())&&this.yE(e,t.field)},yl.prototype.yE=function(t,e){if(!e.isEqual(t))throw new Ar(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},yl),fl=(Object.defineProperty(dl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(dl.prototype,"empty",{get:function(){return this.vE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(dl.prototype,"size",{get:function(){return this.vE.docs.size},enumerable:!0,configurable:!0}),dl.prototype.forEach=function(e,n){var r=this;Ih("QuerySnapshot.forEach",arguments,1,2),Nh("QuerySnapshot.forEach","function",1,e),this.vE.docs.forEach(function(t){e.call(n,r.CE(t))})},Object.defineProperty(dl.prototype,"query",{get:function(){return new cl(this.bE,this.hE,this.aE)},enumerable:!0,configurable:!0}),dl.prototype.docChanges=function(t){t&&(Ph("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Sh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.vE.hs)throw new Ar(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.SE&&this.DE===e||(this.SE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new hl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new hl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return zs()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.hE,e,this.vE,this.aE),this.DE=e),this.SE},dl.prototype.isEqual=function(t){if(!(t instanceof dl))throw Lh("isEqual","QuerySnapshot",1,t);return this.hE===t.hE&&this.bE.isEqual(t.bE)&&this.vE.isEqual(t.vE)&&this.aE===t.aE},dl.prototype.CE=function(t){return new hl(this.hE,t.key,t,this.metadata.fromCache,this.vE.ns.has(t.key),this.aE)},dl),ll=(n(pl,Jf=cl),Object.defineProperty(pl.prototype,"id",{get:function(){return this.IE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"parent",{get:function(){var t=this.IE.path.L();return t.B()?null:new sl(new Yr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"path",{get:function(){return this.IE.path.j()},enumerable:!0,configurable:!0}),pl.prototype.doc=function(t){if(Ih("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Ks.cn()),Nh("CollectionReference.doc","non-empty string",1,t),""===t)throw new Ar(Nr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Pr.K(t);return sl.nE(this.IE.path.child(e),this.firestore,this.aE)},pl.prototype.add=function(t){Eh("CollectionReference.add",arguments,1),Nh("CollectionReference.add","object",1,this.aE?this.aE.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},pl.prototype.withConverter=function(t){return new pl(this.FE,this.firestore,t)},pl);function pl(t,e,n){var r=this;if(((r=Jf.call(this,Io.Wt(t),e,n)||this).FE=t).length%2!=1)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function dl(t,e,n,r){this.hE=t,this.bE=e,this.vE=n,this.aE=r,this.SE=null,this.DE=null,this.metadata=new ul(n.hasPendingWrites,n.fromCache)}function yl(t,e,n){this.IE=t,this.firestore=e,this.aE=n}function vl(){return null!==Zf&&Zf.apply(this,arguments)||this}function gl(t,e,n,r,i,o){this.hE=t,this.kc=e,this.fE=n,this.TE=r,this.EE=i,this.aE=o}function ml(t,e){this.hasPendingWrites=t,this.fromCache=e}function wl(t,e,n){this.kc=t,this.firestore=e,this.aE=n,this.jT=this.firestore.WT()}function bl(t){this.hE=t,this.uE=[],this.cE=!1}function El(t,e){this.hE=t,this.oE=e}function Tl(t,e,n){var r=this;if(void 0===n&&(n=new Mf),this.UT=null,this.QT=new $a,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.WT(),[4,this.jT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.UT=i,this.$c=Tl.KT(i),this.GT=i.name,this.zT=new Sr(e)}else{var o=t;if(!o.projectId)throw new Ar(Nr.INVALID_ARGUMENT,"Must provide projectId");this.$c=new Js(o.projectId,o.database),this.GT="[DEFAULT]",this.zT=new _r}this.HT=n,this.YT=new nl({})}function Il(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Ar(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else _h("settings","non-empty string","host",t.host),this.host=t.host,Sh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ph("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Sh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Sh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Sh("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Bs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Bs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Sh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=rh._u;else{if(t.cacheSizeBytes!==el&&t.cacheSizeBytes<rh.cu)throw new Ar(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+rh.cu);this.cacheSizeBytes=t.cacheSizeBytes}Sh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function Nl(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.$T=n,this.converter=r}function Al(t,e){if(void 0===e)return{merge:!1};if(Ph(t,e,["merge","mergeFields"]),Sh(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Oh(n));for(var r,i=0;i<n.length;++i)if(!("string"==typeof(r=n[i])||r instanceof Fh))throw new Ar(Nr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Oh(n[i]))}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new Ar(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function _l(t,e){return void 0===e?{}:(Ph(t,e,["serverTimestamps"]),kh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Sl(t,e){Ah(t,"object",1,e),e&&(Ph(t,e,["source"]),kh(t,0,"source",e.source,["default","server","cache"]))}function kl(t,e,n){if(e instanceof sl){if(e.firestore!==n)throw new Ar(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Lh(t,"DocumentReference",1,e)}function Dl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function xl(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Ar(Nr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var Ol,Rl=xl(rl,"Use firebase.firestore() instead."),Pl=xl(il,"Use firebase.firestore().runTransaction() instead."),Ll=xl(ol,"Use firebase.firestore().batch() instead."),Vl=xl(sl,"Use firebase.firestore().doc() instead."),Cl=xl(al),Ul=xl(hl),jl=xl(cl),Ml=xl(fl),ql=xl(ll,"Use firebase.firestore().collection() instead."),Fl=xl((tp.delete=function(){return bh("FieldValue.delete",arguments),new Xh},tp.serverTimestamp=function(){return bh("FieldValue.serverTimestamp",arguments),new Jh},tp.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Th("FieldValue.arrayUnion",arguments,1),new Zh(t)},tp.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Th("FieldValue.arrayRemove",arguments,1),new tc(t)},tp.increment=function(t){return Nh("FieldValue.increment","number",1,t),Eh("FieldValue.increment",arguments,1),new ec(t)},tp.prototype.isEqual=function(t){return this===t},tp),"Use FieldValue.<field>() instead."),Bl=xl(qh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Gl={Firestore:Rl,GeoPoint:nc,Timestamp:xr,Blob:Bl,Transaction:Pl,WriteBatch:Ll,DocumentReference:Vl,DocumentSnapshot:Cl,Query:jl,QueryDocumentSnapshot:Ul,QuerySnapshot:Ml,CollectionReference:ql,FieldPath:Fh,FieldValue:Fl,setLogLevel:rl.setLogLevel,CACHE_SIZE_UNLIMITED:el},zl=(Zl.prototype.B_=function(t){},Zl.prototype.mo=function(){},Zl),Wl=(Jl.prototype.B_=function(t){this.ME.push(t)},Jl.prototype.mo=function(){window.removeEventListener("online",this.NE),window.removeEventListener("offline",this.kE)},Jl.prototype.OE=function(){window.addEventListener("online",this.NE),window.addEventListener("offline",this.kE)},Jl.prototype.$E=function(){Fs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.ME;t<e.length;t++)(0,e[t])(0)},Jl.prototype.LE=function(){Fs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.ME;t<e.length;t++)(0,e[t])(1)},Jl.Gh=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Jl),Kl=(Xl.prototype.e_=function(t){this.qE=t},Xl.prototype.Yc=function(t){this.UE=t},Xl.prototype.onMessage=function(t){this.QE=t},Xl.prototype.close=function(){this.BE()},Xl.prototype.send=function(t){this.xE(t)},Xl.prototype.WE=function(){this.qE()},Xl.prototype.jE=function(t){this.UE(t)},Xl.prototype.KE=function(t){this.QE(t)},Xl),Yl={BatchGetDocuments:"batchGet",Commit:"commit"},Ql="gl-js/ fire/"+mr,Hl=($l.prototype.zE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=Ql},$l.prototype.d_=function(a,r,i){var h=this,c=this.HE(a);return new Promise(function(o,s){var u=new gr;u.listenOnce(yr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case dr.NO_ERROR:var t=u.getResponseJson();Fs("Connection","XHR received:",JSON.stringify(t)),o(t);break;case dr.TIMEOUT:Fs("Connection",'RPC "'+a+'" timed out'),s(new Ar(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var e,n,r=u.getStatus();Fs("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Nr).indexOf(i)?i:Nr.UNKNOWN,s(new Ar(n,e.message))):s(new Ar(Nr.UNKNOWN,"Server responded with status "+u.getStatus())):(Fs("Connection",'RPC "'+a+'" failed'),s(new Ar(Nr.UNAVAILABLE,"Connection failed.")));break;default:zs()}}finally{Fs("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Fs("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.zE(n,i),u.send(c,"POST",e,n,15)})},$l.prototype.f_=function(t,e,n){return this.d_(t,e,n)},$l.prototype.s_=function(t,e){var n,r,i=[this.GE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=pr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.zE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Fs("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new Kl({xE:function(t){f?Fs("Connection","Not sending because WebChannel is closed:",t):(c||(Fs("Connection","Opening WebChannel transport."),h.open(),c=!0),Fs("Connection","WebChannel sending:",t),h.send(t))},BE:function(){return h.close()}});return a(vr.EventType.OPEN,function(){f||Fs("Connection","WebChannel transport opened.")}),a(vr.EventType.CLOSE,function(){f||(f=!0,Fs("Connection","WebChannel transport closed"),l.jE())}),a(vr.EventType.ERROR,function(t){f||(f=!0,Fs("Connection","WebChannel transport errored:",t),l.jE(new Ar(Nr.UNAVAILABLE,"The operation could not be completed")))}),a(vr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Ws(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Fs("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=uo[i];if(void 0!==t)return Qo(t)}(),s=r.message,void 0===o&&(o=Nr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.jE(new Ar(o,s)),h.close()):(Fs("Connection","WebChannel received:",n),l.KE(n)))}),setTimeout(function(){l.WE()},0),l},$l.prototype.HE=function(t){var e=Yl[t];return this.GE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},$l);function $l(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.GE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Xl(t){this.xE=t.xE,this.BE=t.BE}function Jl(){var t=this;this.NE=function(){return t.$E()},this.kE=function(){return t.LE()},this.ME=[],this.OE()}function Zl(){}function tp(){}function ep(){this.ac="undefined"!=typeof atob}Cs.an((Object.defineProperty(ep.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(ep.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),ep.prototype.yT=function(t){return Promise.resolve(new Hl(t))},ep.prototype.AT=function(){return new(Wl.Gh()?Wl:zl)},ep.prototype.bc=function(t){return new Ps(t,{hi:!0})},ep.prototype.un=function(t){return JSON.stringify(t)},ep.prototype.atob=function(t){return atob(t)},ep.prototype.btoa=function(t){return btoa(t)},ep.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new ep)),(Ol=np).INTERNAL.registerComponent(new E("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new rl(e,n,new qf);var e,n},"PUBLIC").setServiceProps(Object.assign({},Gl))),Ol.registerVersion("@firebase/firestore","1.14.6-0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});