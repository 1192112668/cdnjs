!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(kv){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e,l,n,r=t(kv),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function m(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(n=l=l||{})[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT";function a(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=f[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,u(["["+i+"]  "+t.name+":"],n))}}var c={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},h=l.INFO,f=((e={})[l.DEBUG]="log",e[l.VERBOSE]="log",e[l.INFO]="info",e[l.WARN]="warn",e[l.ERROR]="error",e),p=(Object.defineProperty(d.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),d.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?c[t]:t},Object.defineProperty(d.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),d.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.DEBUG],t)),this._logHandler.apply(this,u([this,l.DEBUG],t))},d.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.VERBOSE],t)),this._logHandler.apply(this,u([this,l.VERBOSE],t))},d.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.INFO],t)),this._logHandler.apply(this,u([this,l.INFO],t))},d.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.WARN],t)),this._logHandler.apply(this,u([this,l.WARN],t))},d.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.ERROR],t)),this._logHandler.apply(this,u([this,l.ERROR],t))},d);function d(t){this.name=t,this._logLevel=h,this._logHandler=a,this._userLogHandler=null}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var y,g="FirebaseError",b=(o(E,y=Error),E);function E(t,e){var n=y.call(this,e)||this;return n.code=t,n.name=g,Object.setPrototypeOf(n,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,I.prototype.create),n}var I=(T.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(_,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new b(o,a),h=0,f=Object.keys(i);h<f.length;h++){var l=f[h];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},T);function T(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var _=/\{\$([^}]+)}/g,N=function(t,e){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O={},x=D||self;function R(){}function k(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function L(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var U="closure_uid_"+(1e9*Math.random()>>>0),C=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function F(t,e,n){return(F=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:V).apply(null,arguments)}function j(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var q=Date.now;function B(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function z(){this.j=this.j,this.i=this.i}z.prototype.j=!1,z.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,U)&&t[U]||(t[U]=++C))},z.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t){return/^[\s\xa0]*$/.test(t)}var Y,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var Z=x.navigator;if(Z){var tt=Z.userAgent;if(tt){Y=tt;break t}}Y=""}function et(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<rt.length;o++)n=rt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){return ot[" "](t),t}ot[" "]=R;var st,ut,at=$(Y,"Opera"),ct=$(Y,"Trident")||$(Y,"MSIE"),ht=$(Y,"Edge"),ft=ht||ct,lt=$(Y,"Gecko")&&!($(Y.toLowerCase(),"webkit")&&!$(Y,"Edge"))&&!($(Y,"Trident")||$(Y,"MSIE"))&&!$(Y,"Edge"),pt=$(Y.toLowerCase(),"webkit")&&!$(Y,"Edge");function dt(){var t=x.document;return t?t.documentMode:void 0}t:{var vt="",yt=(ut=Y,lt?/rv:([^\);]+)(\)|;)/.exec(ut):ht?/Edge\/([\d\.]+)/.exec(ut):ct?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):pt?/WebKit\/(\S+)/.exec(ut):at?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);if(yt&&(vt=yt?yt[1]:""),ct){var gt=dt();if(null!=gt&&gt>parseFloat(vt)){st=String(gt);break t}}st=vt}var mt={};function wt(u){return t=u,e=function(){for(var t=0,e=X(String(st)).split("."),n=X(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=J(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||J(0==o[2].length,0==s[2].length)||J(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=mt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var bt=x.document&&ct?dt()||(parseInt(st,10)||void 0):void 0,Et=!ct||9<=Number(bt),It=ct&&!wt("9"),Tt=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{x.addEventListener("test",R,e),x.removeEventListener("test",R,e)}catch(t){}return t}();function _t(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Nt(t,e){if(_t.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(lt){t:{try{ot(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:At[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}_t.prototype.b=function(){this.defaultPrevented=!0},B(Nt,_t);var At={2:"touch",3:"pen",4:"mouse"};Nt.prototype.b=function(){Nt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var St="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Ot(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Dt,this.Y=this.Z=!1}function xt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Rt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(xt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Lt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Rt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Lt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Ot(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Ut={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Gt(r);return e&&e[St]?e.wa(n,r,P(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[St]?t.va(e,n,P(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!Et)return null;var u,a,c=Bt(t);if(c||(t[Pt]=c=new Rt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=Et?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ft(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[St]?kt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ft(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(kt(n,t),0==n.b&&(n.src=null,e[Pt]=null)):xt(t)))}function Ft(t){return t in Ut?Ut[t]:Ut[t]="on"+t}function jt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Vt(t),n.call(r,e)}function qt(t,e){if(t.Y)return!0;if(Et)return jt(t,new Nt(e,this));if(!e)t:{e=["window","event"];for(var n=x,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return jt(t,e=new Nt(e,this))}function Bt(t){return(t=t[Pt])instanceof Rt?t:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==k(e)?e:(e[zt]||(e[zt]=function(t){return e.handleEvent(t)}),e[zt])}function Ht(){z.call(this),this.c=new Rt(this),(this.J=this).C=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&kt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}B(Ht,z),Ht.prototype[St]=!0,(S=Ht.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=Gt(r),e&&e[St]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Lt(s=e.a[n],r,i,o))&&(xt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Bt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Lt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},S.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new _t(t,n):t instanceof _t?t.target=t.target||n:(s=t,it(t=new _t(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Wt(o,r,!0,t)&&s;if(s=Wt(o=t.a=n,r,!0,t)&&s,s=Wt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Wt(o=t.a=e[i],r,!1,t)&&s;return s},S.G=function(){if(Ht.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)xt(n[r]);delete e.a[t],e.b--}}this.C=null},S.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=x.JSON.stringify;function Qt(){this.b=this.a=null}var Yt,Xt=($t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new $t(function(){return new Jt},function(t){t.reset()},100));function $t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Jt(){this.next=this.b=this.a=null}function Zt(t,e){var n;Yt||(n=x.Promise.resolve(void 0),Yt=function(){n.then(ne)}),te||(Yt(),te=!0),ee.add(t,e)}Qt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Jt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!(Jt.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Qt;function ne(){for(var t,e,n;n=e=void 0,n=null,(e=ee).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){x.setTimeout(function(){throw t},0)}(t)}var r=Xt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}te=!1}function re(t,e){Ht.call(this),this.b=t||1,this.a=e||x,this.f=F(this.Ya,this),this.g=q()}function ie(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function oe(t,e,n){if("function"==k(t))n&&(t=F(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=F(t.handleEvent,t)}return 2147483647<Number(e)?-1:x.setTimeout(t,e||0)}B(re,Ht),(S=re.prototype).aa=!1,S.M=null,S.Ya=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(ie(this),this.start())))},S.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},S.G=function(){re.S.G.call(this),ie(this),delete this.a};var se,ue,ae,ce=(N(ue=fe,ae=se=z),ue.prototype=null===ae?Object.create(ae):(he.prototype=ae.prototype,new he),fe.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=oe(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},fe.prototype.G=function(){se.prototype.G.call(this),this.a&&(x.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},fe);function he(){this.constructor=ue}function fe(t,e,n){var r=se.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function le(t){z.call(this),this.b=t,this.a={}}B(le,z);var pe=[];function de(t,e,n,r){Array.isArray(n)||(n&&(pe[0]=n.toString()),n=pe);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ve(t){et(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function ye(){this.a=!0}function ge(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}le.prototype.G=function(){le.S.G.call(this),ve(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ye.prototype.info=function(){};var me=null;function we(){return me=me||new Ht}function be(t){_t.call(this,"serverreachability",t)}function Ee(t){var e=we();e.dispatchEvent(new be(e))}function Ie(t){_t.call(this,"statevent",t)}function Te(t){var e=we();e.dispatchEvent(new Ie(e))}function _e(t){_t.call(this,"timingevent",t)}function Ne(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){t()},e)}B(be,_t),B(Ie,_t),B(_e,_t);var Ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Se={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function De(){}function Oe(t){var e;return(e=t.a)||(e=t.a={}),e}function xe(){}De.prototype.a=null;var Re,ke={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Le(){_t.call(this,"d")}function Pe(){_t.call(this,"c")}function Ue(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new le(this),this.P=Me,t=ft?125:void 0,this.R=new re(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}B(Le,_t),B(Pe,_t),B(Ue,De),Re=new Ue;var Me=45e3,Ve={},Fe={};function je(t,e,n){t.H=1,t.i=an(en(e)),t.j=n,t.I=!0,qe(t,null)}function qe(t,e){t.u=q(),ze(t),t.l=en(t.i);var s,u,a,c,h,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),En(n.b,"t",r),t.D=0,t.a=dr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ce(F(t.Ca,t,t.a),t.O)),de(t.J,t.a,"readystatechange",t.Wa),e=t.B?nt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ee(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Be(t,e,n){for(var r,i,o,s,u=!0;!t.A&&t.D<n.length;){var a=(i=n,s=o=void 0,o=(r=t).D,-1==(s=i.indexOf("\n",o))?Fe:(o=Number(i.substring(o,s)),isNaN(o)?Ve:(s+=1)+o>i.length?Fe:(i=i.substr(s,o),r.D=s+o,i)));if(a==Fe){4==e&&(t.h=4,Te(14),u=!1),ge(t.c,t.f,null,"[Incomplete Response]");break}if(a==Ve){t.h=4,Te(15),ge(t.c,t.f,n,"[Invalid Chunk]"),u=!1;break}ge(t.c,t.f,a,null),Qe(t,a)}4==e&&0==n.length&&(t.h=1,Te(16),u=!1),t.b=t.b&&u,u?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),sr(e),e.F=!0)):(ge(t.c,t.f,n,"[Invalid Chunked Response]"),Ke(t),We(t))}function ze(t){t.U=q()+t.P,Ge(t,t.P)}function Ge(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ne(F(t.Ua,t),e)}function He(t){t.o&&(x.clearTimeout(t.o),t.o=null)}function We(t){0==t.g.v||t.A||cr(t.g,t)}function Ke(t){He(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ie(t.R),ve(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Qe(t,e){try{var n,r,i,o,s,u,a,c,h,f,l,p=t.g;if(0!=p.v&&(p.a==t||Dn(p.b,t)))if(p.I=t.N,!t.C&&Dn(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var v=d;if(0==v[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;ar(p),$n(p)}or(p),Te(18)}}else p.oa=v[1],0<p.oa-p.P&&v[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=Ne(F(p.Ra,p),6e3));if(Sn(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else fr(p,11)}else if(!t.C&&p.a!=t||ar(p),!Q(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++){v=e[d],p.P=v[0],v=v[1],2==p.v?"c"==v[0]?(p.J=v[1],p.ga=v[2],null!=(n=v[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=v[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=v[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&($(u,"spdy")||$(u,"quic")||$(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(On(a,a.b),a.b=null)),!o.A||(c=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=c,un(o.B,o.A,c))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=q()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),h=t,(o=p).la=pr(o,o.C?o.ga:null,o.fa),h.C?(xn(o.b,h),f=h,(l=o.D)&&f.setTimeout(l),f.o&&(He(f),ze(f)),o.a=h):ir(o),0<p.g.length&&tr(p)):"stop"!=v[0]&&"close"!=v[0]||fr(p,7):3==p.v&&("stop"==v[0]||"close"==v[0]?"stop"==v[0]?fr(p,7):Xn(p):"noop"!=v[0]&&p.f&&p.f.sa(v),p.o=0)}Ee(4)}catch(t){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(L(t)||"string"==typeof t)H(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(L(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(L(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Xe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function $e(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Je(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=Ce.prototype).setTimeout=function(t){this.P=t},S.Wa=function(t){t=t.target;var e=this.F;e&&3==Wn(t)?e.f():this.Ca(t)},S.Ca=function(t){try{if(t==this.a)t:{var e=Wn(this.a),n=this.a.ua(),r=this.a.X();if(!(e<3||3==e&&!ft&&!this.a.$())){this.A||4!=e||7==n||Ee(8==n||r<=0?3:2),He(this);var i=this.a.X();this.N=i;var o=this.a.$();if(this.b=200==i,c=this.c,h=this.m,f=this.l,l=this.f,p=this.T,d=e,v=i,c.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+p+"]: "+h+"\n"+f+"\n"+d+" "+v}),this.b){if(this.V&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,Te(12),Ke(this),We(this);break t}ge(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Qe(this,a)}this.I?(Be(this,e,o),ft&&this.b&&3==e&&(de(this.J,this.R,"tick",this.Va),this.R.start())):(ge(this.c,this.f,o,null),Qe(this,o)),4==e&&Ke(this),this.b&&!this.A&&(4==e?cr(this.g,this):(this.b=!1,ze(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Te(12)):(this.h=0,Te(13)),Ke(this),We(this)}}}catch(t){}var c,h,f,l,p,d,v},S.Va=function(){var t,e;this.a&&(t=Wn(this.a),e=this.a.$(),this.D<e.length&&(He(this),Be(this,t,e),this.b&&4!=t&&ze(this)))},S.cancel=function(){this.A=!0,Ke(this)},S.Ua=function(){this.o=null;var t,e,n=q();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(Ee(3),Te(17)),Ke(this),this.h=2,We(this)):Ge(this,this.U-n)},(S=Xe.prototype).K=function(){$e(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.L=function(){return $e(this),this.a.concat()},S.get=function(t,e){return Je(this.b,t)?this.b[t]:e},S.set=function(t,e){Je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tn(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof tn?(this.a=void 0!==e?e:t.a,nn(this,t.f),this.j=t.j,rn(this,t.c),on(this,t.h),this.g=t.g,e=t.b,(n=new gn).c=e.c,e.a&&(n.a=new Xe(e.a),n.b=e.b),sn(this,n),this.i=t.i):t&&(n=String(t).match(Ze))?(this.a=!!e,nn(this,n[1]||"",!0),this.j=cn(n[2]||""),rn(this,n[3]||"",!0),on(this,n[4]),this.g=cn(n[5]||"",!0),sn(this,n[6]||"",!0),this.i=cn(n[7]||"")):(this.a=!!e,this.b=new gn(null,this.a))}function en(t){return new tn(t)}function nn(t,e,n){t.f=n?cn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function rn(t,e,n){t.c=n?cn(e,!0):e}function on(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function sn(t,e,n){var r,i;e instanceof gn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(mn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(wn(this,e),En(this,n,t))},r)),r.f=i):(n||(e=hn(e,vn)),t.b=new gn(e,t.a))}function un(t,e,n){t.b.set(e,n)}function an(t){return un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,fn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}tn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,ln,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?dn:pn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",hn(n,yn)),t.join("")};var ln=/[#\/\?@]/g,pn=/[#\?:]/g,dn=/[#\?]/g,vn=/[#\?@]/g,yn=/#/g;function gn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new Xe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function wn(t,e){mn(t),e=In(t,e),Je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Je((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&$e(t)))}function bn(t,e){return mn(t),e=In(t,e),Je(t.a.b,e)}function En(t,e,n){wn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),K(n)),t.b+=n.length)}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Tn(t,e){this.b=t,this.a=e}function _n(t){this.g=t||Nn,t=x.PerformanceNavigationTiming?0<(t=x.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(x.ia&&x.ia.ya&&x.ia.ya()&&x.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(S=gn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){H(t,function(t){n.call(r,t,e,this)},this)},this)},S.L=function(){mn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.K=function(t){mn(this);var e=[];if("string"==typeof t)bn(this,t)&&(e=W(e,this.a.get(In(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},S.set=function(t,e){return mn(this),this.c=null,bn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var Nn=10;function An(t){return t.b||t.a&&t.a.size>=t.f}function Sn(t){return t.b?1:t.a?t.a.size:0}function Dn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function On(t,e){t.a?t.a.add(e):t.b=e}function xn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Rn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function kn(){}function Ln(){this.a=new kn}function Pn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}_n.prototype.cancel=function(){var e,t;if(this.c=Rn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},kn.prototype.stringify=function(t){return x.JSON.stringify(t,void 0)},kn.prototype.parse=function(t){return x.JSON.parse(t,void 0)};var Un=x.JSON.parse;function Cn(t){Ht.call(this),this.headers=new Xe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Mn,this.D=this.F=!1}B(Cn,Ht);var Mn="",Vn=/^https?$/i,Fn=["POST","PUT"];function jn(t){return"content-type"==t.toLowerCase()}function qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Bn(t),Gn(t)}function Bn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function zn(t){if(t.b&&void 0!==O&&(!t.s[1]||4!=Wn(t)||2!=t.X()))if(t.l&&4==Wn(t))oe(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Wn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Ze)[1]||null)&&x.self&&x.self.location&&(i=(r=x.self.location.protocol).substr(0,r.length-1)),n=!Vn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Wn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",Bn(t)}}finally{Gn(t)}}}function Gn(t,e){if(t.a){Hn(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Hn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(x.clearTimeout(t.m),t.m=null)}function Wn(t){return t.a?t.a.readyState:0}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",et(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):un(t,e,n))}function Qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Yn(t){this.pa=0,this.g=[],this.c=new ye,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Qn("baseRetryDelayMs",5e3,t),this.Ma=Qn("retryDelaySeedMs",1e4,t),this.Ja=Qn("forwardChannelMaxRetries",2,t),this.ma=Qn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new _n(t&&t.concurrentRequestLimit),this.ka=new Ln,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Xn(t){var e,n;Jn(t),3==t.v&&(e=t.R++,un(n=en(t.B),"SID",t.J),un(n,"RID",e),un(n,"TYPE","terminate"),nr(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=an(en(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(e.i.toString(),"")),!n&&x.Image&&((new Image).src=e.i,n=!0),n||(e.a=dr(e.g,null),e.a.ba(e.i)),e.u=q(),ze(e)),lr(t)}function $n(t){t.a&&(sr(t),t.a.cancel(),t.a=null)}function Jn(t){$n(t),t.j&&(x.clearTimeout(t.j),t.j=null),ar(t),t.b.cancel(),t.h&&("number"==typeof t.h&&x.clearTimeout(t.h),t.h=null)}function Zn(t,e){t.g.push(new Tn(t.La++,e)),3==t.v&&tr(t)}function tr(t){An(t.b)||t.h||(t.h=!0,Zt(t.Ba,t),t.u=0)}function er(t,e){var n=e?e.f:t.R++,r=en(t.B);un(r,"SID",t.J),un(r,"RID",n),un(r,"AID",t.P),nr(t,r),t.i&&t.l&&Kn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=rr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),On(t.b,n),je(n,r,e)}function nr(t,n){t.f&&Ye({},function(t,e){un(n,e,t)})}function rr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?F(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{Ye(t,function(t,e){var n=t;P(t)&&(n=Kt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function ir(t){t.a||t.j||(t.U=1,Zt(t.Aa,t),t.o=0)}function or(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=Ne(F(t.Aa,t),hr(t,t.o)),t.o++,1)}function sr(t){null!=t.s&&(x.clearTimeout(t.s),t.s=null)}function ur(t){t.a=new Ce(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=en(t.la);un(e,"RID","rpc"),un(e,"SID",t.J),un(e,"CI",t.H?"0":"1"),un(e,"AID",t.P),nr(t,e),un(e,"TYPE","xmlhttp"),t.i&&t.l&&Kn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=an(en(e)),n.j=null,n.I=!0,qe(n,t)}function ar(t){null!=t.m&&(x.clearTimeout(t.m),t.m=null)}function cr(t,e){var n,r=null;if(t.a==e){ar(t),sr(t),t.a=null;var i=2}else{if(!Dn(t.b,e))return;r=e.s,xn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=q()-e.u,n=t.u,(i=we()).dispatchEvent(new _e(i)),tr(t)):ir(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(Sn(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=Ne(F(t.Ba,t,e),hr(t,t.u)),t.u++,1}}(t,e)||2==i&&or(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:fr(t,5);break;case 4:fr(t,10);break;case 3:fr(t,6);break;default:fr(t,2)}}function hr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function fr(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=F(t.Xa,t),n||(n=new tn("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||nn(n,"https"),an(n)),i=n.toString(),o=r,u=new ye,x.Image?((s=new Image).onload=j(Pn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=j(Pn,u,s,"TestLoadImage: error",!1,o),s.onabort=j(Pn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=j(Pn,u,s,"TestLoadImage: timeout",!1,o),x.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):Te(2),t.v=0,t.f&&t.f.ra(e),lr(t),Jn(t)}function lr(t){t.v=0,t.I=-1,t.f&&(0==Rn(t.b).length&&0==t.g.length||(t.b.c.length=0,K(t.g),t.g.length=0),t.f.qa())}function pr(t,e,n){var r,i,o,s,u,a,c,h=(r=n)instanceof tn?en(r):new tn(r,void 0);return""!=h.c?(e&&rn(h,e+"."+h.c),on(h,h.h)):(i=x.location,o=i.protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,c=new tn(null,void 0),o&&nn(c,o),s&&rn(c,s),u&&on(c,u),a&&(c.g=a),h=c),t.W&&et(t.W,function(t,e){un(h,e,t)}),e=t.A,n=t.na,e&&n&&un(h,e,n),un(h,"VER",t.ha),nr(t,h),h}function dr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Cn(t.Ka)).F=t.C,e}function vr(){}function yr(){if(ct&&!(10<=Number(bt)))throw Error("Environmental error: no available transport.")}function gr(t,e){Ht.call(this),this.a=new Yn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!Q(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new br(this)}function mr(t){Le.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function wr(){Pe.call(this),this.status=1}function br(t){this.a=t}(S=Cn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Oe(this.H):Oe(Re),this.a.onreadystatechange=F(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void qn(this,t)}t=n||"";var i,o=new Xe(this.headers);r&&Ye(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=jn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=x.FormData&&t instanceof x.FormData,0<=G(Fn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Hn(this),0<this.o&&((this.D=(i=this.a,ct&&wt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=F(this.xa,this)):this.m=oe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){qn(this,t)}},S.xa=function(){void 0!==O&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Gn(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Gn(this,!0)),Cn.S.G.call(this)},S.za=function(){this.j||(this.A||this.l||this.g?zn(this):this.Ta())},S.Ta=function(){zn(this)},S.X=function(){try{return 2<Wn(this)?this.a.status:-1}catch(t){return-1}},S.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},S.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Un(e)}},S.ua=function(){return this.h},S.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(S=Yn.prototype).ha=8,S.v=1,S.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?it(r=nt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=rr(this,n,e),un(i=en(this.B),"RID",t),un(i,"CVER",22),this.A&&un(i,"X-HTTP-Session-Id",this.A),nr(this,i),this.i&&r&&Kn(i,this.i,r),On(this.b,n),this.Ga&&un(i,"TYPE","init"),this.da?(un(i,"$req",e),un(i,"SID","null"),n.V=!0,je(n,i,null)):je(n,i,e),this.v=2}}else 3==this.v&&(t?er(this,t):0==this.g.length||An(this.b)||er(this))},S.Aa=function(){var t;this.j=null,ur(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ne(F(this.Sa,this),t))},S.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,$n(this),ur(this))},S.Ra=function(){null!=this.m&&(this.m=null,$n(this),or(this),Te(19))},S.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),Te(2)):(this.c.info("Failed to ping google.com"),Te(1))},(S=vr.prototype).ta=function(){},S.sa=function(){},S.ra=function(){},S.qa=function(){},S.Ha=function(){},yr.prototype.a=function(t,e){return new gr(t,e)},B(gr,Ht),(S=gr.prototype).addEventListener=function(t,e,n,r){gr.S.addEventListener.call(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){gr.S.removeEventListener.call(this,t,e,n,r)},S.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;Te(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=pr(t,null,t.fa),tr(t)},S.close=function(){Xn(this.a)},S.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,Zn(this.a,e)):this.g?((e={}).__data__=Kt(t),Zn(this.a,e)):Zn(this.a,t)},S.G=function(){this.a.f=null,delete this.f,Xn(this.a),delete this.a,gr.S.G.call(this)},B(mr,Le),B(wr,Pe),B(br,vr),br.prototype.ta=function(){this.a.dispatchEvent("a")},br.prototype.sa=function(t){this.a.dispatchEvent(new mr(t))},br.prototype.ra=function(t){this.a.dispatchEvent(new wr)},br.prototype.qa=function(){this.a.dispatchEvent("b")},yr.prototype.createWebChannel=yr.prototype.a,gr.prototype.send=gr.prototype.Pa,gr.prototype.open=gr.prototype.Oa,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,Se.COMPLETE="complete",(xe.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",Ht.prototype.listen=Ht.prototype.va,Cn.prototype.listenOnce=Cn.prototype.wa,Cn.prototype.getLastError=Cn.prototype.Qa,Cn.prototype.getLastErrorCode=Cn.prototype.ua,Cn.prototype.getStatus=Cn.prototype.X,Cn.prototype.getResponseJson=Cn.prototype.Na,Cn.prototype.getResponseText=Cn.prototype.$,Cn.prototype.send=Cn.prototype.ba;var Er={createWebChannelTransport:function(){return new yr},ErrorCode:Ae,EventType:Se,WebChannel:xe,XhrIo:Cn},Ir=Er.createWebChannelTransport,Tr=Er.ErrorCode,_r=Er.EventType,Nr=Er.WebChannel,Ar=Er.XhrIo,Sr=(Dr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Dr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Dr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Dr);function Dr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Or,xr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Rr=(o(Pr,Or=Error),Pr),kr="7.21.0-2020815231418",Lr=new p("@firebase/firestore");function Pr(t,e){var n=this;return(n=Or.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Ur(){return Lr.logLevel}function Cr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Lr.logLevel<=l.DEBUG&&(e=n.map(Fr),Lr.debug.apply(Lr,s(["Firestore ("+kr+"): "+t],e)))}function Mr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Lr.logLevel<=l.ERROR&&(e=n.map(Fr),Lr.error.apply(Lr,s(["Firestore ("+kr+"): "+t],e)))}function Vr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Lr.logLevel<=l.WARN&&(e=n.map(Fr),Lr.warn.apply(Lr,s(["Firestore ("+kr+"): "+t],e)))}function Fr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function jr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+kr+") INTERNAL ASSERTION FAILED: "+t;throw Mr(e),new Error(e)}function qr(t){t||jr()}function Br(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Hr,Wr,Kr=(Object.defineProperty(ei.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),ei.prototype.isEqual=function(t){return 0===ei.i(this,t)},ei.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ei?t.forEach(function(t){e.push(t)}):e.push(t),this.o(e)},ei.prototype.limit=function(){return this.offset+this.length},ei.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},ei.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},ei.prototype.l=function(){return this.segments[this.offset]},ei.prototype._=function(){return this.get(this.length-1)},ei.prototype.get=function(t){return this.segments[this.offset+t]},ei.prototype.m=function(){return 0===this.length},ei.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ei.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ei.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ei.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},ei.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ei),Qr=(o(ti,Wr=Kr),ti.prototype.o=function(t,e,n){return new ti(t,e,n)},ti.prototype.R=function(){return this.A().join("/")},ti.prototype.toString=function(){return this.R()},ti.P=function(t){if(0<=t.indexOf("//"))throw new Rr(xr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ti(t.split("/").filter(function(t){return 0<t.length}))},ti.g=function(){return new ti([])},ti),Yr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Xr=(o(Zr,Hr=Kr),Zr.prototype.o=function(t,e,n){return new Zr(t,e,n)},Zr.V=function(t){return Yr.test(t)},Zr.prototype.R=function(){return this.A().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Zr.V(t)||(t="`"+t+"`"),t}).join(".")},Zr.prototype.toString=function(){return this.R()},Zr.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},Zr.v=function(){return new Zr(["__name__"])},Zr.S=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Rr(xr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Rr(xr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Rr(xr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Rr(xr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Zr(e)},Zr.g=function(){return new Zr([])},Zr),$r=(Jr.D=function(t){return new Jr(Qr.P(t))},Jr.C=function(t){return new Jr(Qr.P(t).u(5))},Jr.prototype.N=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Jr.prototype.isEqual=function(t){return null!==t&&0===Qr.i(this.path,t.path)},Jr.prototype.toString=function(){return this.path.toString()},Jr.i=function(t,e){return Qr.i(t.path,e.path)},Jr.F=function(t){return t.length%2==0},Jr.$=function(t){return new Jr(new Qr(t.slice()))},Jr);function Jr(t){this.path=t}function Zr(){return null!==Hr&&Hr.apply(this,arguments)||this}function ti(){return null!==Wr&&Wr.apply(this,arguments)||this}function ei(t,e,n){void 0===e?e=0:e>t.length&&jr(),void 0===n?n=t.length-e:n>t.length-e&&jr(),this.segments=t,this.offset=e,this.t=n}function ni(t,e){if(0!==e.length)throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+bi(e.length,"argument")+".")}function ri(t,e,n){if(e.length!==n)throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires "+bi(n,"argument")+", but was called with "+bi(e.length,"argument")+".")}function ii(t,e,n){if(e.length<n)throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+bi(n,"argument")+", but was called with "+bi(e.length,"argument")+".")}function oi(t,e,n,r){if(e.length<n||e.length>r)throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+bi(e.length,"argument")+".")}function si(t,e,n,r){li(t,e,wi(n)+" argument",r)}function ui(t,e,n,r){void 0!==r&&si(t,e,n,r)}function ai(t,e,n,r){li(t,e,n+" option",r)}function ci(t,e,n,r){void 0!==r&&ai(t,e,n,r)}function hi(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(di(s))}var u=di(n);throw new Rr(xr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function fi(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Rr(xr.INVALID_ARGUMENT,"Invalid value "+di(r)+" provided to function "+t+"() for its "+wi(n)+" argument. Acceptable values: "+e.join(", "));return r}function li(t,e,n,r){if(!("object"===e?pi(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=di(r);throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function pi(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function di(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":jr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function vi(t,e,n){if(void 0===n)throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+wi(e)+" argument, but it was undefined.")}function yi(n,t,r){zr(t,function(t,e){if(r.indexOf(t)<0)throw new Rr(xr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function gi(t,e,n,r){var i=di(r);return new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+wi(n)+" argument to be a "+e+", but it was: "+i)}function mi(t,e,n){if(n<=0)throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+wi(e)+" argument to be a positive number, but it was: "+n+".")}function wi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function bi(t,e){return t+" "+e+(1===t?"":"s")}var Ei=(Ii.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ii);function Ii(){}function Ti(t,e){return t<e?-1:e<t?1:0}function _i(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Ni(t){return t+"\0"}var Ai=(Si.fromBase64String=function(t){return new Si(atob(t))},Si.fromUint8Array=function(t){return new Si(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Si.prototype.toBase64=function(){return t=this.M,btoa(t);var t},Si.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},Si.prototype.O=function(){return 2*this.M.length},Si.prototype.L=function(t){return Ti(this.M,t.M)},Si.prototype.isEqual=function(t){return this.M===t.M},Si);function Si(t){this.M=t}Ai.B=new Ai("");var Di=(Oi.fromBase64String=function(t){try{return new Oi(Ai.fromBase64String(t))}catch(t){throw new Rr(xr.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Oi.fromUint8Array=function(t){return new Oi(Ai.fromUint8Array(t))},Oi.prototype.toBase64=function(){return this.q.toBase64()},Oi.prototype.toUint8Array=function(){return this.q.toUint8Array()},Oi.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Oi.prototype.isEqual=function(t){return this.q.isEqual(t.q)},Oi);function Oi(t){this.q=t}function xi(){if("undefined"==typeof Uint8Array)throw new Rr(xr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ri(){if("undefined"==typeof atob)throw new Rr(xr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function ki(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Li,Pi=(o(zi,Li=Di),zi.fromBase64String=function(t){ri("Blob.fromBase64String",arguments,1),si("Blob.fromBase64String","string",1,t),Ri();try{return new zi(Ai.fromBase64String(t))}catch(t){throw new Rr(xr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},zi.fromUint8Array=function(t){if(ri("Blob.fromUint8Array",arguments,1),xi(),!(t instanceof Uint8Array))throw gi("Blob.fromUint8Array","Uint8Array",1,t);return new zi(Ai.fromUint8Array(t))},zi.prototype.toBase64=function(){return ri("Blob.toBase64",arguments,0),Ri(),Li.prototype.toBase64.call(this)},zi.prototype.toUint8Array=function(){return ri("Blob.toUint8Array",arguments,0),xi(),Li.prototype.toUint8Array.call(this)},zi.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},zi),Ui=(Object.defineProperty(Bi.prototype,"W",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Bi.prototype.isEqual=function(t){return t instanceof Bi&&t.projectId===this.projectId&&t.database===this.database},Bi.prototype.L=function(t){return Ti(this.projectId,t.projectId)||Ti(this.database,t.database)},Bi),Ci=(qi.prototype.get=function(t){var e=this.j(t),n=this.G[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.K(s,t))return u}},qi.prototype.has=function(t){return void 0!==this.get(t)},qi.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},qi.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},qi.prototype.forEach=function(u){zr(this.G,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},qi.prototype.m=function(){return Gr(this.G)},qi),Mi=(ji.now=function(){return ji.fromMillis(Date.now())},ji.fromDate=function(t){return ji.fromMillis(t.getTime())},ji.fromMillis=function(t){var e=Math.floor(t/1e3);return new ji(e,1e6*(t-1e3*e))},ji.prototype.toDate=function(){return new Date(this.toMillis())},ji.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ji.prototype.H=function(t){return this.seconds===t.seconds?Ti(this.nanoseconds,t.nanoseconds):Ti(this.seconds,t.seconds)},ji.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ji.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ji.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ji.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ji),Vi=(Fi.Y=function(t){return new Fi(t)},Fi.min=function(){return new Fi(new Mi(0,0))},Fi.prototype.L=function(t){return this.timestamp.H(t.timestamp)},Fi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Fi.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Fi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Fi.prototype.X=function(){return this.timestamp},Fi);function Fi(t){this.timestamp=t}function ji(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Rr(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Rr(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rr(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Rr(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function qi(t,e){this.j=t,this.K=e,this.G={}}function Bi(t,e){this.projectId=t,this.database=e||"(default)"}function zi(){return null!==Li&&Li.apply(this,arguments)||this}function Gi(t){return null==t}function Hi(t){return-0===t&&1/t==-1/0}function Wi(t){return"number"==typeof t&&Number.isInteger(t)&&!Hi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ki=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function Qi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ki(t,e,n,r,i,o,s)}function Yi(t){var e,n=t;return null===n.Z&&(e=n.path.R(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.R()+e.op.toString()+Xo(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.R()+e.dir;var e}).join(","),Gi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=xa(n.startAt)),n.endAt&&(e+="|ub:",e+=xa(n.endAt)),n.Z=e),n.Z}function Xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!Wo(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ka(t.startAt,e.startAt)&&ka(t.endAt,e.endAt)}function $i(t){return $r.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Ji(t){this.count=t}var Zi,to,eo=(no.prototype.nt=function(t){return new no(this.target,this.targetId,this.tt,t,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},no.prototype.st=function(t,e){return new no(this.target,this.targetId,this.tt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},no.prototype.it=function(t){return new no(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,t,this.resumeToken)},no);function no(t,e,n,r,i,o,s){void 0===i&&(i=Vi.min()),void 0===o&&(o=Vi.min()),void 0===s&&(s=Ai.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function ro(t){switch(t){case xr.OK:return jr(),0;case xr.CANCELLED:case xr.UNKNOWN:case xr.DEADLINE_EXCEEDED:case xr.RESOURCE_EXHAUSTED:case xr.INTERNAL:case xr.UNAVAILABLE:case xr.UNAUTHENTICATED:return;case xr.INVALID_ARGUMENT:case xr.NOT_FOUND:case xr.ALREADY_EXISTS:case xr.PERMISSION_DENIED:case xr.FAILED_PRECONDITION:case xr.ABORTED:case xr.OUT_OF_RANGE:case xr.UNIMPLEMENTED:case xr.DATA_LOSS:return 1;default:return jr(),0}}function io(t){if(void 0===t)return Mr("GRPC error has no .code"),xr.UNKNOWN;switch(t){case Zi.OK:return xr.OK;case Zi.CANCELLED:return xr.CANCELLED;case Zi.UNKNOWN:return xr.UNKNOWN;case Zi.DEADLINE_EXCEEDED:return xr.DEADLINE_EXCEEDED;case Zi.RESOURCE_EXHAUSTED:return xr.RESOURCE_EXHAUSTED;case Zi.INTERNAL:return xr.INTERNAL;case Zi.UNAVAILABLE:return xr.UNAVAILABLE;case Zi.UNAUTHENTICATED:return xr.UNAUTHENTICATED;case Zi.INVALID_ARGUMENT:return xr.INVALID_ARGUMENT;case Zi.NOT_FOUND:return xr.NOT_FOUND;case Zi.ALREADY_EXISTS:return xr.ALREADY_EXISTS;case Zi.PERMISSION_DENIED:return xr.PERMISSION_DENIED;case Zi.FAILED_PRECONDITION:return xr.FAILED_PRECONDITION;case Zi.ABORTED:return xr.ABORTED;case Zi.OUT_OF_RANGE:return xr.OUT_OF_RANGE;case Zi.UNIMPLEMENTED:return xr.UNIMPLEMENTED;case Zi.DATA_LOSS:return xr.DATA_LOSS;default:return jr()}}(to=Zi=Zi||{})[to.OK=0]="OK",to[to.CANCELLED=1]="CANCELLED",to[to.UNKNOWN=2]="UNKNOWN",to[to.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",to[to.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",to[to.NOT_FOUND=5]="NOT_FOUND",to[to.ALREADY_EXISTS=6]="ALREADY_EXISTS",to[to.PERMISSION_DENIED=7]="PERMISSION_DENIED",to[to.UNAUTHENTICATED=16]="UNAUTHENTICATED",to[to.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",to[to.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",to[to.ABORTED=10]="ABORTED",to[to.OUT_OF_RANGE=11]="OUT_OF_RANGE",to[to.UNIMPLEMENTED=12]="UNIMPLEMENTED",to[to.INTERNAL=13]="INTERNAL",to[to.UNAVAILABLE=14]="UNAVAILABLE",to[to.DATA_LOSS=15]="DATA_LOSS";var oo=(ho.prototype.rt=function(t,e){return new ho(this.i,this.root.rt(t,e,this.i).copy(null,null,uo.ot,null,null))},ho.prototype.remove=function(t){return new ho(this.i,this.root.remove(t,this.i).copy(null,null,uo.ot,null,null))},ho.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ho.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ho.prototype.m=function(){return this.root.m()},Object.defineProperty(ho.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),ho.prototype.at=function(){return this.root.at()},ho.prototype.ct=function(){return this.root.ct()},ho.prototype.ut=function(t){return this.root.ut(t)},ho.prototype.forEach=function(n){this.ut(function(t,e){return n(t,e),!1})},ho.prototype.toString=function(){var n=[];return this.ut(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ho.prototype.ht=function(t){return this.root.ht(t)},ho.prototype.lt=function(){return new so(this.root,null,this.i,!1)},ho.prototype._t=function(t){return new so(this.root,t,this.i,!1)},ho.prototype.ft=function(){return new so(this.root,null,this.i,!0)},ho.prototype.dt=function(t){return new so(this.root,t,this.i,!0)},ho),so=(co.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},co.prototype.It=function(){return 0<this.Tt.length},co.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},co),uo=(ao.prototype.copy=function(t,e,n,r,i){return new ao(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},ao.prototype.m=function(){return!1},ao.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},ao.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},ao.prototype.min=function(){return this.left.m()?this:this.left.min()},ao.prototype.at=function(){return this.min().key},ao.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},ao.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},ao.prototype.Pt=function(){if(this.left.m())return ao.EMPTY;var t=this;return t.left.gt()||t.left.left.gt()||(t=t.yt()),(t=t.copy(null,null,null,t.left.Pt(),null)).Rt()},ao.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.m()||r.left.gt()||r.left.left.gt()||(r=r.yt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.gt()&&(r=r.Vt()),r.right.m()||r.right.gt()||r.right.left.gt()||(r=r.bt()),0===e(t,r.key)){if(r.right.m())return ao.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Pt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Rt()},ao.prototype.gt=function(){return this.color},ao.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},ao.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},ao.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},ao.prototype.vt=function(){var t=this.copy(null,null,ao.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},ao.prototype.Vt=function(){var t=this.copy(null,null,ao.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},ao.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},ao.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},ao.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw jr();if(this.right.gt())throw jr();var t=this.left.Ct();if(t!==this.right.Ct())throw jr();return t+(this.gt()?0:1)},ao);function ao(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ao.RED,this.left=null!=r?r:ao.EMPTY,this.right=null!=i?i:ao.EMPTY,this.size=this.left.size+1+this.right.size}function co(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}function ho(t,e){this.i=t,this.root=e||uo.EMPTY}function fo(){this.size=0}uo.EMPTY=null,uo.RED=!0,uo.ot=!1,uo.EMPTY=(Object.defineProperty(fo.prototype,"key",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(fo.prototype,"value",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(fo.prototype,"color",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(fo.prototype,"left",{get:function(){throw jr()},enumerable:!1,configurable:!0}),Object.defineProperty(fo.prototype,"right",{get:function(){throw jr()},enumerable:!1,configurable:!0}),fo.prototype.copy=function(t,e,n,r,i){return this},fo.prototype.rt=function(t,e,n){return new uo(t,e)},fo.prototype.remove=function(t,e){return this},fo.prototype.m=function(){return!0},fo.prototype.ut=function(t){return!1},fo.prototype.ht=function(t){return!1},fo.prototype.at=function(){return null},fo.prototype.ct=function(){return null},fo.prototype.gt=function(){return!1},fo.prototype.Dt=function(){return!0},fo.prototype.Ct=function(){return 0},new fo);var lo=(go.prototype.has=function(t){return null!==this.data.get(t)},go.prototype.first=function(){return this.data.at()},go.prototype.last=function(){return this.data.ct()},Object.defineProperty(go.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),go.prototype.indexOf=function(t){return this.data.indexOf(t)},go.prototype.forEach=function(n){this.data.ut(function(t,e){return n(t),!1})},go.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(0<=this.i(r.key,t[1]))return;e(r.key)}},go.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},go.prototype.$t=function(t){var e=this.data._t(t);return e.It()?e.Et().key:null},go.prototype.lt=function(){return new po(this.data.lt())},go.prototype._t=function(t){return new po(this.data._t(t))},go.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},go.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},go.prototype.m=function(){return this.data.m()},go.prototype.xt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},go.prototype.isEqual=function(t){if(!(t instanceof go))return!1;if(this.size!==t.size)return!1;for(var e=this.data.lt(),n=t.data.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(0!==this.i(r,i))return!1}return!0},go.prototype.A=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},go.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},go.prototype.copy=function(t){var e=new go(this.i);return e.data=t,e},go),po=(yo.prototype.Et=function(){return this.kt.Et().key},yo.prototype.It=function(){return this.kt.It()},yo),vo=new oo($r.i);function yo(t){this.kt=t}function go(t){this.i=t,this.data=new oo(this.i)}var mo=new oo($r.i);var wo=new oo($r.i),bo=new lo($r.i);function Eo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=bo,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Io=new lo(Ti);var To=(Fo.Lt=function(t){return new Fo(t.i)},Fo.prototype.has=function(t){return null!=this.Mt.get(t)},Fo.prototype.get=function(t){return this.Mt.get(t)},Fo.prototype.first=function(){return this.Ot.at()},Fo.prototype.last=function(){return this.Ot.ct()},Fo.prototype.m=function(){return this.Ot.m()},Fo.prototype.indexOf=function(t){var e=this.Mt.get(t);return e?this.Ot.indexOf(e):-1},Object.defineProperty(Fo.prototype,"size",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),Fo.prototype.forEach=function(n){this.Ot.ut(function(t,e){return n(t),!1})},Fo.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},Fo.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},Fo.prototype.isEqual=function(t){if(!(t instanceof Fo))return!1;if(this.size!==t.size)return!1;for(var e=this.Ot.lt(),n=t.Ot.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(!r.isEqual(i))return!1}return!0},Fo.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Fo.prototype.copy=function(t,e){var n=new Fo;return n.i=this.i,n.Mt=t,n.Ot=e,n},Fo),_o=(Vo.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);!n||0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):jr()},Vo.prototype.qt=function(){var n=[];return this.Bt.ut(function(t,e){n.push(e)}),n},Vo),No=(Mo.Kt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Mo(t,e,To.Lt(e),i,n,r,!0,!1)},Object.defineProperty(Mo.prototype,"hasPendingWrites",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),Mo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Zu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Mo),Ao=(Co.Jt=function(t,e){var n=new Map;return n.set(t,So.Xt(t,e)),new Co(Vi.min(),n,Io,vo,Eo())},Co),So=(Uo.Xt=function(t,e){return new Uo(Ai.B,e,Eo(),Eo(),Eo())},Uo),Do=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},Oo=function(t,e){this.targetId=t,this.re=e},xo=function(t,e,n,r){void 0===n&&(n=Ai.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ro=(Object.defineProperty(Po.prototype,"Zt",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(Po.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(Po.prototype,"le",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(Po.prototype,"_e",{get:function(){return this.he},enumerable:!1,configurable:!0}),Po.prototype.fe=function(t){0<t.O()&&(this.he=!0,this.ce=t)},Po.prototype.de=function(){var n=Eo(),r=Eo(),i=Eo();return this.ae.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:jr()}}),new So(this.ce,this.ue,n,r,i)},Po.prototype.we=function(){this.he=!1,this.ae=qo()},Po.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},Po.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},Po.prototype.Ee=function(){this.oe+=1},Po.prototype.Ie=function(){--this.oe},Po.prototype.Ae=function(){this.he=!0,this.ue=!0},Po),ko=(Lo.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof Pu?this.be(r,t.ie):t.ie instanceof Uu&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},Lo.prototype.Se=function(n){var r=this;this.De(n,function(t){var e=r.Ce(t);switch(n.state){case 0:r.Ne(t)&&e.fe(n.resumeToken);break;case 1:e.Ie(),e.le||e.we(),e.fe(n.resumeToken);break;case 2:e.Ie(),e.le||r.removeTarget(t);break;case 3:r.Ne(t)&&(e.Ae(),e.fe(n.resumeToken));break;case 4:r.Ne(t)&&(r.Fe(t),e.fe(n.resumeToken));break;default:jr()}})},Lo.prototype.De=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Pe.forEach(function(t,e){r.Ne(e)&&n(e)})},Lo.prototype.$e=function(t){var e,n,r=t.targetId,i=t.re.count,o=this.xe(r);o&&($i(e=o.target)?0===i?(n=new $r(e.path),this.ve(r,n,new Uu(n,Vi.min()))):qr(1===i):this.ke(r)!==i&&(this.Fe(r),this.Ve=this.Ve.add(r)))},Lo.prototype.Me=function(i){var o=this,s=new Map;this.Pe.forEach(function(t,e){var n,r=o.xe(e);r&&(t.Zt&&$i(r.target)&&(n=new $r(r.target.path),null!==o.ge.get(n)||o.Oe(e,n)||o.ve(e,n,new Uu(n,i))),t._e&&(s.set(e,t.de()),t.we()))});var r=Eo();this.ye.forEach(function(t,e){var n=!0;e.Ft(function(t){var e=o.xe(t);return!e||2===e.tt||(n=!1)}),n&&(r=r.add(t))});var t=new Ao(i,s,this.Ve,this.ge,r);return this.ge=vo,this.ye=jo(),this.Ve=new lo(Ti),t},Lo.prototype.be=function(t,e){var n;this.Ne(t)&&(n=this.Oe(t,e.key)?2:0,this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t)))},Lo.prototype.ve=function(t,e,n){var r;this.Ne(t)&&(r=this.Ce(t),this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n)))},Lo.prototype.removeTarget=function(t){this.Pe.delete(t)},Lo.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},Lo.prototype.Ee=function(t){this.Ce(t).Ee()},Lo.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new Ro,this.Pe.set(t,e)),e},Lo.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new lo(Ti),this.ye=this.ye.rt(t,e)),e},Lo.prototype.Ne=function(t){var e=null!==this.xe(t);return e||Cr("WatchChangeAggregator","Detected inactive target",t),e},Lo.prototype.xe=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},Lo.prototype.Fe=function(e){var n=this;this.Pe.set(e,new Ro),this.Re.Be(e).forEach(function(t){n.ve(e,t,null)})},Lo.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},Lo);function Lo(t){this.Re=t,this.Pe=new Map,this.ge=vo,this.ye=jo(),this.Ve=new lo(Ti)}function Po(){this.oe=0,this.ae=qo(),this.ce=Ai.B,this.ue=!1,this.he=!0}function Uo(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}function Co(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}function Mo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function Vo(){this.Bt=new oo($r.i)}function Fo(n){this.i=n?function(t,e){return n(t,e)||$r.i(t.key,e.key)}:function(t,e){return $r.i(t.key,e.key)},this.Mt=mo,this.Ot=new oo(this.i)}function jo(){return new oo($r.i)}function qo(){return new oo($r.i)}function Bo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function zo(t){var e=$o(t.mapValue.fields.__local_write_time__.timestampValue);return new Mi(e.seconds,e.nanos)}var Go=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ho(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Bo(t)?4:10:jr()}function Wo(r,i){var t,e,n,o=Ho(r);if(o!==Ho(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return zo(r).isEqual(zo(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=$o(r.timestampValue),n=$o(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,Zo(r.bytesValue).isEqual(Zo(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Jo((t=r).geoPointValue.latitude)===Jo(e.geoPointValue.latitude)&&Jo(t.geoPointValue.longitude)===Jo(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Jo(t.integerValue)===Jo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Jo(t.doubleValue),r=Jo(e.doubleValue);return n===r?Hi(n)===Hi(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return _i(r.arrayValue.values||[],i.arrayValue.values||[],Wo);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Br(e)!==Br(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Wo(e[t],n[t])))return!1;return!0}();default:return jr()}}function Ko(t,e){return void 0!==(t.values||[]).find(function(t){return Wo(t,e)})}function Qo(t,e){var n,r,i,o,s,u,a,c,h,f,l=Ho(t),p=Ho(e);if(l!==p)return Ti(l,p);switch(l){case 0:return 0;case 1:return Ti(t.booleanValue,e.booleanValue);case 2:return c=e,h=Jo(t.integerValue||t.doubleValue),f=Jo(c.integerValue||c.doubleValue),h<f?-1:f<h?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1;case 3:return Yo(t.timestampValue,e.timestampValue);case 4:return Yo(zo(t),zo(e));case 5:return Ti(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=Zo(o),a=Zo(s),u.L(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ti(n[i],r[i]);if(0!==o)return o}return Ti(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Ti(Jo(n.latitude),Jo(r.latitude)))?i:Ti(Jo(n.longitude),Jo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Qo(n[i],r[i]);if(o)return o}return Ti(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Ti(r[s],o[s]);if(0!==u)return u;var a=Qo(n[r[s]],i[o[s]]);if(0!==a)return a}return Ti(r.length,o.length)}(t.mapValue,e.mapValue);default:throw jr()}}function Yo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ti(t,e);var n=$o(t),r=$o(e),i=Ti(n.seconds,r.seconds);return 0!==i?i:Ti(n.nanos,r.nanos)}function Xo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=$o(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?Zo(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,$r.C(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):jr();var t,e,n}(t)}function $o(t){if(qr(!!t),"string"!=typeof t)return{seconds:Jo(t.seconds),nanos:Jo(t.nanos)};var e,n=0,r=Go.exec(t);qr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function Jo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Zo(t){return"string"==typeof t?Ai.fromBase64String(t):Ai.fromUint8Array(t)}function ts(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function es(t){return t&&"integerValue"in t}function ns(t){return!!t&&"arrayValue"in t}function rs(t){return t&&"nullValue"in t}function is(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function os(t){return t&&"mapValue"in t}var ss={asc:"ASCENDING",desc:"DESCENDING"},us={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},as=function(t,e){this.U=t,this.Ue=e};function cs(t){return{integerValue:""+t}}function hs(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Hi(e)?"-0":e}}function fs(t,e){return Wi(e)?cs(e):hs(t,e)}function ls(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ps(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function ds(t){return qr(!!t),Vi.Y((e=$o(t),new Mi(e.seconds,e.nanos)));var e}function vs(t,e){return new Qr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).R()}function ys(t){var e=Qr.P(t);return qr(ks(e)),e}function gs(t,e){return vs(t.U,e.path)}function ms(t,e){var n=ys(e);return qr(n.get(1)===t.U.projectId),qr(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new $r(Is(n))}function ws(t,e){return vs(t.U,e)}function bs(t){var e=ys(t);return 4===e.length?Qr.g():Is(e)}function Es(t){return new Qr(["projects",t.U.projectId,"databases",t.U.database]).R()}function Is(t){return qr(4<t.length&&"documents"===t.get(4)),t.u(5)}function Ts(t,e,n){return{name:gs(t,e),fields:n.proto.mapValue.fields}}function _s(t,e){var n,r,i,o,s,u;if(e instanceof fu)n={update:Ts(t,e.key,e.value)};else if(e instanceof Iu)n={delete:gs(t,e.key)};else if(e instanceof lu)n={update:Ts(t,e.key,e.data),updateMask:(r=e.Qe,i=[],r.fields.forEach(function(t){return i.push(t.R())}),{fieldPaths:i})};else if(e instanceof gu)n={transform:{document:gs(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ms)return{fieldPath:t.field.R(),setToServerValue:"REQUEST_TIME"};if(e instanceof Vs)return{fieldPath:t.field.R(),appendMissingElements:{values:e.elements}};if(e instanceof zs)return{fieldPath:t.field.R(),removeAllFromArray:{values:e.elements}};if(e instanceof Ks)return{fieldPath:t.field.R(),increment:e.We};throw jr()})}};else{if(!(e instanceof Tu))return jr();n={verify:gs(t,e.key)}}return e.Ke.je||(n.currentDocument=void 0!==(o=e.Ke).updateTime?{updateTime:(s=t,u=o.updateTime,ls(s,u.X()))}:void 0!==o.exists?{exists:o.exists}:jr()),n}function Ns(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?eu.updateTime(ds(n.updateTime)):void 0!==n.exists?eu.exists(n.exists):eu.Ge():eu.Ge();if(t.update){t.update.name;var o=ms(e,t.update.name),s=new _u({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new $s(r.map(function(t){return Xr.S(t)})));return new lu(o,s,u,i)}return new fu(o,s,i)}if(t.delete){var a=ms(e,t.delete);return new Iu(a,i)}if(t.transform){var c=ms(e,t.transform.document),h=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(qr("REQUEST_TIME"===e.setToServerValue),i=new Ms):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new Vs(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new zs(r)):"increment"in e?i=new Ks(t,e.increment):jr();var o=Xr.S(e.fieldPath);return new Js(o,i)}(e,t)});return qr(!0===i.exists),new gu(c,h)}if(t.verify){var f=ms(e,t.verify);return new Tu(f,i)}return jr()}function As(t,e){return{documents:[ws(t,e.path)]}}function Ss(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ws(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ws(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){if("=="===t.op){if(is(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NAN"}};if(rs(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(is(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NAN"}};if(rs(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xs(t.field),op:(e=t.op,us[e]),value:t.value}};var e});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:xs((e=t).field),direction:(n=e.dir,ss[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Ue||Gi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Ds(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ds(e.endAt)),n}function Ds(t){return{before:t.before,values:t.position}}function Os(t){var e=!!t.before,n=t.values||[];return new Na(n,e)}function xs(t){return{fieldPath:t.R()}}function Rs(t){return Xr.S(t.fieldPath)}function ks(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ls(){this.ze=void 0}function Ps(t,e){return t instanceof Ks?es(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Us,Cs,Ms=(o(js,Cs=Ls),js),Vs=(o(Fs,Us=Ls),Fs);function Fs(t){var e=this;return(e=Us.call(this)||this).elements=t,e}function js(){return null!==Cs&&Cs.apply(this,arguments)||this}function qs(t,e){for(var n=Xs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return Wo(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Bs,zs=(o(Gs,Bs=Ls),Gs);function Gs(t){var e=this;return(e=Bs.call(this)||this).elements=t,e}function Hs(t,e){for(var n=Xs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!Wo(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Ws,Ks=(o(Qs,Ws=Ls),Qs);function Qs(t,e){var n=this;return(n=Ws.call(this)||this).serializer=t,n.We=e,n}function Ys(t){return Jo(t.integerValue||t.doubleValue)}function Xs(t){return ns(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var $s=(Zs.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},Zs.prototype.isEqual=function(t){return _i(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Zs),Js=function(t,e){this.field=t,this.transform=e};function Zs(t){(this.fields=t).sort(Xr.i)}function tu(t,e){this.version=t,this.transformResults=e}var eu=(nu.Ge=function(){return new nu},nu.exists=function(t){return new nu(void 0,t)},nu.updateTime=function(t){return new nu(t)},Object.defineProperty(nu.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),nu.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},nu);function nu(t,e){this.updateTime=t,this.exists=e}function ru(t,e){return void 0!==t.updateTime?e instanceof Pu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Pu}function iu(){}function ou(t,e,n){return t instanceof fu?new Pu(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof lu?function(t,e,n){if(!ru(t.Ke,e))return new Cu(t.key,n.version);var r=vu(t,e);return new Pu(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof gu?function(t,e,n){if(qr(null!=n.transformResults),!ru(t.Ke,e))return new Cu(t.key,n.version);var r=e,i=function(t,e,n){var r=[];qr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],c=a.transform,h=null;e instanceof Pu&&(h=e.field(a.field)),r.push((i=c,o=h,s=n[u],i instanceof Vs?qs(i,o):i instanceof zs?Hs(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=wu(t,r.data(),i);return new Pu(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):new Uu(t.key,n.version,{hasCommittedMutations:!0})}function su(t,e,n,r){return t instanceof fu?function(t,e){if(!ru(t.Ke,e))return e;var n=au(e);return new Pu(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof lu?function(t,e){if(!ru(t.Ke,e))return e;var n=au(e),r=vu(t,e);return new Pu(t.key,n,r,{Ye:!0})}(t,e):t instanceof gu?function(t,e,n,r){if(!ru(t.Ke,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,c,h,f=[],l=0,p=t;l<p.length;l++){var d=p[l],v=d.transform,y=null;n instanceof Pu&&(y=n.field(d.field)),null===y&&r instanceof Pu&&(y=r.field(d.field)),f.push((o=y,s=e,h=c=a=u=void 0,(i=v)instanceof Ms?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof Vs?qs(i,o):i instanceof zs?Hs(i,o):(a=Ps(u=i,o),c=Ys(a)+Ys(u.We),es(a)&&es(u.We)?cs(c):hs(u.serializer,c))))}return f}(t.fieldTransforms,n,e,r),s=wu(t,i.data(),o);return new Pu(t.key,i.version,s,{Ye:!0})}(t,e,r,n):(o=e,ru((i=t).Ke,o)?new Uu(i.key,Vi.min()):o);var i,o}function uu(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||_i(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof Vs&&o instanceof Vs||i instanceof zs&&o instanceof zs?_i(i.elements,o.elements,Wo):i instanceof Ks&&o instanceof Ks?Wo(i.We,o.We):i instanceof Ms&&o instanceof Ms);var n,r,i,o}))}function au(t){return t instanceof Pu?t.version:Vi.min()}var cu,hu,fu=(o(du,hu=iu),du),lu=(o(pu,cu=iu),pu);function pu(t,e,n,r){var i=this;return(i=cu.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ke=r,i.type=1,i}function du(t,e,n){var r=this;return(r=hu.call(this)||this).key=t,r.value=e,r.Ke=n,r.type=0,r}function vu(t,e){return n=t,r=e instanceof Pu?e.data():_u.empty(),i=new Nu(r),n.Qe.fields.forEach(function(t){var e;t.m()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.Je();var n,r,i}var yu,gu=(o(mu,yu=iu),mu);function mu(t,e){var n=this;return(n=yu.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ke=eu.exists(!0),n}function wu(t,e,n){for(var r=new Nu(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var bu,Eu,Iu=(o(Ou,Eu=iu),Ou),Tu=(o(Du,bu=iu),Du),_u=(Su.empty=function(){return new Su({mapValue:{}})},Su.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!os(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},Su.prototype.isEqual=function(t){return Wo(this.proto,t.proto)},Su),Nu=(Au.prototype.set=function(t,e){return this.tn(t,e),this},Au.prototype.delete=function(t){return this.tn(t,null),this},Au.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Ho(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t._(),e)},Au.prototype.Je=function(){var t=this.en(Xr.g(),this.Ze);return null!=t?new _u(t):this.Xe},Au.prototype.en=function(r,t){var i=this,o=!1,e=this.Xe.field(r),s=os(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.en(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Au);function Au(t){void 0===t&&(t=_u.empty()),this.Xe=t,this.Ze=new Map}function Su(t){this.proto=t}function Du(t,e){var n=this;return(n=bu.call(this)||this).key=t,n.Ke=e,n.type=4,n}function Ou(t,e){var n=this;return(n=Eu.call(this)||this).key=t,n.Ke=e,n.type=3,n}function xu(t,e){this.key=t,this.version=e}var Ru,ku,Lu,Pu=(o(ju,Lu=xu),ju.prototype.field=function(t){return this.nn.field(t)},ju.prototype.data=function(){return this.nn},ju.prototype.sn=function(){return this.nn.proto},ju.prototype.isEqual=function(t){return t instanceof ju&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},ju.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.nn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(ju.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),ju),Uu=(o(Fu,ku=xu),Fu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Fu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Fu.prototype.isEqual=function(t){return t instanceof Fu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Fu),Cu=(o(Vu,Ru=xu),Vu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Vu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Vu.prototype.isEqual=function(t){return t instanceof Vu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Vu),Mu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function Vu(){return null!==Ru&&Ru.apply(this,arguments)||this}function Fu(t,e,n){var r=this;return(r=ku.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function ju(t,e,n,r){var i=this;return(i=Lu.call(this,t,e)||this).nn=n,i.Ye=!!r.Ye,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function qu(t,e,n,r,i,o,s,u){return new Mu(t,e,n,r,i,o,s,u)}function Bu(t){return new Mu(t)}function zu(t){return!Gi(t.limit)&&"F"===t.on}function Gu(t){return!Gi(t.limit)&&"L"===t.on}function Hu(t){return 0<t.rn.length?t.rn[0].field:null}function Wu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function Ku(t){return null!==t.collectionGroup}function Qu(t){var e=t;if(null===e.an){e.an=[];var n=Wu(e),r=Hu(e);if(null!==n&&null===r)n.p()||e.an.push(new La(n)),e.an.push(new La(Xr.v(),"asc"));else{for(var i,o=!1,s=0,u=e.rn;s<u.length;s++){var a=u[s];e.an.push(a),a.field.p()&&(o=!0)}o||(i=0<e.rn.length?e.rn[e.rn.length-1].dir:"asc",e.an.push(new La(Xr.v(),i)))}}return e.an}function Yu(t){var e=t;if(!e.cn)if("F"===e.on)e.cn=Qi(e.path,e.collectionGroup,Qu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Qu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new La(o.field,s))}var u=e.endAt?new Na(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Na(e.startAt.position,!e.startAt.before):null;e.cn=Qi(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function Xu(t,e,n){return new Mu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function $u(t,e){return new Mu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function Ju(t,e){return new Mu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function Zu(t,e){return Xi(Yu(t),Yu(e))&&t.on===e.on}function ta(t){return Yi(Yu(t))+"|lt:"+t.on}function ea(t){return"Query(target="+(e=Yu(t),n=e.path.R(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.R()+" "+e.op+" "+Xo(e.value);var e}).join(", ")+"]"),Gi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.R()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+xa(e.startAt)),e.endAt&&(n+=", endAt: "+xa(e.endAt)),"Target("+n+")")+"; limitType="+t.on+")";var e,n}function na(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.N(r.collectionGroup)&&r.path.T(o):$r.F(r.path)?r.path.isEqual(o):r.path.I(o))&&function(t){for(var e=0,n=i.rn;e<n.length;e++){var r=n[e];if(!r.field.p()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||Ra(e.startAt,Qu(e),n))&&(!e.endAt||!Ra(e.endAt,Qu(e),n)));var e,n,r,o}function ra(u){return function(t,e){for(var n=!1,r=0,i=Qu(u);r<i.length;r++){var o=i[r],s=function(t,i,e){var n=t.field.p()?$r.i(i.key,e.key):function(t,e){var n=i.field(t),r=e.field(t);return null!==n&&null!==r?Qo(n,r):jr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return jr()}}(o,t,e);if(0!==s)return s;n=n||o.field.p()}return 0}}var ia,oa=(o(sa,ia=function(){}),sa.create=function(t,e,n){if(t.p())return"in"===e||"not-in"===e?this.hn(t,e,n):new ha(t,e,n);if(rs(n)){if("=="!==e&&"!="!==e)throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new sa(t,e,n)}if(is(n)){if("=="!==e&&"!="!==e)throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new sa(t,e,n)}return"array-contains"===e?new Ea(t,n):"in"===e?new Ia(t,n):"not-in"===e?new Ta(t,n):"array-contains-any"===e?new _a(t,n):new sa(t,e,n)},sa.hn=function(t,e,n){return new("in"===e?fa:la)(t,n)},sa.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.ln(Qo(e,this.value)):null!==e&&Ho(this.value)===Ho(e)&&this.ln(Qo(e,this.value))},sa.prototype.ln=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return jr()}},sa.prototype.un=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},sa);function sa(t,e,n){var r=this;return(r=ia.call(this)||this).field=t,r.op=e,r.value=n,r}var ua,aa,ca,ha=(o(va,ca=oa),va.prototype.matches=function(t){var e=$r.i(t.key,this.key);return this.ln(e)},va),fa=(o(da,aa=oa),da.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},da),la=(o(pa,ua=oa),pa.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},pa);function pa(t,e){var n=this;return(n=ua.call(this,t,"not-in",e)||this).keys=ya(0,e),n}function da(t,e){var n=this;return(n=aa.call(this,t,"in",e)||this).keys=ya(0,e),n}function va(t,e,n){var r=this;return(r=ca.call(this,t,e,n)||this).key=$r.C(n.referenceValue),r}function ya(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return $r.C(t.referenceValue)})}var ga,ma,wa,ba,Ea=(o(Oa,ba=oa),Oa.prototype.matches=function(t){var e=t.field(this.field);return ns(e)&&Ko(e.arrayValue,this.value)},Oa),Ia=(o(Da,wa=oa),Da.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Ko(this.value.arrayValue,e)},Da),Ta=(o(Sa,ma=oa),Sa.prototype.matches=function(t){if(Ko(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!Ko(this.value.arrayValue,e)},Sa),_a=(o(Aa,ga=oa),Aa.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!ns(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ko(e.value.arrayValue,t)})},Aa),Na=function(t,e){this.position=t,this.before=e};function Aa(t,e){return ga.call(this,t,"array-contains-any",e)||this}function Sa(t,e){return ma.call(this,t,"not-in",e)||this}function Da(t,e){return wa.call(this,t,"in",e)||this}function Oa(t,e){return ba.call(this,t,"array-contains",e)||this}function xa(t){return(t.before?"b":"a")+":"+t.position.map(Xo).join(",")}function Ra(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.p()?$r.i($r.C(s.referenceValue),n.key):Qo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ka(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Wo(t.position[n],e.position[n]))return!1;return!0}var La=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Pa(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Ua,Ca=(Ha.prototype.reset=function(){this.Tn=0},Ha.prototype.An=function(){this.Tn=this.mn},Ha.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);0<i&&Cr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Tn+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.En=this._n.gn(this.fn,i,function(){return e.In=Date.now(),t()}),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},Ha.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},Ha.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},Ha.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},Ha),Ma=(Ga.prototype.catch=function(t){return this.next(void 0,t)},Ga.prototype.next=function(r,i){var o=this;return this.Sn&&jr(),this.Sn=!0,this.vn?this.error?this.Dn(i,this.error):this.Cn(r,this.result):new Ga(function(e,n){o.pn=function(t){o.Cn(r,t).next(e,n)},o.bn=function(t){o.Dn(i,t).next(e,n)}})},Ga.prototype.Nn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Ga.prototype.Fn=function(t){try{var e=t();return e instanceof Ga?e:Ga.resolve(e)}catch(t){return Ga.reject(t)}},Ga.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):Ga.resolve(e)},Ga.prototype.Dn=function(t,e){return t?this.Fn(function(){return t(e)}):Ga.reject(e)},Ga.resolve=function(n){return new Ga(function(t,e){t(n)})},Ga.reject=function(n){return new Ga(function(t,e){e(n)})},Ga.$n=function(t){return new Ga(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Ga.xn=function(t){for(var n=Ga.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Ga.resolve(t):e()})}(r[e]);return n},Ga.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.$n(i)},Ga),Va=(za.delete=function(t){return Cr("SimpleDb","Removing database:",t),$a(window.indexedDB.deleteDatabase(t)).Nn()},za.On=function(){if("undefined"==typeof indexedDB)return!1;if(za.Ln())return!0;var t=v(),e=za.Mn(t),n=0<e&&e<10,r=za.Bn(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},za.Ln=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.qn)},za.Un=function(t,e){return t.store(e)},za.Mn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},za.Bn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},za.prototype.Qn=function(){return m(this,void 0,void 0,function(){var e,o=this;return w(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Cr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(n,r){var i=indexedDB.open(o.name,o.version);i.onsuccess=function(t){var e=t.target.result;n(e)},i.onblocked=function(){r(new ja("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Rr(xr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new ja(e))},i.onupgradeneeded=function(t){Cr("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;o.kn.createOrUpgrade(e,i.transaction,t.oldVersion,o.version).next(function(){Cr("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return o.Wn(t)}),this.db)]}})})},za.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},za.prototype.runTransaction=function(r,c,h){return m(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,a.Qn()];case 2:return a.db=t.sent(),e=Ka.open(a.db,s?"readonly":"readwrite",c),n=h(e).catch(function(t){return e.abort(t),Ma.reject(t)}).Nn(),r={},n.catch(function(){}),[4,e.Kn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Cr("SimpleDb","Transaction failed with error:",i.message,"Retrying:",o),a.close(),o?[3,5]:[2,{value:Promise.reject(i)}];case 5:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},za.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},za),Fa=(Object.defineProperty(Ba.prototype,"vn",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(Ba.prototype,"Yn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(Ba.prototype,"cursor",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),Ba.prototype.done=function(){this.zn=!0},Ba.prototype.Jn=function(t){this.Hn=t},Ba.prototype.delete=function(){return $a(this.Gn.delete())},Ba),ja=(o(qa,Ua=Rr),qa);function qa(t){var e=this;return(e=Ua.call(this,xr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Ba(t){this.Gn=t,this.zn=!1,this.Hn=null}function za(t,e,n){this.name=t,this.version=e,this.kn=n,12.2===za.Mn(v())&&Mr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Ga(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t(function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)},function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)})}function Ha(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}function Wa(t){return"IndexedDbTransactionError"===t.name}var Ka=(Xa.open=function(t,e,n){try{return new Xa(t.transaction(n,e))}catch(t){throw new ja(t)}},Object.defineProperty(Xa.prototype,"Kn",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),Xa.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(Cr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Xa.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Qa(e)},Xa),Qa=(Ya.prototype.put=function(t,e){var n=void 0!==e?(Cr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Cr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return $a(n)},Ya.prototype.add=function(t){return Cr("SimpleDb","ADD",this.store.name,t,t),$a(this.store.add(t))},Ya.prototype.get=function(e){var n=this;return $a(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Cr("SimpleDb","GET",n.store.name,e,t),t})},Ya.prototype.delete=function(t){return Cr("SimpleDb","DELETE",this.store.name,t),$a(this.store.delete(t))},Ya.prototype.count=function(){return Cr("SimpleDb","COUNT",this.store.name),$a(this.store.count())},Ya.prototype.Zn=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ts(n,function(t,e){r.push(e)}).next(function(){return r})},Ya.prototype.es=function(t,e){Cr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ns=!1;var r=this.cursor(n);return this.ts(r,function(t,e,n){return n.delete()})},Ya.prototype.ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ts(r,e)},Ya.prototype.rs=function(i){var t=this.cursor({});return new Ma(function(n,r){t.onerror=function(t){var e=Za(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Ya.prototype.ts=function(t,s){var u=[];return new Ma(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Fa(i),(n=s(i.primaryKey,i.value,e))instanceof Ma&&(r=n.catch(function(t){return e.done(),Ma.reject(t)}),u.push(r)),e.vn?o():null===e.Yn?i.continue():i.continue(e.Yn)):o()}}).next(function(){return Ma.$n(u)})},Ya.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Ya.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Ya);function Ya(t){this.store=t}function Xa(t){var n=this;this.transaction=t,this.aborted=!1,this.Xn=new Pa,this.transaction.oncomplete=function(){n.Xn.resolve()},this.transaction.onabort=function(){t.error?n.Xn.reject(new ja(t.error)):n.Xn.resolve()},this.transaction.onerror=function(t){var e=Za(t.target.error);n.Xn.reject(new ja(e))}}function $a(t){return new Ma(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Za(t.target.error);r(e)}})}var Ja=!1;function Za(t){var e=Va.Mn(v());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Rr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ja||(Ja=!0,setTimeout(function(){throw r},0)),r}}return t}function tc(){return"undefined"!=typeof window?window:null}function ec(){return"undefined"!=typeof document?document:null}var nc=(oc.ls=function(t,e,n,r,i){var o=new oc(t,e,Date.now()+n,r,i);return o.start(n),o},oc.prototype.start=function(t){var e=this;this._s=setTimeout(function(){return e.fs()},t)},oc.prototype.Vn=function(){return this.fs()},oc.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new Rr(xr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},oc.prototype.fs=function(){var e=this;this.os.ds(function(){return null!==e._s?(e.clearTimeout(),e.op().then(function(t){return e.hs.resolve(t)})):Promise.resolve()})},oc.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},oc),rc=(Object.defineProperty(ic.prototype,"Vs",{get:function(){return this.Es},enumerable:!1,configurable:!0}),ic.prototype.ds=function(t){this.enqueue(t)},ic.prototype.ps=function(t){this.bs(),this.vs(t)},ic.prototype.Ss=function(){var t;this.Es||(this.Es=!0,(t=ec())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys))},ic.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise(function(t){}):this.vs(t)},ic.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds(function(){return e.Cs()})},ic.prototype.Cs=function(){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!Wa(e=t.sent()))throw e;return Cr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.gs.Rn(function(){return n.Cs()}),t.label=5;case 5:return[2]}})})},ic.prototype.vs=function(t){var r=this,e=this.ws.then(function(){return r.Rs=!0,t().catch(function(t){throw r.As=t,r.Rs=!1,Mr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Rs=!1,t})});return this.ws=e},ic.prototype.gn=function(t,e,n){var r=this;this.bs(),-1<this.Ps.indexOf(t)&&(e=0);var i=nc.ls(this,t,e,n,function(t){return r.Ns(t)});return this.Is.push(i),i},ic.prototype.bs=function(){this.As&&jr()},ic.prototype.Fs=function(){},ic.prototype.$s=function(){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.ws];case 1:t.sent(),t.label=2;case 2:if(e!==this.ws)return[3,0];t.label=3;case 3:return[2]}})})},ic.prototype.xs=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},ic.prototype.ks=function(r){var i=this;return this.$s().then(function(){i.Is.sort(function(t,e){return t.cs-e.cs});for(var t=0,e=i.Is;t<e.length;t++){var n=e[t];if(n.Vn(),"all"!==r&&n.fn===r)break}return i.$s()})},ic.prototype.Ms=function(t){this.Ps.push(t)},ic.prototype.Ns=function(t){var e=this.Is.indexOf(t);this.Is.splice(e,1)},ic);function ic(){var e=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new Ca(this,"async_queue_retry"),this.ys=function(){var t=ec();t&&Cr("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.gs.yn()};var t=ec();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ys)}function oc(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new Pa,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch(function(t){})}function sc(t,e){if(Mr("AsyncQueue",e+": "+t),Wa(t))return new Rr(xr.UNAVAILABLE,e+": "+t);throw t}function uc(){this.Os=void 0,this.listeners=[]}function ac(){this.Ls=new Ci(ta,Zu),this.onlineState="Unknown",this.Bs=new Set}function cc(a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u;return w(this,function(t){switch(t.label){case 0:if(e=a,n=c.query,r=!1,(i=e.Ls.get(n))||(r=!0,i=new uc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.qs(n)];case 2:return o.Os=t.sent(),[3,4];case 3:return s=t.sent(),u=sc(s,"Initialization of query '"+ea(c.query)+"' failed"),[2,void c.onError(u)];case 4:return e.Ls.set(n,i),i.listeners.push(c),c.Us(e.onlineState),i.Os&&c.Qs(i.Os)&&fc(e),[2]}})})}function hc(s,u){return m(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){return e=s,n=u.query,r=!1,(i=e.Ls.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Ls.delete(n),e.Ws(n))]:[2]})})}function fc(t){t.Bs.forEach(function(t){t.next()})}var lc=(vc.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new No(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},vc.prototype.onError=function(t){this.js.error(t)},vc.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},vc.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Js&&n||t.docs.m()&&"Offline"!==e)},vc.prototype.zs=function(t){if(0<t.docChanges.length)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},vc.prototype.Ys=function(t){t=No.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},vc),pc=(dc.prototype.Xs=function(){return null!=this.uid},dc.prototype.Zs=function(){return this.Xs()?"uid:"+this.uid:"anonymous-user"},dc.prototype.isEqual=function(t){return t.uid===this.uid},dc);function dc(t){this.uid=t}function vc(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState="Unknown",this.options=n||{}}pc.UNAUTHENTICATED=new pc(null),pc.ti=new pc("google-credentials-uid"),pc.ei=new pc("first-party-uid");var yc=(gc.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},gc.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},gc);function gc(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}function mc(t,e){return"firestore_clients_"+t+"_"+e}function wc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Xs()&&(r+="_"+e.uid),r}function bc(t,e){return"firestore_targets_"+t+"_"+e}yc.oi=-1;var Ec=(Kc.ai=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Rr(r.error.code,r.error.message)),i?new Kc(t,e,r.state,o):(Mr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Kc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Kc),Ic=(Wc.ai=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Rr(n.error.code,n.error.message)),r?new Wc(t,n.state,i):(Mr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Wc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Wc),Tc=(Hc.ai=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Io,o=0;r&&o<n.activeTargetIds.length;++o)r=Wi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Hc(t,i):(Mr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Hc),_c=(Gc.ai=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Gc(e.clientId,e.onlineState):(Mr("SharedClientState","Failed to parse online state: "+t),null)},Gc),Nc=(zc.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},zc.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},zc.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},zc),Ac=(Bc.On=function(t){return!(!t||!t.localStorage)},Bc.prototype.start=function(){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this._i.Vi()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.li&&(o=this.getItem(mc(this.persistenceKey,i)))&&(s=Tc.ai(i,o))&&(this.mi=this.mi.rt(s.clientId,s));for(this.pi(),(u=this.storage.getItem(this.yi))&&(a=this.bi(u))&&this.vi(a),c=0,h=this.Ei;c<h.length;c++)f=h[c],this.wi(f);return this.Ei=[],this.window.addEventListener("unload",function(){return l.Si()}),this.Ti=!0,[2]}})})},Bc.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},Bc.prototype.Di=function(){return this.Ci(this.mi)},Bc.prototype.Ni=function(n){var r=!1;return this.mi.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Bc.prototype.Fi=function(t){this.$i(t,"pending")},Bc.prototype.xi=function(t,e,n){this.$i(t,e,n),this.ki(t)},Bc.prototype.Mi=function(t){var e,n,r="not-current";return this.Ni(t)&&(!(e=this.storage.getItem(bc(this.persistenceKey,t)))||(n=Ic.ai(t,e))&&(r=n.state)),this.Oi.ui(t),this.pi(),r},Bc.prototype.Li=function(t){this.Oi.hi(t),this.pi()},Bc.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},Bc.prototype.qi=function(t){this.removeItem(bc(this.persistenceKey,t))},Bc.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},Bc.prototype.Wi=function(t,e,n){var r=this;e.forEach(function(t){r.ki(t)}),this.currentUser=t,n.forEach(function(t){r.Fi(t)})},Bc.prototype.ji=function(t){this.Ki(t)},Bc.prototype.Si=function(){this.Ti&&(this.window.removeEventListener("storage",this.di),this.removeItem(this.Ii),this.Ti=!1)},Bc.prototype.getItem=function(t){var e=this.storage.getItem(t);return Cr("SharedClientState","READ",t,e),e},Bc.prototype.setItem=function(t,e){Cr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Bc.prototype.removeItem=function(t){Cr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Bc.prototype.wi=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Cr("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Ii)return void Mr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this._n.Ds(function(){return m(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.Ti){if(null!==u.key)if(this.Ri.test(u.key)){if(null==u.newValue)return e=this.Gi(u.key),[2,this.zi(e,null)];if(n=this.Hi(u.key,u.newValue))return[2,this.zi(n.clientId,n)]}else if(this.Pi.test(u.key)){if(null!==u.newValue&&(r=this.Yi(u.key,u.newValue)))return[2,this.Ji(r)]}else if(this.gi.test(u.key)){if(null!==u.newValue&&(i=this.Xi(u.key,u.newValue)))return[2,this.Zi(i)]}else if(u.key===this.yi){if(null!==u.newValue&&(o=this.bi(u.newValue)))return[2,this.vi(o)]}else u.key===this.Ai&&(s=function(t){var e=yc.oi;if(null!=t)try{var n=JSON.parse(t);qr("number"==typeof n),e=n}catch(t){Mr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==yc.oi&&this.ni(s)}else this.Ei.push(u);return[2]})})})}},Object.defineProperty(Bc.prototype,"Oi",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),Bc.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},Bc.prototype.$i=function(t,e,n){var r=new Ec(this.currentUser,t,e,n),i=wc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},Bc.prototype.ki=function(t){var e=wc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Bc.prototype.Ki=function(t){var e={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},Bc.prototype.Qi=function(t,e,n){var r=bc(this.persistenceKey,t),i=new Ic(t,e,n);this.setItem(r,i.ci())},Bc.prototype.Gi=function(t){var e=this.Ri.exec(t);return e?e[1]:null},Bc.prototype.Hi=function(t,e){var n=this.Gi(t);return Tc.ai(n,e)},Bc.prototype.Yi=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ec.ai(new pc(i),r,e)},Bc.prototype.Xi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]);return Ic.ai(r,e)},Bc.prototype.bi=function(t){return _c.ai(t)},Bc.prototype.Ji=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this._i.tr(e.batchId,e.state,e.error)]:(Cr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Bc.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},Bc.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this._i.nr(s,u).then(function(){n.mi=r})},Bc.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},Bc.prototype.Ci=function(t){var n=Io;return t.forEach(function(t,e){n=n.xt(e.activeTargetIds)}),n},Bc),Sc=(qc.prototype.Fi=function(t){},qc.prototype.xi=function(t,e,n){},qc.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||"not-current"},qc.prototype.Ui=function(t,e,n){this.ir[t]=e},qc.prototype.Li=function(t){this.sr.hi(t)},qc.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},qc.prototype.qi=function(t){delete this.ir[t]},qc.prototype.Di=function(){return this.sr.activeTargetIds},qc.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},qc.prototype.start=function(){return this.sr=new Nc,Promise.resolve()},qc.prototype.Wi=function(t,e,n){},qc.prototype.ji=function(t){},qc.prototype.Si=function(){},qc.prototype.ri=function(t){},qc),Dc=(jc.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=ou(o,e,r[i]))}return e},jc.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=su(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=su(a,e,o,this.rr))}return e},jc.prototype.hr=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ur(t.key,n.get(t.key));e&&(i=i.rt(t.key,e))}),i},jc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Eo())},jc.prototype.isEqual=function(t){return this.batchId===t.batchId&&_i(this.mutations,t.mutations,uu)&&_i(this.baseMutations,t.baseMutations,uu)},jc),Oc=(Fc.from=function(t,e,n){qr(t.mutations.length===n.length);for(var r=wo,i=t.mutations,o=0;o<i.length;o++)r=r.rt(i[o].key,n[o].version);return new Fc(t,e,n,r)},Fc),xc=(Object.defineProperty(Vc.prototype,"readTime",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),Vc.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},Vc.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},Vc.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?Ma.resolve(n):this.Rr(t,e)},Vc.prototype.getEntries=function(t,e){return this.Pr(t,e)},Vc.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},Vc.prototype.Er=function(){},Vc),Rc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",kc=(Mc.prototype.Vr=function(t){this.yr.push(t)},Mc.prototype.pr=function(){this.yr.forEach(function(t){return t()})},Mc),Lc=(Cc.prototype.Dr=function(e,n){var r=this;return this.vr.Cr(e,n).next(function(t){return r.Nr(e,n,t)})},Cc.prototype.Nr=function(t,r,i){return this.br.Ar(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ur(r,t);return t})},Cc.prototype.Fr=function(t,e,i){var o=vo;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ur(t,e);o=o.rt(t,e)}),o},Cc.prototype.$r=function(e,t){var n=this;return this.br.getEntries(e,t).next(function(t){return n.kr(e,t)})},Cc.prototype.kr=function(r,i){var o=this;return this.vr.Mr(r,i).next(function(t){var e=o.Fr(r,i,t),n=vo;return e.forEach(function(t,e){e=e||new Uu(t,Vi.min()),n=n.rt(t,e)}),n})},Cc.prototype.Or=function(t,e,n){return r=e,$r.F(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Lr(t,e.path):Ku(e)?this.Br(t,e,n):this.qr(t,e,n);var r},Cc.prototype.Lr=function(t,e){return this.Dr(t,new $r(e)).next(function(t){var e=mo;return t instanceof Pu&&(e=e.rt(t.key,t)),e})},Cc.prototype.Br=function(i,o,s){var u=this,a=o.collectionGroup,c=mo;return this.Sr.Ur(i,a).next(function(t){return Ma.forEach(t,function(t){var e,n,r=(e=o,n=t.child(a),new Mu(n,null,e.rn.slice(),e.filters.slice(),e.limit,e.on,e.startAt,e.endAt));return u.qr(i,r,s).next(function(t){t.forEach(function(t,e){c=c.rt(t,e)})})}).next(function(){return c})})},Cc.prototype.qr=function(e,n,t){var h,f,r=this;return this.br.Or(e,n,t).next(function(t){return h=t,r.vr.Qr(e,n)}).next(function(t){return f=t,r.Wr(e,f,h).next(function(t){h=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=h.get(u),c=su(s,a,a,r.rr);h=c instanceof Pu?h.rt(u,c):h.remove(u)}})}).next(function(){return h.forEach(function(t,e){na(n,e)||(h=h.remove(t))}),h})},Cc.prototype.Wr=function(t,e,n){for(var r=Eo(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof lu&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Pu&&(c=c.rt(t,e))}),c})},Cc),Pc=(Uc.Gr=function(t,e){for(var n=Eo(),r=Eo(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Uc(t,e.fromCache,n,r)},Uc);function Uc(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}function Cc(t,e,n){this.br=t,this.vr=e,this.Sr=n}function Mc(){this.yr=[]}function Vc(){this.dr=new Ci(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.wr=!1}function Fc(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}function jc(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}function qc(){this.sr=new Nc,this.ir={},this.fi=null,this.ni=null}function Bc(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new oo(Ti),this.Ti=!1,this.Ei=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=mc(this.persistenceKey,this.li),this.Ai="firestore_sequence_number_"+this.persistenceKey,this.mi=this.mi.rt(this.li,new Nc),this.Ri=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.gi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.yi="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.di)}function zc(){this.activeTargetIds=Io}function Gc(t,e){this.clientId=t,this.onlineState=e}function Hc(t,e){this.clientId=t,this.activeTargetIds=e}function Wc(t,e,n){this.targetId=t,this.state=e,this.error=n}function Kc(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Qc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ti(n,i);return 0===s?Ti(r,o):s}var Yc=(Zc.prototype.Yr=function(){return++this.Hr},Zc.prototype.Jr=function(t){var e,n=[t,this.Yr()];this.buffer.size<this.zr?this.buffer=this.buffer.add(n):Qc(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Zc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Zc),Xc={Xr:!1,Zr:0,eo:0,no:0},$c=(Jc.oo=function(t){return new Jc(t,Jc.ao,Jc.co)},Jc);function Jc(t,e,n){this.so=t,this.io=e,this.ro=n}function Zc(t){this.zr=t,this.buffer=new lo(Qc),this.Hr=0}$c.uo=-1,$c.ho=1048576,$c.lo=41943040,$c.ao=10,$c.co=1e3,$c._o=new $c($c.lo,$c.ao,$c.co),$c.fo=new $c($c.uo,0,0);var th=(rh.prototype.start=function(t){this.do.params.so!==$c.uo&&this.To(t)},rh.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(rh.prototype,"Ti",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),rh.prototype.To=function(n){var t=this,e=this.wo?3e5:6e4;Cr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.mo=this.os.gn("lru_garbage_collection",e,function(){return m(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.mo=null,this.wo=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Eo(this.do)];case 2:return t.sent(),[3,7];case 3:return Wa(e=t.sent())?(Cr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Lf(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.To(n)];case 8:return t.sent(),[2]}})})})},rh),eh=(nh.prototype.Ao=function(t,e){return this.Io.Ro(t).next(function(t){return Math.floor(e/100*t)})},nh.prototype.Po=function(t,e){var n=this;if(0===e)return Ma.resolve(yc.oi);var r=new Yc(e);return this.Io.De(t,function(t){return r.Jr(t.sequenceNumber)}).next(function(){return n.Io.yo(t,function(t){return r.Jr(t)})}).next(function(){return r.maxValue})},nh.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},nh.prototype.po=function(t,e){return this.Io.po(t,e)},nh.prototype.bo=function(e,n){var r=this;return this.params.so===$c.uo?(Cr("LruGarbageCollector","Garbage collection skipped; disabled"),Ma.resolve(Xc)):this.vo(e).next(function(t){return t<r.params.so?(Cr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.so),Xc):r.So(e,n)})},nh.prototype.vo=function(t){return this.Io.vo(t)},nh.prototype.So=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Ao(e,this.params.io).next(function(t){return i=t>h.params.ro?(Cr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.ro+" from "+t),h.params.ro):t,s=Date.now(),h.Po(e,i)}).next(function(t){return r=t,u=Date.now(),h.Vo(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.po(e,r)}).next(function(t){return c=Date.now(),Ur()<=l.DEBUG&&Cr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Ma.resolve({Xr:!0,Zr:i,eo:o,no:t})})},nh);function nh(t,e){this.Io=t,this.params=e}function rh(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}function ih(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=oh(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return oh(e)}function oh(t){return t+""}function sh(t){var e=t.length;if(qr(2<=e),2===e)return qr(""===t.charAt(0)&&""===t.charAt(1)),Qr.g();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&jr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:jr()}o=s+2}return new Qr(r)}var uh=function(t){this.Do=t};function ah(t,e){if(e.document)return n=t.Do,r=e.document,i=!!e.hasCommittedMutations,o=ms(n,r.name),s=ds(r.updateTime),u=new _u({mapValue:{fields:r.fields}}),new Pu(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=$r.$(e.noDocument.path),c=ph(e.noDocument.readTime);return new Uu(a,c,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var h=$r.$(e.unknownDocument.path),f=ph(e.unknownDocument.version);return new Cu(h,f)}return jr()}function ch(t,e,n){var r,i,o=hh(n),s=e.key.path.h().A();if(e instanceof Pu){var u={name:gs(r=t.Do,(i=e).key),fields:i.sn().mapValue.fields,updateTime:ls(r,i.version.X())},a=e.hasCommittedMutations;return new Wh(null,null,u,a,o,s)}if(e instanceof Uu){var c=e.key.path.A(),h=lh(e.version),f=e.hasCommittedMutations;return new Wh(null,new Gh(c,h),null,f,o,s)}if(e instanceof Cu){var l=e.key.path.A(),p=lh(e.version);return new Wh(new Hh(l,p),null,null,!0,o,s)}return jr()}function hh(t){var e=t.X();return[e.seconds,e.nanoseconds]}function fh(t){var e=new Mi(t[0],t[1]);return Vi.Y(e)}function lh(t){var e=t.X();return new Uh(e.seconds,e.nanoseconds)}function ph(t){var e=new Mi(t.seconds,t.nanoseconds);return Vi.Y(e)}function dh(e,t){var n=(t.baseMutations||[]).map(function(t){return Ns(e.Do,t)}),r=t.mutations.map(function(t){return Ns(e.Do,t)}),i=Mi.fromMillis(t.localWriteTimeMs);return new Dc(t.batchId,i,n,r)}function vh(t){var e,n=ph(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?ph(t.lastLimboFreeSnapshotVersion):Vi.min(),i=void 0!==t.query.documents?(qr(1===(e=t.query).documents.length),Yu(Bu(bs(e.documents[0])))):function(t){var e,n=bs(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(qr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Rs(t.unaryFilter.field);return oa.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Rs(t.unaryFilter.field);return oa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Rs(t.unaryFilter.field);return oa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Rs(t.unaryFilter.field);return oa.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return jr()}}(e)]:void 0!==e.fieldFilter?[(n=e,oa.create(Rs(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return jr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):jr():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new La(Rs((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,c,h=null;r.limit&&(a=r.limit,h=Gi(c="object"==typeof a?a.value:a)?null:c);var f=null;r.startAt&&(f=Os(r.startAt));var l=null;return r.endAt&&(l=Os(r.endAt)),Yu(qu(n,o,u,s,h,"F",f,l))}(t.query);return new eo(i,t.targetId,0,t.lastListenSequenceNumber,n,r,Ai.fromBase64String(t.resumeToken))}function yh(t,e){var n=lh(e.et),r=lh(e.lastLimboFreeSnapshotVersion),i=($i(e.target)?As:Ss)(t.Do,e.target),o=e.resumeToken.toBase64();return new Qh(e.targetId,Yi(e.target),n,o,e.sequenceNumber,r,i)}var gh=(mh.Fo=function(t,e,n,r){return qr(""!==t.uid),new mh(t.Xs()?t.uid:"",e,n,r)},mh.prototype.$o=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Eh(t).ss({index:qh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},mh.prototype.xo=function(d,v,y,g){var m=this,w=Ih(d),b=Eh(d);return b.add({}).next(function(t){qr("number"==typeof t);for(var e,n,r,i,o,s=new Dc(t,v,y,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return _s(e.Do,t)}),o=r.mutations.map(function(t){return _s(e.Do,t)}),new qh(n,r.batchId,r.rr.toMillis(),i,o)),a=[],c=new lo(function(t,e){return Ti(t.R(),e.R())}),h=0,f=g;h<f.length;h++){var l=f[h],p=Bh.key(m.userId,l.key.path,t),c=c.add(l.key.path.h());a.push(b.put(u)),a.push(w.put(p,Bh.PLACEHOLDER))}return c.forEach(function(t){a.push(m.Sr.ko(d,t))}),d.Vr(function(){m.No[t]=s.keys()}),Ma.$n(a).next(function(){return s})})},mh.prototype.Mo=function(t,e){var n=this;return Eh(t).get(e).next(function(t){return t?(qr(t.userId===n.userId),dh(n.serializer,t)):null})},mh.prototype.Oo=function(t,n){var r=this;return this.No[n]?Ma.resolve(this.No[n]):this.Mo(t,n).next(function(t){if(t){var e=t.keys();return r.No[n]=e}return null})},mh.prototype.Lo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Eh(t).ss({index:qh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(qr(e.batchId>=i),o=dh(r.serializer,e)),n.done()}).next(function(){return o})},mh.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Eh(t).ss({index:qh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},mh.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Eh(t).Zn(qh.userMutationsIndex,n).next(function(t){return t.map(function(t){return dh(e.serializer,t)})})},mh.prototype.Cr=function(u,a){var c=this,t=Bh.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),h=[];return Ih(u).ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=sh(i);if(r===c.userId&&a.path.isEqual(s))return Eh(u).get(o).next(function(t){if(!t)throw jr();qr(t.userId===c.userId),h.push(dh(c.serializer,t))});n.done()}).next(function(){return h})},mh.prototype.Mr=function(r,t){var a=this,c=new lo(Ti),i=[];return t.forEach(function(u){var t=Bh.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Ih(r).ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=sh(i);r===a.userId&&u.path.isEqual(s)?c=c.add(o):n.done()});i.push(n)}),Ma.$n(i).next(function(){return a.Uo(r,c)})},mh.prototype.Qr=function(t,e){var u=this,a=e.path,c=a.length+1,n=Bh.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),h=new lo(Ti);return Ih(t).ss({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=sh(i);r===u.userId&&a.T(s)?s.length===c&&(h=h.add(o)):n.done()}).next(function(){return u.Uo(t,h)})},mh.prototype.Uo=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Eh(e).get(t).next(function(t){if(null===t)throw jr();qr(t.userId===n.userId),r.push(dh(n.serializer,t))}))}),Ma.$n(i).next(function(){return r})},mh.prototype.Qo=function(e,n){var r=this;return bh(e.Wo,this.userId,n).next(function(t){return e.Vr(function(){r.jo(n.batchId)}),Ma.forEach(t,function(t){return r.Co.Ko(e,t)})})},mh.prototype.jo=function(t){delete this.No[t]},mh.prototype.Go=function(n){var o=this;return this.$o(n).next(function(t){if(!t)return Ma.resolve();var e=IDBKeyRange.lowerBound(Bh.prefixForUser(o.userId)),i=[];return Ih(n).ss({range:e},function(t,e,n){var r;t[0]===o.userId?(r=sh(t[1]),i.push(r)):n.done()}).next(function(){qr(0===i.length)})})},mh.prototype.zo=function(t,e){return wh(t,this.userId,e)},mh.prototype.Ho=function(t){var e=this;return Th(t).get(this.userId).next(function(t){return t||new jh(e.userId,-1,"")})},mh);function mh(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}function wh(t,o,e){var n=Bh.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Ih(t).ss({range:r,ns:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function bh(t,e,n){var r=t.store(qh.store),i=t.store(Bh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ss({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){qr(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Bh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Ma.$n(o).next(function(){return c})}function Eh(t){return vf.Un(t,qh.store)}function Ih(t){return vf.Un(t,Bh.store)}function Th(t){return vf.Un(t,jh.store)}var _h,Nh=(Ah.prototype.Tr=function(t,e,n){return Dh(t).put(Oh(e),n)},Ah.prototype.Ir=function(t,e){var n=Dh(t),r=Oh(e);return n.delete(r)},Ah.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Yo(e,t)})},Ah.prototype.Ar=function(t,e){var n=this;return Dh(t).get(Oh(e)).next(function(t){return n.Jo(t)})},Ah.prototype.Xo=function(t,e){var n=this;return Dh(t).get(Oh(e)).next(function(t){var e=n.Jo(t);return e?{Zo:e,size:xh(t)}:null})},Ah.prototype.getEntries=function(t,e){var r=this,i=vo;return this.ta(t,e,function(t,e){var n=r.Jo(e);i=i.rt(t,n)}).next(function(){return i})},Ah.prototype.ea=function(t,e){var r=this,i=vo,o=new oo($r.i);return this.ta(t,e,function(t,e){var n=r.Jo(e);o=n?(i=i.rt(t,n),o.rt(t,xh(e))):(i=i.rt(t,null),o.rt(t,0))}).next(function(){return{na:i,sa:o}})},Ah.prototype.ta=function(t,e,i){if(e.m())return Ma.resolve();var n=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),o=e.lt(),s=o.Et();return Dh(t).ss({range:n},function(t,e,n){for(var r=$r.$(t);s&&$r.i(s,r)<0;)i(s,null),s=o.Et();s&&s.isEqual(r)&&(i(s,e),s=o.It()?o.Et():null),s?n.Jn(s.path.A()):n.done()}).next(function(){for(;s;)i(s,null),s=o.It()?o.Et():null})},Ah.prototype.Or=function(t,i,e){var n,r,o,s=this,u=mo,a=i.path.length+1,c={};return e.isEqual(Vi.min())?(n=i.path.A(),c.range=IDBKeyRange.lowerBound(n)):(r=i.path.A(),o=hh(e),c.range=IDBKeyRange.lowerBound([r,o],!0),c.index=Wh.collectionReadTimeIndex),Dh(t).ss(c,function(t,e,n){var r;t.length===a&&(r=ah(s.serializer,e),i.path.T(r.key.path)?r instanceof Pu&&na(i,r)&&(u=u.rt(r.key,r)):n.done())}).next(function(){return u})},Ah.prototype.ia=function(t,e){var r=this,i=vo,o=hh(e),n=Dh(t),s=IDBKeyRange.lowerBound(o,!0);return n.ss({index:Wh.readTimeIndex,range:s},function(t,e){var n=ah(r.serializer,e);i=i.rt(n.key,n),o=e.readTime}).next(function(){return{ra:i,readTime:fh(o)}})},Ah.prototype.oa=function(t){var e=Dh(t),r=Vi.min();return e.ss({index:Wh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=fh(e.readTime)),n.done()}).next(function(){return r})},Ah.prototype.aa=function(t){return new Ah.ca(this,!!t&&t.ua)},Ah.prototype.ha=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ah.prototype.getMetadata=function(t){return Sh(t).get(Kh.key).next(function(t){return qr(!!t),t})},Ah.prototype.Yo=function(t,e){return Sh(t).put(Kh.key,e)},Ah.prototype.Jo=function(t){if(t){var e=ah(this.serializer,t);return e instanceof Uu&&e.version.isEqual(Vi.min())?null:e}return null},Ah);function Ah(t,e){this.serializer=t,this.Sr=e}function Sh(t){return vf.Un(t,Kh.store)}function Dh(t){return vf.Un(t,Wh.store)}function Oh(t){return t.path.A()}function xh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw jr();e=t.noDocument}return JSON.stringify(e).length}function Rh(t,e){var n=this;return(n=_h.call(this)||this).la=t,n.ua=e,n._a=new Ci(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}Nh.ca=(o(Rh,_h=xc),Rh.prototype.gr=function(s){var u=this,a=[],c=0,h=new lo(function(t,e){return Ti(t.R(),e.R())});return this.dr.forEach(function(t,e){var n,r,i,o=u._a.get(t);e?(n=ch(u.la.serializer,e,u.readTime),h=h.add(t.path.h()),r=xh(n),c+=r-o,a.push(u.la.Tr(s,t,n))):(c-=o,u.ua?(i=ch(u.la.serializer,new Uu(t,Vi.min()),u.readTime),a.push(u.la.Tr(s,t,i))):a.push(u.la.Ir(s,t)))}),h.forEach(function(t){a.push(u.la.Sr.ko(s,t))}),a.push(this.la.updateMetadata(s,c)),Ma.$n(a)},Rh.prototype.Rr=function(t,e){var n=this;return this.la.Xo(t,e).next(function(t){return null===t?(n._a.set(e,0),null):(n._a.set(e,t.size),t.Zo)})},Rh.prototype.Pr=function(t,e){var n=this;return this.la.ea(t,e).next(function(t){var e=t.na;return t.sa.forEach(function(t,e){n._a.set(t,e)}),e})},Rh);var kh=(Fh.prototype.ko=function(t,e){return this.fa.add(e),Ma.resolve()},Fh.prototype.Ur=function(t,e){return Ma.resolve(this.fa.getEntries(e))},Fh),Lh=(Vh.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new lo(Qr.i),i=!r.has(n);return this.index[e]=r.add(n),i},Vh.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},Vh.prototype.getEntries=function(t){return(this.index[t]||new lo(Qr.i)).A()},Vh),Ph=(Mh.prototype.createOrUpgrade=function(n,r,t,e){var i=this;qr(t<e&&0<=t&&e<=10);var o,s=new Ka(r);t<1&&1<=e&&(n.createObjectStore(Ch.store),(o=n).createObjectStore(jh.store,{keyPath:jh.keyPath}),o.createObjectStore(qh.store,{keyPath:qh.keyPath,autoIncrement:!0}).createIndex(qh.userMutationsIndex,qh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Bh.store),Jh(n),n.createObjectStore(Wh.store));var u,a=Ma.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Yh.store),u.deleteObjectStore(Qh.store),u.deleteObjectStore(Xh.store),Jh(n)),a=a.next(function(){return t=s.store(Xh.store),e=new Xh(0,0,Vi.min().X(),0),t.put(Xh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(qh.store).Zn().next(function(t){r.deleteObjectStore(qh.store),r.createObjectStore(qh.store,{keyPath:qh.keyPath,autoIncrement:!0}).createIndex(qh.userMutationsIndex,qh.userMutationsKeyPath,{unique:!0});var e=i.store(qh.store),n=t.map(function(t){return e.put(t)});return Ma.$n(n)});var r,i})),a=a.next(function(){n.createObjectStore(Zh.store,{keyPath:Zh.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Kh.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Wh.store)).createIndex(Wh.readTimeIndex,Wh.readTimeIndexPath,{unique:!1}),t.createIndex(Wh.collectionReadTimeIndex,Wh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Mh.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Wh.store).ss(function(t,e){n+=xh(e)}).next(function(){var t=new Kh(n);return e.store(Kh.store).put(Kh.key,t)})},Mh.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(jh.store),e=r.store(qh.store);return t.Zn().next(function(t){return Ma.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Zn(qh.userMutationsIndex,t).next(function(t){return Ma.forEach(t,function(t){qr(t.userId===n.userId);var e=dh(i.serializer,t);return bh(r,n.userId,e).next(function(){})})})})})},Mh.prototype.ensureSequenceNumbers=function(t){var s=t.store(Yh.store),e=t.store(Wh.store);return t.store(Xh.store).get(Xh.key).next(function(i){var o=[];return e.ss(function(t,e){var n=new Qr(t),r=[0,ih(n)];o.push(s.get(r).next(function(t){return t?Ma.resolve():s.put(new Yh(0,ih(n),i.highestListenSequenceNumber))}))}).next(function(){return Ma.$n(o)})})},Mh.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore($h.store,{keyPath:$h.keyPath});function i(t){if(o.add(t)){var e=t._(),n=t.h();return r.put({collectionId:e,parent:ih(n)})}}var r=e.store($h.store),o=new Lh;return e.store(Wh.store).ss({ns:!0},function(t,e){var n=new Qr(t);return i(n.h())}).next(function(){return e.store(Bh.store).ss({ns:!0},function(t,e){t[0];var n=t[1],r=(t[2],sh(n));return i(r.h())})})},Mh.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Qh.store);return o.ss(function(t,e){var n=vh(e),r=yh(i.serializer,n);return o.put(r)})},Mh),Uh=function(t,e){this.seconds=t,this.nanoseconds=e},Ch=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Mh(t){this.serializer=t}function Vh(){this.index={}}function Fh(){this.fa=new Lh}Ch.store="owner",Ch.key="owner";var jh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};jh.store="mutationQueues",jh.keyPath="userId";var qh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};qh.store="mutations",qh.keyPath="batchId",qh.userMutationsIndex="userMutationsIndex",qh.userMutationsKeyPath=["userId","batchId"];var Bh=(zh.prefixForUser=function(t){return[t]},zh.prefixForPath=function(t,e){return[t,ih(e)]},zh.key=function(t,e,n){return[t,ih(e),n]},zh);function zh(){}Bh.store="documentMutations",Bh.PLACEHOLDER=new Bh;var Gh=function(t,e){this.path=t,this.readTime=e},Hh=function(t,e){this.path=t,this.version=e},Wh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Wh.store="remoteDocuments",Wh.readTimeIndex="readTimeIndex",Wh.readTimeIndexPath="readTime",Wh.collectionReadTimeIndex="collectionReadTimeIndex",Wh.collectionReadTimeIndexPath=["parentPath","readTime"];var Kh=function(t){this.byteSize=t};Kh.store="remoteDocumentGlobal",Kh.key="remoteDocumentGlobalKey";var Qh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Qh.store="targets",Qh.keyPath="targetId",Qh.queryTargetsIndexName="queryTargetsIndex",Qh.queryTargetsKeyPath=["canonicalId","targetId"];var Yh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Yh.store="targetDocuments",Yh.keyPath=["targetId","path"],Yh.documentTargetsIndex="documentTargetsIndex",Yh.documentTargetsKeyPath=["path","targetId"];var Xh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Xh.key="targetGlobalKey",Xh.store="targetGlobal";var $h=function(t,e){this.collectionId=t,this.parent=e};function Jh(t){t.createObjectStore(Yh.store,{keyPath:Yh.keyPath}).createIndex(Yh.documentTargetsIndex,Yh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Qh.store,{keyPath:Qh.keyPath}).createIndex(Qh.queryTargetsIndexName,Qh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Xh.store)}$h.store="collectionParents",$h.keyPath=["collectionId","parent"];var Zh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Zh.store="clientMetadata",Zh.keyPath="clientId";var tf=s(s(s([jh.store,qh.store,Bh.store,Wh.store,Qh.store,Ch.store,Xh.store,Yh.store],[Zh.store]),[Kh.store]),[$h.store]),ef=(nf.prototype.ko=function(t,e){var n=this;if(this.da.has(e))return Ma.resolve();var r=e._(),i=e.h();t.Vr(function(){n.da.add(e)});var o={collectionId:r,parent:ih(i)};return rf(t).put(o)},nf.prototype.Ur=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Ni(i),""],!1,!0);return rf(t).Zn(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(sh(r.parent))}return o})},nf);function nf(){this.da=new Lh}function rf(t){return vf.Un(t,$h.store)}var of=(af.prototype.next=function(){return this.wa+=2,this.wa},af.ma=function(){return new af(0)},af.Ta=function(){return new af(-1)},af),sf=(uf.prototype.Ea=function(n){var r=this;return this.Ia(n).next(function(t){var e=new of(t.highestTargetId);return t.highestTargetId=e.next(),r.Aa(n,t).next(function(){return t.highestTargetId})})},uf.prototype.Ra=function(t){return this.Ia(t).next(function(t){return Vi.Y(new Mi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},uf.prototype.Pa=function(t){return this.Ia(t).next(function(t){return t.highestListenSequenceNumber})},uf.prototype.ga=function(e,n,r){var i=this;return this.Ia(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.X()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Aa(e,t)})},uf.prototype.ya=function(e,n){var r=this;return this.Va(e,n).next(function(){return r.Ia(e).next(function(t){return t.targetCount+=1,r.pa(n,t),r.Aa(e,t)})})},uf.prototype.ba=function(t,e){return this.Va(t,e)},uf.prototype.va=function(e,t){var n=this;return this.Sa(e,t.targetId).next(function(){return cf(e).delete(t.targetId)}).next(function(){return n.Ia(e)}).next(function(t){return qr(0<t.targetCount),--t.targetCount,n.Aa(e,t)})},uf.prototype.Vo=function(r,i,o){var s=this,u=0,a=[];return cf(r).ss(function(t,e){var n=vh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.va(r,n)))}).next(function(){return Ma.$n(a)}).next(function(){return u})},uf.prototype.De=function(t,r){return cf(t).ss(function(t,e){var n=vh(e);r(n)})},uf.prototype.Ia=function(t){return hf(t).get(Xh.key).next(function(t){return qr(null!==t),t})},uf.prototype.Aa=function(t,e){return hf(t).put(Xh.key,e)},uf.prototype.Va=function(t,e){return cf(t).put(yh(this.serializer,e))},uf.prototype.pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},uf.prototype.Da=function(t){return this.Ia(t).next(function(t){return t.targetCount})},uf.prototype.Ca=function(t,i){var e=Yi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return cf(t).ss({range:n,index:Qh.queryTargetsIndexName},function(t,e,n){var r=vh(e);Xi(i,r.target)&&(o=r,n.done())}).next(function(){return o})},uf.prototype.Na=function(n,t,r){var i=this,o=[],s=ff(n);return t.forEach(function(t){var e=ih(t.path);o.push(s.put(new Yh(r,e))),o.push(i.Co.Fa(n,r,t))}),Ma.$n(o)},uf.prototype.$a=function(n,t,r){var i=this,o=ff(n);return Ma.forEach(t,function(t){var e=ih(t.path);return Ma.$n([o.delete([r,e]),i.Co.xa(n,r,t)])})},uf.prototype.Sa=function(t,e){var n=ff(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},uf.prototype.ka=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ff(t),o=Eo();return r.ss({range:n,ns:!0},function(t,e,n){var r=sh(t[1]),i=new $r(r);o=o.add(i)}).next(function(){return o})},uf.prototype.zo=function(t,e){var n=ih(e.path),r=IDBKeyRange.bound([n],[Ni(n)],!1,!0),i=0;return ff(t).ss({index:Yh.documentTargetsIndex,ns:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},uf.prototype.qe=function(t,e){return cf(t).get(e).next(function(t){return t?vh(t):null})},uf);function uf(t,e){this.Co=t,this.serializer=e}function af(t){this.wa=t}function cf(t){return vf.Un(t,Qh.store)}function hf(t){return vf.Un(t,Xh.store)}function ff(t){return vf.Un(t,Yh.store)}var lf,pf="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",df=(o(gf,lf=kc),gf),vf=(yf.Un=function(t,e){if(t instanceof df)return Va.Un(t.Wo,e);throw jr()},yf.prototype.start=function(){var e=this;return this.Ja().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Rr(xr.FAILED_PRECONDITION,pf);return e.Xa(),e.Za(),e.tc(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Ha.Pa(t)})}).then(function(t){e.Ba=new yc(t,e.Oa)}).then(function(){e.qa=!0}).catch(function(t){return e.za&&e.za.close(),Promise.reject(t)})},yf.prototype.ec=function(n){var t=this;return this.Ka=function(e){return m(t,void 0,void 0,function(){return w(this,function(t){return this.Ti?[2,n(e)]:[2]})})},n(this.isPrimary)},yf.prototype.nc=function(n){var t=this;this.za.jn(function(e){return m(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},yf.prototype.sc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ti?[4,this.Ja()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},yf.prototype.Ja=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return wf(e).put(new Zh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ic(e).next(function(t){t||(n.isPrimary=!1,n._n.Ds(function(){return n.Ka(!1)}))})}).next(function(){return n.rc(e)}).next(function(t){return n.isPrimary&&!t?n.oc(e).next(function(){return!1}):!!t&&n.ac(e).next(function(){return!0})})}).catch(function(t){if(Wa(t))return Cr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Cr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n._n.Ds(function(){return n.Ka(t)}),n.isPrimary=t})},yf.prototype.ic=function(t){var e=this;return mf(t).get(Ch.key).next(function(t){return Ma.resolve(e.cc(t))})},yf.prototype.uc=function(t){return wf(t).delete(this.clientId)},yf.prototype.hc=function(){return m(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.lc(this.ja,18e5)?[3,2]:(this.ja=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=yf.Un(t,Zh.store);return r.Zn().next(function(t){var e=o._c(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ma.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Ya)for(n=0,r=e;n<r.length;n++)i=r[n],this.Ya.removeItem(this.fc(i.clientId));t.label=2;case 2:return[2]}})})},yf.prototype.tc=function(){var t=this;this.Wa=this._n.gn("client_metadata_refresh",4e3,function(){return t.Ja().then(function(){return t.hc()}).then(function(){return t.tc()})})},yf.prototype.cc=function(t){return!!t&&t.ownerId===this.clientId},yf.prototype.rc=function(e){var i=this;return this.La?Ma.resolve(!0):mf(e).get(Ch.key).next(function(t){if(null!==t&&i.lc(t.leaseTimestampMs,5e3)&&!i.dc(t.ownerId)){if(i.cc(t)&&i.networkEnabled)return!0;if(!i.cc(t)){if(!t.allowTabSynchronization)throw new Rr(xr.FAILED_PRECONDITION,pf);return!1}}return!(!i.networkEnabled||!i.inForeground)||wf(e).Zn().next(function(t){return void 0===i._c(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Cr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},yf.prototype.Si=function(){return m(this,void 0,void 0,function(){var n=this;return w(this,function(t){switch(t.label){case 0:return this.qa=!1,this.wc(),this.Wa&&(this.Wa.cancel(),this.Wa=null),this.mc(),this.Tc(),[4,this.za.runTransaction("readwrite",[Ch.store,Zh.store],function(t){var e=new df(t,yc.oi);return n.oc(e).next(function(){return n.uc(e)})})];case 1:return t.sent(),this.za.close(),this.Ec(),[2]}})})},yf.prototype._c=function(t,e){var n=this;return t.filter(function(t){return n.lc(t.updateTimeMs,e)&&!n.dc(t.clientId)})},yf.prototype.Vi=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return wf(t).Zn().next(function(t){return e._c(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(yf.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),yf.prototype.Ic=function(t){return gh.Fo(t,this.serializer,this.Sr,this.Co)},yf.prototype.Ac=function(){return this.Ha},yf.prototype.Rc=function(){return this.br},yf.prototype.Pc=function(){return this.Sr},yf.prototype.runTransaction=function(e,n,r){var i=this;Cr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.za.runTransaction(t,tf,function(t){return o=new df(t,i.Ba?i.Ba.next():yc.oi),"readwrite-primary"===n?i.ic(o).next(function(t){return!!t||i.rc(o)}).next(function(t){if(!t)throw Mr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i._n.Ds(function(){return i.Ka(!1)}),new Rr(xr.FAILED_PRECONDITION,Rc);return r(o)}).next(function(t){return i.ac(o).next(function(){return t})}):i.gc(o).next(function(){return r(o)})}).then(function(t){return o.pr(),t})},yf.prototype.gc=function(t){var e=this;return mf(t).get(Ch.key).next(function(t){if(null!==t&&e.lc(t.leaseTimestampMs,5e3)&&!e.dc(t.ownerId)&&!e.cc(t)&&!(e.La||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Rr(xr.FAILED_PRECONDITION,pf)})},yf.prototype.ac=function(t){var e=new Ch(this.clientId,this.allowTabSynchronization,Date.now());return mf(t).put(Ch.key,e)},yf.On=function(){return Va.On()},yf.prototype.oc=function(t){var e=this,n=mf(t);return n.get(Ch.key).next(function(t){return e.cc(t)?(Cr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ch.key)):Ma.resolve()})},yf.prototype.lc=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Mr("Detected an update time that is in the future: "+t+" > "+n),1))},yf.prototype.Xa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qa=function(){t._n.ds(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ja()})},this.document.addEventListener("visibilitychange",this.Qa),this.inForeground="visible"===this.document.visibilityState)},yf.prototype.mc=function(){this.Qa&&(this.document.removeEventListener("visibilitychange",this.Qa),this.Qa=null)},yf.prototype.Za=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ua=function(){e.wc(),e._n.ds(function(){return e.Si()})},this.window.addEventListener("unload",this.Ua))},yf.prototype.Tc=function(){this.Ua&&(this.window.removeEventListener("unload",this.Ua),this.Ua=null)},yf.prototype.dc=function(t){var e;try{var n=null!==(null===(e=this.Ya)||void 0===e?void 0:e.getItem(this.fc(t)));return Cr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Mr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},yf.prototype.wc=function(){if(this.Ya)try{this.Ya.setItem(this.fc(this.clientId),String(Date.now()))}catch(t){Mr("Failed to set zombie client id.",t)}},yf.prototype.Ec=function(){if(this.Ya)try{this.Ya.removeItem(this.fc(this.clientId))}catch(t){}},yf.prototype.fc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},yf);function yf(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this._n=i,this.window=o,this.document=s,this.Oa=a,this.La=c,this.Ba=null,this.qa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ua=null,this.inForeground=!1,this.Qa=null,this.Wa=null,this.ja=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!yf.On())throw new Rr(xr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Co=new bf(this,r),this.Ga=e+"main",this.serializer=new uh(u),this.za=new Va(this.Ga,10,new Ph(this.serializer)),this.Ha=new sf(this.Co,this.serializer),this.Sr=new ef,this.br=new Nh(this.serializer,this.Sr),this.window&&this.window.localStorage?this.Ya=this.window.localStorage:(this.Ya=null,!1===c&&Mr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function gf(t,e){var n=this;return(n=lf.call(this)||this).Wo=t,n.Ma=e,n}function mf(t){return vf.Un(t,Ch.store)}function wf(t){return vf.Un(t,Zh.store)}var bf=(Ef.prototype.Ro=function(t){var n=this.yc(t);return this.db.Ac().Da(t).next(function(e){return n.next(function(t){return e+t})})},Ef.prototype.yc=function(t){var e=0;return this.yo(t,function(t){e++}).next(function(){return e})},Ef.prototype.De=function(t,e){return this.db.Ac().De(t,e)},Ef.prototype.yo=function(t,n){return this.Vc(t,function(t,e){return n(e)})},Ef.prototype.Fa=function(t,e,n){return If(t,n)},Ef.prototype.xa=function(t,e,n){return If(t,n)},Ef.prototype.Vo=function(t,e,n){return this.db.Ac().Vo(t,e,n)},Ef.prototype.Ko=If,Ef.prototype.bc=function(t,e){return r=e,i=!1,Th(n=t).rs(function(t){return wh(n,t,r).next(function(t){return t&&(i=!0),Ma.resolve(!t)})}).next(function(){return i});var n,r,i},Ef.prototype.po=function(r,i){var o=this,s=this.db.Rc().aa(),u=[],a=0;return this.Vc(r,function(e,t){var n;t<=i&&(n=o.bc(r,e).next(function(t){if(!t)return a++,s.Ar(r,e).next(function(){return s.Ir(e),ff(r).delete([0,ih(e.path)])})}),u.push(n))}).next(function(){return Ma.$n(u)}).next(function(){return s.apply(r)}).next(function(){return a})},Ef.prototype.removeTarget=function(t,e){var n=e.nt(t.Ma);return this.db.Ac().ba(t,n)},Ef.prototype.vc=If,Ef.prototype.Vc=function(t,o){var s,e=ff(t),u=yc.oi;return e.ss({index:Yh.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==yc.oi&&o(new $r(sh(s)),u),u=i,s=r):u=yc.oi}).next(function(){u!==yc.oi&&o(new $r(sh(s)),u)})},Ef.prototype.vo=function(t){return this.db.Rc().ha(t)},Ef);function Ef(t,e){this.db=t,this.do=new eh(this,e)}function If(t,e){return ff(t).put((n=t.Ma,new Yh(0,ih(e.path),n)));var n}function Tf(t,e){var n=t.projectId;return t.W||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var _f=(Nf.prototype.Eo=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.bo(t,n.Dc)})},Nf);function Nf(t,e,n){this.persistence=t,this.Sc=e,this.Dc=new oo(Ti),this.Cc=new Ci(Yi,Xi),this.Nc=Vi.min(),this.vr=t.Ic(n),this.Fc=t.Rc(),this.Ha=t.Ac(),this.$c=new Lc(this.Fc,this.vr,this.persistence.Pc()),this.Sc.xc(this.$c)}function Af(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,n,i,o,s,r,u,a=h.batch.keys(),c=f.Fc.aa({ua:!0});return e=f,n=t,o=c,s=(i=h).batch,r=s.keys(),u=Ma.resolve(),r.forEach(function(r){u=u.next(function(){return o.Ar(n,r)}).next(function(t){var e=t,n=i._r.get(r);qr(null!==n),(!e||e.version.L(n)<0)&&(e=s.ar(r,e,i))&&o.Tr(e,i.lr)})}),u.next(function(){return e.vr.Qo(n,s)}).next(function(){return c.apply(t)}).next(function(){return f.vr.Go(t)}).next(function(){return f.$c.$r(t,a)})})}function Sf(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ha.Ra(t)})}function Df(t,s){var h=t,f=s.et,l=h.Dc;return h.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var i=h.Fc.aa({ua:!0});l=h.Dc;var c=[];s.Gt.forEach(function(t,e){var n,r,i,o,s,u=l.get(e);u&&(c.push(h.Ha.$a(a,t.ne,e).next(function(){return h.Ha.Na(a,t.te,e)})),0<(n=t.resumeToken).O()&&(r=u.st(n,f).nt(a.Ma),l=l.rt(e,r),i=u,s=t,qr(0<(o=r).resumeToken.O()),(0===i.resumeToken.O()||3e8<=o.et.J()-i.et.J()||0<s.te.size+s.ee.size+s.ne.size)&&c.push(h.Ha.ba(a,r))))});var t,o=vo,n=Eo();return s.Ht.forEach(function(t,e){n=n.add(t)}),c.push(i.getEntries(a,n).next(function(r){s.Ht.forEach(function(t,e){var n=r.get(t);e instanceof Uu&&e.version.isEqual(Vi.min())?(i.Ir(t,f),o=o.rt(t,e)):null==n||0<e.version.L(n.version)||0===e.version.L(n.version)&&n.hasPendingWrites?(i.Tr(e,f),o=o.rt(t,e)):Cr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.Yt.has(t)&&c.push(h.persistence.Co.vc(a,t))})})),f.isEqual(Vi.min())||(t=h.Ha.Ra(a).next(function(t){return h.Ha.ga(a,a.Ma,f)}),c.push(t)),Ma.$n(c).next(function(){return i.apply(a)}).next(function(){return h.$c.kr(a,o)})}).then(function(t){return h.Dc=l,t})}function Of(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ha.Ca(e,r).next(function(t){return t?(n=t,Ma.resolve(n)):i.Ha.Ea(e).next(function(t){return n=new eo(r,t,0,e.Ma),i.Ha.ya(e,n).next(function(){return n})})})}).then(function(t){var e=i.Dc.get(t.targetId);return(null===e||0<t.et.L(e.et))&&(i.Dc=i.Dc.rt(t.targetId,t),i.Cc.set(r,t.targetId)),t})}function xf(o,s,u){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:n=(e=o).Dc.get(s),r=u?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),u?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Co.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Wa(i=t.sent()))throw i;return Cr("LocalStore","Failed to update sequence numbers for target "+s+": "+i),[3,5];case 5:return e.Dc=e.Dc.remove(s),e.Cc.delete(n.target),[2]}})})}function Rf(t,s,u){var a=t,c=Vi.min(),h=Eo();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Yu(s),(void 0!==(o=(i=t).Cc.get(r))?Ma.resolve(i.Dc.get(o)):i.Ha.Ca(n,r)).next(function(t){if(t)return c=t.lastLimboFreeSnapshotVersion,a.Ha.ka(e,t.targetId).next(function(t){h=t})}).next(function(){return a.Sc.Or(e,s,u?c:Vi.min(),u?h:Eo())}).next(function(t){return{documents:t,kc:h}});var t,n,r,i,o})}function kf(t,e){var n=t,r=n.Ha,i=n.Dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.qe(t,e).next(function(t){return t?t.target:null})})}function Lf(e){return m(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==xr.FAILED_PRECONDITION||e.message!==Rc)throw e;return Cr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Pf(t,e){this.user=e,this.type="OAuth",this.zc={},this.zc.Authorization="Bearer "+t}function Uf(t,e,n,r,i){var o=this;this.zu=t,this.Hu=e,this.os=n,this.Yu={},this.Ju=[],this.Xu=new Map,this.Zu=new Set,this.th=[],this.eh=i,this.eh.nh(function(t){n.ds(function(){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return yl(this)?(Cr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return(e=n).Zu.add(4),[4,al(e)];case 1:return t.sent(),e.sh.set("Unknown"),e.Zu.delete(4),[4,ul(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.sh=new Yf(n,r)}var Cf,Mf,Vf,Ff=(sl.prototype.m=function(){return this.Mc.m()},sl.prototype.Fa=function(t,e){var n=new jf(t,e);this.Mc=this.Mc.add(n),this.Lc=this.Lc.add(n)},sl.prototype.qc=function(t,e){var n=this;t.forEach(function(t){return n.Fa(t,e)})},sl.prototype.xa=function(t,e){this.Uc(new jf(t,e))},sl.prototype.Qc=function(t,e){var n=this;t.forEach(function(t){return n.xa(t,e)})},sl.prototype.Wc=function(t){var e=this,n=new $r(new Qr([])),r=new jf(n,t),i=new jf(n,t+1),o=[];return this.Lc.Nt([r,i],function(t){e.Uc(t),o.push(t.key)}),o},sl.prototype.jc=function(){var e=this;this.Mc.forEach(function(t){return e.Uc(t)})},sl.prototype.Uc=function(t){this.Mc=this.Mc.delete(t),this.Lc=this.Lc.delete(t)},sl.prototype.Kc=function(t){var e=new $r(new Qr([])),n=new jf(e,t),r=new jf(e,t+1),i=Eo();return this.Lc.Nt([n,r],function(t){i=i.add(t.key)}),i},sl.prototype.zo=function(t){var e=new jf(t,0),n=this.Mc.$t(e);return null!==n&&t.isEqual(n.key)},sl),jf=(ol.Oc=function(t,e){return $r.i(t.key,e.key)||Ti(t.Gc,e.Gc)},ol.Bc=function(t,e){return Ti(t.Gc,e.Gc)||$r.i(t.key,e.key)},ol),qf=(il.prototype.getToken=function(){return Promise.resolve(null)},il.prototype.Yc=function(){},il.prototype.Jc=function(t){(this.Hc=t)(pc.UNAUTHENTICATED)},il.prototype.Xc=function(){this.Hc=null},il),Bf=(rl.prototype.getToken=function(){var e=this,n=this.eu,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.eu!==n?(Cr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(qr("string"==typeof t.accessToken),new Pf(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},rl.prototype.Yc=function(){this.forceRefresh=!0},rl.prototype.Jc=function(t){this.Hc=t,this.tu&&t(this.currentUser)},rl.prototype.Xc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Zc),this.Zc=null,this.Hc=null},rl.prototype.nu=function(){var t=this.auth&&this.auth.getUid();return qr(null===t||"string"==typeof t),new pc(t)},rl),zf=(Object.defineProperty(nl.prototype,"zc",{get:function(){var t={"X-Goog-AuthUser":this.iu},e=this.su.auth.ru([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),nl),Gf=(el.prototype.getToken=function(){return Promise.resolve(new zf(this.su,this.iu))},el.prototype.Jc=function(t){t(pc.ei)},el.prototype.Xc=function(){},el.prototype.Yc=function(){},el),Hf=(tl.prototype.lu=function(){return 1===this.state||2===this.state||4===this.state},tl.prototype._u=function(){return 2===this.state},tl.prototype.start=function(){3!==this.state?this.auth():this.fu()},tl.prototype.stop=function(){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.lu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},tl.prototype.du=function(){this.state=0,this.gs.reset()},tl.prototype.wu=function(){var t=this;this._u()&&null===this.hu&&(this.hu=this._n.gn(this.ou,6e4,function(){return t.mu()}))},tl.prototype.Tu=function(t){this.Eu(),this.stream.send(t)},tl.prototype.mu=function(){return m(this,void 0,void 0,function(){return w(this,function(t){return this._u()?[2,this.close(0)]:[2]})})},tl.prototype.Eu=function(){this.hu&&(this.hu.cancel(),this.hu=null)},tl.prototype.close=function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Eu(),this.gs.cancel(),this.uu++,3!==e?this.gs.reset():n&&n.code===xr.RESOURCE_EXHAUSTED?(Mr(n.toString()),Mr("Using maximum backoff delay to prevent overloading the backend."),this.gs.An()):n&&n.code===xr.UNAUTHENTICATED&&this.cu.Yc(),null!==this.stream&&(this.Iu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Au(n)];case 1:return t.sent(),[2]}})})},tl.prototype.Iu=function(){},tl.prototype.auth=function(){var n=this;this.state=1;var t=this.Ru(this.uu),e=this.uu;this.cu.getToken().then(function(t){n.uu===e&&n.Pu(t)},function(e){t(function(){var t=new Rr(xr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.gu(t)})})},tl.prototype.Pu=function(t){var e=this,n=this.Ru(this.uu);this.stream=this.yu(t),this.stream.Vu(function(){n(function(){return e.state=2,e.listener.Vu()})}),this.stream.Au(function(t){n(function(){return e.gu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},tl.prototype.fu=function(){var t=this;this.state=4,this.gs.Rn(function(){return m(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},tl.prototype.gu=function(t){return Cr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},tl.prototype.Ru=function(e){var n=this;return function(t){n._n.ds(function(){return n.uu===e?t():(Cr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},tl),Wf=(o(Zf,Vf=Hf),Zf.prototype.yu=function(t){return this.au.pu("Listen",t)},Zf.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:jr(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Ue?(qr(void 0===i||"string"==typeof i),Ai.fromBase64String(i||"")):(qr(void 0===i||i instanceof Uint8Array),Ai.fromUint8Array(i||new Uint8Array))),c=e.targetChange.cause,h=c&&(r=void 0===(n=c).code?xr.UNKNOWN:io(n.code),new Rr(r,n.message||"")),f=new xo(s,u,a,h||null)}else if("documentChange"in e){e.documentChange;var l=e.documentChange;l.document,l.document.name,l.document.updateTime;var p=ms(t,l.document.name),d=ds(l.document.updateTime),v=new _u({mapValue:{fields:l.document.fields}}),y=new Pu(p,d,v,{}),g=l.targetIds||[],m=l.removedTargetIds||[];f=new Do(g,m,y.key,y)}else if("documentDelete"in e){e.documentDelete;var w=e.documentDelete;w.document;var b=ms(t,w.document),E=w.readTime?ds(w.readTime):Vi.min(),I=new Uu(b,E),T=w.removedTargetIds||[];f=new Do([],T,I.key,I)}else if("documentRemove"in e){e.documentRemove;var _=e.documentRemove;_.document;var N=ms(t,_.document),A=_.removedTargetIds||[];f=new Do([],A,N,null)}else{if(!("filter"in e))return jr();e.filter;var S=e.filter;S.targetId;var D=S.count||0,O=new Ji(D),x=S.targetId;f=new Oo(x,O)}return f}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Vi.min();var e=t.targetChange;return(!e.targetIds||!e.targetIds.length)&&e.readTime?ds(e.readTime):Vi.min()}(t);return this.listener.bu(e,n)},Zf.prototype.vu=function(t){var e,n,r,i,o={};o.database=Es(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=$i(i)?{documents:As(e,i)}:{query:Ss(e,i)}).targetId=n.targetId,0<n.resumeToken.O()&&(r.resumeToken=ps(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.tt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return jr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.Tu(o)},Zf.prototype.Su=function(t){var e={};e.database=Es(this.serializer),e.removeTarget=t,this.Tu(e)},Zf),Kf=(o(Jf,Mf=Hf),Object.defineProperty(Jf.prototype,"Cu",{get:function(){return this.Du},enumerable:!1,configurable:!0}),Jf.prototype.start=function(){this.Du=!1,this.lastStreamToken=void 0,Mf.prototype.start.call(this)},Jf.prototype.Iu=function(){this.Du&&this.Nu([])},Jf.prototype.yu=function(t){return this.au.pu("Write",t)},Jf.prototype.onMessage=function(t){if(qr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Du){this.gs.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(qr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?ds(t.updateTime):ds(e);n.isEqual(Vi.min())&&(n=ds(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new tu(n,r)}(t,i)})):[]),n=ds(t.commitTime);return this.listener.Fu(n,e)}var r,i;return qr(!t.writeResults||0===t.writeResults.length),this.Du=!0,this.listener.$u()},Jf.prototype.xu=function(){var t={};t.database=Es(this.serializer),this.Tu(t)},Jf.prototype.Nu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return _s(e.serializer,t)})};this.Tu(n)},Jf),Qf=(o($f,Cf=function(){}),$f.prototype.Mu=function(){if(this.ku)throw new Rr(xr.FAILED_PRECONDITION,"The client has already been terminated.")},$f.prototype.Ou=function(e,n,r){var i=this;return this.Mu(),this.credentials.getToken().then(function(t){return i.au.Ou(e,n,r,t)}).catch(function(t){throw t.code===xr.UNAUTHENTICATED&&i.credentials.Yc(),t})},$f.prototype.Lu=function(e,n,r){var i=this;return this.Mu(),this.credentials.getToken().then(function(t){return i.au.Lu(e,n,r,t)}).catch(function(t){throw t.code===xr.UNAUTHENTICATED&&i.credentials.Yc(),t})},$f.prototype.terminate=function(){this.ku=!1},$f),Yf=(Xf.prototype.Qu=function(){var t=this;0===this.Bu&&(this.Wu("Unknown"),this.qu=this.os.gn("online_state_timeout",1e4,function(){return t.qu=null,t.ju("Backend didn't respond within 10 seconds."),t.Wu("Offline"),Promise.resolve()}))},Xf.prototype.Ku=function(t){"Online"===this.state?this.Wu("Unknown"):(this.Bu++,1<=this.Bu&&(this.Gu(),this.ju("Connection failed 1 times. Most recent error: "+t.toString()),this.Wu("Offline")))},Xf.prototype.set=function(t){this.Gu(),this.Bu=0,"Online"===t&&(this.Uu=!1),this.Wu(t)},Xf.prototype.Wu=function(t){t!==this.state&&(this.state=t,this.fi(t))},Xf.prototype.ju=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Uu?(Mr(e),this.Uu=!1):Cr("OnlineStateTracker",e)},Xf.prototype.Gu=function(){null!==this.qu&&(this.qu.cancel(),this.qu=null)},Xf);function Xf(t,e){this.os=t,this.fi=e,this.state="Unknown",this.Bu=0,this.qu=null,this.Uu=!0}function $f(t,e,n){var r=this;return(r=Cf.call(this)||this).credentials=t,r.au=e,r.serializer=n,r.ku=!1,r}function Jf(t,e,n,r,i){var o=this;return(o=Mf.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Du=!1,o}function Zf(t,e,n,r,i){var o=this;return(o=Vf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function tl(t,e,n,r,i,o){this._n=t,this.ou=n,this.au=r,this.cu=i,this.listener=o,this.state=0,this.uu=0,this.hu=null,this.stream=null,this.gs=new Ca(t,e)}function el(t,e){this.su=t,this.iu=e}function nl(t,e){this.su=t,this.iu=e,this.type="FirstParty",this.user=pc.ei}function rl(t){var e=this;this.Zc=null,this.currentUser=pc.UNAUTHENTICATED,this.tu=!1,this.eu=0,this.Hc=null,this.forceRefresh=!1,this.Zc=function(){e.eu++,e.currentUser=e.nu(),e.tu=!0,e.Hc&&e.Hc(e.currentUser)},this.eu=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Zc):(this.Zc(null),t.get().then(function(t){e.auth=t,e.Zc&&e.auth.addAuthTokenListener(e.Zc)},function(){}))}function il(){this.Hc=null}function ol(t,e){this.key=t,this.Gc=e}function sl(){this.Mc=new lo(jf.Oc),this.Lc=new lo(jf.Bc)}function ul(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:if(!yl(r))return[3,4];e=0,n=r.th,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function al(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:e=0,n=r.th,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function cl(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return e=n,Cr("RemoteStore","RemoteStore shutting down."),e.Zu.add(5),[4,al(e)];case 1:return t.sent(),e.eh.Si(),e.sh.set("Unknown"),[2]}})})}function hl(t,e){var n=t;n.Xu.has(e.targetId)||(n.Xu.set(e.targetId,e),vl(n)?dl(n):Nl(n)._u()&&ll(n,e))}function fl(t,e){var n=t,r=Nl(n);n.Xu.delete(e),r._u()&&pl(n,e),0===n.Xu.size&&(r._u()?r.wu():yl(n)&&n.sh.set("Unknown"))}function ll(t,e){t.ih.Ee(e.targetId),Nl(t).vu(e)}function pl(t,e){t.ih.Ee(e),Nl(t).Su(e)}function dl(e){e.ih=new ko({Be:function(t){return e.Yu.Be(t)},qe:function(t){return e.Xu.get(t)||null}}),Nl(e).start(),e.sh.Qu()}function vl(t){return yl(t)&&!Nl(t).lu()&&0<t.Xu.size}function yl(t){return 0===t.Zu.size}function gl(t){t.ih=void 0}function ml(u,a,c){return m(this,void 0,void 0,function(){var n,o,s;return w(this,function(t){switch(t.label){case 0:if(u.sh.set("Online"),!(a instanceof xo&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Xu.has(i)?[4,o.Yu.rh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Xu.delete(i),o.ih.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(u,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Cr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,wl(u,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Do?u.ih.pe(a):a instanceof Oo?u.ih.$e(a):u.ih.Se(a),c.isEqual(Vi.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Sf(u.zu)];case 8:return o=t.sent(),0<=c.L(o)?[4,(i=c,(e=(r=u).ih.Me(i)).Gt.forEach(function(t,e){var n;0<t.resumeToken.O()&&((n=r.Xu.get(e))&&r.Xu.set(e,n.st(t.resumeToken,i)))}),e.zt.forEach(function(t){var e,n=r.Xu.get(t);n&&(r.Xu.set(t,n.st(Ai.B,n.et)),pl(r,t),e=new eo(n.target,t,1,n.sequenceNumber),ll(r,e))}),r.Yu.oh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Cr("RemoteStore","Failed to raise snapshot:",s=t.sent()),[4,wl(u,s)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function wl(n,r,i){return m(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!Wa(r))throw r;return n.Zu.add(1),[4,al(n)];case 1:return t.sent(),n.sh.set("Offline"),i=i||function(){return Sf(n.zu)},n.os.Ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Cr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Zu.delete(1),[4,ul(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function bl(e,n){return n().catch(function(t){return wl(e,t,n)})}function El(c){return m(this,void 0,void 0,function(){var i,o,s,u,a;return w(this,function(t){switch(t.label){case 0:o=Al(i=c),s=0<i.Ju.length?i.Ju[i.Ju.length-1].batchId:-1,t.label=1;case 1:if(!(yl(i)&&i.Ju.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.zu,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.vr.Lo(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Ju.length&&o.wu(),[3,7]):(s=u.batchId,function(t,e){t.Ju.push(e);var n=Al(t);n._u()&&n.Cu&&n.Nu(e.mutations)}(i,u),[3,6]);case 4:return a=t.sent(),[4,wl(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Il(i)&&Tl(i),[2]}var e,n,r})})}function Il(t){return yl(t)&&!Al(t).lu()&&0<t.Ju.length}function Tl(t){Al(t).start()}function _l(n,r){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return e=n,r?(e.Zu.delete(2),[4,ul(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Zu.add(2),[4,al(e)]);case 3:t.sent(),e.sh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Nl(n){var t,e,r,i,o=this;return n.hh||(n.hh=(t=n.Hu,e=n.os,r={Vu:function(n){return m(this,void 0,void 0,function(){return w(this,function(t){return n.Xu.forEach(function(t,e){ll(n,t)}),[2]})})}.bind(null,n),Au:function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){return gl(e),vl(e)?(e.sh.Ku(n),dl(e)):e.sh.set("Unknown"),[2]})})}.bind(null,n),bu:ml.bind(null,n)},(i=t).Mu(),new Wf(e,i.au,i.credentials,i.serializer,r)),n.th.push(function(e){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(n.hh.du(),vl(n)?dl(n):n.sh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.hh.stop()];case 2:t.sent(),gl(n),t.label=3;case 3:return[2]}})})})),n.hh}function Al(n){var t,e,r,i,o=this;return n.lh||(n.lh=(t=n.Hu,e=n.os,r={Vu:function(e){return m(this,void 0,void 0,function(){return w(this,function(t){return Al(e).xu(),[2]})})}.bind(null,n),Au:function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return n&&Al(e).Cu?[4,function(r,i){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return ro(n=i.code)&&n!==xr.ABORTED?(e=r.Ju.shift(),Al(r).du(),[4,bl(r,function(){return r.Yu.uh(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,El(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Il(e)&&Tl(e),[2]}})})}.bind(null,n),$u:function(o){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){for(e=Al(o),n=0,r=o.Ju;n<r.length;n++)i=r[n],e.Nu(i.mutations);return[2]})})}.bind(null,n),Fu:function(r,i,o){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return e=r.Ju.shift(),n=Oc.from(e,i,o),[4,bl(r,function(){return r.Yu.ah(n)})];case 1:return t.sent(),[4,El(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},(i=t).Mu(),new Kf(e,i.au,i.credentials,i.serializer,r)),n.th.push(function(e){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(n.lh.du(),[4,El(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.lh.stop()];case 3:t.sent(),0<n.Ju.length&&(Cr("RemoteStore","Stopping write stream with "+n.Ju.length+" pending writes"),n.Ju=[]),t.label=4;case 4:return[2]}})})})),n.lh}var Sl=function(t){this.key=t},Dl=function(t){this.key=t},Ol=(Object.defineProperty(Pl.prototype,"Th",{get:function(){return this._h},enumerable:!1,configurable:!0}),Pl.prototype.Eh=function(t,e){var u=this,a=e?e.Ih:new _o,c=e?e.mh:this.mh,h=e?e.Qt:this.Qt,f=c,l=!1,p=zu(this.query)&&c.size===this.query.limit?c.last():null,d=Gu(this.query)&&c.size===this.query.limit?c.first():null;if(t.ut(function(t,e){var n=c.get(t),r=(r=e instanceof Pu?e:null)&&(na(u.query,r)?r:null),i=!!n&&u.Qt.has(n.key),o=!!r&&(r.Ye||u.Qt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Ah(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.wh(r,p)||d&&u.wh(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(h=r?(f=f.add(r),o?h.add(t):h.delete(t)):(f=f.delete(t),h.delete(t)))}),zu(this.query)||Gu(this.query))for(;f.size>this.query.limit;){var n=zu(this.query)?f.last():f.first(),f=f.delete(n.key),h=h.delete(n.key);a.track({type:1,doc:n})}return{mh:f,Ih:a,Rh:l,Qt:h}},Pl.prototype.Ah=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},Pl.prototype.gr=function(t,e,n){var o=this,r=this.mh;this.mh=t.mh,this.Qt=t.Qt;var i=t.Ih.qt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.wh(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jr()}}var r,i}),this.Ph(n);var s=e?this.gh():[],u=0===this.dh.size&&this.Zt?1:0,a=u!==this.fh;return this.fh=u,0!==i.length||a?{snapshot:new No(this.query,t.mh,r,i,t.Qt,0==u,a,!1),yh:s}:{yh:s}},Pl.prototype.Us=function(t){return this.Zt&&"Offline"===t?(this.Zt=!1,this.gr({mh:this.mh,Ih:new _o,Qt:this.Qt,Rh:!1},!1)):{yh:[]}},Pl.prototype.Vh=function(t){return!this._h.has(t)&&!!this.mh.has(t)&&!this.mh.get(t).Ye},Pl.prototype.Ph=function(t){var e=this;t&&(t.te.forEach(function(t){return e._h=e._h.add(t)}),t.ee.forEach(function(t){}),t.ne.forEach(function(t){return e._h=e._h.delete(t)}),this.Zt=t.Zt)},Pl.prototype.gh=function(){var e=this;if(!this.Zt)return[];var n=this.dh;this.dh=Eo(),this.mh.forEach(function(t){e.Vh(t.key)&&(e.dh=e.dh.add(t.key))});var r=[];return n.forEach(function(t){e.dh.has(t)||r.push(new Dl(t))}),this.dh.forEach(function(t){n.has(t)||r.push(new Sl(t))}),r},Pl.prototype.ph=function(t){this._h=t.kc,this.dh=Eo();var e=this.Eh(t.documents);return this.gr(e,!0)},Pl.prototype.bh=function(){return No.Kt(this.query,this.mh,this.Qt,0===this.fh)},Pl),xl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Rl=function(t){this.key=t,this.Sh=!1},kl=(Object.defineProperty(Ll.prototype,"jh",{get:function(){return!0===this.Wh},enumerable:!1,configurable:!0}),Ll);function Ll(t,e,n,r,i,o){this.zu=t,this.Dh=e,this.Ch=n,this.Nh=r,this.currentUser=i,this.Fh=o,this.$h={},this.xh=new Ci(ta,Zu),this.kh=new Map,this.Mh=[],this.Oh=new oo($r.i),this.Lh=new Map,this.Bh=new Ff,this.qh={},this.Uh=new Map,this.Qh=of.Ta(),this.onlineState="Unknown",this.Wh=void 0}function Pl(t,e){this.query=t,this._h=e,this.fh=null,this.Zt=!1,this.dh=Eo(),this.Qt=Eo(),this.wh=ra(t),this.mh=new To(this.wh)}function Ul(u,a,c,h){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return u.Kh=function(t,e,n){return function(i,o,s,u){return m(this,void 0,void 0,function(){var n,e,r;return w(this,function(t){switch(t.label){case 0:return(n=o.view.Eh(s)).Rh?[4,Rf(i.zu,o.query,!1).then(function(t){var e=t.documents;return o.view.Eh(e,n)})]:[3,2];case 1:n=t.sent(),t.label=2;case 2:return e=u&&u.Gt.get(o.targetId),r=o.view.gr(n,i.jh,e),[2,(zl(i,o.targetId,r.yh),r.snapshot)]}})})}(u,t,e,n)},[4,Rf(u.zu,a,!0)];case 1:return e=t.sent(),n=new Ol(a,e.kc),r=n.Eh(e.documents),i=So.Xt(c,h&&"Offline"!==u.onlineState),o=n.gr(r,u.jh,i),zl(u,c,o.yh),s=new xl(a,c,n),[2,(u.xh.set(a,s),u.kh.has(c)?u.kh.get(c).push(a):u.kh.set(c,[a]),o.snapshot)]}})})}function Cl(n,i){return m(this,void 0,void 0,function(){var r,e;return w(this,function(t){switch(t.label){case 0:r=n,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Df(r.zu,i)];case 2:return e=t.sent(),i.Gt.forEach(function(t,e){var n=r.Lh.get(e);n&&(qr(t.te.size+t.ee.size+t.ne.size<=1),0<t.te.size?n.Sh=!0:0<t.ee.size?qr(n.Sh):0<t.ne.size&&(qr(n.Sh),n.Sh=!1))}),[4,Hl(r,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Lf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Ml(t,r,e){var i,n=t;(n.jh&&0===e||!n.jh&&1===e)&&(i=[],n.xh.forEach(function(t,e){var n=e.view.Us(r);n.snapshot&&i.push(n.snapshot)}),function(t,i){var e=t;e.onlineState=i;var o=!1;e.Ls.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Us(i)&&(o=!0)}),o&&fc(e)}(n.Ch,r),i.length&&n.$h.bu(i),n.onlineState=r,n.jh&&n.Nh.ji(r))}function Vl(s,u,a){return m(this,void 0,void 0,function(){var n,o;return w(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.zu,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.vr.Mo(e,r).next(function(t){return qr(null!==t),n=t.keys(),i.vr.Qo(e,t)}).next(function(){return i.vr.Go(e)}).next(function(){return i.$c.$r(e,n)})}))];case 2:return o=t.sent(),jl(n,u,a),Fl(n,u),n.Nh.xi(u,"rejected",a),[4,Hl(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Lf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function Fl(t,e){(t.Uh.get(e)||[]).forEach(function(t){t.resolve()}),t.Uh.delete(e)}function jl(t,e,n){var r,i=t,o=i.qh[i.currentUser.Zs()];o&&((r=o.get(e))&&(n?r.reject(n):r.resolve(),o=o.remove(e)),i.qh[i.currentUser.Zs()]=o)}function ql(e,t,n){void 0===n&&(n=null),e.Nh.Li(t);for(var r=0,i=e.kh.get(t);r<i.length;r++){var o=i[r];e.xh.delete(o),n&&e.$h.Gh(o,n)}e.kh.delete(t),e.jh&&e.Bh.Wc(t).forEach(function(t){e.Bh.zo(t)||Bl(e,t)})}function Bl(t,e){var n=t.Oh.get(e);null!==n&&(fl(t.Dh,n),t.Oh=t.Oh.remove(e),t.Lh.delete(n),Gl(t))}function zl(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof Sl?(t.Bh.Fa(u.key,e),r=t,i=void 0,i=u.key,r.Oh.get(i)||(Cr("SyncEngine","New document in limbo: "+i),r.Mh.push(i),Gl(r))):u instanceof Dl?(Cr("SyncEngine","Document no longer in limbo: "+u.key),t.Bh.xa(u.key,e),t.Bh.zo(u.key)||Bl(t,u.key)):jr()}}function Gl(t){for(;0<t.Mh.length&&t.Oh.size<t.Fh;){var e=t.Mh.shift(),n=t.Qh.next();t.Lh.set(n,new Rl(e)),t.Oh=t.Oh.rt(e,n),hl(t.Dh,new eo(Yu(Bu(e.path)),n,2,yc.oi))}}function Hl(n,s,u){return m(this,void 0,void 0,function(){var r,i,o,e;return w(this,function(t){switch(t.label){case 0:return i=[],o=[],e=[],(r=n).xh.m()?[3,3]:(r.xh.forEach(function(t,n){e.push(r.Kh(n,s,u).then(function(t){var e;t&&(r.jh&&r.Nh.Ui(n.targetId,t.fromCache?"not-current":"current"),i.push(t),e=Pc.Gr(n.targetId,t),o.push(e))}))}),[4,Promise.all(e)]);case 1:return t.sent(),r.$h.bu(i),[4,function(h,f){return m(this,void 0,void 0,function(){var r,e,n,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:r=h,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ma.forEach(f,function(e){return Ma.forEach(e.jr,function(t){return r.persistence.Co.Fa(n,e.targetId,t)}).next(function(){return Ma.forEach(e.Kr,function(t){return r.persistence.Co.xa(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Wa(e=t.sent()))throw e;return Cr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=f;n<i.length;n++)o=i[n],s=o.targetId,o.fromCache||(u=r.Dc.get(s),a=u.et,c=u.it(a),r.Dc=r.Dc.rt(s,c));return[2]}})})}(r.zu,o)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Wl(i,o){return m(this,void 0,void 0,function(){var n,r;return w(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Cr("SyncEngine","User change. New user:",o.Zs()),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,m,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).vr,m=e.$c,[4,e.persistence.runTransaction("Handle user change","readonly",function(y){var g;return e.vr.qo(y).next(function(t){return g=t,n=e.persistence.Ic(o),m=new Lc(e.Fc,n,e.persistence.Pc()),n.qo(y)}).next(function(t){for(var e=[],n=[],r=Eo(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var v=d[p];r=r.add(v.key)}}return m.$r(y,r).next(function(t){return{zh:t,Hh:e,Yh:n}})})})];case 1:return r=t.sent(),[2,(e.vr=n,e.$c=m,e.Sc.xc(e.$c),r)]}})})}(n.zu,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Uh.forEach(function(t){t.forEach(function(t){t.reject(new Rr(xr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Uh.clear(),n.Nh.Wi(o,r.Hh,r.Yh),[4,Hl(n,r.zh)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Kl(u,a,c,h){return m(this,void 0,void 0,function(){var o,s;return w(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).zu,n=a,i=(r=e).vr,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Oo(e,n).next(function(t){return t?r.$c.$r(e,t):Ma.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,El(o.Dh)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(jl(o,a,h||null),o.zu.vr.jo(a)):jr(),t.label=4;case 4:return[4,Hl(o,s)];case 5:return t.sent(),[3,7];case 6:Cr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Ql(h,f){return m(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:return Jl(r=h),Zl(r),!0!==f||!0===r.Wh?[3,3]:(e=r.Nh.Di(),[4,Yl(r,e.A())]);case 1:return i=t.sent(),r.Wh=!0,[4,_l(r.Dh,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],hl(r.Dh,u);return[3,7];case 3:return!1!==f||!1===r.Wh?[3,7]:(a=[],c=Promise.resolve(),r.kh.forEach(function(t,e){r.Nh.Bi(e)?a.push(e):c=c.then(function(){return ql(r,e),xf(r.zu,e,!0)}),fl(r.Dh,e)}),[4,c]);case 4:return t.sent(),[4,Yl(r,a)];case 5:return t.sent(),(n=r).Lh.forEach(function(t,e){fl(n.Dh,e)}),n.Bh.jc(),n.Lh=new Map,n.Oh=new oo($r.i),r.Wh=!1,[4,_l(r.Dh,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Yl(v,y){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=v,n=[],r=[],i=0,o=y,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.kh.get(s))&&0!==a.length?[4,Of(e.zu,Yu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],l=e.xh.get(f),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,Rf((e=i).zu,o.query,!0)];case 1:return n=t.sent(),r=o.view.ph(n),[2,(e.jh&&zl(e,o.targetId,r.yh),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,kf(e.zu,s)];case 8:return d=t.sent(),[4,Of(e.zu,d)];case 9:return u=t.sent(),[4,Ul(e,Xl(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.$h.bu(r),n)]}})})}function Xl(t){return qu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function $l(s,u,a,c){return m(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=s).Wh?(Cr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.kh.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=n.zu,e=r.Fc,r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.ia(t,r.Nc)}).then(function(t){var e=t.ra,n=t.readTime;return r.Nc=n,e}))];case 3:return i=t.sent(),o=Ao.Jt(u,"current"===a),[4,Hl(n,i,o)];case 4:return t.sent(),[3,8];case 5:return[4,xf(n.zu,u,!0)];case 6:return t.sent(),ql(n,u,c),[3,8];case 7:jr(),t.label=8;case 8:return[2]}var r,e})})}function Jl(t){var e=t;return e.Dh.Yu.oh=Cl.bind(null,e),e.Dh.Yu.Be=function(t,e){var n=t,r=n.Lh.get(e);if(r&&r.Sh)return Eo().add(r.key);var i=Eo(),o=n.kh.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++)var a=u[s],c=n.xh.get(a),i=i.xt(c.view.Th);return i}.bind(null,e),e.Dh.Yu.rh=function(u,a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return(e=u).Nh.Ui(a,"rejected",c),n=e.Lh.get(a),(r=n&&n.key)?(i=(i=new oo($r.i)).rt(r,new Uu(r,Vi.min())),o=Eo().add(r),s=new Ao(Vi.min(),new Map,new lo(Ti),i,o),[4,Cl(e,s)]):[3,2];case 1:return t.sent(),e.Oh=e.Oh.remove(r),e.Lh.delete(a),Gl(e),[3,4];case 2:return[4,xf(e.zu,a,!1).then(function(){return ql(e,a,c)}).catch(Lf)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.$h.bu=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Ls.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Os=s}}r&&fc(n)}.bind(null,e.Ch),e.$h.Gh=function(t,e,n){var r=t,i=r.Ls.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Ls.delete(e)}.bind(null,e.Ch),e}function Zl(t){var e=t;return e.Dh.Yu.ah=function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Af(e.zu,o)];case 2:return r=t.sent(),jl(e,n,null),Fl(e,n),e.Nh.xi(n,"acknowledged"),[4,Hl(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Lf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,e),e.Dh.Yu.uh=Vl.bind(null,e),e}var tp,ep=(sp.prototype.xc=function(t){this.Jh=t},sp.prototype.Or=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.rn.length||1===r.rn.length&&r.rn[0].field.p())||i.isEqual(Vi.min())?this.Xh(e,r):this.Jh.$r(e,o).next(function(t){var n=s.Zh(r,t);return(zu(r)||Gu(r))&&s.Rh(r.on,n,o,i)?s.Xh(e,r):(Ur()<=l.DEBUG&&Cr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ea(r)),s.Jh.Or(e,r,i).next(function(e){return n.forEach(function(t){e=e.rt(t.key,t)}),e}))})},sp.prototype.Zh=function(n,t){var r=new lo(ra(n));return t.forEach(function(t,e){e instanceof Pu&&na(n,e)&&(r=r.add(e))}),r},sp.prototype.Rh=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.L(r))},sp.prototype.Xh=function(t,e){return Ur()<=l.DEBUG&&Cr("IndexFreeQueryEngine","Using full collection scan to execute query:",ea(e)),this.Jh.Or(t,e,Vi.min())},sp),np=(op.prototype.$o=function(t){return Ma.resolve(0===this.vr.length)},op.prototype.xo=function(t,e,n,r){var i=this.tl;this.tl++,0<this.vr.length&&this.vr[this.vr.length-1];var o=new Dc(i,e,n,r);this.vr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.el=this.el.add(new jf(a.key,i)),this.Sr.ko(t,a.key.path.h())}return Ma.resolve(o)},op.prototype.Mo=function(t,e){return Ma.resolve(this.nl(e))},op.prototype.Lo=function(t,e){var n=e+1,r=this.sl(n),i=r<0?0:r;return Ma.resolve(this.vr.length>i?this.vr[i]:null)},op.prototype.Bo=function(){return Ma.resolve(0===this.vr.length?-1:this.tl-1)},op.prototype.qo=function(t){return Ma.resolve(this.vr.slice())},op.prototype.Cr=function(t,e){var n=this,r=new jf(e,0),i=new jf(e,Number.POSITIVE_INFINITY),o=[];return this.el.Nt([r,i],function(t){var e=n.nl(t.Gc);o.push(e)}),Ma.resolve(o)},op.prototype.Mr=function(t,e){var r=this,i=new lo(Ti);return e.forEach(function(t){var e=new jf(t,0),n=new jf(t,Number.POSITIVE_INFINITY);r.el.Nt([e,n],function(t){i=i.add(t.Gc)})}),Ma.resolve(this.il(i))},op.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;$r.F(i)||(i=i.child(""));var o=new jf(new $r(i),0),s=new lo(Ti);return this.el.Ft(function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.Gc)),!0)},o),Ma.resolve(this.il(s))},op.prototype.il=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.nl(t);null!==e&&r.push(e)}),r},op.prototype.Qo=function(n,r){var i=this;qr(0===this.rl(r.batchId,"removed")),this.vr.shift();var o=this.el;return Ma.forEach(r.mutations,function(t){var e=new jf(t.key,r.batchId);return o=o.delete(e),i.Co.Ko(n,t.key)}).next(function(){i.el=o})},op.prototype.jo=function(t){},op.prototype.zo=function(t,e){var n=new jf(e,0),r=this.el.$t(n);return Ma.resolve(e.isEqual(r&&r.key))},op.prototype.Go=function(t){return this.vr.length,Ma.resolve()},op.prototype.rl=function(t,e){return this.sl(t)},op.prototype.sl=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},op.prototype.nl=function(t){var e=this.sl(t);return e<0||e>=this.vr.length?null:this.vr[e]},op),rp=(ip.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ol(e);return this.docs=this.docs.rt(r,{Zo:e,size:s,readTime:n}),this.size+=s-o,this.Sr.ko(t,r.path.h())},ip.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},ip.prototype.Ar=function(t,e){var n=this.docs.get(e);return Ma.resolve(n?n.Zo:null)},ip.prototype.getEntries=function(t,e){var n=this,r=vo;return e.forEach(function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)}),Ma.resolve(r)},ip.prototype.Or=function(t,e,n){for(var r=mo,i=new $r(e.path.child("")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,c=a.Zo,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof Pu&&na(e,c)&&(r=r.rt(c.key,c))}return Ma.resolve(r)},ip.prototype.al=function(t,e){return Ma.forEach(this.docs,function(t){return e(t)})},ip.prototype.aa=function(t){return new ip.ca(this)},ip.prototype.ha=function(t){return Ma.resolve(this.size)},ip);function ip(t,e){this.Sr=t,this.ol=e,this.docs=new oo($r.i),this.size=0}function op(t,e){this.Sr=t,this.Co=e,this.vr=[],this.tl=1,this.el=new lo(jf.Oc)}function sp(){}function up(t){var e=this;return(e=tp.call(this)||this).la=t,e}rp.ca=(o(up,tp=xc),up.prototype.gr=function(n){var r=this,i=[];return this.dr.forEach(function(t,e){e?i.push(r.la.Tr(n,e,r.readTime)):r.la.Ir(t)}),Ma.$n(i)},up.prototype.Rr=function(t,e){return this.la.Ar(t,e)},up.prototype.Pr=function(t,e){return this.la.getEntries(t,e)},up);var ap,cp,hp=(Sp.prototype.De=function(t,n){return this.cl.forEach(function(t,e){return n(e)}),Ma.resolve()},Sp.prototype.Ra=function(t){return Ma.resolve(this.lastRemoteSnapshotVersion)},Sp.prototype.Pa=function(t){return Ma.resolve(this.ul)},Sp.prototype.Ea=function(t){return this.highestTargetId=this.ll.next(),Ma.resolve(this.highestTargetId)},Sp.prototype.ga=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ul&&(this.ul=e),Ma.resolve()},Sp.prototype.Va=function(t){this.cl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ll=new of(e),this.highestTargetId=e),t.sequenceNumber>this.ul&&(this.ul=t.sequenceNumber)},Sp.prototype.ya=function(t,e){return this.Va(e),this.targetCount+=1,Ma.resolve()},Sp.prototype.ba=function(t,e){return this.Va(e),Ma.resolve()},Sp.prototype.va=function(t,e){return this.cl.delete(e.target),this.hl.Wc(e.targetId),--this.targetCount,Ma.resolve()},Sp.prototype.Vo=function(n,r,i){var o=this,s=0,u=[];return this.cl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.cl.delete(t),u.push(o.Sa(n,e.targetId)),s++)}),Ma.$n(u).next(function(){return s})},Sp.prototype.Da=function(t){return Ma.resolve(this.targetCount)},Sp.prototype.Ca=function(t,e){var n=this.cl.get(e)||null;return Ma.resolve(n)},Sp.prototype.Na=function(t,e,n){return this.hl.qc(e,n),Ma.resolve()},Sp.prototype.$a=function(e,t,n){this.hl.Qc(t,n);var r=this.persistence.Co,i=[];return r&&t.forEach(function(t){i.push(r.Ko(e,t))}),Ma.$n(i)},Sp.prototype.Sa=function(t,e){return this.hl.Wc(e),Ma.resolve()},Sp.prototype.ka=function(t,e){var n=this.hl.Kc(e);return Ma.resolve(n)},Sp.prototype.zo=function(t,e){return Ma.resolve(this.hl.zo(e))},Sp),fp=(Ap.prototype.start=function(){return Promise.resolve()},Ap.prototype.Si=function(){return this.qa=!1,Promise.resolve()},Object.defineProperty(Ap.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),Ap.prototype.nc=function(){},Ap.prototype.sc=function(){},Ap.prototype.Pc=function(){return this.Sr},Ap.prototype.Ic=function(t){var e=this._l[t.Zs()];return e||(e=new np(this.Sr,this.Co),this._l[t.Zs()]=e),e},Ap.prototype.Ac=function(){return this.Ha},Ap.prototype.Rc=function(){return this.br},Ap.prototype.runTransaction=function(t,e,n){var r=this;Cr("MemoryPersistence","Starting transaction:",t);var i=new lp(this.Ba.next());return this.Co.dl(),n(i).next(function(t){return r.Co.wl(i).next(function(){return t})}).Nn().then(function(t){return i.pr(),t})},Ap.prototype.ml=function(e,n){return Ma.xn(Object.values(this._l).map(function(t){return function(){return t.zo(e,n)}}))},Ap),lp=(o(Np,cp=kc),Np),pp=(_p.Il=function(t){return new _p(t)},Object.defineProperty(_p.prototype,"Al",{get:function(){if(this.El)return this.El;throw jr()},enumerable:!1,configurable:!0}),_p.prototype.Fa=function(t,e,n){return this.Tl.Fa(n,e),this.Al.delete(n.toString()),Ma.resolve()},_p.prototype.xa=function(t,e,n){return this.Tl.xa(n,e),this.Al.add(n.toString()),Ma.resolve()},_p.prototype.Ko=function(t,e){return this.Al.add(e.toString()),Ma.resolve()},_p.prototype.removeTarget=function(t,e){var n=this;this.Tl.Wc(e.targetId).forEach(function(t){return n.Al.add(t.toString())});var r=this.persistence.Ac();return r.ka(t,e.targetId).next(function(t){t.forEach(function(t){return n.Al.add(t.toString())})}).next(function(){return r.va(t,e)})},_p.prototype.dl=function(){this.El=new Set},_p.prototype.wl=function(n){var r=this,i=this.persistence.Rc().aa();return Ma.forEach(this.Al,function(t){var e=$r.D(t);return r.Rl(n,e).next(function(t){t||i.Ir(e)})}).next(function(){return r.El=null,i.apply(n)})},_p.prototype.vc=function(t,e){var n=this;return this.Rl(t,e).next(function(t){t?n.Al.delete(e.toString()):n.Al.add(e.toString())})},_p.prototype.fl=function(t){return 0},_p.prototype.Rl=function(t,e){var n=this;return Ma.xn([function(){return Ma.resolve(n.Tl.zo(e))},function(){return n.persistence.Ac().zo(t,e)},function(){return n.persistence.ml(t,e)}])},_p),dp=(Tp.prototype.Vu=function(t){this.yl=t},Tp.prototype.Au=function(t){this.Vl=t},Tp.prototype.onMessage=function(t){this.pl=t},Tp.prototype.close=function(){this.gl()},Tp.prototype.send=function(t){this.Pl(t)},Tp.prototype.bl=function(){this.yl()},Tp.prototype.vl=function(t){this.Vl(t)},Tp.prototype.Sl=function(t){this.pl(t)},Tp),vp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},yp=(Ip.prototype.Ou=function(e,t,n,r){var i=this.Fl(e,t);Cr("RestConnection","Sending: ",i,n);var o={};return this.$l(o,r),this.xl(e,i,o,n).then(function(t){return Cr("RestConnection","Received: ",t),t},function(t){throw Vr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Ip.prototype.Lu=function(t,e,n,r){return this.Ou(t,e,n,r)},Ip.prototype.$l=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.21.0-2020815231418",t["Content-Type"]="text/plain",e)for(var n in e.zc)e.zc.hasOwnProperty(n)&&(t[n]=e.zc[n])},Ip.prototype.Fl=function(t,e){var n=vp[t];return this.Cl+"/v1/"+e+":"+n},o(Ep,ap=Ip),Ep.prototype.xl=function(a,e,n,r){return new Promise(function(o,s){var u=new Ar;u.listenOnce(_r.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Tr.NO_ERROR:var t=u.getResponseJson();Cr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Tr.TIMEOUT:Cr("Connection",'RPC "'+a+'" timed out'),s(new Rr(xr.DEADLINE_EXCEEDED,"Request time out"));break;case Tr.HTTP_ERROR:var e,n,r=u.getStatus();Cr("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(xr).indexOf(i)?i:xr.UNKNOWN,s(new Rr(n,e.message))):s(new Rr(xr.UNKNOWN,"Server responded with status "+u.getStatus())):s(new Rr(xr.UNAVAILABLE,"Connection failed."));break;default:jr()}}finally{Cr("Connection",'RPC "'+a+'" completed.')}var i});var t=JSON.stringify(r);u.send(e,"POST",t,n,15)})},Ep.prototype.pu=function(t,e){var n,r,i=[this.Cl,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Ir(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.$l(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=v().indexOf("Electron/")||(0<=(r=v()).indexOf("MSIE ")||0<=r.indexOf("Trident/"))||0<=v().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");Cr("Connection","Creating WebChannel: "+u,s);function a(t,e){c.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}var c=o.createWebChannel(u,s),h=!1,f=!1,l=new dp({Pl:function(t){f?Cr("Connection","Not sending because WebChannel is closed:",t):(h||(Cr("Connection","Opening WebChannel transport."),c.open(),h=!0),Cr("Connection","WebChannel sending:",t),c.send(t))},gl:function(){return c.close()}});return a(Nr.EventType.OPEN,function(){f||Cr("Connection","WebChannel transport opened.")}),a(Nr.EventType.CLOSE,function(){f||(f=!0,Cr("Connection","WebChannel transport closed"),l.vl())}),a(Nr.EventType.ERROR,function(t){f||(f=!0,Vr("Connection","WebChannel transport errored:",t),l.vl(new Rr(xr.UNAVAILABLE,"The operation could not be completed")))}),a(Nr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(qr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Cr("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=Zi[i];if(void 0!==t)return io(t)}(),s=r.message,void 0===o&&(o=xr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.vl(new Rr(o,s)),c.close()):(Cr("Connection","WebChannel received:",n),l.Sl(n)))}),setTimeout(function(){l.bl()},0),l},Ep),gp=(bp.prototype.nh=function(t){this.Bl.push(t)},bp.prototype.Si=function(){window.removeEventListener("online",this.kl),window.removeEventListener("offline",this.Ol)},bp.prototype.ql=function(){window.addEventListener("online",this.kl),window.addEventListener("offline",this.Ol)},bp.prototype.Ml=function(){Cr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Bl;t<e.length;t++)(0,e[t])(0)},bp.prototype.Ll=function(){Cr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Bl;t<e.length;t++)(0,e[t])(1)},bp.On=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},bp),mp=(wp.prototype.nh=function(t){},wp.prototype.Si=function(){},wp);function wp(){}function bp(){var t=this;this.kl=function(){return t.Ml()},this.Ol=function(){return t.Ll()},this.Bl=[],this.ql()}function Ep(t){var e=this;return(e=ap.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function Ip(t){this.Dl=t,this.U=t.U;var e=t.ssl?"https":"http";this.Cl=e+"://"+t.host,this.Nl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}function Tp(t){this.Pl=t.Pl,this.gl=t.gl}function _p(t){this.persistence=t,this.Tl=new Ff,this.El=null}function Np(t){var e=this;return(e=cp.call(this)||this).Ma=t,e}function Ap(t){var e=this;this._l={},this.Ba=new yc(0),this.qa=!1,this.qa=!0,this.Co=t(this),this.Ha=new hp(this),this.Sr=new kh,this.br=new rp(this.Sr,function(t){return e.Co.fl(t)})}function Sp(t){this.persistence=t,this.cl=new Ci(Yi,Xi),this.lastRemoteSnapshotVersion=Vi.min(),this.highestTargetId=0,this.ul=0,this.hl=new Ff,this.targetCount=0,this.ll=of.ma()}function Dp(t){return new as(t,!0)}var Op,xp,Rp,kp,Lp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Pp=(Yp.prototype.initialize=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Nh=this.Ul(e),this.persistence=this.Ql(e),[4,this.persistence.start()];case 1:return t.sent(),this.Wl=this.jl(e),this.zu=this.Kl(e),[2]}})})},Yp.prototype.jl=function(t){return null},Yp.prototype.Kl=function(t){return e=this.persistence,n=new ep,r=t.Gl,new _f(e,n,r);var e,n,r},Yp.prototype.Ql=function(t){if(t.persistenceSettings.zl)throw new Rr(xr.FAILED_PRECONDITION,Lp);return new fp(pp.Il)},Yp.prototype.Ul=function(t){return new Sc},Yp.prototype.terminate=function(){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Wl&&this.Wl.stop(),[4,this.Nh.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}})})},Yp.prototype.clearPersistence=function(t,e){throw new Rr(xr.FAILED_PRECONDITION,Lp)},Yp),Up=(o(Qp,kp=Pp),Qp.prototype.initialize=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,kp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){return n=(e=r).Fc,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.oa(t)}).then(function(t){e.Nc=t})]})})}(this.zu)];case 2:return t.sent(),[4,this.Hl.initialize(this,e)];case 3:return t.sent(),[4,Zl(this.Hl._i)];case 4:return t.sent(),[4,El(this.Hl.Dh)];case 5:return t.sent(),[2]}})})},Qp.prototype.jl=function(t){var e=this.persistence.Co.do;return new th(e,t.os)},Qp.prototype.Ql=function(t){var e=Tf(t.Dl.U,t.Dl.persistenceKey),n=Dp(t.Dl.U);return new vf(t.persistenceSettings.synchronizeTabs,e,t.clientId,$c.oo(t.persistenceSettings.cacheSizeBytes),t.os,tc(),ec(),n,this.Nh,t.persistenceSettings.La)},Qp.prototype.Ul=function(t){return new Sc},Qp.prototype.clearPersistence=function(t,e){return function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Va.On()?(e=n+"main",[4,Va.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Tf(t,e))},o(Kp,Rp=Qp),Kp.prototype.initialize=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return[4,Rp.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Hl._i,this.Nh instanceof Ac?(this.Nh._i={tr:Kl.bind(null,e),er:$l.bind(null,e),nr:function(f,l,p){return m(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,c,h;return w(this,function(t){switch(t.label){case 0:if(!(n=Jl(f)).Wh)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.kh.has(i)?(Cr("SyncEngine","Adding an already active target "+i),[3,5]):[4,kf(n.zu,i)]):[3,6];case 2:return o=t.sent(),[4,Of(n.zu,o)];case 3:return s=t.sent(),[4,Ul(n,Xl(o),s.targetId,!1)];case 4:t.sent(),hl(n.Dh,s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.kh.has(e)?[4,xf(n.zu,e,!1).then(function(){fl(n.Dh,e),ql(n,e)}).catch(Lf)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,c=p,t.label=7;case 7:return a<c.length?(h=c[a],[5,u(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),Vi:function(t){return t.zu.persistence.Vi()}.bind(null,e)},[4,this.Nh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.ec(function(e){return m(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Ql(this.Hl._i,e)];case 1:return t.sent(),this.Wl&&(e&&!this.Wl.Ti?this.Wl.start(this.zu):e||this.Wl.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Kp.prototype.Ul=function(t){if(t.persistenceSettings.zl&&t.persistenceSettings.synchronizeTabs){var e=tc();if(!Ac.On(e))throw new Rr(xr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Tf(t.Dl.U,t.Dl.persistenceKey);return new Ac(e,t.os,n,t.clientId,t.Gl)}return new Sc},Kp),Cp=(Wp.prototype.initialize=function(n,r){return m(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.zu?[3,2]:(this.zu=n.zu,this.Nh=n.Nh,this.Hu=this.Yl(r),this.Dh=this.Jl(r),this.Ch=this.Xl(r),this._i=this.Zl(r),this.Nh.fi=function(t){return Ml(e._i,t,1)},this.Dh.Yu.t_=Wl.bind(null,this._i),[4,_l(this.Dh,this._i.jh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Wp.prototype.Xl=function(t){return new ac},Wp.prototype.Yl=function(t){var e,n,r=Dp(t.Dl.U),i=(e=t.Dl,new yp(e));return n=t.credentials,new Qf(n,i,r)},Wp.prototype.Jl=function(t){var e=this,n=this.zu,r=this.Hu,i=t.os,o=function(t){return Ml(e._i,t,0)},s=new(gp.On()?gp:mp);return new Uf(n,r,i,o,s)},Wp.prototype.Zl=function(t){return e=this.zu,n=this.Dh,r=this.Ch,i=this.Nh,o=t.Gl,s=t.Fh,u=!t.persistenceSettings.zl||!t.persistenceSettings.synchronizeTabs,a=new kl(e,n,r,i,o,s),u&&(a.Wh=!0),a;var e,n,r,i,o,s,u,a},Wp.prototype.terminate=function(){return cl(this.Dh)},Wp),Mp=(Hp.prototype.next=function(t){this.observer.next&&this.e_(this.observer.next,t)},Hp.prototype.error=function(t){this.observer.error?this.e_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Hp.prototype.n_=function(){this.muted=!0},Hp.prototype.e_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Hp),Vp=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Rr(xr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(si("FieldPath","string",e,t[e]),0===t[e].length)throw new Rr(xr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.s_=new Xr(t)},Fp=(o(Gp,xp=Vp),Gp.documentId=function(){return new Gp(Xr.v().R())},Gp.prototype.isEqual=function(t){if(!(t instanceof Gp))throw gi("isEqual","FieldPath",1,t);return this.s_.isEqual(t.s_)},Gp),jp=new RegExp("[~\\*/\\[\\]]"),qp=function(){this.i_=this},Bp=(o(zp,Op=qp),zp.prototype.o_=function(t){if(2!==t.a_)throw 1===t.a_?t.c_(this.r_+"() can only appear at the top level of your update data"):t.c_(this.r_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},zp.prototype.isEqual=function(t){return t instanceof zp},zp);function zp(t){var e=this;return(e=Op.call(this)||this).r_=t,e}function Gp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xp.call(this,t)||this}function Hp(t){this.observer=t,this.muted=!1}function Wp(){}function Kp(){return null!==Rp&&Rp.apply(this,arguments)||this}function Qp(t){var e=this;return(e=kp.call(this)||this).Hl=t,e}function Yp(){}function Xp(t,e,n){return new _d({a_:3,u_:e.settings.u_,methodName:t.r_,h_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var $p,Jp,Zp,td,ed,nd,rd=(o(Id,nd=qp),Id.prototype.o_=function(t){return new Js(t.path,new Ms)},Id.prototype.isEqual=function(t){return t instanceof Id},Id),id=(o(Ed,ed=qp),Ed.prototype.o_=function(t){var e=Xp(this,t,!0),n=this.l_.map(function(t){return kd(t,e)}),r=new Vs(n);return new Js(t.path,r)},Ed.prototype.isEqual=function(t){return this===t},Ed),od=(o(bd,td=qp),bd.prototype.o_=function(t){var e=Xp(this,t,!0),n=this.l_.map(function(t){return kd(t,e)}),r=new zs(n);return new Js(t.path,r)},bd.prototype.isEqual=function(t){return this===t},bd),sd=(o(wd,Zp=qp),wd.prototype.o_=function(t){var e=new Ks(t.serializer,fs(t.serializer,this.__));return new Js(t.path,e)},wd.prototype.isEqual=function(t){return this===t},wd),ud=(o(md,Jp=qp),md.delete=function(){return ni("FieldValue.delete",arguments),new ad(new Bp("FieldValue.delete"))},md.serverTimestamp=function(){return ni("FieldValue.serverTimestamp",arguments),new ad(new rd("FieldValue.serverTimestamp"))},md.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ii("FieldValue.arrayUnion",arguments,1),new ad(new id("FieldValue.arrayUnion",t))},md.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ii("FieldValue.arrayRemove",arguments,1),new ad(new od("FieldValue.arrayRemove",t))},md.increment=function(t){return si("FieldValue.increment","number",1,t),ri("FieldValue.increment",arguments,1),new ad(new sd("FieldValue.increment",t))},md),ad=(o(gd,$p=ud),gd.prototype.o_=function(t){return this.i_.o_(t)},gd.prototype.isEqual=function(t){return t instanceof gd&&this.i_.isEqual(t.i_)},gd),cd=(Object.defineProperty(yd.prototype,"latitude",{get:function(){return this.f_},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"longitude",{get:function(){return this.d_},enumerable:!1,configurable:!0}),yd.prototype.isEqual=function(t){return this.f_===t.f_&&this.d_===t.d_},yd.prototype.toJSON=function(){return{latitude:this.f_,longitude:this.d_}},yd.prototype.H=function(t){return Ti(this.f_,t.f_)||Ti(this.d_,t.d_)},yd),hd=/^__.*__$/,fd=function(t,e,n){this.w_=t,this.m_=e,this.T_=n},ld=(vd.prototype.E_=function(t,e){var n=[];return null!==this.Qe?n.push(new lu(t,this.data,this.Qe,e)):n.push(new fu(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new gu(t,this.fieldTransforms)),n},vd),pd=(dd.prototype.E_=function(t,e){var n=[new lu(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&n.push(new gu(t,this.fieldTransforms)),n},dd);function dd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function vd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function yd(t,e){if(ri("GeoPoint",arguments,2),si("GeoPoint","number",1,t),si("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Rr(xr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Rr(xr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.f_=t,this.d_=e}function gd(t){var e=this;return(e=$p.call(this)||this).i_=t,e.r_=t.r_,e}function md(){return Jp.call(this)||this}function wd(t,e){var n=this;return(n=Zp.call(this)||this).r_=t,n.__=e,n}function bd(t,e){var n=this;return(n=td.call(this)||this).r_=t,n.l_=e,n}function Ed(t,e){var n=this;return(n=ed.call(this)||this).r_=t,n.l_=e,n}function Id(t){var e=this;return(e=nd.call(this)||this).r_=t,e}function Td(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw jr()}}var _d=(Object.defineProperty(Sd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"a_",{get:function(){return this.settings.a_},enumerable:!1,configurable:!0}),Sd.prototype.A_=function(t){return new Sd(Object.assign(Object.assign({},this.settings),t),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},Sd.prototype.R_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.A_({path:n,h_:!1});return r.P_(t),r},Sd.prototype.g_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.A_({path:n,h_:!1});return r.I_(),r},Sd.prototype.y_=function(t){return this.A_({path:void 0,h_:!0})},Sd.prototype.c_=function(t){return Vd(t,this.settings.methodName,this.settings.V_||!1,this.path,this.settings.u_)},Sd.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.T(t)})||void 0!==this.fieldTransforms.find(function(t){return e.T(t.field)})},Sd.prototype.I_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.P_(this.path.get(t))},Sd.prototype.P_=function(t){if(0===t.length)throw this.c_("Document fields must not be empty");if(Td(this.a_)&&hd.test(t))throw this.c_('Document fields cannot begin and end with "__"')},Sd),Nd=(Ad.prototype.p_=function(t,e,n,r){return void 0===r&&(r=!1),new _d({a_:t,methodName:e,u_:n,path:Xr.g(),h_:!1,V_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},Ad);function Ad(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||Dp(t)}function Sd(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.I_(),this.fieldTransforms=i||[],this.Qe=o||[]}function Dd(t,e,n,r,i,o){void 0===o&&(o={});var s=t.p_(o.merge||o.mergeFields?2:0,e,n,i);Ud("Data must be an object, but it was:",s,r);var u,a,c=Ld(r,s);if(o.merge)u=new $s(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Vp)d=p.s_;else{if("string"!=typeof p)throw jr();d=Md(e,p,n)}if(!s.contains(d))throw new Rr(xr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Fd(h,d)||h.push(d)}u=new $s(h),a=s.fieldTransforms.filter(function(t){return u.He(t.field)})}else u=null,a=s.fieldTransforms;return new ld(new _u(c),u,a)}function Od(t,o,s,e){var u=t.p_(1,o,s);Ud("Data must be an object, but it was:",u,e);var a=[],c=new Nu;zr(e,function(t,e){var n,r=Md(o,t,s),i=u.g_(r);e instanceof qp&&e.i_ instanceof Bp?a.push(r):null!=(n=kd(e,i))&&(a.push(r),c.set(r,n))});var n=new $s(a);return new pd(c.Je(),n,u.fieldTransforms)}function xd(t,e,n,r,i,o){var s=t.p_(1,e,n),u=[Cd(e,r,n)],a=[i];if(o.length%2!=0)throw new Rr(xr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Cd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p,d=[],v=new Nu,y=u.length-1;0<=y;--y){Fd(d,u[y])||(h=u[y],f=a[y],l=s.g_(h),f instanceof qp&&f.i_ instanceof Bp?d.push(h):null!=(p=kd(f,l))&&(d.push(h),v.set(h,p)))}var g=new $s(d);return new pd(v.Je(),g,s.fieldTransforms)}function Rd(t,e,n,r){return void 0===r&&(r=!1),kd(n,t.p_(r?4:3,e))}function kd(s,t){if(Pd(s))return Ud("Unsupported field value:",t,s),Ld(s,t);if(s instanceof qp)return function(t,e){if(!Td(e.a_))throw e.c_(t.r_+"() can only be used with update() and set()");if(!e.path)throw e.c_(t.r_+"() is not currently supported inside arrays");var n=t.o_(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.h_&&4!==t.a_)throw t.c_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=kd(i[r],t.y_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return fs(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Mi.fromDate(t);return{timestampValue:ls(e.serializer,n)}}if(t instanceof Mi){var r=new Mi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ls(e.serializer,r)}}if(t instanceof cd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Di)return{bytesValue:ps(e.serializer,t.q)};if(t instanceof fd){var i=e.U,o=t.w_;if(!o.isEqual(i))throw e.c_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:vs(t.w_||e.U,t.m_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.c_("Unsupported field value: "+di(t))}(s,t)}function Ld(t,r){var i={};return Gr(t)?r.path&&0<r.path.length&&r.Qe.push(r.path):zr(t,function(t,e){var n=kd(e,r.R_(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Pd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Mi||t instanceof cd||t instanceof Di||t instanceof fd||t instanceof qp)}function Ud(t,e,n){if(!Pd(n)||!pi(n)){var r=di(n);throw"an object"===r?e.c_(t+" a custom object"):e.c_(t+" "+r)}}function Cd(t,e,n){if(e instanceof Vp)return e.s_;if("string"==typeof e)return Md(t,e);throw Vd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Md(t,e,n){try{return function(e){if(0<=e.search(jp))throw new Rr(xr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Fp.bind.apply(Fp,s([void 0],e.split("."))))}catch(t){throw new Rr(xr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).s_}catch(e){throw Vd(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Vd(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Rr(xr.INVALID_ARGUMENT,(u+=". ")+t+a)}function Fd(t,e){return t.some(function(t){return t.isEqual(e)})}var jd=(Hd.prototype.C_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.N_(),0<this.mutations.length)throw new Rr(xr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return m(this,void 0,void 0,function(){var i,e,n,r,o,s;return w(this,function(t){switch(t.label){case 0:return e=Es((i=u).serializer)+"/documents",n={documents:a.map(function(t){return gs(i.serializer,t)})},[4,i.Lu("BatchGetDocuments",e,n)];case 1:return r=t.sent(),o=new Map,r.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){qr(!!e.found),e.found.name,e.found.updateTime;var n=ms(t,e.found.name),r=ds(e.found.updateTime),i=new _u({mapValue:{fields:e.found.fields}});return new Pu(n,r,i,{})}(e,n):"missing"in n?function(t,e){qr(!!e.missing),qr(!!e.readTime);var n=ms(t,e.missing),r=ds(e.readTime);return new Uu(n,r)}(e,n):jr());o.set(r.key.toString(),r)}),s=[],[2,(a.forEach(function(t){var e=o.get(t.toString());qr(!!e),s.push(e)}),s)]}})})}(this.Hu,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Uu||t instanceof Pu?n.F_(t):jr()}),e)]}})})},Hd.prototype.set=function(t,e){this.write(e.E_(t,this.Ke(t))),this.D_.add(t.toString())},Hd.prototype.update=function(t,e){try{this.write(e.E_(t,this.x_(t)))}catch(t){this.S_=t}this.D_.add(t.toString())},Hd.prototype.delete=function(t){this.write([new Iu(t,this.Ke(t))]),this.D_.add(t.toString())},Hd.prototype.commit=function(){return m(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.N_(),this.S_)throw this.S_;return e=this.b_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=$r.D(e);r.mutations.push(new Tu(n,r.Ke(n)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=Es((e=i).serializer)+"/documents",r={writes:o.map(function(t){return _s(e.serializer,t)})},[4,e.Ou("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Hu,this.mutations)];case 1:return t.sent(),this.v_=!0,[2]}})})},Hd.prototype.F_=function(t){var e;if(t instanceof Pu)e=t.version;else{if(!(t instanceof Uu))throw jr();e=Vi.min()}var n=this.b_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Rr(xr.ABORTED,"Document version changed between two reads.")}else this.b_.set(t.key.toString(),e)},Hd.prototype.Ke=function(t){var e=this.b_.get(t.toString());return!this.D_.has(t.toString())&&e?eu.updateTime(e):eu.Ge()},Hd.prototype.x_=function(t){var e=this.b_.get(t.toString());if(this.D_.has(t.toString())||!e)return eu.exists(!0);if(e.isEqual(Vi.min()))throw new Rr(xr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return eu.updateTime(e)},Hd.prototype.write=function(t){this.N_(),this.mutations=this.mutations.concat(t)},Hd.prototype.N_=function(){},Hd),qd=(Gd.prototype.run=function(){this.M_()},Gd.prototype.M_=function(){var t=this;this.gs.Rn(function(){return m(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new jd(this.Hu),(n=this.O_(e))&&n.then(function(t){r.os.ds(function(){return e.commit().then(function(){r.hs.resolve(t)}).catch(function(t){r.L_(t)})})}).catch(function(t){r.L_(t)}),[2]})})})},Gd.prototype.O_=function(t){try{var e=this.updateFunction(t);return!Gi(e)&&e.catch&&e.then?e:(this.hs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hs.reject(t),null}},Gd.prototype.L_=function(t){var e=this;0<this.k_&&this.B_(t)?(--this.k_,this.os.ds(function(){return e.M_(),Promise.resolve()})):this.hs.reject(t)},Gd.prototype.B_=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!ro(e)},Gd),Bd=(zd.prototype.start=function(t,e,n,r){var i=this;this.U_(),this.Dl=t;var o=new Pa,s=!1;return this.credentials.Jc(function(t){return s?void i.os.Ds(function(){return function(r,i){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return(e=r).os.Fs(),Cr("RemoteStore","RemoteStore received new credentials"),n=yl(e),e.Zu.add(3),[4,al(e)];case 1:return t.sent(),n&&e.sh.set("Unknown"),[4,e.Yu.t_(i)];case 2:return t.sent(),e.Zu.delete(3),[4,ul(e)];case 3:return t.sent(),[2]}})})}(i.Dh,t)}):(s=!0,Cr("FirestoreClient","Initializing. user=",t.uid),i.Q_(e,n,r,t,o).then(i.q_.resolve,i.q_.reject))}),this.os.ds(function(){return i.q_.promise}),o.promise},zd.prototype.enableNetwork=function(){var e=this;return this.U_(),this.os.enqueue(function(){return e.persistence.sc(!0),(t=e.Dh).Zu.delete(0),ul(t);var t})},zd.prototype.Q_=function(i,o,s,u,a){return m(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={os:this.os,Dl:this.Dl,clientId:this.clientId,credentials:this.credentials,Gl:u,Fh:100,persistenceSettings:s},[4,i.initialize(e)];case 1:return t.sent(),[4,o.initialize(i,e)];case 2:return t.sent(),this.persistence=i.persistence,this.Nh=i.Nh,this.zu=i.zu,this.Wl=i.Wl,this.Hu=o.Hu,this.Dh=o.Dh,this._i=o._i,this.W_=o.Ch,this.W_.qs=function(u,a){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return e=Jl(u),(i=e.xh.get(a))?(n=i.targetId,e.Nh.Mi(n),r=i.view.bh(),[3,4]):[3,1];case 1:return[4,Of(e.zu,Yu(a))];case 2:return o=t.sent(),s=e.Nh.Mi(o.targetId),n=o.targetId,[4,Ul(e,a,n,"current"===s)];case 3:r=t.sent(),e.jh&&hl(e.Dh,o),t.label=4;case 4:return[2,r]}})})}.bind(null,this._i),this.W_.Ws=function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).xh.get(o),1<(r=e.kh.get(n.targetId)).length?[2,(e.kh.set(n.targetId,r.filter(function(t){return!Zu(t,o)})),void e.xh.delete(o))]:e.jh?(e.Nh.Li(n.targetId),e.Nh.Ni(n.targetId)?[3,2]:[4,xf(e.zu,n.targetId,!1).then(function(){e.Nh.qi(n.targetId),fl(e.Dh,n.targetId),ql(e,n.targetId)}).catch(Lf)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return ql(e,n.targetId),[4,xf(e.zu,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,this._i),this.persistence.nc(function(){return m(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),a.resolve(),[3,4];case 3:if(n=t.sent(),a.reject(n),!this.j_(n))throw n;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),this.Q_(new Pp,new Cp,{zl:!1},u,a))];case 4:return[2]}})})},zd.prototype.j_=function(t){return"FirebaseError"===t.name?t.code===xr.FAILED_PRECONDITION||t.code===xr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},zd.prototype.U_=function(){if(this.os.Vs)throw new Rr(xr.FAILED_PRECONDITION,"The client has already been terminated.")},zd.prototype.disableNetwork=function(){var t=this;return this.U_(),this.os.enqueue(function(){return t.persistence.sc(!1),function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return(e=n).Zu.add(0),[4,al(e)];case 1:return t.sent(),e.sh.set("Offline"),[2]}})})}(t.Dh)})},zd.prototype.terminate=function(){var t=this;this.os.Ss();var r=new Pa;return this.os.ps(function(){return m(t,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.Wl&&this.Wl.stop(),[4,cl(this.Dh)];case 1:return t.sent(),[4,this.Nh.Si()];case 2:return t.sent(),[4,this.persistence.Si()];case 3:return t.sent(),this.credentials.Xc(),r.resolve(),[3,5];case 4:return e=t.sent(),n=sc(e,"Failed to shutdown persistence"),r.reject(n),[3,5];case 5:return[2]}})})}),r.promise},zd.prototype.waitForPendingWrites=function(){var t=this;this.U_();var e=new Pa;return this.os.ds(function(){return function(u,a){return m(this,void 0,void 0,function(){var n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:yl((n=u).Dh)||Cr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.zu).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.vr.Bo(t)})];case 2:return-1===(r=t.sent())?[2,void a.resolve()]:((i=n.Uh.get(r)||[]).push(a),n.Uh.set(r,i),[3,4]);case 3:return o=t.sent(),s=sc(o,"Initialization of waitForPendingWrites() operation failed"),a.reject(s),[3,4];case 4:return[2]}var e})})}(t._i,e)}),e.promise},zd.prototype.listen=function(t,e,n){var r=this;this.U_();var i=new Mp(n),o=new lc(t,i,e);return this.os.ds(function(){return cc(r.W_,o)}),function(){i.n_(),r.os.ds(function(){return hc(r.W_,o)})}},zd.prototype.K_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),e=new Pa,[2,(this.os.ds(function(){return function(s,u,a){return m(this,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=u,(n=s).persistence.runTransaction("read document","readonly",function(t){return n.$c.Dr(t,e)}))];case 1:return(r=t.sent())instanceof Pu?a.resolve(r):r instanceof Uu?a.resolve(null):a.reject(new Rr(xr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=t.sent(),o=sc(i,"Failed to get document '"+u+" from cache"),a.reject(o),[3,3];case 3:return[2]}var e,n})})}(n.zu,r,e)}),e.promise)]}})})},zd.prototype.G_=function(c,h){return void 0===h&&(h={}),m(this,void 0,void 0,function(){var e,a=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),e=new Pa,[2,(this.os.ds(function(){return n=a.W_,r=a.os,i=c,o=h,s=e,t=new Mp({next:function(t){r.ds(function(){return hc(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Rr(xr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Rr(xr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new lc(Bu(i.path),t,{includeMetadataChanges:!0,Js:!0}),cc(n,u);var n,r,i,o,s,t,u}),e.promise)]}})})},zd.prototype.z_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),e=new Pa,[2,(this.os.ds(function(){return function(u,a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Rf(u,a,!0)];case 1:return e=t.sent(),n=new Ol(a,e.kc),r=n.Eh(e.documents),i=n.gr(r,!1),c.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=sc(o,"Failed to execute query '"+a+" against cache"),c.reject(s),[3,3];case 3:return[2]}})})}(n.zu,r,e)}),e.promise)]}})})},zd.prototype.H_=function(c,h){return void 0===h&&(h={}),m(this,void 0,void 0,function(){var u,a=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),u=new Pa,[2,(this.os.ds(function(){return e=a.W_,n=a.os,t=c,r=h,i=u,o=new Mp({next:function(t){n.ds(function(){return hc(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Rr(xr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new lc(t,o,{includeMetadataChanges:!0,Js:!0}),cc(e,s);var e,n,t,r,i,o,s}),u.promise)]}})})},zd.prototype.write=function(t){var e=this;this.U_();var n=new Pa;return this.os.ds(function(){return function(v,y,g){return m(this,void 0,void 0,function(){var u,a,p,d;return w(this,function(t){switch(t.label){case 0:u=Zl(v),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(o=u.zu,c=y,f=o,l=Mi.now(),s=c.reduce(function(t,e){return t.add(e.key)},Eo()),f.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.$c.$r(a,s).next(function(t){h=t;for(var u,e,n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=(u=o,e=h.get(o.key),u instanceof gu?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Pu?t.field(i.field):void 0,s=Ps(i.transform,o||null);null!=s&&(e=null==e?(new Nu).set(i.field,s):e.set(i.field,s))}return e?e.Je():null}(e):null);null!=s&&n.push(new lu(o.key,s,function u(t){var a=[];return zr(t.fields||{},function(t,e){var n=new Xr([t]);if(os(e)){var r=u(e.mapValue).fields;if(0===r.length)a.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];a.push(n.child(s))}}else a.push(n)}),new $s(a)}(s.proto.mapValue),eu.exists(!0)))}return f.vr.xo(a,l,n,c)})}).then(function(t){var e=t.hr(h);return{batchId:t.batchId,dr:e}}))];case 2:return a=t.sent(),u.Nh.Fi(a.batchId),e=u,n=a.batchId,r=g,i=(i=(i=e.qh[e.currentUser.Zs()])||new oo(Ti)).rt(n,r),e.qh[e.currentUser.Zs()]=i,[4,Hl(u,a.dr)];case 3:return t.sent(),[4,El(u.Dh)];case 4:return t.sent(),[3,6];case 5:return p=t.sent(),d=sc(p,"Failed to persist write"),g.reject(d),[3,6];case 6:return[2]}var e,n,r,i,o,c,h,f,l,s})})}(e._i,t,n)}),n.promise},zd.prototype.U=function(){return this.Dl.U},zd.prototype.Y_=function(t){var e=this;this.U_();var r=new Mp(t);return this.os.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){return[2,(e=this.W_,n=r,e.Bs.add(n),void n.next())];var e,n})})}),function(){r.n_(),e.os.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){return[2,void this.W_.Bs.delete(r)]})})})}},Object.defineProperty(zd.prototype,"J_",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),zd.prototype.transaction=function(t){var e=this;this.U_();var n=new Pa;return this.os.ds(function(){return new qd(e.os,e.Hu,t,n).run(),Promise.resolve()}),n.promise},zd);function zd(t,e){this.credentials=t,this.os=e,this.clientId=Ei.k(),this.q_=new Pa}function Gd(t,e,n,r){this.os=t,this.Hu=e,this.updateFunction=n,this.hs=r,this.k_=5,this.gs=new Ca(this.os,"transaction_retry")}function Hd(t){this.Hu=t,this.b_=new Map,this.mutations=[],this.v_=!1,this.S_=null,this.D_=new Set}function Wd(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Kd,Qd,Yd=(pv.prototype.ef=function(t){switch(Ho(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Jo(t.integerValue||t.doubleValue);case 3:return this.nf(t.timestampValue);case 4:return this.sf(t);case 5:return t.stringValue;case 6:return this.tf(Zo(t.bytesValue));case 7:return this.if(t.referenceValue);case 8:return this.rf(t.geoPointValue);case 9:return this.af(t.arrayValue);case 10:return this.cf(t.mapValue);default:throw jr()}},pv.prototype.cf=function(t){var n=this,r={};return zr(t.fields||{},function(t,e){r[t]=n.ef(e)}),r},pv.prototype.rf=function(t){return new cd(Jo(t.latitude),Jo(t.longitude))},pv.prototype.af=function(t){var e=this;return(t.values||[]).map(function(t){return e.ef(t)})},pv.prototype.sf=function(t){switch(this.X_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return Bo(n)?t(n):n}(t);return null==e?null:this.ef(e);case"estimate":return this.nf(zo(t));default:return null}},pv.prototype.nf=function(t){var e=$o(t),n=new Mi(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},pv.prototype.if=function(t){var e=Qr.P(t);qr(ks(e));var n=new Ui(e.get(1),e.get(3)),r=new $r(e.u(5));return n.isEqual(this.U)||Mr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.Z_(r)},pv),Xd=$c.uo,$d=(lv.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},lv),Jd=(Object.defineProperty(fv.prototype,"If",{get:function(){return this.Af||(this.Af=new Nd(this.w_,this.Ef.ignoreUndefinedProperties)),this.Af},enumerable:!1,configurable:!0}),fv.prototype.settings=function(t){ri("Firestore.settings",arguments,1),si("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.Ef),t)).merge;var e=new $d(t);if(this.df&&!this.Ef.isEqual(e))throw new Rr(xr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Ef=e).credentials&&(this.Tf=function(t){if(!t)return new qf;switch(t.type){case"gapi":var e=t.Rf;return qr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Gf(e,t.iu||"0");case"provider":return t.Rf;default:throw new Rr(xr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},fv.prototype.enableNetwork=function(){return this.ff(),this.df.enableNetwork()},fv.prototype.disableNetwork=function(){return this.ff(),this.df.disableNetwork()},fv.prototype.enablePersistence=function(t){var e,n;if(this.df)throw new Rr(xr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Mr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Rr(xr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Pf(this.uf,this.hf,{zl:!0,cacheSizeBytes:this.Ef.cacheSizeBytes,synchronizeTabs:r,La:i})},fv.prototype.clearPersistence=function(){return m(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.df&&!this.df.J_)throw new Rr(xr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new Pa,[2,(this._f.ps(function(){return m(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.uf.clearPersistence(this.w_,this.mf)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},fv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(fv.prototype,"gf",{get:function(){return this.ff(),this.df.J_},enumerable:!1,configurable:!0}),fv.prototype.waitForPendingWrites=function(){return this.ff(),this.df.waitForPendingWrites()},fv.prototype.onSnapshotsInSync=function(t){if(this.ff(),Wd(t))return this.df.Y_(t);si("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.df.Y_(e)},fv.prototype.ff=function(){return this.df||this.Pf(new Pp,new Cp,{zl:!1}),this.df},fv.prototype.yf=function(){return new ki(this.w_,this.mf,this.Ef.host,this.Ef.ssl,this.Ef.experimentalForceLongPolling)},fv.prototype.Pf=function(t,e,n){var r=this.yf();return this.df=new Bd(this.Tf,this._f),this.df.start(r,t,e,n)},fv.wf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Rr(xr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Rr(xr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Ui(n)},Object.defineProperty(fv.prototype,"app",{get:function(){if(!this.lf)throw new Rr(xr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.lf},enumerable:!1,configurable:!0}),fv.prototype.collection=function(t){return ri("Firestore.collection",arguments,1),si("Firestore.collection","non-empty string",1,t),this.ff(),new Ev(Qr.P(t),this,null)},fv.prototype.doc=function(t){return ri("Firestore.doc",arguments,1),si("Firestore.doc","non-empty string",1,t),this.ff(),ev.Vf(Qr.P(t),this,null)},fv.prototype.collectionGroup=function(t){if(ri("Firestore.collectionGroup",arguments,1),si("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Rr(xr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ff(),new wv((e=t,new Mu(Qr.g(),e)),this,null);var e},fv.prototype.runTransaction=function(e){var n=this;return ri("Firestore.runTransaction",arguments,1),si("Firestore.runTransaction","function",1,e),this.ff().transaction(function(t){return e(new Zd(n,t))})},fv.prototype.batch=function(){return this.ff(),new tv(this)},Object.defineProperty(fv,"logLevel",{get:function(){switch(Ur()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),fv.setLogLevel=function(t){ri("Firestore.setLogLevel",arguments,1),fi("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Lr.setLogLevel(t)},fv.prototype.pf=function(){return this.Ef.timestampsInSnapshots},fv.prototype.bf=function(){return this.Ef},fv),Zd=(hv.prototype.get=function(t){var n=this;ri("Transaction.get",arguments,1);var r=Dv("Transaction.get",t,this.vf);return this.Sf.C_([r.m_]).then(function(t){if(!t||1!==t.length)return jr();var e=t[0];if(e instanceof Uu)return new rv(n.vf,r.m_,null,!1,!1,r.T_);if(e instanceof Pu)return new rv(n.vf,r.m_,e,!1,!1,r.T_);throw jr()})},hv.prototype.set=function(t,e,n){oi("Transaction.set",arguments,2,3);var r=Dv("Transaction.set",t,this.vf);n=Nv("Transaction.set",n);var i=Ov(r.T_,e,n),o=Dd(this.vf.If,"Transaction.set",r.m_,i,null!==r.T_,n);return this.Sf.set(r.m_,o),this},hv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Fp?(ii("Transaction.update",arguments,3),r=Dv("Transaction.update",t,this.vf),xd(this.vf.If,"Transaction.update",r.m_,e,n,o)):(ri("Transaction.update",arguments,2),r=Dv("Transaction.update",t,this.vf),Od(this.vf.If,"Transaction.update",r.m_,e)),this.Sf.update(r.m_,i),this},hv.prototype.delete=function(t){ri("Transaction.delete",arguments,1);var e=Dv("Transaction.delete",t,this.vf);return this.Sf.delete(e.m_),this},hv),tv=(cv.prototype.set=function(t,e,n){oi("WriteBatch.set",arguments,2,3),this.Nf();var r=Dv("WriteBatch.set",t,this.vf);n=Nv("WriteBatch.set",n);var i=Ov(r.T_,e,n),o=Dd(this.vf.If,"WriteBatch.set",r.m_,i,null!==r.T_,n);return this.Df=this.Df.concat(o.E_(r.m_,eu.Ge())),this},cv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Nf(),i="string"==typeof e||e instanceof Fp?(ii("WriteBatch.update",arguments,3),r=Dv("WriteBatch.update",t,this.vf),xd(this.vf.If,"WriteBatch.update",r.m_,e,n,o)):(ri("WriteBatch.update",arguments,2),r=Dv("WriteBatch.update",t,this.vf),Od(this.vf.If,"WriteBatch.update",r.m_,e)),this.Df=this.Df.concat(i.E_(r.m_,eu.exists(!0))),this},cv.prototype.delete=function(t){ri("WriteBatch.delete",arguments,1),this.Nf();var e=Dv("WriteBatch.delete",t,this.vf);return this.Df=this.Df.concat(new Iu(e.m_,eu.Ge())),this},cv.prototype.commit=function(){return this.Nf(),this.Cf=!0,0<this.Df.length?this.vf.ff().write(this.Df):Promise.resolve()},cv.prototype.Nf=function(){if(this.Cf)throw new Rr(xr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},cv),ev=(o(av,Qd=fd),av.Vf=function(t,e,n){if(t.length%2!=0)throw new Rr(xr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new av(new $r(t),e,n)},Object.defineProperty(av.prototype,"id",{get:function(){return this.m_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(av.prototype,"parent",{get:function(){return new Ev(this.m_.path.h(),this.firestore,this.T_)},enumerable:!1,configurable:!0}),Object.defineProperty(av.prototype,"path",{get:function(){return this.m_.path.R()},enumerable:!1,configurable:!0}),av.prototype.collection=function(t){if(ri("DocumentReference.collection",arguments,1),si("DocumentReference.collection","non-empty string",1,t),!t)throw new Rr(xr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Qr.P(t);return new Ev(this.m_.path.child(e),this.firestore,null)},av.prototype.isEqual=function(t){if(!(t instanceof av))throw gi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.m_.isEqual(t.m_)&&this.T_===t.T_},av.prototype.set=function(t,e){oi("DocumentReference.set",arguments,1,2),e=Nv("DocumentReference.set",e);var n=Ov(this.T_,t,e),r=Dd(this.firestore.If,"DocumentReference.set",this.m_,n,null!==this.T_,e);return this.df.write(r.E_(this.m_,eu.Ge()))},av.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Fp?(ii("DocumentReference.update",arguments,2),xd(this.firestore.If,"DocumentReference.update",this.m_,t,e,r)):(ri("DocumentReference.update",arguments,1),Od(this.firestore.If,"DocumentReference.update",this.m_,t)),this.df.write(n.E_(this.m_,eu.exists(!0)))},av.prototype.delete=function(){return ri("DocumentReference.delete",arguments,0),this.df.write([new Iu(this.m_,eu.Ge())])},av.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];oi("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Wd(i[u])||(yi("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),ci("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,c={includeMetadataChanges:s.includeMetadataChanges};Wd(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(si("DocumentReference.onSnapshot","function",u,i[u]),ui("DocumentReference.onSnapshot","function",u+1,i[u+1]),ui("DocumentReference.onSnapshot","function",u+2,i[u+2]));var h={next:function(t){i[u]&&i[u](r.Ff(t))},error:i[u+1],complete:i[u+2]};return this.df.listen(Bu(this.m_.path),c,h)},av.prototype.get=function(t){var e=this;oi("DocumentReference.get",arguments,0,1),Sv("DocumentReference.get",t);var n=this.firestore.ff();return t&&"cache"===t.source?n.K_(this.m_).then(function(t){return new rv(e.firestore,e.m_,t,!0,t instanceof Pu&&t.Ye,e.T_)}):n.G_(this.m_,t).then(function(t){return e.Ff(t)})},av.prototype.withConverter=function(t){return new av(this.m_,this.firestore,t)},av.prototype.Ff=function(t){var e=t.docs.get(this.m_);return new rv(this.firestore,this.m_,e,t.fromCache,t.hasPendingWrites,this.T_)},av),nv=(uv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},uv),rv=(sv.prototype.data=function(t){var e=this;if(oi("DocumentSnapshot.data",arguments,0,1),t=Av("DocumentSnapshot.data",t),this.$f){if(this.T_){var n=new iv(this.vf,this.m_,this.$f,this.xf,this.kf,null);return this.T_.fromFirestore(n,t)}return new Yd(this.vf.w_,this.vf.pf(),t.serverTimestamps||"none",function(t){return new ev(t,e.vf,null)},function(t){return new Pi(t)}).ef(this.$f.sn())}},sv.prototype.get=function(t,e){var n=this;if(oi("DocumentSnapshot.get",arguments,1,2),e=Av("DocumentSnapshot.get",e),this.$f){var r=this.$f.data().field(Cd("DocumentSnapshot.get",t,this.m_));if(null!==r)return new Yd(this.vf.w_,this.vf.pf(),e.serverTimestamps||"none",function(t){return new ev(t,n.vf,n.T_)},function(t){return new Pi(t)}).ef(r)}},Object.defineProperty(sv.prototype,"id",{get:function(){return this.m_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(sv.prototype,"ref",{get:function(){return new ev(this.m_,this.vf,this.T_)},enumerable:!1,configurable:!0}),Object.defineProperty(sv.prototype,"exists",{get:function(){return null!==this.$f},enumerable:!1,configurable:!0}),Object.defineProperty(sv.prototype,"metadata",{get:function(){return new nv(this.kf,this.xf)},enumerable:!1,configurable:!0}),sv.prototype.isEqual=function(t){if(!(t instanceof sv))throw gi("isEqual","DocumentSnapshot",1,t);return this.vf===t.vf&&this.xf===t.xf&&this.m_.isEqual(t.m_)&&(null===this.$f?null===t.$f:this.$f.isEqual(t.$f))&&this.T_===t.T_},sv),iv=(o(ov,Kd=rv),ov.prototype.data=function(t){return Kd.prototype.data.call(this,t)},ov);function ov(){return null!==Kd&&Kd.apply(this,arguments)||this}function sv(t,e,n,r,i,o){this.vf=t,this.m_=e,this.$f=n,this.xf=r,this.kf=i,this.T_=o}function uv(t,e){this.hasPendingWrites=t,this.fromCache=e}function av(t,e,n){var r=this;return(r=Qd.call(this,e.w_,t,n)||this).m_=t,r.firestore=e,r.T_=n,r.df=r.firestore.ff(),r}function cv(t){this.vf=t,this.Df=[],this.Cf=!1}function hv(t,e){this.vf=t,this.Sf=e}function fv(t,e,n,r){var i=this;if(void 0===n&&(n=new Pp),void 0===r&&(r=new Cp),this.uf=n,this.hf=r,this.lf=null,this._f=new rc,this.INTERNAL={delete:function(){return m(i,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ff(),[4,this.df.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var o=t;this.lf=o,this.w_=fv.wf(o),this.mf=o.name,this.Tf=new Bf(e)}else{var s=t;if(!s.projectId)throw new Rr(xr.INVALID_ARGUMENT,"Must provide projectId");this.w_=new Ui(s.projectId,s.database),this.mf="[DEFAULT]",this.Tf=new qf}this.Ef=new $d({})}function lv(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Rr(xr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ai("settings","non-empty string","host",t.host),this.host=t.host,ci("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(yi("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),ci("settings","object","credentials",t.credentials),this.credentials=t.credentials,ci("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),ci("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Mr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Mr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,ci("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=$c.lo;else{if(t.cacheSizeBytes!==Xd&&t.cacheSizeBytes<$c.ho)throw new Rr(xr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+$c.ho);this.cacheSizeBytes=t.cacheSizeBytes}ci("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function pv(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.X_=n,this.Z_=r,this.tf=i}function dv(t,e,n){if("string"==typeof n){if(""===n)throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ku(e)&&-1!==n.indexOf("/"))throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Qr.P(n));if(!$r.F(r))throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ts(t,new $r(r))}if(n instanceof fd)return ts(t,n.m_);throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+di(n)+".")}function vv(t,e){if(!Array.isArray(t)||0===t.length)throw new Rr(xr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Rr(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Rr(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Rr(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function yv(t,e,n){if(!n.isEqual(e))throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function gv(t){if(Gu(t)&&0===t.rn.length)throw new Rr(xr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var mv,wv=(_v.prototype.where=function(t,e,n){ri("Query.where",arguments,3),vi("Query.where",3,n);var r,i,o=fi("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,e),s=Cd("Query.where",t),u=function(t,e,n,r,i,o,s){var u;if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new Rr(xr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){vv(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(dv(r,t,f))}u={arrayValue:{values:a}}}else u=dv(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||vv(s,o),u=Rd(n,e,s,"in"===o||"not-in"===o);var l=oa.create(i,o,u);return function(t,e){if(e.un()){var n=Wu(t);if(null!==n&&!n.isEqual(e.field))throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Hu(t);null!==r&&yv(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new Rr(xr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Rr(xr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(this.Mf,"Query.where",this.firestore.If,this.firestore.w_,s,o,n);return new _v((r=this.Mf,i=r.filters.concat([u]),new Mu(r.path,r.collectionGroup,r.rn.slice(),i,r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.T_)},_v.prototype.orderBy=function(t,e){var n;if(oi("Query.orderBy",arguments,1,2),ui("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Rr(xr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=Cd("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o,s=new La(e,n);return i=s,null!==Hu(r=t)||null!==(o=Wu(r))&&yv(0,o,i.field),s}(this.Mf,o,n);return new _v((r=this.Mf,i=r.rn.concat([s]),new Mu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.T_)},_v.prototype.limit=function(t){return ri("Query.limit",arguments,1),si("Query.limit","number",1,t),mi("Query.limit",1,t),new _v(Xu(this.Mf,t,"F"),this.firestore,this.T_)},_v.prototype.limitToLast=function(t){return ri("Query.limitToLast",arguments,1),si("Query.limitToLast","number",1,t),mi("Query.limitToLast",1,t),new _v(Xu(this.Mf,t,"L"),this.firestore,this.T_)},_v.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ii("Query.startAt",arguments,1);var r=this.Of("Query.startAt",t,e,!0);return new _v($u(this.Mf,r),this.firestore,this.T_)},_v.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ii("Query.startAfter",arguments,1);var r=this.Of("Query.startAfter",t,e,!1);return new _v($u(this.Mf,r),this.firestore,this.T_)},_v.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ii("Query.endBefore",arguments,1);var r=this.Of("Query.endBefore",t,e,!0);return new _v(Ju(this.Mf,r),this.firestore,this.T_)},_v.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ii("Query.endAt",arguments,1);var r=this.Of("Query.endAt",t,e,!1);return new _v(Ju(this.Mf,r),this.firestore,this.T_)},_v.prototype.isEqual=function(t){if(!(t instanceof _v))throw gi("isEqual","Query",1,t);return this.firestore===t.firestore&&Zu(this.Mf,t.Mf)&&this.T_===t.T_},_v.prototype.withConverter=function(t){return new _v(this.Mf,this.firestore,t)},_v.prototype.Of=function(h,t,e,n){if(vi(h,1,t),t instanceof rv)return ri(h,s([t],e),1),function(t,e,n,r){if(!n)throw new Rr(xr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+h+"().");for(var i=[],o=0,s=Qu(t);o<s.length;o++){var u=s[o];if(u.field.p())i.push(ts(e,n.key));else{var a=n.field(u.field);if(Bo(a))throw new Rr(xr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var c=u.field.R();throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+c+"' (used as the orderBy) does not exist.")}i.push(a)}}return new Na(i,r)}(this.Mf,this.firestore.w_,t.$f,n);var r=[t].concat(e);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new Rr(xr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.p()){if("string"!=typeof c)throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ku(t)&&-1!==c.indexOf("/"))throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Qr.P(c));if(!$r.F(h))throw new Rr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new $r(h);u.push(ts(e,f))}else{var l=Rd(n,r,c);u.push(l)}}return new Na(u,o)}(this.Mf,this.firestore.w_,this.firestore.If,h,r,n)},_v.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];oi("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||Wd(i[a])||(yi("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),ci("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),Wd(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(si("Query.onSnapshot","function",a,i[a]),ui("Query.onSnapshot","function",a+1,i[a+1]),ui("Query.onSnapshot","function",a+2,i[a+2]));var c={next:function(t){i[a]&&i[a](new bv(r.firestore,r.Mf,t,r.T_))},error:i[a+1],complete:i[a+2]};return gv(this.Mf),this.firestore.ff().listen(this.Mf,u,c)},_v.prototype.get=function(t){var e=this;oi("Query.get",arguments,0,1),Sv("Query.get",t),gv(this.Mf);var n=this.firestore.ff();return(t&&"cache"===t.source?n.z_(this.Mf):n.H_(this.Mf,t)).then(function(t){return new bv(e.firestore,e.Mf,t,e.T_)})},_v),bv=(Object.defineProperty(Tv.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Tv.prototype,"empty",{get:function(){return this.Bf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(Tv.prototype,"size",{get:function(){return this.Bf.docs.size},enumerable:!1,configurable:!0}),Tv.prototype.forEach=function(e,n){var r=this;oi("QuerySnapshot.forEach",arguments,1,2),si("QuerySnapshot.forEach","function",1,e),this.Bf.docs.forEach(function(t){e.call(n,r.Qf(t,r.metadata.fromCache,r.Bf.Qt.has(t.key)))})},Object.defineProperty(Tv.prototype,"query",{get:function(){return new wv(this.Lf,this.vf,this.T_)},enumerable:!1,configurable:!0}),Tv.prototype.docChanges=function(t){t&&(yi("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ci("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Bf.jt)throw new Rr(xr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.qf&&this.Uf===e||(this.qf=function(i,e,o){if(i.Ut.m()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ut;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.Bf,e,this.Qf.bind(this)),this.Uf=e),this.qf},Tv.prototype.isEqual=function(t){if(!(t instanceof Tv))throw gi("isEqual","QuerySnapshot",1,t);return this.vf===t.vf&&Zu(this.Lf,t.Lf)&&this.Bf.isEqual(t.Bf)&&this.T_===t.T_},Tv.prototype.Qf=function(t,e,n){return new iv(this.vf,t.key,t,e,n,this.T_)},Tv),Ev=(o(Iv,mv=wv),Object.defineProperty(Iv.prototype,"id",{get:function(){return this.Mf.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(Iv.prototype,"parent",{get:function(){var t=this.Mf.path.h();return t.m()?null:new ev(new $r(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Iv.prototype,"path",{get:function(){return this.Mf.path.R()},enumerable:!1,configurable:!0}),Iv.prototype.doc=function(t){oi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Ei.k()),si("CollectionReference.doc","non-empty string",1,t);var e=Qr.P(t);return ev.Vf(this.Mf.path.child(e),this.firestore,this.T_)},Iv.prototype.add=function(t){ri("CollectionReference.add",arguments,1);var e=this.T_?this.T_.toFirestore(t):t;si("CollectionReference.add","object",1,e);var n=this.doc();return new ev(n.m_,this.firestore,null).set(e).then(function(){return n})},Iv.prototype.withConverter=function(t){return new Iv(this.Wf,this.firestore,t)},Iv);function Iv(t,e,n){var r=this;if(((r=mv.call(this,Bu(t),e,n)||this).Wf=t).length%2!=1)throw new Rr(xr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.R()+" has "+t.length);return r}function Tv(t,e,n,r){this.vf=t,this.Lf=e,this.Bf=n,this.T_=r,this.qf=null,this.Uf=null,this.metadata=new nv(n.hasPendingWrites,n.fromCache)}function _v(t,e,n){this.Mf=t,this.firestore=e,this.T_=n}function Nv(t,e){if(void 0===e)return{merge:!1};if(yi(t,e,["merge","mergeFields"]),ci(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+di(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Rr(xr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+di(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof Fp}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Rr(xr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Av(t,e){return void 0===e?{}:(yi(t,e,["serverTimestamps"]),hi(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Sv(t,e){ui(t,"object",1,e),e&&(yi(t,e,["source"]),hi(t,0,"source",e.source,["default","server","cache"]))}function Dv(t,e,n){if(e instanceof fd){if(e.firestore!==n)throw new Rr(xr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw gi(t,"DocumentReference",1,e)}function Ov(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var xv,Rv={Firestore:Jd,GeoPoint:cd,Timestamp:Mi,Blob:Pi,Transaction:Zd,WriteBatch:tv,DocumentReference:ev,DocumentSnapshot:rv,Query:wv,QueryDocumentSnapshot:iv,QuerySnapshot:bv,CollectionReference:Ev,FieldPath:Fp,FieldValue:ud,setLogLevel:Jd.setLogLevel,CACHE_SIZE_UNLIMITED:Xd};(xv=r.default).INTERNAL.registerComponent(new Sr("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new Cp,i=new Up(r),new Jd(e,n,i,r);var e,n,r,i},"PUBLIC").setServiceProps(Object.assign({},Rv))),xv.registerVersion("@firebase/firestore","1.17.0-2020815231418")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
