!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Md){"use strict";try{(function(){Md=Md&&Object.prototype.hasOwnProperty.call(Md,"default")?Md.default:Md;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function g(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=h[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";var u={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},a=l.INFO,h=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),c=(Object.defineProperty(f.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),f.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?u[t]:t},Object.defineProperty(f.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),f.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},f.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},f.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},f.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},f.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},f);function f(t){this.name=t,this._logLevel=a,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,y="FirebaseError",v=(n(m,d=Error),m);function m(t,e){var n=d.call(this,e)||this;return n.code=t,n.name=y,Object.setPrototypeOf(n,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,b.prototype.create),n}var b=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new v(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function N(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var _,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=A||self;function D(){}function k(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function R(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),O=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function C(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function U(t,e,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:C).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var M=Date.now;function F(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&(Object.prototype.hasOwnProperty.call(this,x)&&this[x]||(this[x]=++O))},q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var j=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var W,K=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var Q=S.navigator;if(Q){var Z=Q.userAgent;if(Z){W=Z;break t}}W=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=D;var rt,it,ot=Y(W,"Opera"),st=Y(W,"Trident")||Y(W,"MSIE"),ut=Y(W,"Edge"),at=ut||st,ht=Y(W,"Gecko")&&!(Y(W.toLowerCase(),"webkit")&&!Y(W,"Edge"))&&!(Y(W,"Trident")||Y(W,"MSIE"))&&!Y(W,"Edge"),ct=Y(W.toLowerCase(),"webkit")&&!Y(W,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=W,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt={};function vt(u){return t=u,e=function(){for(var t=0,e=K(String(rt)).split("."),n=K(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=yt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var gt=S.document&&st&&(ft()||parseInt(rt,10))||void 0,mt=!st||9<=Number(gt),wt=st&&!vt("9"),bt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",D,e),S.removeEventListener("test",D,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function It(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Tt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},F(It,Et);var Tt={2:"touch",3:"pen",4:"mouse"};It.prototype.b=function(){It.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,wt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),_t=0;function At(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++_t,this.Y=this.Z=!1}function St(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Dt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=j(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(St(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Rt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Rt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new At(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),xt={};function Ot(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=jt(r),e&&e[Nt]?e.wa(n,r,L(i)?!!i.capture:!!i,o):Pt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ot(t,e[o],n,r,i);return null}return n=jt(n),t&&t[Nt]?t.va(e,n,L(r)?!!r.capture:!!r,i):Pt(t,e,n,!1,r,i)}function Pt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=L(i)?!!i.capture:!!i;if(s&&!mt)return null;var u,a,h=Ft(t);if(h||(t[Lt]=h=new Dt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=Mt,r=a=mt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)bt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ut(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ct(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[Nt]?kt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ut(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(kt(n,t),0==n.b&&(n.src=null,e[Lt]=null)):St(t)))}function Ut(t){return t in xt?xt[t]:xt[t]="on"+t}function Vt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ct(t),n.call(r,e)}function Mt(t,e){if(t.Y)return!0;if(mt)return Vt(t,new It(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Vt(t,e=new It(e,this))}function Ft(t){return(t=t[Lt])instanceof Dt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jt(e){return"function"==k(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Gt(){q.call(this),this.c=new Dt(this),(this.J=this).C=null}function Bt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&kt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}F(Gt,q),Gt.prototype[Nt]=!0,(_=Gt.prototype).addEventListener=function(t,e,n,r){Ot(this,t,e,n,r)},_.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=jt(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Rt(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Rt(n,r,i,o)),(r=-1<e?n[e]:null)&&Ct(r))}(this,t,e,n,r)},_.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Et(t,n):t instanceof Et?t.target=t.target||n:(s=t,et(t=new Et(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Bt(o,r,!0,t)&&s;if(s=Bt(o=t.a=n,r,!0,t)&&s,s=Bt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Bt(o=t.a=e[i],r,!1,t)&&s;return s},_.G=function(){if(Gt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.C=null},_.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},_.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var zt=S.JSON.stringify;function Ht(){this.b=this.a=null}var Wt,Kt=(Yt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Yt(function(){return new Xt},function(t){t.reset()},100));function Yt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Xt(){this.next=this.b=this.a=null}function Qt(t,e){var n;Wt||(n=S.Promise.resolve(void 0),Wt=function(){n.then($t)}),Zt||(Wt(),Zt=!0),Jt.add(t,e)}Ht.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Xt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Zt=!(Xt.prototype.reset=function(){this.next=this.b=this.a=null}),Jt=new Ht;function $t(){for(var t,e,n;n=e=void 0,n=null,(e=Jt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){S.setTimeout(function(){throw t},0)}(t)}var r=Kt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Zt=!1}function te(t,e){Gt.call(this),this.b=t||1,this.a=e||S,this.f=U(this.Ya,this),this.g=M()}function ee(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ne(t,e,n){if("function"==k(t))n&&(t=U(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=U(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}F(te,Gt),(_=te.prototype).aa=!1,_.M=null,_.Ya=function(){var t;this.aa&&(0<(t=M()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(ee(this),this.start())))},_.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=M())},_.G=function(){te.S.G.call(this),ee(this),delete this.a};var re,ie,oe,se=(T(ie=ae,oe=re=q),ie.prototype=null===oe?Object.create(oe):(ue.prototype=oe.prototype,new ue),ae.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=ne(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},ae.prototype.G=function(){re.prototype.G.call(this),this.a&&(S.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},ae);function ue(){this.constructor=ie}function ae(t,e,n){var r=re.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function he(t){q.call(this),this.b=t,this.a={}}F(he,q);var ce=[];function fe(t,e,n,r){Array.isArray(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Ot(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ct(t)},t),t.a={}}function pe(){this.a=!0}function de(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return zt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}he.prototype.G=function(){he.S.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pe.prototype.info=function(){};var ye=null;function ve(){return ye=ye||new Gt}function ge(t){Et.call(this,"serverreachability",t)}function me(){var t=ve();t.dispatchEvent(new ge(t))}function we(t){Et.call(this,"statevent",t)}function be(){var t=ve();t.dispatchEvent(new we(t))}function Ee(t){Et.call(this,"timingevent",t)}function Ie(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}F(ge,Et),F(we,Et),F(Ee,Et);var Te={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Ne={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function _e(){}function Ae(t){var e;return(e=t.a)||(e=t.a={}),e}function Se(){}_e.prototype.a=null;var De,ke={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Re(){Et.call(this,"d")}function Le(){Et.call(this,"c")}function xe(){}function Oe(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new he(this),this.P=Pe,t=at?125:void 0,this.R=new te(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}F(Re,Et),F(Le,Et),F(xe,_e),De=new xe;var Pe=45e3,Ce={},Ue={};function Ve(t,e,n){t.H=1,t.i=on(Je(e)),t.j=n,t.I=!0,Me(t,null)}function Me(t,e){t.u=M(),qe(t),t.l=Je(t.i);var s,u,a,h,c,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),mn(n.b,"t",r),t.D=0,t.a=fr(t.g,t.g.C?e:null),0<t.O&&(t.F=new se(U(t.Ca,t,t.a),t.O)),fe(t.J,t.a,"readystatechange",t.Wa),e=t.B?$(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),me(),s=t.c,u=t.m,a=t.l,h=t.f,c=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+h+") [attempt "+c+"]: "+u+"\n"+a+"\n"+t})}function Fe(t,e,n){for(var r,i,o,s,u=!0;!t.A&&t.D<n.length;){var a=(i=n,s=o=void 0,o=(r=t).D,-1==(s=i.indexOf("\n",o))?Ue:(o=Number(i.substring(o,s)),isNaN(o)?Ce:(s+=1)+o>i.length?Ue:(i=i.substr(s,o),r.D=s+o,i)));if(a==Ue){4==e&&(t.h=4,be(),u=!1),de(t.c,t.f,null,"[Incomplete Response]");break}if(a==Ce){t.h=4,be(),de(t.c,t.f,n,"[Invalid Chunk]"),u=!1;break}de(t.c,t.f,a,null),He(t,a)}4==e&&0==n.length&&(t.h=1,be(),u=!1),t.b=t.b&&u,u?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),rr(e),e.F=!0)):(de(t.c,t.f,n,"[Invalid Chunked Response]"),ze(t),Be(t))}function qe(t){t.U=M()+t.P,je(t,t.P)}function je(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ie(U(t.Ua,t),e)}function Ge(t){t.o&&(S.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||sr(t.g,t)}function ze(t){Ge(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ee(t.R),le(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function He(t,e){try{var n,r,i,o,s,u,a,h,c,f,l,p=t.g;if(0!=p.v&&(p.a==t||_n(p.b,t)))if(p.I=t.N,!t.C&&_n(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var y=d;if(0==y[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;or(p),Yn(p)}nr(p),be()}}else p.oa=y[1],0<p.oa-p.P&&y[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=Ie(U(p.Ra,p),6e3));if(Nn(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else ar(p,11)}else if(!t.C&&p.a!=t||or(p),!H(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++)y=e[d],p.P=y[0],y=y[1],2==p.v?"c"==y[0]?(p.J=y[1],p.ga=y[2],null!=(n=y[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=y[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=y[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&(Y(u,"spdy")||Y(u,"quic")||Y(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(An(a,a.b),a.b=null)),!o.A||(h=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=h,rn(o.B,o.A,h))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=M()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),c=t,(o=p).la=cr(o,o.C?o.ga:null,o.fa),c.C?(Sn(o.b,c),f=c,(l=o.D)&&f.setTimeout(l),f.o&&(Ge(f),qe(f)),o.a=c):er(o),0<p.g.length&&Zn(p)):"stop"!=y[0]&&"close"!=y[0]||ar(p,7):3==p.v&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?ar(p,7):Kn(p):"noop"!=y[0]&&p.f&&p.f.sa(y),p.o=0);me()}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(R(t)||"string"==typeof t)G(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(R(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(R(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ye(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Xe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Xe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Xe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_=Oe.prototype).setTimeout=function(t){this.P=t},_.Wa=function(t){t=t.target;var e=this.F;e&&3==Bn(t)?e.f():this.Ca(t)},_.Ca=function(t){try{if(t==this.a)t:{var e=Bn(this.a),n=this.a.ua();this.a.X();if(!(e<3||3==e&&!at&&!this.a.$())){this.A||4!=e||7==n||me(),Ge(this);var r=this.a.X();this.N=r;var i=this.a.$();if(this.b=200==r,a=this.c,h=this.m,c=this.l,f=this.f,l=this.T,p=e,d=r,a.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+l+"]: "+h+"\n"+c+"\n"+p+" "+d}),this.b){if(this.V&&!this.C){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,be(),ze(this),Be(this);break t}de(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,He(this,u)}this.I?(Fe(this,e,i),at&&this.b&&3==e&&(fe(this.J,this.R,"tick",this.Va),this.R.start())):(de(this.c,this.f,i,null),He(this,i)),4==e&&ze(this),this.b&&!this.A&&(4==e?sr(this.g,this):(this.b=!1,qe(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.h=3:this.h=0,be(),ze(this),Be(this)}}}catch(t){}var a,h,c,f,l,p,d},_.Va=function(){var t,e;this.a&&(t=Bn(this.a),e=this.a.$(),this.D<e.length&&(Ge(this),Fe(this,t,e),this.b&&4!=t&&qe(this)))},_.cancel=function(){this.A=!0,ze(this)},_.Ua=function(){this.o=null;var t,e,n=M();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(me(),be()),ze(this),this.h=2,Be(this)):je(this,this.U-n)},(_=Ke.prototype).K=function(){Ye(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},_.L=function(){return Ye(this),this.a.concat()},_.get=function(t,e){return Xe(this.b,t)?this.b[t]:e},_.set=function(t,e){Xe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},_.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ze(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ze?(this.a=void 0!==e?e:t.a,$e(this,t.f),this.j=t.j,tn(this,t.c),en(this,t.h),this.g=t.g,e=t.b,(n=new dn).c=e.c,e.a&&(n.a=new Ke(e.a),n.b=e.b),nn(this,n),this.i=t.i):t&&(n=String(t).match(Qe))?(this.a=!!e,$e(this,n[1]||"",!0),this.j=sn(n[2]||""),tn(this,n[3]||"",!0),en(this,n[4]),this.g=sn(n[5]||"",!0),nn(this,n[6]||"",!0),this.i=sn(n[7]||"")):(this.a=!!e,this.b=new dn(null,this.a))}function Je(t){return new Ze(t)}function $e(t,e,n){t.f=n?sn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function tn(t,e,n){t.c=n?sn(e,!0):e}function en(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function nn(t,e,n){var r,i;e instanceof dn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(yn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(vn(this,e),mn(this,n,t))},r)),r.f=i):(n||(e=un(e,ln)),t.b=new dn(e,t.a))}function rn(t,e,n){t.b.set(e,n)}function on(t){return rn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^M()).toString(36)),t}function sn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function un(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,an),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function an(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(un(e,hn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(un(e,hn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(un(n,"/"==n.charAt(0)?fn:cn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",un(n,pn)),t.join("")};var hn=/[#\/\?@]/g,cn=/[#\?:]/g,fn=/[#\?]/g,ln=/[#\?@]/g,pn=/#/g;function dn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function yn(u){u.a||(u.a=new Ke,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],o=n,s=i?decodeURIComponent(i.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function vn(t,e){yn(t),e=wn(t,e),Xe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Xe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ye(t)))}function gn(t,e){return yn(t),e=wn(t,e),Xe(t.a.b,e)}function mn(t,e,n){vn(t,e),0<n.length&&(t.c=null,t.a.set(wn(t,e),z(n)),t.b+=n.length)}function wn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function bn(t,e){this.b=t,this.a=e}function En(t){this.g=t||In,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ia&&S.ia.ya&&S.ia.ya()&&S.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(_=dn.prototype).add=function(t,e){yn(this),this.c=null,t=wn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},_.forEach=function(n,r){yn(this),this.a.forEach(function(t,e){G(t,function(t){n.call(r,t,e,this)},this)},this)},_.L=function(){yn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},_.K=function(t){yn(this);var e=[];if("string"==typeof t)gn(this,t)&&(e=B(e,this.a.get(wn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},_.set=function(t,e){return yn(this),this.c=null,gn(this,t=wn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},_.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},_.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var In=10;function Tn(t){return t.b||t.a&&t.a.size>=t.f}function Nn(t){return t.b?1:t.a?t.a.size:0}function _n(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function An(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=N(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function kn(){}function Rn(){this.a=new kn}function Ln(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}En.prototype.cancel=function(){var t,e;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=N(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},kn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},kn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var xn=S.JSON.parse;function On(t){Gt.call(this),this.headers=new Ke,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Pn,this.D=this.F=!1}F(On,Gt);var Pn="",Cn=/^https?$/i,Un=["POST","PUT"];function Vn(t){return"content-type"==t.toLowerCase()}function Mn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Fn(t),jn(t)}function Fn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function qn(t){if(t.b&&(!t.s[1]||4!=Bn(t)||2!=t.X()))if(t.l&&4==Bn(t))ne(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Bn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Qe)[1]||null)&&S.self&&S.self.location&&(i=(r=S.self.location.protocol).substr(0,r.length-1)),n=!Cn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Bn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",Fn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Gn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Gn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function Bn(t){return t.a?t.a.readyState:0}function zn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):rn(t,e,n))}function Hn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Wn(t){this.pa=0,this.g=[],this.c=new pe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Hn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Hn("baseRetryDelayMs",5e3,t),this.Ma=Hn("retryDelaySeedMs",1e4,t),this.Ja=Hn("forwardChannelMaxRetries",2,t),this.ma=Hn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new En(t&&t.concurrentRequestLimit),this.ka=new Rn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Kn(t){var e,n;Xn(t),3==t.v&&(e=t.R++,rn(n=Je(t.B),"SID",t.J),rn(n,"RID",e),rn(n,"TYPE","terminate"),$n(t,n),(e=new Oe(t,t.c,e,void 0)).H=2,e.i=on(Je(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.i.toString(),"")),!n&&S.Image&&((new Image).src=e.i,n=!0),n||(e.a=fr(e.g,null),e.a.ba(e.i)),e.u=M(),qe(e)),hr(t)}function Yn(t){t.a&&(rr(t),t.a.cancel(),t.a=null)}function Xn(t){Yn(t),t.j&&(S.clearTimeout(t.j),t.j=null),or(t),t.b.cancel(),t.h&&("number"==typeof t.h&&S.clearTimeout(t.h),t.h=null)}function Qn(t,e){t.g.push(new bn(t.La++,e)),3==t.v&&Zn(t)}function Zn(t){Tn(t.b)||t.h||(t.h=!0,Qt(t.Ba,t),t.u=0)}function Jn(t,e){var n=e?e.f:t.R++,r=Je(t.B);rn(r,"SID",t.J),rn(r,"RID",n),rn(r,"AID",t.P),$n(t,r),t.i&&t.l&&zn(r,t.i,t.l),n=new Oe(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=tr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),An(t.b,n),Ve(n,r,e)}function $n(t,n){t.f&&We({},function(t,e){rn(n,e,t)})}function tr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?U(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r){var i="req"+h+"_"||"";try{We(t,function(t,e){var n=t;L(t)&&(n=zt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(c,s)}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function er(t){t.a||t.j||(t.U=1,Qt(t.Aa,t),t.o=0)}function nr(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=Ie(U(t.Aa,t),ur(t,t.o)),t.o++,1)}function rr(t){null!=t.s&&(S.clearTimeout(t.s),t.s=null)}function ir(t){t.a=new Oe(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Je(t.la);rn(e,"RID","rpc"),rn(e,"SID",t.J),rn(e,"CI",t.H?"0":"1"),rn(e,"AID",t.P),$n(t,e),rn(e,"TYPE","xmlhttp"),t.i&&t.l&&zn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=on(Je(e)),n.j=null,n.I=!0,Me(n,t)}function or(t){null!=t.m&&(S.clearTimeout(t.m),t.m=null)}function sr(t,e){var n,r=null;if(t.a==e){or(t),rr(t),t.a=null;var i=2}else{if(!_n(t.b,e))return;r=e.s,Sn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b)1==i?(r=e.j?e.j.length:0,e=M()-e.u,n=t.u,(i=ve()).dispatchEvent(new Ee(i)),Zn(t)):er(t);else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(Nn(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=Ie(U(t.Ba,t,e),ur(t,t.u)),t.u++,1}}(t,e)||2==i&&nr(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:ar(t,5);break;case 4:ar(t,10);break;case 3:ar(t,6);break;default:ar(t,2)}}function ur(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function ar(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=U(t.Xa,t),n||(n=new Ze("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||$e(n,"https"),on(n)),i=n.toString(),o=r,u=new pe,S.Image?((s=new Image).onload=V(Ln,u,s,"TestLoadImage: loaded",!0,o),s.onerror=V(Ln,u,s,"TestLoadImage: error",!1,o),s.onabort=V(Ln,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=V(Ln,u,s,"TestLoadImage: timeout",!1,o),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):be(),t.v=0,t.f&&t.f.ra(e),hr(t),Xn(t)}function hr(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,z(t.g),t.g.length=0),t.f.qa())}function cr(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof Ze?Je(r):new Ze(r,void 0);return""!=c.c?(e&&tn(c,e+"."+c.c),en(c,c.h)):(o=(i=S.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new Ze(null,void 0),o&&$e(h,o),s&&tn(h,s),u&&en(h,u),a&&(h.g=a),c=h),t.W&&J(t.W,function(t,e){rn(c,e,t)}),e=t.A,n=t.na,e&&n&&rn(c,e,n),rn(c,"VER",t.ha),$n(t,c),c}function fr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new On(t.Ka)).F=t.C,e}function lr(){}function pr(){if(st&&!(10<=Number(gt)))throw Error("Environmental error: no available transport.")}function dr(t,e){Gt.call(this),this.a=new Wn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new gr(this)}function yr(t){Re.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function vr(){Le.call(this),this.status=1}function gr(t){this.a=t}(_=On.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ae(this.H):Ae(De),this.a.onreadystatechange=U(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Mn(this,t)}t=n||"";var i,o=new Ke(this.headers);r&&We(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Vn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=S.FormData&&t instanceof S.FormData,0<=j(Un,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Gn(this),0<this.o&&((this.D=(i=this.a,st&&vt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=U(this.xa,this)):this.m=ne(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Mn(this,t)}},_.xa=function(){this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},_.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jn(this))},_.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),On.S.G.call(this)},_.za=function(){this.j||(this.A||this.l||this.g?qn(this):this.Ta())},_.Ta=function(){qn(this)},_.X=function(){try{return 2<Bn(this)?this.a.status:-1}catch(t){return-1}},_.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},_.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},_.ua=function(){return this.h},_.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(_=Wn.prototype).ha=8,_.v=1,_.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Oe(this,this.c,t,void 0),r=this.l;if(this.O&&(r?et(r=$(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=tr(this,n,e),rn(i=Je(this.B),"RID",t),rn(i,"CVER",22),this.A&&rn(i,"X-HTTP-Session-Id",this.A),$n(this,i),this.i&&r&&zn(i,this.i,r),An(this.b,n),this.Ga&&rn(i,"TYPE","init"),this.da?(rn(i,"$req",e),rn(i,"SID","null"),n.V=!0,Ve(n,i,null)):Ve(n,i,e),this.v=2}}else 3==this.v&&(t?Jn(this,t):0==this.g.length||Tn(this.b)||Jn(this))},_.Aa=function(){var t;this.j=null,ir(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ie(U(this.Sa,this),t))},_.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Yn(this),ir(this))},_.Ra=function(){null!=this.m&&(this.m=null,Yn(this),nr(this),be())},_.Xa=function(t){t?this.c.info("Successfully pinged google.com"):this.c.info("Failed to ping google.com"),be()},(_=lr.prototype).ta=function(){},_.sa=function(){},_.ra=function(){},_.qa=function(){},_.Ha=function(){},pr.prototype.a=function(t,e){return new dr(t,e)},F(dr,Gt),(_=dr.prototype).addEventListener=function(t,e,n,r){dr.S.addEventListener.call(this,t,e,n,r)},_.removeEventListener=function(t,e,n,r){dr.S.removeEventListener.call(this,t,e,n,r)},_.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;be(),t.fa=e,t.W=n||{},t.H=t.T,t.B=cr(t,null,t.fa),Zn(t)},_.close=function(){Kn(this.a)},_.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,Qn(this.a,e)):this.g?((e={}).__data__=zt(t),Qn(this.a,e)):Qn(this.a,t)},_.G=function(){this.a.f=null,delete this.f,Kn(this.a),delete this.a,dr.S.G.call(this)},F(yr,Re),F(vr,Le),F(gr,lr),gr.prototype.ta=function(){this.a.dispatchEvent("a")},gr.prototype.sa=function(t){this.a.dispatchEvent(new yr(t))},gr.prototype.ra=function(t){this.a.dispatchEvent(new vr)},gr.prototype.qa=function(){this.a.dispatchEvent("b")},pr.prototype.createWebChannel=pr.prototype.a,dr.prototype.send=dr.prototype.Pa,dr.prototype.open=dr.prototype.Oa,Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,Ne.COMPLETE="complete",(Se.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",Gt.prototype.listen=Gt.prototype.va,On.prototype.listenOnce=On.prototype.wa,On.prototype.getLastError=On.prototype.Qa,On.prototype.getLastErrorCode=On.prototype.ua,On.prototype.getStatus=On.prototype.X,On.prototype.getResponseJson=On.prototype.Na,On.prototype.getResponseText=On.prototype.$,On.prototype.send=On.prototype.ba;var mr={createWebChannelTransport:function(){return new pr},ErrorCode:Te,EventType:Ne,WebChannel:Se,XhrIo:On},wr=mr.createWebChannelTransport,br=mr.ErrorCode,Er=mr.EventType,Ir=mr.WebChannel,Tr=mr.XhrIo,Nr=(_r.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},_r.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},_r.prototype.setServiceProps=function(t){return this.serviceProps=t,this},_r);function _r(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Ar="7.19.0-202071902151",Sr=new c("@firebase/firestore");function Dr(){return Sr.logLevel}function kr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Sr.logLevel<=l.DEBUG&&(e=n.map(xr),Sr.debug.apply(Sr,i(["Firestore ("+Ar+"): "+t],e)))}function Rr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Sr.logLevel<=l.ERROR&&(e=n.map(xr),Sr.error.apply(Sr,i(["Firestore ("+Ar+"): "+t],e)))}function Lr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Sr.logLevel<=l.WARN&&(e=n.map(xr),Sr.warn.apply(Sr,i(["Firestore ("+Ar+"): "+t],e)))}function xr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Or(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+Ar+") INTERNAL ASSERTION FAILED: "+t;throw Rr(e),new Error(e)}function Pr(t){t||Or()}var Cr=(Ur.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(var n=0;n<40;n++)e[n]=Math.floor(256*Math.random());return e}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ur);function Ur(){}function Vr(t,e){return t<e?-1:e<t?1:0}function Mr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Fr(t){return t+"\0"}function qr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var jr=(Object.defineProperty(Gr.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Gr.prototype.isEqual=function(t){return t instanceof Gr&&t.projectId===this.projectId&&t.database===this.database},Gr.prototype.o=function(t){return Vr(this.projectId,t.projectId)||Vr(this.database,t.database)},Gr);function Gr(t,e){this.projectId=t,this.database=e||"(default)"}function Br(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Hr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Wr,Kr,Yr,Xr=(li.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},li.prototype.has=function(t){return void 0!==this.get(t)},li.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},li.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},li.prototype.forEach=function(u){zr(this.l,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},li.prototype._=function(){return Hr(this.l)},li),Qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Zr=(n(fi,Yr=Error),fi),Jr=(ci.now=function(){return ci.fromMillis(Date.now())},ci.fromDate=function(t){return ci.fromMillis(t.getTime())},ci.fromMillis=function(t){var e=Math.floor(t/1e3);return new ci(e,1e6*(t-1e3*e))},ci.prototype.toDate=function(){return new Date(this.toMillis())},ci.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ci.prototype.T=function(t){return this.seconds===t.seconds?Vr(this.nanoseconds,t.nanoseconds):Vr(this.seconds,t.seconds)},ci.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ci.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ci.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ci.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ci),$r=(hi.m=function(t){return new hi(t)},hi.min=function(){return new hi(new Jr(0,0))},hi.prototype.o=function(t){return this.timestamp.T(t.timestamp)},hi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},hi.prototype.I=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},hi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},hi.prototype.A=function(){return this.timestamp},hi),ti=(Object.defineProperty(ai.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),ai.prototype.isEqual=function(t){return 0===ai.P(this,t)},ai.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ai?t.forEach(function(t){e.push(t)}):e.push(t),this.g(e)},ai.prototype.limit=function(){return this.offset+this.length},ai.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},ai.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},ai.prototype.v=function(){return this.segments[this.offset]},ai.prototype.S=function(){return this.get(this.length-1)},ai.prototype.get=function(t){return this.segments[this.offset+t]},ai.prototype._=function(){return 0===this.length},ai.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ai.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ai.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ai.prototype.N=function(){return this.segments.slice(this.offset,this.limit())},ai.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ai),ei=(n(ui,Kr=ti),ui.prototype.g=function(t,e,n){return new ui(t,e,n)},ui.prototype.F=function(){return this.N().join("/")},ui.prototype.toString=function(){return this.F()},ui.k=function(t){if(0<=t.indexOf("//"))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ui(t.split("/").filter(function(t){return 0<t.length}))},ui.$=function(){return new ui([])},ui),ni=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ri=(n(si,Wr=ti),si.prototype.g=function(t,e,n){return new si(t,e,n)},si.O=function(t){return ni.test(t)},si.prototype.F=function(){return this.N().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),si.O(t)||(t="`"+t+"`"),t}).join(".")},si.prototype.toString=function(){return this.F()},si.prototype.M=function(){return 1===this.length&&"__name__"===this.get(0)},si.L=function(){return new si(["__name__"])},si.q=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Zr(Qr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Zr(Qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Zr(Qr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new si(e)},si.$=function(){return new si([])},si),ii=(oi.B=function(t){return new oi(ei.k(t))},oi.U=function(t){return new oi(ei.k(t).V(5))},oi.prototype.W=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},oi.prototype.isEqual=function(t){return null!==t&&0===ei.P(this.path,t.path)},oi.prototype.toString=function(){return this.path.toString()},oi.P=function(t,e){return ei.P(t.path,e.path)},oi.j=function(t){return t.length%2==0},oi.K=function(t){return new oi(new ei(t.slice()))},oi);function oi(t){this.path=t}function si(){return null!==Wr&&Wr.apply(this,arguments)||this}function ui(){return null!==Kr&&Kr.apply(this,arguments)||this}function ai(t,e,n){void 0===e?e=0:e>t.length&&Or(),void 0===n?n=t.length-e:n>t.length-e&&Or(),this.segments=t,this.offset=e,this.R=n}function hi(t){this.timestamp=t}function ci(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Zr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Zr(Qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Zr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Zr(Qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function fi(t,e){var n=this;return(n=Yr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function li(t,e){this.h=t,this.u=e,this.l={}}function pi(t){return null==t}function di(t){return-0===t&&1/t==-1/0}function yi(t){return"number"==typeof t&&Number.isInteger(t)&&!di(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var vi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.G=null};function gi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new vi(t,e,n,r,i,o,s)}function mi(t){var e,n=t;return null===n.G&&(e=n.path.F(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.F()+e.op.toString()+Eo(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.F()+e.dir;var e}).join(","),pi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=Ju(n.startAt)),n.endAt&&(e+="|ub:",e+=Ju(n.endAt)),n.G=e),n.G}function wi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!go(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ta(t.startAt,e.startAt)&&ta(t.endAt,e.endAt)}function bi(t){return ii.j(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ei=(Ii.fromBase64String=function(t){return new Ii(atob(t))},Ii.fromUint8Array=function(t){return new Ii(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Ii.prototype.toBase64=function(){return t=this.H,btoa(t);var t},Ii.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.H)},Ii.prototype.Y=function(){return 2*this.H.length},Ii.prototype.o=function(t){return Vr(this.H,t.H)},Ii.prototype.isEqual=function(t){return this.H===t.H},Ii);function Ii(t){this.H=t}function Ti(t){this.count=t}Ei.J=new Ei("");var Ni,_i,Ai=(Si.prototype.tt=function(t){return new Si(this.target,this.targetId,this.X,t,this.Z,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Si.prototype.et=function(t,e){return new Si(this.target,this.targetId,this.X,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Si.prototype.nt=function(t){return new Si(this.target,this.targetId,this.X,this.sequenceNumber,this.Z,t,this.resumeToken)},Si);function Si(t,e,n,r,i,o,s){void 0===i&&(i=$r.min()),void 0===o&&(o=$r.min()),void 0===s&&(s=Ei.J),this.target=t,this.targetId=e,this.X=n,this.sequenceNumber=r,this.Z=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Di(t){switch(t){case Qr.OK:return Or(),0;case Qr.CANCELLED:case Qr.UNKNOWN:case Qr.DEADLINE_EXCEEDED:case Qr.RESOURCE_EXHAUSTED:case Qr.INTERNAL:case Qr.UNAVAILABLE:case Qr.UNAUTHENTICATED:return;case Qr.INVALID_ARGUMENT:case Qr.NOT_FOUND:case Qr.ALREADY_EXISTS:case Qr.PERMISSION_DENIED:case Qr.FAILED_PRECONDITION:case Qr.ABORTED:case Qr.OUT_OF_RANGE:case Qr.UNIMPLEMENTED:case Qr.DATA_LOSS:return 1;default:return Or(),0}}function ki(t){if(void 0===t)return Rr("GRPC error has no .code"),Qr.UNKNOWN;switch(t){case Ni.OK:return Qr.OK;case Ni.CANCELLED:return Qr.CANCELLED;case Ni.UNKNOWN:return Qr.UNKNOWN;case Ni.DEADLINE_EXCEEDED:return Qr.DEADLINE_EXCEEDED;case Ni.RESOURCE_EXHAUSTED:return Qr.RESOURCE_EXHAUSTED;case Ni.INTERNAL:return Qr.INTERNAL;case Ni.UNAVAILABLE:return Qr.UNAVAILABLE;case Ni.UNAUTHENTICATED:return Qr.UNAUTHENTICATED;case Ni.INVALID_ARGUMENT:return Qr.INVALID_ARGUMENT;case Ni.NOT_FOUND:return Qr.NOT_FOUND;case Ni.ALREADY_EXISTS:return Qr.ALREADY_EXISTS;case Ni.PERMISSION_DENIED:return Qr.PERMISSION_DENIED;case Ni.FAILED_PRECONDITION:return Qr.FAILED_PRECONDITION;case Ni.ABORTED:return Qr.ABORTED;case Ni.OUT_OF_RANGE:return Qr.OUT_OF_RANGE;case Ni.UNIMPLEMENTED:return Qr.UNIMPLEMENTED;case Ni.DATA_LOSS:return Qr.DATA_LOSS;default:return Or()}}(_i=Ni=Ni||{})[_i.OK=0]="OK",_i[_i.CANCELLED=1]="CANCELLED",_i[_i.UNKNOWN=2]="UNKNOWN",_i[_i.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_i[_i.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_i[_i.NOT_FOUND=5]="NOT_FOUND",_i[_i.ALREADY_EXISTS=6]="ALREADY_EXISTS",_i[_i.PERMISSION_DENIED=7]="PERMISSION_DENIED",_i[_i.UNAUTHENTICATED=16]="UNAUTHENTICATED",_i[_i.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_i[_i.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_i[_i.ABORTED=10]="ABORTED",_i[_i.OUT_OF_RANGE=11]="OUT_OF_RANGE",_i[_i.UNIMPLEMENTED=12]="UNIMPLEMENTED",_i[_i.INTERNAL=13]="INTERNAL",_i[_i.UNAVAILABLE=14]="UNAVAILABLE",_i[_i.DATA_LOSS=15]="DATA_LOSS";var Ri=(Ci.prototype.st=function(t,e){return new Ci(this.P,this.root.st(t,e,this.P).copy(null,null,xi.it,null,null))},Ci.prototype.remove=function(t){return new Ci(this.P,this.root.remove(t,this.P).copy(null,null,xi.it,null,null))},Ci.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Ci.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Ci.prototype._=function(){return this.root._()},Object.defineProperty(Ci.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Ci.prototype.rt=function(){return this.root.rt()},Ci.prototype.ot=function(){return this.root.ot()},Ci.prototype.ht=function(t){return this.root.ht(t)},Ci.prototype.forEach=function(n){this.ht(function(t,e){return n(t,e),!1})},Ci.prototype.toString=function(){var n=[];return this.ht(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Ci.prototype.at=function(t){return this.root.at(t)},Ci.prototype.ct=function(){return new Li(this.root,null,this.P,!1)},Ci.prototype.ut=function(t){return new Li(this.root,t,this.P,!1)},Ci.prototype.lt=function(){return new Li(this.root,null,this.P,!0)},Ci.prototype._t=function(t){return new Li(this.root,t,this.P,!0)},Ci),Li=(Pi.prototype.wt=function(){var t=this.dt.pop(),e={key:t.key,value:t.value};if(this.ft)for(t=t.left;!t._();)this.dt.push(t),t=t.right;else for(t=t.right;!t._();)this.dt.push(t),t=t.left;return e},Pi.prototype.Tt=function(){return 0<this.dt.length},Pi.prototype.Et=function(){if(0===this.dt.length)return null;var t=this.dt[this.dt.length-1];return{key:t.key,value:t.value}},Pi),xi=(Oi.prototype.copy=function(t,e,n,r,i){return new Oi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Oi.prototype._=function(){return!1},Oi.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},Oi.prototype.at=function(t){return this.right.at(t)||t(this.key,this.value)||this.left.at(t)},Oi.prototype.min=function(){return this.left._()?this:this.left.min()},Oi.prototype.rt=function(){return this.min().key},Oi.prototype.ot=function(){return this.right._()?this.key:this.right.ot()},Oi.prototype.st=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.st(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.st(t,e,n))).It()},Oi.prototype.At=function(){if(this.left._())return Oi.EMPTY;var t=this;return t.left.Rt()||t.left.left.Rt()||(t=t.Pt()),(t=t.copy(null,null,null,t.left.At(),null)).It()},Oi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left._()||r.left.Rt()||r.left.left.Rt()||(r=r.Pt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Rt()&&(r=r.gt()),r.right._()||r.right.Rt()||r.right.left.Rt()||(r=r.Vt()),0===e(t,r.key)){if(r.right._())return Oi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.At())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.It()},Oi.prototype.Rt=function(){return this.color},Oi.prototype.It=function(){var t=this;return t.right.Rt()&&!t.left.Rt()&&(t=t.yt()),t.left.Rt()&&t.left.left.Rt()&&(t=t.gt()),t.left.Rt()&&t.right.Rt()&&(t=t.pt()),t},Oi.prototype.Pt=function(){var t=this.pt();return t.right.left.Rt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.gt())).yt()).pt()),t},Oi.prototype.Vt=function(){var t=this.pt();return t.left.left.Rt()&&(t=(t=t.gt()).pt()),t},Oi.prototype.yt=function(){var t=this.copy(null,null,Oi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Oi.prototype.gt=function(){var t=this.copy(null,null,Oi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Oi.prototype.pt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Oi.prototype.bt=function(){var t=this.vt();return Math.pow(2,t)<=this.size+1},Oi.prototype.vt=function(){if(this.Rt()&&this.left.Rt())throw Or();if(this.right.Rt())throw Or();var t=this.left.vt();if(t!==this.right.vt())throw Or();return t+(this.Rt()?0:1)},Oi);function Oi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Oi.RED,this.left=null!=r?r:Oi.EMPTY,this.right=null!=i?i:Oi.EMPTY,this.size=this.left.size+1+this.right.size}function Pi(t,e,n,r){this.ft=r,this.dt=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ft?t.left:t.right;else{if(0===i){this.dt.push(t);break}this.dt.push(t),t=this.ft?t.right:t.left}}function Ci(t,e){this.P=t,this.root=e||xi.EMPTY}function Ui(){this.size=0}xi.EMPTY=null,xi.RED=!0,xi.it=!1,xi.EMPTY=(Object.defineProperty(Ui.prototype,"key",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"value",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"color",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"left",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(Ui.prototype,"right",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Ui.prototype.copy=function(t,e,n,r,i){return this},Ui.prototype.st=function(t,e,n){return new xi(t,e)},Ui.prototype.remove=function(t,e){return this},Ui.prototype._=function(){return!0},Ui.prototype.ht=function(t){return!1},Ui.prototype.at=function(t){return!1},Ui.prototype.rt=function(){return null},Ui.prototype.ot=function(){return null},Ui.prototype.Rt=function(){return!1},Ui.prototype.bt=function(){return!0},Ui.prototype.vt=function(){return 0},new Ui);var Vi=(ji.prototype.has=function(t){return null!==this.data.get(t)},ji.prototype.first=function(){return this.data.rt()},ji.prototype.last=function(){return this.data.ot()},Object.defineProperty(ji.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),ji.prototype.indexOf=function(t){return this.data.indexOf(t)},ji.prototype.forEach=function(n){this.data.ht(function(t,e){return n(t),!1})},ji.prototype.St=function(t,e){for(var n=this.data.ut(t[0]);n.Tt();){var r=n.wt();if(0<=this.P(r.key,t[1]))return;e(r.key)}},ji.prototype.Dt=function(t,e){for(var n=void 0!==e?this.data.ut(e):this.data.ct();n.Tt();)if(!t(n.wt().key))return},ji.prototype.Ct=function(t){var e=this.data.ut(t);return e.Tt()?e.wt().key:null},ji.prototype.ct=function(){return new Mi(this.data.ct())},ji.prototype.ut=function(t){return new Mi(this.data.ut(t))},ji.prototype.add=function(t){return this.copy(this.data.remove(t).st(t,!0))},ji.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},ji.prototype._=function(){return this.data._()},ji.prototype.Nt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},ji.prototype.isEqual=function(t){if(!(t instanceof ji))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ct(),n=t.data.ct();e.Tt();){var r=e.wt().key,i=n.wt().key;if(0!==this.P(r,i))return!1}return!0},ji.prototype.N=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},ji.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},ji.prototype.copy=function(t){var e=new ji(this.P);return e.data=t,e},ji),Mi=(qi.prototype.wt=function(){return this.Ft.wt().key},qi.prototype.Tt=function(){return this.Ft.Tt()},qi),Fi=new Ri(ii.P);function qi(t){this.Ft=t}function ji(t){this.P=t,this.data=new Ri(this.P)}var Gi=new Ri(ii.P),Bi=new Ri(ii.P),zi=new Vi(ii.P);function Hi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=zi,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Wi=new Vi(Vr);function Ki(t,e,n,r){this.te=t,this.removedTargetIds=e,this.key=n,this.ee=r}function Yi(t,e){this.targetId=t,this.ne=e}function Xi(t,e,n,r){void 0===n&&(n=Ei.J),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Qi=(ho.xt=function(t){return new ho(t.P)},ho.prototype.has=function(t){return null!=this.kt.get(t)},ho.prototype.get=function(t){return this.kt.get(t)},ho.prototype.first=function(){return this.$t.rt()},ho.prototype.last=function(){return this.$t.ot()},ho.prototype._=function(){return this.$t._()},ho.prototype.indexOf=function(t){var e=this.kt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(ho.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),ho.prototype.forEach=function(n){this.$t.ht(function(t,e){return n(t),!1})},ho.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.kt.st(t.key,t),e.$t.st(t,null))},ho.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.kt.remove(t),this.$t.remove(e)):this},ho.prototype.isEqual=function(t){if(!(t instanceof ho))return!1;if(this.size!==t.size)return!1;for(var e=this.$t.ct(),n=t.$t.ct();e.Tt();){var r=e.wt().key,i=n.wt().key;if(!r.isEqual(i))return!1}return!0},ho.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ho.prototype.copy=function(t,e){var n=new ho;return n.P=this.P,n.kt=t,n.$t=e,n},ho),Zi=(ao.prototype.track=function(t){var e=t.doc.key,n=this.Ot.get(e);!n||0!==t.type&&3===n.type?this.Ot=this.Ot.st(e,t):3===t.type&&1!==n.type?this.Ot=this.Ot.st(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ot=this.Ot.st(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ot=this.Ot.remove(e):1===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):Or()},ao.prototype.Mt=function(){var n=[];return this.Ot.ht(function(t,e){n.push(e)}),n},ao),Ji=(uo.Qt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new uo(t,e,Qi.xt(e),i,n,r,!0,!1)},Object.defineProperty(uo.prototype,"hasPendingWrites",{get:function(){return!this.qt._()},enumerable:!1,configurable:!0}),uo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.qt.isEqual(t.qt)&&Eu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Lt.isEqual(t.Lt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},uo),$i=(so.zt=function(t,e){var n=new Map;return n.set(t,to.Ht(t,e)),new so($r.min(),n,Wi,Fi,Hi())},so),to=(oo.Ht=function(t,e){return new oo(Ei.J,e,Hi(),Hi(),Hi())},oo),eo=(Object.defineProperty(io.prototype,"Yt",{get:function(){return this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"resumeToken",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"ae",{get:function(){return 0!==this.se},enumerable:!1,configurable:!0}),Object.defineProperty(io.prototype,"ce",{get:function(){return this.he},enumerable:!1,configurable:!0}),io.prototype.ue=function(t){0<t.Y()&&(this.he=!0,this.re=t)},io.prototype.le=function(){var n=Hi(),r=Hi(),i=Hi();return this.ie.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Or()}}),new to(this.re,this.oe,n,r,i)},io.prototype._e=function(){this.he=!1,this.ie=fo()},io.prototype.fe=function(t,e){this.he=!0,this.ie=this.ie.st(t,e)},io.prototype.de=function(t){this.he=!0,this.ie=this.ie.remove(t)},io.prototype.we=function(){this.se+=1},io.prototype.Te=function(){--this.se},io.prototype.Ee=function(){this.he=!0,this.oe=!0},io),no=(ro.prototype.ge=function(t){for(var e=0,n=t.te;e<n.length;e++){var r=n[e];t.ee instanceof iu?this.Ve(r,t.ee):t.ee instanceof ou&&this.ye(r,t.key,t.ee)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ye(s,t.key,t.ee)}},ro.prototype.pe=function(n){var r=this;this.be(n,function(t){var e=r.ve(t);switch(n.state){case 0:r.Se(t)&&e.ue(n.resumeToken);break;case 1:e.Te(),e.ae||e._e(),e.ue(n.resumeToken);break;case 2:e.Te(),e.ae||r.removeTarget(t);break;case 3:r.Se(t)&&(e.Ee(),e.ue(n.resumeToken));break;case 4:r.Se(t)&&(r.De(t),e.ue(n.resumeToken));break;default:Or()}})},ro.prototype.be=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ie.forEach(function(t,e){r.Se(e)&&n(e)})},ro.prototype.Ce=function(t){var e,n,r=t.targetId,i=t.ne.count,o=this.Ne(r);o&&(bi(e=o.target)?0===i?(n=new ii(e.path),this.ye(r,n,new ou(n,$r.min()))):Pr(1===i):this.Fe(r)!==i&&(this.De(r),this.Pe=this.Pe.add(r)))},ro.prototype.ke=function(i){var o=this,s=new Map;this.Ie.forEach(function(t,e){var n,r=o.Ne(e);r&&(t.Yt&&bi(r.target)&&(n=new ii(r.target.path),null!==o.Ae.get(n)||o.$e(e,n)||o.ye(e,n,new ou(n,i))),t.ce&&(s.set(e,t.le()),t._e()))});var r=Hi();this.Re.forEach(function(t,e){var n=!0;e.Dt(function(t){var e=o.Ne(t);return!e||2===e.X||(n=!1)}),n&&(r=r.add(t))});var t=new $i(i,s,this.Pe,this.Ae,r);return this.Ae=Fi,this.Re=co(),this.Pe=new Vi(Vr),t},ro.prototype.Ve=function(t,e){var n;this.Se(t)&&(n=this.$e(t,e.key)?2:0,this.ve(t).fe(e.key,n),this.Ae=this.Ae.st(e.key,e),this.Re=this.Re.st(e.key,this.xe(e.key).add(t)))},ro.prototype.ye=function(t,e,n){var r;this.Se(t)&&(r=this.ve(t),this.$e(t,e)?r.fe(e,1):r.de(e),this.Re=this.Re.st(e,this.xe(e).delete(t)),n&&(this.Ae=this.Ae.st(e,n)))},ro.prototype.removeTarget=function(t){this.Ie.delete(t)},ro.prototype.Fe=function(t){var e=this.ve(t).le();return this.me.Oe(t).size+e.Jt.size-e.Zt.size},ro.prototype.we=function(t){this.ve(t).we()},ro.prototype.ve=function(t){var e=this.Ie.get(t);return e||(e=new eo,this.Ie.set(t,e)),e},ro.prototype.xe=function(t){var e=this.Re.get(t);return e||(e=new Vi(Vr),this.Re=this.Re.st(t,e)),e},ro.prototype.Se=function(t){var e=null!==this.Ne(t);return e||kr("WatchChangeAggregator","Detected inactive target",t),e},ro.prototype.Ne=function(t){var e=this.Ie.get(t);return e&&e.ae?null:this.me.Me(t)},ro.prototype.De=function(e){var n=this;this.Ie.set(e,new eo),this.me.Oe(e).forEach(function(t){n.ye(e,t,null)})},ro.prototype.$e=function(t,e){return this.me.Oe(t).has(e)},ro);function ro(t){this.me=t,this.Ie=new Map,this.Ae=Fi,this.Re=co(),this.Pe=new Vi(Vr)}function io(){this.se=0,this.ie=fo(),this.re=Ei.J,this.oe=!1,this.he=!0}function oo(t,e,n,r,i){this.resumeToken=t,this.Yt=e,this.Jt=n,this.Xt=r,this.Zt=i}function so(t,e,n,r,i){this.Z=t,this.Wt=e,this.jt=n,this.Kt=r,this.Gt=i}function uo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Lt=n,this.docChanges=r,this.qt=i,this.fromCache=o,this.Bt=s,this.Ut=u}function ao(){this.Ot=new Ri(ii.P)}function ho(n){this.P=n?function(t,e){return n(t,e)||ii.P(t.key,e.key)}:function(t,e){return ii.P(t.key,e.key)},this.kt=Gi,this.$t=new Ri(this.P)}function co(){return new Ri(ii.P)}function fo(){return new Ri(ii.P)}function lo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function po(t){var e=Io(t.mapValue.fields.__local_write_time__.timestampValue);return new Jr(e.seconds,e.nanos)}var yo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?lo(t)?4:10:Or()}function go(r,i){var t,e,n,o=vo(r);if(o!==vo(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return po(r).isEqual(po(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Io(r.timestampValue),n=Io(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,No(r.bytesValue).isEqual(No(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,To((t=r).geoPointValue.latitude)===To(e.geoPointValue.latitude)&&To(t.geoPointValue.longitude)===To(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return To(t.integerValue)===To(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=To(t.doubleValue),r=To(e.doubleValue);return n===r?di(n)===di(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Mr(r.arrayValue.values||[],i.arrayValue.values||[],go);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Br(t)!==Br(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!go(t[n],e[n])))return!1;return!0}();default:return Or()}}function mo(t,e){return void 0!==(t.values||[]).find(function(t){return go(t,e)})}function wo(t,e){var n,r,i,o,s,u,a,h,c,f,l=vo(t),p=vo(e);if(l!==p)return Vr(l,p);switch(l){case 0:return 0;case 1:return Vr(t.booleanValue,e.booleanValue);case 2:return h=e,(c=To(t.integerValue||t.doubleValue))<(f=To(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return bo(t.timestampValue,e.timestampValue);case 4:return bo(po(t),po(e));case 5:return Vr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=No(o),a=No(s),u.o(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Vr(n[i],r[i]);if(0!==o)return o}return Vr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Vr(To(n.latitude),To(r.latitude)))?i:Vr(To(n.longitude),To(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=wo(n[i],r[i]);if(o)return o}return Vr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Vr(r[s],o[s]);if(0!==u)return u;var a=wo(n[r[s]],i[o[s]]);if(0!==a)return a}return Vr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Or()}}function bo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Vr(t,e);var n=Io(t),r=Io(e),i=Vr(n.seconds,r.seconds);return 0!==i?i:Vr(n.nanos,r.nanos)}function Eo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Io(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?No(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,ii.U(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Or();var t,e,n}(t)}function Io(t){if(Pr(!!t),"string"!=typeof t)return{seconds:To(t.seconds),nanos:To(t.nanos)};var e,n=0,r=yo.exec(t);Pr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function To(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function No(t){return"string"==typeof t?Ei.fromBase64String(t):Ei.fromUint8Array(t)}function _o(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.F()}}function Ao(t){return t&&"integerValue"in t}function So(t){return!!t&&"arrayValue"in t}function Do(t){return t&&"nullValue"in t}function ko(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ro(t){return t&&"mapValue"in t}var Lo={asc:"ASCENDING",desc:"DESCENDING"},xo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Oo=function(t,e){this.s=t,this.Le=e};function Po(t){return{integerValue:""+t}}function Co(t,e){if(t.Le){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:di(e)?"-0":e}}function Uo(t,e){return yi(e)?Po(e):Co(t,e)}function Vo(t,e){return t.Le?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mo(t,e){return t.Le?e.toBase64():e.toUint8Array()}function Fo(t){return Pr(!!t),$r.m((e=Io(t),new Jr(e.seconds,e.nanos)));var e}function qo(t,e){return new ei(["projects",t.projectId,"databases",t.database]).child("documents").child(e).F()}function jo(t){var e=ei.k(t);return Pr(rs(e)),e}function Go(t,e){return qo(t.s,e.path)}function Bo(t,e){var n=jo(e);return Pr(n.get(1)===t.s.projectId),Pr(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new ii(Ko(n))}function zo(t,e){return qo(t.s,e)}function Ho(t){var e=jo(t);return 4===e.length?ei.$():Ko(e)}function Wo(t){return new ei(["projects",t.s.projectId,"databases",t.s.database]).F()}function Ko(t){return Pr(4<t.length&&"documents"===t.get(4)),t.V(5)}function Yo(t,e,n){return{name:Go(t,e),fields:n.proto.mapValue.fields}}function Xo(t,e){var n,r,i,o;if(e instanceof Cs)n={update:Yo(t,e.key,e.value)};else if(e instanceof Ws)n={delete:Go(t,e.key)};else if(e instanceof Us)n={update:Yo(t,e.key,e.data),updateMask:(r=e.qe,i=[],r.fields.forEach(function(t){return i.push(t.F())}),{fieldPaths:i})};else if(e instanceof js)n={transform:{document:Go(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof as)return{fieldPath:t.field.F(),setToServerValue:"REQUEST_TIME"};if(e instanceof hs)return{fieldPath:t.field.F(),appendMissingElements:{values:e.elements}};if(e instanceof ds)return{fieldPath:t.field.F(),removeAllFromArray:{values:e.elements}};if(e instanceof ms)return{fieldPath:t.field.F(),increment:e.Be};throw Or()})}};else{if(!(e instanceof Ks))return Or();n={verify:Go(t,e.key)}}return e.Qe.Ue||(n.currentDocument=void 0!==(o=e.Qe).updateTime?{updateTime:Vo(t,o.updateTime.A())}:void 0!==o.exists?{exists:o.exists}:Or()),n}function Qo(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?As.updateTime(Fo(n.updateTime)):void 0!==n.exists?As.exists(n.exists):As.We():As.We();if(t.update){t.update.name;var o=Bo(e,t.update.name),s=new Ys({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Is(r.map(function(t){return ri.q(t)})));return new Us(o,s,u,i)}return new Cs(o,s,i)}if(t.delete){var a=Bo(e,t.delete);return new Ws(a,i)}if(t.transform){var h=Bo(e,t.transform.document),c=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(Pr("REQUEST_TIME"===e.setToServerValue),i=new as):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new hs(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new ds(r)):"increment"in e?i=new ms(t,e.increment):Or();var o=ri.q(e.fieldPath);return new Ts(o,i)}(e,t)});return Pr(!0===i.exists),new js(h,c)}if(t.verify){var f=Bo(e,t.verify);return new Ks(f,i)}return Or()}function Zo(t,e){return{documents:[zo(t,e.path)]}}function Jo(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=zo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=zo(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){if("=="===t.op){if(ko(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NAN"}};if(Do(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ko(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NOT_NAN"}};if(Do(t.value))return{unaryFilter:{field:es(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:es(t.field),op:(e=t.op,xo[e]),value:t.value}};var e});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:es((e=t).field),direction:(n=e.dir,Lo[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Le||pi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=$o(e.startAt)),e.endAt&&(n.structuredQuery.endAt=$o(e.endAt)),n}function $o(t){return{before:t.before,values:t.position}}function ts(t){var e=!!t.before,n=t.values||[];return new Ku(n,e)}function es(t){return{fieldPath:t.F()}}function ns(t){return ri.q(t.fieldPath)}function rs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function is(){this.je=void 0}function os(t,e){return t instanceof ms?Ao(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var ss,us,as=(n(fs,us=is),fs),hs=(n(cs,ss=is),cs);function cs(t){var e=this;return(e=ss.call(this)||this).elements=t,e}function fs(){return null!==us&&us.apply(this,arguments)||this}function ls(t,e){for(var n=Es(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return go(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var ps,ds=(n(ys,ps=is),ys);function ys(t){var e=this;return(e=ps.call(this)||this).elements=t,e}function vs(t,e){for(var n=Es(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!go(t,e)})}(i[r]);return{arrayValue:{values:n}}}var gs,ms=(n(ws,gs=is),ws);function ws(t,e){var n=this;return(n=gs.call(this)||this).serializer=t,n.Be=e,n}function bs(t){return To(t.integerValue||t.doubleValue)}function Es(t){return So(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Is=(Ns.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},Ns.prototype.isEqual=function(t){return Mr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Ns),Ts=function(t,e){this.field=t,this.transform=e};function Ns(t){(this.fields=t).sort(ri.P)}function _s(t,e){this.version=t,this.transformResults=e}var As=(Ss.We=function(){return new Ss},Ss.exists=function(t){return new Ss(void 0,t)},Ss.updateTime=function(t){return new Ss(t)},Object.defineProperty(Ss.prototype,"Ue",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Ss.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Ss);function Ss(t,e){this.updateTime=t,this.exists=e}function Ds(t,e){return void 0!==t.updateTime?e instanceof iu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof iu}function ks(){}function Rs(t,e,n,r){return t instanceof Cs?function(t,e){if(!Ds(t.Qe,e))return e;var n=xs(e);return new iu(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof Us?function(t,e){if(!Ds(t.Qe,e))return e;var n=xs(e),r=Fs(t,e);return new iu(t.key,n,r,{Ge:!0})}(t,e):t instanceof js?function(t,e,n,r){if(!Ds(t.Qe,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,h,c=[],f=0,l=t;f<l.length;f++){var p=l[f],d=p.transform,y=null;n instanceof iu&&(y=n.field(p.field)),null===y&&r instanceof iu&&(y=r.field(p.field)),c.push((o=y,h=a=u=s=void 0,(i=d)instanceof as?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof hs?ls(i,o):i instanceof ds?vs(i,o):(a=bs(u=os(s=i,o))+bs(s.Be),Ao(u)&&Ao(s.Be)?Po(a):Co(s.serializer,a))))}return c}(t.fieldTransforms,n,e,r),s=Bs(t,i.data(),o);return new iu(t.key,i.version,s,{Ge:!0})}(t,e,r,n):(o=e,Ds((i=t).Qe,o)?new ou(i.key,$r.min()):o);var i,o}function Ls(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Qe.isEqual(e.Qe)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.qe.isEqual(e.qe):2!==t.type||Mr(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof hs&&o instanceof hs||i instanceof ds&&o instanceof ds?Mr(i.elements,o.elements,go):i instanceof ms&&o instanceof ms?go(i.Be,o.Be):i instanceof as&&o instanceof as);var n,r,i,o}))}function xs(t){return t instanceof iu?t.version:$r.min()}var Os,Ps,Cs=(n(Ms,Ps=ks),Ms),Us=(n(Vs,Os=ks),Vs);function Vs(t,e,n,r){var i=this;return(i=Os.call(this)||this).key=t,i.data=e,i.qe=n,i.Qe=r,i.type=1,i}function Ms(t,e,n){var r=this;return(r=Ps.call(this)||this).key=t,r.value=e,r.Qe=n,r.type=0,r}function Fs(t,e){return n=t,r=e instanceof iu?e.data():Ys.empty(),i=new Xs(r),n.qe.fields.forEach(function(t){var e;t._()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.ze();var n,r,i}var qs,js=(n(Gs,qs=ks),Gs);function Gs(t,e){var n=this;return(n=qs.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Qe=As.exists(!0),n}function Bs(t,e,n){for(var r=new Xs(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var zs,Hs,Ws=(n($s,Hs=ks),$s),Ks=(n(Js,zs=ks),Js),Ys=(Zs.empty=function(){return new Zs({mapValue:{}})},Zs.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ro(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},Zs.prototype.isEqual=function(t){return go(this.proto,t.proto)},Zs),Xs=(Qs.prototype.set=function(t,e){return this.Je(t,e),this},Qs.prototype.delete=function(t){return this.Je(t,null),this},Qs.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===vo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.S(),e)},Qs.prototype.ze=function(){var t=this.Xe(ri.$(),this.Ye);return null!=t?new Ys(t):this.He},Qs.prototype.Xe=function(r,t){var i=this,o=!1,e=this.He.field(r),s=Ro(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.Xe(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Qs);function Qs(t){void 0===t&&(t=Ys.empty()),this.He=t,this.Ye=new Map}function Zs(t){this.proto=t}function Js(t,e){var n=this;return(n=zs.call(this)||this).key=t,n.Qe=e,n.type=4,n}function $s(t,e){var n=this;return(n=Hs.call(this)||this).key=t,n.Qe=e,n.type=3,n}function tu(t,e){this.key=t,this.version=e}var eu,nu,ru,iu=(n(hu,ru=tu),hu.prototype.field=function(t){return this.Ze.field(t)},hu.prototype.data=function(){return this.Ze},hu.prototype.tn=function(){return this.Ze.proto},hu.prototype.isEqual=function(t){return t instanceof hu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},hu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(hu.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),hu),ou=(n(au,nu=tu),au.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(au.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),au.prototype.isEqual=function(t){return t instanceof au&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},au),su=(n(uu,eu=tu),uu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(uu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),uu.prototype.isEqual=function(t){return t instanceof uu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},uu);function uu(){return null!==eu&&eu.apply(this,arguments)||this}function au(t,e,n){var r=this;return(r=nu.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function hu(t,e,n,r){var i=this;return(i=ru.call(this,t,e)||this).Ze=n,i.Ge=!!r.Ge,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function cu(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Zr(Qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new Zr(Qr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}var fu=(lu.prototype.on=function(t){return new lu(t,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},lu.prototype.hn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.M())},lu.prototype.an=function(){return!pi(this.limit)&&"F"===this.nn},lu.prototype.cn=function(){return!pi(this.limit)&&"L"===this.nn},lu.prototype.un=function(){return 0<this.en.length?this.en[0].field:null},lu.prototype.ln=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n._n())return n.field}return null},lu.prototype.fn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(0<=t.indexOf(r.op))return r.op}return null},lu);function lu(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt,this.endAt}function pu(t,e,n,r,i,o,s,u){return new fu(t,e,n,r,i,o,s,u)}function du(t){return new fu(t)}function yu(t){return null!==t.collectionGroup}function vu(t){var e=cu(t,fu);if(null===e.sn){e.sn=[];var n=e.ln(),r=e.un();if(null!==n&&null===r)n.M()||e.sn.push(new ea(n)),e.sn.push(new ea(ri.L(),"asc"));else{for(var i,o=!1,s=0,u=e.en;s<u.length;s++){var a=u[s];e.sn.push(a),a.field.M()&&(o=!0)}o||(i=0<e.en.length?e.en[e.en.length-1].dir:"asc",e.sn.push(new ea(ri.L(),i)))}}return e.sn}function gu(t){var e=cu(t,fu);if(!e.rn)if("F"===e.nn)e.rn=gi(e.path,e.collectionGroup,vu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=vu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ea(o.field,s))}var u=e.endAt?new Ku(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Ku(e.startAt.position,!e.startAt.before):null;e.rn=gi(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.rn}function mu(t,e,n){return new fu(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function wu(t,e){return new fu(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,e,t.endAt)}function bu(t,e){return new fu(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,t.startAt,e)}function Eu(t,e){return wi(gu(t),gu(e))&&t.nn===e.nn}function Iu(t){return mi(gu(t))+"|lt:"+t.nn}function Tu(t){return"Query(target="+(n=(e=gu(t)).path.F(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.F()+" "+e.op+" "+Eo(e.value);var e}).join(", ")+"]"),pi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.F()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Ju(e.startAt)),e.endAt&&(n+=", endAt: "+Ju(e.endAt)),"Target("+n+")")+"; limitType="+t.nn+")";var e,n}function Nu(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.W(r.collectionGroup)&&r.path.D(o):ii.j(r.path)?r.path.isEqual(o):r.path.C(o))&&function(t){for(var e=0,n=i.en;e<n.length;e++){var r=n[e];if(!r.field.M()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||$u(e.startAt,vu(e),n))&&(!e.endAt||!$u(e.endAt,vu(e),n)));var e,n,r,o}function _u(u){return function(t,e){for(var n=!1,r=0,i=vu(u);r<i.length;r++){var o=i[r],s=function(t,e,n){var r,i,o,s,u=t.field.M()?ii.P(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?wo(o,s):Or());switch(t.dir){case"asc":return u;case"desc":return-1*u;default:return Or()}}(o,t,e);if(0!==s)return s;n=n||o.field.M()}return 0}}var Au,Su=(n(Du,Au=function(){}),Du.create=function(t,e,n){if(t.M())return"in"===e||"not-in"===e?this.dn(t,e,n):new xu(t,e,n);if(Do(n)){if("=="!==e&&"!="!==e)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Du(t,e,n)}if(ko(n)){if("=="!==e&&"!="!==e)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Du(t,e,n)}return"array-contains"===e?new Bu(t,n):"in"===e?new zu(t,n):"not-in"===e?new Hu(t,n):"array-contains-any"===e?new Wu(t,n):new Du(t,e,n)},Du.dn=function(t,e,n){return new("in"===e?Ou:Pu)(t,n)},Du.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.wn(wo(e,this.value)):null!==e&&vo(this.value)===vo(e)&&this.wn(wo(e,this.value))},Du.prototype.wn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Or()}},Du.prototype._n=function(){return 0<=["<","<=",">",">=","!="].indexOf(this.op)},Du);function Du(t,e,n){var r=this;return(r=Au.call(this)||this).field=t,r.op=e,r.value=n,r}var ku,Ru,Lu,xu=(n(Vu,Lu=Su),Vu.prototype.matches=function(t){var e=ii.P(t.key,this.key);return this.wn(e)},Vu),Ou=(n(Uu,Ru=Su),Uu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Uu),Pu=(n(Cu,ku=Su),Cu.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Cu);function Cu(t,e){var n=this;return(n=ku.call(this,t,"not-in",e)||this).keys=Mu(0,e),n}function Uu(t,e){var n=this;return(n=Ru.call(this,t,"in",e)||this).keys=Mu(0,e),n}function Vu(t,e,n){var r=this;return(r=Lu.call(this,t,e,n)||this).key=ii.U(n.referenceValue),r}function Mu(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return ii.U(t.referenceValue)})}var Fu,qu,ju,Gu,Bu=(n(Zu,Gu=Su),Zu.prototype.matches=function(t){var e=t.field(this.field);return So(e)&&mo(e.arrayValue,this.value)},Zu),zu=(n(Qu,ju=Su),Qu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&mo(this.value.arrayValue,e)},Qu),Hu=(n(Xu,qu=Su),Xu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&!mo(this.value.arrayValue,e)},Xu),Wu=(n(Yu,Fu=Su),Yu.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!So(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return mo(e.value.arrayValue,t)})},Yu),Ku=function(t,e){this.position=t,this.before=e};function Yu(t,e){return Fu.call(this,t,"array-contains-any",e)||this}function Xu(t,e){return qu.call(this,t,"not-in",e)||this}function Qu(t,e){return ju.call(this,t,"in",e)||this}function Zu(t,e){return Gu.call(this,t,"array-contains",e)||this}function Ju(t){return(t.before?"b":"a")+":"+t.position.map(Eo).join(",")}function $u(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.M()?ii.P(ii.U(s.referenceValue),n.key):wo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ta(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!go(t.position[n],e.position[n]))return!1;return!0}var ea=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e},na=(ma.prototype.En=function(t,e,n){for(var r,i,o,s=n.mn,u=0;u<this.mutations.length;u++){var a=this.mutations[u];a.key.isEqual(t)&&(r=a,i=e,o=s[u],e=r instanceof Cs?new iu(r.key,o.version,r.value,{hasCommittedMutations:!0}):r instanceof Us?function(t,e,n){if(!Ds(t.Qe,e))return new su(t.key,n.version);var r=Fs(t,e);return new iu(t.key,n.version,r,{hasCommittedMutations:!0})}(r,i,o):r instanceof js?function(t,e,n){if(Pr(null!=n.transformResults),!Ds(t.Qe,e))return new su(t.key,n.version);var r=e,i=function(t,e,n){var r=[];Pr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],h=a.transform,c=null;e instanceof iu&&(c=e.field(a.field)),r.push((i=h,o=c,s=n[u],i instanceof hs?ls(i,o):i instanceof ds?vs(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Bs(t,r.data(),i);return new iu(t.key,o,s,{hasCommittedMutations:!0})}(r,i,o):new ou(r.key,o.version,{hasCommittedMutations:!0}))}return e},ma.prototype.In=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Rs(i,e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Rs(a,e,o,this.Tn))}return e},ma.prototype.An=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.In(t.key,n.get(t.key));e&&(i=i.st(t.key,e))}),i},ma.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Hi())},ma.prototype.isEqual=function(t){return this.batchId===t.batchId&&Mr(this.mutations,t.mutations,Ls)&&Mr(this.baseMutations,t.baseMutations,Ls)},ma),ra=(ga.from=function(t,e,n){Pr(t.mutations.length===n.length);for(var r=Bi,i=t.mutations,o=0;o<i.length;o++)r=r.st(i[o].key,n[o].version);return new ga(t,e,n,r)},ga),ia=(va.prototype.catch=function(t){return this.next(void 0,t)},va.prototype.next=function(r,i){var o=this;return this.pn&&Or(),this.pn=!0,this.yn?this.error?this.bn(i,this.error):this.vn(r,this.result):new va(function(e,n){o.gn=function(t){o.vn(r,t).next(e,n)},o.Vn=function(t){o.bn(i,t).next(e,n)}})},va.prototype.Sn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},va.prototype.Dn=function(t){try{var e=t();return e instanceof va?e:va.resolve(e)}catch(t){return va.reject(t)}},va.prototype.vn=function(t,e){return t?this.Dn(function(){return t(e)}):va.resolve(e)},va.prototype.bn=function(t,e){return t?this.Dn(function(){return t(e)}):va.reject(e)},va.resolve=function(n){return new va(function(t,e){t(n)})},va.reject=function(n){return new va(function(t,e){e(n)})},va.Cn=function(t){return new va(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},va.Nn=function(t){for(var n=va.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?va.resolve(t):e()})}(r[e]);return n},va.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Cn(i)},va),oa=(Object.defineProperty(ya.prototype,"readTime",{get:function(){return this.$n},set:function(t){this.$n=t},enumerable:!1,configurable:!0}),ya.prototype.xn=function(t,e){this.On(),this.readTime=e,this.Fn.set(t.key,t)},ya.prototype.Mn=function(t,e){this.On(),e&&(this.readTime=e),this.Fn.set(t,null)},ya.prototype.Ln=function(t,e){this.On();var n=this.Fn.get(e);return void 0!==n?ia.resolve(n):this.qn(t,e)},ya.prototype.getEntries=function(t,e){return this.Bn(t,e)},ya.prototype.apply=function(t){return this.On(),this.kn=!0,this.Un(t)},ya.prototype.On=function(){},ya),sa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ua=(da.prototype.Wn=function(t){this.Qn.push(t)},da.prototype.jn=function(){this.Qn.forEach(function(t){return t()})},da),aa=(pa.prototype.Hn=function(e,n){var r=this;return this.Gn.Yn(e,n).next(function(t){return r.Jn(e,n,t)})},pa.prototype.Jn=function(t,r,i){return this.Kn.Ln(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].In(r,t);return t})},pa.prototype.Xn=function(t,e,i){var o=Fi;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].In(t,e);o=o.st(t,e)}),o},pa.prototype.Zn=function(e,t){var n=this;return this.Kn.getEntries(e,t).next(function(t){return n.ts(e,t)})},pa.prototype.ts=function(r,i){var o=this;return this.Gn.es(r,i).next(function(t){var e=o.Xn(r,i,t),n=Fi;return e.forEach(function(t,e){e=e||new ou(t,$r.min()),n=n.st(t,e)}),n})},pa.prototype.ns=function(t,e,n){return r=e,ii.j(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ss(t,e.path):yu(e)?this.rs(t,e,n):this.os(t,e,n);var r},pa.prototype.ss=function(t,e){return this.Hn(t,new ii(e)).next(function(t){var e=Gi;return t instanceof iu&&(e=e.st(t.key,t)),e})},pa.prototype.rs=function(n,r,i){var o=this,s=r.collectionGroup,u=Gi;return this.zn.hs(n,s).next(function(t){return ia.forEach(t,function(t){var e=r.on(t.child(s));return o.os(n,e,i).next(function(t){t.forEach(function(t,e){u=u.st(t,e)})})}).next(function(){return u})})},pa.prototype.os=function(e,n,t){var c,f,r=this;return this.Kn.ns(e,n,t).next(function(t){return c=t,r.Gn.as(e,n)}).next(function(t){return f=t,r.cs(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=Rs(s,a,a,r.Tn);c=h instanceof iu?c.st(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){Nu(n,e)||(c=c.remove(t))}),c})},pa.prototype.cs=function(t,e,n){for(var r=Hi(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Us&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Kn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof iu&&(h=h.st(t,e))}),h})},pa),ha=(la._s=function(t,e){for(var n=Hi(),r=Hi(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new la(t,e.fromCache,n,r)},la),ca=(fa.prototype.ds=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},fa.prototype.next=function(){var t=++this.previousValue;return this.ws&&this.ws(t),t},fa);function fa(t,e){var n=this;this.previousValue=t,e&&(e.fs=function(t){return n.ds(t)},this.ws=function(t){return e.Ts(t)})}function la(t,e,n,r){this.targetId=t,this.fromCache=e,this.us=n,this.ls=r}function pa(t,e,n){this.Kn=t,this.Gn=e,this.zn=n}function da(){this.Qn=[]}function ya(){this.Fn=new Xr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.kn=!1}function va(t){var e=this;this.gn=null,this.Vn=null,this.result=void 0,this.error=void 0,this.yn=!1,this.pn=!1,t(function(t){e.yn=!0,e.result=t,e.gn&&e.gn(t)},function(t){e.yn=!0,e.error=t,e.Vn&&e.Vn(t)})}function ga(t,e,n,r){this.batch=t,this.Rn=e,this.mn=n,this.Pn=r}function ma(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function wa(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}ca.Es=-1;var ba,Ea=(Da.prototype.reset=function(){this.gs=0},Da.prototype.ps=function(){this.gs=this.Ps},Da.prototype.bs=function(t){var e=this;this.cancel();var n=Math.floor(this.gs+this.vs()),r=Math.max(0,Date.now()-this.ys),i=Math.max(0,n-r);0<i&&kr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.gs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Vs=this.ms.Ss(this.Is,i,function(){return e.ys=Date.now(),t()}),this.gs*=this.Rs,this.gs<this.As&&(this.gs=this.As),this.gs>this.Ps&&(this.gs=this.Ps)},Da.prototype.Ds=function(){null!==this.Vs&&(this.Vs.Cs(),this.Vs=null)},Da.prototype.cancel=function(){null!==this.Vs&&(this.Vs.cancel(),this.Vs=null)},Da.prototype.vs=function(){return(Math.random()-.5)*this.gs},Da),Ia=(Sa.delete=function(t){return kr("SimpleDb","Removing database:",t),Pa(window.indexedDB.deleteDatabase(t)).Sn()},Sa.ks=function(){if("undefined"==typeof indexedDB)return!1;if(Sa.$s())return!0;var t=p(),e=Sa.Fs(t),n=0<e&&e<10,r=Sa.xs(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Sa.$s=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Os)},Sa.Ms=function(t,e){return t.store(e)},Sa.Fs=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Sa.xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Sa.prototype.Ls=function(){return g(this,void 0,void 0,function(){var e,o=this;return w(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(kr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(n,r){var i=indexedDB.open(o.name,o.version);i.onsuccess=function(t){var e=t.target.result;n(e)},i.onblocked=function(){r(new Na("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Zr(Qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Na(e))},i.onupgradeneeded=function(t){kr("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;o.Ns.createOrUpgrade(e,i.transaction,t.oldVersion,o.version).next(function(){kr("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.qs&&(this.db.onversionchange=function(t){return o.qs(t)}),this.db)]}})})},Sa.prototype.Bs=function(e){this.qs=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Sa.prototype.runTransaction=function(r,h,c){return g(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,a.Ls()];case 2:return a.db=t.sent(),e=Ra.open(a.db,s?"readonly":"readwrite",h),n=c(e).catch(function(t){return e.abort(t),ia.reject(t)}).Sn(),r={},n.catch(function(){}),[4,e.Us];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,kr("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),a.close(),o?[3,5]:[2,{value:Promise.reject(i)}];case 5:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Sa.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Sa),Ta=(Object.defineProperty(Aa.prototype,"yn",{get:function(){return this.Ws},enumerable:!1,configurable:!0}),Object.defineProperty(Aa.prototype,"Ks",{get:function(){return this.js},enumerable:!1,configurable:!0}),Object.defineProperty(Aa.prototype,"cursor",{set:function(t){this.Qs=t},enumerable:!1,configurable:!0}),Aa.prototype.done=function(){this.Ws=!0},Aa.prototype.Gs=function(t){this.js=t},Aa.prototype.delete=function(){return Pa(this.Qs.delete())},Aa),Na=(n(_a,ba=Zr),_a);function _a(t){var e=this;return(e=ba.call(this,Qr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Aa(t){this.Qs=t,this.Ws=!1,this.js=null}function Sa(t,e,n){this.name=t,this.version=e,this.Ns=n,12.2===Sa.Fs(p())&&Rr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Da(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.ms=t,this.Is=e,this.As=n,this.Rs=r,this.Ps=i,this.gs=0,this.Vs=null,this.ys=Date.now(),this.reset()}function ka(t){return"IndexedDbTransactionError"===t.name}var Ra=(Oa.open=function(t,e,n){try{return new Oa(t.transaction(n,e))}catch(t){throw new Na(t)}},Object.defineProperty(Oa.prototype,"Us",{get:function(){return this.zs.promise},enumerable:!1,configurable:!0}),Oa.prototype.abort=function(t){t&&this.zs.reject(t),this.aborted||(kr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Oa.prototype.store=function(t){var e=this.transaction.objectStore(t);return new La(e)},Oa),La=(xa.prototype.put=function(t,e){return Pa(void 0!==e?(kr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(kr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},xa.prototype.add=function(t){return kr("SimpleDb","ADD",this.store.name,t,t),Pa(this.store.add(t))},xa.prototype.get=function(e){var n=this;return Pa(this.store.get(e)).next(function(t){return void 0===t&&(t=null),kr("SimpleDb","GET",n.store.name,e,t),t})},xa.prototype.delete=function(t){return kr("SimpleDb","DELETE",this.store.name,t),Pa(this.store.delete(t))},xa.prototype.count=function(){return kr("SimpleDb","COUNT",this.store.name),Pa(this.store.count())},xa.prototype.Hs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ys(n,function(t,e){r.push(e)}).next(function(){return r})},xa.prototype.Js=function(t,e){kr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Xs=!1;var r=this.cursor(n);return this.Ys(r,function(t,e,n){return n.delete()})},xa.prototype.Zs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ys(r,e)},xa.prototype.ti=function(i){var t=this.cursor({});return new ia(function(n,r){t.onerror=function(t){var e=Ua(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},xa.prototype.Ys=function(t,s){var u=[];return new ia(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Ta(i),(n=s(i.primaryKey,i.value,e))instanceof ia&&(r=n.catch(function(t){return e.done(),ia.reject(t)}),u.push(r)),e.yn?o():null===e.Ks?i.continue():i.continue(e.Ks)):o()}}).next(function(){return ia.Cn(u)})},xa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},xa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Xs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},xa);function xa(t){this.store=t}function Oa(t){var n=this;this.transaction=t,this.aborted=!1,this.zs=new wa,this.transaction.oncomplete=function(){n.zs.resolve()},this.transaction.onabort=function(){t.error?n.zs.reject(new Na(t.error)):n.zs.resolve()},this.transaction.onerror=function(t){var e=Ua(t.target.error);n.zs.reject(new Na(e))}}function Pa(t){return new ia(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Ua(t.target.error);r(e)}})}var Ca=!1;function Ua(t){var e=Ia.Fs(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Zr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ca||(Ca=!0,setTimeout(function(){throw r},0)),r}}return t}function Va(){return"undefined"!=typeof window?window:null}function Ma(){return"undefined"!=typeof document?document:null}var Fa=(Ga.ri=function(t,e,n,r,i){var o=new Ga(t,e,Date.now()+n,r,i);return o.start(n),o},Ga.prototype.start=function(t){var e=this;this.oi=setTimeout(function(){return e.hi()},t)},Ga.prototype.Cs=function(){return this.hi()},Ga.prototype.cancel=function(t){null!==this.oi&&(this.clearTimeout(),this.ii.reject(new Zr(Qr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ga.prototype.hi=function(){var e=this;this.ei.ai(function(){return null!==e.oi?(e.clearTimeout(),e.op().then(function(t){return e.ii.resolve(t)})):Promise.resolve()})},Ga.prototype.clearTimeout=function(){null!==this.oi&&(this.si(this),clearTimeout(this.oi),this.oi=null)},Ga),qa=(Object.defineProperty(ja.prototype,"mi",{get:function(){return this.li},enumerable:!1,configurable:!0}),ja.prototype.ai=function(t){this.enqueue(t)},ja.prototype.Ii=function(t){this.Ai(),this.Ri(t)},ja.prototype.Pi=function(){var t;this.li||(this.li=!0,(t=Ma())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ei))},ja.prototype.enqueue=function(t){return this.Ai(),this.li?new Promise(function(t){}):this.Ri(t)},ja.prototype.gi=function(t){var e=this;this.ui.push(t),this.ai(function(){return e.Vi()})},ja.prototype.Vi=function(){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.ui.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.ui[0]()];case 2:return t.sent(),this.ui.shift(),this.Ti.reset(),[3,4];case 3:if(!ka(e=t.sent()))throw e;return kr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.ui.length&&this.Ti.bs(function(){return n.Vi()}),t.label=5;case 5:return[2]}})})},ja.prototype.Ri=function(t){var r=this,e=this.ci.then(function(){return r.di=!0,t().catch(function(t){throw r.fi=t,r.di=!1,Rr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.di=!1,t})});return this.ci=e},ja.prototype.Ss=function(t,e,n){var r=this;this.Ai(),-1<this.wi.indexOf(t)&&(e=0);var i=Fa.ri(this,t,e,n,function(t){return r.yi(t)});return this._i.push(i),i},ja.prototype.Ai=function(){this.fi&&Or()},ja.prototype.pi=function(){},ja.prototype.bi=function(){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.ci];case 1:t.sent(),t.label=2;case 2:if(e!==this.ci)return[3,0];t.label=3;case 3:return[2]}})})},ja.prototype.vi=function(t){for(var e=0,n=this._i;e<n.length;e++)if(n[e].Is===t)return!0;return!1},ja.prototype.Si=function(r){var i=this;return this.bi().then(function(){i._i.sort(function(t,e){return t.ni-e.ni});for(var t=0,e=i._i;t<e.length;t++){var n=e[t];if(n.Cs(),"all"!==r&&n.Is===r)break}return i.bi()})},ja.prototype.Di=function(t){this.wi.push(t)},ja.prototype.yi=function(t){var e=this._i.indexOf(t);this._i.splice(e,1)},ja);function ja(){var e=this;this.ci=Promise.resolve(),this.ui=[],this.li=!1,this._i=[],this.fi=null,this.di=!1,this.wi=[],this.Ti=new Ea(this,"async_queue_retry"),this.Ei=function(){var t=Ma();t&&kr("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.Ti.Ds()};var t=Ma();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ei)}function Ga(t,e,n,r,i){this.ei=t,this.Is=e,this.ni=n,this.op=r,this.si=i,this.ii=new wa,this.then=this.ii.promise.then.bind(this.ii.promise),this.ii.promise.catch(function(t){})}function Ba(t,e){if(Rr("AsyncQueue",e+": "+t),ka(t))return new Zr(Qr.UNAVAILABLE,e+": "+t);throw t}function za(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Vr(n,i);return 0===s?Vr(r,o):s}var Ha=(Xa.prototype.Fi=function(){return++this.Ni},Xa.prototype.ki=function(t){var e,n=[t,this.Fi()];this.buffer.size<this.Ci?this.buffer=this.buffer.add(n):za(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Xa.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Xa),Wa={$i:!1,xi:0,Oi:0,Mi:0},Ka=(Ya.Ui=function(t){return new Ya(t,Ya.Qi,Ya.Wi)},Ya);function Ya(t,e,n){this.Li=t,this.qi=e,this.Bi=n}function Xa(t){this.Ci=t,this.buffer=new Vi(za),this.Ni=0}Ka.ji=-1,Ka.Ki=1048576,Ka.Gi=41943040,Ka.Qi=10,Ka.Wi=1e3,Ka.zi=new Ka(Ka.Gi,Ka.Qi,Ka.Wi),Ka.Hi=new Ka(Ka.ji,0,0);var Qa=($a.prototype.start=function(t){this.Yi.params.Li!==Ka.ji&&this.Zi(t)},$a.prototype.stop=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Object.defineProperty($a.prototype,"tr",{get:function(){return null!==this.Xi},enumerable:!1,configurable:!0}),$a.prototype.Zi=function(n){var t=this,e=this.Ji?3e5:6e4;kr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Xi=this.ei.Ss("lru_garbage_collection",e,function(){return g(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.Xi=null,this.Ji=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.er(this.Yi)];case 2:return t.sent(),[3,7];case 3:return ka(e=t.sent())?(kr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ac(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Zi(n)];case 8:return t.sent(),[2]}})})})},$a),Za=(Ja.prototype.sr=function(t,e){return this.nr.ir(t).next(function(t){return Math.floor(e/100*t)})},Ja.prototype.rr=function(t,e){var n=this;if(0===e)return ia.resolve(ca.Es);var r=new Ha(e);return this.nr.be(t,function(t){return r.ki(t.sequenceNumber)}).next(function(){return n.nr.or(t,function(t){return r.ki(t)})}).next(function(){return r.maxValue})},Ja.prototype.hr=function(t,e,n){return this.nr.hr(t,e,n)},Ja.prototype.ar=function(t,e){return this.nr.ar(t,e)},Ja.prototype.cr=function(e,n){var r=this;return this.params.Li===Ka.ji?(kr("LruGarbageCollector","Garbage collection skipped; disabled"),ia.resolve(Wa)):this.ur(e).next(function(t){return t<r.params.Li?(kr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Li),Wa):r.lr(e,n)})},Ja.prototype.ur=function(t){return this.nr.ur(t)},Ja.prototype.lr=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.sr(e,this.params.qi).next(function(t){return i=t>c.params.Bi?(kr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Bi+" from "+t),c.params.Bi):t,s=Date.now(),c.rr(e,i)}).next(function(t){return r=t,u=Date.now(),c.hr(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.ar(e,r)}).next(function(t){return h=Date.now(),Dr()<=l.DEBUG&&kr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),ia.resolve({$i:!0,xi:i,Oi:o,Mi:t})})},Ja);function Ja(t,e){this.nr=t,this.params=e}function $a(t,e){this.Yi=t,this.ei=e,this.Ji=!1,this.Xi=null}function th(t){for(var o="",e=0;e<t.length;e++)0<o.length&&(o=eh(o)),o=function(t){for(var e=o,n=t.length,r=0;r<n;r++){var i=t.charAt(r);switch(i){case"\0":e+="";break;case"":e+="";break;default:e+=i}}return e}(t.get(e));return eh(o)}function eh(t){return t+""}function nh(t){var e=t.length;if(Pr(2<=e),2===e)return Pr(""===t.charAt(0)&&""===t.charAt(1)),ei.$();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Or(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Or()}o=s+2}return new ei(r)}var rh=function(t){this._r=t};function ih(t,e){if(e.document)return n=t._r,r=e.document,i=!!e.hasCommittedMutations,o=Bo(n,r.name),s=Fo(r.updateTime),u=new Ys({mapValue:{fields:r.fields}}),new iu(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=ii.K(e.noDocument.path),h=hh(e.noDocument.readTime);return new ou(a,h,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var c=ii.K(e.unknownDocument.path),f=hh(e.unknownDocument.version);return new su(c,f)}return Or()}function oh(t,e,n){var r,i,o=sh(n),s=e.key.path.p().N();if(e instanceof iu){var u={name:Go(r=t._r,(i=e).key),fields:i.tn().mapValue.fields,updateTime:Vo(r,i.version.A())},a=e.hasCommittedMutations;return new Gh(null,null,u,a,o,s)}if(e instanceof ou){var h=e.key.path.N(),c=ah(e.version),f=e.hasCommittedMutations;return new Gh(null,new qh(h,c),null,f,o,s)}if(e instanceof su){var l=e.key.path.N(),p=ah(e.version);return new Gh(new jh(l,p),null,null,!0,o,s)}return Or()}function sh(t){var e=t.A();return[e.seconds,e.nanoseconds]}function uh(t){var e=new Jr(t[0],t[1]);return $r.m(e)}function ah(t){var e=t.A();return new Lh(e.seconds,e.nanoseconds)}function hh(t){var e=new Jr(t.seconds,t.nanoseconds);return $r.m(e)}function ch(e,t){var n=(t.baseMutations||[]).map(function(t){return Qo(e._r,t)}),r=t.mutations.map(function(t){return Qo(e._r,t)}),i=Jr.fromMillis(t.localWriteTimeMs);return new na(t.batchId,i,n,r)}function fh(t){var e,n=hh(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?hh(t.lastLimboFreeSnapshotVersion):$r.min(),i=void 0!==t.query.documents?(Pr(1===(e=t.query).documents.length),gu(du(Ho(e.documents[0])))):function(t){var e,n=Ho(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Pr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ns(t.unaryFilter.field);return Su.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ns(t.unaryFilter.field);return Su.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ns(t.unaryFilter.field);return Su.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ns(t.unaryFilter.field);return Su.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Or()}}(e)]:void 0!==e.fieldFilter?[(n=e,Su.create(ns(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Or()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Or():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new ea(ns((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,h,c=null;r.limit&&(c=pi(h="object"==typeof(a=r.limit)?a.value:a)?null:h);var f=null;r.startAt&&(f=ts(r.startAt));var l=null;return r.endAt&&(l=ts(r.endAt)),gu(pu(n,o,u,s,c,"F",f,l))}(t.query);return new Ai(i,t.targetId,0,t.lastListenSequenceNumber,n,r,Ei.fromBase64String(t.resumeToken))}function lh(t,e){var n=ah(e.Z),r=ah(e.lastLimboFreeSnapshotVersion),i=(bi(e.target)?Zo:Jo)(t._r,e.target),o=e.resumeToken.toBase64();return new zh(e.targetId,mi(e.target),n,o,e.sequenceNumber,r,i)}var ph=(dh.Tr=function(t,e,n,r){return Pr(""!==t.uid),new dh(t.Er()?t.uid:"",e,n,r)},dh.prototype.mr=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gh(t).Zs({index:Vh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},dh.prototype.Ir=function(d,y,v,g){var m=this,w=mh(d),b=gh(d);return b.add({}).next(function(t){Pr("number"==typeof t);for(var e,n,r,i,o,s=new na(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Xo(e._r,t)}),o=r.mutations.map(function(t){return Xo(e._r,t)}),new Vh(n,r.batchId,r.Tn.toMillis(),i,o)),a=[],h=new Vi(function(t,e){return Vr(t.F(),e.F())}),c=0,f=g;c<f.length;c++){var l=f[c],p=Mh.key(m.userId,l.key.path,t),h=h.add(l.key.path.p());a.push(b.put(u)),a.push(w.put(p,Mh.PLACEHOLDER))}return h.forEach(function(t){a.push(m.zn.Ar(d,t))}),d.Wn(function(){m.wr[t]=s.keys()}),ia.Cn(a).next(function(){return s})})},dh.prototype.Rr=function(t,e){var n=this;return gh(t).get(e).next(function(t){return t?(Pr(t.userId===n.userId),ch(n.serializer,t)):null})},dh.prototype.Pr=function(t,n){var r=this;return this.wr[n]?ia.resolve(this.wr[n]):this.Rr(t,n).next(function(t){if(t){var e=t.keys();return r.wr[n]=e}return null})},dh.prototype.gr=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return gh(t).Zs({index:Vh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Pr(e.batchId>=i),o=ch(r.serializer,e)),n.done()}).next(function(){return o})},dh.prototype.Vr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return gh(t).Zs({index:Vh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},dh.prototype.yr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gh(t).Hs(Vh.userMutationsIndex,n).next(function(t){return t.map(function(t){return ch(e.serializer,t)})})},dh.prototype.Yn=function(u,a){var h=this,t=Mh.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return mh(u).Zs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=nh(i);if(r===h.userId&&a.path.isEqual(s))return gh(u).get(o).next(function(t){if(!t)throw Or();Pr(t.userId===h.userId),c.push(ch(h.serializer,t))});n.done()}).next(function(){return c})},dh.prototype.es=function(r,t){var a=this,h=new Vi(Vr),i=[];return t.forEach(function(u){var t=Mh.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=mh(r).Zs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=nh(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),ia.Cn(i).next(function(){return a.pr(r,h)})},dh.prototype.as=function(t,e){var u=this,a=e.path,h=a.length+1,n=Mh.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new Vi(Vr);return mh(t).Zs({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=nh(i);r===u.userId&&a.D(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.pr(t,c)})},dh.prototype.pr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(gh(e).get(t).next(function(t){if(null===t)throw Or();Pr(t.userId===n.userId),r.push(ch(n.serializer,t))}))}),ia.Cn(i).next(function(){return r})},dh.prototype.br=function(e,n){var r=this;return vh(e.vr,this.userId,n).next(function(t){return e.Wn(function(){r.Sr(n.batchId)}),ia.forEach(t,function(t){return r.dr.Dr(e,t)})})},dh.prototype.Sr=function(t){delete this.wr[t]},dh.prototype.Cr=function(n){var o=this;return this.mr(n).next(function(t){if(!t)return ia.resolve();var e=IDBKeyRange.lowerBound(Mh.prefixForUser(o.userId)),i=[];return mh(n).Zs({range:e},function(t,e,n){var r;t[0]===o.userId?(r=nh(t[1]),i.push(r)):n.done()}).next(function(){Pr(0===i.length)})})},dh.prototype.Nr=function(t,e){return yh(t,this.userId,e)},dh.prototype.Fr=function(t){var e=this;return wh(t).get(this.userId).next(function(t){return t||new Uh(e.userId,-1,"")})},dh);function dh(t,e,n,r){this.userId=t,this.serializer=e,this.zn=n,this.dr=r,this.wr={}}function yh(t,o,e){var n=Mh.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return mh(t).Zs({range:r,Xs:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function vh(t,e,n){var r=t.store(Vh.store),i=t.store(Mh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Zs({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Pr(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Mh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return ia.Cn(o).next(function(){return h})}function gh(t){return cc.Ms(t,Vh.store)}function mh(t){return cc.Ms(t,Mh.store)}function wh(t){return cc.Ms(t,Uh.store)}var bh,Eh=(Ih.prototype.xn=function(t,e,n){return Nh(t).put(_h(e),n)},Ih.prototype.Mn=function(t,e){var n=Nh(t),r=_h(e);return n.delete(r)},Ih.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.kr(e,t)})},Ih.prototype.Ln=function(t,e){var n=this;return Nh(t).get(_h(e)).next(function(t){return n.$r(t)})},Ih.prototype.xr=function(t,e){var n=this;return Nh(t).get(_h(e)).next(function(t){var e=n.$r(t);return e?{Or:e,size:Ah(t)}:null})},Ih.prototype.getEntries=function(t,e){var r=this,i=Fi;return this.Mr(t,e,function(t,e){var n=r.$r(e);i=i.st(t,n)}).next(function(){return i})},Ih.prototype.Lr=function(t,e){var r=this,i=Fi,o=new Ri(ii.P);return this.Mr(t,e,function(t,e){var n=r.$r(e);o=n?(i=i.st(t,n),o.st(t,Ah(e))):(i=i.st(t,null),o.st(t,0))}).next(function(){return{qr:i,Br:o}})},Ih.prototype.Mr=function(t,e,i){if(e._())return ia.resolve();var n=IDBKeyRange.bound(e.first().path.N(),e.last().path.N()),o=e.ct(),s=o.wt();return Nh(t).Zs({range:n},function(t,e,n){for(var r=ii.K(t);s&&ii.P(s,r)<0;)i(s,null),s=o.wt();s&&s.isEqual(r)&&(i(s,e),s=o.Tt()?o.wt():null),s?n.Gs(s.path.N()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Tt()?o.wt():null})},Ih.prototype.ns=function(t,i,e){var n,r,o,s=this,u=Gi,a=i.path.length+1,h={};return e.isEqual($r.min())?(n=i.path.N(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.N(),o=sh(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Gh.collectionReadTimeIndex),Nh(t).Zs(h,function(t,e,n){var r;t.length===a&&(r=ih(s.serializer,e),i.path.D(r.key.path)?r instanceof iu&&Nu(i,r)&&(u=u.st(r.key,r)):n.done())}).next(function(){return u})},Ih.prototype.Ur=function(t,e){var r=this,i=Fi,o=sh(e),n=Nh(t),s=IDBKeyRange.lowerBound(o,!0);return n.Zs({index:Gh.readTimeIndex,range:s},function(t,e){var n=ih(r.serializer,e);i=i.st(n.key,n),o=e.readTime}).next(function(){return{Qr:i,readTime:uh(o)}})},Ih.prototype.Wr=function(t){var e=Nh(t),r=$r.min();return e.Zs({index:Gh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=uh(e.readTime)),n.done()}).next(function(){return r})},Ih.prototype.jr=function(t){return new Ih.Kr(this,!!t&&t.Gr)},Ih.prototype.zr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ih.prototype.getMetadata=function(t){return Th(t).get(Bh.key).next(function(t){return Pr(!!t),t})},Ih.prototype.kr=function(t,e){return Th(t).put(Bh.key,e)},Ih.prototype.$r=function(t){if(t){var e=ih(this.serializer,t);return e instanceof ou&&e.version.isEqual($r.min())?null:e}return null},Ih);function Ih(t,e){this.serializer=t,this.zn=e}function Th(t){return cc.Ms(t,Bh.store)}function Nh(t){return cc.Ms(t,Gh.store)}function _h(t){return t.path.N()}function Ah(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Or();e=t.noDocument}return JSON.stringify(e).length}function Sh(t,e){var n=this;return(n=bh.call(this)||this).Hr=t,n.Gr=e,n.Yr=new Xr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}Eh.Kr=(n(Sh,bh=oa),Sh.prototype.Un=function(s){var u=this,a=[],h=0,c=new Vi(function(t,e){return Vr(t.F(),e.F())});return this.Fn.forEach(function(t,e){var n,r,i,o=u.Yr.get(t);e?(n=oh(u.Hr.serializer,e,u.readTime),c=c.add(t.path.p()),r=Ah(n),h+=r-o,a.push(u.Hr.xn(s,t,n))):(h-=o,u.Gr?(i=oh(u.Hr.serializer,new ou(t,$r.min()),u.readTime),a.push(u.Hr.xn(s,t,i))):a.push(u.Hr.Mn(s,t)))}),c.forEach(function(t){a.push(u.Hr.zn.Ar(s,t))}),a.push(this.Hr.updateMetadata(s,h)),ia.Cn(a)},Sh.prototype.qn=function(t,e){var n=this;return this.Hr.xr(t,e).next(function(t){return null===t?(n.Yr.set(e,0),null):(n.Yr.set(e,t.size),t.Or)})},Sh.prototype.Bn=function(t,e){var n=this;return this.Hr.Lr(t,e).next(function(t){var e=t.qr;return t.Br.forEach(function(t,e){n.Yr.set(t,e)}),e})},Sh);var Dh=(Ch.prototype.Ar=function(t,e){return this.Jr.add(e),ia.resolve()},Ch.prototype.hs=function(t,e){return ia.resolve(this.Jr.getEntries(e))},Ch),kh=(Ph.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Vi(ei.P),i=!r.has(n);return this.index[e]=r.add(n),i},Ph.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},Ph.prototype.getEntries=function(t){return(this.index[t]||new Vi(ei.P)).N()},Ph),Rh=(Oh.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Pr(t<e&&0<=t&&e<=10);var o,s=new Ra(r);t<1&&1<=e&&(n.createObjectStore(xh.store),(o=n).createObjectStore(Uh.store,{keyPath:Uh.keyPath}),o.createObjectStore(Vh.store,{keyPath:Vh.keyPath,autoIncrement:!0}).createIndex(Vh.userMutationsIndex,Vh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Mh.store),Yh(n),n.createObjectStore(Gh.store));var u,a=ia.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Hh.store),u.deleteObjectStore(zh.store),u.deleteObjectStore(Wh.store),Yh(n)),a=a.next(function(){return t=s.store(Wh.store),e=new Wh(0,0,$r.min().A(),0),t.put(Wh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Vh.store).Hs().next(function(t){r.deleteObjectStore(Vh.store),r.createObjectStore(Vh.store,{keyPath:Vh.keyPath,autoIncrement:!0}).createIndex(Vh.userMutationsIndex,Vh.userMutationsKeyPath,{unique:!0});var e=i.store(Vh.store),n=t.map(function(t){return e.put(t)});return ia.Cn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Xh.store,{keyPath:Xh.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Bh.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Gh.store)).createIndex(Gh.readTimeIndex,Gh.readTimeIndexPath,{unique:!1}),t.createIndex(Gh.collectionReadTimeIndex,Gh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Oh.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Gh.store).Zs(function(t,e){n+=Ah(e)}).next(function(){var t=new Bh(n);return e.store(Bh.store).put(Bh.key,t)})},Oh.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Uh.store),e=r.store(Vh.store);return t.Hs().next(function(t){return ia.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Hs(Vh.userMutationsIndex,t).next(function(t){return ia.forEach(t,function(t){Pr(t.userId===n.userId);var e=ch(i.serializer,t);return vh(r,n.userId,e).next(function(){})})})})})},Oh.prototype.ensureSequenceNumbers=function(t){var s=t.store(Hh.store),e=t.store(Gh.store);return t.store(Wh.store).get(Wh.key).next(function(i){var o=[];return e.Zs(function(t,e){var n=new ei(t),r=[0,th(n)];o.push(s.get(r).next(function(t){return t?ia.resolve():s.put(new Hh(0,th(n),i.highestListenSequenceNumber))}))}).next(function(){return ia.Cn(o)})})},Oh.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.S(),n=t.p();return i.put({collectionId:e,parent:th(n)})}}t.createObjectStore(Kh.store,{keyPath:Kh.keyPath});var i=e.store(Kh.store),o=new kh;return e.store(Gh.store).Zs({Xs:!0},function(t,e){return r(new ei(t).p())}).next(function(){return e.store(Mh.store).Zs({Xs:!0},function(t,e){t[0];var n=t[1];return r((t[2],nh(n)).p())})})},Oh.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(zh.store);return o.Zs(function(t,e){var n=fh(e),r=lh(i.serializer,n);return o.put(r)})},Oh),Lh=function(t,e){this.seconds=t,this.nanoseconds=e},xh=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Oh(t){this.serializer=t}function Ph(){this.index={}}function Ch(){this.Jr=new kh}xh.store="owner",xh.key="owner";var Uh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Uh.store="mutationQueues",Uh.keyPath="userId";var Vh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Vh.store="mutations",Vh.keyPath="batchId",Vh.userMutationsIndex="userMutationsIndex",Vh.userMutationsKeyPath=["userId","batchId"];var Mh=(Fh.prefixForUser=function(t){return[t]},Fh.prefixForPath=function(t,e){return[t,th(e)]},Fh.key=function(t,e,n){return[t,th(e),n]},Fh);function Fh(){}Mh.store="documentMutations",Mh.PLACEHOLDER=new Mh;var qh=function(t,e){this.path=t,this.readTime=e},jh=function(t,e){this.path=t,this.version=e},Gh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Gh.store="remoteDocuments",Gh.readTimeIndex="readTimeIndex",Gh.readTimeIndexPath="readTime",Gh.collectionReadTimeIndex="collectionReadTimeIndex",Gh.collectionReadTimeIndexPath=["parentPath","readTime"];var Bh=function(t){this.byteSize=t};Bh.store="remoteDocumentGlobal",Bh.key="remoteDocumentGlobalKey";var zh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};zh.store="targets",zh.keyPath="targetId",zh.queryTargetsIndexName="queryTargetsIndex",zh.queryTargetsKeyPath=["canonicalId","targetId"];var Hh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Hh.store="targetDocuments",Hh.keyPath=["targetId","path"],Hh.documentTargetsIndex="documentTargetsIndex",Hh.documentTargetsKeyPath=["path","targetId"];var Wh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wh.key="targetGlobalKey",Wh.store="targetGlobal";var Kh=function(t,e){this.collectionId=t,this.parent=e};function Yh(t){t.createObjectStore(Hh.store,{keyPath:Hh.keyPath}).createIndex(Hh.documentTargetsIndex,Hh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(zh.store,{keyPath:zh.keyPath}).createIndex(zh.queryTargetsIndexName,zh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wh.store)}Kh.store="collectionParents",Kh.keyPath=["collectionId","parent"];var Xh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Xh.store="clientMetadata",Xh.keyPath="clientId";var Qh=i(i(i([Uh.store,Vh.store,Mh.store,Gh.store,zh.store,xh.store,Wh.store,Hh.store],[Xh.store]),[Bh.store]),[Kh.store]),Zh=(Jh.prototype.Ar=function(t,e){var n=this;if(this.Xr.has(e))return ia.resolve();var r=e.S(),i=e.p();t.Wn(function(){n.Xr.add(e)});var o={collectionId:r,parent:th(i)};return $h(t).put(o)},Jh.prototype.hs=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Fr(i),""],!1,!0);return $h(t).Hs(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(nh(r.parent))}return o})},Jh);function Jh(){this.Xr=new kh}function $h(t){return cc.Ms(t,Kh.store)}var tc=(rc.prototype.next=function(){return this.Zr+=2,this.Zr},rc.to=function(){return new rc(0)},rc.eo=function(){return new rc(-1)},rc),ec=(nc.prototype.no=function(n){var r=this;return this.so(n).next(function(t){var e=new tc(t.highestTargetId);return t.highestTargetId=e.next(),r.io(n,t).next(function(){return t.highestTargetId})})},nc.prototype.ro=function(t){return this.so(t).next(function(t){return $r.m(new Jr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},nc.prototype.oo=function(t){return this.so(t).next(function(t){return t.highestListenSequenceNumber})},nc.prototype.ho=function(e,n,r){var i=this;return this.so(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.A()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.io(e,t)})},nc.prototype.ao=function(e,n){var r=this;return this.co(e,n).next(function(){return r.so(e).next(function(t){return t.targetCount+=1,r.uo(n,t),r.io(e,t)})})},nc.prototype.lo=function(t,e){return this.co(t,e)},nc.prototype._o=function(e,t){var n=this;return this.fo(e,t.targetId).next(function(){return ic(e).delete(t.targetId)}).next(function(){return n.so(e)}).next(function(t){return Pr(0<t.targetCount),--t.targetCount,n.io(e,t)})},nc.prototype.hr=function(r,i,o){var s=this,u=0,a=[];return ic(r).Zs(function(t,e){var n=fh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s._o(r,n)))}).next(function(){return ia.Cn(a)}).next(function(){return u})},nc.prototype.be=function(t,r){return ic(t).Zs(function(t,e){var n=fh(e);r(n)})},nc.prototype.so=function(t){return oc(t).get(Wh.key).next(function(t){return Pr(null!==t),t})},nc.prototype.io=function(t,e){return oc(t).put(Wh.key,e)},nc.prototype.co=function(t,e){return ic(t).put(lh(this.serializer,e))},nc.prototype.uo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},nc.prototype.do=function(t){return this.so(t).next(function(t){return t.targetCount})},nc.prototype.wo=function(t,i){var e=mi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return ic(t).Zs({range:n,index:zh.queryTargetsIndexName},function(t,e,n){var r=fh(e);wi(i,r.target)&&(o=r,n.done())}).next(function(){return o})},nc.prototype.To=function(n,t,r){var i=this,o=[],s=sc(n);return t.forEach(function(t){var e=th(t.path);o.push(s.put(new Hh(r,e))),o.push(i.dr.Eo(n,r,t))}),ia.Cn(o)},nc.prototype.mo=function(n,t,r){var i=this,o=sc(n);return ia.forEach(t,function(t){var e=th(t.path);return ia.Cn([o.delete([r,e]),i.dr.Io(n,r,t)])})},nc.prototype.fo=function(t,e){var n=sc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},nc.prototype.Ao=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=sc(t),o=Hi();return r.Zs({range:n,Xs:!0},function(t,e,n){var r=nh(t[1]),i=new ii(r);o=o.add(i)}).next(function(){return o})},nc.prototype.Nr=function(t,e){var n=th(e.path),r=IDBKeyRange.bound([n],[Fr(n)],!1,!0),i=0;return sc(t).Zs({index:Hh.documentTargetsIndex,Xs:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},nc.prototype.Me=function(t,e){return ic(t).get(e).next(function(t){return t?fh(t):null})},nc);function nc(t,e){this.dr=t,this.serializer=e}function rc(t){this.Zr=t}function ic(t){return cc.Ms(t,zh.store)}function oc(t){return cc.Ms(t,Wh.store)}function sc(t){return cc.Ms(t,Hh.store)}var uc,ac="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",hc=(n(lc,uc=ua),lc),cc=(fc.Ms=function(t,e){if(t instanceof hc)return Ia.Ms(t.vr,e);throw Or()},fc.prototype.start=function(){var e=this;return this.xo().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Zr(Qr.FAILED_PRECONDITION,ac);return e.Oo(),e.Mo(),e.Lo(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.ko.oo(t)})}).then(function(t){e.yo=new ca(t,e.Po)}).then(function(){e.po=!0}).catch(function(t){return e.Fo&&e.Fo.close(),Promise.reject(t)})},fc.prototype.qo=function(n){var t=this;return this.Co=function(e){return g(t,void 0,void 0,function(){return w(this,function(t){return this.tr?[2,n(e)]:[2]})})},n(this.isPrimary)},fc.prototype.Bo=function(n){var t=this;this.Fo.Bs(function(e){return g(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},fc.prototype.Uo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.ms.ai(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.tr?[4,this.xo()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},fc.prototype.xo=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return dc(e).put(new Xh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Qo(e).next(function(t){t||(n.isPrimary=!1,n.ms.gi(function(){return n.Co(!1)}))})}).next(function(){return n.Wo(e)}).next(function(t){return n.isPrimary&&!t?n.jo(e).next(function(){return!1}):!!t&&n.Ko(e).next(function(){return!0})})}).catch(function(t){if(ka(t))return kr("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return kr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.ms.gi(function(){return n.Co(t)}),n.isPrimary=t})},fc.prototype.Qo=function(t){var e=this;return pc(t).get(xh.key).next(function(t){return ia.resolve(e.Go(t))})},fc.prototype.zo=function(t){return dc(t).delete(this.clientId)},fc.prototype.Ho=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Yo(this.Do,18e5)?[3,2]:(this.Do=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=fc.Ms(t,Xh.store);return r.Hs().next(function(t){var e=o.Jo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return ia.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.$o)for(n=0,r=e;n<r.length;n++)i=r[n],this.$o.removeItem(this.Xo(i.clientId));t.label=2;case 2:return[2]}})})},fc.prototype.Lo=function(){var t=this;this.So=this.ms.Ss("client_metadata_refresh",4e3,function(){return t.xo().then(function(){return t.Ho()}).then(function(){return t.Lo()})})},fc.prototype.Go=function(t){return!!t&&t.ownerId===this.clientId},fc.prototype.Wo=function(e){var i=this;return this.Vo?ia.resolve(!0):pc(e).get(xh.key).next(function(t){if(null!==t&&i.Yo(t.leaseTimestampMs,5e3)&&!i.Zo(t.ownerId)){if(i.Go(t)&&i.networkEnabled)return!0;if(!i.Go(t)){if(!t.allowTabSynchronization)throw new Zr(Qr.FAILED_PRECONDITION,ac);return!1}}return!(!i.networkEnabled||!i.inForeground)||dc(e).Hs().next(function(t){return void 0===i.Jo(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&kr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},fc.prototype.th=function(){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){switch(t.label){case 0:return this.po=!1,this.eh(),this.So&&(this.So.cancel(),this.So=null),this.nh(),this.sh(),[4,this.Fo.runTransaction("readwrite",[xh.store,Xh.store],function(t){var e=new hc(t,ca.Es);return n.jo(e).next(function(){return n.zo(e)})})];case 1:return t.sent(),this.Fo.close(),this.ih(),[2]}})})},fc.prototype.Jo=function(t,e){var n=this;return t.filter(function(t){return n.Yo(t.updateTimeMs,e)&&!n.Zo(t.clientId)})},fc.prototype.rh=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return dc(t).Hs().next(function(t){return e.Jo(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(fc.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),fc.prototype.oh=function(t){return ph.Tr(t,this.serializer,this.zn,this.dr)},fc.prototype.hh=function(){return this.ko},fc.prototype.ah=function(){return this.Kn},fc.prototype.uh=function(){return this.zn},fc.prototype.runTransaction=function(e,n,r){var i=this;kr("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Fo.runTransaction(t,Qh,function(t){return o=new hc(t,i.yo?i.yo.next():ca.Es),"readwrite-primary"===n?i.Qo(o).next(function(t){return!!t||i.Wo(o)}).next(function(t){if(!t)throw Rr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.ms.gi(function(){return i.Co(!1)}),new Zr(Qr.FAILED_PRECONDITION,sa);return r(o)}).next(function(t){return i.Ko(o).next(function(){return t})}):i.lh(o).next(function(){return r(o)})}).then(function(t){return o.jn(),t})},fc.prototype.lh=function(t){var e=this;return pc(t).get(xh.key).next(function(t){if(null!==t&&e.Yo(t.leaseTimestampMs,5e3)&&!e.Zo(t.ownerId)&&!e.Go(t)&&!(e.Vo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Zr(Qr.FAILED_PRECONDITION,ac)})},fc.prototype.Ko=function(t){var e=new xh(this.clientId,this.allowTabSynchronization,Date.now());return pc(t).put(xh.key,e)},fc.ks=function(){return Ia.ks()},fc.prototype.jo=function(t){var e=this,n=pc(t);return n.get(xh.key).next(function(t){return e.Go(t)?(kr("IndexedDbPersistence","Releasing primary lease."),n.delete(xh.key)):ia.resolve()})},fc.prototype.Yo=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Rr("Detected an update time that is in the future: "+t+" > "+n),1))},fc.prototype.Oo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.vo=function(){t.ms.ai(function(){return t.inForeground="visible"===t.document.visibilityState,t.xo()})},this.document.addEventListener("visibilitychange",this.vo),this.inForeground="visible"===this.document.visibilityState)},fc.prototype.nh=function(){this.vo&&(this.document.removeEventListener("visibilitychange",this.vo),this.vo=null)},fc.prototype.Mo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.bo=function(){e.eh(),e.ms.ai(function(){return e.th()})},this.window.addEventListener("unload",this.bo))},fc.prototype.sh=function(){this.bo&&(this.window.removeEventListener("unload",this.bo),this.bo=null)},fc.prototype.Zo=function(t){var e;try{var n=null!==(null===(e=this.$o)||void 0===e?void 0:e.getItem(this.Xo(t)));return kr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Rr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},fc.prototype.eh=function(){if(this.$o)try{this.$o.setItem(this.Xo(this.clientId),String(Date.now()))}catch(t){Rr("Failed to set zombie client id.",t)}},fc.prototype.ih=function(){if(this.$o)try{this.$o.removeItem(this.Xo(this.clientId))}catch(t){}},fc.prototype.Xo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},fc);function fc(t,e,n,r,i,o,s,u,a,h){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.ms=i,this.window=o,this.document=s,this.Po=a,this.Vo=h,this.yo=null,this.po=!1,this.isPrimary=!1,this.networkEnabled=!0,this.bo=null,this.inForeground=!1,this.vo=null,this.So=null,this.Do=Number.NEGATIVE_INFINITY,this.Co=function(t){return Promise.resolve()},!fc.ks())throw new Zr(Qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.dr=new yc(this,r),this.No=e+"main",this.serializer=new rh(u),this.Fo=new Ia(this.No,10,new Rh(this.serializer)),this.ko=new ec(this.dr,this.serializer),this.zn=new Zh,this.Kn=new Eh(this.serializer,this.zn),this.window&&this.window.localStorage?this.$o=this.window.localStorage:(this.$o=null,!1===h&&Rr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function lc(t,e){var n=this;return(n=uc.call(this)||this).vr=t,n.Ro=e,n}function pc(t){return cc.Ms(t,xh.store)}function dc(t){return cc.Ms(t,Xh.store)}var yc=(vc.prototype.ir=function(t){var n=this._h(t);return this.db.hh().do(t).next(function(e){return n.next(function(t){return e+t})})},vc.prototype._h=function(t){var e=0;return this.or(t,function(t){e++}).next(function(){return e})},vc.prototype.be=function(t,e){return this.db.hh().be(t,e)},vc.prototype.or=function(t,n){return this.fh(t,function(t,e){return n(e)})},vc.prototype.Eo=function(t,e,n){return gc(t,n)},vc.prototype.Io=function(t,e,n){return gc(t,n)},vc.prototype.hr=function(t,e,n){return this.db.hh().hr(t,e,n)},vc.prototype.Dr=gc,vc.prototype.dh=function(t,e){return r=e,i=!1,wh(n=t).ti(function(t){return yh(n,t,r).next(function(t){return t&&(i=!0),ia.resolve(!t)})}).next(function(){return i});var n,r,i},vc.prototype.ar=function(r,i){var o=this,s=this.db.ah().jr(),u=[],a=0;return this.fh(r,function(e,t){var n;t<=i&&(n=o.dh(r,e).next(function(t){if(!t)return a++,s.Ln(r,e).next(function(){return s.Mn(e),sc(r).delete([0,th(e.path)])})}),u.push(n))}).next(function(){return ia.Cn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},vc.prototype.removeTarget=function(t,e){var n=e.tt(t.Ro);return this.db.hh().lo(t,n)},vc.prototype.wh=gc,vc.prototype.fh=function(t,o){var s,e=sc(t),u=ca.Es;return e.Zs({index:Hh.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==ca.Es&&o(new ii(nh(s)),u),u=i,s=r):u=ca.Es}).next(function(){u!==ca.Es&&o(new ii(nh(s)),u)})},vc.prototype.ur=function(t){return this.db.ah().zr(t)},vc);function vc(t,e){this.db=t,this.Yi=new Za(this,e)}function gc(t,e){return sc(t).put((n=t.Ro,new Hh(0,th(e.path),n)));var n}function mc(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var wc=(bc.prototype.er=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.cr(t,n.Eh)})},bc);function bc(t,e,n){this.persistence=t,this.Th=e,this.Eh=new Ri(Vr),this.mh=new Xr(mi,wi),this.Ih=$r.min(),this.Gn=t.oh(n),this.Ah=t.ah(),this.ko=t.hh(),this.Rh=new aa(this.Ah,this.Gn,this.persistence.uh()),this.Th.Ph(this.Rh)}function Ec(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.ko.ro(t)})}function Ic(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.ko.wo(e,r).next(function(t){return t?(n=t,ia.resolve(n)):i.ko.no(e).next(function(t){return n=new Ai(r,t,0,e.Ro),i.ko.ao(e,n).next(function(){return n})})})}).then(function(t){var e=i.Eh.get(t.targetId);return(null===e||0<t.Z.o(e.Z))&&(i.Eh=i.Eh.st(t.targetId,t),i.mh.set(r,t.targetId)),t})}function Tc(o,s,u){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:n=(e=o).Eh.get(s),r=u?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),u?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.dr.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!ka(i=t.sent()))throw i;return kr("LocalStore","Failed to update sequence numbers for target "+s+": "+i),[3,5];case 5:return e.Eh=e.Eh.remove(s),e.mh.delete(n.target),[2]}})})}function Nc(t,s,u){var a=t,h=$r.min(),c=Hi();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=gu(s),(void 0!==(o=(i=t).mh.get(r))?ia.resolve(i.Eh.get(o)):i.ko.wo(n,r)).next(function(t){if(t)return h=t.lastLimboFreeSnapshotVersion,a.ko.Ao(e,t.targetId).next(function(t){c=t})}).next(function(){return a.Th.ns(e,s,u?h:$r.min(),u?c:Hi())}).next(function(t){return{documents:t,gh:c}});var t,n,r,i,o})}function _c(t,e){var n=t,r=n.ko,i=n.Eh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Me(t,e).next(function(t){return t?t.target:null})})}function Ac(e){return g(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==Qr.FAILED_PRECONDITION||e.message!==sa)throw e;return kr("LocalStore","Unexpectedly lost primary lease"),[2]})})}var Sc=(xc.prototype._=function(){return this.Vh._()},xc.prototype.Eo=function(t,e){var n=new Dc(t,e);this.Vh=this.Vh.add(n),this.ph=this.ph.add(n)},xc.prototype.vh=function(t,e){var n=this;t.forEach(function(t){return n.Eo(t,e)})},xc.prototype.Io=function(t,e){this.Sh(new Dc(t,e))},xc.prototype.Dh=function(t,e){var n=this;t.forEach(function(t){return n.Io(t,e)})},xc.prototype.Ch=function(t){var e=this,n=new ii(new ei([])),r=new Dc(n,t),i=new Dc(n,t+1),o=[];return this.ph.St([r,i],function(t){e.Sh(t),o.push(t.key)}),o},xc.prototype.Nh=function(){var e=this;this.Vh.forEach(function(t){return e.Sh(t)})},xc.prototype.Sh=function(t){this.Vh=this.Vh.delete(t),this.ph=this.ph.delete(t)},xc.prototype.Fh=function(t){var e=new ii(new ei([])),n=new Dc(e,t),r=new Dc(e,t+1),i=Hi();return this.ph.St([n,r],function(t){i=i.add(t.key)}),i},xc.prototype.Nr=function(t){var e=new Dc(t,0),n=this.Vh.Ct(e);return null!==n&&t.isEqual(n.key)},xc),Dc=(Lc.yh=function(t,e){return ii.P(t.key,e.key)||Vr(t.kh,e.kh)},Lc.bh=function(t,e){return Vr(t.kh,e.kh)||ii.P(t.key,e.key)},Lc),kc=(Rc.prototype.Er=function(){return null!=this.uid},Rc.prototype.$h=function(){return this.Er()?"uid:"+this.uid:"anonymous-user"},Rc.prototype.isEqual=function(t){return t.uid===this.uid},Rc);function Rc(t){this.uid=t}function Lc(t,e){this.key=t,this.kh=e}function xc(){this.Vh=new Vi(Dc.yh),this.ph=new Vi(Dc.bh)}function Oc(t,e){this.user=e,this.type="OAuth",this.Mh={},this.Mh.Authorization="Bearer "+t}kc.UNAUTHENTICATED=new kc(null),kc.xh=new kc("google-credentials-uid"),kc.Oh=new kc("first-party-uid");var Pc,Cc,Uc,Vc=(nf.prototype.getToken=function(){return Promise.resolve(null)},nf.prototype.qh=function(){},nf.prototype.Bh=function(t){(this.Lh=t)(kc.UNAUTHENTICATED)},nf.prototype.Uh=function(){this.Lh=null},nf),Mc=(ef.prototype.getToken=function(){var e=this,n=this.jh,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.jh!==n?(kr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Pr("string"==typeof t.accessToken),new Oc(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ef.prototype.qh=function(){this.forceRefresh=!0},ef.prototype.Bh=function(t){this.Lh=t,this.Wh&&t(this.currentUser)},ef.prototype.Uh=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qh),this.Qh=null,this.Lh=null},ef.prototype.Kh=function(){var t=this.auth&&this.auth.getUid();return Pr(null===t||"string"==typeof t),new kc(t)},ef),Fc=(Object.defineProperty(tf.prototype,"Mh",{get:function(){var t={"X-Goog-AuthUser":this.zh},e=this.Gh.auth.Hh([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),tf),qc=($c.prototype.getToken=function(){return Promise.resolve(new Fc(this.Gh,this.zh))},$c.prototype.Bh=function(t){t(kc.Oh)},$c.prototype.Uh=function(){},$c.prototype.qh=function(){},$c),jc=(Jc.prototype.ea=function(){return 1===this.state||2===this.state||4===this.state},Jc.prototype.na=function(){return 2===this.state},Jc.prototype.start=function(){3!==this.state?this.auth():this.sa()},Jc.prototype.stop=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ea()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Jc.prototype.ia=function(){this.state=0,this.Ti.reset()},Jc.prototype.ra=function(){var t=this;this.na()&&null===this.ta&&(this.ta=this.ms.Ss(this.Yh,6e4,function(){return t.oa()}))},Jc.prototype.ha=function(t){this.aa(),this.stream.send(t)},Jc.prototype.oa=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.na()?[2,this.close(0)]:[2]})})},Jc.prototype.aa=function(){this.ta&&(this.ta.cancel(),this.ta=null)},Jc.prototype.close=function(e,n){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.aa(),this.Ti.cancel(),this.Zh++,3!==e?this.Ti.reset():n&&n.code===Qr.RESOURCE_EXHAUSTED?(Rr(n.toString()),Rr("Using maximum backoff delay to prevent overloading the backend."),this.Ti.ps()):n&&n.code===Qr.UNAUTHENTICATED&&this.Xh.qh(),null!==this.stream&&(this.ca(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ua(n)];case 1:return t.sent(),[2]}})})},Jc.prototype.ca=function(){},Jc.prototype.auth=function(){var n=this;this.state=1;var t=this.la(this.Zh),e=this.Zh;this.Xh.getToken().then(function(t){n.Zh===e&&n._a(t)},function(e){t(function(){var t=new Zr(Qr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.fa(t)})})},Jc.prototype._a=function(t){var e=this,n=this.la(this.Zh);this.stream=this.da(t),this.stream.wa(function(){n(function(){return e.state=2,e.listener.wa()})}),this.stream.ua(function(t){n(function(){return e.fa(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Jc.prototype.sa=function(){var t=this;this.state=4,this.Ti.bs(function(){return g(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},Jc.prototype.fa=function(t){return kr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Jc.prototype.la=function(e){var n=this;return function(t){n.ms.ai(function(){return n.Zh===e?t():(kr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Jc),Gc=(n(Zc,Uc=jc),Zc.prototype.da=function(t){return this.Jh.Ta("Listen",t)},Zc.prototype.onMessage=function(t){this.Ti.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Or(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Le?(Pr(void 0===i||"string"==typeof i),Ei.fromBase64String(i||"")):(Pr(void 0===i||i instanceof Uint8Array),Ei.fromUint8Array(i||new Uint8Array))),h=e.targetChange.cause,c=new Xi(s,u,a,h&&(r=void 0===(n=h).code?Qr.UNKNOWN:ki(n.code),new Zr(r,n.message||""))||null)}else if("documentChange"in e){e.documentChange;var f=e.documentChange;f.document,f.document.name,f.document.updateTime;var l=Bo(t,f.document.name),p=Fo(f.document.updateTime),d=new Ys({mapValue:{fields:f.document.fields}}),y=new iu(l,p,d,{}),c=new Ki(f.targetIds||[],f.removedTargetIds||[],y.key,y)}else if("documentDelete"in e){e.documentDelete;var v=e.documentDelete;v.document;var g=Bo(t,v.document),m=v.readTime?Fo(v.readTime):$r.min(),w=new ou(g,m);c=new Ki([],v.removedTargetIds||[],w.key,w)}else if("documentRemove"in e){e.documentRemove;var b=e.documentRemove;b.document;var E=Bo(t,b.document);c=new Ki([],b.removedTargetIds||[],E,null)}else{if(!("filter"in e))return Or();e.filter;var I=e.filter;I.targetId;var T=new Ti(I.count||0);c=new Yi(I.targetId,T)}return c}(this.serializer,t),n=function(t){if(!("targetChange"in t))return $r.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?$r.min():Fo(e.readTime)}(t);return this.listener.Ea(e,n)},Zc.prototype.ma=function(t){var e,n,r,i,o={};o.database=Wo(this.serializer),o.addTarget=(e=this.serializer,(r=bi(i=(n=t).target)?{documents:Zo(e,i)}:{query:Jo(e,i)}).targetId=n.targetId,0<n.resumeToken.Y()&&(r.resumeToken=Mo(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.X){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Or()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.ha(o)},Zc.prototype.Ia=function(t){var e={};e.database=Wo(this.serializer),e.removeTarget=t,this.ha(e)},Zc),Bc=(n(Qc,Cc=jc),Object.defineProperty(Qc.prototype,"Ra",{get:function(){return this.Aa},enumerable:!1,configurable:!0}),Qc.prototype.start=function(){this.Aa=!1,this.lastStreamToken=void 0,Cc.prototype.start.call(this)},Qc.prototype.ca=function(){this.Aa&&this.Pa([])},Qc.prototype.da=function(t){return this.Jh.Ta("Write",t)},Qc.prototype.onMessage=function(t){if(Pr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Aa){this.Ti.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(Pr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?Fo(t.updateTime):Fo(e);n.isEqual($r.min())&&(n=Fo(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new _s(n,r)}(t,i)})):[]),n=Fo(t.commitTime);return this.listener.ga(n,e)}var r,i;return Pr(!t.writeResults||0===t.writeResults.length),this.Aa=!0,this.listener.Va()},Qc.prototype.ya=function(){var t={};t.database=Wo(this.serializer),this.ha(t)},Qc.prototype.Pa=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Xo(e.serializer,t)})};this.ha(n)},Qc),zc=(n(Xc,Pc=function(){}),Xc.prototype.ba=function(){if(this.pa)throw new Zr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")},Xc.prototype.va=function(e,n,r){var i=this;return this.ba(),this.credentials.getToken().then(function(t){return i.Jh.va(e,n,r,t)}).catch(function(t){throw t.code===Qr.UNAUTHENTICATED&&i.credentials.qh(),t})},Xc.prototype.Sa=function(e,n,r){var i=this;return this.ba(),this.credentials.getToken().then(function(t){return i.Jh.Sa(e,n,r,t)}).catch(function(t){throw t.code===Qr.UNAUTHENTICATED&&i.credentials.qh(),t})},Xc.prototype.terminate=function(){this.pa=!1},Xc),Hc=(Yc.prototype.ka=function(){var t=this;0===this.Ca&&(this.$a("Unknown"),this.Na=this.ei.Ss("online_state_timeout",1e4,function(){return t.Na=null,t.xa("Backend didn't respond within 10 seconds."),t.$a("Offline"),Promise.resolve()}))},Yc.prototype.Oa=function(t){"Online"===this.state?this.$a("Unknown"):(this.Ca++,1<=this.Ca&&(this.Ma(),this.xa("Connection failed 1 times. Most recent error: "+t.toString()),this.$a("Offline")))},Yc.prototype.set=function(t){this.Ma(),this.Ca=0,"Online"===t&&(this.Fa=!1),this.$a(t)},Yc.prototype.$a=function(t){t!==this.state&&(this.state=t,this.Da(t))},Yc.prototype.xa=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fa?(Rr(e),this.Fa=!1):kr("OnlineStateTracker",e)},Yc.prototype.Ma=function(){null!==this.Na&&(this.Na.cancel(),this.Na=null)},Yc),Wc=(Kc.prototype.start=function(){return this.enableNetwork()},Kc.prototype.enableNetwork=function(){return this.Wa.delete(0),this.ic()},Kc.prototype.ic=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ga()?(this.rc()?this.oc():this.Ha.set("Unknown"),[4,this.hc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Kc.prototype.disableNetwork=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Wa.add(0),[4,this.ac()];case 1:return t.sent(),this.Ha.set("Offline"),[2]}})})},Kc.prototype.ac=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.tc.stop()];case 1:return t.sent(),[4,this.Ya.stop()];case 2:return t.sent(),0<this.Ba.length&&(kr("RemoteStore","Stopping write stream with "+this.Ba.length+" pending writes"),this.Ba=[]),this.cc(),[2]}})})},Kc.prototype.th=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return kr("RemoteStore","RemoteStore shutting down."),this.Wa.add(5),[4,this.ac()];case 1:return t.sent(),this.ja.th(),this.Ha.set("Unknown"),[2]}})})},Kc.prototype.listen=function(t){this.Ua.has(t.targetId)||(this.Ua.set(t.targetId,t),this.rc()?this.oc():this.Ya.na()&&this.uc(t))},Kc.prototype.lc=function(t){this.Ua.delete(t),this.Ya.na()&&this._c(t),0===this.Ua.size&&(this.Ya.na()?this.Ya.ra():this.Ga()&&this.Ha.set("Unknown"))},Kc.prototype.Me=function(t){return this.Ua.get(t)||null},Kc.prototype.Oe=function(t){return this.fc.Oe(t)},Kc.prototype.uc=function(t){this.Qa.we(t.targetId),this.Ya.ma(t)},Kc.prototype._c=function(t){this.Qa.we(t),this.Ya.Ia(t)},Kc.prototype.oc=function(){this.Qa=new no(this),this.Ya.start(),this.Ha.ka()},Kc.prototype.rc=function(){return this.Ga()&&!this.Ya.ea()&&0<this.Ua.size},Kc.prototype.Ga=function(){return 0===this.Wa.size},Kc.prototype.cc=function(){this.Qa=null},Kc.prototype.Ja=function(){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){return this.Ua.forEach(function(t,e){n.uc(t)}),[2]})})},Kc.prototype.Xa=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return this.cc(),this.rc()?(this.Ha.Oa(e),this.oc()):this.Ha.set("Unknown"),[2]})})},Kc.prototype.Za=function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:if(this.Ha.set("Online"),!(i instanceof Xi&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.dc(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),kr("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.wc(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof Ki?this.Qa.ge(i):i instanceof Yi?this.Qa.Ce(i):this.Qa.pe(i),o.isEqual($r.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Ec(this.La)];case 8:return n=t.sent(),0<=o.o(n)?[4,this.Tc(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return kr("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.wc(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Kc.prototype.wc=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!ka(n))throw n;return this.Wa.add(1),[4,this.ac()];case 1:return t.sent(),this.Ha.set("Offline"),r=r||function(){return Ec(e.La)},this.ei.gi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return kr("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.Wa.delete(1),[4,this.ic()];case 2:return t.sent(),[2]}})})}),[2]}})})},Kc.prototype.Ec=function(e){var n=this;return e().catch(function(t){return n.wc(t,e)})},Kc.prototype.Tc=function(r){var i=this,t=this.Qa.ke(r);return t.Wt.forEach(function(t,e){var n;0<t.resumeToken.Y()&&(n=i.Ua.get(e))&&i.Ua.set(e,n.et(t.resumeToken,r))}),t.jt.forEach(function(t){var e,n=i.Ua.get(t);n&&(i.Ua.set(t,n.et(Ei.J,n.Z)),i._c(t),e=new Ai(n.target,t,1,n.sequenceNumber),i.uc(e))}),this.fc.mc(t)},Kc.prototype.dc=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.Ua.has(i)?[4,this.fc.Ic(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.Ua.delete(i),this.Qa.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Kc.prototype.hc=function(){return g(this,void 0,void 0,function(){var i,o,s;return w(this,function(t){switch(t.label){case 0:i=0<this.Ba.length?this.Ba[this.Ba.length-1].batchId:-1,t.label=1;case 1:if(!this.Ac())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=this.La,n=i,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Gn.gr(t,n)}))];case 3:return null===(o=t.sent())?(0===this.Ba.length&&this.tc.ra(),[3,7]):(i=o.batchId,this.Rc(o),[3,6]);case 4:return s=t.sent(),[4,this.wc(s)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.Pc()&&this.gc(),[2]}var e,n,r})})},Kc.prototype.Ac=function(){return this.Ga()&&this.Ba.length<10},Kc.prototype.Vc=function(){return this.Ba.length},Kc.prototype.Rc=function(t){this.Ba.push(t),this.tc.na()&&this.tc.Ra&&this.tc.Pa(t.mutations)},Kc.prototype.Pc=function(){return this.Ga()&&!this.tc.ea()&&0<this.Ba.length},Kc.prototype.gc=function(){this.tc.start()},Kc.prototype.ec=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.tc.ya(),[2]})})},Kc.prototype.sc=function(){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){for(e=0,n=this.Ba;e<n.length;e++)r=n[e],this.tc.Pa(r.mutations);return[2]})})},Kc.prototype.ga=function(i,o){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return e=this.Ba.shift(),n=ra.from(e,i,o),[4,this.Ec(function(){return r.fc.yc(n)})];case 1:return t.sent(),[4,this.hc()];case 2:return t.sent(),[2]}})})},Kc.prototype.nc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e&&this.tc.Ra?[4,this.pc(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Pc()&&this.gc(),[2]}})})},Kc.prototype.pc=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return Di(n=i.code)&&n!==Qr.ABORTED?(e=this.Ba.shift(),this.tc.ia(),[4,this.Ec(function(){return r.fc.bc(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.hc()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Kc.prototype.za=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Wa.add(4),[4,this.ac()];case 1:return t.sent(),this.Ha.set("Unknown"),this.tc.ia(),this.Ya.ia(),this.Wa.delete(4),[4,this.ic()];case 2:return t.sent(),[2]}})})},Kc.prototype.vc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ei.pi(),kr("RemoteStore","RemoteStore received new credentials"),this.Wa.add(3),[4,this.ac()];case 1:return t.sent(),this.Ha.set("Unknown"),[4,this.fc.vc(e)];case 2:return t.sent(),this.Wa.delete(3),[4,this.ic()];case 3:return t.sent(),[2]}})})},Kc.prototype.Sc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(this.Wa.delete(2),[4,this.ic()]):[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:(this.Wa.add(2),[4,this.ac()]);case 3:t.sent(),this.Ha.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Kc);function Kc(t,e,n,r,i){var o,s,u,a,h,c,f,l,p=this;this.La=t,this.qa=e,this.ei=n,this.Ba=[],this.Ua=new Map,this.Qa=null,this.Wa=new Set,this.ja=i,this.ja.Ka(function(t){n.ai(function(){return g(p,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ga()?(kr("RemoteStore","Restarting streams for network reachability change."),[4,this.za()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Ha=new Hc(n,r),this.Ya=(h=this.qa,c=n,f={wa:this.Ja.bind(this),ua:this.Xa.bind(this),Ea:this.Za.bind(this)},(l=h).ba(),new Gc(c,l.Jh,l.credentials,l.serializer,f)),this.tc=(o=this.qa,s=n,u={wa:this.ec.bind(this),ua:this.nc.bind(this),Va:this.sc.bind(this),ga:this.ga.bind(this)},(a=o).ba(),new Bc(s,a.Jh,a.credentials,a.serializer,u))}function Yc(t,e){this.ei=t,this.Da=e,this.state="Unknown",this.Ca=0,this.Na=null,this.Fa=!0}function Xc(t,e,n){var r=this;return(r=Pc.call(this)||this).credentials=t,r.Jh=e,r.serializer=n,r.pa=!1,r}function Qc(t,e,n,r,i){var o=this;return(o=Cc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Aa=!1,o}function Zc(t,e,n,r,i){var o=this;return(o=Uc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Jc(t,e,n,r,i,o){this.ms=t,this.Yh=n,this.Jh=r,this.Xh=i,this.listener=o,this.state=0,this.Zh=0,this.ta=null,this.stream=null,this.Ti=new Ea(t,e)}function $c(t,e){this.Gh=t,this.zh=e}function tf(t,e){this.Gh=t,this.zh=e,this.type="FirstParty",this.user=kc.Oh}function ef(t){var e=this;this.Qh=null,this.currentUser=kc.UNAUTHENTICATED,this.Wh=!1,this.jh=0,this.Lh=null,this.forceRefresh=!1,this.Qh=function(){e.jh++,e.currentUser=e.Kh(),e.Wh=!0,e.Lh&&e.Lh(e.currentUser)},this.jh=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qh):(this.Qh(null),t.get().then(function(t){e.auth=t,e.Qh&&e.auth.addAuthTokenListener(e.Qh)},function(){}))}function nf(){this.Lh=null}function rf(t,e){return"firestore_clients_"+t+"_"+e}function of(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Er()&&(r+="_"+e.uid),r}function sf(t,e){return"firestore_targets_"+t+"_"+e}function uf(t){this.key=t}function af(t){this.key=t}function hf(t,e,n){this.query=t,this.targetId=e,this.view=n}function cf(t){this.key=t,this.qu=!1}var ff=(Df.Dc=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Zr(r.error.code,r.error.message)),i?new Df(t,e,r.state,o):(Rr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Df.prototype.Cc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Df),lf=(Sf.Dc=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Zr(n.error.code,n.error.message)),r?new Sf(t,n.state,i):(Rr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Sf.prototype.Cc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Sf),pf=(Af.Dc=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Wi,o=0;r&&o<n.activeTargetIds.length;++o)r=yi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Af(t,i):(Rr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Af),df=(_f.Dc=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new _f(e.clientId,e.onlineState):(Rr("SharedClientState","Failed to parse online state: "+t),null)},_f),yf=(Nf.prototype.Nc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Nf.prototype.Fc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Nf.prototype.Cc=function(){var t={activeTargetIds:this.activeTargetIds.N(),updateTimeMs:Date.now()};return JSON.stringify(t)},Nf),vf=(Tf.ks=function(t){return!(!t||!t.localStorage)},Tf.prototype.start=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this.fc.rh()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.kc&&(o=this.getItem(rf(this.persistenceKey,i)))&&(s=pf.Dc(i,o))&&(this.Oc=this.Oc.st(s.clientId,s));for(this.jc(),(u=this.storage.getItem(this.Wc))&&(a=this.Kc(u))&&this.Gc(a),h=0,c=this.Mc;h<c.length;h++)f=c[h],this.xc(f);return this.Mc=[],this.window.addEventListener("unload",function(){return l.th()}),this.tr=!0,[2]}})})},Tf.prototype.Ts=function(t){this.setItem(this.qc,JSON.stringify(t))},Tf.prototype.zc=function(){return this.Hc(this.Oc)},Tf.prototype.Yc=function(n){var r=!1;return this.Oc.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Tf.prototype.Jc=function(t){this.Xc(t,"pending")},Tf.prototype.Zc=function(t,e,n){this.Xc(t,e,n),this.tu(t)},Tf.prototype.eu=function(t){var e,n,r="not-current";return this.Yc(t)&&(!(e=this.storage.getItem(sf(this.persistenceKey,t)))||(n=lf.Dc(t,e))&&(r=n.state)),this.nu.Nc(t),this.jc(),r},Tf.prototype.su=function(t){this.nu.Fc(t),this.jc()},Tf.prototype.iu=function(t){return this.nu.activeTargetIds.has(t)},Tf.prototype.ru=function(t){this.removeItem(sf(this.persistenceKey,t))},Tf.prototype.ou=function(t,e,n){this.hu(t,e,n)},Tf.prototype.au=function(t,e,n){var r=this;e.forEach(function(t){r.tu(t)}),this.currentUser=t,n.forEach(function(t){r.Jc(t)})},Tf.prototype.cu=function(t){this.uu(t)},Tf.prototype.th=function(){this.tr&&(this.window.removeEventListener("storage",this.$c),this.removeItem(this.Lc),this.tr=!1)},Tf.prototype.getItem=function(t){var e=this.storage.getItem(t);return kr("SharedClientState","READ",t,e),e},Tf.prototype.setItem=function(t,e){kr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Tf.prototype.removeItem=function(t){kr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Tf.prototype.xc=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(kr("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Lc)return void Rr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ms.gi(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.tr){if(null!==u.key)if(this.Bc.test(u.key)){if(null==u.newValue)return e=this.lu(u.key),[2,this._u(e,null)];if(n=this.fu(u.key,u.newValue))return[2,this._u(n.clientId,n)]}else if(this.Uc.test(u.key)){if(null!==u.newValue&&(r=this.du(u.key,u.newValue)))return[2,this.wu(r)]}else if(this.Qc.test(u.key)){if(null!==u.newValue&&(i=this.Tu(u.key,u.newValue)))return[2,this.Eu(i)]}else if(u.key===this.Wc){if(null!==u.newValue&&(o=this.Kc(u.newValue)))return[2,this.Gc(o)]}else u.key===this.qc&&(s=function(t){var e=ca.Es;if(null!=t)try{var n=JSON.parse(t);Pr("number"==typeof n),e=n}catch(t){Rr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==ca.Es&&this.fs(s)}else this.Mc.push(u);return[2]})})})}},Object.defineProperty(Tf.prototype,"nu",{get:function(){return this.Oc.get(this.kc)},enumerable:!1,configurable:!0}),Tf.prototype.jc=function(){this.setItem(this.Lc,this.nu.Cc())},Tf.prototype.Xc=function(t,e,n){var r=new ff(this.currentUser,t,e,n),i=of(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Cc())},Tf.prototype.tu=function(t){var e=of(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Tf.prototype.uu=function(t){var e={clientId:this.kc,onlineState:t};this.storage.setItem(this.Wc,JSON.stringify(e))},Tf.prototype.hu=function(t,e,n){var r=sf(this.persistenceKey,t),i=new lf(t,e,n);this.setItem(r,i.Cc())},Tf.prototype.lu=function(t){var e=this.Bc.exec(t);return e?e[1]:null},Tf.prototype.fu=function(t,e){var n=this.lu(t);return pf.Dc(n,e)},Tf.prototype.du=function(t,e){var n=this.Uc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ff.Dc(new kc(i),r,e)},Tf.prototype.Tu=function(t,e){var n=this.Qc.exec(t),r=Number(n[1]);return lf.Dc(r,e)},Tf.prototype.Kc=function(t){return df.Dc(t)},Tf.prototype.wu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.fc.mu(e.batchId,e.state,e.error)]:(kr("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Tf.prototype.Eu=function(t){return this.fc.Iu(t.targetId,t.state,t.error)},Tf.prototype._u=function(t,e){var n=this,r=e?this.Oc.st(t,e):this.Oc.remove(t),i=this.Hc(this.Oc),o=this.Hc(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.fc.Au(s,u).then(function(){n.Oc=r})},Tf.prototype.Gc=function(t){this.Oc.get(t.clientId)&&this.Da(t.onlineState)},Tf.prototype.Hc=function(t){var n=Wi;return t.forEach(function(t,e){n=n.Nt(e.activeTargetIds)}),n},Tf),gf=(If.prototype.Jc=function(t){},If.prototype.Zc=function(t,e,n){},If.prototype.eu=function(t){return this.Ru.Nc(t),this.Pu[t]||"not-current"},If.prototype.ou=function(t,e,n){this.Pu[t]=e},If.prototype.su=function(t){this.Ru.Fc(t)},If.prototype.iu=function(t){return this.Ru.activeTargetIds.has(t)},If.prototype.ru=function(t){delete this.Pu[t]},If.prototype.zc=function(){return this.Ru.activeTargetIds},If.prototype.Yc=function(t){return this.Ru.activeTargetIds.has(t)},If.prototype.start=function(){return this.Ru=new yf,Promise.resolve()},If.prototype.au=function(t,e,n){},If.prototype.cu=function(t){},If.prototype.th=function(){},If.prototype.Ts=function(t){},If),mf=(Object.defineProperty(Ef.prototype,"vu",{get:function(){return this.gu},enumerable:!1,configurable:!0}),Ef.prototype.Su=function(t,e){var u=this,a=e?e.Du:new Zi,h=e?e.bu:this.bu,c=e?e.qt:this.qt,f=h,l=!1,p=this.query.an()&&h.size===this.query.limit?h.last():null,d=this.query.cn()&&h.size===this.query.limit?h.first():null;if(t.ht(function(t,e){var n=h.get(t),r=(r=e instanceof iu?e:null)&&(Nu(u.query,r)?r:null),i=!!n&&u.qt.has(n.key),o=!!r&&(r.Ge||u.qt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Cu(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.pu(r,p)||d&&u.pu(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.an()||this.query.cn())for(;f.size>this.query.limit;){var n=this.query.an()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{bu:f,Du:a,Nu:l,qt:c}},Ef.prototype.Cu=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},Ef.prototype.Un=function(t,e,n){var o=this,r=this.bu;this.bu=t.bu,this.qt=t.qt;var i=t.Du.Mt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.pu(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Or()}}var r,i}),this.Fu(n);var s=e?this.ku():[],u=0===this.yu.size&&this.Yt?1:0,a=u!==this.Vu;return this.Vu=u,0!==i.length||a?{snapshot:new Ji(this.query,t.bu,r,i,t.qt,0==u,a,!1),$u:s}:{$u:s}},Ef.prototype.xu=function(t){return this.Yt&&"Offline"===t?(this.Yt=!1,this.Un({bu:this.bu,Du:new Zi,qt:this.qt,Nu:!1},!1)):{$u:[]}},Ef.prototype.Ou=function(t){return!this.gu.has(t)&&!!this.bu.has(t)&&!this.bu.get(t).Ge},Ef.prototype.Fu=function(t){var e=this;t&&(t.Jt.forEach(function(t){return e.gu=e.gu.add(t)}),t.Xt.forEach(function(t){}),t.Zt.forEach(function(t){return e.gu=e.gu.delete(t)}),this.Yt=t.Yt)},Ef.prototype.ku=function(){var e=this;if(!this.Yt)return[];var n=this.yu;this.yu=Hi(),this.bu.forEach(function(t){e.Ou(t.key)&&(e.yu=e.yu.add(t.key))});var r=[];return n.forEach(function(t){e.yu.has(t)||r.push(new af(t))}),this.yu.forEach(function(t){n.has(t)||r.push(new uf(t))}),r},Ef.prototype.Mu=function(t){this.gu=t.gh,this.yu=Hi();var e=this.Su(t.documents);return this.Un(e,!0)},Ef.prototype.Lu=function(){return Ji.Qt(this.query,this.bu,this.qt,0===this.Vu)},Ef),wf=(Object.defineProperty(bf.prototype,"el",{get:function(){return!0===this.tl},enumerable:!1,configurable:!0}),bf.prototype.subscribe=function(t){this.Wu=t},bf.prototype.listen=function(s){return g(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:return this.nl("listen()"),(r=this.ju.get(s))?(e=r.targetId,this.Uu.eu(e),n=r.view.Lu(),[3,4]):[3,1];case 1:return[4,Ic(this.La,gu(s))];case 2:return i=t.sent(),o=this.Uu.eu(i.targetId),e=i.targetId,[4,this.sl(s,e,"current"===o)];case 3:n=t.sent(),this.el&&this.Bu.listen(i),t.label=4;case 4:return[2,n]}})})},bf.prototype.sl=function(u,a,h){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return[4,Nc(this.La,u,!0)];case 1:return e=t.sent(),n=new mf(u,e.gh),r=n.Su(e.documents),i=to.Ht(a,h&&"Offline"!==this.onlineState),o=n.Un(r,this.el,i),this.il(a,o.$u),s=new hf(u,a,n),[2,(this.ju.set(u,s),this.Ku.has(a)?this.Ku.get(a).push(u):this.Ku.set(a,[u]),o.snapshot)]}})})},bf.prototype.lc=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return this.nl("unlisten()"),e=this.ju.get(i),1<(n=this.Ku.get(e.targetId)).length?[2,(this.Ku.set(e.targetId,n.filter(function(t){return!Eu(t,i)})),void this.ju.delete(i))]:this.el?(this.Uu.su(e.targetId),this.Uu.Yc(e.targetId)?[3,2]:[4,Tc(this.La,e.targetId,!1).then(function(){r.Uu.ru(e.targetId),r.Bu.lc(e.targetId),r.rl(e.targetId)}).catch(Ac)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.rl(e.targetId),[4,Tc(this.La,e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},bf.prototype.write=function(s,u){return g(this,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:this.nl("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(e=this.La,h=s,f=e,l=Jr.now(),n=h.reduce(function(t,e){return t.add(e.key)},Hi()),f.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.Rh.Zn(a,n).next(function(t){c=t;for(var u,e,n=[],r=0,i=h;r<i.length;r++){var o=i[r],s=(u=o,e=c.get(o.key),u instanceof js?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof iu?t.field(i.field):void 0,s=os(i.transform,o||null);null!=s&&(e=null==e?(new Xs).set(i.field,s):e.set(i.field,s))}return e?e.ze():null}(e):null);null!=s&&n.push(new Us(o.key,s,function u(t){var a=[];return zr(t.fields||{},function(t,e){var n=new ri([t]);if(Ro(e)){var r=u(e.mapValue).fields;if(0===r.length)a.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];a.push(n.child(s))}}else a.push(n)}),new Is(a)}(s.proto.mapValue),As.exists(!0)))}return f.Gn.Ir(a,l,n,h)})}).then(function(t){var e=t.An(c);return{batchId:t.batchId,Fn:e}}))];case 2:return r=t.sent(),this.Uu.Jc(r.batchId),this.ol(r.batchId,u),[4,this.hl(r.Fn)];case 3:return t.sent(),[4,this.Bu.hc()];case 4:return t.sent(),[3,6];case 5:return i=t.sent(),o=Ba(i,"Failed to persist write"),u.reject(o),[3,6];case 6:return[2]}var e,h,c,f,l,n})})},bf.prototype.mc=function(i){return g(this,void 0,void 0,function(){var n,r=this;return w(this,function(t){switch(t.label){case 0:this.nl("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=this.La,c=e,f=(s=i).Z,l=c.Eh,c.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var i=c.Ah.jr({Gr:!0});l=c.Eh;var h=[];s.Wt.forEach(function(t,e){var n,r,i,o,s,u=l.get(e);u&&(h.push(c.ko.mo(a,t.Zt,e).next(function(){return c.ko.To(a,t.Jt,e)})),0<(n=t.resumeToken).Y()&&(r=u.et(n,f).tt(a.Ro),l=l.st(e,r),i=u,s=t,Pr(0<(o=r).resumeToken.Y()),(0===i.resumeToken.Y()||3e8<=o.Z.I()-i.Z.I()||0<s.Jt.size+s.Xt.size+s.Zt.size)&&h.push(c.ko.lo(a,r))))});var t,o=Fi,n=Hi();return s.Kt.forEach(function(t,e){n=n.add(t)}),h.push(i.getEntries(a,n).next(function(r){s.Kt.forEach(function(t,e){var n=r.get(t);e instanceof ou&&e.version.isEqual($r.min())?(i.Mn(t,f),o=o.st(t,e)):null==n||0<e.version.o(n.version)||0===e.version.o(n.version)&&n.hasPendingWrites?(i.xn(e,f),o=o.st(t,e)):kr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.Gt.has(t)&&h.push(c.persistence.dr.wh(a,t))})})),f.isEqual($r.min())||(t=c.ko.ro(a).next(function(t){return c.ko.ho(a,a.Ro,f)}),h.push(t)),ia.Cn(h).next(function(){return i.apply(a)}).next(function(){return c.Rh.ts(a,o)})}).then(function(t){return c.Eh=l,t}))];case 2:return n=t.sent(),i.Wt.forEach(function(t,e){var n=r.Hu.get(e);n&&(Pr(t.Jt.size+t.Xt.size+t.Zt.size<=1),0<t.Jt.size?n.qu=!0:0<t.Xt.size?Pr(n.qu):0<t.Zt.size&&(Pr(n.qu),n.qu=!1))}),[4,this.hl(n,i)];case 3:return t.sent(),[3,6];case 4:return[4,Ac(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,s,c,f,l})})},bf.prototype.xu=function(r,t){var i;(this.el&&0===t||!this.el&&1===t)&&(this.nl("applyOnlineStateChange()"),i=[],this.ju.forEach(function(t,e){var n=e.view.xu(r);n.snapshot&&i.push(n.snapshot)}),this.Wu.al(r),this.Wu.Ea(i),this.onlineState=r,this.el&&this.Uu.cu(r))},bf.prototype.Ic=function(u,a){return g(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return w(this,function(t){switch(t.label){case 0:return this.nl("rejectListens()"),this.Uu.ou(u,"rejected",a),e=this.Hu.get(u),(n=e&&e.key)?(r=(r=new Ri(ii.P)).st(n,new ou(n,$r.min())),i=Hi().add(n),o=new $i($r.min(),new Map,new Vi(Vr),r,i),[4,this.mc(o)]):[3,2];case 1:return t.sent(),this.zu=this.zu.remove(n),this.Hu.delete(u),this.cl(),[3,4];case 2:return[4,Tc(this.La,u,!1).then(function(){return s.rl(u,a)}).catch(Ac)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},bf.prototype.yc=function(i){return g(this,void 0,void 0,function(){var n,r;return w(this,function(t){switch(t.label){case 0:this.nl("applySuccessfulWrite()"),n=i.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=this.La,c=i,(f=e).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var i,e=c.batch.keys(),n=f.Ah.jr({Gr:!0}),r=f,o=t,s=n,u=(i=c).batch,a=u.keys(),h=ia.resolve();return a.forEach(function(r){h=h.next(function(){return s.Ln(o,r)}).next(function(t){var e=t,n=i.Pn.get(r);Pr(null!==n),(!e||e.version.o(n)<0)&&(e=u.En(r,e,i))&&s.xn(e,i.Rn)})}),h.next(function(){return r.Gn.br(o,u)}).next(function(){return n.apply(t)}).next(function(){return f.Gn.Cr(t)}).next(function(){return f.Rh.Zn(t,e)})}))];case 2:return r=t.sent(),this.ul(n,null),this.ll(n),this.Uu.Zc(n,"acknowledged"),[4,this.hl(r)];case 3:return t.sent(),[3,6];case 4:return[4,Ac(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,c,f})})},bf.prototype.bc=function(o,s){return g(this,void 0,void 0,function(){var n;return w(this,function(t){switch(t.label){case 0:this.nl("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=this.La,r=o,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Gn.Rr(e,r).next(function(t){return Pr(null!==t),n=t.keys(),i.Gn.br(e,t)}).next(function(){return i.Gn.Cr(e)}).next(function(){return i.Rh.Zn(e,n)})}))];case 2:return n=t.sent(),this.ul(o,s),this.ll(o),this.Uu.Zc(o,"rejected",s),[4,this.hl(n)];case 3:return t.sent(),[3,6];case 4:return[4,Ac(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})},bf.prototype._l=function(u){return g(this,void 0,void 0,function(){var r,i,o,s;return w(this,function(t){switch(t.label){case 0:this.Bu.Ga()||kr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=this.La,(n=e).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return n.Gn.Vr(t)}))];case 2:return-1===(r=t.sent())?[2,void u.resolve()]:((i=this.Xu.get(r)||[]).push(u),this.Xu.set(r,i),[3,4]);case 3:return o=t.sent(),s=Ba(o,"Initialization of waitForPendingWrites() operation failed"),u.reject(s),[3,4];case 4:return[2]}var e,n})})},bf.prototype.ll=function(t){(this.Xu.get(t)||[]).forEach(function(t){t.resolve()}),this.Xu.delete(t)},bf.prototype.fl=function(e){this.Xu.forEach(function(t){t.forEach(function(t){t.reject(new Zr(Qr.CANCELLED,e))})}),this.Xu.clear()},bf.prototype.ol=function(t,e){var n=(n=(n=this.Ju[this.currentUser.$h()])||new Ri(Vr)).st(t,e);this.Ju[this.currentUser.$h()]=n},bf.prototype.ul=function(t,e){var n,r=this.Ju[this.currentUser.$h()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.Ju[this.currentUser.$h()]=r)},bf.prototype.rl=function(t,e){var n=this;void 0===e&&(e=null),this.Uu.su(t);for(var r=0,i=this.Ku.get(t);r<i.length;r++){var o=i[r];this.ju.delete(o),e&&this.Wu.dl(o,e)}this.Ku.delete(t),this.el&&this.Yu.Ch(t).forEach(function(t){n.Yu.Nr(t)||n.wl(t)})},bf.prototype.wl=function(t){var e=this.zu.get(t);null!==e&&(this.Bu.lc(e),this.zu=this.zu.remove(t),this.Hu.delete(e),this.cl())},bf.prototype.il=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof uf?(this.Yu.Eo(i.key,t),this.Tl(i)):i instanceof af?(kr("SyncEngine","Document no longer in limbo: "+i.key),this.Yu.Io(i.key,t),this.Yu.Nr(i.key)||this.wl(i.key)):Or()}},bf.prototype.Tl=function(t){var e=t.key;this.zu.get(e)||(kr("SyncEngine","New document in limbo: "+e),this.Gu.push(e),this.cl())},bf.prototype.cl=function(){for(;0<this.Gu.length&&this.zu.size<this.Qu;){var t=this.Gu.shift(),e=this.Zu.next();this.Hu.set(e,new cf(t)),this.zu=this.zu.st(t,e),this.Bu.listen(new Ai(gu(du(t.path)),e,2,ca.Es))}},bf.prototype.El=function(){return this.zu},bf.prototype.ml=function(){return this.Gu},bf.prototype.hl=function(r,a){return g(this,void 0,void 0,function(){var o,s,e,u=this;return w(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.ju.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Su(r);return n.Nu?Nc(u.La,i.query,!1).then(function(t){var e=t.documents;return i.view.Su(e,n)}):n}).then(function(t){var e,n=a&&a.Wt.get(i.targetId),r=i.view.Un(t,u.el,n);u.il(i.targetId,r.$u),r.snapshot&&(u.el&&u.Uu.ou(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=ha._s(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Wu.Ea(o),[4,function(c,f){return g(this,void 0,void 0,function(){var r,e,n,i,o,s,u,a,h;return w(this,function(t){switch(t.label){case 0:r=c,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return ia.forEach(f,function(e){return ia.forEach(e.us,function(t){return r.persistence.dr.Eo(n,e.targetId,t)}).next(function(){return ia.forEach(e.ls,function(t){return r.persistence.dr.Io(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!ka(e=t.sent()))throw e;return kr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=f;n<i.length;n++)o=i[n],s=o.targetId,o.fromCache||(u=r.Eh.get(s),a=u.Z,h=u.nt(a),r.Eh=r.Eh.st(s,h));return[2]}})})}(this.La,s)];case 2:return t.sent(),[2]}})})},bf.prototype.nl=function(t){},bf.prototype.vc=function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:(kr("SyncEngine","User change. New user:",n.$h()),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,m,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).Gn,m=e.Rh,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Gn.yr(v).next(function(t){return g=t,n=e.persistence.oh(o),m=new aa(e.Ah,n,e.persistence.uh()),n.yr(v)}).next(function(t){for(var e=[],n=[],r=Hi(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Zn(v,r).next(function(t){return{Il:t,Al:e,Rl:n}})})})];case 1:return r=t.sent(),[2,(e.Gn=n,e.Rh=m,e.Th.Ph(e.Rh),r)]}})})}(this.La,n)]);case 1:return e=t.sent(),this.currentUser=n,this.fl("'waitForPendingWrites' promise is rejected due to a user change."),this.Uu.au(n,e.Al,e.Rl),[4,this.hl(e.Il)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},bf.prototype.Oe=function(t){var e=this.Hu.get(t);if(e&&e.qu)return Hi().add(e.key);var n=Hi(),r=this.Ku.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.ju.get(s),n=n.Nt(u.view.vu);return n},bf);function bf(t,e,n,r,i,o){this.La=t,this.Bu=e,this.qa=n,this.Uu=r,this.currentUser=i,this.Qu=o,this.Wu=null,this.ju=new Xr(Iu,Eu),this.Ku=new Map,this.Gu=[],this.zu=new Ri(ii.P),this.Hu=new Map,this.Yu=new Sc,this.Ju={},this.Xu=new Map,this.Zu=tc.eo(),this.onlineState="Unknown",this.tl=void 0}function Ef(t,e){this.query=t,this.gu=e,this.Vu=null,this.Yt=!1,this.yu=Hi(),this.qt=Hi(),this.pu=_u(t),this.bu=new Qi(this.pu)}function If(){this.Ru=new yf,this.Pu={},this.Da=null,this.fs=null}function Tf(t,e,n,r,i){this.window=t,this.ms=e,this.persistenceKey=n,this.kc=r,this.fc=null,this.Da=null,this.fs=null,this.$c=this.xc.bind(this),this.Oc=new Ri(Vr),this.tr=!1,this.Mc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Lc=rf(this.persistenceKey,this.kc),this.qc="firestore_sequence_number_"+this.persistenceKey,this.Oc=this.Oc.st(this.kc,new yf),this.Bc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Uc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Qc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Wc="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.$c)}function Nf(){this.activeTargetIds=Wi}function _f(t,e){this.clientId=t,this.onlineState=e}function Af(t,e){this.clientId=t,this.activeTargetIds=e}function Sf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Df(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function kf(y,v){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=y,n=[],r=[],i=0,o=v,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.Ku.get(s))&&0!==a.length?[4,Ic(e.La,gu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),h=0,c=a,t.label=3;case 3:return h<c.length?(f=c[h],l=e.ju.get(f),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,Nc((e=i).La,o.query,!0)];case 1:return n=t.sent(),r=o.view.Mu(n),[2,(e.el&&e.il(o.targetId,r.$u),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,_c(e.La,s)];case 8:return d=t.sent(),[4,Ic(e.La,d)];case 9:return u=t.sent(),[4,e.sl(Rf(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Wu.Ea(r),n)]}})})}function Rf(t){return pu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Lf(){this.Pl=void 0,this.listeners=[]}var xf,Of=(Gf.prototype.listen=function(u){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.gl.get(e))||(n=!0,r=new Lf),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.fc.listen(e)];case 2:return i.Pl=t.sent(),[3,4];case 3:return o=t.sent(),s=Ba(o,"Initialization of query '"+Tu(u.query)+"' failed"),[2,void u.onError(s)];case 4:return this.gl.set(e,r),r.listeners.push(u),u.xu(this.onlineState),r.Pl&&u.yl(r.Pl)&&this.pl(),[2]}})})},Gf.prototype.lc=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){return e=o.query,n=!1,(r=this.gl.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?[2,(this.gl.delete(e),this.fc.lc(e))]:[2]})})},Gf.prototype.Ea=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.gl.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].yl(i)&&(e=!0);s.Pl=i}}e&&this.pl()},Gf.prototype.dl=function(t,e){var n=this.gl.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.gl.delete(t)},Gf.prototype.al=function(i){this.onlineState=i;var o=!1;this.gl.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].xu(i)&&(o=!0)}),o&&this.pl()},Gf.prototype.bl=function(t){this.Vl.add(t),t.next()},Gf.prototype.vl=function(t){this.Vl.delete(t)},Gf.prototype.pl=function(){this.Vl.forEach(function(t){t.next()})},Gf),Pf=(jf.prototype.yl=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ji(t.query,t.docs,t.Lt,e,t.qt,t.fromCache,t.Bt,!0)}var o=!1;return this.Dl?this.Nl(t)&&(this.Sl.next(t),o=!0):this.Fl(t,this.onlineState)&&(this.kl(t),o=!0),this.Cl=t,o},jf.prototype.onError=function(t){this.Sl.error(t)},jf.prototype.xu=function(t){this.onlineState=t;var e=!1;return this.Cl&&!this.Dl&&this.Fl(this.Cl,t)&&(this.kl(this.Cl),e=!0),e},jf.prototype.Fl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.$l&&n||t.docs._()&&"Offline"!==e)},jf.prototype.Nl=function(t){if(0<t.docChanges.length)return!0;var e=this.Cl&&this.Cl.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},jf.prototype.kl=function(t){t=Ji.Qt(t.query,t.docs,t.qt,t.fromCache),this.Dl=!0,this.Sl.next(t)},jf),Cf=(qf.prototype.Ph=function(t){this.xl=t},qf.prototype.ns=function(e,r,i,o){var s=this;return r.hn()||i.isEqual($r.min())?this.Ol(e,r):this.xl.Zn(e,o).next(function(t){var n=s.Ml(r,t);return(r.an()||r.cn())&&s.Nu(r.nn,n,o,i)?s.Ol(e,r):(Dr()<=l.DEBUG&&kr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Tu(r)),s.xl.ns(e,r,i).next(function(e){return n.forEach(function(t){e=e.st(t.key,t)}),e}))})},qf.prototype.Ml=function(n,t){var r=new Vi(_u(n));return t.forEach(function(t,e){e instanceof iu&&Nu(n,e)&&(r=r.add(e))}),r},qf.prototype.Nu=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.o(r))},qf.prototype.Ol=function(t,e){return Dr()<=l.DEBUG&&kr("IndexFreeQueryEngine","Using full collection scan to execute query:",Tu(e)),this.xl.ns(t,e,$r.min())},qf),Uf=(Ff.prototype.mr=function(t){return ia.resolve(0===this.Gn.length)},Ff.prototype.Ir=function(t,e,n,r){var i=this.Ll;this.Ll++,0<this.Gn.length&&this.Gn[this.Gn.length-1];var o=new na(i,e,n,r);this.Gn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.ql=this.ql.add(new Dc(a.key,i)),this.zn.Ar(t,a.key.path.p())}return ia.resolve(o)},Ff.prototype.Rr=function(t,e){return ia.resolve(this.Bl(e))},Ff.prototype.gr=function(t,e){var n=e+1,r=this.Ul(n),i=r<0?0:r;return ia.resolve(this.Gn.length>i?this.Gn[i]:null)},Ff.prototype.Vr=function(){return ia.resolve(0===this.Gn.length?-1:this.Ll-1)},Ff.prototype.yr=function(t){return ia.resolve(this.Gn.slice())},Ff.prototype.Yn=function(t,e){var n=this,r=new Dc(e,0),i=new Dc(e,Number.POSITIVE_INFINITY),o=[];return this.ql.St([r,i],function(t){var e=n.Bl(t.kh);o.push(e)}),ia.resolve(o)},Ff.prototype.es=function(t,e){var r=this,i=new Vi(Vr);return e.forEach(function(t){var e=new Dc(t,0),n=new Dc(t,Number.POSITIVE_INFINITY);r.ql.St([e,n],function(t){i=i.add(t.kh)})}),ia.resolve(this.Ql(i))},Ff.prototype.as=function(t,e){var n=e.path,r=n.length+1,i=n;ii.j(i)||(i=i.child(""));var o=new Dc(new ii(i),0),s=new Vi(Vr);return this.ql.Dt(function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.kh)),!0)},o),ia.resolve(this.Ql(s))},Ff.prototype.Ql=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Bl(t);null!==e&&r.push(e)}),r},Ff.prototype.br=function(n,r){var i=this;Pr(0===this.Wl(r.batchId,"removed")),this.Gn.shift();var o=this.ql;return ia.forEach(r.mutations,function(t){var e=new Dc(t.key,r.batchId);return o=o.delete(e),i.dr.Dr(n,t.key)}).next(function(){i.ql=o})},Ff.prototype.Sr=function(t){},Ff.prototype.Nr=function(t,e){var n=new Dc(e,0),r=this.ql.Ct(n);return ia.resolve(e.isEqual(r&&r.key))},Ff.prototype.Cr=function(t){return this.Gn.length,ia.resolve()},Ff.prototype.Wl=function(t,e){return this.Ul(t)},Ff.prototype.Ul=function(t){return 0===this.Gn.length?0:t-this.Gn[0].batchId},Ff.prototype.Bl=function(t){var e=this.Ul(t);return e<0||e>=this.Gn.length?null:this.Gn[e]},Ff),Vf=(Mf.prototype.xn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.jl(e);return this.docs=this.docs.st(r,{Or:e,size:s,readTime:n}),this.size+=s-o,this.zn.Ar(t,r.path.p())},Mf.prototype.Mn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Mf.prototype.Ln=function(t,e){var n=this.docs.get(e);return ia.resolve(n?n.Or:null)},Mf.prototype.getEntries=function(t,e){var n=this,r=Fi;return e.forEach(function(t){var e=n.docs.get(t);r=r.st(t,e?e.Or:null)}),ia.resolve(r)},Mf.prototype.ns=function(t,e,n){for(var r=Gi,i=new ii(e.path.child("")),o=this.docs.ut(i);o.Tt();){var s=o.wt(),u=s.key,a=s.value,h=a.Or,c=a.readTime;if(!e.path.D(u.path))break;c.o(n)<=0||h instanceof iu&&Nu(e,h)&&(r=r.st(h.key,h))}return ia.resolve(r)},Mf.prototype.Kl=function(t,e){return ia.forEach(this.docs,function(t){return e(t)})},Mf.prototype.jr=function(t){return new Mf.Kr(this)},Mf.prototype.zr=function(t){return ia.resolve(this.size)},Mf);function Mf(t,e){this.zn=t,this.jl=e,this.docs=new Ri(ii.P),this.size=0}function Ff(t,e){this.zn=t,this.dr=e,this.Gn=[],this.Ll=1,this.ql=new Vi(Dc.yh)}function qf(){}function jf(t,e,n){this.query=t,this.Sl=e,this.Dl=!1,this.Cl=null,this.onlineState="Unknown",this.options=n||{}}function Gf(t){this.fc=t,this.gl=new Xr(Iu,Eu),this.onlineState="Unknown",this.Vl=new Set,this.fc.subscribe(this)}function Bf(t){var e=this;return(e=xf.call(this)||this).Hr=t,e}Vf.Kr=(n(Bf,xf=oa),Bf.prototype.Un=function(n){var r=this,i=[];return this.Fn.forEach(function(t,e){e?i.push(r.Hr.xn(n,e,r.readTime)):r.Hr.Mn(t)}),ia.Cn(i)},Bf.prototype.qn=function(t,e){return this.Hr.Ln(t,e)},Bf.prototype.Bn=function(t,e){return this.Hr.getEntries(t,e)},Bf);var zf,Hf,Wf=(hl.prototype.be=function(t,n){return this.Gl.forEach(function(t,e){return n(e)}),ia.resolve()},hl.prototype.ro=function(t){return ia.resolve(this.lastRemoteSnapshotVersion)},hl.prototype.oo=function(t){return ia.resolve(this.zl)},hl.prototype.no=function(t){return this.highestTargetId=this.Yl.next(),ia.resolve(this.highestTargetId)},hl.prototype.ho=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zl&&(this.zl=e),ia.resolve()},hl.prototype.co=function(t){this.Gl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yl=new tc(e),this.highestTargetId=e),t.sequenceNumber>this.zl&&(this.zl=t.sequenceNumber)},hl.prototype.ao=function(t,e){return this.co(e),this.targetCount+=1,ia.resolve()},hl.prototype.lo=function(t,e){return this.co(e),ia.resolve()},hl.prototype._o=function(t,e){return this.Gl.delete(e.target),this.Hl.Ch(e.targetId),--this.targetCount,ia.resolve()},hl.prototype.hr=function(n,r,i){var o=this,s=0,u=[];return this.Gl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Gl.delete(t),u.push(o.fo(n,e.targetId)),s++)}),ia.Cn(u).next(function(){return s})},hl.prototype.do=function(t){return ia.resolve(this.targetCount)},hl.prototype.wo=function(t,e){var n=this.Gl.get(e)||null;return ia.resolve(n)},hl.prototype.To=function(t,e,n){return this.Hl.vh(e,n),ia.resolve()},hl.prototype.mo=function(e,t,n){this.Hl.Dh(t,n);var r=this.persistence.dr,i=[];return r&&t.forEach(function(t){i.push(r.Dr(e,t))}),ia.Cn(i)},hl.prototype.fo=function(t,e){return this.Hl.Ch(e),ia.resolve()},hl.prototype.Ao=function(t,e){var n=this.Hl.Fh(e);return ia.resolve(n)},hl.prototype.Nr=function(t,e){return ia.resolve(this.Hl.Nr(e))},hl),Kf=(al.prototype.start=function(){return Promise.resolve()},al.prototype.th=function(){return this.po=!1,Promise.resolve()},Object.defineProperty(al.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),al.prototype.Bo=function(){},al.prototype.Uo=function(){},al.prototype.uh=function(){return this.zn},al.prototype.oh=function(t){var e=this.Jl[t.$h()];return e||(e=new Uf(this.zn,this.dr),this.Jl[t.$h()]=e),e},al.prototype.hh=function(){return this.ko},al.prototype.ah=function(){return this.Kn},al.prototype.runTransaction=function(t,e,n){var r=this;kr("MemoryPersistence","Starting transaction:",t);var i=new Yf(this.yo.next());return this.dr.Zl(),n(i).next(function(t){return r.dr.t_(i).next(function(){return t})}).Sn().then(function(t){return i.jn(),t})},al.prototype.e_=function(e,n){return ia.Nn(Object.values(this.Jl).map(function(t){return function(){return t.Nr(e,n)}}))},al),Yf=(n(ul,Hf=ua),ul),Xf=(sl.i_=function(t){return new sl(t)},Object.defineProperty(sl.prototype,"r_",{get:function(){if(this.s_)return this.s_;throw Or()},enumerable:!1,configurable:!0}),sl.prototype.Eo=function(t,e,n){return this.n_.Eo(n,e),this.r_.delete(n.toString()),ia.resolve()},sl.prototype.Io=function(t,e,n){return this.n_.Io(n,e),this.r_.add(n.toString()),ia.resolve()},sl.prototype.Dr=function(t,e){return this.r_.add(e.toString()),ia.resolve()},sl.prototype.removeTarget=function(t,e){var n=this;this.n_.Ch(e.targetId).forEach(function(t){return n.r_.add(t.toString())});var r=this.persistence.hh();return r.Ao(t,e.targetId).next(function(t){t.forEach(function(t){return n.r_.add(t.toString())})}).next(function(){return r._o(t,e)})},sl.prototype.Zl=function(){this.s_=new Set},sl.prototype.t_=function(n){var r=this,i=this.persistence.ah().jr();return ia.forEach(this.r_,function(t){var e=ii.B(t);return r.o_(n,e).next(function(t){t||i.Mn(e)})}).next(function(){return r.s_=null,i.apply(n)})},sl.prototype.wh=function(t,e){var n=this;return this.o_(t,e).next(function(t){t?n.r_.delete(e.toString()):n.r_.add(e.toString())})},sl.prototype.Xl=function(t){return 0},sl.prototype.o_=function(t,e){var n=this;return ia.Nn([function(){return ia.resolve(n.n_.Nr(e))},function(){return n.persistence.hh().Nr(t,e)},function(){return n.persistence.e_(t,e)}])},sl),Qf=(ol.prototype.wa=function(t){this.c_=t},ol.prototype.ua=function(t){this.u_=t},ol.prototype.onMessage=function(t){this.l_=t},ol.prototype.close=function(){this.a_()},ol.prototype.send=function(t){this.h_(t)},ol.prototype.__=function(){this.c_()},ol.prototype.f_=function(t){this.u_(t)},ol.prototype.d_=function(t){this.l_(t)},ol),Zf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Jf=(il.prototype.va=function(e,t,n,r){var i=this.m_(e,t);kr("RestConnection","Sending: ",i,n);var o={};return this.I_(o,r),this.A_(e,i,o,n).then(function(t){return kr("RestConnection","Received: ",t),t},function(t){throw Lr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},il.prototype.Sa=function(t,e,n,r){return this.va(t,e,n,r)},il.prototype.I_=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.0-202071902151",t["Content-Type"]="text/plain",e)for(var n in e.Mh)e.Mh.hasOwnProperty(n)&&(t[n]=e.Mh[n])},il.prototype.m_=function(t,e){var n=Zf[t];return this.T_+"/v1/"+e+":"+n},n(rl,zf=il),rl.prototype.A_=function(a,e,n,r){return new Promise(function(o,s){var u=new Tr;u.listenOnce(Er.COMPLETE,function(){try{switch(u.getLastErrorCode()){case br.NO_ERROR:var t=u.getResponseJson();kr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case br.TIMEOUT:kr("Connection",'RPC "'+a+'" timed out'),s(new Zr(Qr.DEADLINE_EXCEEDED,"Request time out"));break;case br.HTTP_ERROR:var e,n,r=u.getStatus();kr("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Qr).indexOf(i)?i:Qr.UNKNOWN,s(new Zr(n,e.message))):s(new Zr(Qr.UNKNOWN,"Server responded with status "+u.getStatus())):s(new Zr(Qr.UNAVAILABLE,"Connection failed."));break;default:Or()}}finally{kr("Connection",'RPC "'+a+'" completed.')}var i});var t=JSON.stringify(r);u.send(e,"POST",t,n,15)})},rl.prototype.Ta=function(t,e){var n,r,i=[this.T_,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=wr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.I_(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}kr("Connection","Creating WebChannel: "+u,s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new Qf({h_:function(t){f?kr("Connection","Not sending because WebChannel is closed:",t):(c||(kr("Connection","Opening WebChannel transport."),h.open(),c=!0),kr("Connection","WebChannel sending:",t),h.send(t))},a_:function(){return h.close()}});return a(Ir.EventType.OPEN,function(){f||kr("Connection","WebChannel transport opened.")}),a(Ir.EventType.CLOSE,function(){f||(f=!0,kr("Connection","WebChannel transport closed"),l.f_())}),a(Ir.EventType.ERROR,function(t){f||(f=!0,Lr("Connection","WebChannel transport errored:",t),l.f_(new Zr(Qr.UNAVAILABLE,"The operation could not be completed")))}),a(Ir.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Pr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(kr("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=Ni[i];if(void 0!==t)return ki(t)}(),s=r.message,void 0===o&&(o=Qr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.f_(new Zr(o,s)),h.close()):(kr("Connection","WebChannel received:",n),l.d_(n)))}),setTimeout(function(){l.__()},0),l},rl),$f=(nl.prototype.Ka=function(t){this.y_.push(t)},nl.prototype.th=function(){window.removeEventListener("online",this.R_),window.removeEventListener("offline",this.g_)},nl.prototype.p_=function(){window.addEventListener("online",this.R_),window.addEventListener("offline",this.g_)},nl.prototype.P_=function(){kr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(0)},nl.prototype.V_=function(){kr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(1)},nl.ks=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},nl),tl=(el.prototype.Ka=function(t){},el.prototype.th=function(){},el);function el(){}function nl(){var t=this;this.R_=function(){return t.P_()},this.g_=function(){return t.V_()},this.y_=[],this.p_()}function rl(t){var e=this;return(e=zf.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function il(t){this.w_=t,this.s=t.s;var e=t.ssl?"https":"http";this.T_=e+"://"+t.host,this.E_="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}function ol(t){this.h_=t.h_,this.a_=t.a_}function sl(t){this.persistence=t,this.n_=new Sc,this.s_=null}function ul(t){var e=this;return(e=Hf.call(this)||this).Ro=t,e}function al(t){var e=this;this.Jl={},this.yo=new ca(0),this.po=!1,this.po=!0,this.dr=t(this),this.ko=new Wf(this),this.zn=new Dh,this.Kn=new Vf(this.zn,function(t){return e.dr.Xl(t)})}function hl(t){this.persistence=t,this.Gl=new Xr(mi,wi),this.lastRemoteSnapshotVersion=$r.min(),this.highestTargetId=0,this.zl=0,this.Hl=new Sc,this.targetCount=0,this.Yl=tc.to()}function cl(t){return new Oo(t,!0)}var fl,ll,pl="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",dl=(bl.prototype.initialize=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Uu=this.b_(e),this.persistence=this.v_(e),[4,this.persistence.start()];case 1:return t.sent(),this.S_=this.D_(e),this.La=this.C_(e),[2]}})})},bl.prototype.D_=function(t){return null},bl.prototype.C_=function(t){return e=this.persistence,n=new Cf,r=t.N_,new wc(e,n,r);var e,n,r},bl.prototype.v_=function(t){if(t.k_.F_)throw new Zr(Qr.FAILED_PRECONDITION,pl);return new Kf(Xf.i_)},bl.prototype.b_=function(t){return new gf},bl.prototype.terminate=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.S_&&this.S_.stop(),[4,this.Uu.th()];case 1:return t.sent(),[4,this.persistence.th()];case 2:return t.sent(),[2]}})})},bl.prototype.clearPersistence=function(t,e){throw new Zr(Qr.FAILED_PRECONDITION,pl)},bl),yl=(n(wl,ll=dl),wl.prototype.initialize=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,ll.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){return n=(e=r).Ah,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Wr(t)}).then(function(t){e.Ih=t})]})})}(this.La)];case 2:return t.sent(),[2]}})})},wl.prototype.D_=function(t){var e=this.persistence.dr.Yi;return new Qa(e,t.ei)},wl.prototype.v_=function(t){var e=mc(t.w_.s,t.w_.persistenceKey),n=cl(t.w_.s);return new cc(t.k_.synchronizeTabs,e,t.clientId,Ka.Ui(t.k_.cacheSizeBytes),t.ei,Va(),Ma(),n,this.Uu,t.k_.Vo)},wl.prototype.b_=function(t){return new gf},wl.prototype.clearPersistence=function(t,e){return function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Ia.ks()?(e=n+"main",[4,Ia.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(mc(t,e))},n(ml,fl=wl),ml.prototype.initialize=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return[4,fl.prototype.initialize.call(this,r)];case 1:return t.sent(),[4,this.x_.initialize(this,r)];case 2:return t.sent(),e=this.x_.fc,this.Uu instanceof vf?(this.Uu.fc={mu:function(u,a,h,c){return g(this,void 0,void 0,function(){var o,s;return w(this,function(t){switch(t.label){case 0:return(o=u).nl("applyBatchState()"),[4,(e=o.La,n=a,i=(r=e).Gn,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Pr(e,n).next(function(t){return t?r.Rh.Zn(e,t):ia.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==h?[3,3]:[4,o.Bu.hc()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===h||"rejected"===h?(o.ul(a,c||null),o.La.Gn.Sr(a)):Or(),t.label=4;case 4:return[4,o.hl(s)];case 5:return t.sent(),[3,7];case 6:kr("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}.bind(null,e),Iu:function(s,u,a,h){return g(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=s).tl?(kr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.Ku.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=n.La,e=r.Ah,r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.Ur(t,r.Ih)}).then(function(t){var e=t.Qr,n=t.readTime;return r.Ih=n,e}))];case 3:return i=t.sent(),o=$i.zt(u,"current"===a),[4,n.hl(i,o)];case 4:return t.sent(),[3,8];case 5:return[4,Tc(n.La,u,!0)];case 6:return t.sent(),n.rl(u,h),[3,8];case 7:Or(),t.label=8;case 8:return[2]}var r,e})})}.bind(null,e),Au:function(f,l,p){return g(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,h,c;return w(this,function(t){switch(t.label){case 0:if(!(n=f).tl)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.Ku.has(i)?(kr("SyncEngine","Adding an already active target "+i),[3,5]):[4,_c(n.La,i)]):[3,6];case 2:return o=t.sent(),[4,Ic(n.La,o)];case 3:return s=t.sent(),[4,n.sl(Rf(o),s.targetId,!1)];case 4:t.sent(),n.Bu.listen(s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.Ku.has(e)?[4,Tc(n.La,e,!1).then(function(){n.Bu.lc(e),n.rl(e)}).catch(Ac)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,u(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),rh:function(t){return t.La.persistence.rh()}.bind(null,e)},[4,this.Uu.start()]):[3,4];case 3:t.sent(),t.label=4;case 4:return[4,this.persistence.qo(function(e){return g(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,function(c,f){return g(this,void 0,void 0,function(){var r,e,i,o,s,u,a,h;return w(this,function(t){switch(t.label){case 0:return r=c,!0!==f||!0===r.tl?[3,3]:(e=r.Uu.zc(),[4,kf(r,e.N())]);case 1:return i=t.sent(),r.tl=!0,[4,r.Bu.Sc(!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],r.Bu.listen(u);return[3,7];case 3:return!1!==f||!1===r.tl?[3,7]:(a=[],h=Promise.resolve(),r.Ku.forEach(function(t,e){r.Uu.iu(e)?a.push(e):h=h.then(function(){return r.rl(e),Tc(r.La,e,!0)}),r.Bu.lc(e)}),[4,h]);case 4:return t.sent(),[4,kf(r,a)];case 5:return t.sent(),(n=r).Hu.forEach(function(t,e){n.Bu.lc(e)}),n.Yu.Nh(),n.Hu=new Map,n.zu=new Ri(ii.P),r.tl=!1,[4,r.Bu.Sc(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}(this.x_.fc,e)];case 1:return t.sent(),this.S_&&(e&&!this.S_.tr?this.S_.start(this.La):e||this.S_.stop()),[2]}})})})];case 5:return t.sent(),[2]}})})},ml.prototype.b_=function(t){if(t.k_.F_&&t.k_.synchronizeTabs){var e=Va();if(!vf.ks(e))throw new Zr(Qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=mc(t.w_.s,t.w_.persistenceKey);return new vf(e,t.ei,n,t.clientId,t.N_)}return new gf},ml),vl=(gl.prototype.initialize=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.La?[3,3]:(this.La=n.La,this.Uu=n.Uu,this.qa=this.O_(r),this.Bu=this.M_(r),this.fc=this.L_(r),this.q_=this.B_(r),this.Uu.Da=function(t){return e.fc.xu(t,1)},this.Bu.fc=this.fc,[4,this.Bu.start()]);case 1:return t.sent(),[4,this.Bu.Sc(this.fc.el)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},gl.prototype.B_=function(t){return new Of(this.fc)},gl.prototype.O_=function(t){var e,n=cl(t.w_.s),r=(e=t.w_,new Jf(e)),i=t.credentials;return new zc(i,r,n)},gl.prototype.M_=function(t){var e=this;return new Wc(this.La,this.qa,t.ei,function(t){return e.fc.xu(t,0)},new($f.ks()?$f:tl))},gl.prototype.L_=function(t){return e=this.La,n=this.Bu,r=this.qa,i=this.Uu,o=t.N_,s=t.Qu,u=!t.k_.F_||!t.k_.synchronizeTabs,a=new wf(e,n,r,i,o,s),u&&(a.tl=!0),a;var e,n,r,i,o,s,u,a},gl.prototype.terminate=function(){return this.Bu.th()},gl);function gl(){}function ml(t){var e=this;return(e=fl.call(this)||this).x_=t,e}function wl(){return null!==ll&&ll.apply(this,arguments)||this}function bl(){}function El(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Il=(Tl.prototype.next=function(t){this.observer.next&&this.U_(this.observer.next,t)},Tl.prototype.error=function(t){this.observer.error?this.U_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Tl.prototype.Q_=function(){this.muted=!0},Tl.prototype.U_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Tl);function Tl(t){this.observer=t,this.muted=!1}function Nl(t,e){if(0!==e.length)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Gl(e.length,"argument")+".")}function _l(t,e,n){if(e.length!==n)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires "+Gl(n,"argument")+", but was called with "+Gl(e.length,"argument")+".")}function Al(t,e,n){if(e.length<n)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Gl(n,"argument")+", but was called with "+Gl(e.length,"argument")+".")}function Sl(t,e,n,r){if(e.length<n||e.length>r)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Gl(e.length,"argument")+".")}function Dl(t,e,n,r){Pl(t,e,jl(n)+" argument",r)}function kl(t,e,n,r){void 0!==r&&Dl(t,e,n,r)}function Rl(t,e,n,r){Pl(t,e,n+" option",r)}function Ll(t,e,n,r){void 0!==r&&Rl(t,e,n,r)}function xl(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Ul(s))}var u=Ul(n);throw new Zr(Qr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Ol(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid value "+Ul(r)+" provided to function "+t+"() for its "+jl(n)+" argument. Acceptable values: "+e.join(", "));return r}function Pl(t,e,n,r){if(!("object"===e?Cl(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ul(r);throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Cl(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ul(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Or();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Vl(t,e,n){if(void 0===n)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+jl(e)+" argument, but it was undefined.")}function Ml(n,t,r){zr(t,function(t,e){if(r.indexOf(t)<0)throw new Zr(Qr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Fl(t,e,n,r){var i=Ul(r);return new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires its "+jl(n)+" argument to be a "+e+", but it was: "+i)}function ql(t,e,n){if(n<=0)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires its "+jl(e)+" argument to be a positive number, but it was: "+n+".")}function jl(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Gl(t,e){return t+" "+e+(1===t?"":"s")}function Bl(){if("undefined"==typeof Uint8Array)throw new Zr(Qr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function zl(){if("undefined"==typeof atob)throw new Zr(Qr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Hl,Wl,Kl=(ep.fromBase64String=function(t){_l("Blob.fromBase64String",arguments,1),Dl("Blob.fromBase64String","string",1,t),zl();try{return new ep(Ei.fromBase64String(t))}catch(t){throw new Zr(Qr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},ep.fromUint8Array=function(t){if(_l("Blob.fromUint8Array",arguments,1),Bl(),!(t instanceof Uint8Array))throw Fl("Blob.fromUint8Array","Uint8Array",1,t);return new ep(Ei.fromUint8Array(t))},ep.prototype.toBase64=function(){return _l("Blob.toBase64",arguments,0),zl(),this.W_.toBase64()},ep.prototype.toUint8Array=function(){return _l("Blob.toUint8Array",arguments,0),Bl(),this.W_.toUint8Array()},ep.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ep.prototype.isEqual=function(t){return this.W_.isEqual(t.W_)},ep),Yl=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Zr(Qr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(Dl("FieldPath","string",e,t[e]),0===t[e].length)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.j_=new ri(t)},Xl=(n(tp,Wl=Yl),tp.documentId=function(){return new tp(ri.L().F())},tp.prototype.isEqual=function(t){if(!(t instanceof tp))throw Fl("isEqual","FieldPath",1,t);return this.j_.isEqual(t.j_)},tp),Ql=new RegExp("[~\\*/\\[\\]]"),Zl=function(){this.K_=this},Jl=(n($l,Hl=Zl),$l.prototype.z_=function(t){if(2!==t.H_)throw 1===t.H_?t.Y_(this.G_+"() can only appear at the top level of your update data"):t.Y_(this.G_+"() cannot be used with set() unless you pass {merge:true}");return t.qe.push(t.path),null},$l.prototype.isEqual=function(t){return t instanceof $l},$l);function $l(t){var e=this;return(e=Hl.call(this)||this).G_=t,e}function tp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Wl.call(this,t)||this}function ep(t){zl(),this.W_=t}function np(t,e,n){return new Rp({H_:3,J_:e.settings.J_,methodName:t.G_,X_:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var rp,ip,op,sp,up,ap,hp=(n(Dp,ap=Zl),Dp.prototype.z_=function(t){return new Ts(t.path,new as)},Dp.prototype.isEqual=function(t){return t instanceof Dp},Dp),cp=(n(Sp,up=Zl),Sp.prototype.z_=function(t){var e=np(this,t,!0),n=this.Z_.map(function(t){return Mp(t,e)}),r=new hs(n);return new Ts(t.path,r)},Sp.prototype.isEqual=function(t){return this===t},Sp),fp=(n(Ap,sp=Zl),Ap.prototype.z_=function(t){var e=np(this,t,!0),n=this.Z_.map(function(t){return Mp(t,e)}),r=new ds(n);return new Ts(t.path,r)},Ap.prototype.isEqual=function(t){return this===t},Ap),lp=(n(_p,op=Zl),_p.prototype.z_=function(t){var e=new ms(t.serializer,Uo(t.serializer,this.tf));return new Ts(t.path,e)},_p.prototype.isEqual=function(t){return this===t},_p),pp=(n(Np,ip=Zl),Np.delete=function(){return Nl("FieldValue.delete",arguments),new dp(new Jl("FieldValue.delete"))},Np.serverTimestamp=function(){return Nl("FieldValue.serverTimestamp",arguments),new dp(new hp("FieldValue.serverTimestamp"))},Np.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Al("FieldValue.arrayUnion",arguments,1),new dp(new cp("FieldValue.arrayUnion",t))},Np.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Al("FieldValue.arrayRemove",arguments,1),new dp(new fp("FieldValue.arrayRemove",t))},Np.increment=function(t){return Dl("FieldValue.increment","number",1,t),_l("FieldValue.increment",arguments,1),new dp(new lp("FieldValue.increment",t))},Np),dp=(n(Tp,rp=pp),Tp.prototype.z_=function(t){return this.K_.z_(t)},Tp.prototype.isEqual=function(t){return t instanceof Tp&&this.K_.isEqual(t.K_)},Tp),yp=(Object.defineProperty(Ip.prototype,"latitude",{get:function(){return this.ef},enumerable:!1,configurable:!0}),Object.defineProperty(Ip.prototype,"longitude",{get:function(){return this.nf},enumerable:!1,configurable:!0}),Ip.prototype.isEqual=function(t){return this.ef===t.ef&&this.nf===t.nf},Ip.prototype.toJSON=function(){return{latitude:this.ef,longitude:this.nf}},Ip.prototype.T=function(t){return Vr(this.ef,t.ef)||Vr(this.nf,t.nf)},Ip),vp=/^__.*__$/,gp=function(t,e,n){this.sf=t,this.if=e,this.rf=n},mp=(Ep.prototype.hf=function(t,e){var n=[];return null!==this.qe?n.push(new Us(t,this.data,this.qe,e)):n.push(new Cs(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new js(t,this.fieldTransforms)),n},Ep),wp=(bp.prototype.hf=function(t,e){var n=[new Us(t,this.data,this.qe,e)];return 0<this.fieldTransforms.length&&n.push(new js(t,this.fieldTransforms)),n},bp);function bp(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}function Ep(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}function Ip(t,e){if(_l("GeoPoint",arguments,2),Dl("GeoPoint","number",1,t),Dl("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Zr(Qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Zr(Qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ef=t,this.nf=e}function Tp(t){var e=this;return(e=rp.call(this)||this).K_=t,e.G_=t.G_,e}function Np(){return ip.call(this)||this}function _p(t,e){var n=this;return(n=op.call(this)||this).G_=t,n.tf=e,n}function Ap(t,e){var n=this;return(n=sp.call(this)||this).G_=t,n.Z_=e,n}function Sp(t,e){var n=this;return(n=up.call(this)||this).G_=t,n.Z_=e,n}function Dp(t){var e=this;return(e=ap.call(this)||this).G_=t,e}function kp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Or()}}var Rp=(Object.defineProperty(Op.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Op.prototype,"H_",{get:function(){return this.settings.H_},enumerable:!1,configurable:!0}),Op.prototype.cf=function(t){return new Op(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.qe)},Op.prototype.uf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.cf({path:n,X_:!1});return r.lf(t),r},Op.prototype._f=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.cf({path:n,X_:!1});return r.af(),r},Op.prototype.ff=function(t){return this.cf({path:void 0,X_:!0})},Op.prototype.Y_=function(t){return zp(t,this.settings.methodName,this.settings.df||!1,this.path,this.settings.J_)},Op.prototype.contains=function(e){return void 0!==this.qe.find(function(t){return e.D(t)})||void 0!==this.fieldTransforms.find(function(t){return e.D(t.field)})},Op.prototype.af=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.lf(this.path.get(t))},Op.prototype.lf=function(t){if(0===t.length)throw this.Y_("Document fields must not be empty");if(kp(this.H_)&&vp.test(t))throw this.Y_('Document fields cannot begin and end with "__"')},Op),Lp=(xp.prototype.wf=function(t,e,n,r){return void 0===r&&(r=!1),new Rp({H_:t,methodName:e,J_:n,path:ri.$(),X_:!1,df:r},this.s,this.serializer,this.ignoreUndefinedProperties)},xp);function xp(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||cl(t)}function Op(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.af(),this.fieldTransforms=i||[],this.qe=o||[]}function Pp(t,e,n,r,i,o){void 0===o&&(o={});var s=t.wf(o.merge||o.mergeFields?2:0,e,n,i);jp("Data must be an object, but it was:",s,r);var u,a,h=Fp(r,s);if(o.merge)u=new Is(s.qe),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Yl)d=p.j_;else{if("string"!=typeof p)throw Or();d=Bp(e,p,n)}if(!s.contains(d))throw new Zr(Qr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Hp(c,d)||c.push(d)}u=new Is(c),a=s.fieldTransforms.filter(function(t){return u.Ke(t.field)})}else u=null,a=s.fieldTransforms;return new mp(new Ys(h),u,a)}function Cp(t,o,s,e){var u=t.wf(1,o,s);jp("Data must be an object, but it was:",u,e);var a=[],h=new Xs;zr(e,function(t,e){var n,r=Bp(o,t,s),i=u._f(r);e instanceof Zl&&e.K_ instanceof Jl?a.push(r):null!=(n=Mp(e,i))&&(a.push(r),h.set(r,n))});var n=new Is(a);return new wp(h.ze(),n,u.fieldTransforms)}function Up(t,e,n,r,i,o){var s=t.wf(1,e,n),u=[Gp(e,r,n)],a=[i];if(o.length%2!=0)throw new Zr(Qr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<o.length;h+=2)u.push(Gp(e,o[h])),a.push(o[h+1]);for(var c,f,l,p,d=[],y=new Xs,v=u.length-1;0<=v;--v)Hp(d,u[v])||(c=u[v],f=a[v],l=s._f(c),f instanceof Zl&&f.K_ instanceof Jl?d.push(c):null!=(p=Mp(f,l))&&(d.push(c),y.set(c,p)));var g=new Is(d);return new wp(y.ze(),g,s.fieldTransforms)}function Vp(t,e,n,r){return void 0===r&&(r=!1),Mp(n,t.wf(r?4:3,e))}function Mp(s,t){if(qp(s))return jp("Unsupported field value:",t,s),Fp(s,t);if(s instanceof Zl)return function(t,e){if(!kp(e.H_))throw e.Y_(t.G_+"() can only be used with update() and set()");if(!e.path)throw e.Y_(t.G_+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.qe.push(t.path),s instanceof Array){if(t.settings.X_&&4!==t.H_)throw t.Y_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Mp(i[r],t.ff(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Uo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Jr.fromDate(t);return{timestampValue:Vo(e.serializer,n)}}if(t instanceof Jr){var r=new Jr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Vo(e.serializer,r)}}if(t instanceof yp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Kl)return{bytesValue:Mo(e.serializer,t)};if(t instanceof gp){var i=e.s,o=t.sf;if(!o.isEqual(i))throw e.Y_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:qo(t.sf||e.s,t.if.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Y_("Unsupported field value: "+Ul(t))}(s,t)}function Fp(t,r){var i={};return Hr(t)?r.path&&0<r.path.length&&r.qe.push(r.path):zr(t,function(t,e){var n=Mp(e,r.uf(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function qp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Jr||t instanceof yp||t instanceof Kl||t instanceof gp||t instanceof Zl)}function jp(t,e,n){if(!qp(n)||!Cl(n)){var r=Ul(n);throw"an object"===r?e.Y_(t+" a custom object"):e.Y_(t+" "+r)}}function Gp(t,e,n){if(e instanceof Yl)return e.j_;if("string"==typeof e)return Bp(t,e);throw zp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Bp(t,e,n){try{return function(e){if(0<=e.search(Ql))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Xl.bind.apply(Xl,i([void 0],e.split("."))))}catch(t){throw new Zr(Qr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).j_}catch(e){throw zp(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function zp(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Zr(Qr.INVALID_ARGUMENT,(u+=". ")+t+a)}function Hp(t,e){return t.some(function(t){return t.isEqual(e)})}var Wp=(Zp.prototype.Af=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.Rf(),0<this.mutations.length)throw new Zr(Qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return g(this,void 0,void 0,function(){var i,e,n,r,o,s;return w(this,function(t){switch(t.label){case 0:return e=Wo((i=u).serializer)+"/documents",n={documents:a.map(function(t){return Go(i.serializer,t)})},[4,i.Sa("BatchGetDocuments",e,n)];case 1:return r=t.sent(),o=new Map,r.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){Pr(!!e.found),e.found.name,e.found.updateTime;var n=Bo(t,e.found.name),r=Fo(e.found.updateTime),i=new Ys({mapValue:{fields:e.found.fields}});return new iu(n,r,i,{})}(e,n):"missing"in n?function(t,e){Pr(!!e.missing),Pr(!!e.readTime);var n=Bo(t,e.missing),r=Fo(e.readTime);return new ou(n,r)}(e,n):Or());o.set(r.key.toString(),r)}),s=[],[2,(a.forEach(function(t){var e=o.get(t.toString());Pr(!!e),s.push(e)}),s)]}})})}(this.qa,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof ou||t instanceof iu?n.Pf(t):Or()}),e)]}})})},Zp.prototype.set=function(t,e){this.write(e.hf(t,this.Qe(t))),this.If.add(t.toString())},Zp.prototype.update=function(t,e){try{this.write(e.hf(t,this.gf(t)))}catch(t){this.mf=t}this.If.add(t.toString())},Zp.prototype.delete=function(t){this.write([new Ws(t,this.Qe(t))]),this.If.add(t.toString())},Zp.prototype.commit=function(){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.Rf(),this.mf)throw this.mf;return e=this.Tf,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=ii.B(e);r.mutations.push(new Ks(n,r.Qe(n)))}),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=Wo((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Xo(e.serializer,t)})},[4,e.va("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.qa,this.mutations)];case 1:return t.sent(),this.Ef=!0,[2]}})})},Zp.prototype.Pf=function(t){var e;if(t instanceof iu)e=t.version;else{if(!(t instanceof ou))throw Or();e=$r.min()}var n=this.Tf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Zr(Qr.ABORTED,"Document version changed between two reads.")}else this.Tf.set(t.key.toString(),e)},Zp.prototype.Qe=function(t){var e=this.Tf.get(t.toString());return!this.If.has(t.toString())&&e?As.updateTime(e):As.We()},Zp.prototype.gf=function(t){var e=this.Tf.get(t.toString());if(this.If.has(t.toString())||!e)return As.exists(!0);if(e.isEqual($r.min()))throw new Zr(Qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return As.updateTime(e)},Zp.prototype.write=function(t){this.Rf(),this.mutations=this.mutations.concat(t)},Zp.prototype.Rf=function(){},Zp),Kp=(Qp.prototype.run=function(){this.yf()},Qp.prototype.yf=function(){var t=this;this.Ti.bs(function(){return g(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new Wp(this.qa),(n=this.pf(e))&&n.then(function(t){r.ei.ai(function(){return e.commit().then(function(){r.ii.resolve(t)}).catch(function(t){r.bf(t)})})}).catch(function(t){r.bf(t)}),[2]})})})},Qp.prototype.pf=function(t){try{var e=this.updateFunction(t);return!pi(e)&&e.catch&&e.then?e:(this.ii.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ii.reject(t),null}},Qp.prototype.bf=function(t){var e=this;0<this.Vf&&this.vf(t)?(--this.Vf,this.ei.ai(function(){return e.yf(),Promise.resolve()})):this.ii.reject(t)},Qp.prototype.vf=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Di(e)},Qp),Yp=(Xp.prototype.start=function(t,e,n,r){var i=this;this.Df(),this.w_=t;var o=new wa,s=!1;return this.credentials.Bh(function(t){return s?void i.ei.gi(function(){return i.Bu.vc(t)}):(s=!0,kr("FirestoreClient","Initializing. user=",t.uid),i.Cf(e,n,r,t,o).then(i.Sf.resolve,i.Sf.reject))}),this.ei.ai(function(){return i.Sf.promise}),o.promise},Xp.prototype.enableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue(function(){return t.persistence.Uo(!0),t.Bu.enableNetwork()})},Xp.prototype.Cf=function(i,o,s,u,a){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={ei:this.ei,w_:this.w_,clientId:this.clientId,credentials:this.credentials,N_:u,Qu:100,k_:s},[4,i.initialize(e)];case 1:return t.sent(),[4,o.initialize(i,e)];case 2:return t.sent(),this.persistence=i.persistence,this.Uu=i.Uu,this.La=i.La,this.S_=i.S_,this.qa=o.qa,this.Bu=o.Bu,this.fc=o.fc,this.Nf=o.q_,this.persistence.Bo(function(){return g(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),a.resolve(),[3,4];case 3:if(n=t.sent(),a.reject(n),!this.Ff(n))throw n;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),this.Cf(new dl,new vl,{F_:!1},u,a))];case 4:return[2]}})})},Xp.prototype.Ff=function(t){return"FirebaseError"===t.name?t.code===Qr.FAILED_PRECONDITION||t.code===Qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Xp.prototype.Df=function(){if(this.ei.mi)throw new Zr(Qr.FAILED_PRECONDITION,"The client has already been terminated.")},Xp.prototype.disableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue(function(){return t.persistence.Uo(!1),t.Bu.disableNetwork()})},Xp.prototype.terminate=function(){var t=this;this.ei.Pi();var r=new wa;return this.ei.Ii(function(){return g(t,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.S_&&this.S_.stop(),[4,this.Bu.th()];case 1:return t.sent(),[4,this.Uu.th()];case 2:return t.sent(),[4,this.persistence.th()];case 3:return t.sent(),this.credentials.Uh(),r.resolve(),[3,5];case 4:return e=t.sent(),n=Ba(e,"Failed to shutdown persistence"),r.reject(n),[3,5];case 5:return[2]}})})}),r.promise},Xp.prototype.waitForPendingWrites=function(){var t=this;this.Df();var e=new wa;return this.ei.ai(function(){return t.fc._l(e)}),e.promise},Xp.prototype.listen=function(t,e,n){var r=this;this.Df();var i=new Il(n),o=new Pf(t,i,e);return this.ei.ai(function(){return r.Nf.listen(o)}),function(){i.Q_(),r.ei.ai(function(){return r.Nf.lc(o)})}},Xp.prototype.kf=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),function(n,u,a){return g(this,void 0,void 0,function(){var s,e=this;return w(this,function(t){switch(t.label){case 0:return s=new wa,[4,n.enqueue(function(){return g(e,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=a,(n=u).persistence.runTransaction("read document","readonly",function(t){return n.Rh.Hn(t,e)}))];case 1:return(r=t.sent())instanceof iu?s.resolve(r):r instanceof ou?s.resolve(null):s.reject(new Zr(Qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=t.sent(),o=Ba(i,"Failed to get document '"+a+" from cache"),s.reject(o),[3,3];case 3:return[2]}var e,n})})})];case 1:return[2,(t.sent(),s.promise)]}})})}(this.ei,this.La,e))]}})})},Xp.prototype.$f=function(u,a){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),e=this.ei,n=this.Nf,r=u,i=a,o=new wa,s=Jp(e,n,du(r.path),{includeMetadataChanges:!0,$l:!0},{next:function(t){s();var e=t.docs.has(r);!e&&t.fromCache?o.reject(new Zr(Qr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&i&&"server"===i.source?o.reject(new Zr(Qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)]}var e,n,r,i,o,s})})},Xp.prototype.xf=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),function(n,a,h){return g(this,void 0,void 0,function(){var u,e=this;return w(this,function(t){switch(t.label){case 0:return u=new wa,[4,n.enqueue(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Nc(a,h,!0)];case 1:return e=t.sent(),n=new mf(h,e.gh),r=n.Su(e.documents),i=n.Un(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=Ba(o,"Failed to execute query '"+h+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})}(this.ei,this.La,e))]}})})},Xp.prototype.Of=function(u,a){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),e=this.ei,n=this.Nf,r=u,i=a,o=new wa,s=Jp(e,n,r,{includeMetadataChanges:!0,$l:!0},{next:function(t){s(),t.fromCache&&i&&"server"===i.source?o.reject(new Zr(Qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)]}var e,n,r,i,o,s})})},Xp.prototype.write=function(t){var e=this;this.Df();var n=new wa;return this.ei.ai(function(){return e.fc.write(t,n)}),n.promise},Xp.prototype.s=function(){return this.w_.s},Xp.prototype.bl=function(t){var e=this;this.Df();var n=new Il(t);return this.ei.ai(function(){return g(e,void 0,void 0,function(){return w(this,function(t){return[2,this.Nf.bl(n)]})})}),function(){n.Q_(),e.ei.ai(function(){return g(e,void 0,void 0,function(){return w(this,function(t){return[2,this.Nf.vl(n)]})})})}},Object.defineProperty(Xp.prototype,"Mf",{get:function(){return this.ei.mi},enumerable:!1,configurable:!0}),Xp.prototype.transaction=function(t){var e=this;this.Df();var n=new wa;return this.ei.ai(function(){return new Kp(e.ei,e.qa,t,n).run(),Promise.resolve()}),n.promise},Xp);function Xp(t,e){this.credentials=t,this.ei=e,this.clientId=Cr.t(),this.Sf=new wa}function Qp(t,e,n,r){this.ei=t,this.qa=e,this.updateFunction=n,this.ii=r,this.Vf=5,this.Ti=new Ea(this.ei,"transaction_retry")}function Zp(t){this.qa=t,this.Tf=new Map,this.mutations=[],this.Ef=!1,this.mf=null,this.If=new Set}function Jp(t,e,n,r,i){var o=new Il(i),s=new Pf(n,o,r);return t.ai(function(){return e.listen(s)}),function(){o.Q_(),t.ai(function(){return e.lc(s)})}}var $p,td,ed=(wd.prototype.Bf=function(t){switch(vo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return To(t.integerValue||t.doubleValue);case 3:return this.Uf(t.timestampValue);case 4:return this.Qf(t);case 5:return t.stringValue;case 6:return new Kl(No(t.bytesValue));case 7:return this.Wf(t.referenceValue);case 8:return this.jf(t.geoPointValue);case 9:return this.Kf(t.arrayValue);case 10:return this.Gf(t.mapValue);default:throw Or()}},wd.prototype.Gf=function(t){var n=this,r={};return zr(t.fields||{},function(t,e){r[t]=n.Bf(e)}),r},wd.prototype.jf=function(t){return new yp(To(t.latitude),To(t.longitude))},wd.prototype.Kf=function(t){var e=this;return(t.values||[]).map(function(t){return e.Bf(t)})},wd.prototype.Qf=function(t){switch(this.Lf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return lo(n)?t(n):n}(t);return null==e?null:this.Bf(e);case"estimate":return this.Uf(po(t));default:return null}},wd.prototype.Uf=function(t){var e=Io(t),n=new Jr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},wd.prototype.Wf=function(t){var e=ei.k(t);Pr(rs(e));var n=new jr(e.get(1),e.get(3)),r=new ii(e.V(5));return n.isEqual(this.s)||Rr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.qf(r)},wd),nd=Ka.ji,rd=(md.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},md),id=(Object.defineProperty(gd.prototype,"rd",{get:function(){return this.od||(this.od=new Lp(this.sf,this.sd.ignoreUndefinedProperties)),this.od},enumerable:!1,configurable:!0}),gd.prototype.settings=function(t){_l("Firestore.settings",arguments,1),Dl("Firestore.settings","object",1,t);var e=new rd(t);if(this.Zf&&!this.sd.isEqual(e))throw new Zr(Qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.sd=e).credentials&&(this.nd=function(t){if(!t)return new Vc;switch(t.type){case"gapi":var e=t.hd;return Pr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new qc(e,t.zh||"0");case"provider":return t.hd;default:throw new Zr(Qr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},gd.prototype.enableNetwork=function(){return this.Xf(),this.Zf.enableNetwork()},gd.prototype.disableNetwork=function(){return this.Xf(),this.Zf.disableNetwork()},gd.prototype.enablePersistence=function(t){var e,n;if(this.Zf)throw new Zr(Qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Rr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Zr(Qr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.ad(this.zf,this.Hf,{F_:!0,cacheSizeBytes:this.sd.cacheSizeBytes,synchronizeTabs:r,Vo:i})},gd.prototype.clearPersistence=function(){return g(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.Zf&&!this.Zf.Mf)throw new Zr(Qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new wa,[2,(this.Jf.Ii(function(){return g(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.zf.clearPersistence(this.sf,this.ed)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},gd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(gd.prototype,"ud",{get:function(){return this.Xf(),this.Zf.Mf},enumerable:!1,configurable:!0}),gd.prototype.waitForPendingWrites=function(){return this.Xf(),this.Zf.waitForPendingWrites()},gd.prototype.onSnapshotsInSync=function(t){if(this.Xf(),El(t))return this.Zf.bl(t);Dl("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Zf.bl(e)},gd.prototype.Xf=function(){return this.Zf||this.ad(new dl,new vl,{F_:!1}),this.Zf},gd.prototype.ld=function(){return new qr(this.sf,this.ed,this.sd.host,this.sd.ssl,this.sd.forceLongPolling)},gd.prototype.ad=function(t,e,n){var r=this.ld();return this.Zf=new Yp(this.nd,this.Jf),this.Zf.start(r,t,e,n)},gd.td=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Zr(Qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Zr(Qr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new jr(n)},Object.defineProperty(gd.prototype,"app",{get:function(){if(!this.Yf)throw new Zr(Qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Yf},enumerable:!1,configurable:!0}),gd.prototype.collection=function(t){return _l("Firestore.collection",arguments,1),Dl("Firestore.collection","non-empty string",1,t),this.Xf(),new Sd(ei.k(t),this,null)},gd.prototype.doc=function(t){return _l("Firestore.doc",arguments,1),Dl("Firestore.doc","non-empty string",1,t),this.Xf(),ud._d(ei.k(t),this,null)},gd.prototype.collectionGroup=function(t){if(_l("Firestore.collectionGroup",arguments,1),Dl("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Xf(),new _d((e=t,new fu(ei.$(),e)),this,null);var e},gd.prototype.runTransaction=function(e){var n=this;return _l("Firestore.runTransaction",arguments,1),Dl("Firestore.runTransaction","function",1,e),this.Xf().transaction(function(t){return e(new od(n,t))})},gd.prototype.batch=function(){return this.Xf(),new sd(this)},Object.defineProperty(gd,"logLevel",{get:function(){switch(Dr()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),gd.setLogLevel=function(t){_l("Firestore.setLogLevel",arguments,1),Ol("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Sr.setLogLevel(t)},gd.prototype.fd=function(){return this.sd.timestampsInSnapshots},gd),od=(vd.prototype.get=function(t){var n=this;_l("Transaction.get",arguments,1);var r=Pd("Transaction.get",t,this.dd);return this.wd.Af([r.if]).then(function(t){if(!t||1!==t.length)return Or();var e=t[0];if(e instanceof ou)return new hd(n.dd,r.if,null,!1,!1,r.rf);if(e instanceof iu)return new hd(n.dd,r.if,e,!1,!1,r.rf);throw Or()})},vd.prototype.set=function(t,e,n){Sl("Transaction.set",arguments,2,3);var r=Pd("Transaction.set",t,this.dd);n=Ld("Transaction.set",n);var i=Cd(r.rf,e,n),o=Pp(this.dd.rd,"Transaction.set",r.if,i,null!==r.rf,n);return this.wd.set(r.if,o),this},vd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Xl?(Al("Transaction.update",arguments,3),r=Pd("Transaction.update",t,this.dd),Up(this.dd.rd,"Transaction.update",r.if,e,n,o)):(_l("Transaction.update",arguments,2),r=Pd("Transaction.update",t,this.dd),Cp(this.dd.rd,"Transaction.update",r.if,e)),this.wd.update(r.if,i),this},vd.prototype.delete=function(t){_l("Transaction.delete",arguments,1);var e=Pd("Transaction.delete",t,this.dd);return this.wd.delete(e.if),this},vd),sd=(yd.prototype.set=function(t,e,n){Sl("WriteBatch.set",arguments,2,3),this.md();var r=Pd("WriteBatch.set",t,this.dd);n=Ld("WriteBatch.set",n);var i=Cd(r.rf,e,n),o=Pp(this.dd.rd,"WriteBatch.set",r.if,i,null!==r.rf,n);return this.Td=this.Td.concat(o.hf(r.if,As.We())),this},yd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.md(),i="string"==typeof e||e instanceof Xl?(Al("WriteBatch.update",arguments,3),r=Pd("WriteBatch.update",t,this.dd),Up(this.dd.rd,"WriteBatch.update",r.if,e,n,o)):(_l("WriteBatch.update",arguments,2),r=Pd("WriteBatch.update",t,this.dd),Cp(this.dd.rd,"WriteBatch.update",r.if,e)),this.Td=this.Td.concat(i.hf(r.if,As.exists(!0))),this},yd.prototype.delete=function(t){_l("WriteBatch.delete",arguments,1),this.md();var e=Pd("WriteBatch.delete",t,this.dd);return this.Td=this.Td.concat(new Ws(e.if,As.We())),this},yd.prototype.commit=function(){return this.md(),this.Ed=!0,0<this.Td.length?this.dd.Xf().write(this.Td):Promise.resolve()},yd.prototype.md=function(){if(this.Ed)throw new Zr(Qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},yd),ud=(n(dd,td=gp),dd._d=function(t,e,n){if(t.length%2!=0)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.F()+" has "+t.length);return new dd(new ii(t),e,n)},Object.defineProperty(dd.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"parent",{get:function(){return new Sd(this.if.path.p(),this.firestore,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"path",{get:function(){return this.if.path.F()},enumerable:!1,configurable:!0}),dd.prototype.collection=function(t){if(_l("DocumentReference.collection",arguments,1),Dl("DocumentReference.collection","non-empty string",1,t),!t)throw new Zr(Qr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ei.k(t);return new Sd(this.if.path.child(e),this.firestore,null)},dd.prototype.isEqual=function(t){if(!(t instanceof dd))throw Fl("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.if.isEqual(t.if)&&this.rf===t.rf},dd.prototype.set=function(t,e){Sl("DocumentReference.set",arguments,1,2),e=Ld("DocumentReference.set",e);var n=Cd(this.rf,t,e),r=Pp(this.firestore.rd,"DocumentReference.set",this.if,n,null!==this.rf,e);return this.Zf.write(r.hf(this.if,As.We()))},dd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Xl?(Al("DocumentReference.update",arguments,2),Up(this.firestore.rd,"DocumentReference.update",this.if,t,e,r)):(_l("DocumentReference.update",arguments,1),Cp(this.firestore.rd,"DocumentReference.update",this.if,t)),this.Zf.write(n.hf(this.if,As.exists(!0)))},dd.prototype.delete=function(){return _l("DocumentReference.delete",arguments,0),this.Zf.write([new Ws(this.if,As.We())])},dd.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Sl("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||El(i[u])||(Ml("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),Ll("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,h={includeMetadataChanges:s.includeMetadataChanges};El(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(Dl("DocumentReference.onSnapshot","function",u,i[u]),kl("DocumentReference.onSnapshot","function",u+1,i[u+1]),kl("DocumentReference.onSnapshot","function",u+2,i[u+2]));var c={next:function(t){i[u]&&i[u](r.Id(t))},error:i[u+1],complete:i[u+2]};return this.Zf.listen(du(this.if.path),h,c)},dd.prototype.get=function(t){var e=this;Sl("DocumentReference.get",arguments,0,1),Od("DocumentReference.get",t);var n=this.firestore.Xf();return t&&"cache"===t.source?n.kf(this.if).then(function(t){return new hd(e.firestore,e.if,t,!0,t instanceof iu&&t.Ge,e.rf)}):n.$f(this.if,t).then(function(t){return e.Id(t)})},dd.prototype.withConverter=function(t){return new dd(this.if,this.firestore,t)},dd.prototype.Id=function(t){var e=t.docs.get(this.if);return new hd(this.firestore,this.if,e,t.fromCache,t.hasPendingWrites,this.rf)},dd),ad=(pd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},pd),hd=(ld.prototype.data=function(t){var e=this;if(Sl("DocumentSnapshot.data",arguments,0,1),t=xd("DocumentSnapshot.data",t),this.Ad){if(this.rf){var n=new cd(this.dd,this.if,this.Ad,this.Rd,this.Pd,null);return this.rf.fromFirestore(n,t)}return new ed(this.dd.sf,this.dd.fd(),t.serverTimestamps||"none",function(t){return new ud(t,e.dd,null)}).Bf(this.Ad.tn())}},ld.prototype.get=function(t,e){var n=this;if(Sl("DocumentSnapshot.get",arguments,1,2),e=xd("DocumentSnapshot.get",e),this.Ad){var r=this.Ad.data().field(Gp("DocumentSnapshot.get",t,this.if));if(null!==r)return new ed(this.dd.sf,this.dd.fd(),e.serverTimestamps||"none",function(t){return new ud(t,n.dd,n.rf)}).Bf(r)}},Object.defineProperty(ld.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"ref",{get:function(){return new ud(this.if,this.dd,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"exists",{get:function(){return null!==this.Ad},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"metadata",{get:function(){return new ad(this.Pd,this.Rd)},enumerable:!1,configurable:!0}),ld.prototype.isEqual=function(t){if(!(t instanceof ld))throw Fl("isEqual","DocumentSnapshot",1,t);return this.dd===t.dd&&this.Rd===t.Rd&&this.if.isEqual(t.if)&&(null===this.Ad?null===t.Ad:this.Ad.isEqual(t.Ad))&&this.rf===t.rf},ld),cd=(n(fd,$p=hd),fd.prototype.data=function(t){return $p.prototype.data.call(this,t)},fd);function fd(){return null!==$p&&$p.apply(this,arguments)||this}function ld(t,e,n,r,i,o){this.dd=t,this.if=e,this.Ad=n,this.Rd=r,this.Pd=i,this.rf=o}function pd(t,e){this.hasPendingWrites=t,this.fromCache=e}function dd(t,e,n){var r=this;return(r=td.call(this,e.sf,t,n)||this).if=t,r.firestore=e,r.rf=n,r.Zf=r.firestore.Xf(),r}function yd(t){this.dd=t,this.Td=[],this.Ed=!1}function vd(t,e){this.dd=t,this.wd=e}function gd(t,e,n,r){var i=this;if(void 0===n&&(n=new dl),void 0===r&&(r=new vl),this.zf=n,this.Hf=r,this.Yf=null,this.Jf=new qa,this.INTERNAL={delete:function(){return g(i,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Xf(),[4,this.Zf.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var o=t;this.Yf=o,this.sf=gd.td(o),this.ed=o.name,this.nd=new Mc(e)}else{var s=t;if(!s.projectId)throw new Zr(Qr.INVALID_ARGUMENT,"Must provide projectId");this.sf=new jr(s.projectId,s.database),this.ed="[DEFAULT]",this.nd=new Vc}this.sd=new rd({})}function md(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Zr(Qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Rl("settings","non-empty string","host",t.host),this.host=t.host,Ll("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ml("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Ll("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ll("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Ll("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Rr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Rr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Ll("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ka.Gi;else{if(t.cacheSizeBytes!==nd&&t.cacheSizeBytes<Ka.Ki)throw new Zr(Qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ka.Ki);this.cacheSizeBytes=t.cacheSizeBytes}Ll("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function wd(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Lf=n,this.qf=r}function bd(t,e,n){if("string"==typeof n){if(""===n)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!yu(e)&&-1!==n.indexOf("/"))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ei.k(n));if(!ii.j(r))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return _o(t,new ii(r))}if(n instanceof gp)return _o(t,n.if);throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ul(n)+".")}function Ed(t,e){if(!Array.isArray(t)||0===t.length)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function Id(t,e,n){if(!n.isEqual(e))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Td(t){if(t.cn()&&0===t.en.length)throw new Zr(Qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Nd,_d=(Rd.prototype.where=function(t,e,n){var r;_l("Query.where",arguments,3),Vl("Query.where",3,n),r="not-in"===e||"!="===e?e:Ol("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i,o,s=Gp("Query.where",t),u=function(t,e,n,r,i,o){var s;if(r.M()){if("array-contains"===i||"array-contains-any"===i)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Ed(o,i);for(var u=[],a=0,h=o;a<h.length;a++){var c=h[a];u.push(bd(n,t,c))}s={arrayValue:{values:u}}}else s=bd(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Ed(o,i),s=Vp(e,"Query.where",o,"in"===i||"not-in"===i);var f=Su.create(r,i,s);return function(t,e){if(e._n()){var n=t.ln();if(null!==n&&!n.isEqual(e.field))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=t.un();null!==r&&Id(0,e.field,r)}var i=t.fn(function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new Zr(Qr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Zr(Qr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(this.gd,this.firestore.rd,this.firestore.sf,s,r,n);return new Rd((o=(i=this.gd).filters.concat([u]),new fu(i.path,i.collectionGroup,i.en.slice(),o,i.limit,i.nn,i.startAt,i.endAt)),this.firestore,this.rf)},Rd.prototype.orderBy=function(t,e){var n;if(Sl("Query.orderBy",arguments,1,2),kl("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Zr(Qr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=Gp("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o=new ea(e,n),s=o;return null!==(r=t).un()||null!==(i=r.ln())&&Id(0,i,s.field),o}(this.gd,o,n);return new Rd((i=(r=this.gd).en.concat([s]),new fu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.nn,r.startAt,r.endAt)),this.firestore,this.rf)},Rd.prototype.limit=function(t){return _l("Query.limit",arguments,1),Dl("Query.limit","number",1,t),ql("Query.limit",1,t),new Rd(mu(this.gd,t,"F"),this.firestore,this.rf)},Rd.prototype.limitToLast=function(t){return _l("Query.limitToLast",arguments,1),Dl("Query.limitToLast","number",1,t),ql("Query.limitToLast",1,t),new Rd(mu(this.gd,t,"L"),this.firestore,this.rf)},Rd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Al("Query.startAt",arguments,1);var r=this.Vd("Query.startAt",t,e,!0);return new Rd(wu(this.gd,r),this.firestore,this.rf)},Rd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Al("Query.startAfter",arguments,1);var r=this.Vd("Query.startAfter",t,e,!1);return new Rd(wu(this.gd,r),this.firestore,this.rf)},Rd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Al("Query.endBefore",arguments,1);var r=this.Vd("Query.endBefore",t,e,!0);return new Rd(bu(this.gd,r),this.firestore,this.rf)},Rd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Al("Query.endAt",arguments,1);var r=this.Vd("Query.endAt",t,e,!1);return new Rd(bu(this.gd,r),this.firestore,this.rf)},Rd.prototype.isEqual=function(t){if(!(t instanceof Rd))throw Fl("isEqual","Query",1,t);return this.firestore===t.firestore&&Eu(this.gd,t.gd)&&this.rf===t.rf},Rd.prototype.withConverter=function(t){return new Rd(this.gd,this.firestore,t)},Rd.prototype.Vd=function(c,t,e,n){if(Vl(c,1,t),t instanceof hd)return _l(c,i([t],e),1),function(t,e,n,r){if(!n)throw new Zr(Qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=vu(t);o<s.length;o++){var u=s[o];if(u.field.M())i.push(_o(e,n.key));else{var a=n.field(u.field);if(lo(a))throw new Zr(Qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var h=u.field.F();throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}i.push(a)}}return new Ku(i,r)}(this.gd,this.firestore.sf,t.Ad,n);var r=[t].concat(e);return function(t,e,n,r,i,o){var s=t.en;if(i.length>s.length)throw new Zr(Qr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var h=i[a];if(s[a].field.M()){if("string"!=typeof h)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof h);if(!yu(t)&&-1!==h.indexOf("/"))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+h+"' contains a slash.");var c=t.path.child(ei.k(h));if(!ii.j(c))throw new Zr(Qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+c+"' is not because it contains an odd number of segments.");var f=new ii(c);u.push(_o(e,f))}else{var l=Vp(n,r,h);u.push(l)}}return new Ku(u,o)}(this.gd,this.firestore.sf,this.firestore.rd,c,r,n)},Rd.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Sl("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||El(i[a])||(Ml("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),Ll("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),El(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(Dl("Query.onSnapshot","function",a,i[a]),kl("Query.onSnapshot","function",a+1,i[a+1]),kl("Query.onSnapshot","function",a+2,i[a+2]));var h={next:function(t){i[a]&&i[a](new Ad(r.firestore,r.gd,t,r.rf))},error:i[a+1],complete:i[a+2]};return Td(this.gd),this.firestore.Xf().listen(this.gd,u,h)},Rd.prototype.get=function(t){var e=this;Sl("Query.get",arguments,0,1),Od("Query.get",t),Td(this.gd);var n=this.firestore.Xf();return(t&&"cache"===t.source?n.xf(this.gd):n.Of(this.gd,t)).then(function(t){return new Ad(e.firestore,e.gd,t,e.rf)})},Rd),Ad=(Object.defineProperty(kd.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"empty",{get:function(){return this.pd.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"size",{get:function(){return this.pd.docs.size},enumerable:!1,configurable:!0}),kd.prototype.forEach=function(e,n){var r=this;Sl("QuerySnapshot.forEach",arguments,1,2),Dl("QuerySnapshot.forEach","function",1,e),this.pd.docs.forEach(function(t){e.call(n,r.Sd(t,r.metadata.fromCache,r.pd.qt.has(t.key)))})},Object.defineProperty(kd.prototype,"query",{get:function(){return new _d(this.yd,this.dd,this.rf)},enumerable:!1,configurable:!0}),kd.prototype.docChanges=function(t){t&&(Ml("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ll("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.pd.Ut)throw new Zr(Qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.bd&&this.vd===e||(this.bd=function(i,e,o){if(i.Lt._()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Lt;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Or()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.pd,e,this.Sd.bind(this)),this.vd=e),this.bd},kd.prototype.isEqual=function(t){if(!(t instanceof kd))throw Fl("isEqual","QuerySnapshot",1,t);return this.dd===t.dd&&Eu(this.yd,t.yd)&&this.pd.isEqual(t.pd)&&this.rf===t.rf},kd.prototype.Sd=function(t,e,n){return new cd(this.dd,t.key,t,e,n,this.rf)},kd),Sd=(n(Dd,Nd=_d),Object.defineProperty(Dd.prototype,"id",{get:function(){return this.gd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"parent",{get:function(){var t=this.gd.path.p();return t._()?null:new ud(new ii(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"path",{get:function(){return this.gd.path.F()},enumerable:!1,configurable:!0}),Dd.prototype.doc=function(t){Sl("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Cr.t()),Dl("CollectionReference.doc","non-empty string",1,t);var e=ei.k(t);return ud._d(this.gd.path.child(e),this.firestore,this.rf)},Dd.prototype.add=function(t){_l("CollectionReference.add",arguments,1),Dl("CollectionReference.add","object",1,this.rf?this.rf.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Dd.prototype.withConverter=function(t){return new Dd(this.Dd,this.firestore,t)},Dd);function Dd(t,e,n){var r=this;if(((r=Nd.call(this,du(t),e,n)||this).Dd=t).length%2!=1)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.F()+" has "+t.length);return r}function kd(t,e,n,r){this.dd=t,this.yd=e,this.pd=n,this.rf=r,this.bd=null,this.vd=null,this.metadata=new ad(n.hasPendingWrites,n.fromCache)}function Rd(t,e,n){this.gd=t,this.firestore=e,this.rf=n}function Ld(t,e){if(void 0===e)return{merge:!1};if(Ml(t,e,["merge","mergeFields"]),Ll(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ul(n));for(var r,i=0;i<n.length;++i)if(!("string"==typeof(r=n[i])||r instanceof Xl))throw new Zr(Qr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Ul(n[i]))}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new Zr(Qr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function xd(t,e){return void 0===e?{}:(Ml(t,e,["serverTimestamps"]),xl(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Od(t,e){kl(t,"object",1,e),e&&(Ml(t,e,["source"]),xl(t,0,"source",e.source,["default","server","cache"]))}function Pd(t,e,n){if(e instanceof gp){if(e.firestore!==n)throw new Zr(Qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Fl(t,"DocumentReference",1,e)}function Cd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ud,Vd={Firestore:id,GeoPoint:yp,Timestamp:Jr,Blob:Kl,Transaction:od,WriteBatch:sd,DocumentReference:ud,DocumentSnapshot:hd,Query:_d,QueryDocumentSnapshot:cd,QuerySnapshot:Ad,CollectionReference:Sd,FieldPath:Xl,FieldValue:pp,setLogLevel:id.setLogLevel,CACHE_SIZE_UNLIMITED:nd};(Ud=Md).INTERNAL.registerComponent(new Nr("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new vl,i=new yl(r),new id(e,n,i,r);var e,n,r,i},"PUBLIC").setServiceProps(Object.assign({},Vd))),Ud.registerVersion("@firebase/firestore","1.16.5-202071902151")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});