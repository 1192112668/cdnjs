!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s){var r=t.call(this,s)||this;return r.code=n,r.name=i,Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,o.prototype.create),r}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").",c=new r(i,h),l=0,f=Object.keys(s);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=s[d])}return c},t}();var a,h,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}(h=t.LogLevel||(t.LogLevel={}))[h.DEBUG=0]="DEBUG",h[h.VERBOSE=1]="VERBOSE",h[h.INFO=2]="INFO",h[h.WARN=3]="WARN",h[h.ERROR=4]="ERROR",h[h.SILENT=5]="SILENT";var f={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},d=t.LogLevel.INFO,p=((a={})[t.LogLevel.DEBUG]="log",a[t.LogLevel.VERBOSE]="log",a[t.LogLevel.INFO]="info",a[t.LogLevel.WARN]="warn",a[t.LogLevel.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function e(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in t.LogLevel))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.DEBUG],e)),this._logHandler.apply(this,l([this,t.LogLevel.DEBUG],e))},e.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.VERBOSE],e)),this._logHandler.apply(this,l([this,t.LogLevel.VERBOSE],e))},e.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.INFO],e)),this._logHandler.apply(this,l([this,t.LogLevel.INFO],e))},e.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.WARN],e)),this._logHandler.apply(this,l([this,t.LogLevel.WARN],e))},e.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,l([this,t.LogLevel.ERROR],e)),this._logHandler.apply(this,l([this,t.LogLevel.ERROR],e))},e}(),w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function y(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=I||{},E=b||self;function _(){}function T(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function N(t){var e=T(t);return"array"==e||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),S=0;function D(t,e,n){return t.call.apply(t.bind,arguments)}function L(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function k(t,e,n){return(k=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?D:L).apply(null,arguments)}function R(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var C=Date.now;function O(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function V(){this.j=this.j,this.i=this.i}V.prototype.j=!1,V.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,x)&&t[x]||(t[x]=++S)})(this)},V.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function U(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function F(t){return/^[\s\xa0]*$/.test(t)}var j,G=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $(t,e){return-1!=t.indexOf(e)}function B(t,e){return t<e?-1:t>e?1:0}t:{var z=E.navigator;if(z){var K=z.userAgent;if(K){j=K;break t}}j=""}function H(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function X(t){var e={};for(var n in t)e[n]=t[n];return e}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<W.length;r++)n=W[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Q(t){return Q[" "](t),t}Q[" "]=_;var J,Z,tt=$(j,"Opera"),et=$(j,"Trident")||$(j,"MSIE"),nt=$(j,"Edge"),st=nt||et,it=$(j,"Gecko")&&!($(j.toLowerCase(),"webkit")&&!$(j,"Edge"))&&!($(j,"Trident")||$(j,"MSIE"))&&!$(j,"Edge"),rt=$(j.toLowerCase(),"webkit")&&!$(j,"Edge");function ot(){var t=E.document;return t?t.documentMode:void 0}t:{var at="",ht=(Z=j,it?/rv:([^\);]+)(\)|;)/.exec(Z):nt?/Edge\/([\d\.]+)/.exec(Z):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):rt?/WebKit\/(\S+)/.exec(Z):tt?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(ht&&(at=ht?ht[1]:""),et){var ut=ot();if(null!=ut&&ut>parseFloat(at)){J=String(ut);break t}}J=at}var ct,lt={};function ft(t){return function(t,e){var n=lt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=G(String(J)).split("."),s=G(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=B(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||B(0==o[2].length,0==a[2].length)||B(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(E.document&&et){var dt=ot();ct=dt||(parseInt(J,10)||void 0)}else ct=void 0;var pt=ct,gt=!et||9<=Number(pt),mt=et&&!ft("9"),wt=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{E.addEventListener("test",_,e),E.removeEventListener("test",_,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(it){t:{try{Q(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},O(vt,yt);var bt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var It="closure_listenable_"+(1e6*Math.random()|0),Et=0;function _t(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=P(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}Tt.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=At(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++Et,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var xt="closure_lm_"+(1e6*Math.random()|0),St={};function Dt(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Mt(s);return e&&e[It]?e.wa(n,s,A(i)?!!i.capture:!!i,r):Lt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)Dt(t,e[r],n,s,i);return null}return n=Mt(n),t&&t[It]?t.va(e,n,A(s)?!!s.capture:!!s,i):Lt(t,e,n,!1,s,i)}function Lt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i;if(o&&!gt)return null;var a=Vt(t);if(a||(t[xt]=a=new Tt(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Ot,e=gt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)wt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function kt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[It])Nt(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Rt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Vt(e))?(Nt(n,t),0==n.b&&(n.src=null,e[xt]=null)):_t(t)}}}function Rt(t){return t in St?St[t]:St[t]="on"+t}function Ct(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&kt(t),n.call(s,e)}function Ot(t,e){if(t.Y)return!0;if(!gt){if(!e)t:{e=["window","event"];for(var n=E,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Ct(t,e=new vt(e,this))}return Ct(t,new vt(e,this))}function Vt(t){return(t=t[xt])instanceof Tt?t:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mt(t){return"function"==T(t)?t:(t[Pt]||(t[Pt]=function(e){return t.handleEvent(e)}),t[Pt])}function Ut(){V.call(this),this.c=new Tt(this),this.J=this,this.C=null}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,h=o.ca||o.src;o.Z&&Nt(t.c,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}O(Ut,V),Ut.prototype[It]=!0,(v=Ut.prototype).addEventListener=function(t,e,n,s){Dt(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=A(i)?!!i.capture:!!i,s=Mt(s),e&&e[It]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=At(o=e.a[n],s,i,r))&&(_t(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Vt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,s,i,r)),(s=-1<e?n[e]:null)&&kt(s))}(this,t,e,n,s)},v.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var s=t.type||t;if("string"==typeof t)t=new yt(t,n);else if(t instanceof yt)t.target=t.target||n;else{var i=t;Y(t=new yt(s,n),i)}if(i=!0,e)for(var r=e.length-1;0<=r;r--){var o=t.a=e[r];i=qt(o,s,!0,t)&&i}if(i=qt(o=t.a=n,s,!0,t)&&i,i=qt(o,s,!1,t)&&i,e)for(r=0;r<e.length;r++)i=qt(o=t.a=e[r],s,!1,t)&&i;return i},v.G=function(){if(Ut.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)_t(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Ft=E.JSON.stringify;function jt(){this.b=this.a=null}var Gt,$t=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()},100);function Bt(){var t=Wt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Kt(t){E.setTimeout(function(){throw t},0)}function Ht(t,e){Gt||function(){var t=E.Promise.resolve(void 0);Gt=function(){t.then(Yt)}}(),Xt||(Gt(),Xt=!0),Wt.add(t,e)}jt.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Xt=!1,Wt=new jt;function Yt(){for(var t;t=Bt();){try{t.a.call(t.b)}catch(t){Kt(t)}var e=$t;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Xt=!1}function Qt(t,e){Ut.call(this),this.b=t||1,this.a=e||E,this.f=k(this.Ya,this),this.g=C()}function Jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==T(t))n&&(t=k(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=k(t.handleEvent,t)}return 2147483647<Number(e)?-1:E.setTimeout(t,e||0)}O(Qt,Ut),(v=Qt.prototype).aa=!1,v.M=null,v.Ya=function(){if(this.aa){var t=C()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Jt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=C())},v.G=function(){Qt.S.G.call(this),Jt(this),delete this.a};var te=function(t){function e(e,n,s){var i=t.call(this)||this;return i.g=null!=s?e.bind(s):e,i.h=n,i.b=null,i.c=!1,i.a=null,i}return function(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(E.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(V);function ee(t){V.call(this),this.b=t,this.a={}}O(ee,V);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=Dt(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){H(t.a,function(t,e){this.a.hasOwnProperty(e)&&kt(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.S.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae=null;function he(){return ae=ae||new Ut}function ue(t){yt.call(this,"serverreachability",t)}function ce(t){var e=he();e.dispatchEvent(new ue(e,t))}function le(t){yt.call(this,"statevent",t)}function fe(t){var e=he();e.dispatchEvent(new le(e,t))}function de(t){yt.call(this,"timingevent",t)}function pe(t,e){if("function"!=T(t))throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){t()},e)}O(ue,yt),O(le,yt),O(de,yt);var ge={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},me={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function we(){}function ye(t){var e;return(e=t.a)||(e=t.a={}),e}function ve(){}we.prototype.a=null;var be,Ie={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ee(){yt.call(this,"d")}function _e(){yt.call(this,"c")}function Te(){}function Ne(t,e,n,s){this.g=t,this.c=e,this.f=n,this.T=s||1,this.J=new ee(this),this.P=Ae,t=st?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}O(Ee,yt),O(_e,yt),O(Te,we),be=new Te;var Ae=45e3,xe={},Se={};function De(t,e,n){t.H=1,t.i=Qe(ze(e)),t.j=n,t.I=!0,Le(t,null)}function Le(t,e){t.u=C(),Ce(t),t.l=ze(t.i);var n=t.l,s=t.T;Array.isArray(s)||(s=[String(s)]),ln(n.b,"t",s),t.D=0,t.a=ss(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(k(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Wa),e=t.B?X(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ce(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var u=a[h].split("=");if(1<u.length){var c=u[0];u=u[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+u+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.T,t.j)}function ke(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Re(t,n);if(i==Se){4==e&&(t.h=4,fe(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,fe(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),Ue(t,i)}4==e&&0==n.length&&(t.h=1,fe(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Wn(e),e.F=!0)):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Pe(t))}function Re(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?Se:(n=Number(e.substring(n,s)),isNaN(n)?xe:(s+=1)+n>e.length?Se:(e=e.substr(s,n),t.D=s+n,e))}function Ce(t){t.U=C()+t.P,Oe(t,t.P)}function Oe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pe(k(t.Ua,t),e)}function Ve(t){t.o&&(E.clearTimeout(t.o),t.o=null)}function Pe(t){0==t.g.v||t.A||Jn(t.g,t)}function Me(t){Ve(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Jt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ue(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||wn(n.b,t)))if(n.I=t.N,!t.C&&wn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Qn(n),Fn(n)}Xn(n),fe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=pe(k(n.Ra,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ts(n,11)}else if((t.C||n.a==t)&&Qn(n),!F(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var h=1.5*a;n.D=h,n.c.info("backChannelRequestTimeoutMs_="+h)}h=n;var u=t.a;if(u){var c=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=h.b;!l.a&&($(c,"spdy")||$(c,"quic")||$(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(yn(l,l.b),l.b=null))}if(h.A){var f=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,Ye(h.B,h.A,f))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=C()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((h=n).la=ns(h,h.C?h.ga:null,h.fa),d.C){vn(h.b,d);var p=d,g=h.D;g&&p.setTimeout(g),p.o&&(Ve(p),Ce(p)),h.a=d}else Hn(h);0<n.g.length&&$n(n)}else"stop"!=i[0]&&"close"!=i[0]||ts(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ts(n,7):qn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ce(4)}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)M(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof Fe)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];Ge(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ge(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function Ge(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Wa=function(t){t=t.target;var e=this.F;e&&3==Vn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ua(),s=this.a.X();if(!(3>e||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ce(8==n||0>=s?3:2),Ve(this);var i=this.a.X();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.T,e,i),this.b){if(this.V&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,fe(12),Me(this),Pe(this);break t}oe(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ue(this,h)}this.I?(ke(this,e,r),st&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Va),this.R.start())):(oe(this.c,this.f,r,null),Ue(this,r)),4==e&&Me(this),this.b&&!this.A&&(4==e?Jn(this.g,this):(this.b=!1,Ce(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,fe(12)):(this.h=0,fe(13)),Me(this),Pe(this)}}}catch(t){}},v.Va=function(){if(this.a){var t=Vn(this.a),e=this.a.$();this.D<e.length&&(Ve(this),ke(this,t,e),this.b&&4!=t&&Ce(this))}},v.cancel=function(){this.A=!0,Me(this)},v.Ua=function(){this.o=null;var t=C();0<=t-this.U?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(ce(3),fe(17)),Me(this),this.h=2,Pe(this)):Oe(this,this.U-t)},(v=Fe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return Ge(this.b,t)?this.b[t]:e},v.set=function(t,e){Ge(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var $e=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Be){this.a=void 0!==e?e:t.a,Ke(this,t.f),this.j=t.j,He(this,t.c),Xe(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),We(this,n),this.i=t.i}else t&&(n=String(t).match($e))?(this.a=!!e,Ke(this,n[1]||"",!0),this.j=Je(n[2]||""),He(this,n[3]||"",!0),Xe(this,n[4]),this.g=Je(n[5]||"",!0),We(this,n[6]||"",!0),this.i=Je(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function ze(t){return new Be(t)}function Ke(t,e,n){t.f=n?Je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function He(t,e,n){t.c=n?Je(e,!0):e}function Xe(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function We(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(hn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(un(this,e),ln(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ze(e,rn)),t.b=new an(e,t.a))}function Ye(t,e,n){t.b.set(e,n)}function Qe(t){return Ye(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^C()).toString(36)),t}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?sn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,on)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,sn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function hn(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function un(t,e){hn(t),e=fn(t,e),Ge(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ge((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function cn(t,e){return hn(t),e=fn(t,e),Ge(t.a.b,e)}function ln(t,e,n){un(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),q(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dn(t){this.g=t||pn,E.PerformanceNavigationTiming?t=0<(t=E.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(E.ia&&E.ia.ya&&E.ia.ya()&&E.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(v=an.prototype).add=function(t,e){hn(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){hn(this),this.a.forEach(function(n,s){M(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){hn(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){hn(this);var e=[];if("string"==typeof t)cn(this,t)&&(e=U(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},v.set=function(t,e){return hn(this),this.c=null,cn(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function wn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function yn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=y(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return q(t.c)}function In(){}function En(t,e,n){var s=n||"";try{qe(t,function(t,n){var i=t;A(t)&&(i=Ft(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function _n(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=y(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},In.prototype.stringify=function(t){return E.JSON.stringify(t,void 0)},In.prototype.parse=function(t){return E.JSON.parse(t,void 0)};var Tn=E.JSON.parse;function Nn(t){Ut.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=An,this.D=this.F=!1}O(Nn,Ut);var An="",xn=/^https?$/i,Sn=["POST","PUT"];function Dn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,kn(t),Cn(t)}function kn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rn(t){if(t.b&&void 0!==I&&(!t.s[1]||4!=Vn(t)||2!=t.X()))if(t.l&&4==Vn(t))Zt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Vn(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match($e)[1]||null;if(!r&&E.self&&E.self.location){var o=E.self.location.protocol;r=o.substr(0,o.length-1)}i=!xn.test(r?r.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Vn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.X()+"]",kn(t)}}finally{Cn(t)}}}function Cn(t,e){if(t.a){On(t);var n=t.a,s=t.s[0]?_:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=s}catch(t){}}}function On(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(E.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function Pn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return H(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ye(t,e,n))}function Mn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Un(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Mn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Mn("baseRetryDelayMs",5e3,t),this.Ma=Mn("retryDelaySeedMs",1e4,t),this.Ja=Mn("forwardChannelMaxRetries",2,t),this.ma=Mn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new In},this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function qn(t){if(jn(t),3==t.v){var e=t.R++,n=ze(t.B);Ye(n,"SID",t.J),Ye(n,"RID",e),Ye(n,"TYPE","terminate"),zn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Qe(ze(n)),n=!1,E.navigator&&E.navigator.sendBeacon&&(n=E.navigator.sendBeacon(e.i.toString(),"")),!n&&E.Image&&((new Image).src=e.i,n=!0),n||(e.a=ss(e.g,null),e.a.ba(e.i)),e.u=C(),Ce(e)}es(t)}function Fn(t){t.a&&(Wn(t),t.a.cancel(),t.a=null)}function jn(t){Fn(t),t.j&&(E.clearTimeout(t.j),t.j=null),Qn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&E.clearTimeout(t.h),t.h=null)}function Gn(t,e){t.g.push(new function(t,e){this.b=t,this.a=e}(t.La++,e)),3==t.v&&$n(t)}function $n(t){gn(t.b)||t.h||(t.h=!0,Ht(t.Ba,t),t.u=0)}function Bn(t,e){var n;n=e?e.f:t.R++;var s=ze(t.B);Ye(s,"SID",t.J),Ye(s,"RID",n),Ye(s,"AID",t.P),zn(t,s),t.i&&t.l&&Pn(s,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Kn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),yn(t.b,n),De(n,s,e)}function zn(t,e){t.f&&qe({},function(t,n){Ye(e,n,t)})}function Kn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?k(t.f.Ha,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,h=0;h<n;h++){var u=i[h].b,c=i[h].a;if(0>(u-=r))r=Math.max(0,i[h].b-100),a=!1;else try{En(c,o,"req"+u+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Hn(t){t.a||t.j||(t.U=1,Ht(t.Aa,t),t.o=0)}function Xn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pe(k(t.Aa,t),Zn(t,t.o)),t.o++,!0)}function Wn(t){null!=t.s&&(E.clearTimeout(t.s),t.s=null)}function Yn(t){t.a=new Ne(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Ye(e,"RID","rpc"),Ye(e,"SID",t.J),Ye(e,"CI",t.H?"0":"1"),Ye(e,"AID",t.P),zn(t,e),Ye(e,"TYPE","xmlhttp"),t.i&&t.l&&Pn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Qe(ze(e)),n.j=null,n.I=!0,Le(n,t)}function Qn(t){null!=t.m&&(E.clearTimeout(t.m),t.m=null)}function Jn(t,e){var n=null;if(t.a==e){Qn(t),Wn(t),t.a=null;var s=2}else{if(!wn(t.b,e))return;n=e.s,vn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=C()-e.u;var i=t.u;(s=he()).dispatchEvent(new de(s,n,e,i)),$n(t)}else Hn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)||(t.h=pe(k(t.Ba,t,e),Zn(t,t.u)),t.u++,0)))}(t,e)||2==s&&Xn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ts(t,5);break;case 4:ts(t,10);break;case 3:ts(t,6);break;default:ts(t,2)}}function Zn(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function ts(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=k(t.Xa,t);n||(n=new Be("//www.google.com/images/cleardot.gif"),E.location&&"http"==E.location.protocol||Ke(n,"https"),Qe(n)),function(t,e){var n=new re;if(E.Image){var s=new Image;s.onload=R(_n,n,s,"TestLoadImage: loaded",!0,e),s.onerror=R(_n,n,s,"TestLoadImage: error",!1,e),s.onabort=R(_n,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=R(_n,n,s,"TestLoadImage: timeout",!1,e),E.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else fe(2);t.v=0,t.f&&t.f.ra(e),es(t),jn(t)}function es(t){t.v=0,t.I=-1,t.f&&(0==bn(t.b).length&&0==t.g.length||(t.b.c.length=0,q(t.g),t.g.length=0),t.f.qa())}function ns(t,e,n){var s=function(t){return t instanceof Be?ze(t):new Be(t,void 0)}(n);if(""!=s.c)e&&He(s,e+"."+s.c),Xe(s,s.h);else{var i=E.location;s=function(t,e,n,s){var i=new Be(null,void 0);return t&&Ke(i,t),e&&He(i,e),n&&Xe(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.W&&H(t.W,function(t,e){Ye(s,e,t)}),e=t.A,n=t.na,e&&n&&Ye(s,e,n),Ye(s,"VER",t.ha),zn(t,s),s}function ss(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Ka)).F=t.C,e}function is(){}function rs(){if(et&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function os(t,e){Ut.call(this),this.a=new Un(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!F(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!F(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new us(this)}function as(t){Ee.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function hs(){_e.call(this),this.status=1}function us(t){this.a=t}(v=Nn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ye(this.H):ye(be),this.a.onreadystatechange=k(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Ln(this,t)}t=n||"";var i=new Fe(this.headers);s&&qe(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=Dn,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=E.FormData&&t instanceof E.FormData,!(0<=P(Sn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{On(this),0<this.o&&((this.D=function(t){return et&&ft(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=k(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},v.xa=function(){void 0!==I&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Cn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Cn(this,!0)),Nn.S.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ta())},v.Ta=function(){Rn(this)},v.X=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Un.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),s=this.l;if(this.O&&(s?Y(s=X(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Kn(this,n,e),Ye(i=ze(this.B),"RID",t),Ye(i,"CVER",22),this.A&&Ye(i,"X-HTTP-Session-Id",this.A),zn(this,i),this.i&&s&&Pn(i,this.i,s),yn(this.b,n),this.Ga&&Ye(i,"TYPE","init"),this.da?(Ye(i,"$req",e),Ye(i,"SID","null"),n.V=!0,De(n,i,null)):De(n,i,e),this.v=2}}else 3==this.v&&(t?Bn(this,t):0==this.g.length||gn(this.b)||Bn(this))},v.Aa=function(){if(this.j=null,Yn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pe(k(this.Sa,this),t)}},v.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Fn(this),Yn(this))},v.Ra=function(){null!=this.m&&(this.m=null,Fn(this),Xn(this),fe(19))},v.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),fe(2)):(this.c.info("Failed to ping google.com"),fe(1))},(v=is.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ha=function(){},rs.prototype.a=function(t,e){return new os(t,e)},O(os,Ut),(v=os.prototype).addEventListener=function(t,e,n,s){os.S.addEventListener.call(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){os.S.removeEventListener.call(this,t,e,n,s)},v.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;fe(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=ns(t,null,t.fa),$n(t)},v.close=function(){qn(this.a)},v.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,Gn(this.a,e)}else this.g?((e={}).__data__=Ft(t),Gn(this.a,e)):Gn(this.a,t)},v.G=function(){this.a.f=null,delete this.f,qn(this.a),delete this.a,os.S.G.call(this)},O(as,Ee),O(hs,_e),O(us,is),us.prototype.ta=function(){this.a.dispatchEvent("a")},us.prototype.sa=function(t){this.a.dispatchEvent(new as(t))},us.prototype.ra=function(t){this.a.dispatchEvent(new hs(t))},us.prototype.qa=function(){this.a.dispatchEvent("b")},rs.prototype.createWebChannel=rs.prototype.a,os.prototype.send=os.prototype.Pa,os.prototype.open=os.prototype.Oa,os.prototype.close=os.prototype.close,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",ve.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",Ut.prototype.listen=Ut.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var cs={createWebChannelTransport:function(){return new rs},ErrorCode:ge,EventType:me,WebChannel:ve,XhrIo:Nn},ls=cs.createWebChannelTransport,fs=cs.ErrorCode,ds=cs.EventType,ps=cs.WebChannel,gs=cs.XhrIo;class ms{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ms.UNAUTHENTICATED=new ms(null),ms.o=new ms("google-credentials-uid"),ms.u=new ms("first-party-uid");const ws=new m("@firebase/firestore");function ys(){return ws.logLevel}function vs(e,...n){if(ws.logLevel<=t.LogLevel.DEBUG){const t=n.map(Es);ws.debug("Firestore (7.21.1): "+e,...t)}}function bs(e,...n){if(ws.logLevel<=t.LogLevel.ERROR){const t=n.map(Es);ws.error("Firestore (7.21.1): "+e,...t)}}function Is(e,...n){if(ws.logLevel<=t.LogLevel.WARN){const t=n.map(Es);ws.warn("Firestore (7.21.1): "+e,...t)}}function Es(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _s(t="Unexpected state"){const e="FIRESTORE (7.21.1) INTERNAL ASSERTION FAILED: "+t;throw bs(e),new Error(e)}function Ts(t,e){t||_s()}function Ns(t,e){return t}const As={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xs extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Ss{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class Ds{constructor(t){this.l=null,this.currentUser=ms.UNAUTHENTICATED,this._=!1,this.T=0,this.I=null,this.forceRefresh=!1,this.l=(()=>{this.T++,this.currentUser=this.m(),this._=!0,this.I&&this.I(this.currentUser)}),this.T=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.l):(this.l(null),t.get().then(t=>{this.auth=t,this.l&&this.auth.addAuthTokenListener(this.l)},()=>{}))}getToken(){const t=this.T,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.T!==t?(vs("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ts("string"==typeof e.accessToken),new Ss(e.accessToken,this.currentUser)):null):Promise.resolve(null)}A(){this.forceRefresh=!0}R(t){this.I=t,this._&&t(this.currentUser)}P(){this.auth&&this.auth.removeAuthTokenListener(this.l),this.l=null,this.I=null}m(){const t=this.auth&&this.auth.getUid();return Ts(null===t||"string"==typeof t),new ms(t)}}function Ls(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ks{static g(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Ls(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function Rs(t,e){return t<e?-1:t>e?1:0}function Cs(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Os(t){return t+"\0"}class Vs{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new xs(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new xs(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new xs(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new xs(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Vs.fromMillis(Date.now())}static fromDate(t){return Vs.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Vs(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}V(t){return this.seconds===t.seconds?Rs(this.nanoseconds,t.nanoseconds):Rs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ps{constructor(t){this.timestamp=t}static p(t){return new Ps(t)}static min(){return new Ps(new Vs(0,0))}v(t){return this.timestamp.V(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}S(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}D(){return this.timestamp}}class Ms{constructor(t,e,n){void 0===e?e=0:e>t.length&&_s(),void 0===n?n=t.length-e:n>t.length-e&&_s(),this.segments=t,this.offset=e,this.C=n}get length(){return this.C}isEqual(t){return 0===Ms.N(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ms?t.forEach(t=>{e.push(t)}):e.push(t),this.O(e)}limit(){return this.offset+this.length}F(t){return t=void 0===t?1:t,this.O(this.segments,this.offset+t,this.length-t)}M(){return this.O(this.segments,this.offset,this.length-1)}$(){return this.segments[this.offset]}k(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}L(){return 0===this.length}q(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}B(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}U(){return this.segments.slice(this.offset,this.limit())}static N(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Us extends Ms{O(t,e,n){return new Us(t,e,n)}K(){return this.U().join("/")}toString(){return this.K()}static W(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Us(e)}static j(){return new Us([])}}const qs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fs extends Ms{O(t,e,n){return new Fs(t,e,n)}static G(t){return qs.test(t)}K(){return this.U().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),Fs.G(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.K()}H(){return 1===this.length&&"__name__"===this.get(0)}static J(){return new Fs(["__name__"])}static Y(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new xs(As.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new xs(As.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new xs(As.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Fs(e)}static j(){return new Fs([])}}class js{constructor(t){this.path=t}static X(t){return new js(Us.W(t))}static Z(t){return new js(Us.W(t).F(5))}tt(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Us.N(this.path,t.path)}toString(){return this.path.toString()}static N(t,e){return Us.N(t.path,e.path)}static et(t){return t.length%2==0}static nt(t){return new js(new Us(t.slice()))}}class Gs{constructor(t,e,n,s,i){this.st=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i}}class $s{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get it(){return"(default)"===this.database}isEqual(t){return t instanceof $s&&t.projectId===this.projectId&&t.database===this.database}v(t){return Rs(this.projectId,t.projectId)||Rs(this.database,t.database)}}function Bs(t){return null==t}function zs(t){return 0===t&&1/t==-1/0}function Ks(t){return"number"==typeof t&&Number.isInteger(t)&&!zs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Hs{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.rt=null}}function Xs(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Hs(t,e,n,s,i,r,o)}function Ws(t){const e=Ns(t);if(null===e.rt){let t=e.path.K();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.K()+t.op.toString()+$i(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.K()+t.dir})(t)).join(","),Bs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Mo(e.startAt)),e.endAt&&(t+="|ub:",t+=Mo(e.endAt)),e.rt=t}return e.rt}function Ys(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Go(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!qi(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!qo(t.startAt,e.startAt)&&qo(t.endAt,e.endAt)}function Qs(t){return js.et(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Js{constructor(t){this.ot=t}static fromBase64String(t){const e=atob(t);return new Js(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Js(e)}toBase64(){return t=this.ot,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.ot)}ct(){return 2*this.ot.length}v(t){return Rs(this.ot,t.ot)}isEqual(t){return this.ot===t.ot}}Js.at=new Js("");class Zs{constructor(t,e,n,s,i=Ps.min(),r=Ps.min(),o=Js.at){this.target=t,this.targetId=e,this.ut=n,this.sequenceNumber=s,this.ht=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}lt(t){return new Zs(this.target,this.targetId,this.ut,t,this.ht,this.lastLimboFreeSnapshotVersion,this.resumeToken)}_t(t,e){return new Zs(this.target,this.targetId,this.ut,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}ft(t){return new Zs(this.target,this.targetId,this.ut,this.sequenceNumber,this.ht,t,this.resumeToken)}}class ti{constructor(t){this.count=t}}var ei,ni;function si(t){switch(t){case As.OK:return _s();case As.CANCELLED:case As.UNKNOWN:case As.DEADLINE_EXCEEDED:case As.RESOURCE_EXHAUSTED:case As.INTERNAL:case As.UNAVAILABLE:case As.UNAUTHENTICATED:return!1;case As.INVALID_ARGUMENT:case As.NOT_FOUND:case As.ALREADY_EXISTS:case As.PERMISSION_DENIED:case As.FAILED_PRECONDITION:case As.ABORTED:case As.OUT_OF_RANGE:case As.UNIMPLEMENTED:case As.DATA_LOSS:return!0;default:return _s()}}function ii(t){if(void 0===t)return bs("GRPC error has no .code"),As.UNKNOWN;switch(t){case ei.OK:return As.OK;case ei.CANCELLED:return As.CANCELLED;case ei.UNKNOWN:return As.UNKNOWN;case ei.DEADLINE_EXCEEDED:return As.DEADLINE_EXCEEDED;case ei.RESOURCE_EXHAUSTED:return As.RESOURCE_EXHAUSTED;case ei.INTERNAL:return As.INTERNAL;case ei.UNAVAILABLE:return As.UNAVAILABLE;case ei.UNAUTHENTICATED:return As.UNAUTHENTICATED;case ei.INVALID_ARGUMENT:return As.INVALID_ARGUMENT;case ei.NOT_FOUND:return As.NOT_FOUND;case ei.ALREADY_EXISTS:return As.ALREADY_EXISTS;case ei.PERMISSION_DENIED:return As.PERMISSION_DENIED;case ei.FAILED_PRECONDITION:return As.FAILED_PRECONDITION;case ei.ABORTED:return As.ABORTED;case ei.OUT_OF_RANGE:return As.OUT_OF_RANGE;case ei.UNIMPLEMENTED:return As.UNIMPLEMENTED;case ei.DATA_LOSS:return As.DATA_LOSS;default:return _s()}}(ni=ei||(ei={}))[ni.OK=0]="OK",ni[ni.CANCELLED=1]="CANCELLED",ni[ni.UNKNOWN=2]="UNKNOWN",ni[ni.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ni[ni.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ni[ni.NOT_FOUND=5]="NOT_FOUND",ni[ni.ALREADY_EXISTS=6]="ALREADY_EXISTS",ni[ni.PERMISSION_DENIED=7]="PERMISSION_DENIED",ni[ni.UNAUTHENTICATED=16]="UNAUTHENTICATED",ni[ni.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ni[ni.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ni[ni.ABORTED=10]="ABORTED",ni[ni.OUT_OF_RANGE=11]="OUT_OF_RANGE",ni[ni.UNIMPLEMENTED=12]="UNIMPLEMENTED",ni[ni.INTERNAL=13]="INTERNAL",ni[ni.UNAVAILABLE=14]="UNAVAILABLE",ni[ni.DATA_LOSS=15]="DATA_LOSS";class ri{constructor(t,e){this.N=t,this.root=e||ai.EMPTY}dt(t,e){return new ri(this.N,this.root.dt(t,e,this.N).copy(null,null,ai.wt,null,null))}remove(t){return new ri(this.N,this.root.remove(t,this.N).copy(null,null,ai.wt,null,null))}get(t){let e=this.root;for(;!e.L();){const n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.L();){const s=this.N(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}L(){return this.root.L()}get size(){return this.root.size}Et(){return this.root.Et()}Tt(){return this.root.Tt()}It(t){return this.root.It(t)}forEach(t){this.It((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.It((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}At(t){return this.root.At(t)}Rt(){return new oi(this.root,null,this.N,!1)}Pt(t){return new oi(this.root,t,this.N,!1)}gt(){return new oi(this.root,null,this.N,!0)}Vt(t){return new oi(this.root,t,this.N,!0)}}class oi{constructor(t,e,n,s){this.yt=s,this.bt=[];let i=1;for(;!t.L();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.yt?t.left:t.right;else{if(0===i){this.bt.push(t);break}this.bt.push(t),t=this.yt?t.right:t.left}}vt(){let t=this.bt.pop();const e={key:t.key,value:t.value};if(this.yt)for(t=t.left;!t.L();)this.bt.push(t),t=t.right;else for(t=t.right;!t.L();)this.bt.push(t),t=t.left;return e}St(){return this.bt.length>0}Dt(){if(0===this.bt.length)return null;const t=this.bt[this.bt.length-1];return{key:t.key,value:t.value}}}class ai{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:ai.RED,this.left=null!=s?s:ai.EMPTY,this.right=null!=i?i:ai.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new ai(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}L(){return!1}It(t){return this.left.It(t)||t(this.key,this.value)||this.right.It(t)}At(t){return this.right.At(t)||t(this.key,this.value)||this.left.At(t)}min(){return this.left.L()?this:this.left.min()}Et(){return this.min().key}Tt(){return this.right.L()?this.key:this.right.Tt()}dt(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left.dt(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.dt(t,e,n))).Ct()}Nt(){if(this.left.L())return ai.EMPTY;let t=this;return t.left.xt()||t.left.left.xt()||(t=t.Ot()),(t=t.copy(null,null,null,t.left.Nt(),null)).Ct()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.L()||s.left.xt()||s.left.left.xt()||(s=s.Ot()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.xt()&&(s=s.Ft()),s.right.L()||s.right.xt()||s.right.left.xt()||(s=s.Mt()),0===e(t,s.key)){if(s.right.L())return ai.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.Nt())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.Ct()}xt(){return this.color}Ct(){let t=this;return t.right.xt()&&!t.left.xt()&&(t=t.$t()),t.left.xt()&&t.left.left.xt()&&(t=t.Ft()),t.left.xt()&&t.right.xt()&&(t=t.kt()),t}Ot(){let t=this.kt();return t.right.left.xt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Ft())).$t()).kt()),t}Mt(){let t=this.kt();return t.left.left.xt()&&(t=(t=t.Ft()).kt()),t}$t(){const t=this.copy(null,null,ai.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}Ft(){const t=this.copy(null,null,ai.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}kt(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Lt(){const t=this.qt();return Math.pow(2,t)<=this.size+1}qt(){if(this.xt()&&this.left.xt())throw _s();if(this.right.xt())throw _s();const t=this.left.qt();if(t!==this.right.qt())throw _s();return t+(this.xt()?0:1)}}ai.EMPTY=null,ai.RED=!0,ai.wt=!1,ai.EMPTY=new class{constructor(){this.size=0}get key(){throw _s()}get value(){throw _s()}get color(){throw _s()}get left(){throw _s()}get right(){throw _s()}copy(t,e,n,s,i){return this}dt(t,e,n){return new ai(t,e)}remove(t,e){return this}L(){return!0}It(t){return!1}At(t){return!1}Et(){return null}Tt(){return null}xt(){return!1}Lt(){return!0}qt(){return 0}};class hi{constructor(t){this.N=t,this.data=new ri(this.N)}has(t){return null!==this.data.get(t)}first(){return this.data.Et()}last(){return this.data.Tt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.It((e,n)=>(t(e),!1))}Bt(t,e){const n=this.data.Pt(t[0]);for(;n.St();){const s=n.vt();if(this.N(s.key,t[1])>=0)return;e(s.key)}}Ut(t,e){let n;for(n=void 0!==e?this.data.Pt(e):this.data.Rt();n.St();)if(!t(n.vt().key))return}Kt(t){const e=this.data.Pt(t);return e.St()?e.vt().key:null}Rt(){return new ui(this.data.Rt())}Pt(t){return new ui(this.data.Pt(t))}add(t){return this.copy(this.data.remove(t).dt(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}L(){return this.data.L()}Qt(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof hi))return!1;if(this.size!==t.size)return!1;const e=this.data.Rt(),n=t.data.Rt();for(;e.St();){const t=e.vt().key,s=n.vt().key;if(0!==this.N(t,s))return!1}return!0}U(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new hi(this.N);return e.data=t,e}}class ui{constructor(t){this.Wt=t}vt(){return this.Wt.vt().key}St(){return this.Wt.St()}}const ci=new ri(js.N);function li(){return ci}function fi(){return li()}const di=new ri(js.N);function pi(){return di}const gi=new ri(js.N),mi=new hi(js.N);function wi(...t){let e=mi;for(const n of t)e=e.add(n);return e}const yi=new hi(Rs);function vi(){return yi}class bi{constructor(t){this.N=t?(e,n)=>t(e,n)||js.N(e.key,n.key):(t,e)=>js.N(t.key,e.key),this.jt=pi(),this.Gt=new ri(this.N)}static zt(t){return new bi(t.N)}has(t){return null!=this.jt.get(t)}get(t){return this.jt.get(t)}first(){return this.Gt.Et()}last(){return this.Gt.Tt()}L(){return this.Gt.L()}indexOf(t){const e=this.jt.get(t);return e?this.Gt.indexOf(e):-1}get size(){return this.Gt.size}forEach(t){this.Gt.It((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.jt.dt(t.key,t),e.Gt.dt(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.jt.remove(t),this.Gt.remove(e)):this}isEqual(t){if(!(t instanceof bi))return!1;if(this.size!==t.size)return!1;const e=this.Gt.Rt(),n=t.Gt.Rt();for(;e.St();){const t=e.vt().key,s=n.vt().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bi;return n.N=this.N,n.jt=t,n.Gt=e,n}}class Ii{constructor(){this.Ht=new ri(js.N)}track(t){const e=t.doc.key,n=this.Ht.get(e);n?0!==t.type&&3===n.type?this.Ht=this.Ht.dt(e,t):3===t.type&&1!==n.type?this.Ht=this.Ht.dt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ht=this.Ht.dt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ht=this.Ht.dt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ht=this.Ht.remove(e):1===t.type&&2===n.type?this.Ht=this.Ht.dt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ht=this.Ht.dt(e,{type:2,doc:t.doc}):_s():this.Ht=this.Ht.dt(e,t)}Jt(){const t=[];return this.Ht.It((e,n)=>{t.push(n)}),t}}class Ei{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.Yt=n,this.docChanges=s,this.Xt=i,this.fromCache=r,this.Zt=o,this.te=a}static ee(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Ei(t,e,bi.zt(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.Xt.L()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Zt===t.Zt&&this.Xt.isEqual(t.Xt)&&Eo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Yt.isEqual(t.Yt)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class _i{constructor(t,e,n,s,i){this.ht=t,this.ne=e,this.se=n,this.ie=s,this.re=i}static oe(t,e){const n=new Map;return n.set(t,Ti.ce(t,e)),new _i(Ps.min(),n,vi(),li(),wi())}}class Ti{constructor(t,e,n,s,i){this.resumeToken=t,this.ae=e,this.ue=n,this.he=s,this.le=i}static ce(t,e){return new Ti(Js.at,e,wi(),wi(),wi())}}class Ni{constructor(t,e,n,s){this._e=t,this.removedTargetIds=e,this.key=n,this.fe=s}}class Ai{constructor(t,e){this.targetId=t,this.de=e}}class xi{constructor(t,e,n=Js.at,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Si{constructor(){this.we=0,this.Ee=ki(),this.Te=Js.at,this.Ie=!1,this.me=!0}get ae(){return this.Ie}get resumeToken(){return this.Te}get Ae(){return 0!==this.we}get Re(){return this.me}Pe(t){t.ct()>0&&(this.me=!0,this.Te=t)}ge(){let t=wi(),e=wi(),n=wi();return this.Ee.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:_s()}}),new Ti(this.Te,this.Ie,t,e,n)}Ve(){this.me=!1,this.Ee=ki()}ye(t,e){this.me=!0,this.Ee=this.Ee.dt(t,e)}pe(t){this.me=!0,this.Ee=this.Ee.remove(t)}be(){this.we+=1}ve(){this.we-=1}Se(){this.me=!0,this.Ie=!0}}class Di{constructor(t){this.De=t,this.Ce=new Map,this.Ne=li(),this.xe=Li(),this.Oe=new hi(Rs)}Fe(t){for(const e of t._e)t.fe instanceof ho?this.Me(e,t.fe):t.fe instanceof uo&&this.$e(e,t.key,t.fe);for(const e of t.removedTargetIds)this.$e(e,t.key,t.fe)}ke(t){this.Le(t,e=>{const n=this.qe(e);switch(t.state){case 0:this.Be(e)&&n.Pe(t.resumeToken);break;case 1:n.ve(),n.Ae||n.Ve(),n.Pe(t.resumeToken);break;case 2:n.ve(),n.Ae||this.removeTarget(e);break;case 3:this.Be(e)&&(n.Se(),n.Pe(t.resumeToken));break;case 4:this.Be(e)&&(this.Ue(e),n.Pe(t.resumeToken));break;default:_s()}})}Le(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ce.forEach((t,n)=>{this.Be(n)&&e(n)})}Ke(t){const e=t.targetId,n=t.de.count,s=this.Qe(e);if(s){const t=s.target;if(Qs(t))if(0===n){const n=new js(t.path);this.$e(e,n,new uo(n,Ps.min()))}else Ts(1===n);else this.We(e)!==n&&(this.Ue(e),this.Oe=this.Oe.add(e))}}je(t){const e=new Map;this.Ce.forEach((n,s)=>{const i=this.Qe(s);if(i){if(n.ae&&Qs(i.target)){const e=new js(i.target.path);null!==this.Ne.get(e)||this.Ge(s,e)||this.$e(s,e,new uo(e,t))}n.Re&&(e.set(s,n.ge()),n.Ve())}});let n=wi();this.xe.forEach((t,e)=>{let s=!0;e.Ut(t=>{const e=this.Qe(t);return!e||2===e.ut||(s=!1,!1)}),s&&(n=n.add(t))});const s=new _i(t,e,this.Oe,this.Ne,n);return this.Ne=li(),this.xe=Li(),this.Oe=new hi(Rs),s}Me(t,e){if(!this.Be(t))return;const n=this.Ge(t,e.key)?2:0;this.qe(t).ye(e.key,n),this.Ne=this.Ne.dt(e.key,e),this.xe=this.xe.dt(e.key,this.ze(e.key).add(t))}$e(t,e,n){if(!this.Be(t))return;const s=this.qe(t);this.Ge(t,e)?s.ye(e,1):s.pe(e),this.xe=this.xe.dt(e,this.ze(e).delete(t)),n&&(this.Ne=this.Ne.dt(e,n))}removeTarget(t){this.Ce.delete(t)}We(t){const e=this.qe(t).ge();return this.De.He(t).size+e.ue.size-e.le.size}be(t){this.qe(t).be()}qe(t){let e=this.Ce.get(t);return e||(e=new Si,this.Ce.set(t,e)),e}ze(t){let e=this.xe.get(t);return e||(e=new hi(Rs),this.xe=this.xe.dt(t,e)),e}Be(t){const e=null!==this.Qe(t);return e||vs("WatchChangeAggregator","Detected inactive target",t),e}Qe(t){const e=this.Ce.get(t);return e&&e.Ae?null:this.De.Je(t)}Ue(t){this.Ce.set(t,new Si),this.De.He(t).forEach(e=>{this.$e(t,e,null)})}Ge(t,e){return this.De.He(t).has(e)}}function Li(){return new ri(js.N)}function ki(){return new ri(js.N)}function Ri(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ci(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Oi(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Vi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Pi(t){const e=Bi(t.mapValue.fields.__local_write_time__.timestampValue);return new Vs(e.seconds,e.nanos)}const Mi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ui(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Vi(t)?4:10:_s()}function qi(t,e){const n=Ui(t);if(n!==Ui(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Pi(t).isEqual(Pi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Bi(t.timestampValue),s=Bi(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ki(t.bytesValue).isEqual(Ki(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zi(t.geoPointValue.latitude)===zi(e.geoPointValue.latitude)&&zi(t.geoPointValue.longitude)===zi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zi(t.integerValue)===zi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=zi(t.doubleValue),s=zi(e.doubleValue);return n===s?zs(n)===zs(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Cs(t.arrayValue.values||[],e.arrayValue.values||[],qi);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Ri(n)!==Ri(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!qi(n[t],s[t])))return!1;return!0}(t,e);default:return _s()}}function Fi(t,e){return void 0!==(t.values||[]).find(t=>qi(t,e))}function ji(t,e){const n=Ui(t),s=Ui(e);if(n!==s)return Rs(n,s);switch(n){case 0:return 0;case 1:return Rs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=zi(t.integerValue||t.doubleValue),s=zi(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Gi(t.timestampValue,e.timestampValue);case 4:return Gi(Pi(t),Pi(e));case 5:return Rs(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ki(t),s=Ki(e);return n.v(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Rs(n[t],s[t]);if(0!==e)return e}return Rs(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Rs(zi(t.latitude),zi(e.latitude));return 0!==n?n:Rs(zi(t.longitude),zi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=ji(n[t],s[t]);if(e)return e}return Rs(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=Rs(s[t],r[t]);if(0!==e)return e;const o=ji(n[s[t]],i[r[t]]);if(0!==o)return o}return Rs(s.length,r.length)}(t.mapValue,e.mapValue);default:throw _s()}}function Gi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rs(t,e);const n=Bi(t),s=Bi(e),i=Rs(n.seconds,s.seconds);return 0!==i?i:Rs(n.nanos,s.nanos)}function $i(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Bi(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ki(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,js.Z(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):_s();var n,s}(t)}function Bi(t){if(Ts(!!t),"string"==typeof t){let e=0;const n=Mi.exec(t);if(Ts(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:zi(t.seconds),nanos:zi(t.nanos)}}function zi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ki(t){return"string"==typeof t?Js.fromBase64String(t):Js.fromUint8Array(t)}function Hi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.K()}`}}function Xi(t){return!!t&&"integerValue"in t}function Wi(t){return!!t&&"arrayValue"in t}function Yi(t){return!!t&&"nullValue"in t}function Qi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ji(t){return!!t&&"mapValue"in t}const Zi={asc:"ASCENDING",desc:"DESCENDING"},tr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class er{constructor(t,e){this.st=t,this.Ye=e}}function nr(t){return{integerValue:""+t}}function sr(t,e){if(t.Ye){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function ir(t,e){return Ks(e)?nr(e):sr(t,e)}function rr(t,e){return t.Ye?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function or(t,e){return t.Ye?e.toBase64():e.toUint8Array()}function ar(t){return Ts(!!t),Ps.p(function(t){const e=Bi(t);return new Vs(e.seconds,e.nanos)}(t))}function hr(t,e){return function(t){return new Us(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).K()}function ur(t){const e=Us.W(t);return Ts(Ar(e)),e}function cr(t,e){return hr(t.st,e.path)}function lr(t,e){const n=ur(e);return Ts(n.get(1)===t.st.projectId),Ts(!n.get(3)&&!t.st.database||n.get(3)===t.st.database),new js(gr(n))}function fr(t,e){return hr(t.st,e)}function dr(t){const e=ur(t);return 4===e.length?Us.j():gr(e)}function pr(t){return new Us(["projects",t.st.projectId,"databases",t.st.database]).K()}function gr(t){return Ts(t.length>4&&"documents"===t.get(4)),t.F(5)}function mr(t,e,n){return{name:cr(t,e),fields:n.proto.mapValue.fields}}function wr(t,e){let n;if(e instanceof Yr)n={update:mr(t,e.key,e.value)};else if(e instanceof no)n={delete:cr(t,e.key)};else if(e instanceof Qr)n={update:mr(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.K())),{fieldPaths:e}}(e.Xe)};else if(e instanceof Zr)n={transform:{document:cr(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof kr)return{fieldPath:e.field.K(),setToServerValue:"REQUEST_TIME"};if(n instanceof Rr)return{fieldPath:e.field.K(),appendMissingElements:{values:n.elements}};if(n instanceof Or)return{fieldPath:e.field.K(),removeAllFromArray:{values:n.elements}};if(n instanceof Pr)return{fieldPath:e.field.K(),increment:n.Ze};throw _s()})(0,t))}};else{if(!(e instanceof so))return _s();n={verify:cr(t,e.key)}}return e.en.tn||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return rr(t,e.D())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_s()}(t,e.en)),n}function yr(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Gr.updateTime(ar(t.updateTime)):void 0!==t.exists?Gr.exists(t.exists):Gr.nn()}(e.currentDocument):Gr.nn();if(e.update){e.update.name;const s=lr(t,e.update.name),i=new io({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new qr(e.map(t=>Fs.Y(t)))}(e.updateMask);return new Qr(s,i,t,n)}return new Yr(s,i,n)}if(e.delete){const s=lr(t,e.delete);return new no(s,n)}if(e.transform){const s=lr(t,e.transform.document),i=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)Ts("REQUEST_TIME"===e.setToServerValue),n=new kr;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Rr(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Or(t)}else"increment"in e?n=new Pr(t,e.increment):_s();const s=Fs.Y(e.fieldPath);return new Fr(s,n)})(t,e));return Ts(!0===n.exists),new Zr(s,i)}if(e.verify){const s=lr(t,e.verify);return new so(s,n)}return _s()}function vr(t,e){return{documents:[fr(t,e.path)]}}function br(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=fr(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fr(t,s.M()),n.structuredQuery.from=[{collectionId:s.k()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Qi(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NAN"}};if(Yi(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Qi(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NOT_NAN"}};if(Yi(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Tr(t.field),op:function(t){return tr[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Tr(t.field),direction:function(t){return Zi[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.Ye||Bs(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Er(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Er(e.endAt)),n}function Ir(t){let e=dr(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Ts(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Nr(t.unaryFilter.field);return xo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Nr(t.unaryFilter.field);return xo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Nr(t.unaryFilter.field);return xo.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Nr(t.unaryFilter.field);return xo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _s()}}(e)]:void 0!==e.fieldFilter?[function(t){return xo.create(Nr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _s()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):_s():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Fo(Nr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Bs(e="object"==typeof t?t.value:t)?null:e}(n.limit));let h=null;n.startAt&&(h=_r(n.startAt));let u=null;return n.endAt&&(u=_r(n.endAt)),Io(fo(e,i,o,r,a,"F",h,u))}function Er(t){return{before:t.before,values:t.position}}function _r(t){const e=!!t.before,n=t.values||[];return new Po(n,e)}function Tr(t){return{fieldPath:t.K()}}function Nr(t){return Fs.Y(t.fieldPath)}function Ar(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class xr{constructor(){this.sn=void 0}}function Sr(t,e,n){return t instanceof kr?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Rr?Cr(t,e):t instanceof Or?Vr(t,e):function(t,e){const n=Lr(t,e),s=Mr(n)+Mr(t.Ze);return Xi(n)&&Xi(t.Ze)?nr(s):sr(t.serializer,s)}(t,e)}function Dr(t,e,n){return t instanceof Rr?Cr(t,e):t instanceof Or?Vr(t,e):n}function Lr(t,e){return t instanceof Pr?Xi(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class kr extends xr{}class Rr extends xr{constructor(t){super(),this.elements=t}}function Cr(t,e){const n=Ur(e);for(const e of t.elements)n.some(t=>qi(t,e))||n.push(e);return{arrayValue:{values:n}}}class Or extends xr{constructor(t){super(),this.elements=t}}function Vr(t,e){let n=Ur(e);for(const e of t.elements)n=n.filter(t=>!qi(t,e));return{arrayValue:{values:n}}}class Pr extends xr{constructor(t,e){super(),this.serializer=t,this.Ze=e}}function Mr(t){return zi(t.integerValue||t.doubleValue)}function Ur(t){return Wi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class qr{constructor(t){this.fields=t,t.sort(Fs.N)}rn(t){for(const e of this.fields)if(e.q(t))return!0;return!1}isEqual(t){return Cs(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class Fr{constructor(t,e){this.field=t,this.transform=e}}class jr{constructor(t,e){this.version=t,this.transformResults=e}}class Gr{constructor(t,e){this.updateTime=t,this.exists=e}static nn(){return new Gr}static exists(t){return new Gr(void 0,t)}static updateTime(t){return new Gr(t)}get tn(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function $r(t,e){return void 0!==t.updateTime?e instanceof ho&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ho}class Br{}function zr(t,e,n){return t instanceof Yr?function(t,e,n){return new ho(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Qr?function(t,e,n){if(!$r(t.en,e))return new co(t.key,n.version);const s=Jr(t,e);return new ho(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof Zr?function(t,e,n){if(Ts(null!=n.transformResults),!$r(t.en,e))return new co(t.key,n.version);const s=to(t,e),i=function(t,e,n){const s=[];Ts(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof ho&&(a=e.field(r.field)),s.push(Dr(o,a,n[i]))}return s}(t.fieldTransforms,e,n.transformResults),r=n.version,o=eo(t,s.data(),i);return new ho(t.key,r,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new uo(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Kr(t,e,n,s){return t instanceof Yr?function(t,e){if(!$r(t.en,e))return e;const n=Wr(e);return new ho(t.key,n,t.value,{on:!0})}(t,e):t instanceof Qr?function(t,e){if(!$r(t.en,e))return e;const n=Wr(e),s=Jr(t,e);return new ho(t.key,n,s,{on:!0})}(t,e):t instanceof Zr?function(t,e,n,s){if(!$r(t.en,e))return e;const i=to(t,e),r=function(t,e,n,s){const i=[];for(const r of t){const t=r.transform;let o=null;n instanceof ho&&(o=n.field(r.field)),null===o&&s instanceof ho&&(o=s.field(r.field)),i.push(Sr(t,o,e))}return i}(t.fieldTransforms,n,e,s),o=eo(t,i.data(),r);return new ho(t.key,i.version,o,{on:!0})}(t,e,s,n):function(t,e){return $r(t.en,e)?new uo(t.key,Ps.min()):e}(t,e)}function Hr(t,e){return t instanceof Zr?function(t,e){let n=null;for(const s of t.fieldTransforms){const t=e instanceof ho?e.field(s.field):void 0,i=Lr(s.transform,t||null);null!=i&&(n=null==n?(new ro).set(s.field,i):n.set(s.field,i))}return n?n.cn():null}(t,e):null}function Xr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.en.isEqual(e.en)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Xe.isEqual(e.Xe):2!==t.type||Cs(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Rr&&e instanceof Rr||t instanceof Or&&e instanceof Or?Cs(t.elements,e.elements,qi):t instanceof Pr&&e instanceof Pr?qi(t.Ze,e.Ze):t instanceof kr&&e instanceof kr}(t.transform,e.transform)})(t,e)))}function Wr(t){return t instanceof ho?t.version:Ps.min()}class Yr extends Br{constructor(t,e,n){super(),this.key=t,this.value=e,this.en=n,this.type=0}}class Qr extends Br{constructor(t,e,n,s){super(),this.key=t,this.data=e,this.Xe=n,this.en=s,this.type=1}}function Jr(t,e){let n;return function(t,e){const n=new ro(e);return t.Xe.fields.forEach(e=>{if(!e.L()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.cn()}(t,n=e instanceof ho?e.data():io.empty())}class Zr extends Br{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.en=Gr.exists(!0)}}function to(t,e){return e}function eo(t,e,n){const s=new ro(e);for(let e=0;e<t.fieldTransforms.length;e++){const i=t.fieldTransforms[e];s.set(i.field,n[e])}return s.cn()}class no extends Br{constructor(t,e){super(),this.key=t,this.en=e,this.type=3}}class so extends Br{constructor(t,e){super(),this.key=t,this.en=e,this.type=4}}class io{constructor(t){this.proto=t}static empty(){return new io({mapValue:{}})}field(t){if(t.L())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ji(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.k()])||null}}isEqual(t){return qi(this.proto,t.proto)}}class ro{constructor(t=io.empty()){this.an=t,this.un=new Map}set(t,e){return this.hn(t,e),this}delete(t){return this.hn(t,null),this}hn(t,e){let n=this.un;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===Ui(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.k(),e)}cn(){const t=this.ln(Fs.j(),this.un);return null!=t?new io(t):this.an}ln(t,e){let n=!1;const s=this.an.field(t),i=Ji(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.ln(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function oo(t){const e=[];return Ci(t.fields||{},(t,n)=>{const s=new Fs([t]);if(Ji(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new qr(e)}class ao{constructor(t,e){this.key=t,this.version=e}}class ho extends ao{constructor(t,e,n,s){super(t,e),this._n=n,this.on=!!s.on,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this._n.field(t)}data(){return this._n}fn(){return this._n.proto}isEqual(t){return t instanceof ho&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.on===t.on&&this.hasCommittedMutations===t.hasCommittedMutations&&this._n.isEqual(t._n)}toString(){return`Document(${this.key}, ${this.version}, ${this._n.toString()}, {hasLocalMutations: ${this.on}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.on||this.hasCommittedMutations}}class uo extends ao{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof uo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class co extends ao{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof co&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class lo{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.dn=n,this.filters=s,this.limit=i,this.wn=r,this.startAt=o,this.endAt=a,this.En=null,this.Tn=null,this.startAt,this.endAt}}function fo(t,e,n,s,i,r,o,a){return new lo(t,e,n,s,i,r,o,a)}function po(t){return new lo(t)}function go(t){return!Bs(t.limit)&&"F"===t.wn}function mo(t){return!Bs(t.limit)&&"L"===t.wn}function wo(t){return t.dn.length>0?t.dn[0].field:null}function yo(t){for(const e of t.filters)if(e.In())return e.field;return null}function vo(t){return null!==t.collectionGroup}function bo(t){const e=Ns(t);if(null===e.En){e.En=[];const t=yo(e),n=wo(e);if(null!==t&&null===n)t.H()||e.En.push(new Fo(t)),e.En.push(new Fo(Fs.J(),"asc"));else{let t=!1;for(const n of e.dn)e.En.push(n),n.field.H()&&(t=!0);if(!t){const t=e.dn.length>0?e.dn[e.dn.length-1].dir:"asc";e.En.push(new Fo(Fs.J(),t))}}}return e.En}function Io(t){const e=Ns(t);if(!e.Tn)if("F"===e.wn)e.Tn=Xs(e.path,e.collectionGroup,bo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of bo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Fo(n.field,e))}const n=e.endAt?new Po(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Po(e.startAt.position,!e.startAt.before):null;e.Tn=Xs(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.Tn}function Eo(t,e){return Ys(Io(t),Io(e))&&t.wn===e.wn}function _o(t){return`${Ws(Io(t))}|lt:${t.wn}`}function To(t){return`Query(target=${function(t){let e=t.path.K();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.K()} ${e.op} ${$i(e.value)}`;var e}).join(", ")}]`),Bs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.K()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Mo(t.startAt)),t.endAt&&(e+=", endAt: "+Mo(t.endAt)),`Target(${e})`}(Io(t))}; limitType=${t.wn})`}function No(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.tt(t.collectionGroup)&&t.path.q(n):js.et(t.path)?t.path.isEqual(n):t.path.B(n)}(t,e)&&function(t,e){for(const n of t.dn)if(!n.field.H()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Uo(t.startAt,bo(t),e))&&(!t.endAt||!Uo(t.endAt,bo(t),e))}(t,e)}function Ao(t){return(e,n)=>{let s=!1;for(const i of bo(t)){const t=jo(i,e,n);if(0!==t)return t;s=s||i.field.H()}return 0}}class xo extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.H())return"in"===e||"not-in"===e?this.mn(t,e,n):new So(t,e,n);if(Yi(n)){if("=="!==e&&"!="!==e)throw new xs(As.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new xo(t,e,n)}if(Qi(n)){if("=="!==e&&"!="!==e)throw new xs(As.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new xo(t,e,n)}return"array-contains"===e?new Ro(t,n):"in"===e?new Co(t,n):"not-in"===e?new Oo(t,n):"array-contains-any"===e?new Vo(t,n):new xo(t,e,n)}static mn(t,e,n){return"in"===e?new Do(t,n):new Lo(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.An(ji(e,this.value)):null!==e&&Ui(this.value)===Ui(e)&&this.An(ji(e,this.value))}An(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _s()}}In(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class So extends xo{constructor(t,e,n){super(t,e,n),this.key=js.Z(n.referenceValue)}matches(t){const e=js.N(t.key,this.key);return this.An(e)}}class Do extends xo{constructor(t,e){super(t,"in",e),this.keys=ko("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Lo extends xo{constructor(t,e){super(t,"not-in",e),this.keys=ko("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function ko(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>js.Z(t.referenceValue))}class Ro extends xo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Wi(e)&&Fi(e.arrayValue,this.value)}}class Co extends xo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Fi(this.value.arrayValue,e)}}class Oo extends xo{constructor(t,e){super(t,"not-in",e)}matches(t){if(Fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!Fi(this.value.arrayValue,e)}}class Vo extends xo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Wi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Fi(this.value.arrayValue,t))}}class Po{constructor(t,e){this.position=t,this.before=e}}function Mo(t){return`${t.before?"b":"a"}:${t.position.map(t=>$i(t)).join(",")}`}function Uo(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.H()?js.N(js.Z(o.referenceValue),n.key):ji(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function qo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!qi(t.position[n],e.position[n]))return!1;return!0}class Fo{constructor(t,e="asc"){this.field=t,this.dir=e}}function jo(t,e,n){const s=t.field.H()?js.N(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?ji(s,i):_s()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return _s()}}function Go(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class $o{constructor(t,e,n,s){this.batchId=t,this.Rn=e,this.baseMutations=n,this.mutations=s}Pn(t,e,n){const s=n.gn;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=zr(i,e,s[n]))}return e}Vn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Kr(n,e,e,this.Rn));const n=e;for(const s of this.mutations)s.key.isEqual(t)&&(e=Kr(s,e,n,this.Rn));return e}yn(t){let e=t;return this.mutations.forEach(n=>{const s=this.Vn(n.key,t.get(n.key));s&&(e=e.dt(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),wi())}isEqual(t){return this.batchId===t.batchId&&Cs(this.mutations,t.mutations,(t,e)=>Xr(t,e))&&Cs(this.baseMutations,t.baseMutations,(t,e)=>Xr(t,e))}}class Bo{constructor(t,e,n,s){this.batch=t,this.pn=e,this.gn=n,this.bn=s}static from(t,e,n){Ts(t.mutations.length===n.length);let s=gi;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.dt(i[t].key,n[t].version);return new Bo(t,e,n,s)}}class zo{constructor(t,e){this.vn=t,this.Sn=e,this.Dn={}}get(t){const e=this.vn(t),n=this.Dn[e];if(void 0!==n)for(const[e,s]of n)if(this.Sn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.vn(t),s=this.Dn[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.Sn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.Dn[n]=[[t,e]]}delete(t){const e=this.vn(t),n=this.Dn[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.Sn(n[s][0],t))return 1===n.length?delete this.Dn[e]:n.splice(s,1),!0;return!1}forEach(t){Ci(this.Dn,(e,n)=>{for(const[e,s]of n)t(e,s)})}L(){return Oi(this.Dn)}}class Ko{constructor(t){this.Cn=null,this.Nn=null,this.result=void 0,this.error=void 0,this.xn=!1,this.On=!1,t(t=>{this.xn=!0,this.result=t,this.Cn&&this.Cn(t)},t=>{this.xn=!0,this.error=t,this.Nn&&this.Nn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.On&&_s(),this.On=!0,this.xn?this.error?this.Fn(e,this.error):this.Mn(t,this.result):new Ko((n,s)=>{this.Cn=(e=>{this.Mn(t,e).next(n,s)}),this.Nn=(t=>{this.Fn(e,t).next(n,s)})})}$n(){return new Promise((t,e)=>{this.next(t,e)})}kn(t){try{const e=t();return e instanceof Ko?e:Ko.resolve(e)}catch(t){return Ko.reject(t)}}Mn(t,e){return t?this.kn(()=>t(e)):Ko.resolve(e)}Fn(t,e){return t?this.kn(()=>t(e)):Ko.reject(e)}static resolve(t){return new Ko((e,n)=>{e(t)})}static reject(t){return new Ko((e,n)=>{n(t)})}static Ln(t){return new Ko((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static qn(t){let e=Ko.resolve(!1);for(const n of t)e=e.next(t=>t?Ko.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.Ln(n)}}class Ho{constructor(){this.Bn=new zo(t=>t.toString(),(t,e)=>t.isEqual(e)),this.Un=!1}set readTime(t){this.Kn=t}get readTime(){return this.Kn}Qn(t,e){this.Wn(),this.readTime=e,this.Bn.set(t.key,t)}jn(t,e){this.Wn(),e&&(this.readTime=e),this.Bn.set(t,null)}Gn(t,e){this.Wn();const n=this.Bn.get(e);return void 0!==n?Ko.resolve(n):this.zn(t,e)}getEntries(t,e){return this.Hn(t,e)}apply(t){return this.Wn(),this.Un=!0,this.Jn(t)}Wn(){}}const Xo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Wo{constructor(){this.Yn=[]}Xn(t){this.Yn.push(t)}Zn(){this.Yn.forEach(t=>t())}}class Yo{constructor(t,e,n){this.ts=t,this.es=e,this.ns=n}ss(t,e){return this.es.rs(t,e).next(n=>this.os(t,e,n))}os(t,e,n){return this.ts.Gn(t,e).next(t=>{for(const s of n)t=s.Vn(e,t);return t})}cs(t,e,n){let s=fi();return e.forEach((t,e)=>{for(const s of n)e=s.Vn(t,e);s=s.dt(t,e)}),s}us(t,e){return this.ts.getEntries(t,e).next(e=>this.hs(t,e))}hs(t,e){return this.es.ls(t,e).next(n=>{const s=this.cs(t,e,n);let i=li();return s.forEach((t,e)=>{e||(e=new uo(t,Ps.min())),i=i.dt(t,e)}),i})}_s(t,e,n){return function(t){return js.et(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.fs(t,e.path):vo(e)?this.ds(t,e,n):this.ws(t,e,n)}fs(t,e){return this.ss(t,new js(e)).next(t=>{let e=pi();return t instanceof ho&&(e=e.dt(t.key,t)),e})}ds(t,e,n){const s=e.collectionGroup;let i=pi();return this.ns.Es(t,s).next(r=>Ko.forEach(r,r=>{const o=function(t,e){return new lo(e,null,t.dn.slice(),t.filters.slice(),t.limit,t.wn,t.startAt,t.endAt)}(e,r.child(s));return this.ws(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.dt(t,e)})})}).next(()=>i))}ws(t,e,n){let s,i;return this.ts._s(t,e,n).next(n=>(s=n,this.es.Ts(t,e))).next(e=>(i=e,this.Is(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=s.get(n),r=Kr(e,i,i,t.Rn);s=r instanceof ho?s.dt(n,r):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{No(e,n)||(s=s.remove(t))}),s))}Is(t,e,n){let s=wi();for(const t of e)for(const e of t.mutations)e instanceof Qr&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.ts.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof ho&&(i=i.dt(t,e))}),i))}}class Qo{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.As=n,this.Rs=s}static Ps(t,e){let n=wi(),s=wi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Qo(t,e.fromCache,n,s)}}class Jo{constructor(t,e){this.previousValue=t,e&&(e.gs=(t=>this.Vs(t)),this.ys=(t=>e.ps(t)))}Vs(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ys&&this.ys(t),t}}Jo.bs=-1;class Zo{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ta{constructor(t,e,n=1e3,s=1.5,i=6e4){this.vs=t,this.Ss=e,this.Ds=n,this.Cs=s,this.Ns=i,this.xs=0,this.Os=null,this.Fs=Date.now(),this.reset()}reset(){this.xs=0}Ms(){this.xs=this.Ns}$s(t){this.cancel();const e=Math.floor(this.xs+this.ks()),n=Math.max(0,Date.now()-this.Fs),s=Math.max(0,e-n);s>0&&vs("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.xs} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Os=this.vs.Ls(this.Ss,s,()=>(this.Fs=Date.now(),t())),this.xs*=this.Cs,this.xs<this.Ds&&(this.xs=this.Ds),this.xs>this.Ns&&(this.xs=this.Ns)}qs(){null!==this.Os&&(this.Os.Bs(),this.Os=null)}cancel(){null!==this.Os&&(this.Os.cancel(),this.Os=null)}ks(){return(Math.random()-.5)*this.xs}}class ea{constructor(t,e,n){this.name=t,this.version=e,this.Us=n,12.2===ea.Ks(s())&&bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return vs("SimpleDb","Removing database:",t),aa(window.indexedDB.deleteDatabase(t)).$n()}static Qs(){if("undefined"==typeof indexedDB)return!1;if(ea.Ws())return!0;const t=s(),e=ea.Ks(t),n=0<e&&e<10,i=ea.js(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static Ws(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Gs)}static zs(t,e){return t.store(e)}static Ks(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static js(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Hs(){return this.db||(vs("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,e)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=(e=>{const n=e.target.result;t(n)}),n.onblocked=(()=>{e(new sa("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),n.onerror=(t=>{const n=t.target.error;"VersionError"===n.name?e(new xs(As.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):e(new sa(n))}),n.onupgradeneeded=(t=>{vs("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Us.createOrUpgrade(e,n.transaction,t.oldVersion,this.version).next(()=>{vs("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Js&&(this.db.onversionchange=(t=>this.Js(t))),this.db}Ys(t){this.Js=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n){const s="readonly"===t;for(;;){0;try{this.db=await this.Hs();const i=ra.open(this.db,s?"readonly":"readwrite",e),r=n(i).catch(t=>(i.abort(t),Ko.reject(t))).$n();return r.catch(()=>{}),await i.Xs,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(vs("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class na{constructor(t){this.Zs=t,this.ti=!1,this.ei=null}get xn(){return this.ti}get ni(){return this.ei}set cursor(t){this.Zs=t}done(){this.ti=!0}si(t){this.ei=t}delete(){return aa(this.Zs.delete())}}class sa extends xs{constructor(t){super(As.UNAVAILABLE,"IndexedDB transaction failed: "+t),this.name="IndexedDbTransactionError"}}function ia(t){return"IndexedDbTransactionError"===t.name}class ra{constructor(t){this.transaction=t,this.aborted=!1,this.ii=new Zo,this.transaction.oncomplete=(()=>{this.ii.resolve()}),this.transaction.onabort=(()=>{t.error?this.ii.reject(new sa(t.error)):this.ii.resolve()}),this.transaction.onerror=(t=>{const e=ua(t.target.error);this.ii.reject(new sa(e))})}static open(t,e,n){try{return new ra(t.transaction(n,e))}catch(t){throw new sa(t)}}get Xs(){return this.ii.promise}abort(t){t&&this.ii.reject(t),this.aborted||(vs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new oa(e)}}class oa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(vs("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(vs("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),aa(n)}add(t){return vs("SimpleDb","ADD",this.store.name,t,t),aa(this.store.add(t))}get(t){return aa(this.store.get(t)).next(e=>(void 0===e&&(e=null),vs("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return vs("SimpleDb","DELETE",this.store.name,t),aa(this.store.delete(t))}count(){return vs("SimpleDb","COUNT",this.store.name),aa(this.store.count())}ri(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.oi(n,(t,e)=>{s.push(e)}).next(()=>s)}ci(t,e){vs("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.ai=!1;const s=this.cursor(n);return this.oi(s,(t,e,n)=>n.delete())}ui(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.oi(s,e)}hi(t){const e=this.cursor({});return new Ko((n,s)=>{e.onerror=(t=>{const e=ua(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}oi(t,e){const n=[];return new Ko((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new na(i),o=e(i.primaryKey,i.value,r);if(o instanceof Ko){const t=o.catch(t=>(r.done(),Ko.reject(t)));n.push(t)}r.xn?s():null===r.ni?i.continue():i.continue(r.ni)})}).next(()=>Ko.Ln(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.ai?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function aa(t){return new Ko((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=ua(t.target.error);n(e)})})}let ha=!1;function ua(t){const e=ea.Ks(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new xs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ha||(ha=!0,setTimeout(()=>{throw t},0)),t}}return t}function ca(){return"undefined"!=typeof window?window:null}function la(){return"undefined"!=typeof document?document:null}class fa{constructor(t,e,n,s,i){this.li=t,this.Ss=e,this._i=n,this.op=s,this.fi=i,this.di=new Zo,this.then=this.di.promise.then.bind(this.di.promise),this.di.promise.catch(t=>{})}static wi(t,e,n,s,i){const r=Date.now()+n,o=new fa(t,e,r,s,i);return o.start(n),o}start(t){this.Ei=setTimeout(()=>this.Ti(),t)}Bs(){return this.Ti()}cancel(t){null!==this.Ei&&(this.clearTimeout(),this.di.reject(new xs(As.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Ti(){this.li.Ii(()=>null!==this.Ei?(this.clearTimeout(),this.op().then(t=>this.di.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Ei&&(this.fi(this),clearTimeout(this.Ei),this.Ei=null)}}class da{constructor(){this.mi=Promise.resolve(),this.Ai=[],this.Ri=!1,this.Pi=[],this.gi=null,this.Vi=!1,this.yi=[],this.pi=new ta(this,"async_queue_retry"),this.bi=(()=>{const t=la();t&&vs("AsyncQueue","Visibility state changed to  ",t.visibilityState),this.pi.qs()});const t=la();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bi)}get vi(){return this.Ri}Ii(t){this.enqueue(t)}Si(t){this.Di(),this.Ci(t)}Ni(){if(!this.Ri){this.Ri=!0;const t=la();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bi)}}enqueue(t){return this.Di(),this.Ri?new Promise(t=>{}):this.Ci(t)}xi(t){this.Ai.push(t),this.Ii(()=>this.Oi())}async Oi(){if(0!==this.Ai.length){try{await this.Ai[0](),this.Ai.shift(),this.pi.reset()}catch(t){if(!ia(t))throw t;vs("AsyncQueue","Operation failed with retryable error: "+t)}this.Ai.length>0&&this.pi.$s(()=>this.Oi())}}Ci(t){const e=this.mi.then(()=>(this.Vi=!0,t().catch(t=>{throw this.gi=t,this.Vi=!1,bs("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.Vi=!1,t))));return this.mi=e,e}Ls(t,e,n){this.Di(),this.yi.indexOf(t)>-1&&(e=0);const s=fa.wi(this,t,e,n,t=>this.Fi(t));return this.Pi.push(s),s}Di(){this.gi&&_s()}Mi(){}async $i(){let t;do{t=this.mi,await t}while(t!==this.mi)}ki(t){for(const e of this.Pi)if(e.Ss===t)return!0;return!1}Li(t){return this.$i().then(()=>{this.Pi.sort((t,e)=>t._i-e._i);for(const e of this.Pi)if(e.Bs(),"all"!==t&&e.Ss===t)break;return this.$i()})}qi(t){this.yi.push(t)}Fi(t){const e=this.Pi.indexOf(t);this.Pi.splice(e,1)}}function pa(t,e){if(bs("AsyncQueue",`${e}: ${t}`),ia(t))return new xs(As.UNAVAILABLE,`${e}: ${t}`);throw t}function ga([t,e],[n,s]){const i=Rs(t,n);return 0===i?Rs(e,s):i}class ma{constructor(t){this.Bi=t,this.buffer=new hi(ga),this.Ui=0}Ki(){return++this.Ui}Qi(t){const e=[t,this.Ki()];if(this.buffer.size<this.Bi)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();ga(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const wa={Wi:!1,ji:0,Gi:0,zi:0};class ya{constructor(t,e,n){this.Hi=t,this.Ji=e,this.Yi=n}static Xi(t){return new ya(t,ya.Zi,ya.tr)}}ya.er=-1,ya.nr=1048576,ya.sr=41943040,ya.Zi=10,ya.tr=1e3,ya.ir=new ya(ya.sr,ya.Zi,ya.tr),ya.rr=new ya(ya.er,0,0);class va{constructor(t,e){this.cr=t,this.li=e,this.ar=!1,this.ur=null}start(t){this.cr.params.Hi!==ya.er&&this.hr(t)}stop(){this.ur&&(this.ur.cancel(),this.ur=null)}get lr(){return null!==this.ur}hr(t){const e=this.ar?3e5:6e4;vs("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ur=this.li.Ls("lru_garbage_collection",e,async()=>{this.ur=null,this.ar=!0;try{await t._r(this.cr)}catch(t){ia(t)?vs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Vh(t)}await this.hr(t)})}}class ba{constructor(t,e){this.dr=t,this.params=e}wr(t,e){return this.dr.Er(t).next(t=>Math.floor(e/100*t))}Tr(t,e){if(0===e)return Ko.resolve(Jo.bs);const n=new ma(e);return this.dr.Le(t,t=>n.Qi(t.sequenceNumber)).next(()=>this.dr.Ir(t,t=>n.Qi(t))).next(()=>n.maxValue)}mr(t,e,n){return this.dr.mr(t,e,n)}Ar(t,e){return this.dr.Ar(t,e)}Rr(t,e){return this.params.Hi===ya.er?(vs("LruGarbageCollector","Garbage collection skipped; disabled"),Ko.resolve(wa)):this.Pr(t).next(n=>n<this.params.Hi?(vs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Hi),wa):this.gr(t,e))}Pr(t){return this.dr.Pr(t)}gr(e,n){let s,i,r,o,a,h,u;const c=Date.now();return this.wr(e,this.params.Ji).next(t=>(t>this.params.Yi?(vs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.Yi} from `+t),i=this.params.Yi):i=t,o=Date.now(),this.Tr(e,i))).next(t=>(s=t,a=Date.now(),this.mr(e,s,n))).next(t=>(r=t,h=Date.now(),this.Ar(e,s))).next(e=>(u=Date.now(),ys()<=t.LogLevel.DEBUG&&vs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-c}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${r} targets in `+(h-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-h)+"ms\n"+`Total Duration: ${u-c}ms`),Ko.resolve({Wi:!0,ji:i,Gi:r,zi:e})))}}function Ia(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=_a(e)),e=Ea(t.get(n),e);return _a(e)}function Ea(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function _a(t){return t+""}function Ta(t){const e=t.length;if(Ts(e>=2),2===e)return Ts(""===t.charAt(0)&&""===t.charAt(1)),Us.j();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&_s(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:_s()}n=e+2}return new Us(s)}class Na{constructor(t){this.Vr=t}}function Aa(t,e){if(e.document)return function(t,e,n){const s=lr(t,e.name),i=ar(e.updateTime),r=new io({mapValue:{fields:e.fields}});return new ho(s,i,r,{hasCommittedMutations:!!n})}(t.Vr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=js.nt(e.noDocument.path),n=ka(e.noDocument.readTime);return new uo(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=js.nt(e.unknownDocument.path),n=ka(e.unknownDocument.version);return new co(t,n)}return _s()}function xa(t,e,n){const s=Sa(n),i=e.key.path.M().U();if(e instanceof ho){const n=function(t,e){return{name:cr(t,e.key),fields:e.fn().mapValue.fields,updateTime:rr(t,e.version.D())}}(t.Vr,e),r=e.hasCommittedMutations;return new nh(null,null,n,r,s,i)}if(e instanceof uo){const t=e.key.path.U(),n=La(e.version),r=e.hasCommittedMutations;return new nh(null,new th(t,n),null,r,s,i)}if(e instanceof co){const t=e.key.path.U(),n=La(e.version);return new nh(new eh(t,n),null,null,!0,s,i)}return _s()}function Sa(t){const e=t.D();return[e.seconds,e.nanoseconds]}function Da(t){const e=new Vs(t[0],t[1]);return Ps.p(e)}function La(t){const e=t.D();return new Wa(e.seconds,e.nanoseconds)}function ka(t){const e=new Vs(t.seconds,t.nanoseconds);return Ps.p(e)}function Ra(t,e){const n=(e.baseMutations||[]).map(e=>yr(t.Vr,e)),s=e.mutations.map(e=>yr(t.Vr,e)),i=Vs.fromMillis(e.localWriteTimeMs);return new $o(e.batchId,i,n,s)}function Ca(t){const e=ka(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ka(t.lastLimboFreeSnapshotVersion):Ps.min();let s;var i;return void 0!==t.query.documents?(Ts(1===(i=t.query).documents.length),s=Io(po(dr(i.documents[0])))):s=Ir(t.query),new Zs(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Js.fromBase64String(t.resumeToken))}function Oa(t,e){const n=La(e.ht),s=La(e.lastLimboFreeSnapshotVersion);let i;i=Qs(e.target)?vr(t.Vr,e.target):br(t.Vr,e.target);const r=e.resumeToken.toBase64();return new ih(e.targetId,Ws(e.target),n,r,e.sequenceNumber,s,i)}class Va{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.ns=n,this.yr=s,this.pr={}}static br(t,e,n,s){Ts(""!==t.uid);const i=t.t()?t.uid:"";return new Va(i,e,n,s)}vr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ua(t).ui({index:Ja.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}Sr(t,e,n,s){const i=qa(t),r=Ua(t);return r.add({}).next(o=>{Ts("number"==typeof o);const a=new $o(o,e,n,s),h=function(t,e,n){const s=n.baseMutations.map(e=>wr(t.Vr,e)),i=n.mutations.map(e=>wr(t.Vr,e));return new Ja(e,n.batchId,n.Rn.toMillis(),s,i)}(this.serializer,this.userId,a),u=[];let c=new hi((t,e)=>Rs(t.K(),e.K()));for(const t of s){const e=Za.key(this.userId,t.key.path,o);c=c.add(t.key.path.M()),u.push(r.put(h)),u.push(i.put(e,Za.PLACEHOLDER))}return c.forEach(e=>{u.push(this.ns.Dr(t,e))}),t.Xn(()=>{this.pr[o]=a.keys()}),Ko.Ln(u).next(()=>a)})}Cr(t,e){return Ua(t).get(e).next(t=>t?(Ts(t.userId===this.userId),Ra(this.serializer,t)):null)}Nr(t,e){return this.pr[e]?Ko.resolve(this.pr[e]):this.Cr(t,e).next(t=>{if(t){const n=t.keys();return this.pr[e]=n,n}return null})}Or(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Ua(t).ui({index:Ja.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(Ts(e.batchId>=n),i=Ra(this.serializer,e)),s.done()}).next(()=>i)}Fr(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ua(t).ui({index:Ja.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}Mr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ua(t).ri(Ja.userMutationsIndex,e).next(t=>t.map(t=>Ra(this.serializer,t)))}rs(t,e){const n=Za.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return qa(t).ui({range:s},(n,s,r)=>{const[o,a,h]=n,u=Ta(a);if(o===this.userId&&e.path.isEqual(u))return Ua(t).get(h).next(t=>{if(!t)throw _s();Ts(t.userId===this.userId),i.push(Ra(this.serializer,t))});r.done()}).next(()=>i)}ls(t,e){let n=new hi(Rs);const s=[];return e.forEach(e=>{const i=Za.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=qa(t).ui({range:r},(t,s,i)=>{const[r,o,a]=t,h=Ta(o);r===this.userId&&e.path.isEqual(h)?n=n.add(a):i.done()});s.push(o)}),Ko.Ln(s).next(()=>this.$r(t,n))}Ts(t,e){const n=e.path,s=n.length+1,i=Za.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new hi(Rs);return qa(t).ui({range:r},(t,e,i)=>{const[r,a,h]=t,u=Ta(a);r===this.userId&&n.q(u)?u.length===s&&(o=o.add(h)):i.done()}).next(()=>this.$r(t,o))}$r(t,e){const n=[],s=[];return e.forEach(e=>{s.push(Ua(t).get(e).next(t=>{if(null===t)throw _s();Ts(t.userId===this.userId),n.push(Ra(this.serializer,t))}))}),Ko.Ln(s).next(()=>n)}kr(t,e){return Ma(t.Lr,this.userId,e).next(n=>(t.Xn(()=>{this.qr(e.batchId)}),Ko.forEach(n,e=>this.yr.Br(t,e))))}qr(t){delete this.pr[t]}Ur(t){return this.vr(t).next(e=>{if(!e)return Ko.resolve();const n=IDBKeyRange.lowerBound(Za.prefixForUser(this.userId)),s=[];return qa(t).ui({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=Ta(t[1]);s.push(e)}else n.done()}).next(()=>{Ts(0===s.length)})})}Kr(t,e){return Pa(t,this.userId,e)}Qr(t){return Fa(t).get(this.userId).next(t=>t||new Qa(this.userId,-1,""))}}function Pa(t,e,n){const s=Za.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return qa(t).ui({range:r,ai:!0},(t,n,s)=>{const[r,a,h]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function Ma(t,e,n){const s=t.store(Ja.store),i=t.store(Za.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=s.ui({range:o},(t,e,n)=>(a++,n.delete()));r.push(h.next(()=>{Ts(1===a)}));const u=[];for(const t of n.mutations){const s=Za.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return Ko.Ln(r).next(()=>u)}function Ua(t){return bh.zs(t,Ja.store)}function qa(t){return bh.zs(t,Za.store)}function Fa(t){return bh.zs(t,Qa.store)}class ja{constructor(t,e){this.serializer=t,this.ns=e}Qn(t,e,n){return $a(t).put(Ba(e),n)}jn(t,e){const n=$a(t),s=Ba(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Wr(t,n)))}Gn(t,e){return $a(t).get(Ba(e)).next(t=>this.jr(t))}Gr(t,e){return $a(t).get(Ba(e)).next(t=>{const e=this.jr(t);return e?{zr:e,size:za(t)}:null})}getEntries(t,e){let n=fi();return this.Hr(t,e,(t,e)=>{const s=this.jr(e);n=n.dt(t,s)}).next(()=>n)}Jr(t,e){let n=fi(),s=new ri(js.N);return this.Hr(t,e,(t,e)=>{const i=this.jr(e);i?(n=n.dt(t,i),s=s.dt(t,za(e))):(n=n.dt(t,null),s=s.dt(t,0))}).next(()=>({Yr:n,Xr:s}))}Hr(t,e,n){if(e.L())return Ko.resolve();const s=IDBKeyRange.bound(e.first().path.U(),e.last().path.U()),i=e.Rt();let r=i.vt();return $a(t).ui({range:s},(t,e,s)=>{const o=js.nt(t);for(;r&&js.N(r,o)<0;)n(r,null),r=i.vt();r&&r.isEqual(o)&&(n(r,e),r=i.St()?i.vt():null),r?s.si(r.path.U()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.St()?i.vt():null})}_s(t,e,n){let s=pi();const i=e.path.length+1,r={};if(n.isEqual(Ps.min())){const t=e.path.U();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.U(),s=Sa(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=nh.collectionReadTimeIndex}return $a(t).ui(r,(t,n,r)=>{if(t.length!==i)return;const o=Aa(this.serializer,n);e.path.q(o.key.path)?o instanceof ho&&No(e,o)&&(s=s.dt(o.key,o)):r.done()}).next(()=>s)}Zr(t,e){let n=li(),s=Sa(e);const i=$a(t),r=IDBKeyRange.lowerBound(s,!0);return i.ui({index:nh.readTimeIndex,range:r},(t,e)=>{const i=Aa(this.serializer,e);n=n.dt(i.key,i),s=e.readTime}).next(()=>({eo:n,readTime:Da(s)}))}no(t){const e=$a(t);let n=Ps.min();return e.ui({index:nh.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Da(e.readTime)),s.done()}).next(()=>n)}so(t){return new ja.io(this,!!t&&t.ro)}oo(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return Ga(t).get(sh.key).next(t=>(Ts(!!t),t))}Wr(t,e){return Ga(t).put(sh.key,e)}jr(t){if(t){const e=Aa(this.serializer,t);return e instanceof uo&&e.version.isEqual(Ps.min())?null:e}return null}}function Ga(t){return bh.zs(t,sh.store)}function $a(t){return bh.zs(t,nh.store)}function Ba(t){return t.path.U()}function za(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _s();e=t.noDocument}return JSON.stringify(e).length}ja.io=class extends Ho{constructor(t,e){super(),this.co=t,this.ro=e,this.ao=new zo(t=>t.toString(),(t,e)=>t.isEqual(e))}Jn(t){const e=[];let n=0,s=new hi((t,e)=>Rs(t.K(),e.K()));return this.Bn.forEach((i,r)=>{const o=this.ao.get(i);if(r){const a=xa(this.co.serializer,r,this.readTime);s=s.add(i.path.M());const h=za(a);n+=h-o,e.push(this.co.Qn(t,i,a))}else if(n-=o,this.ro){const n=xa(this.co.serializer,new uo(i,Ps.min()),this.readTime);e.push(this.co.Qn(t,i,n))}else e.push(this.co.jn(t,i))}),s.forEach(n=>{e.push(this.co.ns.Dr(t,n))}),e.push(this.co.updateMetadata(t,n)),Ko.Ln(e)}zn(t,e){return this.co.Gr(t,e).next(t=>null===t?(this.ao.set(e,0),null):(this.ao.set(e,t.size),t.zr))}Hn(t,e){return this.co.Jr(t,e).next(({Yr:t,Xr:e})=>(e.forEach((t,e)=>{this.ao.set(t,e)}),t))}};class Ka{constructor(){this.uo=new Ha}Dr(t,e){return this.uo.add(e),Ko.resolve()}Es(t,e){return Ko.resolve(this.uo.getEntries(e))}}class Ha{constructor(){this.index={}}add(t){const e=t.k(),n=t.M(),s=this.index[e]||new hi(Us.N),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.k(),n=t.M(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new hi(Us.N)).U()}}class Xa{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,s){Ts(n<s&&n>=0&&s<=10);const i=new ra(e);n<1&&s>=1&&(function(t){t.createObjectStore(Ya.store)}(t),function(t){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath}),t.createObjectStore(Ja.store,{keyPath:Ja.keyPath,autoIncrement:!0}).createIndex(Ja.userMutationsIndex,Ja.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Za.store)}(t),hh(t),function(t){t.createObjectStore(nh.store)}(t));let r=Ko.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(rh.store),t.deleteObjectStore(ih.store),t.deleteObjectStore(oh.store)}(t),hh(t)),r=r.next(()=>(function(t){const e=i.store(oh.store),n=new oh(0,0,Ps.min().D(),0);return e.put(oh.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(Ja.store).ri().next(n=>{t.deleteObjectStore(Ja.store),t.createObjectStore(Ja.store,{keyPath:Ja.keyPath,autoIncrement:!0}).createIndex(Ja.userMutationsIndex,Ja.userMutationsKeyPath,{unique:!0});const s=e.store(Ja.store),i=n.map(t=>s.put(t));return Ko.Ln(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(uh.store,{keyPath:uh.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.removeAcknowledgedMutations(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(sh.store)})(t),this.addDocumentGlobal(i)))),n<7&&s>=7&&(r=r.next(()=>this.ensureSequenceNumbers(i))),n<8&&s>=8&&(r=r.next(()=>this.createCollectionParentIndex(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(nh.store);e.createIndex(nh.readTimeIndex,nh.readTimeIndexPath,{unique:!1}),e.createIndex(nh.collectionReadTimeIndex,nh.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.rewriteCanonicalIds(i))),r}addDocumentGlobal(t){let e=0;return t.store(nh.store).ui((t,n)=>{e+=za(n)}).next(()=>{const n=new sh(e);return t.store(sh.store).put(sh.key,n)})}removeAcknowledgedMutations(t){const e=t.store(Qa.store),n=t.store(Ja.store);return e.ri().next(e=>Ko.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ri(Ja.userMutationsIndex,s).next(n=>Ko.forEach(n,n=>{Ts(n.userId===e.userId);const s=Ra(this.serializer,n);return Ma(t,e.userId,s).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(rh.store),n=t.store(nh.store);return t.store(oh.store).get(oh.key).next(t=>{const s=[];return n.ui((n,i)=>{const r=new Us(n),o=function(t){return[0,Ia(r)]}();s.push(e.get(o).next(n=>n?Ko.resolve():(n=>e.put(new rh(0,Ia(n),t.highestListenSequenceNumber)))(r)))}).next(()=>Ko.Ln(s))})}createCollectionParentIndex(t,e){t.createObjectStore(ah.store,{keyPath:ah.keyPath});const n=e.store(ah.store),s=new Ha,i=t=>{if(s.add(t)){const e=t.k(),s=t.M();return n.put({collectionId:e,parent:Ia(s)})}};return e.store(nh.store).ui({ai:!0},(t,e)=>{const n=new Us(t);return i(n.M())}).next(()=>e.store(Za.store).ui({ai:!0},([t,e,n],s)=>{const r=Ta(e);return i(r.M())}))}rewriteCanonicalIds(t){const e=t.store(ih.store);return e.ui((t,n)=>{const s=Ca(n),i=Oa(this.serializer,s);return e.put(i)})}}class Wa{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Ya{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Ya.store="owner",Ya.key="owner";class Qa{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Qa.store="mutationQueues",Qa.keyPath="userId";class Ja{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}Ja.store="mutations",Ja.keyPath="batchId",Ja.userMutationsIndex="userMutationsIndex",Ja.userMutationsKeyPath=["userId","batchId"];class Za{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Ia(e)]}static key(t,e,n){return[t,Ia(e),n]}}Za.store="documentMutations",Za.PLACEHOLDER=new Za;class th{constructor(t,e){this.path=t,this.readTime=e}}class eh{constructor(t,e){this.path=t,this.version=e}}class nh{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}nh.store="remoteDocuments",nh.readTimeIndex="readTimeIndex",nh.readTimeIndexPath="readTime",nh.collectionReadTimeIndex="collectionReadTimeIndex",nh.collectionReadTimeIndexPath=["parentPath","readTime"];class sh{constructor(t){this.byteSize=t}}sh.store="remoteDocumentGlobal",sh.key="remoteDocumentGlobalKey";class ih{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}ih.store="targets",ih.keyPath="targetId",ih.queryTargetsIndexName="queryTargetsIndex",ih.queryTargetsKeyPath=["canonicalId","targetId"];class rh{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}rh.store="targetDocuments",rh.keyPath=["targetId","path"],rh.documentTargetsIndex="documentTargetsIndex",rh.documentTargetsKeyPath=["path","targetId"];class oh{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}oh.key="targetGlobalKey",oh.store="targetGlobal";class ah{constructor(t,e){this.collectionId=t,this.parent=e}}function hh(t){t.createObjectStore(rh.store,{keyPath:rh.keyPath}).createIndex(rh.documentTargetsIndex,rh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ih.store,{keyPath:ih.keyPath}).createIndex(ih.queryTargetsIndexName,ih.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(oh.store)}ah.store="collectionParents",ah.keyPath=["collectionId","parent"];class uh{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}uh.store="clientMetadata",uh.keyPath="clientId";const ch=[...[...[...[Qa.store,Ja.store,Za.store,nh.store,ih.store,Ya.store,oh.store,rh.store],uh.store],sh.store],ah.store];class lh{constructor(){this.ho=new Ha}Dr(t,e){if(!this.ho.has(e)){const n=e.k(),s=e.M();t.Xn(()=>{this.ho.add(e)});const i={collectionId:n,parent:Ia(s)};return fh(t).put(i)}return Ko.resolve()}Es(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Os(e),""],!1,!0);return fh(t).ri(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(Ta(s.parent))}return n})}}function fh(t){return bh.zs(t,ah.store)}class dh{constructor(t){this.lo=t}next(){return this.lo+=2,this.lo}static _o(){return new dh(0)}static fo(){return new dh(-1)}}class ph{constructor(t,e){this.yr=t,this.serializer=e}do(t){return this.wo(t).next(e=>{const n=new dh(e.highestTargetId);return e.highestTargetId=n.next(),this.Eo(t,e).next(()=>e.highestTargetId)})}To(t){return this.wo(t).next(t=>Ps.p(new Vs(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Io(t){return this.wo(t).next(t=>t.highestListenSequenceNumber)}mo(t,e,n){return this.wo(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.D()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Eo(t,s)))}Ao(t,e){return this.Ro(t,e).next(()=>this.wo(t).next(n=>(n.targetCount+=1,this.Po(e,n),this.Eo(t,n))))}Vo(t,e){return this.Ro(t,e)}yo(t,e){return this.po(t,e.targetId).next(()=>gh(t).delete(e.targetId)).next(()=>this.wo(t)).next(e=>(Ts(e.targetCount>0),e.targetCount-=1,this.Eo(t,e)))}mr(t,e,n){let s=0;const i=[];return gh(t).ui((r,o)=>{const a=Ca(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.yo(t,a)))}).next(()=>Ko.Ln(i)).next(()=>s)}Le(t,e){return gh(t).ui((t,n)=>{const s=Ca(n);e(s)})}wo(t){return mh(t).get(oh.key).next(t=>(Ts(null!==t),t))}Eo(t,e){return mh(t).put(oh.key,e)}Ro(t,e){return gh(t).put(Oa(this.serializer,e))}Po(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}bo(t){return this.wo(t).next(t=>t.targetCount)}vo(t,e){const n=Ws(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return gh(t).ui({range:s,index:ih.queryTargetsIndexName},(t,n,s)=>{const r=Ca(n);Ys(e,r.target)&&(i=r,s.done())}).next(()=>i)}So(t,e,n){const s=[],i=wh(t);return e.forEach(e=>{const r=Ia(e.path);s.push(i.put(new rh(n,r))),s.push(this.yr.Do(t,n,e))}),Ko.Ln(s)}Co(t,e,n){const s=wh(t);return Ko.forEach(e,e=>{const i=Ia(e.path);return Ko.Ln([s.delete([n,i]),this.yr.No(t,n,e)])})}po(t,e){const n=wh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}xo(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=wh(t);let i=wi();return s.ui({range:n,ai:!0},(t,e,n)=>{const s=Ta(t[1]),r=new js(s);i=i.add(r)}).next(()=>i)}Kr(t,e){const n=Ia(e.path),s=IDBKeyRange.bound([n],[Os(n)],!1,!0);let i=0;return wh(t).ui({index:rh.documentTargetsIndex,ai:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}Je(t,e){return gh(t).get(e).next(t=>t?Ca(t):null)}}function gh(t){return bh.zs(t,ih.store)}function mh(t){return bh.zs(t,oh.store)}function wh(t){return bh.zs(t,rh.store)}const yh="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class vh extends Wo{constructor(t,e){super(),this.Lr=t,this.Oo=e}}class bh{constructor(t,e,n,s,i,r,o,a,h,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.vs=i,this.window=r,this.document=o,this.Fo=h,this.Mo=u,this.$o=null,this.ko=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Lo=null,this.inForeground=!1,this.qo=null,this.Bo=null,this.Uo=Number.NEGATIVE_INFINITY,this.Ko=(t=>Promise.resolve()),!bh.Qs())throw new xs(As.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.yr=new _h(this,s),this.Qo=e+"main",this.serializer=new Na(a),this.Wo=new ea(this.Qo,10,new Xa(this.serializer)),this.jo=new ph(this.yr,this.serializer),this.ns=new lh,this.ts=new ja(this.serializer,this.ns),this.window&&this.window.localStorage?this.Go=this.window.localStorage:(this.Go=null,!1===u&&bs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static zs(t,e){if(t instanceof vh)return ea.zs(t.Lr,e);throw _s()}start(){return this.zo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new xs(As.FAILED_PRECONDITION,yh);return this.Ho(),this.Jo(),this.Yo(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.jo.Io(t))}).then(t=>{this.$o=new Jo(t,this.Fo)}).then(()=>{this.ko=!0}).catch(t=>(this.Wo&&this.Wo.close(),Promise.reject(t)))}Xo(t){return this.Ko=(async e=>{if(this.lr)return t(e)}),t(this.isPrimary)}Zo(t){this.Wo.Ys(async e=>{null===e.newVersion&&await t()})}tc(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.vs.Ii(async()=>{this.lr&&await this.zo()}))}zo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Eh(t).put(new uh(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.ec(t).next(t=>{t||(this.isPrimary=!1,this.vs.xi(()=>this.Ko(!1)))})}).next(()=>this.nc(t)).next(e=>this.isPrimary&&!e?this.sc(t).next(()=>!1):!!e&&this.ic(t).next(()=>!0))).catch(t=>{if(ia(t))return vs("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return vs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.vs.xi(()=>this.Ko(t)),this.isPrimary=t})}ec(t){return Ih(t).get(Ya.key).next(t=>Ko.resolve(this.rc(t)))}oc(t){return Eh(t).delete(this.clientId)}async cc(){if(this.isPrimary&&!this.ac(this.Uo,18e5)){this.Uo=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=bh.zs(t,uh.store);return e.ri().next(t=>{const n=this.uc(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return Ko.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Go)for(const e of t)this.Go.removeItem(this.hc(e.clientId))}}Yo(){this.Bo=this.vs.Ls("client_metadata_refresh",4e3,()=>this.zo().then(()=>this.cc()).then(()=>this.Yo()))}rc(t){return!!t&&t.ownerId===this.clientId}nc(t){return this.Mo?Ko.resolve(!0):Ih(t).get(Ya.key).next(e=>{if(null!==e&&this.ac(e.leaseTimestampMs,5e3)&&!this.lc(e.ownerId)){if(this.rc(e)&&this.networkEnabled)return!0;if(!this.rc(e)){if(!e.allowTabSynchronization)throw new xs(As.FAILED_PRECONDITION,yh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Eh(t).ri().next(t=>void 0===this.uc(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&vs("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async _c(){this.ko=!1,this.fc(),this.Bo&&(this.Bo.cancel(),this.Bo=null),this.dc(),this.wc(),await this.Wo.runTransaction("readwrite",[Ya.store,uh.store],t=>{const e=new vh(t,Jo.bs);return this.sc(e).next(()=>this.oc(e))}),this.Wo.close(),this.Ec()}uc(t,e){return t.filter(t=>this.ac(t.updateTimeMs,e)&&!this.lc(t.clientId))}Tc(){return this.runTransaction("getActiveClients","readonly",t=>Eh(t).ri().next(t=>this.uc(t,18e5).map(t=>t.clientId)))}get lr(){return this.ko}Ic(t){return Va.br(t,this.serializer,this.ns,this.yr)}mc(){return this.jo}Ac(){return this.ts}Rc(){return this.ns}runTransaction(t,e,n){vs("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.Wo.runTransaction(s,ch,s=>(i=new vh(s,this.$o?this.$o.next():Jo.bs),"readwrite-primary"===e?this.ec(i).next(t=>!!t||this.nc(i)).next(e=>{if(!e)throw bs(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.vs.xi(()=>this.Ko(!1)),new xs(As.FAILED_PRECONDITION,Xo);return n(i)}).next(t=>this.ic(i).next(()=>t)):this.Pc(i).next(()=>n(i)))).then(t=>(i.Zn(),t))}Pc(t){return Ih(t).get(Ya.key).next(t=>{if(null!==t&&this.ac(t.leaseTimestampMs,5e3)&&!this.lc(t.ownerId)&&!this.rc(t)&&!(this.Mo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new xs(As.FAILED_PRECONDITION,yh)})}ic(t){const e=new Ya(this.clientId,this.allowTabSynchronization,Date.now());return Ih(t).put(Ya.key,e)}static Qs(){return ea.Qs()}sc(t){const e=Ih(t);return e.get(Ya.key).next(t=>this.rc(t)?(vs("IndexedDbPersistence","Releasing primary lease."),e.delete(Ya.key)):Ko.resolve())}ac(t,e){const n=Date.now();return!(t<n-e||t>n&&(bs(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ho(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qo=(()=>{this.vs.Ii(()=>(this.inForeground="visible"===this.document.visibilityState,this.zo()))}),this.document.addEventListener("visibilitychange",this.qo),this.inForeground="visible"===this.document.visibilityState)}dc(){this.qo&&(this.document.removeEventListener("visibilitychange",this.qo),this.qo=null)}Jo(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Lo=(()=>{this.fc(),this.vs.Ii(()=>this._c())}),this.window.addEventListener("unload",this.Lo))}wc(){this.Lo&&(this.window.removeEventListener("unload",this.Lo),this.Lo=null)}lc(t){var e;try{const n=null!==(null===(e=this.Go)||void 0===e?void 0:e.getItem(this.hc(t)));return vs("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}fc(){if(this.Go)try{this.Go.setItem(this.hc(this.clientId),String(Date.now()))}catch(t){bs("Failed to set zombie client id.",t)}}Ec(){if(this.Go)try{this.Go.removeItem(this.hc(this.clientId))}catch(t){}}hc(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Ih(t){return bh.zs(t,Ya.store)}function Eh(t){return bh.zs(t,uh.store)}class _h{constructor(t,e){this.db=t,this.cr=new ba(this,e)}Er(t){const e=this.gc(t);return this.db.mc().bo(t).next(t=>e.next(e=>t+e))}gc(t){let e=0;return this.Ir(t,t=>{e++}).next(()=>e)}Le(t,e){return this.db.mc().Le(t,e)}Ir(t,e){return this.Vc(t,(t,n)=>e(n))}Do(t,e,n){return Th(t,n)}No(t,e,n){return Th(t,n)}mr(t,e,n){return this.db.mc().mr(t,e,n)}Br(t,e){return Th(t,e)}yc(t,e){return function(t,e){let n=!1;return Fa(t).hi(s=>Pa(t,s,e).next(t=>(t&&(n=!0),Ko.resolve(!t)))).next(()=>n)}(t,e)}Ar(t,e){const n=this.db.Ac().so(),s=[];let i=0;return this.Vc(t,(r,o)=>{if(o<=e){const e=this.yc(t,r).next(e=>{if(!e)return i++,n.Gn(t,r).next(()=>(n.jn(r),wh(t).delete([0,Ia(r.path)])))});s.push(e)}}).next(()=>Ko.Ln(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.lt(t.Oo);return this.db.mc().Vo(t,n)}bc(t,e){return Th(t,e)}Vc(t,e){const n=wh(t);let s,i=Jo.bs;return n.ui({index:rh.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==Jo.bs&&e(new js(Ta(s)),i),i=o,s=r):i=Jo.bs}).next(()=>{i!==Jo.bs&&e(new js(Ta(s)),i)})}Pr(t){return this.db.Ac().oo(t)}}function Th(t,e){return wh(t).put(function(t,e){return new rh(0,Ia(t.path),e)}(e,t.Oo))}function Nh(t,e){let n=t.projectId;return t.it||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}async function Ah(t){if(!ea.Qs())return Promise.resolve();const e=t+"main";await ea.delete(e)}class xh{constructor(t,e,n){this.persistence=t,this.vc=e,this.Sc=new ri(Rs),this.Dc=new zo(t=>Ws(t),Ys),this.Cc=Ps.min(),this.es=t.Ic(n),this.Nc=t.Ac(),this.jo=t.mc(),this.xc=new Yo(this.Nc,this.es,this.persistence.Rc()),this.vc.Oc(this.xc)}_r(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Rr(e,this.Sc))}}async function Sh(t,e){const n=Ns(t);let s=n.es,i=n.xc;const r=await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.es.Mr(t).next(o=>(r=o,s=n.persistence.Ic(e),i=new Yo(n.Nc,s,n.persistence.Rc()),s.Mr(t))).next(e=>{const n=[],s=[];let o=wi();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.us(t,o).next(t=>({Fc:t,Mc:n,$c:s}))})});return n.es=s,n.xc=i,n.vc.Oc(n.xc),r}function Dh(t){const e=Ns(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.jo.To(t))}function Lh(t,e){const n=Ns(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.es.Or(t,e)))}function kh(t,e){const n=Ns(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.jo.vo(t,e).next(i=>i?(s=i,Ko.resolve(s)):n.jo.do(t).next(i=>(s=new Zs(e,i,0,t.Oo),n.jo.Ao(t,s).next(()=>s))))}).then(t=>{const s=n.Sc.get(t.targetId);return(null===s||t.ht.v(s.ht)>0)&&(n.Sc=n.Sc.dt(t.targetId,t),n.Dc.set(e,t.targetId)),t})}async function Rh(t,e,n){const s=Ns(t),i=s.Sc.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,t=>s.persistence.yr.removeTarget(t,i))}catch(t){if(!ia(t))throw t;vs("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Sc=s.Sc.remove(e),s.Dc.delete(i.target)}function Ch(t,e,n){const s=Ns(t);let i=Ps.min(),r=wi();return s.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const s=Ns(t),i=s.Dc.get(n);return void 0!==i?Ko.resolve(s.Sc.get(i)):s.jo.vo(e,n)})(s,t,Io(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.jo.xo(t,e.targetId).next(t=>{r=t})}).next(()=>s.vc._s(t,e,n?i:Ps.min(),n?r:wi())).next(t=>({documents:t,kc:r})))}function Oh(t,e){const n=Ns(t),s=Ns(n.jo),i=n.Sc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.Je(t,e).next(t=>t?t.target:null))}async function Vh(t){if(t.code!==As.FAILED_PRECONDITION||t.message!==Xo)throw t;vs("LocalStore","Unexpectedly lost primary lease")}class Ph{constructor(t,e,n,s,i,r){this.vs=t,this.Lc=n,this.qc=s,this.Bc=i,this.listener=r,this.state=0,this.Uc=0,this.Kc=null,this.stream=null,this.pi=new ta(t,e)}Qc(){return 1===this.state||2===this.state||4===this.state}Wc(){return 2===this.state}start(){3!==this.state?this.auth():this.jc()}async stop(){this.Qc()&&await this.close(0)}Gc(){this.state=0,this.pi.reset()}zc(){this.Wc()&&null===this.Kc&&(this.Kc=this.vs.Ls(this.Lc,6e4,()=>this.Hc()))}Jc(t){this.Yc(),this.stream.send(t)}async Hc(){if(this.Wc())return this.close(0)}Yc(){this.Kc&&(this.Kc.cancel(),this.Kc=null)}async close(t,e){this.Yc(),this.pi.cancel(),this.Uc++,3!==t?this.pi.reset():e&&e.code===As.RESOURCE_EXHAUSTED?(bs(e.toString()),bs("Using maximum backoff delay to prevent overloading the backend."),this.pi.Ms()):e&&e.code===As.UNAUTHENTICATED&&this.Bc.A(),null!==this.stream&&(this.Xc(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Zc(e)}Xc(){}auth(){this.state=1;const t=this.ta(this.Uc),e=this.Uc;this.Bc.getToken().then(t=>{this.Uc===e&&this.ea(t)},e=>{t(()=>{const t=new xs(As.UNKNOWN,"Fetching auth token failed: "+e.message);return this.na(t)})})}ea(t){const e=this.ta(this.Uc);this.stream=this.sa(t),this.stream.ia(()=>{e(()=>(this.state=2,this.listener.ia()))}),this.stream.Zc(t=>{e(()=>this.na(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}jc(){this.state=4,this.pi.$s(async()=>{this.state=0,this.start()})}na(t){return vs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}ta(t){return e=>{this.vs.Ii(()=>this.Uc===t?e():(vs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Mh extends Ph{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.serializer=s}sa(t){return this.qc.ra("Listen",t)}onMessage(t){this.pi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_s()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.Ye?(Ts(void 0===e||"string"==typeof e),Js.fromBase64String(e||"")):(Ts(void 0===e||e instanceof Uint8Array),Js.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?As.UNKNOWN:ii(t.code);return new xs(e,t.message||"")}(o);n=new xi(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=lr(t,s.document.name),r=ar(s.document.updateTime),o=new io({mapValue:{fields:s.document.fields}}),a=new ho(i,r,o,{}),h=s.targetIds||[],u=s.removedTargetIds||[];n=new Ni(h,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=lr(t,s.document),r=s.readTime?ar(s.readTime):Ps.min(),o=new uo(i,r),a=s.removedTargetIds||[];n=new Ni([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=lr(t,s.document),r=s.removedTargetIds||[];n=new Ni([],r,i,null)}else{if(!("filter"in e))return _s();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new ti(s),r=t.targetId;n=new Ai(r,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Ps.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Ps.min():e.readTime?ar(e.readTime):Ps.min()}(t);return this.listener.oa(e,n)}ca(t){const e={};e.database=pr(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;return(n=Qs(s)?{documents:vr(t,s)}:{query:br(t,s)}).targetId=e.targetId,e.resumeToken.ct()>0&&(n.resumeToken=or(t,e.resumeToken)),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _s()}}(0,e.ut);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Jc(e)}aa(t){const e={};e.database=pr(this.serializer),e.removeTarget=t,this.Jc(e)}}class Uh extends Ph{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.serializer=s,this.ua=!1}get ha(){return this.ua}start(){this.ua=!1,this.lastStreamToken=void 0,super.start()}Xc(){this.ua&&this.la([])}sa(t){return this.qc.ra("Write",t)}onMessage(t){if(Ts(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ua){this.pi.reset();const e=function(t,e){return t&&t.length>0?(Ts(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?ar(t.updateTime):ar(e);n.isEqual(Ps.min())&&(n=ar(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new jr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=ar(t.commitTime);return this.listener._a(n,e)}return Ts(!t.writeResults||0===t.writeResults.length),this.ua=!0,this.listener.fa()}da(){const t={};t.database=pr(this.serializer),this.Jc(t)}la(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>wr(this.serializer,t))};this.Jc(e)}}class qh extends class{}{constructor(t,e,n){super(),this.credentials=t,this.qc=e,this.serializer=n,this.wa=!1}Ea(){if(this.wa)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.")}Ta(t,e,n){return this.Ea(),this.credentials.getToken().then(s=>this.qc.Ta(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.A(),t})}Ia(t,e,n){return this.Ea(),this.credentials.getToken().then(s=>this.qc.Ia(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.A(),t})}terminate(){this.wa=!1}}function Fh(t,e,n){return new qh(t,e,n)}class jh{constructor(t,e){this.li=t,this.ma=e,this.state="Unknown",this.Aa=0,this.Ra=null,this.Pa=!0}ga(){0===this.Aa&&(this.Va("Unknown"),this.Ra=this.li.Ls("online_state_timeout",1e4,()=>(this.Ra=null,this.ya("Backend didn't respond within 10 seconds."),this.Va("Offline"),Promise.resolve())))}pa(t){"Online"===this.state?this.Va("Unknown"):(this.Aa++,this.Aa>=1&&(this.ba(),this.ya("Connection failed 1 times. Most recent error: "+t.toString()),this.Va("Offline")))}set(t){this.ba(),this.Aa=0,"Online"===t&&(this.Pa=!1),this.Va(t)}Va(t){t!==this.state&&(this.state=t,this.ma(t))}ya(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Pa?(bs(e),this.Pa=!1):vs("OnlineStateTracker",e)}ba(){null!==this.Ra&&(this.Ra.cancel(),this.Ra=null)}}class Gh{constructor(t,e,n,s,i){this.va=t,this.Sa=e,this.li=n,this.Da={},this.Ca=[],this.Na=new Map,this.xa=new Set,this.Oa=[],this.Fa=i,this.Fa.Ma(t=>{n.Ii(async()=>{Qh(this)&&(vs("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ns(t);e.xa.add(4),await Bh(e),e.$a.set("Unknown"),e.xa.delete(4),await $h(e)}(this))})}),this.$a=new jh(n,s)}}async function $h(t){if(Qh(t))for(const e of t.Oa)await e(!0)}async function Bh(t){for(const e of t.Oa)await e(!1)}function zh(t,e){const n=Ns(t);n.Na.has(e.targetId)||(n.Na.set(e.targetId,e),Yh(n)?Wh(n):au(n).Wc()&&Hh(n,e))}function Kh(t,e){const n=Ns(t),s=au(n);n.Na.delete(e),s.Wc()&&Xh(n,e),0===n.Na.size&&(s.Wc()?s.zc():Qh(n)&&n.$a.set("Unknown"))}function Hh(t,e){t.ka.be(e.targetId),au(t).ca(e)}function Xh(t,e){t.ka.be(e),au(t).aa(e)}function Wh(t){t.ka=new Di({He:e=>t.Da.He(e),Je:e=>t.Na.get(e)||null}),au(t).start(),t.$a.ga()}function Yh(t){return Qh(t)&&!au(t).Qc()&&t.Na.size>0}function Qh(t){return 0===Ns(t).xa.size}function Jh(t){t.ka=void 0}async function Zh(t,e,n){if(!ia(e))throw e;t.xa.add(1),await Bh(t),t.$a.set("Offline"),n||(n=(()=>Dh(t.va))),t.li.xi(async()=>{vs("RemoteStore","Retrying IndexedDB access"),await n(),t.xa.delete(1),await $h(t)})}function tu(t,e){return e().catch(n=>Zh(t,n,e))}async function eu(t){const e=Ns(t),n=hu(e);let s=e.Ca.length>0?e.Ca[e.Ca.length-1].batchId:-1;for(;nu(e);)try{const i=await Lh(e.va,s);if(null===i){0===e.Ca.length&&n.zc();break}s=i.batchId,su(e,i)}catch(t){await Zh(e,t)}iu(e)&&ru(e)}function nu(t){return Qh(t)&&t.Ca.length<10}function su(t,e){t.Ca.push(e);const n=hu(t);n.Wc()&&n.ha&&n.la(e.mutations)}function iu(t){return Qh(t)&&!hu(t).Qc()&&t.Ca.length>0}function ru(t){hu(t).start()}async function ou(t,e){const n=Ns(t);e?(n.xa.delete(2),await $h(n)):e||(n.xa.add(2),await Bh(n),n.$a.set("Unknown"))}function au(t){return t.Ka||(t.Ka=function(t,e,n){const s=Ns(t);return s.Ea(),new Mh(e,s.qc,s.credentials,s.serializer,n)}(t.Sa,t.li,{ia:async function(t){t.Na.forEach((e,n)=>{Hh(t,e)})}.bind(null,t),Zc:async function(t,e){Jh(t),Yh(t)?(t.$a.pa(e),Wh(t)):t.$a.set("Unknown")}.bind(null,t),oa:async function(t,e,n){if(t.$a.set("Online"),e instanceof xi&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Na.has(s)&&(await t.Da.La(s,n),t.Na.delete(s),t.ka.removeTarget(s))}(t,e)}catch(n){vs("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Zh(t,n)}else if(e instanceof Ni?t.ka.Fe(e):e instanceof Ai?t.ka.Ke(e):t.ka.ke(e),!n.isEqual(Ps.min()))try{const s=await Dh(t.va);n.v(s)>=0&&await function(t,e){const n=t.ka.je(e);return n.ne.forEach((n,s)=>{if(n.resumeToken.ct()>0){const i=t.Na.get(s);i&&t.Na.set(s,i._t(n.resumeToken,e))}}),n.se.forEach(e=>{const n=t.Na.get(e);if(!n)return;t.Na.set(e,n._t(Js.at,n.ht)),Xh(t,e);const s=new Zs(n.target,e,1,n.sequenceNumber);Hh(t,s)}),t.Da.qa(n)}(t,n)}catch(e){vs("RemoteStore","Failed to raise snapshot:",e),await Zh(t,e)}}.bind(null,t)}),t.Oa.push(async e=>{e?(t.Ka.Gc(),Yh(t)?Wh(t):t.$a.set("Unknown")):(await t.Ka.stop(),Jh(t))})),t.Ka}function hu(t){return t.Qa||(t.Qa=function(t,e,n){const s=Ns(t);return s.Ea(),new Uh(e,s.qc,s.credentials,s.serializer,n)}(t.Sa,t.li,{ia:async function(t){hu(t).da()}.bind(null,t),Zc:async function(t,e){e&&hu(t).ha&&await async function(t,e){if(si(n=e.code)&&n!==As.ABORTED){const n=t.Ca.shift();hu(t).Gc(),await tu(t,()=>t.Da.Ua(n.batchId,e)),await eu(t)}var n}(t,e),iu(t)&&ru(t)}.bind(null,t),fa:async function(t){const e=hu(t);for(const n of t.Ca)e.la(n.mutations)}.bind(null,t),_a:async function(t,e,n){const s=t.Ca.shift(),i=Bo.from(s,e,n);await tu(t,()=>t.Da.Ba(i)),await eu(t)}.bind(null,t)}),t.Oa.push(async e=>{e?(t.Qa.Gc(),await eu(t)):(await t.Qa.stop(),t.Ca.length>0&&(vs("RemoteStore",`Stopping write stream with ${t.Ca.length} pending writes`),t.Ca=[]))})),t.Qa}class uu{constructor(){this.Wa=void 0,this.listeners=[]}}class cu{constructor(){this.ja=new zo(t=>_o(t),Eo),this.onlineState="Unknown",this.Ga=new Set}}async function lu(t,e){const n=Ns(t),s=e.query;let i=!1,r=n.ja.get(s);if(r||(i=!0,r=new uu),i)try{r.Wa=await n.za(s)}catch(t){const n=pa(t,`Initialization of query '${To(e.query)}' failed`);return void e.onError(n)}n.ja.set(s,r),r.listeners.push(e),e.Ha(n.onlineState),r.Wa&&e.Ja(r.Wa)&&du(n)}async function fu(t,e){const n=Ns(t),s=e.query;let i=!1;const r=n.ja.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.ja.delete(s),n.Ya(s)}function du(t){t.Ga.forEach(t=>{t.next()})}class pu{constructor(t,e,n){this.query=t,this.Xa=e,this.Za=!1,this.tu=null,this.onlineState="Unknown",this.options=n||{}}Ja(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ei(t.query,t.docs,t.Yt,e,t.Xt,t.fromCache,t.Zt,!0)}let e=!1;return this.Za?this.eu(t)&&(this.Xa.next(t),e=!0):this.nu(t,this.onlineState)&&(this.su(t),e=!0),this.tu=t,e}onError(t){this.Xa.error(t)}Ha(t){this.onlineState=t;let e=!1;return this.tu&&!this.Za&&this.nu(this.tu,t)&&(this.su(this.tu),e=!0),e}nu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.iu&&n||t.docs.L()&&"Offline"!==e)}eu(t){if(t.docChanges.length>0)return!0;const e=this.tu&&this.tu.hasPendingWrites!==t.hasPendingWrites;return!(!t.Zt&&!e)&&!0===this.options.includeMetadataChanges}su(t){t=Ei.ee(t.query,t.docs,t.Xt,t.fromCache),this.Za=!0,this.Xa.next(t)}}class gu{constructor(){this.ru=new hi(mu.ou),this.cu=new hi(mu.au)}L(){return this.ru.L()}Do(t,e){const n=new mu(t,e);this.ru=this.ru.add(n),this.cu=this.cu.add(n)}uu(t,e){t.forEach(t=>this.Do(t,e))}No(t,e){this.hu(new mu(t,e))}lu(t,e){t.forEach(t=>this.No(t,e))}_u(t){const e=new js(new Us([])),n=new mu(e,t),s=new mu(e,t+1),i=[];return this.cu.Bt([n,s],t=>{this.hu(t),i.push(t.key)}),i}fu(){this.ru.forEach(t=>this.hu(t))}hu(t){this.ru=this.ru.delete(t),this.cu=this.cu.delete(t)}du(t){const e=new js(new Us([])),n=new mu(e,t),s=new mu(e,t+1);let i=wi();return this.cu.Bt([n,s],t=>{i=i.add(t.key)}),i}Kr(t){const e=new mu(t,0),n=this.ru.Kt(e);return null!==n&&t.isEqual(n.key)}}class mu{constructor(t,e){this.key=t,this.wu=e}static ou(t,e){return js.N(t.key,e.key)||Rs(t.wu,e.wu)}static au(t,e){return Rs(t.wu,e.wu)||js.N(t.key,e.key)}}function wu(t,e){return`firestore_clients_${t}_${e}`}function yu(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function vu(t,e){return`firestore_targets_${t}_${e}`}class bu{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Eu(t,e,n){const s=JSON.parse(n);let i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),r=void 0;return i&&s.error&&((i="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(r=new xs(s.error.code,s.error.message))),i?new bu(t,e,s.state,r):(bs("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Tu(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Iu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Eu(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new xs(n.error.code,n.error.message))),s?new Iu(t,n.state,i):(bs("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Tu(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Eu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Eu(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=vi();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Ks(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Eu(t,i):(bs("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class _u{constructor(t,e){this.clientId=t,this.onlineState=e}static Eu(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new _u(e.clientId,e.onlineState):(bs("SharedClientState","Failed to parse online state: "+t),null)}}class Tu{constructor(){this.activeTargetIds=vi()}Iu(t){this.activeTargetIds=this.activeTargetIds.add(t)}mu(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Tu(){const t={activeTargetIds:this.activeTargetIds.U(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Nu{constructor(t,e,n,s,i){this.window=t,this.vs=e,this.persistenceKey=n,this.Au=s,this.Ru=null,this.ma=null,this.gs=null,this.Pu=this.gu.bind(this),this.Vu=new ri(Rs),this.lr=!1,this.yu=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pu=wu(this.persistenceKey,this.Au),this.bu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Vu=this.Vu.dt(this.Au,new Tu),this.vu=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Su=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.Du=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Cu=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Pu)}static Qs(t){return!(!t||!t.localStorage)}async start(){const t=await this.Ru.Tc();for(const e of t){if(e===this.Au)continue;const t=this.getItem(wu(this.persistenceKey,e));if(t){const n=Eu.Eu(e,t);n&&(this.Vu=this.Vu.dt(n.clientId,n))}}this.Nu();const e=this.storage.getItem(this.Cu);if(e){const t=this.xu(e);t&&this.Ou(t)}for(const t of this.yu)this.gu(t);this.yu=[],this.window.addEventListener("unload",()=>this._c()),this.lr=!0}ps(t){this.setItem(this.bu,JSON.stringify(t))}Fu(){return this.Mu(this.Vu)}$u(t){let e=!1;return this.Vu.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}ku(t){this.Lu(t,"pending")}qu(t,e,n){this.Lu(t,e,n),this.Bu(t)}Uu(t){let e="not-current";if(this.$u(t)){const n=this.storage.getItem(vu(this.persistenceKey,t));if(n){const s=Iu.Eu(t,n);s&&(e=s.state)}}return this.Ku.Iu(t),this.Nu(),e}Qu(t){this.Ku.mu(t),this.Nu()}Wu(t){return this.Ku.activeTargetIds.has(t)}ju(t){this.removeItem(vu(this.persistenceKey,t))}Gu(t,e,n){this.zu(t,e,n)}Hu(t,e,n){e.forEach(t=>{this.Bu(t)}),this.currentUser=t,n.forEach(t=>{this.ku(t)})}Ju(t){this.Yu(t)}_c(){this.lr&&(this.window.removeEventListener("storage",this.Pu),this.removeItem(this.pu),this.lr=!1)}getItem(t){const e=this.storage.getItem(t);return vs("SharedClientState","READ",t,e),e}setItem(t,e){vs("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){vs("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gu(t){const e=t;if(e.storageArea===this.storage){if(vs("SharedClientState","EVENT",e.key,e.newValue),e.key===this.pu)return void bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.vs.xi(async()=>{if(this.lr){if(null!==e.key)if(this.vu.test(e.key)){if(null==e.newValue){const t=this.Xu(e.key);return this.Zu(t,null)}{const t=this.th(e.key,e.newValue);if(t)return this.Zu(t.clientId,t)}}else if(this.Su.test(e.key)){if(null!==e.newValue){const t=this.eh(e.key,e.newValue);if(t)return this.nh(t)}}else if(this.Du.test(e.key)){if(null!==e.newValue){const t=this.sh(e.key,e.newValue);if(t)return this.ih(t)}}else if(e.key===this.Cu){if(null!==e.newValue){const t=this.xu(e.newValue);if(t)return this.Ou(t)}}else if(e.key===this.bu){const t=function(t){let e=Jo.bs;if(null!=t)try{const n=JSON.parse(t);Ts("number"==typeof n),e=n}catch(t){bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Jo.bs&&this.gs(t)}}else this.yu.push(e)})}}get Ku(){return this.Vu.get(this.Au)}Nu(){this.setItem(this.pu,this.Ku.Tu())}Lu(t,e,n){const s=new bu(this.currentUser,t,e,n),i=yu(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Tu())}Bu(t){const e=yu(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Yu(t){const e={clientId:this.Au,onlineState:t};this.storage.setItem(this.Cu,JSON.stringify(e))}zu(t,e,n){const s=vu(this.persistenceKey,t),i=new Iu(t,e,n);this.setItem(s,i.Tu())}Xu(t){const e=this.vu.exec(t);return e?e[1]:null}th(t,e){const n=this.Xu(t);return Eu.Eu(n,e)}eh(t,e){const n=this.Su.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return bu.Eu(new ms(i),s,e)}sh(t,e){const n=this.Du.exec(t),s=Number(n[1]);return Iu.Eu(s,e)}xu(t){return _u.Eu(t)}async nh(t){if(t.user.uid===this.currentUser.uid)return this.Ru.rh(t.batchId,t.state,t.error);vs("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}ih(t){return this.Ru.oh(t.targetId,t.state,t.error)}Zu(t,e){const n=e?this.Vu.dt(t,e):this.Vu.remove(t),s=this.Mu(this.Vu),i=this.Mu(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.Ru.ah(r,o).then(()=>{this.Vu=n})}Ou(t){this.Vu.get(t.clientId)&&this.ma(t.onlineState)}Mu(t){let e=vi();return t.forEach((t,n)=>{e=e.Qt(n.activeTargetIds)}),e}}class Au{constructor(){this.uh=new Tu,this.hh={},this.ma=null,this.gs=null}ku(t){}qu(t,e,n){}Uu(t){return this.uh.Iu(t),this.hh[t]||"not-current"}Gu(t,e,n){this.hh[t]=e}Qu(t){this.uh.mu(t)}Wu(t){return this.uh.activeTargetIds.has(t)}ju(t){delete this.hh[t]}Fu(){return this.uh.activeTargetIds}$u(t){return this.uh.activeTargetIds.has(t)}start(){return this.uh=new Tu,Promise.resolve()}Hu(t,e,n){}Ju(t){}_c(){}ps(t){}}class xu{constructor(t){this.key=t}}class Su{constructor(t){this.key=t}}class Du{constructor(t,e){this.query=t,this.lh=e,this._h=null,this.ae=!1,this.fh=wi(),this.Xt=wi(),this.dh=Ao(t),this.wh=new bi(this.dh)}get Eh(){return this.lh}Th(t,e){const n=e?e.Ih:new Ii,s=e?e.wh:this.wh;let i=e?e.Xt:this.Xt,r=s,o=!1;const a=go(this.query)&&s.size===this.query.limit?s.last():null,h=mo(this.query)&&s.size===this.query.limit?s.first():null;if(t.It((t,e)=>{const u=s.get(t);let c=e instanceof ho?e:null;c&&(c=No(this.query,c)?c:null);const l=!!u&&this.Xt.has(u.key),f=!!c&&(c.on||this.Xt.has(c.key)&&c.hasCommittedMutations);let d=!1;u&&c?u.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.mh(u,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.dh(c,a)>0||h&&this.dh(c,h)<0)&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),d=!0):u&&!c&&(n.track({type:1,doc:u}),d=!0,(a||h)&&(o=!0)),d&&(c?(r=r.add(c),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),go(this.query)||mo(this.query))for(;r.size>this.query.limit;){const t=go(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{wh:r,Ih:n,Ah:o,Xt:i}}mh(t,e){return t.on&&e.hasCommittedMutations&&!e.on}Jn(t,e,n){const s=this.wh;this.wh=t.wh,this.Xt=t.Xt;const i=t.Ih.Jt();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _s()}};return n(t)-n(e)})(t.type,e.type)||this.dh(t.doc,e.doc)),this.Rh(n);const r=e?this.Ph():[],o=0===this.fh.size&&this.ae?1:0,a=o!==this._h;return this._h=o,0!==i.length||a?{snapshot:new Ei(this.query,t.wh,s,i,t.Xt,0===o,a,!1),gh:r}:{gh:r}}Ha(t){return this.ae&&"Offline"===t?(this.ae=!1,this.Jn({wh:this.wh,Ih:new Ii,Xt:this.Xt,Ah:!1},!1)):{gh:[]}}Vh(t){return!this.lh.has(t)&&!!this.wh.has(t)&&!this.wh.get(t).on}Rh(t){t&&(t.ue.forEach(t=>this.lh=this.lh.add(t)),t.he.forEach(t=>{}),t.le.forEach(t=>this.lh=this.lh.delete(t)),this.ae=t.ae)}Ph(){if(!this.ae)return[];const t=this.fh;this.fh=wi(),this.wh.forEach(t=>{this.Vh(t.key)&&(this.fh=this.fh.add(t.key))});const e=[];return t.forEach(t=>{this.fh.has(t)||e.push(new Su(t))}),this.fh.forEach(n=>{t.has(n)||e.push(new xu(n))}),e}yh(t){this.lh=t.kc,this.fh=wi();const e=this.Th(t.documents);return this.Jn(e,!0)}ph(){return Ei.ee(this.query,this.wh,this.Xt,0===this._h)}}class Lu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class ku{constructor(t){this.key=t,this.bh=!1}}class Ru{constructor(t,e,n,s,i,r){this.va=t,this.Sh=e,this.Dh=n,this.Ch=s,this.currentUser=i,this.Nh=r,this.xh={},this.Oh=new zo(t=>_o(t),Eo),this.Fh=new Map,this.Mh=[],this.$h=new ri(js.N),this.kh=new Map,this.Lh=new gu,this.qh={},this.Bh=new Map,this.Uh=dh.fo(),this.onlineState="Unknown",this.Kh=void 0}get Qh(){return!0===this.Kh}}async function Cu(t,e,n,s){t.Wh=((e,n,s)=>(async function(t,e,n,s){let i=e.view.Th(n);i.Ah&&(i=await Ch(t.va,e.query,!1).then(({documents:t})=>e.view.Th(t,i)));const r=s&&s.ne.get(e.targetId),o=e.view.Jn(i,t.Qh,r);return ju(t,e.targetId,o.gh),o.snapshot})(t,e,n,s));const i=await Ch(t.va,e,!0),r=new Du(e,i.kc),o=r.Th(i.documents),a=Ti.ce(n,s&&"Offline"!==t.onlineState),h=r.Jn(o,t.Qh,a);ju(t,n,h.gh);const u=new Lu(e,n,r);return t.Oh.set(e,u),t.Fh.has(n)?t.Fh.get(n).push(e):t.Fh.set(n,[e]),h.snapshot}async function Ou(t,e){const n=Ns(t);try{const s=await function(t,e){const n=Ns(t),s=e.ht;let i=n.Sc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const r=n.Nc.so({ro:!0});i=n.Sc;const o=[];e.ne.forEach((e,r)=>{const a=i.get(r);if(!a)return;o.push(n.jo.Co(t,e.le,r).next(()=>n.jo.So(t,e.ue,r)));const h=e.resumeToken;if(h.ct()>0){const u=a._t(h,s).lt(t.Oo);i=i.dt(r,u),function(t,e,n){return Ts(e.resumeToken.ct()>0),0===t.resumeToken.ct()||e.ht.S()-t.ht.S()>=3e8||n.ue.size+n.he.size+n.le.size>0}(a,u,e)&&o.push(n.jo.Vo(t,u))}});let a=li(),h=wi();if(e.ie.forEach((t,e)=>{h=h.add(t)}),o.push(r.getEntries(t,h).next(i=>{e.ie.forEach((h,u)=>{const c=i.get(h);u instanceof uo&&u.version.isEqual(Ps.min())?(r.jn(h,s),a=a.dt(h,u)):null==c||u.version.v(c.version)>0||0===u.version.v(c.version)&&c.hasPendingWrites?(r.Qn(u,s),a=a.dt(h,u)):vs("LocalStore","Ignoring outdated watch update for ",h,". Current version:",c.version," Watch version:",u.version),e.re.has(h)&&o.push(n.persistence.yr.bc(t,h))})})),!s.isEqual(Ps.min())){const e=n.jo.To(t).next(e=>n.jo.mo(t,t.Oo,s));o.push(e)}return Ko.Ln(o).next(()=>r.apply(t)).next(()=>n.xc.hs(t,a))}).then(t=>(n.Sc=i,t))}(n.va,e);e.ne.forEach((t,e)=>{const s=n.kh.get(e);s&&(Ts(t.ue.size+t.he.size+t.le.size<=1),t.ue.size>0?s.bh=!0:t.he.size>0?Ts(s.bh):t.le.size>0&&(Ts(s.bh),s.bh=!1))}),await Bu(n,s,e)}catch(t){await Vh(t)}}function Vu(t,e,n){const s=Ns(t);if(s.Qh&&0===n||!s.Qh&&1===n){const t=[];s.Oh.forEach((n,s)=>{const i=s.view.Ha(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=Ns(t);n.onlineState=e;let s=!1;n.ja.forEach((t,n)=>{for(const t of n.listeners)t.Ha(e)&&(s=!0)}),s&&du(n)}(s.Dh,e),t.length&&s.xh.oa(t),s.onlineState=e,s.Qh&&s.Ch.Ju(e)}}async function Pu(t,e){const n=Ns(t),s=e.batch.batchId;try{const i=await function(t,e){const n=Ns(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const s=e.batch.keys(),i=n.Nc.so({ro:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Ko.resolve();return r.forEach(t=>{o=o.next(()=>s.Gn(e,t)).next(e=>{let r=e;const o=n.bn.get(t);Ts(null!==o),(!r||r.version.v(o)<0)&&(r=i.Pn(t,r,n))&&s.Qn(r,n.pn)})}),o.next(()=>t.es.kr(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.es.Ur(t)).next(()=>n.xc.us(t,s))})}(n.va,e);Uu(n,s,null),Mu(n,s),n.Ch.qu(s,"acknowledged"),await Bu(n,i)}catch(t){await Vh(t)}}function Mu(t,e){(t.Bh.get(e)||[]).forEach(t=>{t.resolve()}),t.Bh.delete(e)}function Uu(t,e,n){const s=Ns(t);let i=s.qh[s.currentUser.i()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.qh[s.currentUser.i()]=i}}function qu(t,e,n=null){t.Ch.Qu(e);for(const s of t.Fh.get(e))t.Oh.delete(s),n&&t.xh.jh(s,n);t.Fh.delete(e),t.Qh&&t.Lh._u(e).forEach(e=>{t.Lh.Kr(e)||Fu(t,e)})}function Fu(t,e){const n=t.$h.get(e);null!==n&&(Kh(t.Sh,n),t.$h=t.$h.remove(e),t.kh.delete(n),$u(t))}function ju(t,e,n){for(const s of n)s instanceof xu?(t.Lh.Do(s.key,e),Gu(t,s)):s instanceof Su?(vs("SyncEngine","Document no longer in limbo: "+s.key),t.Lh.No(s.key,e),t.Lh.Kr(s.key)||Fu(t,s.key)):_s()}function Gu(t,e){const n=e.key;t.$h.get(n)||(vs("SyncEngine","New document in limbo: "+n),t.Mh.push(n),$u(t))}function $u(t){for(;t.Mh.length>0&&t.$h.size<t.Nh;){const e=t.Mh.shift(),n=t.Uh.next();t.kh.set(n,new ku(e)),t.$h=t.$h.dt(e,n),zh(t.Sh,new Zs(Io(po(e.path)),n,2,Jo.bs))}}async function Bu(t,e,n){const s=Ns(t),i=[],r=[],o=[];s.Oh.L()||(s.Oh.forEach((t,a)=>{o.push(s.Wh(a,e,n).then(t=>{if(t){s.Qh&&s.Ch.Gu(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Qo.Ps(a.targetId,t);r.push(e)}}))}),await Promise.all(o),s.xh.oa(i),await async function(t,e){const n=Ns(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Ko.forEach(e,e=>Ko.forEach(e.As,s=>n.persistence.yr.Do(t,e.targetId,s)).next(()=>Ko.forEach(e.Rs,s=>n.persistence.yr.No(t,e.targetId,s)))))}catch(t){if(!ia(t))throw t;vs("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Sc.get(e),s=t.ht,i=t.ft(s);n.Sc=n.Sc.dt(e,i)}}}(s.va,r))}async function zu(t,e){const n=Ns(t),s=await Ch(n.va,e.query,!0),i=e.view.yh(s);return n.Qh&&ju(n,e.targetId,i.gh),i}async function Ku(t,e,n){const s=Ns(t),i=[],r=[];for(const t of e){let e;const n=s.Fh.get(t);if(n&&0!==n.length){e=await kh(s.va,Io(n[0]));for(const t of n){const e=s.Oh.get(t),n=await zu(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Oh(s.va,t);e=await kh(s.va,n),await Cu(s,Hu(n),t,!1)}i.push(e)}return s.xh.oa(r),i}function Hu(t){return fo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Xu(t){const e=Ns(t);return e.Sh.Da.qa=Ou.bind(null,e),e.Sh.Da.He=function(t,e){const n=Ns(t),s=n.kh.get(e);if(s&&s.bh)return wi().add(s.key);{let t=wi();const s=n.Fh.get(e);if(!s)return t;for(const e of s){const s=n.Oh.get(e);t=t.Qt(s.view.Eh)}return t}}.bind(null,e),e.Sh.Da.La=async function(t,e,n){const s=Ns(t);s.Ch.Gu(e,"rejected",n);const i=s.kh.get(e),r=i&&i.key;if(r){let t=new ri(js.N);t=t.dt(r,new uo(r,Ps.min()));const n=wi().add(r),i=new _i(Ps.min(),new Map,new hi(Rs),t,n);await Ou(s,i),s.$h=s.$h.remove(r),s.kh.delete(e),$u(s)}else await Rh(s.va,e,!1).then(()=>qu(s,e,n)).catch(Vh)}.bind(null,e),e.xh.oa=function(t,e){const n=Ns(t);let s=!1;for(const t of e){const e=t.query,i=n.ja.get(e);if(i){for(const e of i.listeners)e.Ja(t)&&(s=!0);i.Wa=t}}s&&du(n)}.bind(null,e.Dh),e.xh.jh=function(t,e,n){const s=Ns(t),i=s.ja.get(e);if(i)for(const t of i.listeners)t.onError(n);s.ja.delete(e)}.bind(null,e.Dh),e}function Wu(t){const e=Ns(t);return e.Sh.Da.Ba=Pu.bind(null,e),e.Sh.Da.Ua=async function(t,e,n){const s=Ns(t);try{const t=await function(t,e){const n=Ns(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return n.es.Cr(t,e).next(e=>(Ts(null!==e),s=e.keys(),n.es.kr(t,e))).next(()=>n.es.Ur(t)).next(()=>n.xc.us(t,s))})}(s.va,e);Uu(s,e,n),Mu(s,e),s.Ch.qu(e,"rejected",n),await Bu(s,t)}catch(n){await Vh(n)}}.bind(null,e),e}class Yu{Oc(t){this.Gh=t}_s(e,n,s,i){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.dn.length||1===t.dn.length&&t.dn[0].field.H())}(n)||s.isEqual(Ps.min())?this.zh(e,n):this.Gh.us(e,i).next(r=>{const o=this.Hh(n,r);return(go(n)||mo(n))&&this.Ah(n.wn,o,i,s)?this.zh(e,n):(ys()<=t.LogLevel.DEBUG&&vs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),To(n)),this.Gh._s(e,n,s).next(t=>(o.forEach(e=>{t=t.dt(e.key,e)}),t)))})}Hh(t,e){let n=new hi(Ao(t));return e.forEach((e,s)=>{s instanceof ho&&No(t,s)&&(n=n.add(s))}),n}Ah(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.v(s)>0)}zh(e,n){return ys()<=t.LogLevel.DEBUG&&vs("IndexFreeQueryEngine","Using full collection scan to execute query:",To(n)),this.Gh._s(e,n,Ps.min())}}class Qu{constructor(t,e){this.ns=t,this.yr=e,this.es=[],this.Jh=1,this.Yh=new hi(mu.ou)}vr(t){return Ko.resolve(0===this.es.length)}Sr(t,e,n,s){const i=this.Jh;this.Jh++,this.es.length>0&&this.es[this.es.length-1];const r=new $o(i,e,n,s);this.es.push(r);for(const e of s)this.Yh=this.Yh.add(new mu(e.key,i)),this.ns.Dr(t,e.key.path.M());return Ko.resolve(r)}Cr(t,e){return Ko.resolve(this.Xh(e))}Or(t,e){const n=e+1,s=this.Zh(n),i=s<0?0:s;return Ko.resolve(this.es.length>i?this.es[i]:null)}Fr(){return Ko.resolve(0===this.es.length?-1:this.Jh-1)}Mr(t){return Ko.resolve(this.es.slice())}rs(t,e){const n=new mu(e,0),s=new mu(e,Number.POSITIVE_INFINITY),i=[];return this.Yh.Bt([n,s],t=>{const e=this.Xh(t.wu);i.push(e)}),Ko.resolve(i)}ls(t,e){let n=new hi(Rs);return e.forEach(t=>{const e=new mu(t,0),s=new mu(t,Number.POSITIVE_INFINITY);this.Yh.Bt([e,s],t=>{n=n.add(t.wu)})}),Ko.resolve(this.tl(n))}Ts(t,e){const n=e.path,s=n.length+1;let i=n;js.et(i)||(i=i.child(""));const r=new mu(new js(i),0);let o=new hi(Rs);return this.Yh.Ut(t=>{const e=t.key.path;return!!n.q(e)&&(e.length===s&&(o=o.add(t.wu)),!0)},r),Ko.resolve(this.tl(o))}tl(t){const e=[];return t.forEach(t=>{const n=this.Xh(t);null!==n&&e.push(n)}),e}kr(t,e){Ts(0===this.el(e.batchId,"removed")),this.es.shift();let n=this.Yh;return Ko.forEach(e.mutations,s=>{const i=new mu(s.key,e.batchId);return n=n.delete(i),this.yr.Br(t,s.key)}).next(()=>{this.Yh=n})}qr(t){}Kr(t,e){const n=new mu(e,0),s=this.Yh.Kt(n);return Ko.resolve(e.isEqual(s&&s.key))}Ur(t){return this.es.length,Ko.resolve()}el(t,e){return this.Zh(t)}Zh(t){return 0===this.es.length?0:t-this.es[0].batchId}Xh(t){const e=this.Zh(t);return e<0||e>=this.es.length?null:this.es[e]}}class Ju{constructor(t,e){this.ns=t,this.nl=e,this.docs=new ri(js.N),this.size=0}Qn(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.nl(e);return this.docs=this.docs.dt(s,{zr:e,size:o,readTime:n}),this.size+=o-r,this.ns.Dr(t,s.path.M())}jn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Gn(t,e){const n=this.docs.get(e);return Ko.resolve(n?n.zr:null)}getEntries(t,e){let n=fi();return e.forEach(t=>{const e=this.docs.get(t);n=n.dt(t,e?e.zr:null)}),Ko.resolve(n)}_s(t,e,n){let s=pi();const i=new js(e.path.child("")),r=this.docs.Pt(i);for(;r.St();){const{key:t,value:{zr:i,readTime:o}}=r.vt();if(!e.path.q(t.path))break;o.v(n)<=0||i instanceof ho&&No(e,i)&&(s=s.dt(i.key,i))}return Ko.resolve(s)}sl(t,e){return Ko.forEach(this.docs,t=>e(t))}so(t){return new Ju.io(this)}oo(t){return Ko.resolve(this.size)}}Ju.io=class extends Ho{constructor(t){super(),this.co=t}Jn(t){const e=[];return this.Bn.forEach((n,s)=>{s?e.push(this.co.Qn(t,s,this.readTime)):this.co.jn(n)}),Ko.Ln(e)}zn(t,e){return this.co.Gn(t,e)}Hn(t,e){return this.co.getEntries(t,e)}};class Zu{constructor(t){this.persistence=t,this.il=new zo(t=>Ws(t),Ys),this.lastRemoteSnapshotVersion=Ps.min(),this.highestTargetId=0,this.rl=0,this.ol=new gu,this.targetCount=0,this.cl=dh._o()}Le(t,e){return this.il.forEach((t,n)=>e(n)),Ko.resolve()}To(t){return Ko.resolve(this.lastRemoteSnapshotVersion)}Io(t){return Ko.resolve(this.rl)}do(t){return this.highestTargetId=this.cl.next(),Ko.resolve(this.highestTargetId)}mo(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.rl&&(this.rl=e),Ko.resolve()}Ro(t){this.il.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.cl=new dh(e),this.highestTargetId=e),t.sequenceNumber>this.rl&&(this.rl=t.sequenceNumber)}Ao(t,e){return this.Ro(e),this.targetCount+=1,Ko.resolve()}Vo(t,e){return this.Ro(e),Ko.resolve()}yo(t,e){return this.il.delete(e.target),this.ol._u(e.targetId),this.targetCount-=1,Ko.resolve()}mr(t,e,n){let s=0;const i=[];return this.il.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.il.delete(r),i.push(this.po(t,o.targetId)),s++)}),Ko.Ln(i).next(()=>s)}bo(t){return Ko.resolve(this.targetCount)}vo(t,e){const n=this.il.get(e)||null;return Ko.resolve(n)}So(t,e,n){return this.ol.uu(e,n),Ko.resolve()}Co(t,e,n){this.ol.lu(e,n);const s=this.persistence.yr,i=[];return s&&e.forEach(e=>{i.push(s.Br(t,e))}),Ko.Ln(i)}po(t,e){return this.ol._u(e),Ko.resolve()}xo(t,e){const n=this.ol.du(e);return Ko.resolve(n)}Kr(t,e){return Ko.resolve(this.ol.Kr(e))}}class tc{constructor(t){this.al={},this.$o=new Jo(0),this.ko=!1,this.ko=!0,this.yr=t(this),this.jo=new Zu(this),this.ns=new Ka,this.ts=new Ju(this.ns,t=>this.yr.ul(t))}start(){return Promise.resolve()}_c(){return this.ko=!1,Promise.resolve()}get lr(){return this.ko}Zo(){}tc(){}Rc(){return this.ns}Ic(t){let e=this.al[t.i()];return e||(e=new Qu(this.ns,this.yr),this.al[t.i()]=e),e}mc(){return this.jo}Ac(){return this.ts}runTransaction(t,e,n){vs("MemoryPersistence","Starting transaction:",t);const s=new ec(this.$o.next());return this.yr.hl(),n(s).next(t=>this.yr.ll(s).next(()=>t)).$n().then(t=>(s.Zn(),t))}_l(t,e){return Ko.qn(Object.values(this.al).map(n=>()=>n.Kr(t,e)))}}class ec extends Wo{constructor(t){super(),this.Oo=t}}class nc{constructor(t){this.persistence=t,this.fl=new gu,this.dl=null}static wl(t){return new nc(t)}get El(){if(this.dl)return this.dl;throw _s()}Do(t,e,n){return this.fl.Do(n,e),this.El.delete(n.toString()),Ko.resolve()}No(t,e,n){return this.fl.No(n,e),this.El.add(n.toString()),Ko.resolve()}Br(t,e){return this.El.add(e.toString()),Ko.resolve()}removeTarget(t,e){this.fl._u(e.targetId).forEach(t=>this.El.add(t.toString()));const n=this.persistence.mc();return n.xo(t,e.targetId).next(t=>{t.forEach(t=>this.El.add(t.toString()))}).next(()=>n.yo(t,e))}hl(){this.dl=new Set}ll(t){const e=this.persistence.Ac().so();return Ko.forEach(this.El,n=>{const s=js.X(n);return this.Tl(t,s).next(t=>{t||e.jn(s)})}).next(()=>(this.dl=null,e.apply(t)))}bc(t,e){return this.Tl(t,e).next(t=>{t?this.El.delete(e.toString()):this.El.add(e.toString())})}ul(t){return 0}Tl(t,e){return Ko.qn([()=>Ko.resolve(this.fl.Kr(e)),()=>this.persistence.mc().Kr(t,e),()=>this.persistence._l(t,e)])}}class sc{constructor(t){this.Il=t.Il,this.ml=t.ml}ia(t){this.Al=t}Zc(t){this.Rl=t}onMessage(t){this.Pl=t}close(){this.ml()}send(t){this.Il(t)}gl(){this.Al()}Vl(t){this.Rl(t)}yl(t){this.Pl(t)}}const ic={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class rc extends class{constructor(t){this.pl=t,this.st=t.st;const e=t.ssl?"https":"http";this.bl=e+"://"+t.host,this.vl="projects/"+this.st.projectId+"/databases/"+this.st.database+"/documents"}Ta(t,e,n,s){const i=this.Sl(t,e);vs("RestConnection","Sending: ",i,n);const r={};return this.Dl(r,s),this.Cl(t,i,r,n).then(t=>(vs("RestConnection","Received: ",t),t),e=>{throw Is("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}Ia(t,e,n,s){return this.Ta(t,e,n,s)}Dl(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.21.1",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}Sl(t,e){const n=ic[t];return`${this.bl}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling}Cl(t,e,n,s){return new Promise((i,r)=>{const o=new gs;o.listenOnce(ds.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case fs.NO_ERROR:const e=o.getResponseJson();vs("Connection","XHR received:",JSON.stringify(e)),i(e);break;case fs.TIMEOUT:vs("Connection",'RPC "'+t+'" timed out'),r(new xs(As.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const n=o.getStatus();if(vs("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace("_","-");return Object.values(As).indexOf(e)>=0?e:As.UNKNOWN}(t.status);r(new xs(e,t.message))}else r(new xs(As.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new xs(As.UNAVAILABLE,"Connection failed."));break;default:_s()}}finally{vs("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}ra(t,e){const n=[this.bl,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=ls(),r={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.st.projectId}/databases/${this.st.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};var o,a;this.Dl(r.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((a=s()).indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(r.httpHeadersOverwriteParam="$httpHeaders");const h=n.join("");vs("Connection","Creating WebChannel: "+h,r);const u=i.createWebChannel(h,r);let c=!1,l=!1;const f=new sc({Il:t=>{l?vs("Connection","Not sending because WebChannel is closed:",t):(c||(vs("Connection","Opening WebChannel transport."),u.open(),c=!0),vs("Connection","WebChannel sending:",t),u.send(t))},ml:()=>u.close()}),d=(t,e)=>{u.listen(t,t=>{try{e(t)}catch(t){setTimeout(()=>{throw t},0)}})};return d(ps.EventType.OPEN,()=>{l||vs("Connection","WebChannel transport opened.")}),d(ps.EventType.CLOSE,()=>{l||(l=!0,vs("Connection","WebChannel transport closed"),f.Vl())}),d(ps.EventType.ERROR,t=>{l||(l=!0,Is("Connection","WebChannel transport errored:",t),f.Vl(new xs(As.UNAVAILABLE,"The operation could not be completed")))}),d(ps.EventType.MESSAGE,t=>{var e;if(!l){const n=t.data[0];Ts(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){vs("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=ei[t];if(void 0!==e)return ii(e)}(t),n=i.message;void 0===e&&(e=As.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),l=!0,f.Vl(new xs(e,n)),u.close()}else vs("Connection","WebChannel received:",n),f.yl(n)}}),setTimeout(()=>{f.gl()},0),f}}class oc{constructor(){this.Nl=(()=>this.xl()),this.Ol=(()=>this.Fl()),this.Ml=[],this.$l()}Ma(t){this.Ml.push(t)}_c(){window.removeEventListener("online",this.Nl),window.removeEventListener("offline",this.Ol)}$l(){window.addEventListener("online",this.Nl),window.addEventListener("offline",this.Ol)}xl(){vs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Ml)t(0)}Fl(){vs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Ml)t(1)}static Qs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class ac{Ma(t){}_c(){}}function hc(t){return new rc(t)}function uc(t){return new er(t,!0)}const cc="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.";class lc{async initialize(t){this.Ch=this.kl(t),this.persistence=this.Ll(t),await this.persistence.start(),this.ql=this.Bl(t),this.va=this.Ul(t)}Bl(t){return null}Ul(t){return e=this.persistence,n=new Yu,s=t.Kl,new xh(e,n,s);var e,n,s}Ll(t){if(t.persistenceSettings.Ql)throw new xs(As.FAILED_PRECONDITION,cc);return new tc(nc.wl)}kl(t){return new Au}async terminate(){this.ql&&this.ql.stop(),await this.Ch._c(),await this.persistence._c()}clearPersistence(t,e){throw new xs(As.FAILED_PRECONDITION,cc)}}class fc extends lc{constructor(t){super(),this.Wl=t}async initialize(t){await super.initialize(t),await async function(t){const e=Ns(t),n=Ns(e.Nc);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>n.no(t)).then(t=>{e.Cc=t})}(this.va),await this.Wl.initialize(this,t),await Wu(this.Wl.Ru),await eu(this.Wl.Sh)}Bl(t){const e=this.persistence.yr.cr;return new va(e,t.li)}Ll(t){const e=Nh(t.pl.st,t.pl.persistenceKey),n=uc(t.pl.st);return new bh(t.persistenceSettings.synchronizeTabs,e,t.clientId,ya.Xi(t.persistenceSettings.cacheSizeBytes),t.li,ca(),la(),n,this.Ch,t.persistenceSettings.Mo)}kl(t){return new Au}clearPersistence(t,e){return Ah(Nh(t,e))}}class dc extends fc{async initialize(t){await super.initialize(t);const e=this.Wl.Ru;this.Ch instanceof Nu&&(this.Ch.Ru={rh:async function(t,e,n,s){const i=Ns(t),r=await function(t,e){const n=Ns(t),s=Ns(n.es);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Nr(t,e).next(e=>e?n.xc.us(t,e):Ko.resolve(null)))}(i.va,e);null!==r?("pending"===n?await eu(i.Sh):"acknowledged"===n||"rejected"===n?(Uu(i,e,s||null),Mu(i,e),function(t,e){Ns(Ns(t).es).qr(e)}(i.va,e)):_s(),await Bu(i,r)):vs("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),oh:async function(t,e,n,s){const i=Ns(t);if(i.Kh)vs("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fh.has(e))switch(n){case"current":case"not-current":{const t=await function(t){const e=Ns(i.va),n=Ns(e.Nc);return e.persistence.runTransaction("Get new document changes","readonly",t=>n.Zr(t,e.Cc)).then(({eo:t,readTime:n})=>(e.Cc=n,t))}(),s=_i.oe(e,"current"===n);await Bu(i,t,s);break}case"rejected":await Rh(i.va,e,!0),qu(i,e,s);break;default:_s()}}.bind(null,e),ah:async function(t,e,n){const s=Xu(t);if(s.Kh){for(const t of e){if(s.Fh.has(t)){vs("SyncEngine","Adding an already active target "+t);continue}const e=await Oh(s.va,t),n=await kh(s.va,e);await Cu(s,Hu(e),n.targetId,!1),zh(s.Sh,n)}for(const t of n)s.Fh.has(t)&&await Rh(s.va,t,!1).then(()=>{Kh(s.Sh,t),qu(s,t)}).catch(Vh)}}.bind(null,e),Tc:function(t){return Ns(Ns(Ns(t).va).persistence).Tc()}.bind(null,e)},await this.Ch.start()),await this.persistence.Xo(async t=>{await async function(t,e){const n=Ns(t);if(Xu(n),Wu(n),!0===e&&!0!==n.Kh){const t=n.Ch.Fu(),e=await Ku(n,t.U());n.Kh=!0,await ou(n.Sh,!0);for(const t of e)zh(n.Sh,t)}else if(!1===e&&!1!==n.Kh){const t=[];let e=Promise.resolve();n.Fh.forEach((s,i)=>{n.Ch.Wu(i)?t.push(i):e=e.then(()=>(qu(n,i),Rh(n.va,i,!0))),Kh(n.Sh,i)}),await e,await Ku(n,t),function(t){const e=Ns(n);e.kh.forEach((t,n)=>{Kh(e.Sh,n)}),e.Lh.fu(),e.kh=new Map,e.$h=new ri(js.N)}(),n.Kh=!1,await ou(n.Sh,!1)}}(this.Wl.Ru,t),this.ql&&(t&&!this.ql.lr?this.ql.start(this.va):t||this.ql.stop())})}kl(t){if(t.persistenceSettings.Ql&&t.persistenceSettings.synchronizeTabs){const e=ca();if(!Nu.Qs(e))throw new xs(As.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Nh(t.pl.st,t.pl.persistenceKey);return new Nu(e,t.li,n,t.clientId,t.Kl)}return new Au}}class pc{async initialize(t,e){this.va||(this.va=t.va,this.Ch=t.Ch,this.Sa=this.jl(e),this.Sh=this.Gl(e),this.Dh=this.zl(e),this.Ru=this.Hl(e),this.Ch.ma=(t=>Vu(this.Ru,t,1)),this.Sh.Da.Jl=async function(t,e){const n=Ns(t);if(!n.currentUser.isEqual(e)){vs("SyncEngine","User change. New user:",e.i());const t=await Sh(n.va,e);n.currentUser=e,function(t,e){t.Bh.forEach(t=>{t.forEach(t=>{t.reject(new xs(As.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Bh.clear()}(n),n.Ch.Hu(e,t.Mc,t.$c),await Bu(n,t.Fc)}}.bind(null,this.Ru),await ou(this.Sh,this.Ru.Qh))}zl(t){return new cu}jl(t){const e=uc(t.pl.st),n=hc(t.pl);return Fh(t.credentials,n,e)}Gl(t){return e=this.va,n=this.Sa,s=t.li,i=(t=>Vu(this.Ru,t,0)),r=oc.Qs()?new oc:new ac,new Gh(e,n,s,i,r);var e,n,s,i,r}Hl(t){return function(t,e,n,s,i,r,o){const a=new Ru(t,e,n,s,i,r);return o&&(a.Kh=!0),a}(this.va,this.Sh,this.Dh,this.Ch,t.Kl,t.Nh,!t.persistenceSettings.Ql||!t.persistenceSettings.synchronizeTabs)}terminate(){return async function(t){const e=Ns(t);vs("RemoteStore","RemoteStore shutting down."),e.xa.add(5),await Bh(e),e.Fa._c(),e.$a.set("Unknown")}(this.Sh)}}class gc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Yl(this.observer.next,t)}error(t){this.observer.error?this.Yl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Xl(){this.muted=!0}Yl(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function mc(t,e,n){if(e.length!==n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires `+Nc(n,"argument")+", but was called with "+Nc(e.length,"argument")+".")}function wc(t,e,n){if(e.length<n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires at least `+Nc(n,"argument")+", but was called with "+Nc(e.length,"argument")+".")}function yc(t,e,n,s){!function(t,e,n,s){let i=!1;if(!(i="object"===e?Ic(s):"non-empty string"===e?"string"==typeof s&&""!==s:typeof s===e)){const i=Ec(s);throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${i}`)}}(t,e,Tc(n)+" argument",s)}function vc(t){if(!js.et(t))throw new xs(As.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function bc(t){if(js.et(t))throw new xs(As.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ic(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ec(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_s()}function _c(t,e,n){if(n<=0)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${Tc(e)} argument to be a positive number, but it was: ${n}.`)}function Tc(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Nc(t,e){return`${t} ${e}`+(1===t?"":"s")}class Ac{constructor(t){!function(t,e,n,s){if(!(e instanceof Array)||e.length<1)throw new xs(As.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Nc(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(yc("FieldPath","string",e,t[e]),0===t[e].length)throw new xs(As.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Zl=new Fs(t)}}class xc extends Ac{constructor(...t){super(t)}static documentId(){return new xc(Fs.J().K())}isEqual(t){if(!(t instanceof xc))throw function(t,e,n,s){const i=Ec(s);return new xs(As.INVALID_ARGUMENT,`Function isEqual() requires its ${Tc(1)} argument to be a FieldPath, but it was: ${i}`)}(0,0,0,t);return this.Zl.isEqual(t.Zl)}}const Sc=new RegExp("[~\\*/\\[\\]]");class Dc{constructor(t){this.t_=t}}class Lc extends Dc{e_(t){if(2!==t.n_)throw 1===t.n_?t.s_(this.t_+"() can only appear at the top level of your update data"):t.s_(this.t_+"() cannot be used with set() unless you pass {merge:true}");return t.Xe.push(t.path),null}isEqual(t){return t instanceof Lc}}function kc(t,e,n){return new Bc({n_:3,i_:e.settings.i_,methodName:t.t_,r_:n},e.st,e.serializer,e.ignoreUndefinedProperties)}class Rc extends Dc{e_(t){return new Fr(t.path,new kr)}isEqual(t){return t instanceof Rc}}class Cc extends Dc{constructor(t,e){super(t),this.o_=e}e_(t){const e=kc(this,t,!0),n=this.o_.map(t=>Yc(t,e)),s=new Rr(n);return new Fr(t.path,s)}isEqual(t){return this===t}}class Oc extends Dc{constructor(t,e){super(t),this.o_=e}e_(t){const e=kc(this,t,!0),n=this.o_.map(t=>Yc(t,e)),s=new Or(n);return new Fr(t.path,s)}isEqual(t){return this===t}}class Vc extends Dc{constructor(t,e){super(t),this.c_=e}e_(t){const e=new Pr(t.serializer,ir(t.serializer,this.c_));return new Fr(t.path,e)}isEqual(t){return this===t}}class Pc{constructor(t,e){if(mc("GeoPoint",arguments,2),yc("GeoPoint","number",1,t),yc("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new xs(As.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new xs(As.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.a_=t,this.u_=e}get latitude(){return this.a_}get longitude(){return this.u_}isEqual(t){return this.a_===t.a_&&this.u_===t.u_}toJSON(){return{latitude:this.a_,longitude:this.u_}}V(t){return Rs(this.a_,t.a_)||Rs(this.u_,t.u_)}}class Mc{constructor(t){this.h_=t}static fromBase64String(t){try{return new Mc(Js.fromBase64String(t))}catch(t){throw new xs(As.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}}static fromUint8Array(t){return new Mc(Js.fromUint8Array(t))}toBase64(){return this.h_.toBase64()}toUint8Array(){return this.h_.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.h_.isEqual(t.h_)}}class Uc{constructor(t){this.l_=t}}const qc=/^__.*__$/;class Fc{constructor(t,e,n){this.__=t,this.f_=e,this.d_=n}}class jc{constructor(t,e,n){this.data=t,this.Xe=e,this.fieldTransforms=n}w_(t,e){const n=[];return null!==this.Xe?n.push(new Qr(t,this.data,this.Xe,e)):n.push(new Yr(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Zr(t,this.fieldTransforms)),n}}class Gc{constructor(t,e,n){this.data=t,this.Xe=e,this.fieldTransforms=n}w_(t,e){const n=[new Qr(t,this.data,this.Xe,e)];return this.fieldTransforms.length>0&&n.push(new Zr(t,this.fieldTransforms)),n}}function $c(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _s()}}class Bc{constructor(t,e,n,s,i,r){this.settings=t,this.st=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.E_(),this.fieldTransforms=i||[],this.Xe=r||[]}get path(){return this.settings.path}get n_(){return this.settings.n_}T_(t){return new Bc(Object.assign(Object.assign({},this.settings),t),this.st,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Xe)}I_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.T_({path:n,r_:!1});return s.m_(t),s}A_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.T_({path:n,r_:!1});return s.E_(),s}R_(t){return this.T_({path:void 0,r_:!0})}s_(t){return nl(t,this.settings.methodName,this.settings.P_||!1,this.path,this.settings.i_)}contains(t){return void 0!==this.Xe.find(e=>t.q(e))||void 0!==this.fieldTransforms.find(e=>t.q(e.field))}E_(){if(this.path)for(let t=0;t<this.path.length;t++)this.m_(this.path.get(t))}m_(t){if(0===t.length)throw this.s_("Document fields must not be empty");if($c(this.n_)&&qc.test(t))throw this.s_('Document fields cannot begin and end with "__"')}}class zc{constructor(t,e,n){this.st=t,this.ignoreUndefinedProperties=e,this.serializer=n||uc(t)}g_(t,e,n,s=!1){return new Bc({n_:t,methodName:e,i_:n,path:Fs.j(),r_:!1,P_:s},this.st,this.serializer,this.ignoreUndefinedProperties)}}function Kc(t,e,n,s,i,r={}){const o=t.g_(r.merge||r.mergeFields?2:0,e,n,i);Zc("Data must be an object, but it was:",o,s);const a=Qc(s,o);let h,u;if(r.merge)h=new qr(o.Xe),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){let i;if(s instanceof Ac)i=s.Zl;else{if("string"!=typeof s)throw _s();i=el(e,s,n)}if(!o.contains(i))throw new xs(As.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);sl(t,i)||t.push(i)}h=new qr(t),u=o.fieldTransforms.filter(t=>h.rn(t.field))}else h=null,u=o.fieldTransforms;return new jc(new io(a),h,u)}function Hc(t,e,n,s){const i=t.g_(1,e,n);Zc("Data must be an object, but it was:",i,s);const r=[],o=new ro;Ci(s,(t,s)=>{const a=el(e,t,n),h=i.A_(a);if(s instanceof Lc||s instanceof Uc&&s.l_ instanceof Lc)r.push(a);else{const t=Yc(s,h);null!=t&&(r.push(a),o.set(a,t))}});const a=new qr(r);return new Gc(o.cn(),a,i.fieldTransforms)}function Xc(t,e,n,s,i,r){const o=t.g_(1,e,n),a=[tl(e,s,n)],h=[i];if(r.length%2!=0)throw new xs(As.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(tl(e,r[t])),h.push(r[t+1]);const u=[],c=new ro;for(let t=a.length-1;t>=0;--t)if(!sl(u,a[t])){const e=a[t],n=h[t],s=o.A_(e);if(n instanceof Lc||n instanceof Uc&&n.l_ instanceof Lc)u.push(e);else{const t=Yc(n,s);null!=t&&(u.push(e),c.set(e,t))}}const l=new qr(u);return new Gc(c.cn(),l,o.fieldTransforms)}function Wc(t,e,n,s=!1){return Yc(n,t.g_(s?4:3,e))}function Yc(t,e){if(t instanceof Uc&&(t=t.l_),Jc(t))return Zc("Unsupported field value:",e,t),Qc(t,e);if(t instanceof Dc)return function(t,e){if(!$c(e.n_))throw e.s_(t.t_+"() can only be used with update() and set()");if(!e.path)throw e.s_(t.t_+"() is not currently supported inside arrays");const n=t.e_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Xe.push(e.path),t instanceof Array){if(e.settings.r_&&4!==e.n_)throw e.s_("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Yc(i,e.R_(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ir(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Vs.fromDate(t);return{timestampValue:rr(e.serializer,n)}}if(t instanceof Vs){const n=new Vs(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:rr(e.serializer,n)}}if(t instanceof Pc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Mc)return{bytesValue:or(e.serializer,t.h_)};if(t instanceof Fc){const n=e.st,s=t.__;if(!s.isEqual(n))throw e.s_(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hr(t.__||e.st,t.f_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.s_("Unsupported field value: "+Ec(t))}(t,e)}function Qc(t,e){const n={};return Oi(t)?e.path&&e.path.length>0&&e.Xe.push(e.path):Ci(t,(t,s)=>{const i=Yc(s,e.I_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Jc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Vs||t instanceof Pc||t instanceof Mc||t instanceof Fc||t instanceof Dc)}function Zc(t,e,n){if(!Jc(n)||!Ic(n)){const s=Ec(n);throw"an object"===s?e.s_(t+" a custom object"):e.s_(t+" "+s)}}function tl(t,e,n){if(e instanceof Ac)return e.Zl;if("string"==typeof e)return el(t,e);throw nl("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function el(t,e,n){try{return function(t){if(t.search(Sc)>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new xc(...t.split("."))}catch(e){throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).Zl}catch(e){throw nl((s=e)instanceof Error?s.message:s.toString(),t,!1,void 0,n)}var s}function nl(t,e,n,s,i){const r=s&&!s.L(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=" in field "+s),o&&(h+=" in document "+i),h+=")"),new xs(As.INVALID_ARGUMENT,a+t+h)}function sl(t,e){return t.some(t=>t.isEqual(e))}class il{constructor(t){this.Sa=t,this.V_=new Map,this.mutations=[],this.y_=!1,this.p_=null,this.b_=new Set}async v_(t){if(this.S_(),this.mutations.length>0)throw new xs(As.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ns(t),s=pr(n.serializer)+"/documents",i={documents:e.map(t=>cr(n.serializer,t))},r=await n.Ia("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){Ts(!!e.found),e.found.name,e.found.updateTime;const n=lr(t,e.found.name),s=ar(e.found.updateTime),i=new io({mapValue:{fields:e.found.fields}});return new ho(n,s,i,{})}(t,e):"missing"in e?function(t,e){Ts(!!e.missing),Ts(!!e.readTime);const n=lr(t,e.missing),s=ar(e.readTime);return new uo(n,s)}(t,e):_s()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());Ts(!!e),a.push(e)}),a}(this.Sa,t);return e.forEach(t=>{t instanceof uo||t instanceof ho?this.D_(t):_s()}),e}set(t,e){this.write(e.w_(t,this.en(t))),this.b_.add(t.toString())}update(t,e){try{this.write(e.w_(t,this.C_(t)))}catch(t){this.p_=t}this.b_.add(t.toString())}delete(t){this.write([new no(t,this.en(t))]),this.b_.add(t.toString())}async commit(){if(this.S_(),this.p_)throw this.p_;const t=this.V_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=js.X(e);this.mutations.push(new so(n,this.en(n)))}),await async function(t,e){const n=Ns(t),s=pr(n.serializer)+"/documents",i={writes:e.map(t=>wr(n.serializer,t))};await n.Ta("Commit",s,i)}(this.Sa,this.mutations),this.y_=!0}D_(t){let e;if(t instanceof ho)e=t.version;else{if(!(t instanceof uo))throw _s();e=Ps.min()}const n=this.V_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new xs(As.ABORTED,"Document version changed between two reads.")}else this.V_.set(t.key.toString(),e)}en(t){const e=this.V_.get(t.toString());return!this.b_.has(t.toString())&&e?Gr.updateTime(e):Gr.nn()}C_(t){const e=this.V_.get(t.toString());if(!this.b_.has(t.toString())&&e){if(e.isEqual(Ps.min()))throw new xs(As.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Gr.updateTime(e)}return Gr.exists(!0)}write(t){this.S_(),this.mutations=this.mutations.concat(t)}S_(){}}class rl{constructor(t,e,n,s){this.li=t,this.Sa=e,this.updateFunction=n,this.di=s,this.N_=5,this.pi=new ta(this.li,"transaction_retry")}run(){this.x_()}x_(){this.pi.$s(async()=>{const t=new il(this.Sa),e=this.O_(t);e&&e.then(e=>{this.li.Ii(()=>t.commit().then(()=>{this.di.resolve(e)}).catch(t=>{this.F_(t)}))}).catch(t=>{this.F_(t)})})}O_(t){try{const e=this.updateFunction(t);return!Bs(e)&&e.catch&&e.then?e:(this.di.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.di.reject(t),null}}F_(t){this.N_>0&&this.M_(t)?(this.N_-=1,this.li.Ii(()=>(this.x_(),Promise.resolve()))):this.di.reject(t)}M_(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!si(e)}return!1}}function ol(t,e,n,s,i){const r=new gc({next:r=>{e.Ii(()=>fu(t,o));const a=r.docs.has(n);!a&&r.fromCache?i.reject(new xs(As.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&s&&"server"===s.source?i.reject(new xs(As.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new pu(po(n.path),r,{includeMetadataChanges:!0,iu:!0});return lu(t,o)}function al(t,e,n,s,i){const r=new gc({next:n=>{e.Ii(()=>fu(t,o)),n.fromCache&&"server"===s.source?i.reject(new xs(As.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new pu(n,r,{includeMetadataChanges:!0,iu:!0});return lu(t,o)}const hl=new Map;class ul{constructor(t,e){this.k_="(lite)",this.L_=!1,this.app=t,this.__=ul.q_(t),this.B_=new Ds(e)}get U_(){return this.L_}get K_(){return void 0!==this.Q_}W_(t){if(this.L_)throw new xs(As.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.j_=t}G_(){return this.j_||(this.j_={}),this.L_=!0,this.j_}static q_(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new xs(As.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $s(t.options.projectId)}_delete(){return this.Q_||(this.Q_=this.z_()),this.Q_}z_(){return function(t){const e=hl.get(t);e&&(vs("ComponentProvider","Removing Datastore"),hl.delete(t),e.terminate())}(this),Promise.resolve()}}function cl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class ll{constructor(t,e,n,s,i){this.st=t,this.timestampsInSnapshots=e,this.H_=n,this.J_=s,this.Y_=i}X_(t){switch(Ui(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zi(t.integerValue||t.doubleValue);case 3:return this.Z_(t.timestampValue);case 4:return this.tf(t);case 5:return t.stringValue;case 6:return this.Y_(Ki(t.bytesValue));case 7:return this.ef(t.referenceValue);case 8:return this.nf(t.geoPointValue);case 9:return this.sf(t.arrayValue);case 10:return this.if(t.mapValue);default:throw _s()}}if(t){const e={};return Ci(t.fields||{},(t,n)=>{e[t]=this.X_(n)}),e}nf(t){return new Pc(zi(t.latitude),zi(t.longitude))}sf(t){return(t.values||[]).map(t=>this.X_(t))}tf(t){switch(this.H_){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return Vi(n)?t(n):n}(t);return null==e?null:this.X_(e);case"estimate":return this.Z_(Pi(t));default:return null}}Z_(t){const e=Bi(t),n=new Vs(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}ef(t){const e=Us.W(t);Ts(Ar(e));const n=new $s(e.get(1),e.get(3)),s=new js(e.F(5));return n.isEqual(this.st)||bs(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.st.projectId}/${this.st.database}) instead.`),this.J_(s)}}const fl=ya.er;class dl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function pl(t,e,n){if("string"==typeof n){if(""===n)throw new xs(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!vo(e)&&-1!==n.indexOf("/"))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Us.W(n));if(!js.et(s))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Hi(t,new js(s))}if(n instanceof Fc)return Hi(t,n.f_);throw new xs(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ec(n)+".")}function gl(t,e){if(!Array.isArray(t)||0===t.length)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function ml(t,e,n){if(!n.isEqual(e))throw new xs(As.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function wl(t){if(mo(t)&&0===t.dn.length)throw new xs(As.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function yl(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}const vl=new Map,bl=new Map;async function Il(t,e,n){const s=new Zo;vl.set(t,s.promise);const i=await t.rf();i.persistenceSettings=e,vs("ComponentProvider","Initializing OfflineComponentProvider"),await n.initialize(i),t.cf(e=>t.af.Ii(()=>Sh(n.va,e))),n.persistence.Zo(()=>t._delete()),s.resolve(n)}async function El(t,e){const n=new Zo;bl.set(t,n.promise);const s=await t.rf(),i=await _l(t);vs("ComponentProvider","Initializing OnlineComponentProvider"),await e.initialize(i,s),t.cf(n=>t.af.Ii(()=>(async function(t,e){const n=Ns(t);n.li.Mi(),vs("RemoteStore","RemoteStore received new credentials");const s=Qh(n);n.xa.add(3),await Bh(n),s&&n.$a.set("Unknown"),await n.Da.Jl(e),n.xa.delete(3),await $h(n)})(e.Sh,n))),n.resolve(e)}function _l(t){return t.af.Mi(),vl.has(t)||(vs("ComponentProvider","Using default OfflineComponentProvider"),Il(t,{Ql:!1},new lc)),vl.get(t)}function Tl(t){return t.af.Mi(),bl.has(t)||(vs("ComponentProvider","Using default OnlineComponentProvider"),El(t,new pc)),bl.get(t)}function Nl(t){return Tl(t).then(t=>t.Ru)}function Al(t){return Tl(t).then(t=>t.Sh)}function xl(t){return Tl(t).then(t=>{const e=t.Dh;return e.za=async function(t,e){const n=Xu(t);let s,i;const r=n.Oh.get(e);if(r)s=r.targetId,n.Ch.Uu(s),i=r.view.ph();else{const t=await kh(n.va,Io(e)),r=n.Ch.Uu(t.targetId);s=t.targetId,i=await Cu(n,e,s,"current"===r),n.Qh&&zh(n.Sh,t)}return i}.bind(null,t.Ru),e.Ya=async function(t,e){const n=Ns(t),s=n.Oh.get(e),i=n.Fh.get(s.targetId);if(i.length>1)return n.Fh.set(s.targetId,i.filter(t=>!Eo(t,e))),void n.Oh.delete(e);n.Qh?(n.Ch.Qu(s.targetId),n.Ch.$u(s.targetId)||await Rh(n.va,s.targetId,!1).then(()=>{n.Ch.ju(s.targetId),Kh(n.Sh,s.targetId),qu(n,s.targetId)}).catch(Vh)):(qu(n,s.targetId),await Rh(n.va,s.targetId,!0))}.bind(null,t.Ru),e})}function Sl(t){return _l(t).then(t=>t.persistence)}function Dl(t){return _l(t).then(t=>t.va)}class Ll extends ul{constructor(t,e){super(t,e),this.af=new da,this.uf=ks.g(),this.hf=new Zo,this.lf=ms.UNAUTHENTICATED,this._f=(()=>{}),this.k_=t.name,this.B_.R(t=>{this.lf=t,this.hf.resolve()})}cf(t){vs("Firestore","Registering credential change listener"),this._f=t,this.hf.promise.then(()=>this._f(this.lf))}async rf(){var t,e;const n=this.G_();await this.hf.promise;const s=new Gs(this.__,this.k_,null!==(t=n.host)&&void 0!==t?t:"firestore.googleapis.com",null===(e=n.ssl)||void 0===e||e,!1);return{li:this.af,pl:s,clientId:this.uf,credentials:this.B_,Kl:this.lf,Nh:100,persistenceSettings:{Ql:!1}}}G_(){return super.G_()}z_(){this.af.Ni();const t=new Zo;return this.af.Si(async()=>{try{await super.z_(),await async function(t){const e=bl.get(t);e&&(vs("ComponentProvider","Removing OnlineComponentProvider"),bl.delete(t),await(await e).terminate());const n=vl.get(t);n&&(vs("ComponentProvider","Removing OfflineComponentProvider"),vl.delete(t),await(await n).terminate())}(this),this.B_.P(),t.resolve()}catch(e){const n=pa(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}ff(){if(this.K_)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.")}}function kl(t){if(t.U_||t.K_)throw new xs(As.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Rl extends Ac{constructor(...t){super(t)}isEqual(t){return this.Zl.isEqual(t.Zl)}}class Cl extends Fc{constructor(t,e,n){super(t.__,new js(n),e),this.df=n,this.type="document",this.firestore=t}get id(){return this.df.k()}get path(){return this.df.K()}get parent(){return new Gl(this.firestore,this.d_,this.f_.path.M())}withConverter(t){return new Cl(this.firestore,t,this.df)}}class Ol{constructor(t,e,n){this.d_=e,this.wf=n,this.type="query",this.firestore=t}withConverter(t){return new Ol(this.firestore,t,this.wf)}}class Vl{}class Pl extends Vl{constructor(t,e,n){super(),this.Tf=t,this.If=e,this.mf=n,this.type="where"}Ef(t){const e=zl(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.H()){if("array-contains"===r||"array-contains-any"===r)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){gl(o,r);const e=[];for(const n of o)e.push(pl(s,t,n));a={arrayValue:{values:e}}}else a=pl(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||gl(o,r),a=Wc(n,e,o,"in"===r||"not-in"===r);const h=xo.create(i,r,a);return function(t,e){if(e.In()){const n=yo(t);if(null!==n&&!n.isEqual(e.field))throw new xs(As.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=wo(t);null!==s&&ml(0,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new xs(As.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new xs(As.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,h),h}(t.wf,"where",e,t.firestore.__,this.Tf,this.If,this.mf);return new Ol(t.firestore,t.d_,function(t,e){const n=t.filters.concat([e]);return new lo(t.path,t.collectionGroup,t.dn.slice(),n,t.limit,t.wn,t.startAt,t.endAt)}(t.wf,n))}}class Ml extends Vl{constructor(t,e){super(),this.Tf=t,this.Af=e,this.type="orderBy"}Ef(t){const e=function(t,e,n){if(null!==t.startAt)throw new xs(As.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new xs(As.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Fo(e,n);return function(t,e){if(null===wo(t)){const n=yo(t);null!==n&&ml(0,n,e.field)}}(t,s),s}(t.wf,this.Tf,this.Af);return new Ol(t.firestore,t.d_,function(t,e){const n=t.dn.concat([e]);return new lo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.wn,t.startAt,t.endAt)}(t.wf,e))}}class Ul extends Vl{constructor(t,e,n){super(),this.type=t,this.Rf=e,this.Pf=n}Ef(t){return new Ol(t.firestore,t.d_,function(t,e,n){return new lo(t.path,t.collectionGroup,t.dn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.wf,this.Rf,this.Pf))}}class ql extends Vl{constructor(t,e,n){super(),this.type=t,this.gf=e,this.Vf=n}Ef(t){const e=jl(t,this.type,this.gf,this.Vf);return new Ol(t.firestore,t.d_,function(t,e){return new lo(t.path,t.collectionGroup,t.dn.slice(),t.filters.slice(),t.limit,t.wn,e,t.endAt)}(t.wf,e))}}class Fl extends Vl{constructor(t,e,n){super(),this.type=t,this.gf=e,this.Vf=n}Ef(t){const e=jl(t,this.type,this.gf,this.Vf);return new Ol(t.firestore,t.d_,function(t,e){return new lo(t.path,t.collectionGroup,t.dn.slice(),t.filters.slice(),t.limit,t.wn,t.startAt,e)}(t.wf,e))}}function jl(t,e,n,s){if(n[0]instanceof Hl)return mc(e,n,1),function(t,e,n,s,i){if(!s)throw new xs(As.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const r=[];for(const n of bo(t))if(n.field.H())r.push(Hi(e,s.key));else{const t=s.field(n.field);if(Vi(t))throw new xs(As.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.K();throw new xs(As.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new Po(r,i)}(t.wf,t.firestore.__,e,n[0].yf,s);{const i=zl(t.firestore);return function(t,e,n,s,i,r){const o=t.dn;if(i.length>o.length)throw new xs(As.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const h=i[r];if(o[r].field.H()){if("string"!=typeof h)throw new xs(As.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!vo(t)&&-1!==h.indexOf("/"))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const n=t.path.child(Us.W(h));if(!js.et(n))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new js(n);a.push(Hi(e,i))}else{const t=Wc(n,s,h);a.push(t)}}return new Po(a,r)}(t.wf,t.firestore.__,i,e,n,s)}}class Gl extends Ol{constructor(t,e,n){super(t,e,po(n)),this.firestore=t,this.df=n,this.type="collection"}get id(){return this.wf.path.k()}get path(){return this.wf.path.K()}get parent(){const t=this.df.M();return t.L()?null:new Cl(this.firestore,null,t)}withConverter(t){return new Gl(this.firestore,t,this.df)}}function $l(t,e,...n){if(1===arguments.length&&(e=ks.g()),Kl("doc","path",e),t instanceof ul){const s=Us.W(e,...n);return vc(s),new Cl(t,null,s)}{if(!(t instanceof Cl||t instanceof Gl))throw new xs(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t.df.child(Us.W(e,...n));return vc(s),new Cl(t.firestore,t instanceof Gl?t.d_:null,s)}}function Bl(t,e){return t instanceof Ol&&e instanceof Ol&&t.firestore===e.firestore&&Eo(t.wf,e.wf)&&t.d_===e.d_}function zl(t){const e=t.G_(),n=uc(t.__);return new zc(t.__,!!e.ignoreUndefinedProperties,n)}function Kl(t,e,n){if(!n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}class Hl{constructor(t,e,n,s){this.pf=t,this.f_=e,this.yf=n,this.d_=s}get id(){return this.f_.path.k()}get ref(){return new Cl(this.pf,this.d_,this.f_.path)}exists(){return null!==this.yf}data(){if(this.yf){if(this.d_){const t=new Xl(this.pf,this.f_,this.yf,null);return this.d_.fromFirestore(t)}return new ll(this.pf.__,!0,"none",t=>new Cl(this.pf,null,t.path),t=>new Mc(t)).X_(this.yf.fn())}}get(t){if(this.yf){const e=this.yf.data().field(Wl("DocumentSnapshot.get",t));if(null!==e)return new ll(this.pf.__,!0,"none",t=>new Cl(this.pf,this.d_,t.path),t=>new Mc(t)).X_(e)}}}class Xl extends Hl{data(){return super.data()}}function Wl(t,e){return"string"==typeof e?el(t,e):e.Zl}class Yl extends Hl{constructor(t,e,n,s,i){super(t,e,n,i),this.pf=t,this.bf=t,this.metadata=s}exists(){return super.exists()}data(t){if(this.yf){if(this.d_){const e=new Ql(this.pf,this.f_,this.yf,this.metadata,null);return this.d_.fromFirestore(e,t)}return new ll(this.bf.__,!0,(null==t?void 0:t.serverTimestamps)||"none",t=>new Cl(this.pf,null,t.path),t=>new Mc(t)).X_(this.yf.fn())}}get(t,e={}){if(this.yf){const n=this.yf.data().field(Wl("DocumentSnapshot.get",t));if(null!==n)return new ll(this.bf.__,!0,e.serverTimestamps||"none",t=>new Cl(this.pf,this.d_,t.path),t=>new Mc(t)).X_(n)}}}class Ql extends Yl{data(t={}){return super.data(t)}}class Jl{constructor(t,e,n){this.pf=t,this.vf=n,this.metadata=new dl(n.hasPendingWrites,n.fromCache),this.query=e}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.vf.docs.size}get empty(){return 0===this.size}forEach(t,e){this.vf.docs.forEach(n=>{t.call(e,this.Sf(n,this.vf.fromCache,this.vf.Xt.has(n.key)))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.vf.te)throw new xs(As.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Df&&this.Cf===e||(this.Df=function(t,e,n){if(t.Yt.L()){let e,s=0;return t.docChanges.map(i=>{const r=n(i.doc,t.fromCache,t.Xt.has(i.doc.key));return e=i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:s++}})}{let s=t.Yt;return t.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=n(e.doc,t.fromCache,t.Xt.has(e.doc.key));let r=-1,o=-1;return 0!==e.type&&(r=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(o=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _s()}}(e.type),doc:i,oldIndex:r,newIndex:o}})}}(this.vf,e,this.Sf.bind(this)),this.Cf=e),this.Df}Sf(t,e,n){return new Ql(this.pf,t.key,t,new dl(n,e),this.query.d_)}}class Zl{constructor(t,e){this.pf=t,this.Nf=e,this.xf=[],this.Of=!1,this.Ff=zl(t)}set(t,e,n){this.Mf();const s=tf(t,this.pf),i=yl(s.d_,e,n),r=Kc(this.Ff,"WriteBatch.set",s.f_,i,null!==s.d_,n);return this.xf=this.xf.concat(r.w_(s.f_,Gr.nn())),this}update(t,e,n,...s){this.Mf();const i=tf(t,this.pf);let r;return r="string"==typeof e||e instanceof Rl?Xc(this.Ff,"WriteBatch.update",i.f_,e,n,s):Hc(this.Ff,"WriteBatch.update",i.f_,e),this.xf=this.xf.concat(r.w_(i.f_,Gr.exists(!0))),this}delete(t){this.Mf();const e=tf(t,this.pf);return this.xf=this.xf.concat(new no(e.f_,Gr.nn())),this}commit(){return this.Mf(),this.Of=!0,this.xf.length>0?this.Nf(this.xf):Promise.resolve()}Mf(){if(this.Of)throw new xs(As.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function tf(t,e){if(t.firestore!==e)throw new xs(As.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class ef extends class{constructor(t,e){this.pf=t,this.$f=e,this.Ff=zl(t)}get(t){const e=tf(t,this.pf);return this.$f.v_([e.f_]).then(t=>{if(!t||1!==t.length)return _s();const n=t[0];if(n instanceof uo)return new Hl(this.pf,e.f_,null,e.d_);if(n instanceof ho)return new Hl(this.pf,n.key,n,e.d_);throw _s()})}set(t,e,n){const s=tf(t,this.pf),i=yl(s.d_,e,n),r=Kc(this.Ff,"Transaction.set",s.f_,i,null!==s.d_,n);return this.$f.set(s.f_,r),this}update(t,e,n,...s){const i=tf(t,this.pf);let r;return r="string"==typeof e||e instanceof Rl?Xc(this.Ff,"Transaction.update",i.f_,e,n,s):Hc(this.Ff,"Transaction.update",i.f_,e),this.$f.update(i.f_,r),this}delete(t){const e=tf(t,this.pf);return this.$f.delete(e.f_),this}}{constructor(t,e){super(t,e),this.pf=t}get(t){const e=tf(t,this.pf);return super.get(t).then(t=>new Yl(this.pf,e.f_,t.yf,new dl(!1,!1),e.d_))}}function nf(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new xs(As.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?"):new xs(As.INVALID_ARGUMENT,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}function sf(t,e){const n=new Zo;return t.af.Ii(async()=>(async function(t,e,n){const s=Wu(t);try{const i=await function(t,e){const n=Ns(t),s=Vs.now(),i=e.reduce((t,e)=>t.add(e.key),wi());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.xc.us(t,i).next(i=>{r=i;const o=[];for(const t of e){const e=Hr(t,r.get(t.key));null!=e&&o.push(new Qr(t.key,e,oo(e.proto.mapValue),Gr.exists(!0)))}return n.es.Sr(t,s,o,e)})).then(t=>{const e=t.yn(r);return{batchId:t.batchId,Bn:e}})}(s.va,e);s.Ch.ku(i.batchId),function(t,e,n){let s=t.qh[t.currentUser.i()];s||(s=new ri(Rs)),s=s.dt(e,n),t.qh[t.currentUser.i()]=s}(s,i.batchId,n),await Bu(s,i.Bn),await eu(s.Sh)}catch(t){const e=pa(t,"Failed to persist write");n.reject(e)}})(await Nl(t),e,n)),n.promise}function rf(t,e,n){const s=n.docs.get(e.f_);return new Yl(t,e.f_,s,new dl(n.hasPendingWrites,n.fromCache),e.d_)}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new Ll(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.800","node"),t.Bytes=Mc,t.CACHE_SIZE_UNLIMITED=fl,t.CollectionReference=Gl,t.DocumentReference=Cl,t.DocumentSnapshot=Yl,t.FieldPath=Rl,t.FieldValue=Dc,t.FirebaseFirestore=Ll,t.FirestoreError=xs,t.GeoPoint=Pc,t.Query=Ol,t.QueryConstraint=Vl,t.QueryDocumentSnapshot=Ql,t.QuerySnapshot=Jl,t.SnapshotMetadata=dl,t.Timestamp=Vs,t.Transaction=ef,t.WriteBatch=Zl,t.addDoc=function(t,e){const n=nf(t.firestore,Ll);n.ff();const s=$l(t),i=yl(t.d_,e);return sf(n,Kc(zl(t.firestore),"addDoc",s.f_,i,null!==t.d_,{}).w_(s.f_,Gr.exists(!1))).then(()=>s)},t.arrayRemove=function(...t){return wc("arrayRemove()",arguments,1),new Oc("arrayRemove",t)},t.arrayUnion=function(...t){return wc("arrayUnion()",arguments,1),new Cc("arrayUnion",t)},t.clearIndexedDbPersistence=function(t){if(t.U_&&!t.K_)throw new xs(As.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Zo;return t.af.Si(async()=>{try{await Ah(Nh(t.__,t.k_)),e.resolve()}catch(t){e.reject(t)}}),e.promise},t.collection=function(t,e,...n){if(Kl("collection","path",e),t instanceof ul){const s=Us.W(e,...n);return bc(s),new Gl(t,null,s)}{if(!(t instanceof Cl||t instanceof Gl))throw new xs(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=Us.W(t.path,...n).child(Us.W(e));return bc(s),new Gl(t.firestore,null,s)}},t.collectionGroup=function(t,e){if(Kl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ol(t,null,function(t){return new lo(Us.j(),t)}(e))},t.deleteDoc=function(t){const e=nf(t.firestore,Ll);return e.ff(),sf(e,[new no(t.f_,Gr.nn())])},t.deleteField=function(){return new Lc("deleteField")},t.disableNetwork=function(t){return t.ff(),t.af.enqueue(async()=>{const e=await Al(t);return(await Sl(t)).tc(!1),async function(t){const e=Ns(t);e.xa.add(0),await Bh(e),e.$a.set("Offline")}(e)})},t.doc=$l,t.documentId=function(){return new Rl("__name__")},t.enableIndexedDbPersistence=function(t,e){kl(t);const n=t.G_(),s=new pc,i=new fc(s);return t.af.enqueue(async()=>{await Il(t,{Ql:!0,synchronizeTabs:!1,cacheSizeBytes:n.cacheSizeBytes||ya.sr,Mo:!!(null==e?void 0:e.forceOwnership)},i),await El(t,s)})},t.enableMultiTabIndexedDbPersistence=function(t){kl(t);const e=t.G_(),n=new pc,s=new dc(n);return t.af.enqueue(async()=>{await Il(t,{Ql:!0,synchronizeTabs:!0,cacheSizeBytes:e.cacheSizeBytes||ya.sr,Mo:!1},s),await El(t,n)})},t.enableNetwork=function(t){return t.ff(),t.af.enqueue(async()=>{const e=await Al(t);return(await Sl(t)).tc(!0),function(t){const e=Ns(t);return e.xa.delete(0),$h(e)}(e)})},t.endAt=function(...t){return new Fl("endAt",t,!1)},t.endBefore=function(...t){return new Fl("endBefore",t,!0)},t.getDoc=function(t){const e=nf(t.firestore,Ll);e.ff();const n=new Zo;return e.af.Ii(async()=>{const s=await xl(e);await ol(s,e.af,t.f_,{source:"default"},n)}),n.promise.then(n=>rf(e,t,n))},t.getDocFromCache=function(t){const e=nf(t.firestore,Ll);e.ff();const n=new Zo;return e.af.Ii(async()=>{const s=await Dl(e);await async function(t,e,n){try{const s=await function(t,e){const n=Ns(t);return n.persistence.runTransaction("read document","readonly",t=>n.xc.ss(t,e))}(t,e);s instanceof ho?n.resolve(s):s instanceof uo?n.resolve(null):n.reject(new xs(As.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=pa(t,`Failed to get document '${e} from cache`);n.reject(s)}}(s,t.f_,n)}),n.promise.then(n=>new Yl(e,t.f_,n,new dl(n instanceof ho&&n.on,!0),t.d_))},t.getDocFromServer=function(t){const e=nf(t.firestore,Ll);e.ff();const n=new Zo;return e.af.Ii(async()=>{const s=await xl(e);await ol(s,e.af,t.f_,{source:"server"},n)}),n.promise.then(n=>rf(e,t,n))},t.getDocs=function(t){const e=nf(t.firestore,Ll);e.ff(),wl(t.wf);const n=new Zo;return e.af.Ii(async()=>{const s=await xl(e);await al(s,e.af,t.wf,{source:"default"},n)}),n.promise.then(n=>new Jl(e,t,n))},t.getDocsFromCache=function(t){const e=nf(t.firestore,Ll);e.ff();const n=new Zo;return e.af.Ii(async()=>{const s=await Dl(e);await async function(t,e,n){try{const s=await Ch(t,e,!0),i=new Du(e,s.kc),r=i.Th(s.documents),o=i.Jn(r,!1);n.resolve(o.snapshot)}catch(t){const s=pa(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(s,t.wf,n)}),n.promise.then(n=>new Jl(e,t,n))},t.getDocsFromServer=function(t){const e=nf(t.firestore,Ll);e.ff();const n=new Zo;return e.af.Ii(async()=>{const s=await xl(e);await al(s,e.af,t.wf,{source:"server"},n)}),n.promise.then(n=>new Jl(e,t,n))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new Vc("increment",t)},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&n.cacheSizeBytes!==fl&&n.cacheSizeBytes<ya.nr)throw new xs(As.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ya.nr);return s.W_(n),s},t.limit=function(t){return _c("limit",1,t),new Ul("limit",t,"F")},t.limitToLast=function(t){return _c("limitToLast",1,t),new Ul("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,i;let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||cl(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(cl(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let h,u,c;t instanceof Cl?(u=nf(t.firestore,Ll),c=po(t.f_.path),h={next:n=>{e[o]&&e[o](rf(u,t,n))},error:e[o+1],complete:e[o+2]}):(u=nf(t.firestore,Ll),c=t.wf,h={next:n=>{e[o]&&e[o](new Jl(u,t,n))},error:e[o+1],complete:e[o+2]},wl(t.wf)),u.ff();const l=new gc(h),f=new pu(c,l,a);return u.af.Ii(async()=>lu(await xl(u),f)),()=>{l.Xl(),u.af.Ii(async()=>fu(await xl(u),f))}},t.onSnapshotsInSync=function(t,e){t.ff();const n=cl(e)?e:{next:e},s=new gc(n);return t.af.Ii(async()=>{!function(t,e){Ns(t).Ga.add(e),e.next()}(await xl(t),s)}),()=>{s.Xl(),t.af.Ii(async()=>{!function(t,e){Ns(t).Ga.delete(e)}(await xl(t),s)})}},t.orderBy=function(t,e="asc"){const n=e,s=Wl("orderBy",t);return new Ml(s,n)},t.query=function(t,...e){for(const n of e)t=n.Ef(t);return t},t.queryEqual=Bl,t.refEqual=function(t,e){return(t instanceof Cl||t instanceof Gl)&&(e instanceof Cl||e instanceof Gl)&&t.firestore===e.firestore&&t.path===e.path&&t.d_===e.d_},t.runTransaction=function(t,e){t.ff();const n=new Zo;return t.af.Ii(async()=>{const s=await function(t){var e,n;if(t.K_)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.");if(!hl.has(t)){vs("ComponentProvider","Initializing Datastore");const s=t.G_(),i=new Gs(t.__,t.k_,null!==(e=s.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=s.ssl)||void 0===n||n,!1),r=hc(i),o=uc(i.st),a=Fh(t.B_,r,o);hl.set(t,a)}return hl.get(t)}(t);new rl(new da,s,n=>e(new ef(t,n)),n).run()}),n.promise},t.serverTimestamp=function(){return new Rc("serverTimestamp")},t.setDoc=function(t,e,n){const s=nf(t.firestore,Ll);s.ff();const i=yl(t.d_,e,n);return sf(s,Kc(zl(s),"setDoc",t.f_,i,null!==t.d_,n).w_(t.f_,Gr.nn()))},t.setLogLevel=function(t){ws.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof Yl&&e instanceof Yl?t.pf===e.pf&&t.f_.isEqual(e.f_)&&(null===t.yf?null===e.yf:t.yf.isEqual(e.yf))&&t.d_===e.d_:t instanceof Jl&&e instanceof Jl&&t.pf===e.pf&&Bl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.vf.isEqual(e.vf)},t.startAfter=function(...t){return new ql("startAfter",t,!1)},t.startAt=function(...t){return new ql("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),t._delete()},t.updateDoc=function(t,e,n,...s){const i=nf(t.firestore,Ll);i.ff();const r=zl(i);let o;return sf(i,(o="string"==typeof e||e instanceof Rl?Xc(r,"updateDoc",t.f_,e,n,s):Hc(r,"updateDoc",t.f_,e)).w_(t.f_,Gr.exists(!0)))},t.waitForPendingWrites=function(t){t.ff();const e=new Zo;return t.af.Ii(async()=>(async function(t,e){const n=Ns(t);Qh(n.Sh)||vs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await function(t){const e=Ns(n.va);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.es.Fr(t))}();if(-1===s)return void e.resolve();const i=n.Bh.get(s)||[];i.push(e),n.Bh.set(s,i)}catch(t){const n=pa(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(await Nl(t),e)),e.promise},t.where=function(t,e,n){const s=e,i=Wl("where",t);return new Pl(i,s,n)},t.writeBatch=function(t){return t.ff(),new Zl(t,e=>sf(t,e))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});