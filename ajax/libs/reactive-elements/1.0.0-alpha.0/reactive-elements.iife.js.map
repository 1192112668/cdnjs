{"version":3,"file":"reactive-elements.iife.js","sources":["../src/utils.js","../src/reactive-elements.js"],"sourcesContent":["import * as React from 'react';\nconst noBooleanTransformName = 'reactive-elements-no-boolean-transform';\n\nfunction getAllProperties(obj) {\n  const props = {};\n  while (obj && obj !== React.Component.prototype && obj !== Object.prototype) {\n    var propNames = Object.getOwnPropertyNames(obj);\n    for (var i = 0; i < propNames.length; i++) {\n      props[propNames[i]] = null;\n    }\n    obj = Object.getPrototypeOf(obj);\n  }\n  delete props.constructor;\n  return Object.keys(props);\n}\n\nfunction extend(extensible, extending) {\n  const props = getAllProperties(extending);\n  for (var i = 0; i < props.length; i++) {\n    var prop = props[i];\n    if (!(prop in extensible)) {\n      var val = extending[prop];\n      extensible[prop] = val;\n    }\n  }\n}\n\nfunction elementHasNoBooleanTransformAttribute(el) {\n  let foundAttribute = false;\n  for (var i = 0; i < el.attributes.length; i++) {\n    var attribute = el.attributes[i];\n    if (attribute.name === noBooleanTransformName) {\n      foundAttribute = true;\n      break;\n    }\n  }\n  return foundAttribute;\n}\n\nfunction getProps(el) {\n  const props = {};\n  const noBooleanTransforms = elementHasNoBooleanTransformAttribute(el);\n\n  for (var i = 0; i < el.attributes.length; i++) {\n    var attribute = el.attributes[i];\n    if (attribute.name === noBooleanTransformName) continue;\n\n    var name = attributeNameToPropertyName(attribute.name);\n    props[name] = parseAttributeValue(attribute.value, {\n      noBooleanTransforms: noBooleanTransforms,\n    });\n  }\n\n  props.container = el;\n\n  return props;\n}\n\nfunction getterSetter(\n  variableParent,\n  variableName,\n  getterFunction,\n  setterFunction\n) {\n  if (Object.defineProperty) {\n    Object.defineProperty(variableParent, variableName, {\n      get: getterFunction,\n      set: setterFunction,\n    });\n  } else if (document.__defineGetter__) {\n    variableParent.__defineGetter__(variableName, getterFunction);\n    variableParent.__defineSetter__(variableName, setterFunction);\n  }\n\n  variableParent['get' + variableName] = getterFunction;\n  variableParent['set' + variableName] = setterFunction;\n}\n\nfunction attributeNameToPropertyName(attributeName) {\n  return attributeName\n    .replace(/^(x|data)[-_:]/i, '')\n    .replace(/[-_:](.)/g, function(x, chr) {\n      return chr.toUpperCase();\n    });\n}\n\nfunction parseAttributeValue(value, transformOptions) {\n  if (value == undefined) {\n    return null;\n  }\n\n  if (!transformOptions) {\n    transformOptions = {};\n  }\n\n  // Support attribute values with newlines\n  value = value.replace(/[\\n\\r]/g, '');\n\n  var pointerRegexp = /^{.*?}$/i,\n    jsonRegexp = /^{{2}.*}{2}$/,\n    jsonArrayRegexp = /^{\\[.*\\]}$/;\n\n  var pointerMatches = value.match(pointerRegexp),\n    jsonMatches = value.match(jsonRegexp) || value.match(jsonArrayRegexp);\n\n  if (jsonMatches) {\n    value = JSON.parse(jsonMatches[0].replace(/^{|}$/g, ''));\n  } else if (pointerMatches) {\n    value = eval(pointerMatches[0].replace(/[{}]/g, ''));\n  } else if (\n    (value === 'true' || value === 'false') &&\n    !transformOptions.noBooleanTransforms\n  ) {\n    // convert the value to its actual boolean\n    value = value === 'true';\n  }\n\n  return value;\n}\n\nfunction getChildren(el) {\n  const fragment = document.createDocumentFragment();\n  while (el.childNodes.length) {\n    fragment.appendChild(el.childNodes[0]);\n  }\n  return fragment;\n}\n\nfunction shallowCopy(a, b) {\n  for (const key in b) a[key] = b[key];\n  return a;\n}\n\nexport {\n  getAllProperties,\n  extend,\n  elementHasNoBooleanTransformAttribute,\n  getProps,\n  getterSetter,\n  attributeNameToPropertyName,\n  parseAttributeValue,\n  getChildren,\n  shallowCopy,\n};\n","import * as utils from './utils';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nfunction reactiveElements(elementName, ReactComponent, options) {\n  function create(parent, props) {\n    var element = React.createElement(ReactComponent, props);\n    parent.reactiveElement = element;\n    return ReactDOM.render(element, parent.shadowRoot, props.onRender);\n  }\n\n  function exposeDefaultMethods(reactComponent, customElement) {\n    customElement.forceUpdate = reactComponent.forceUpdate.bind(reactComponent);\n  }\n\n  function exposeMethods(reactComponent, customElement) {\n    utils.extend(customElement, reactComponent);\n  }\n\n  class CustomElement extends HTMLElement {\n    constructor() {\n      const self = super();\n\n      self.attachShadow({ mode: 'open' });\n\n      const observer = new MutationObserver(() => {\n        ReactDOM.unmountComponentAtNode(self.shadowRoot);\n        const props = utils.getProps(self);\n        props.children = utils.getChildren(self);\n        create(self, props);\n      });\n\n      observer.observe(self, {\n        childList: true,\n        subtree: true,\n        characterData: true,\n        attributes: true,\n      });\n    }\n\n    connectedCallback() {\n      const props = utils.getProps(this);\n      props.children = utils.getChildren(this);\n      let reactElement = create(this, props);\n\n      if (reactElement !== null) {\n        exposeMethods(reactElement, reactElement.props.container);\n        exposeDefaultMethods(reactElement, reactElement.props.container);\n\n        utils.getterSetter(\n          this,\n          'props',\n          function() {\n            return reactElement.props;\n          },\n          function(props) {\n            reactElement = create(this, props);\n          }\n        );\n      }\n    }\n\n    disconnectedCallback() {\n      ReactDOM.unmountComponentAtNode(this.shadowRoot);\n    }\n  }\n\n  customElements.define(elementName, CustomElement);\n\n  return CustomElement;\n}\n\nreactiveElements.utils = utils;\nexport default reactiveElements;\n"],"names":["noBooleanTransformName","getAllProperties","obj","props","React","prototype","Object","propNames","getOwnPropertyNames","i","length","getPrototypeOf","constructor","keys","extend","extensible","extending","prop","val","elementHasNoBooleanTransformAttribute","el","foundAttribute","attributes","attribute","name","getProps","noBooleanTransforms","attributeNameToPropertyName","parseAttributeValue","value","container","getterSetter","variableParent","variableName","getterFunction","setterFunction","defineProperty","get","set","document","__defineGetter__","__defineSetter__","attributeName","replace","x","chr","toUpperCase","transformOptions","undefined","pointerRegexp","jsonRegexp","jsonArrayRegexp","pointerMatches","match","jsonMatches","JSON","parse","eval","getChildren","fragment","createDocumentFragment","childNodes","appendChild","shallowCopy","a","b","key","reactiveElements","elementName","ReactComponent","options","create","parent","element","reactiveElement","ReactDOM","shadowRoot","onRender","exposeDefaultMethods","reactComponent","customElement","forceUpdate","bind","exposeMethods","utils","CustomElement","self","attachShadow","mode","observer","MutationObserver","children","observe","childList","subtree","characterData","reactElement","HTMLElement","customElements","define"],"mappings":"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"}