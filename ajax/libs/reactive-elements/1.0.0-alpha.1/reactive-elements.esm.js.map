{"version":3,"file":"reactive-elements.esm.js","sources":["../src/utils.js","../src/reactive-elements.js"],"sourcesContent":["import * as React from 'react';\nconst noBooleanTransformName = 'reactive-elements-no-boolean-transform';\n\nfunction getAllProperties(obj) {\n  const props = {};\n  while (obj && obj !== React.Component.prototype && obj !== Object.prototype) {\n    var propNames = Object.getOwnPropertyNames(obj);\n    for (var i = 0; i < propNames.length; i++) {\n      props[propNames[i]] = null;\n    }\n    obj = Object.getPrototypeOf(obj);\n  }\n  delete props.constructor;\n  return Object.keys(props);\n}\n\nfunction extend(extensible, extending) {\n  const props = getAllProperties(extending);\n  for (var i = 0; i < props.length; i++) {\n    var prop = props[i];\n    if (!(prop in extensible)) {\n      var val = extending[prop];\n      extensible[prop] = val;\n    }\n  }\n}\n\nfunction elementHasNoBooleanTransformAttribute(el) {\n  let foundAttribute = false;\n  for (var i = 0; i < el.attributes.length; i++) {\n    var attribute = el.attributes[i];\n    if (attribute.name === noBooleanTransformName) {\n      foundAttribute = true;\n      break;\n    }\n  }\n  return foundAttribute;\n}\n\nfunction getProps(el) {\n  const props = {};\n  const noBooleanTransforms = elementHasNoBooleanTransformAttribute(el);\n\n  for (var i = 0; i < el.attributes.length; i++) {\n    var attribute = el.attributes[i];\n    if (attribute.name === noBooleanTransformName) continue;\n\n    var name = attributeNameToPropertyName(attribute.name);\n    props[name] = parseAttributeValue(attribute.value, {\n      noBooleanTransforms: noBooleanTransforms,\n    });\n  }\n\n  props.container = el;\n\n  return props;\n}\n\nfunction getterSetter(\n  variableParent,\n  variableName,\n  getterFunction,\n  setterFunction\n) {\n  if (Object.defineProperty) {\n    Object.defineProperty(variableParent, variableName, {\n      get: getterFunction,\n      set: setterFunction,\n    });\n  } else if (document.__defineGetter__) {\n    variableParent.__defineGetter__(variableName, getterFunction);\n    variableParent.__defineSetter__(variableName, setterFunction);\n  }\n\n  variableParent['get' + variableName] = getterFunction;\n  variableParent['set' + variableName] = setterFunction;\n}\n\nfunction attributeNameToPropertyName(attributeName) {\n  return attributeName\n    .replace(/^(x|data)[-_:]/i, '')\n    .replace(/[-_:](.)/g, function(x, chr) {\n      return chr.toUpperCase();\n    });\n}\n\nfunction parseAttributeValue(value, transformOptions) {\n  if (value == undefined) {\n    return null;\n  }\n\n  if (!transformOptions) {\n    transformOptions = {};\n  }\n\n  // Support attribute values with newlines\n  value = value.replace(/[\\n\\r]/g, '');\n\n  var pointerRegexp = /^{.*?}$/i,\n    jsonRegexp = /^{{2}.*}{2}$/,\n    jsonArrayRegexp = /^{\\[.*\\]}$/;\n\n  var pointerMatches = value.match(pointerRegexp),\n    jsonMatches = value.match(jsonRegexp) || value.match(jsonArrayRegexp);\n\n  if (jsonMatches) {\n    value = JSON.parse(jsonMatches[0].replace(/^{|}$/g, ''));\n  } else if (pointerMatches) {\n    value = eval(pointerMatches[0].replace(/[{}]/g, ''));\n  } else if (\n    (value === 'true' || value === 'false') &&\n    !transformOptions.noBooleanTransforms\n  ) {\n    // convert the value to its actual boolean\n    value = value === 'true';\n  }\n\n  return value;\n}\n\nfunction getChildren(el) {\n  const fragment = document.createDocumentFragment();\n  while (el.childNodes.length) {\n    fragment.appendChild(el.childNodes[0]);\n  }\n  return fragment;\n}\n\nfunction shallowCopy(a, b) {\n  for (const key in b) a[key] = b[key];\n  return a;\n}\n\nexport {\n  getAllProperties,\n  extend,\n  elementHasNoBooleanTransformAttribute,\n  getProps,\n  getterSetter,\n  attributeNameToPropertyName,\n  parseAttributeValue,\n  getChildren,\n  shallowCopy,\n};\n","import * as utils from './utils';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nconst getRenderRoot = (element, useShadowDom) =>\n  useShadowDom ? element.shadowRoot : element;\n\nfunction reactiveElements(elementName, ReactComponent, options) {\n  const { useShadowDom = false } = options;\n\n  function create(parent, props) {\n    var element = React.createElement(ReactComponent, props);\n    parent.reactiveElement = element;\n    return ReactDOM.render(\n      element,\n      getRenderRoot(parent, useShadowDom),\n      props.onRender\n    );\n  }\n\n  function exposeDefaultMethods(reactComponent, customElement) {\n    customElement.forceUpdate = reactComponent.forceUpdate.bind(reactComponent);\n  }\n\n  function exposeMethods(reactComponent, customElement) {\n    utils.extend(customElement, reactComponent);\n  }\n\n  class CustomElement extends HTMLElement {\n    constructor() {\n      const self = super();\n\n      if (useShadowDom) self.attachShadow({ mode: 'open' });\n\n      const observer = new MutationObserver(() => {\n        ReactDOM.unmountComponentAtNode(getRenderRoot(self, useShadowDom));\n        const props = utils.getProps(self);\n        props.children = utils.getChildren(self);\n        create(self, props);\n      });\n\n      observer.observe(self, {\n        childList: true,\n        subtree: true,\n        characterData: true,\n        attributes: true,\n      });\n    }\n\n    connectedCallback() {\n      const props = utils.getProps(this);\n      props.children = utils.getChildren(this);\n      let reactElement = create(this, props);\n\n      if (reactElement !== null) {\n        exposeMethods(reactElement, reactElement.props.container);\n        exposeDefaultMethods(reactElement, reactElement.props.container);\n\n        utils.getterSetter(\n          this,\n          'props',\n          function() {\n            return reactElement.props;\n          },\n          function(props) {\n            reactElement = create(this, props);\n          }\n        );\n      }\n    }\n\n    disconnectedCallback() {\n      ReactDOM.unmountComponentAtNode(getRenderRoot(this, useShadowDom));\n    }\n  }\n\n  customElements.define(elementName, CustomElement);\n\n  return CustomElement;\n}\n\nreactiveElements.utils = utils;\nexport default reactiveElements;\n"],"names":["noBooleanTransformName","getAllProperties","obj","props","React","prototype","Object","propNames","getOwnPropertyNames","i","length","getPrototypeOf","constructor","keys","extend","extensible","extending","prop","val","elementHasNoBooleanTransformAttribute","el","foundAttribute","attributes","attribute","name","getProps","noBooleanTransforms","attributeNameToPropertyName","parseAttributeValue","value","container","getterSetter","variableParent","variableName","getterFunction","setterFunction","defineProperty","get","set","document","__defineGetter__","__defineSetter__","attributeName","replace","x","chr","toUpperCase","transformOptions","undefined","pointerRegexp","jsonRegexp","jsonArrayRegexp","pointerMatches","match","jsonMatches","JSON","parse","eval","getChildren","fragment","createDocumentFragment","childNodes","appendChild","shallowCopy","a","b","key","getRenderRoot","element","useShadowDom","shadowRoot","reactiveElements","elementName","ReactComponent","options","create","parent","reactiveElement","ReactDOM","onRender","exposeDefaultMethods","reactComponent","customElement","forceUpdate","bind","exposeMethods","utils","CustomElement","self","attachShadow","mode","observer","MutationObserver","children","observe","childList","subtree","characterData","reactElement","HTMLElement","customElements","define"],"mappings":"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"}