var App=function(){function e(n,e,t,r){var o=this;this._=r,this.dynamicButton=null,this.signals=new Observable,this.on=this.signals.on,this.off=this.signals.off;var a=document.querySelector("body"),i=document.getElementById("linenumbers"),s=document.getElementById("linemarker"),l=document.getElementById("textarea"),c=document.getElementById("canvas"),u=document.getElementById("canvas-panner");this.editor=e.fromTextArea(l,{lineNumbers:!0,mode:"nomnoml",matchBrackets:!0,theme:"solarized light",keyMap:"sublime"}),this.editor.on("drop",function(e,t){var n=t.dataTransfer.files;"image/svg+xml"==n[0].type&&(t.preventDefault(),o.handleOpeningFiles(n))});var f=this.editor.getWrapperElement();this.filesystem=new FileSystem;var h=new DevEnv(f,s,i);this.panner=new CanvasPanner(u,function(){return o.sourceChanged()},r.throttle),this.downloader=new DownloadLinks(c,t),new HoverMarker("canvas-mode",a,[u]),this.defaultSource=(document.getElementById("defaultGraph")||{innerHTML:""}).innerHTML;function d(){p=null,o.filesystem.configureByRoute(location.hash);var e=o.filesystem.storage.read()||"";o.editor.setValue(e||o.defaultSource),o.sourceChanged()}var p=null;window.addEventListener("hashchange",d),window.addEventListener("resize",r.throttle(function(){return o.sourceChanged()},750,{leading:!0})),this.editor.on("changes",r.debounce(function(){return o.sourceChanged()},300)),this.sourceChanged=function(){try{h.clearState();var e=o.editor.getValue(),t=n.draw(c,e,o.panner.zoom());p=e,o.panner.positionCanvas(c),o.filesystem.storage.save(e),o.downloader.source=e,o.downloader.setFilename(t.config.title),o.signals.trigger("source-changed",e)}catch(e){h.setError(e),p&&n.draw(c,p,o.panner.zoom()),o.panner.positionCanvas(c)}},d()}return e.prototype.loadSvg=function(e){var t,n=(new DOMParser).parseFromString(e,"text/xml");1===n.getElementsByTagName("desc").length?(t=n.getElementsByTagName("desc")[0].childNodes[0].nodeValue,t=this._.unescape(t),this.editor.setValue(t)):alert("SVG did not have nomnoml code embedded within it.")},e.prototype.currentSource=function(){return this.editor.getValue()},e.prototype.magnifyViewport=function(e){this.panner.magnify(e)},e.prototype.resetViewport=function(){this.panner.reset()},e.prototype.toggleSidebar=function(e){for(var t=0,n=["about","reference","export","files"];t<n.length;t++){var r=n[t];e!==r&&document.getElementById(r).classList.remove("visible")}document.getElementById(e).classList.toggle("visible")},e.prototype.discardCurrentGraph=function(){confirm("Do you want to discard current diagram and load the default example?")&&(this.editor.setValue(this.defaultSource),this.sourceChanged())},e.prototype.saveViewModeToStorage=function(){confirm("Do you want to overwrite the diagram in localStorage with the currently viewed diagram?")&&(this.filesystem.moveToLocalStorage(this.currentSource()),window.location.href="./")},e.prototype.exitViewMode=function(){window.location.href="./"},e.prototype.handleOpeningFiles=function(e){var t,n=this;1===e.length?((t=new FileReader).onload=function(){return n.loadSvg(t.result)},t.readAsText(e[0])):alert("You can only upload one file at a time.")},e}(),CanvasPanner=function(){function e(t,n,e){var r=this;this.onChange=n,this.offset={x:0,y:0},this.zoomLevel=0,this.superSampling=window.devicePixelRatio||1;var o=!1;function a(){o=!1,t.style.width="33%"}t.addEventListener("mousedown",function(e){t.style.width="100%",o=nomnoml.skanaar.vector.diff({x:e.pageX,y:e.pageY},r.offset)}),t.addEventListener("mouseup",a),t.addEventListener("mouseleave",a),t.addEventListener("wheel",e(function(e){r.zoomLevel=Math.min(10,r.zoomLevel-(e.deltaY<0?-1:1)),n()},50),{passive:!0}),t.addEventListener("mousemove",e(function(e){0!=o&&(r.offset=nomnoml.skanaar.vector.diff({x:e.pageX,y:e.pageY},o),n())},50),{passive:!0})}return e.prototype.positionCanvas=function(e){var t=window,n=e.width/this.superSampling,r=e.height/this.superSampling;e.style.top=300*(1-r/t.innerHeight)+this.offset.y+"px",e.style.left=150+(t.innerWidth-n)/2+this.offset.x+"px",e.style.width=n+"px",e.style.height=r+"px"},e.prototype.zoom=function(){return this.superSampling*Math.exp(this.zoomLevel/10)},e.prototype.magnify=function(e){this.zoomLevel=Math.min(10,this.zoomLevel+e),this.onChange()},e.prototype.reset=function(){this.zoomLevel=1,this.offset={x:0,y:0},this.onChange()},e}(),DevEnv=function(){function e(e,t,n){this.editor=e,this.marker=t,this.lineNumbers=n}return e.prototype.clearState=function(){this.marker.style.top="-30px",this.lineNumbers.classList.remove("error")},e.prototype.setError=function(e){this.lineNumbers.classList.add("error");var t=e.message.match("line ([0-9]*)");if(!t)throw e;var n=window.getComputedStyle(this.editor).lineHeight,r=parseFloat(n)||12;this.marker.style.top=3+r*t[1]+"px"},e}(),DownloadLinks=function(){function e(e,t){this.canvasElement=e,this.saveAs=t,this.filename="graph",this.source=""}return e.prototype.pngDownload=function(){var t=this,e=this.canvasElement;e.msToBlob?this.saveAs(e.msToBlob(),this.filename+".png"):this.canvasElement.toBlob(function(e){return t.saveAs(e,t.filename+".png")})},e.prototype.svgDownload=function(){var e=nomnoml.renderSvg(this.source,document);this.saveAs(new Blob([e],{type:"image/svg+xml"}),this.filename+".svg")},e.prototype.srcDownload=function(){var e=this.source;this.saveAs(new Blob([e],{type:"text/txt"}),this.filename+".nomnoml")},e.prototype.setFilename=function(e){e=e||"graph",this.filename=e},e}(),__extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),FileSystem=function(){function e(){this.signals=new Observable,this.on=this.signals.on,this.off=this.signals.off,this.storage=new DefaultGraphStore}return e.prototype.files=function(){return JSON.parse(localStorage["nomnoml.file_index"]||"[]")},e.prototype.setFiles=function(e){localStorage["nomnoml.file_index"]=JSON.stringify(e),this.signals.trigger("updated")},e.prototype.moveToFileStorage=function(e,t){var n={name:e,date:(new Date).toISOString(),backingStore:"local_file"},r=this.files();r.push(n),r.sort(function(e,t){return e.name.localeCompare(t.name)}),localStorage["nomnoml.file_index"]=JSON.stringify(r),new LocalFileGraphStore(n.name).save(t),this.signals.trigger("updated")},e.prototype.moveToLocalStorage=function(e){this.storage=new DefaultGraphStore,this.storage.save(e)},e.prototype.discard=function(t){new LocalFileGraphStore(t.name).clear(),this.setFiles(this.files().filter(function(e){return e.name!=t.name})),this.signals.trigger("updated")},e.prototype.configureByRoute=function(e){var t=Route.from(e);this.storage=this.routedStorage(t),this.activeFile=nomnoml.skanaar.find(this.files(),function(e){return e.name===t.path})||{name:t.path,date:(new Date).toISOString(),backingStore:"local_file"},this.signals.trigger("updated")},e.prototype.routedStorage=function(e){return"view"===e.context?new UrlGraphStore(decodeURIComponent(e.path)):"file"===e.context?new LocalFileGraphStore(e.path):new DefaultGraphStore},e}(),LocalGraphStore=function(){function e(e){this.key=e}return e.prototype.read=function(){return localStorage[this.key]},e.prototype.save=function(e){localStorage[this.key]=e},e.prototype.clear=function(){localStorage.removeItem(this.key)},e}(),LocalFileGraphStore=function(n){function e(e){var t=n.call(this,"nomnoml.files/"+e)||this;return t.kind="local_file",t}return __extends(e,n),e}(LocalGraphStore),DefaultGraphStore=function(t){function e(){var e=t.call(this,"nomnoml.lastSource")||this;return e.kind="local_default",e}return __extends(e,t),e}(LocalGraphStore),UrlGraphStore=function(){function e(e){this.source=e,this.kind="url"}return e.prototype.read=function(){return this.source},e.prototype.save=function(e){},e.prototype.clear=function(){},e}(),HoverMarker=function(t,n,e){function r(e){return function(){e?n.classList.add(t):n.classList.remove(t)}}for(var o=0,a=e;o<a.length;o++){var i=a[o];i.addEventListener("mouseenter",r(!0)),i.addEventListener("mouseleave",r(!1))}},icons={"link-outline":"M17.5 6c.3 0 .6.1.8.3.4.5.4 1.1 0 1.6l-1.7 1.7.3.3c.5.6.9 1.4.9 2.2s-.4 1.6-1 2.2l-4.1 4.2c-.6.5-1.4.9-2.2.9s-1.6-.4-2.2-1l-.3-.2-1.7 1.7a1 1 0 0 1-1.6 0c-.4-.5-.4-1.1 0-1.6l1.7-1.7-.3-.3c-.5-.6-.9-1.4-.9-2.2s.4-1.6 1-2.2l4.1-4.2c.6-.5 1.4-.8 2.2-.8s1.6.3 2.2.8l.3.3 1.7-1.7c.2-.2.5-.3.8-.3m0-2a3 3 0 0 0-2.2 1l-.5.4a5.2 5.2 0 0 0-5.9 1l-4.2 4a5 5 0 0 0-1 6l-.4.5a3 3 0 0 0 0 4.4 3 3 0 0 0 4.4 0l.5-.5a5 5 0 0 0 5.9-1l4.2-4a5 5 0 0 0 1-6l.4-.5a3 3 0 0 0 0-4.4 3 3 0 0 0-2.2-.9zm-6.1 7.2a2 2 0 0 0 2 2L11.6 15a2 2 0 0 0-2-2l1.8-1.8M12.5 9c-.2 0-.5.1-.6.3l-4.2 4.2c-.2.1-.3.4-.3.6 0 .2.1.5.3.6l.3.3.7-.7a1 1 0 0 1 1.6 0c.4.5.4 1.1 0 1.6l-.7.7.3.3c.1.2.4.3.6.3l.6-.3 4.2-4.2c.2-.1.3-.4.3-.6 0-.2-.1-.5-.3-.6l-.3-.3-.7.7a1 1 0 0 1-1.6 0c-.4-.5-.4-1.1 0-1.6l.7-.7-.3-.3a.9.9 0 0 0-.6-.3z","camera-outline":"M19 20h-14c-1.6 0-3-1.3-3-3v-8c0-1.6 1.3-3 3-3h1.5l1-1c.5-.5 1.5-1 2.4-1h4c.8 0 1.8.4 2.4 1l1 1h1.5c1.6 0 3 1.3 3 3v8c0 1.6-1.3 3-3 3zm-14-12c-.5 0-1 .4-1 1v8c0 .5.4 1 1 1h14c.5 0 1-.4 1-1v-8c0-.5-.4-1-1-1h-2c-.2 0-.52-.1-.7-.2l-1.2-1.2c-.2-.2-.7-.4-1-.4h-4c-.2 0-.7.2-1 .4l-1.2 1.2c-.1.1-.4.2-.7.2h-2zM12 10c1.3 0 2.5 1.1 2.5 2.5s-1.1 2.5-2.5 2.5-2.5-1.1-2.5-2.5 1.1-2.5 2.5-2.5m0-1c-1.9 0-3.5 1.5-3.5 3.5 0 1.9 1.5 3.5 3.5 3.5s3.5-1.5 3.5-3.5c0-1.9-1.5-3.5-3.5-3.5zM18 8.6c-.7 0-1.3.5-1.3 1.3s.5 1.2 1.3 1.2 1.3-.58 1.3-1.2-.5-1.3-1.3-1.3z","image-outline":"M8.5 7.9c.8 0 1.5.6 1.5 1.5s-.6 1.5-1.5 1.5-1.5-.6-1.5-1.5.6-1.5 1.5-1.5m0-1c-1.3 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5-1.1-2.5-2.5-2.5zM16 11.9c.45.0 1.27 1.8 1.7 4.0h-11.3c.4-1.0 1.0-2.0 1.6-2.0.8 0 1.1.1 1.53.42.4.2 1.0.58 1.97.58 1.1 0 1.9-.8 2.6-1.6.6-.6 1.2-1.3 1.8-1.3m0-1c-2 0-3 3-4.5 3s-1.4-1-3.5-1c-2 0-3.0 4-3.0 4h14.0s-1-6-3-6zM22 6c0-1.1-.8-2-2-2h-16c-1.1 0-2 .8-2 2v12c0 1.1.8 2 2 2h16c1.1 0 2-.8 2-2v-12zm-2 12h-16v-12h16.0l-.0 12z","download-outline":"M20.9 17c0-.1-.0-.2-.0-.3l-2-6c-.1-.4-.5-.6-.9-.6h-.5l.6-.6c1.17-1.17 1.17-3.0 0-4.2-.81-.8-2.0-1.0-3.1-.7v-1.3c0-1.6-1.3-3-3-3s-3 1.3-3 3v1.3c-1.0-.3-2.3-.1-3.1.7-1.17 1.17-1.17 3.0.0 4.2l.68.6h-.5c-.4 0-.8.2-.9.6l-2 6c-.0.1-.0.2-.0.3-.0 0-.0 5-.0 5 0 .5.4 1 1 1h16c.5 0 1-.4 1-1 0 0 0-5-.0-5zm-13.6-10.5c.1-.1.4-.2.7-.2s.5.1.7.2l2.2 2.2v-5.7c0-.5.4-1 1-1s1 .4 1 1v5.7l2.2-2.2c.3-.3 1.0-.3 1.4 0 .3.39.3 1.0.0 1.4l-4.7 4.6-4.7-4.6c-.3-.3-.3-1.0 0-1.4zm-.5 5.5h1.8l3.4 3.41 3.4-3.41h1.8l1.6 5h-13.8l1.6-5zm12.2 9h-14v-3h14v3z","document-add":"M15 12h-2v-2c0-.5-.4-1-1-1s-1 .4-1 1v2h-2c-.5 0-1 .4-1 1s.4 1 1 1h2v2c0 .5.4 1 1 1s1-.4 1-1v-2h2c.5 0 1-.4 1-1s-.4-1-1-1zM19.7 7.2l-4-4c-.1-.1-.4-.2-.7-.2h-8c-1.6 0-3 1.3-3 3v12c0 1.6 1.3 3 3 3h10c1.6 0 3-1.3 3-3v-10c0-.2-.1-.52-.2-.7zm-2.1.7h-1.0c-.8 0-1.5-.6-1.5-1.5v-1.0l2.5 2.5zm-.5 11h-10c-.5 0-1-.4-1-1v-12c0-.5.4-1 1-1h7v1.5c0 1.3 1.1 2.5 2.5 2.5h1.5v9c0 .5-.4 1-1 1z","home-outline":"M22.2 10.4c-3.39-2.8-9.5-8.1-9.6-8.2l-.6-.5-.6.5c-.0.0-6.2 5.3-9.66 8.2-.4.3-.6.9-.6 1.5 0 1.1.8 2 2 2h1v6c0 1.1.8 2 2 2h12c1.1 0 2-.8 2-2v-6h1c1.1 0 2-.8 2-2 0-.5-.2-1.1-.7-1.5zm-8.2 9.5h-4v-5h4v5zm4-8l.0 8h-3.0v-6h-6v6h-3v-8h-3.0c2.7-2.3 7.3-6.2 9.0-7.68 1.6 1.4 6.2 5.3 9 7.6l-3-.0z",trash:"M18 7h-1v-1c0-1.1-.8-2-2-2h-7c-1.1 0-2 .8-2 2v1h-1c-.5 0-1 .4-1 1s.4 1 1 1v8c0 2.2 1.7 4 4 4h5c2.2 0 4-1.7 4-4v-8c.5 0 1-.4 1-1s-.4-1-1-1zm-10-1h7v1h-7v-1zm8 11c0 1.1-.8 2-2 2h-5c-1.1 0-2-.8-2-2v-8h9v8zM8.5 10.5c-.2 0-.5.2-.5.5v6c0 .2.2.5.5.5s.5-.2.5-.5v-6c0-.2-.2-.5-.5-.5zM10.5 10.5c-.2 0-.5.2-.5.5v6c0 .2.2.5.5.5s.5-.2.5-.5v-6c0-.2-.2-.5-.5-.5zM12.5 10.5c-.2 0-.5.2-.5.5v6c0 .2.2.5.5.5s.5-.2.5-.5v-6c0-.2-.2-.5-.5-.5zM14.5 10.5c-.2 0-.5.2-.5.5v6c0 .2.2.5.5.5s.5-.2.5-.5v-6c0-.2-.2-.5-.5-.5z",plus:"M18 10h-4v-4c0-1.1-.8-2-2-2s-2 .8-2 2l.0 4h-4.0c-1.1 0-2 .8-2 2s.8 2 2 2l4.0-.0-.0 4.0c0 1.1.8 2 2 2s2-.8 2-2v-4.0l4 .0c1.1 0 2-.8 2-2s-.8-2-2-2z",equals:"M18 7h-12c-1.1 0-2 .8-2 2s.8 2 2 2h12c1.1 0 2-.8 2-2s-.8-2-2-2zM18 14h-12c-1.1 0-2 .8-2 2s.8 2 2 2h12c1.1 0 2-.8 2-2s-.8-2-2-2z",minus:"M18 11h-12c-1.1 0-2 .8-2 2s.8 2 2 2h12c1.1 0 2-.8 2-2s-.8-2-2-2z","info-outline":"M14.2 16l.6-1c.8-1.7.9-3.3.2-4.6a4 4 0 0 0-.4-.7 4 4 0 1 0-5-1.6 6.7 6.7 0 0 0-3 1.4A2 2 0 0 0 7.9 13l-.6 1c-.8 1.7-.9 3.3-.2 4.6.5 1.2 1.6 2 3 2.3a6.3 6.3 0 0 0 5.3-1.4 2 2 0 0 0-1-3.5zM13 4a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm-1.8 15h-.9C8.7 18.5 8 17 9 15l1-2c.5-1 .5-1.6-.1-2-.2-.2-.4-.2-.7-.2L8 11s1.1-1 2.8-1h.9c1.6.4 2.3 2 1.3 4l-1 2c-.5 1-.5 1.6.1 2 .2.2.4.2.7.2L14 18s-1.1 1-2.8 1z","document-text":"M17 21H7a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3zM7 5a1 1 0 0 0-1 1v12c0 .6.4 1 1 1h10c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H7zm9 6H8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 0 1zm0-3H8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 0 1zm0 6H8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 0 1zm0 3H8a.5.5 0 0 1 0-1h8a.5.5 0 0 1 0 1z","arrow-down-outline":"M12 21.312l-7.121-7.121c-1.17-1.17-1.17-3.073 0-4.242 1.094-1.094 2.978-1.138 4.121-.115v-4.834c0-1.654 1.346-3 3-3s3 1.346 3 3v4.834c1.143-1.023 3.027-.979 4.121.115 1.17 1.169 1.17 3.072 0 4.242l-7.121 7.121zm-5-10.242c-.268 0-.518.104-.707.293-.391.39-.391 1.023 0 1.414l5.707 5.707 5.707-5.707c.391-.391.391-1.024 0-1.414-.379-.379-1.035-.379-1.414 0l-3.293 3.293v-9.656c0-.551-.448-1-1-1s-1 .449-1 1v9.656l-3.293-3.293c-.189-.189-.439-.293-.707-.293z","folder-open":"M22.3 8h-2.4c-.4-1.2-1.5-2-2.8-2h-6c0-1.1-.9-2-2-2h-4.1c-1.7 0-3 1.3-3 3v10c0 1.7 1.3 3 3 3h12c1.7 0 3.4-1.3 3.8-3l2.2-8c.1-.6-.2-1-.7-1zm-18.3 1v-2c0-.6.4-1 1-1h4c0 1.1.9 2 2 2h6c.6 0 1 .4 1 1h-11.1c-.6 0-1.1.4-1.3 1l-1.6 6.3v-7.3zm14.9 7.5c-.2.8-1.1 1.5-1.9 1.5h-12s-.4-.2-.2-.8l1.9-7c0-.1.2-.2.3-.2h13.7l-1.8 6.5z","weather-cloudy":"M17 19h-11c-2.2 0-4-1.7-4-4 0-1.8 1.2-3.4 3.0-3.8l-.0-.1c0-3.3 2.6-6 6-6 2.5 0 4.8 1.6 5.65 4.0 2.9-.2 5.35 2.1 5.35 4.9 0 2.7-2.2 5-5 5zm-11.0-6.0c-1.0.0-1.9.9-1.9 2.0s.8 2 2 2h11c1.6 0 3-1.3 3-3s-1.3-3-3-3c-.2 0-.5.0-.81.13l-1.0.3-.1-1.1c-.3-1.9-1.9-3.3-3.9-3.3-2.2 0-4 1.7-4 4 0 .2.0.5.0.8l.2 1.1-1.4-.0z",globe:"M12.1 3.3q2.6 0 4.8 1.3Q19 6 20.3 8.1q1.2 2.1 1.2 4.7t-1.3 4.7Q19 19.7 16.8 21q-2.2 1.3-4.7 1.3-2.6 0-4.8-1.3-2.1-1.3-3.4-3.4-1.2-2.2-1.2-4.7Q2.7 10 4 8q1.2-2.2 3.4-3.4 2.2-1.3 4.7-1.3zm-.7 2.2Q10 6 9.2 8.3q1 .3 2.2.4V5.5zm1.4 3.2q1.1 0 2.2-.4-.7-2.3-2.2-2.8v3.2zm2.6-2.6q.6.9.9 1.8l1-.5q-.8-.7-1.9-1.3zM8 8l.9-1.8q-1 .5-1.8 1.3L8 8zm11.5 4.2q0-2-1.3-3.7-.8.6-1.5.8.3 1.4.4 2.9h2.4zm-11.9-3Q6.9 9 6 8.4 5 10 4.7 12.1h2.5q0-1.5.4-2.9zm3.8.9l-2.6-.5q-.2 1.1-.2 2.5h2.8V10zm4.2 2q0-1.4-.2-2.5l-2.6.5v2h2.8zM4.7 13.4q.3 2 1.4 3.7l1.5-.8q-.3-1.4-.4-2.9H4.7zm3.9 0q0 1.4.2 2.5l2.6-.5v-2H8.6zm4.2 2l2.6.5q.2-1.1.2-2.5h-2.8v2zm3.8.9q.7.2 1.5.8 1.1-1.6 1.3-3.7H17q0 1.5-.4 2.9zM12.8 20q1.5-.5 2.2-2.8l-2.2-.4V20zm-1.4-3.2q-1.1 0-2.2.4.7 2.3 2.2 2.8v-3.2zm-3.5.8L7 18l1.8 1.2-.8-1.7zm8.4 0q-.3 1-.9 1.7 1-.4 1.8-1.2l-1-.5z"};function Icon(e){var t=e.id?icons[e.id]:e.shape;return React.createElement("i",{className:"icon"},React.createElement("svg",{version:"1.2",baseProfile:"tiny",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"},React.createElement("path",{d:t})))}function Menu(e){var t=React.useState(""),n=t[0],r=t[1],o=e.app;return div({className:"tools"},a({className:"logo",onClick:prevent(function(){return o.toggleSidebar("about")}),onMouseLeave:function(){return r("")},onMouseEnter:function(){return r("About nomnoml")}},h1({},"nomnoml ")),a({onClick:prevent(function(){return o.toggleSidebar("about")}),onMouseLeave:function(){return r("")},onMouseEnter:function(){return r("About nomnoml")}},el(Icon,{id:"info-outline"})),a({onClick:prevent(function(){return o.toggleSidebar("reference")}),onMouseLeave:function(){return r("")},onMouseEnter:function(){return r("Language reference")}},el(Icon,{id:"document-text"})),a({onClick:prevent(function(){return o.toggleSidebar("export")}),onMouseLeave:function(){return r("")},onMouseEnter:function(){return r("Export this diagram")}},el(Icon,{id:"arrow-down-outline"})),a({onClick:prevent(function(){return o.toggleSidebar("files")}),onMouseLeave:function(){return r("")},onMouseEnter:function(){return r("Save this or load another diagram")}},el(Icon,{id:"folder-open"})),o.dynamicButton?o.dynamicButton(o,r):a({onClick:prevent(function(){return o.discardCurrentGraph()}),onMouseLeave:function(){return r("")},onMouseEnter:function(){return r("Discard current diagram")}},el(Icon,{id:"trash"})),div({id:"tooltip"},n),el(StorageTools,{app:o}))}var Observable=function(){function e(){this.callbacks={}}return e.prototype.on=function(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)},e.prototype.off=function(e,t){var n,r=this.callbacks[e];r&&(-1!==(n=r.indexOf(t))&&r.splice(n,1),0===r.length&&delete this.callbacks[e])},e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.callbacks[e];r&&r.forEach(function(e){return e.apply(null,t)})},e}(),Route=function(){function n(e,t){this.context=e,this.path=t}return n.from=function(e){var t=e.indexOf("/");return"#"==e[0]&&-1<t?{context:n.urlDecode(e.substr(1,t-1)),path:n.urlDecode(e.substr(t+1))}:{context:null,path:null}},n.urlEncode=function(e){return encodeURIComponent(e).replace(/'/g,"%27").replace(/"/g,"%22")},n.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},n}();function CanvasTools(e){return div({className:"canvas-tools"},div({className:"canvas-button"},a({title:"Zoom in",onClick:prevent(function(){return e.app.magnifyViewport(2)})},el(Icon,{id:"plus"}))),div({className:"canvas-button"},a({title:"Reset zoom and panning",onClick:prevent(function(){return e.app.resetViewport()})},el(Icon,{id:"equals"}))),div({className:"canvas-button"},a({title:"Zoom out",onClick:prevent(function(){return e.app.magnifyViewport(-2)})},el(Icon,{id:"minus"}))))}function DailyTip(e){var t="hide"!=localStorage[e.id],n=React.useState(!0),r=(n[0],n[1]);e.source;return div({className:"alert "+(t?"":"alert-hidden")},b({},e.message),e.source&&pre({},e.source),e.source&&span({dangerouslySetInnerHTML:{__html:nomnoml.renderSvg(e.source)}}),a({className:"alert-close",onClick:prevent(function(){localStorage[e.id]="hide",r(!1)})},"×"))}function ensureType(t,e){if(Array.isArray(t))return Array.isArray(e)?0==t.length?e:e.map(function(e){return ensureType(t[0],e)}).filter(function(e){return void 0!==e}):void 0;if("number"==typeof t)return"number"==typeof e?e:void 0;if("string"==typeof t)return"string"==typeof e?e:void 0;if("boolean"==typeof t)return"boolean"==typeof e?e:void 0;if("object"==typeof t&&"object"==typeof e){for(var n in t)if(void 0===ensureType(t[n],e[n]))return;return e}}function assert(t){return{equal:function(e){equal(t,e)}}}function equal(e,t){if(e!==t){var n=JSON.stringify(e),r=JSON.stringify(t);if(n!==r)throw new Error(n+" != "+r)}}function test_ensureType(){assert(ensureType([],[])).equal([]),assert(ensureType([],[0])).equal([0]),assert(ensureType([0],[])).equal([]),assert(ensureType([0],[0])).equal([0]),assert(ensureType({a:""},{a:""})).equal({a:""}),assert(ensureType({a:""},{a:0})).equal(void 0),assert(ensureType([{a:""}],[{a:0}])).equal([])}function ExportMenu(e){var t=e.app.downloader,n=e.app.downloader.source;return div({className:"file-menu"},a({className:"btn",href:"#view/"+Route.urlEncode(n),target:"_blank"},el(Icon,{id:"link-outline"}),"Open shareable link"),a({className:"btn",href:"image.svg?source="+Route.urlEncode(n),target:"_blank"},el(Icon,{id:"globe"}),"Open linkable SVG"),a({className:"btn",href:"/",onClick:prevent(function(){return t.pngDownload()})},el(Icon,{id:"camera-outline"}),"Download PNG"),a({className:"btn",href:"/",onClick:prevent(function(){return t.svgDownload()})},el(Icon,{id:"image-outline"}),"Download SVG with source"),a({className:"btn",href:"/",onClick:prevent(function(){return t.srcDownload()})},el(Icon,{id:"download-outline"}),"Download source"))}function FileMenu(n){var r=n.app.filesystem,e=r.files(),o="local_file"===r.storage.kind,t="local_default"===r.storage.kind;return div({className:"file-menu"},label({className:"btn"},el(Icon,{id:"image-outline"}),"Open SVG with source...",input({type:"file",accept:"image/svg+xml",onChange:prevent(function(e){var t=e.target.files;n.app.handleOpeningFiles(t)})})),a({className:"btn",href:"/",onClick:prevent(function(){var t=prompt("Name your diagram");if(t){if(r.files().some(function(e){return e.name===t}))return void alert("A file named "+t+" already exists.");r.moveToFileStorage(t,n.app.currentSource()),location.href="#file/"+encodeURIComponent(t)}})},el(Icon,{id:"document-add"}),"Save to local file..."),hr(),h2({},"Local files"),div({className:"file-entry "+(t?"active":"")},a({href:"#"},el(Icon,{id:"home-outline"}),"Home")),e.map(function(t){return div({key:t.name,className:"file-entry "+(e=t,o&&r.activeFile.name===e.name?"active":"")},a({href:"#file/"+encodeURIComponent(t.name).replace(/%20/g,"+")},t.name),a({onClick:prevent(function(){return e=t,void(confirm('Permanently delete "'+e.name+'"')&&r.discard(e));var e}),title:"Discard this diagram"},el(Icon,{id:"trash"})));var e}))}var nomnoml,__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r},el=React.createElement,div=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["div"],e))},span=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["span"],e))},pre=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["pre"],e))},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["b"],e))},h1=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["h1"],e))},h2=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["h2"],e))},label=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["label"],e))},hr=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["label"],e))},a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["a"],e))},input=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return el.apply(void 0,__spreadArrays(["input"],e))};function prevent(t){return function(e){e.preventDefault(),t(e)}}function StorageTools(e){var t="url"==e.app.filesystem.storage.kind,n="local_file"==e.app.filesystem.storage.kind;return div({className:"storage-tools"},span({className:"storage-status "+(t?"visible":"")},"View mode, changes are not saved.",a({onClick:prevent(function(){return e.app.saveViewModeToStorage()}),href:"/",title:"Save this diagram to localStorage"},"save"),a({href:"#",title:"Discard this diagram"},"close")),span({className:"storage-status "+(n?"visible":"")},"Editing local file",a({href:"#",title:"Exit from this file"},"close")))}!function(e){var n;(n=e.skanaar||(e.skanaar={})).vector={dist:function(e,t){return n.vector.mag(n.vector.diff(e,t))},add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},diff:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},mult:function(e,t){return{x:t*e.x,y:t*e.y}},mag:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},normalize:function(e){return n.vector.mult(e,1/n.vector.mag(e))},rot:function(e){return{x:e.y,y:-e.x}}}}(nomnoml=nomnoml||{}),function(e){var s;(s=e.skanaar||(e.skanaar={})).plucker=function(t){switch(typeof t){case"undefined":return function(e){return e};case"string":return function(e){return e[t]};case"number":return function(e){return e[t]};case"function":return t}},s.sum=function(e,t){for(var n=s.plucker(t),r=0,o=0,a=e.length;r<a;r++)o+=n(e[r]);return o},s.flatten=function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);return t},s.find=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]},s.last=function(e){return e[e.length-1]},s.hasSubstring=function(e,t){return""===t||!!e&&-1!==e.indexOf(t)},s.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=e.split("#"),o=[r[0]],a=0;a<r.length-1;a++)o.push(t[a]||""),o.push(r[a+1]);return o.join("")},s.merged=function(e,t){function n(e,t){for(var n in t)e[n]=t[n]}var r={};return n(r,e),n(r,t),r},s.indexBy=function(e,t){for(var n={},r=0;r<e.length;r++)n[e[r][t]]=e[r];return n},s.uniqueBy=function(e,t){for(var n={},r=s.plucker(t),o=[],a=0;a<e.length;a++){var i=r(e[a]);n[i]||(n[i]=!0,o.push(e[a]))}return o}}(nomnoml=nomnoml||{});