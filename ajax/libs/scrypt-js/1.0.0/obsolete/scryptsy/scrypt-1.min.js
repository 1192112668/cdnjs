var pbkdf2Sync=require("pbkdf2").pbkdf2Sync,MAX_VALUE=2147483647;function scrypt(r,f,a,e,i,o,t){if(0===a||0!=(a&a-1))throw Error("N must be > 0 and a power of 2");if(MAX_VALUE/128/e<a)throw Error("Parameter N is too large");if(MAX_VALUE/128/i<e)throw Error("Parameter r is too large");var n=new Buffer(256*e),c=new Buffer(128*e*a),y=new Int32Array(16),u=new Int32Array(16),X=new Buffer(64),p=pbkdf2Sync(r,f,1,128*i*e,"sha256"),s=null;t&&(s=function(){0});for(var Y={i0:0,r:e,N:a,B:p,V:c,XY:n},B=0;B<i;B++)Y.state=0,Y.i0=B,Y.Bi=128*B*e,v(Y);function v(r){r.Xi=0,r.Yi=128*e,r.B.copy(r.XY,r.Xi,r.Bi,r.Bi+r.Yi),r.state=1;for(var f=0;f<a;f++)r.i1=f,r.XY.copy(r.V,r.i1*r.Yi,r.Xi,r.Xi+r.Yi),w(r.XY,r.Xi,r.Yi,r.r),s&&s();r.state=2;for(f=0;f<a;f++){var i=r.Xi+64*(2*r.r-1),o=r.XY.readUInt32LE(i)&r.N-1;A(r.V,o*r.Yi,r.XY,r.Xi,r.Yi),w(r.XY,r.Xi,r.Yi,r.r),s&&s()}r.state=3,n.copy(r.B,r.Bi,r.Xi,r.Xi+r.Yi),r.state=4}function w(r,f,i,o){var a;for(arraycopy(r,f+64*(2*o-1),X,0,64),a=0;a<2*o;a++)A(r,64*a,X,0,64),l(X),arraycopy(X,0,r,i+64*a,64);for(a=0;a<o;a++)arraycopy(r,i+2*a*64,r,f+64*a,64);for(a=0;a<o;a++)arraycopy(r,i+64*(2*a+1),r,f+64*(a+o),64)}function d(r,f){return r<<f|r>>>32-f}function l(r){for(var f=0;f<16;f++)y[f]=(255&r[4*f+0])<<0,y[f]|=(255&r[4*f+1])<<8,y[f]|=(255&r[4*f+2])<<16,y[f]|=(255&r[4*f+3])<<24;for(arraycopy(y,0,u,0,16),f=8;0<f;f-=2)u[4]^=d(u[0]+u[12],7),u[8]^=d(u[4]+u[0],9),u[12]^=d(u[8]+u[4],13),u[0]^=d(u[12]+u[8],18),u[9]^=d(u[5]+u[1],7),u[13]^=d(u[9]+u[5],9),u[1]^=d(u[13]+u[9],13),u[5]^=d(u[1]+u[13],18),u[14]^=d(u[10]+u[6],7),u[2]^=d(u[14]+u[10],9),u[6]^=d(u[2]+u[14],13),u[10]^=d(u[6]+u[2],18),u[3]^=d(u[15]+u[11],7),u[7]^=d(u[3]+u[15],9),u[11]^=d(u[7]+u[3],13),u[15]^=d(u[11]+u[7],18),u[1]^=d(u[0]+u[3],7),u[2]^=d(u[1]+u[0],9),u[3]^=d(u[2]+u[1],13),u[0]^=d(u[3]+u[2],18),u[6]^=d(u[5]+u[4],7),u[7]^=d(u[6]+u[5],9),u[4]^=d(u[7]+u[6],13),u[5]^=d(u[4]+u[7],18),u[11]^=d(u[10]+u[9],7),u[8]^=d(u[11]+u[10],9),u[9]^=d(u[8]+u[11],13),u[10]^=d(u[9]+u[8],18),u[12]^=d(u[15]+u[14],7),u[13]^=d(u[12]+u[15],9),u[14]^=d(u[13]+u[12],13),u[15]^=d(u[14]+u[13],18);for(f=0;f<16;++f)y[f]=u[f]+y[f];for(f=0;f<16;f++){var i=4*f;r[0+i]=y[f]>>0&255,r[1+i]=y[f]>>8&255,r[2+i]=y[f]>>16&255,r[3+i]=y[f]>>24&255}}function A(r,f,i,o,a){for(var e=0;e<a;e++)i[o+e]^=r[f+e]}t(null,1,pbkdf2Sync(r,p,1,o,"sha256"))}function arraycopy(r,f,i,o,a){if(Buffer.isBuffer(r)&&Buffer.isBuffer(i))r.copy(i,o,f,f+a);else for(;a--;)i[o++]=r[f++]}module.exports=scrypt;