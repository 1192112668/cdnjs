var pbkdf2Sync=require("pbkdf2").pbkdf2Sync,MAX_VALUE=2147483647;function scrypt(r,i,o,t,a,n,c){if(0===o||0!=(o&o-1))throw Error("N must be > 0 and a power of 2");if(MAX_VALUE/128/t<o)throw Error("Parameter N is too large");if(MAX_VALUE/128/a<t)throw Error("Parameter r is too large");var e=new Buffer(256*t),f=new Buffer(128*t*o),s=new Int32Array(16),u=new Int32Array(16),y=new Buffer(64),X=pbkdf2Sync(r,i,1,128*a*t,"sha256"),p=null;function Y(r,i,a,e){var f;for(arraycopy(r,i+64*(2*e-1),y,0,64),f=0;f<2*e;f++)k(r,64*f,y,0,64),b(y),arraycopy(y,0,r,a+64*f,64);for(f=0;f<e;f++)arraycopy(r,a+2*f*64,r,i+64*f,64);for(f=0;f<e;f++)arraycopy(r,a+64*(2*f+1),r,i+64*(f+e),64)}function B(r,i){return r<<i|r>>>32-i}function b(r){for(var i=0;i<16;i++)s[i]=(255&r[4*i+0])<<0,s[i]|=(255&r[4*i+1])<<8,s[i]|=(255&r[4*i+2])<<16,s[i]|=(255&r[4*i+3])<<24;for(arraycopy(s,0,u,0,16),i=8;0<i;i-=2)u[4]^=B(u[0]+u[12],7),u[8]^=B(u[4]+u[0],9),u[12]^=B(u[8]+u[4],13),u[0]^=B(u[12]+u[8],18),u[9]^=B(u[5]+u[1],7),u[13]^=B(u[9]+u[5],9),u[1]^=B(u[13]+u[9],13),u[5]^=B(u[1]+u[13],18),u[14]^=B(u[10]+u[6],7),u[2]^=B(u[14]+u[10],9),u[6]^=B(u[2]+u[14],13),u[10]^=B(u[6]+u[2],18),u[3]^=B(u[15]+u[11],7),u[7]^=B(u[3]+u[15],9),u[11]^=B(u[7]+u[3],13),u[15]^=B(u[11]+u[7],18),u[1]^=B(u[0]+u[3],7),u[2]^=B(u[1]+u[0],9),u[3]^=B(u[2]+u[1],13),u[0]^=B(u[3]+u[2],18),u[6]^=B(u[5]+u[4],7),u[7]^=B(u[6]+u[5],9),u[4]^=B(u[7]+u[6],13),u[5]^=B(u[4]+u[7],18),u[11]^=B(u[10]+u[9],7),u[8]^=B(u[11]+u[10],9),u[9]^=B(u[8]+u[11],13),u[10]^=B(u[9]+u[8],18),u[12]^=B(u[15]+u[14],7),u[13]^=B(u[12]+u[15],9),u[14]^=B(u[13]+u[12],13),u[15]^=B(u[14]+u[13],18);for(i=0;i<16;++i)s[i]=u[i]+s[i];for(i=0;i<16;i++){var a=4*i;r[0+a]=s[i]>>0&255,r[1+a]=s[i]>>8&255,r[2+a]=s[i]>>16&255,r[3+a]=s[i]>>24&255}}function k(r,i,a,e,f){for(var o=0;o<f;o++)a[e+o]^=r[i+o]}c&&(p=function(){0}),function r(i){switch(i.state){case 0:i.state=1,i.i0++,i.Bi=128*i.i0*t;break;case 1:i.state=2,i.Xi=0,i.Yi=128*i.r,i.B.copy(i.XY,i.Xi,i.Bi,i.Bi+i.Yi),i.i1=-1;break;case 2:if(i.i1++,i.i1===o){i.i1=-1,i.state=3;break}i.XY.copy(i.V,i.i1*i.Yi,i.Xi,i.Xi+i.Yi),Y(i.XY,i.Xi,i.Yi,i.r);break;case 3:if(i.i1++,i.i1===o){i.state=4;break}var a=i.Xi+64*(2*i.r-1),e=i.XY.readUInt32LE(a)&i.N-1;k(i.V,e*i.Yi,i.XY,i.Xi,i.Yi),Y(i.XY,i.Xi,i.Yi,i.r),p&&p();break;case 4:var f=i.XY.copy(i.B,i.Bi,i.Xi,i.Xi+i.Yi);return void c(null,1,pbkdf2Sync(f,X,1,n,"sha256"))}setTimeout(function(){r(i)},0)}({i0:-1,r:t,N:o,B:X,V:f,XY:e,state:0})}function arraycopy(r,i,a,e,f){if(Buffer.isBuffer(r)&&Buffer.isBuffer(a))r.copy(a,e,i,i+f);else for(;f--;)a[e++]=r[i++]}module.exports=scrypt;