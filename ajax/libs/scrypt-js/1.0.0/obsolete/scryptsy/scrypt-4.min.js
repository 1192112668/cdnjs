var pbkdf2Sync=require("pbkdf2").pbkdf2Sync,MAX_VALUE=2147483647;function scrypt(i,r,o,n,c,t,y){if(!y)throw new Error("missing callback");if(0===o||0!=(o&o-1))throw Error("invalid parameter N");if(MAX_VALUE/128/n<o)throw Error("invalid parameter N");if(MAX_VALUE/128/c<n)throw Error("invalid parameter r");var u,p=new Buffer(256*n),l=new Buffer(128*n*o),e=new Int32Array(16),s=new Int32Array(16),X=new Buffer(64),v=pbkdf2Sync(i,r,1,128*c*n,"sha256"),w=c*o*2,d=0,B=!1,b=0,k=0,E=128*n,A=function(){if(B)return y(new Error("cancelled"));switch(b){case 0:b=1,Bi=128*k*n,Xi=0,v.copy(p,Xi,Bi,Bi+E),b=2,u=0;case 2:1e3<(f=o-u)&&(f=1e3);for(var r=0;r<f;r++)p.copy(l,(u+r)*E,Xi,Xi+E),h(p,Xi,E,n);if(d+=f,(u+=f)<o)break;u=0,b=3,B=y(null,d/w);case 3:var f;1e3<(f=o-u)&&(f=1e3);for(r=0;r<f;r++){var a=Xi+64*(2*n-1),e=p.readUInt32LE(a)&o-1;S(l,e*E,p,Xi,E),h(p,Xi,E,n)}if(d+=f,(u+=f)<o)break;if(B=y(null,d/w),p.copy(v,Bi,Xi,Xi+E),++k<c){b=0;break}return i=pbkdf2Sync(i,v,1,t,"sha256"),y(null,1,i)}setTimeout(A,0)};function h(r,f,a,e){var i;for(arraycopy(r,f+64*(2*e-1),X,0,64),i=0;i<2*e;i++)S(r,64*i,X,0,64),L(X),arraycopy(X,0,r,a+64*i,64);for(i=0;i<e;i++)arraycopy(r,a+2*i*64,r,f+64*i,64);for(i=0;i<e;i++)arraycopy(r,a+64*(2*i+1),r,f+64*(i+e),64)}function m(r,f){return r<<f|r>>>32-f}function L(r){for(var f=0;f<16;f++)e[f]=(255&r[4*f+0])<<0,e[f]|=(255&r[4*f+1])<<8,e[f]|=(255&r[4*f+2])<<16,e[f]|=(255&r[4*f+3])<<24;for(arraycopy(e,0,s,0,16),f=8;0<f;f-=2)s[4]^=m(s[0]+s[12],7),s[8]^=m(s[4]+s[0],9),s[12]^=m(s[8]+s[4],13),s[0]^=m(s[12]+s[8],18),s[9]^=m(s[5]+s[1],7),s[13]^=m(s[9]+s[5],9),s[1]^=m(s[13]+s[9],13),s[5]^=m(s[1]+s[13],18),s[14]^=m(s[10]+s[6],7),s[2]^=m(s[14]+s[10],9),s[6]^=m(s[2]+s[14],13),s[10]^=m(s[6]+s[2],18),s[3]^=m(s[15]+s[11],7),s[7]^=m(s[3]+s[15],9),s[11]^=m(s[7]+s[3],13),s[15]^=m(s[11]+s[7],18),s[1]^=m(s[0]+s[3],7),s[2]^=m(s[1]+s[0],9),s[3]^=m(s[2]+s[1],13),s[0]^=m(s[3]+s[2],18),s[6]^=m(s[5]+s[4],7),s[7]^=m(s[6]+s[5],9),s[4]^=m(s[7]+s[6],13),s[5]^=m(s[4]+s[7],18),s[11]^=m(s[10]+s[9],7),s[8]^=m(s[11]+s[10],9),s[9]^=m(s[8]+s[11],13),s[10]^=m(s[9]+s[8],18),s[12]^=m(s[15]+s[14],7),s[13]^=m(s[12]+s[15],9),s[14]^=m(s[13]+s[12],13),s[15]^=m(s[14]+s[13],18);for(f=0;f<16;++f)e[f]=s[f]+e[f];for(f=0;f<16;f++){var a=4*f;r[0+a]=e[f]>>0&255,r[1+a]=e[f]>>8&255,r[2+a]=e[f]>>16&255,r[3+a]=e[f]>>24&255}}function S(r,f,a,e,i){for(var o=0;o<i;o++)a[e+o]^=r[f+o]}A()}function arraycopy(r,f,a,e,i){if(Buffer.isBuffer(r)&&Buffer.isBuffer(a))r.copy(a,e,f,f+i);else for(;i--;)a[e++]=r[f++]}module.exports=scrypt;