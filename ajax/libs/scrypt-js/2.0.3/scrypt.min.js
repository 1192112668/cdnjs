"use strict";!function(r){var t=2147483647;function s(r){var y=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],g=1779033703,d=3144134277,b=1013904242,m=2773480762,A=1359893119,E=2600822924,k=528734635,I=1541459225,U=new Array(64);function n(r){for(var n=0,e=r.length;64<=e;){for(var t,o,f,a,i=g,u=d,s=b,c=m,h=A,l=E,p=k,w=I,v=0;v<16;v++)o=n+4*v,U[v]=(255&r[o])<<24|(255&r[o+1])<<16|(255&r[o+2])<<8|255&r[o+3];for(v=16;v<64;v++)f=((t=U[v-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10,a=((t=U[v-15])>>>7|t<<25)^(t>>>18|t<<14)^t>>>3,U[v]=(f+U[v-7]|0)+(a+U[v-16]|0)|0;for(v=0;v<64;v++)f=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&l^~h&p)|0)+(w+(y[v]+U[v]|0)|0)|0,a=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&u^i&s^u&s)|0,w=p,p=l,l=h,h=c+f|0,c=s,s=u,u=i,i=f+a|0;g=g+i|0,d=d+u|0,b=b+s|0,m=m+c|0,A=A+h|0,E=E+l|0,k=k+p|0,I=I+w|0,n+=64,e-=64}}n(r);var e,t=r.length%64,o=r.length/536870912|0,f=r.length<<3,a=t<56?56:120,i=r.slice(r.length-t,r.length);for(i.push(128),e=1+t;e<a;e++)i.push(0);return i.push(o>>>24&255),i.push(o>>>16&255),i.push(o>>>8&255),i.push(o>>>0&255),i.push(f>>>24&255),i.push(f>>>16&255),i.push(f>>>8&255),i.push(f>>>0&255),n(i),[g>>>24&255,g>>>16&255,g>>>8&255,g>>>0&255,d>>>24&255,d>>>16&255,d>>>8&255,d>>>0&255,b>>>24&255,b>>>16&255,b>>>8&255,b>>>0&255,m>>>24&255,m>>>16&255,m>>>8&255,m>>>0&255,A>>>24&255,A>>>16&255,A>>>8&255,A>>>0&255,E>>>24&255,E>>>16&255,E>>>8&255,E>>>0&255,k>>>24&255,k>>>16&255,k>>>8&255,k>>>0&255,I>>>24&255,I>>>16&255,I>>>8&255,I>>>0&255]}function T(r,n,e){r=r.length<=64?r:s(r);for(var t=64+n.length+4,o=new Array(t),f=new Array(64),a=[],i=0;i<64;i++)o[i]=54;for(i=0;i<r.length;i++)o[i]^=r[i];for(i=0;i<n.length;i++)o[64+i]=n[i];for(i=t-4;i<t;i++)o[i]=0;for(i=0;i<64;i++)f[i]=92;for(i=0;i<r.length;i++)f[i]^=r[i];function u(){for(var r=t-1;t-4<=r;r--){if(o[r]++,o[r]<=255)return;o[r]=0}}for(;32<=e;)u(),a=a.concat(s(f.concat(s(o)))),e-=32;return 0<e&&(u(),a=a.concat(s(f.concat(s(o))).slice(0,e))),a}function _(r,n,e,t,o){var f;for(q(r,16*(2*e-1),o,0,16),f=0;f<2*e;f++)j(r,16*f,o,16),a(o,t),q(o,0,r,n+16*f,16);for(f=0;f<e;f++)q(r,n+2*f*16,r,16*f,16);for(f=0;f<e;f++)q(r,n+16*(2*f+1),r,16*(f+e),16)}function o(r,n){return r<<n|r>>>32-n}function a(r,n){q(r,0,n,0,16);for(var e=8;0<e;e-=2)n[4]^=o(n[0]+n[12],7),n[8]^=o(n[4]+n[0],9),n[12]^=o(n[8]+n[4],13),n[0]^=o(n[12]+n[8],18),n[9]^=o(n[5]+n[1],7),n[13]^=o(n[9]+n[5],9),n[1]^=o(n[13]+n[9],13),n[5]^=o(n[1]+n[13],18),n[14]^=o(n[10]+n[6],7),n[2]^=o(n[14]+n[10],9),n[6]^=o(n[2]+n[14],13),n[10]^=o(n[6]+n[2],18),n[3]^=o(n[15]+n[11],7),n[7]^=o(n[3]+n[15],9),n[11]^=o(n[7]+n[3],13),n[15]^=o(n[11]+n[7],18),n[1]^=o(n[0]+n[3],7),n[2]^=o(n[1]+n[0],9),n[3]^=o(n[2]+n[1],13),n[0]^=o(n[3]+n[2],18),n[6]^=o(n[5]+n[4],7),n[7]^=o(n[6]+n[5],9),n[4]^=o(n[7]+n[6],13),n[5]^=o(n[4]+n[7],18),n[11]^=o(n[10]+n[9],7),n[8]^=o(n[11]+n[10],9),n[9]^=o(n[8]+n[11],13),n[10]^=o(n[9]+n[8],18),n[12]^=o(n[15]+n[14],7),n[13]^=o(n[12]+n[15],9),n[14]^=o(n[13]+n[12],13),n[15]^=o(n[14]+n[13],18);for(e=0;e<16;++e)r[e]+=n[e]}function j(r,n,e,t){for(var o=0;o<t;o++)e[o]^=r[n+o]}function q(r,n,e,t,o){for(;o--;)e[t++]=r[n++]}function z(r){if(r&&"number"==typeof r.length){for(var n=0;n<r.length;n++){if("number"!=typeof r[n])return;var e=parseInt(r[n]);if(e!=r[n]||e<0||256<=e)return}return 1}}function B(r,n){var e=parseInt(r);if(r!=e)throw new Error("invalid "+n);return e}function n(f,r,a,i,u,s,c){if(!c)throw new Error("missing callback");if(a=B(a,"N"),i=B(i,"r"),u=B(u,"p"),s=B(s,"dkLen"),0===a||0!=(a&a-1))throw new Error("N must be power of 2");if(t/128/i<a)throw new Error("N too large");if(t/128/u<i)throw new Error("r too large");if(!z(f))throw new Error("password must be an array or buffer");if(!z(r))throw new Error("salt must be an array or buffer");for(var h=T(f,r,128*u*i),l=new Uint32Array(32*u*i),n=0;n<l.length;n++){var e=4*n;l[n]=(255&h[3+e])<<24|(255&h[2+e])<<16|(255&h[1+e])<<8|(255&h[0+e])<<0}var p,w,v=new Uint32Array(64*i),y=new Uint32Array(32*i*a),g=32*i,d=new Uint32Array(16),b=new Uint32Array(16),m=u*a*2,A=0,E=null,k=!1,I=0,U=0,N=parseInt(1e3/i),x="undefined"!=typeof setImmediate?setImmediate:setTimeout,L=function(){if(k)return c(new Error("cancelled"),A/m);switch(I){case 0:q(l,w=32*U*i,v,0,g),I=1,p=0;case 1:N<(n=a-p)&&(n=N);for(var r=0;r<n;r++)q(v,0,y,(p+r)*g,g),_(v,g,i,d,b);if(p+=n,A+=n,(e=parseInt(1e3*A/m))!==E){if(k=c(null,A/m))break;E=e}if(p<a)break;p=0,I=2;case 2:var n;N<(n=a-p)&&(n=N);for(var e,r=0;r<n;r++){var t=v[16*(2*i-1)]&a-1;j(y,t*g,v,g),_(v,g,i,d,b)}if(p+=n,A+=n,(e=parseInt(1e3*A/m))!==E){if(k=c(null,A/m))break;E=e}if(p<a)break;if(q(v,0,l,w,g),++U<u){I=0;break}h=[];for(r=0;r<l.length;r++)h.push(l[r]>>0&255),h.push(l[r]>>8&255),h.push(l[r]>>16&255),h.push(l[r]>>24&255);var o=T(f,h,s);return c(null,1,o)}x(L)};L()}"undefined"!=typeof exports?module.exports=n:"function"==typeof define&&define.amd?define(n):r&&(r.scrypt&&(r._scrypt=r.scrypt),r.scrypt=n)}(this);