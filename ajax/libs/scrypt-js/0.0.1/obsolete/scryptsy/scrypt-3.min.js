var pbkdf2Sync=require("pbkdf2").pbkdf2Sync,MAX_VALUE=2147483647;function scrypt(t,r,a,i,e,n,c){if(0===a||0!=(a&a-1))throw Error("N must be > 0 and a power of 2");if(MAX_VALUE/128/i<a)throw Error("Parameter N is too large");if(MAX_VALUE/128/e<i)throw Error("Parameter r is too large");var f=new Buffer(256*i),o=new Buffer(128*i*a),s=new Int32Array(16),y=new Int32Array(16),p=new Buffer(64),u=pbkdf2Sync(t,r,1,128*e*i,"sha256");function X(r,a,i,e){var f;for(arraycopy(r,a+64*(2*e-1),p,0,64),f=0;f<2*e;f++)b(r,64*f,p,0,64),B(p),arraycopy(p,0,r,i+64*f,64);for(f=0;f<e;f++)arraycopy(r,i+2*f*64,r,a+64*f,64);for(f=0;f<e;f++)arraycopy(r,i+64*(2*f+1),r,a+64*(f+e),64)}function Y(r,a){return r<<a|r>>>32-a}function B(r){for(var a=0;a<16;a++)s[a]=(255&r[4*a+0])<<0,s[a]|=(255&r[4*a+1])<<8,s[a]|=(255&r[4*a+2])<<16,s[a]|=(255&r[4*a+3])<<24;for(arraycopy(s,0,y,0,16),a=8;0<a;a-=2)y[4]^=Y(y[0]+y[12],7),y[8]^=Y(y[4]+y[0],9),y[12]^=Y(y[8]+y[4],13),y[0]^=Y(y[12]+y[8],18),y[9]^=Y(y[5]+y[1],7),y[13]^=Y(y[9]+y[5],9),y[1]^=Y(y[13]+y[9],13),y[5]^=Y(y[1]+y[13],18),y[14]^=Y(y[10]+y[6],7),y[2]^=Y(y[14]+y[10],9),y[6]^=Y(y[2]+y[14],13),y[10]^=Y(y[6]+y[2],18),y[3]^=Y(y[15]+y[11],7),y[7]^=Y(y[3]+y[15],9),y[11]^=Y(y[7]+y[3],13),y[15]^=Y(y[11]+y[7],18),y[1]^=Y(y[0]+y[3],7),y[2]^=Y(y[1]+y[0],9),y[3]^=Y(y[2]+y[1],13),y[0]^=Y(y[3]+y[2],18),y[6]^=Y(y[5]+y[4],7),y[7]^=Y(y[6]+y[5],9),y[4]^=Y(y[7]+y[6],13),y[5]^=Y(y[4]+y[7],18),y[11]^=Y(y[10]+y[9],7),y[8]^=Y(y[11]+y[10],9),y[9]^=Y(y[8]+y[11],13),y[10]^=Y(y[9]+y[8],18),y[12]^=Y(y[15]+y[14],7),y[13]^=Y(y[12]+y[15],9),y[14]^=Y(y[13]+y[12],13),y[15]^=Y(y[14]+y[13],18);for(a=0;a<16;++a)s[a]=y[a]+s[a];for(a=0;a<16;a++){var i=4*a;r[0+i]=s[a]>>0&255,r[1+i]=s[a]>>8&255,r[2+i]=s[a]>>16&255,r[3+i]=s[a]>>24&255}}function b(r,a,i,e,f){for(var o=0;o<f;o++)i[e+o]^=r[a+o]}(function r(a){switch(a.state){case 0:if(a.i0++,a.i0===a.p){a.state=5;break}a.state=1,a.Bi=128*a.i0*a.r;break;case 1:a.Xi=0,a.Yi=128*a.r,a.B.copy(a.XY,a.Xi,a.Bi,a.Bi+a.Yi),a.state=2,a.i1=0;break;case 2:var i=a.N-a.i1;1e3<i&&(i=1e3);for(var e=0;e<i;e++)a.XY.copy(a.V,(a.i1+e)*a.Yi,a.Xi,a.Xi+a.Yi),X(a.XY,a.Xi,a.Yi,a.r);a.i1+=i,a.i1===a.N&&(a.i1=0,a.state=3);break;case 3:var i=a.N-a.i1;1e3<i&&(i=1e3);for(var e=0;e<i;e++){var f=a.Xi+64*(2*a.r-1),o=a.XY.readUInt32LE(f)&a.N-1;b(a.V,o*a.Yi,a.XY,a.Xi,a.Yi),X(a.XY,a.Xi,a.Yi,a.r)}a.i1+=i,a.i1===a.N&&(a.state=4);break;case 4:a.XY.copy(a.B,a.Bi,a.Xi,a.Xi+a.Yi),a.state=0;break;case 5:return t=pbkdf2Sync(t,u,1,n,"sha256"),void c(null,1,t)}setImmediate(function(){r(a)},0)})({i0:-1,r:i,p:e,N:a,B:u,V:o,XY:f,state:0})}function arraycopy(r,a,i,e,f){if(Buffer.isBuffer(r)&&Buffer.isBuffer(i))r.copy(i,e,a,a+f);else for(;f--;)i[e++]=r[a++]}module.exports=scrypt;