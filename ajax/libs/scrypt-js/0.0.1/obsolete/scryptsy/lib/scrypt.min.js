"use strict";var MAX_VALUE=2147483647;function SHA256(r){var w=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],A=1779033703,v=3144134277,B=1013904242,_=2773480762,b=1359893119,g=2600822924,k=528734635,m=1541459225,H=new Array(64);function e(r){for(var e=0,f=r.length;64<=f;){for(var n,a,o,t,u=A,i=v,c=B,l=_,s=b,R=g,h=k,p=m,y=0;y<16;y++)a=e+4*y,H[y]=(255&r[a])<<24|(255&r[a+1])<<16|(255&r[a+2])<<8|255&r[a+3];for(y=16;y<64;y++)o=((n=H[y-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,t=((n=H[y-15])>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,H[y]=(o+H[y-7]|0)+(t+H[y-16]|0)|0;for(y=0;y<64;y++)o=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&R^~s&h)|0)+(p+(w[y]+H[y]|0)|0)|0,t=((u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10))+(u&i^u&c^i&c)|0,p=h,h=R,R=s,s=l+o|0,l=c,c=i,i=u,u=o+t|0;A=A+u|0,v=v+i|0,B=B+c|0,_=_+l|0,b=b+s|0,g=g+R|0,k=k+h|0,m=m+p|0,e+=64,f-=64}}e(r);var f,n=r.length%64,a=r.length/536870912|0,o=r.length<<3,t=n<56?56:120,u=r.slice(r.length-n,r.length);for(u.push(128),f=1+n;f<t;f++)u.push(0);return u.push(a>>>24&255),u.push(a>>>16&255),u.push(a>>>8&255),u.push(a>>>0&255),u.push(o>>>24&255),u.push(o>>>16&255),u.push(o>>>8&255),u.push(o>>>0&255),e(u),[A>>>24&255,A>>>16&255,A>>>8&255,A>>>0&255,v>>>24&255,v>>>16&255,v>>>8&255,v>>>0&255,B>>>24&255,B>>>16&255,B>>>8&255,B>>>0&255,_>>>24&255,_>>>16&255,_>>>8&255,_>>>0&255,b>>>24&255,b>>>16&255,b>>>8&255,b>>>0&255,g>>>24&255,g>>>16&255,g>>>8&255,g>>>0&255,k>>>24&255,k>>>16&255,k>>>8&255,k>>>0&255,m>>>24&255,m>>>16&255,m>>>8&255,m>>>0&255]}function PBKDF2_HMAC_SHA256_OneIter(r,e,f){r=r.length<=64?r:SHA256(r);for(var n=64+e.length+4,a=new Array(n),o=new Array(64),t=[],u=0;u<64;u++)a[u]=54;for(u=0;u<r.length;u++)a[u]^=r[u];for(u=0;u<e.length;u++)a[64+u]=e[u];for(u=n-4;u<n;u++)a[u]=0;for(u=0;u<64;u++)o[u]=92;for(u=0;u<r.length;u++)o[u]^=r[u];function i(){for(var r=n-1;n-4<=r;r--){if(a[r]++,a[r]<=255)return;a[r]=0}}for(;32<=f;)i(),t=t.concat(SHA256(o.concat(SHA256(a)))),f-=32;return 0<f&&(i(),t=t.concat(SHA256(o.concat(SHA256(a))).slice(0,f))),new Buffer(t)}function blockmix_salsa8(r,e,f,n,a,o,t){var u;for(arraycopy(r,e+64*(2*n-1),t,0,64),u=0;u<2*n;u++)blockxor(r,64*u,t,0,64),salsa20_8(t,a,o),arraycopy(t,0,r,f+64*u,64);for(u=0;u<n;u++)arraycopy(r,f+2*u*64,r,e+64*u,64);for(u=0;u<n;u++)arraycopy(r,f+64*(2*u+1),r,e+64*(u+n),64)}function R(r,e){return r<<e|r>>>32-e}function salsa20_8(r,e,f){for(var n=0;n<16;n++)e[n]=(255&r[4*n+0])<<0,e[n]|=(255&r[4*n+1])<<8,e[n]|=(255&r[4*n+2])<<16,e[n]|=(255&r[4*n+3])<<24;arraycopy(e,0,f,0,16);for(n=8;0<n;n-=2)f[4]^=R(f[0]+f[12],7),f[8]^=R(f[4]+f[0],9),f[12]^=R(f[8]+f[4],13),f[0]^=R(f[12]+f[8],18),f[9]^=R(f[5]+f[1],7),f[13]^=R(f[9]+f[5],9),f[1]^=R(f[13]+f[9],13),f[5]^=R(f[1]+f[13],18),f[14]^=R(f[10]+f[6],7),f[2]^=R(f[14]+f[10],9),f[6]^=R(f[2]+f[14],13),f[10]^=R(f[6]+f[2],18),f[3]^=R(f[15]+f[11],7),f[7]^=R(f[3]+f[15],9),f[11]^=R(f[7]+f[3],13),f[15]^=R(f[11]+f[7],18),f[1]^=R(f[0]+f[3],7),f[2]^=R(f[1]+f[0],9),f[3]^=R(f[2]+f[1],13),f[0]^=R(f[3]+f[2],18),f[6]^=R(f[5]+f[4],7),f[7]^=R(f[6]+f[5],9),f[4]^=R(f[7]+f[6],13),f[5]^=R(f[4]+f[7],18),f[11]^=R(f[10]+f[9],7),f[8]^=R(f[11]+f[10],9),f[9]^=R(f[8]+f[11],13),f[10]^=R(f[9]+f[8],18),f[12]^=R(f[15]+f[14],7),f[13]^=R(f[12]+f[15],9),f[14]^=R(f[13]+f[12],13),f[15]^=R(f[14]+f[13],18);for(n=0;n<16;++n)e[n]=f[n]+e[n];for(n=0;n<16;n++){var a=4*n;r[0+a]=e[n]>>0&255,r[1+a]=e[n]>>8&255,r[2+a]=e[n]>>16&255,r[3+a]=e[n]>>24&255}}function blockxor(r,e,f,n,a){for(var o=0;o<a;o++)f[n+o]^=r[e+o]}function arraycopy(r,e,f,n,a){if(Buffer.isBuffer(r)&&Buffer.isBuffer(f))r.copy(f,n,e,e+a);else for(;a--;)f[n++]=r[e++]}function makeBuffer(r){if("string"==typeof r)return new Buffer(r);if(Buffer.isBuffer(r))return r;if(r.length){for(var e=!0,f=0;f<r.length;f++){var n=parseInt(r[f]);if(n!=r[f]||n<0||256<=n){e=!1;break}}if(e)return new Buffer(r)}throw new Error("invalid value (must be a buffer, array of bytes or string)")}function scrypt(a,r,o,t,u,i,c){if(!c)throw new Error("missing callback");if(0===o||0!=(o&o-1))throw new Error("invalid parameter N");if(MAX_VALUE/128/t<o)throw new Error("invalid parameter N");if(MAX_VALUE/128/u<t)throw new Error("invalid parameter r");a=makeBuffer(a),r=makeBuffer(r);var l,s,R,h=new Buffer(256*t),p=new Buffer(128*t*o),y=128*t,w=new Int32Array(16),A=new Int32Array(16),v=new Buffer(64),B=PBKDF2_HMAC_SHA256_OneIter(a,r,128*u*t),_=u*o*2,b=0,g=!1,k=0,m=0,H=function(){if(g)return c(new Error("cancelled"));switch(k){case 0:s=128*m*t,R=0,B.copy(h,R,s,s+y),k=1,l=0;case 1:1e3<(e=o-l)&&(e=1e3);for(var r=0;r<e;r++)h.copy(p,(l+r)*y,R,R+y),blockmix_salsa8(h,R,y,t,w,A,v);if(b+=e,(l+=e)<o)break;if(l=0,k=2,g=c(null,b/_))break;case 2:var e;1e3<(e=o-l)&&(e=1e3);for(r=0;r<e;r++){var f=R+64*(2*t-1),n=h.readUInt32LE(f)&o-1;blockxor(p,n*y,h,R,y),blockmix_salsa8(h,R,y,t,w,A,v)}if(b+=e,(l+=e)<o)break;if(g=c(null,b/_))break;if(h.copy(B,s,R,R+y),++m<u){k=0;break}return c(null,1,PBKDF2_HMAC_SHA256_OneIter(a,B,i))}setTimeout(H,0)};H()}module.exports=scrypt;