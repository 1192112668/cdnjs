"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/marker-clusters",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var e=t?t._modules:{};function a(t,e,a,o){t.hasOwnProperty(e)||(t[e]=o.apply(null,a))}a(e,"Extensions/MarkerClusters.js",[e["Core/Chart/Chart.js"],e["Core/Globals.js"],e["Core/Options.js"],e["Core/Series/Point.js"],e["Core/Renderer/SVG/SVGRenderer.js"],e["Core/Utilities.js"]],function(t,e,a,o,i,r){var n=a.defaultOptions,D=r.addEvent,I=r.animObject,G=r.defined,A=r.error,M=r.isArray,P=r.isFunction,X=r.isObject,Y=r.isNumber,v=r.merge,L=r.objectEach,z=r.relativeLength,k=r.syncTimeout,s=e.Series,l=e.seriesTypes.scatter,E=s.prototype.generatePoints,p=0,u=[],V={enabled:!1,allowOverlap:!0,animation:{duration:500},drillToCluster:!0,minimumClusterSize:2,layoutAlgorithm:{gridSize:50,distance:40,kmeansThreshold:100},marker:{symbol:"cluster",radius:15,lineWidth:0,lineColor:"#ffffff"},dataLabels:{enabled:!0,format:"{point.clusterPointsAmount}",verticalAlign:"middle",align:"center",style:{color:"contrast"},inside:!0}};function w(t){for(var e=t.length,a=0,o=0,i=0;i<e;i++)a+=t[i].x,o+=t[i].y;return{x:a/e,y:o/e}}function d(t,e){var a=[];return a.length=e,t.clusters.forEach(function(t){t.data.forEach(function(t){a[t.dataIndex]=t})}),t.noise.forEach(function(t){a[t.data[0].dataIndex]=t.data[0]}),a}function h(t,e,a){t.attr({opacity:e}).animate({opacity:1},a)}function S(t,e,a,o,i){t.point&&(o&&t.point.graphic&&(t.point.graphic.show(),h(t.point.graphic,e,a)),i&&t.point.dataLabel&&(t.point.dataLabel.show(),h(t.point.dataLabel,e,a)))}function b(t,e,a){t.point&&(e&&t.point.graphic&&t.point.graphic.hide(),a&&t.point.dataLabel&&t.point.dataLabel.hide())}function O(t,e,a,o){S(t,o,a,!0,!0),e.forEach(function(t){t.point&&t.point.destroy&&t.point.destroy()})}function T(){return Math.random().toString(36).substring(2,7)+"-"+p++}(n.plotOptions||{}).series=v((n.plotOptions||{}).series,{cluster:V,tooltip:{clusterFormat:"<span>Clustered points: {point.clusterPointsAmount}</span><br/>"}}),i.prototype.symbols.cluster=function(t,e,a,o){var i=a/2,r=o/2,n=this.arc(t+i,e+r,i-4,r-4,{start:.5*Math.PI,end:2.5*Math.PI,open:!1}),s=this.arc(t+i,e+r,i-3,r-3,{start:.5*Math.PI,end:2.5*Math.PI,innerR:i-2,open:!1});return this.arc(t+i,e+r,i-1,r-1,{start:.5*Math.PI,end:2.5*Math.PI,innerR:i,open:!1}).concat(s,n)},l.prototype.animateClusterPoint=function(t){var e,a,o,i=this,r=i.xAxis,n=i.yAxis,s=i.chart,l=i.options.cluster,p=I((l||{}).animation),u=p.duration||500,d=(i.markerClusterInfo||{}).pointsState,h=(d||{}).newState,c=(d||{}).oldState,f=[],m=0,x=0,g=0,y=!1,C=!1;c&&h&&(o=h[t.stateId],x=r.toPixels(o.x)-s.plotLeft,g=n.toPixels(o.y)-s.plotTop,1===o.parentsId.length?(e=(h||{})[t.stateId].parentsId[0],a=c[e],o.point&&o.point.graphic&&a&&a.point&&a.point.plotX&&a.point.plotY&&a.point.plotX!==o.point.plotX&&a.point.plotY!==o.point.plotY&&(m=o.point.graphic.getBBox().width/2,o.point.graphic.attr({x:a.point.plotX-m,y:a.point.plotY-m}),o.point.graphic.animate({x:x-(o.point.graphic.radius||0),y:g-(o.point.graphic.radius||0)},p,function(){C=!0,a.point&&a.point.destroy&&a.point.destroy()}),o.point.dataLabel&&o.point.dataLabel.alignAttr&&a.point.dataLabel&&a.point.dataLabel.alignAttr&&(o.point.dataLabel.attr({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y}),o.point.dataLabel.animate({x:o.point.dataLabel.alignAttr.x,y:o.point.dataLabel.alignAttr.y},p)))):0===o.parentsId.length?(b(o,!0,!0),k(function(){S(o,.1,p,!0,!0)},u/2)):(b(o,!0,!0),o.parentsId.forEach(function(t){c&&c[t]&&(a=c[t],f.push(a),a.point&&a.point.graphic&&(y=!0,a.point.graphic.show(),a.point.graphic.animate({x:x-(a.point.graphic.radius||0),y:g-(a.point.graphic.radius||0),opacity:.4},p,function(){C=!0,O(o,f,p,.7)}),a.point.dataLabel&&-9999!==a.point.dataLabel.y&&o.point&&o.point.dataLabel&&o.point.dataLabel.alignAttr&&(a.point.dataLabel.show(),a.point.dataLabel.animate({x:o.point.dataLabel.alignAttr.x,y:o.point.dataLabel.alignAttr.y,opacity:.4},p))))}),k(function(){C||O(o,f,p,.85)},u),y||k(function(){O(o,f,p,.1)},u/2)))},l.prototype.getGridOffset=function(){var t=this,e=t.chart,a=t.xAxis,o=t.yAxis;return{plotLeft:t.dataMinX&&t.dataMaxX?a.reversed?a.toPixels(t.dataMaxX):a.toPixels(t.dataMinX):e.plotLeft,plotTop:t.dataMinY&&t.dataMaxY?o.reversed?o.toPixels(t.dataMinY):o.toPixels(t.dataMaxY):e.plotTop}},l.prototype.getScaledGridSize=function(t){var e,a,o=this.xAxis,i=!0,r=1,n=1,s=t.processedGridSize||V.layoutAlgorithm.gridSize;for(this.gridValueSize||(this.gridValueSize=Math.abs(o.toValue(s)-o.toValue(0))),e=+(s/(o.toPixels(this.gridValueSize)-o.toPixels(0))).toFixed(14);i&&1!=e;)a=Math.pow(2,r),.75<e&&e<1.25?i=!1:1/a<=e&&e<1/a*2?(i=!1,n=a):e<=a&&a/2<e&&(i=!1,n=1/a),r++;return s/n/e},l.prototype.getRealExtremes=function(){var t,e,a=this.chart,o=this.xAxis,i=this.yAxis,r=o?o.toValue(a.plotLeft):0,n=o?o.toValue(a.plotLeft+a.plotWidth):0,s=i?i.toValue(a.plotTop):0,l=i?i.toValue(a.plotTop+a.plotHeight):0;return n<r&&(n=(t=[r,n])[0],r=t[1]),l<s&&(l=(e=[s,l])[0],s=e[1]),{minX:r,maxX:n,minY:s,maxY:l}},l.prototype.onDrillToCluster=function(t){(t.point||t.target).firePointEvent("drillToCluster",t,function(t){var e,a,o,i,r,n,s,l,p,u,d=t.point||t.target,h=d.series,c=d.series.xAxis,f=d.series.yAxis,m=d.series.chart;(h.options.cluster||{}).drillToCluster&&d.clusteredData&&(r=d.clusteredData.map(function(t){return t.x}).sort(function(t,e){return t-e}),n=d.clusteredData.map(function(t){return t.y}).sort(function(t,e){return t-e}),s=r[0],p=r[r.length-1],l=n[0],u=n[n.length-1],o=Math.abs(.1*(p-s)),i=Math.abs(.1*(u-l)),m.pointer.zoomX=!0,m.pointer.zoomY=!0,p<s&&(s=(e=[p,s])[0],p=e[1]),u<l&&(l=(a=[u,l])[0],u=a[1]),m.zoom({originalEvent:t,xAxis:[{axis:c,min:s-o,max:p+o}],yAxis:[{axis:f,min:l-i,max:u+i}]}))})},l.prototype.getClusterDistancesFromPoint=function(t,e,a){for(var o,i=this.xAxis,r=this.yAxis,n=[],s=0;s<t.length;s++)o=Math.sqrt(Math.pow(i.toPixels(e)-i.toPixels(t[s].posX),2)+Math.pow(r.toPixels(a)-r.toPixels(t[s].posY),2)),n.push({clusterIndex:s,distance:o});return n.sort(function(t,e){return t.distance-e.distance})},l.prototype.getPointsState=function(t,e,a){var o,i,r,n=e?d(e,a):[],s=d(t,a),l={};for(u=[],t.clusters.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),t.noise.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),r=0;r<s.length;r++)o=s[r],i=n[r],o&&i&&o.parentStateId&&i.parentStateId&&l[o.parentStateId]&&-1===l[o.parentStateId].parentsId.indexOf(i.parentStateId)&&(l[o.parentStateId].parentsId.push(i.parentStateId),-1===u.indexOf(i.parentStateId)&&u.push(i.parentStateId));return l},l.prototype.markerClusterAlgorithms={grid:function(t,e,a,o){for(var i,r,n,s,l=this.xAxis,p=this.yAxis,u={},d=this.getGridOffset(),h=this.getScaledGridSize(o),c=0;c<t.length;c++)i=l.toPixels(t[c])-d.plotLeft,r=p.toPixels(e[c])-d.plotTop,n=Math.floor(i/h),u[s=Math.floor(r/h)+"-"+n]||(u[s]=[]),u[s].push({dataIndex:a[c],x:t[c],y:e[c]});return u},kmeans:function(t,e,a,o){var i,r,n,s,l,p=this,u=[],d=[],h={},c=o.processedDistance||V.layoutAlgorithm.distance,f=o.iterations,m=0,x=!0,g=0,y=0,C=[];for(n in o.processedGridSize=o.processedDistance,r=p.markerClusterAlgorithms?p.markerClusterAlgorithms.grid.call(p,t,e,a,o):{})1<r[n].length&&(i=w(r[n]),u.push({posX:i.x,posY:i.y,oldX:0,oldY:0,startPointsLen:r[n].length,points:[]}));for(;x;){for(u.map(function(t){return t.points.length=0,t}),s=d.length=0;s<t.length;s++)g=t[s],y=e[s],(C=p.getClusterDistancesFromPoint(u,g,y)).length&&C[0].distance<c?u[C[0].clusterIndex].points.push({x:g,y:y,dataIndex:a[s]}):d.push({x:g,y:y,dataIndex:a[s]});for(l=0;l<u.length;l++)1===u[l].points.length&&(C=p.getClusterDistancesFromPoint(u,u[l].points[0].x,u[l].points[0].y))[1].distance<c&&(u[C[1].clusterIndex].points.push(u[l].points[0]),u[C[0].clusterIndex].points.length=0);for(x=!1,l=0;l<u.length;l++)i=w(u[l].points),u[l].oldX=u[l].posX,u[l].oldY=u[l].posY,u[l].posX=i.x,u[l].posY=i.y,(u[l].posX>u[l].oldX+1||u[l].posX<u[l].oldX-1||u[l].posY>u[l].oldY+1||u[l].posY<u[l].oldY-1)&&(x=!0);f&&(x=m<f-1),m++}return u.forEach(function(t,e){h["cluster"+e]=t.points}),d.forEach(function(t,e){h["noise"+e]=[t]}),h},optimizedKmeans:function(t,e,a,o){var i,r,n=this,s=n.xAxis,l=n.yAxis,p=o.processedDistance||V.layoutAlgorithm.gridSize,u={},d=n.getRealExtremes(),h=(n.options.cluster||{}).marker;return!n.markerClusterInfo||n.initMaxX&&n.initMaxX<d.maxX||n.initMinX&&n.initMinX>d.minX||n.initMaxY&&n.initMaxY<d.maxY||n.initMinY&&n.initMinY>d.minY?(n.initMaxX=d.maxX,n.initMinX=d.minX,n.initMaxY=d.maxY,n.initMinY=d.minY,u=n.markerClusterAlgorithms?n.markerClusterAlgorithms.kmeans.call(n,t,e,a,o):{},n.baseClusters=null):(n.baseClusters||(n.baseClusters={clusters:n.markerClusterInfo.clusters,noise:n.markerClusterInfo.noise}),n.baseClusters.clusters.forEach(function(a){a.pointsOutside=[],a.pointsInside=[],a.data.forEach(function(t){i=Math.sqrt(Math.pow(s.toPixels(t.x)-s.toPixels(a.x),2)+Math.pow(l.toPixels(t.y)-l.toPixels(a.y),2)),(r=a.clusterZone&&a.clusterZone.marker&&a.clusterZone.marker.radius?a.clusterZone.marker.radius:h&&h.radius?h.radius:V.marker.radius)+(0<=p-r?p-r:r)<i&&G(a.pointsOutside)?a.pointsOutside.push(t):G(a.pointsInside)&&a.pointsInside.push(t)}),a.pointsInside.length&&(u[a.id]=a.pointsInside),a.pointsOutside.forEach(function(t,e){u[a.id+"_noise"+e]=[t]})}),n.baseClusters.noise.forEach(function(t){u[t.id]=t.data})),u}},l.prototype.preventClusterCollisions=function(t){var a,o,e,i,r,n,s,l,p,u,d,h,c,f,m,x=this,g=x.xAxis,y=x.yAxis,C=t.key.split("-").map(parseFloat),I=C[0],k=C[1],S=t.gridSize,b=t.groupedData,A=t.defaultRadius,M=t.clusterRadius,D=k*S,P=I*S,X=g.toPixels(t.x),Y=y.toPixels(t.y),v=[],L=0,z=0,E=(x.options.cluster||{}).marker,O=(x.options.cluster||{}).zones,T=x.getGridOffset();for(X-=T.plotLeft,Y-=T.plotTop,s=1;s<5;s++)for(e=s%2?-1:1,i=s<3?-1:1,r=Math.floor((X+e*M)/S),c=[(n=Math.floor((Y+i*M)/S))+"-"+r,n+"-"+k,I+"-"+r],l=0;l<c.length;l++)-1===v.indexOf(c[l])&&c[l]!==t.key&&v.push(c[l]);return v.forEach(function(t){var e;if(b[t]){if(b[t].posX||(d=w(b[t]),b[t].posX=d.x,b[t].posY=d.y),a=g.toPixels(b[t].posX||0)-T.plotLeft,o=y.toPixels(b[t].posY||0)-T.plotTop,e=t.split("-").map(parseFloat),u=e[0],p=e[1],O)for(L=b[t].length,s=0;s<O.length;s++)L>=O[s].from&&L<=O[s].to&&(z=G((O[s].marker||{}).radius)?O[s].marker.radius||0:E&&E.radius?E.radius:V.marker.radius);1<b[t].length&&0===z&&E&&E.radius?z=E.radius:1===b[t].length&&(z=A),h=M+z,z=0,p!==k&&Math.abs(X-a)<h&&(X=p-k<0?D+M:D+S-M),u!==I&&Math.abs(Y-o)<h&&(Y=u-I<0?P+M:P+S-M)}}),f=g.toValue(X+T.plotLeft),m=y.toValue(Y+T.plotTop),{x:b[t.key].posX=f,y:b[t.key].posY=m}},l.prototype.isValidGroupedDataObject=function(t){var e,a=!1;return!!X(t)&&(L(t,function(t){if(a=!0,M(t)&&t.length){for(e=0;e<t.length;e++)if(!X(t[e])||!t[e].x||!t[e].y)return void(a=!1)}else a=!1}),a)},l.prototype.getClusteredData=function(t,e){var a,o,i,r,n,s,l,p,u,d,h,c,f,m,x=this,g=[],y=[],C=[],I=[],k=[],S=0,b=Math.max(2,e.minimumClusterSize||2);if(P(e.layoutAlgorithm.type)&&!x.isValidGroupedDataObject(t))return A("Highcharts marker-clusters module: The custom algorithm result is not valid!",!1,x.chart),!1;for(m in t)if(t[m].length>=b){if(i=t[m],a=T(),n=i.length,e.zones)for(f=0;f<e.zones.length;f++)n>=e.zones[f].from&&n<=e.zones[f].to&&((h=e.zones[f]).zoneIndex=f,d=e.zones[f].marker,c=e.zones[f].className);for(u=w(i),l="grid"!==e.layoutAlgorithm.type||e.allowOverlap?{x:u.x,y:u.y}:(s=x.options.marker||{},x.preventClusterCollisions({x:u.x,y:u.y,key:m,groupedData:t,gridSize:x.getScaledGridSize(e.layoutAlgorithm),defaultRadius:s.radius||3+(s.lineWidth||0),clusterRadius:d&&d.radius?d.radius:(e.marker||{}).radius||V.marker.radius})),f=0;f<n;f++)i[f].parentStateId=a;if(C.push({x:l.x,y:l.y,id:m,stateId:a,index:S,data:i,clusterZone:h,clusterZoneClassName:c}),g.push(l.x),y.push(l.y),k.push({options:{formatPrefix:"cluster",dataLabels:e.dataLabels,marker:v(e.marker,{states:e.states},d||{})}}),x.options.data&&x.options.data.length)for(f=0;f<n;f++)X(x.options.data[i[f].dataIndex])&&(i[f].options=x.options.data[i[f].dataIndex]);S++,d=null}else for(f=0;f<t[m].length;f++)o=t[m][f],a=T(),p=null,r=((x.options||{}).data||[])[o.dataIndex],g.push(o.x),y.push(o.y),o.parentStateId=a,I.push({x:o.x,y:o.y,id:m,stateId:a,index:S,data:t[m]}),p=r&&"object"==typeof r&&!M(r)?v(r,{x:o.x,y:o.y}):{userOptions:r,x:o.x,y:o.y},k.push({options:p}),S++;return{clusters:C,noise:I,groupedXData:g,groupedYData:y,groupMap:k}},l.prototype.destroyClusteredData=function(){(this.markerClusterSeriesData||[]).forEach(function(t){t&&t.destroy&&t.destroy()}),this.markerClusterSeriesData=null},l.prototype.hideClusteredData=function(){var t=this.markerClusterSeriesData,e=((this.markerClusterInfo||{}).pointsState||{}).oldState||{},a=u.map(function(t){return(e[t].point||{}).id||""});(t||[]).forEach(function(t){t&&-1!==a.indexOf(t.id)?(t.graphic&&t.graphic.hide(),t.dataLabel&&t.dataLabel.hide()):t&&t.destroy&&t.destroy()})},l.prototype.generatePoints=function(){var t,e,a,o,i,r,n,s,l,p,u,d,h,c,f,m,x,g=this,y=g.chart,C=g.xAxis,I=g.yAxis,k=g.options.cluster,S=g.getRealExtremes(),b=[],A=[],M=[];if(k&&k.enabled&&g.xData&&g.yData&&!y.polar){for(u=k.layoutAlgorithm.type,(c=k.layoutAlgorithm).processedGridSize=z(c.gridSize||V.layoutAlgorithm.gridSize,y.plotWidth),c.processedDistance=z(c.distance||V.layoutAlgorithm.distance,y.plotWidth),o=c.kmeansThreshold||V.layoutAlgorithm.kmeansThreshold,i=Math.abs(C.toValue(c.processedGridSize/2)-C.toValue(0)),r=Math.abs(I.toValue(c.processedGridSize/2)-I.toValue(0)),m=0;m<g.xData.length;m++)g.dataMaxX||(G(s)&&G(n)&&G(p)&&G(l)?Y(g.yData[m])&&Y(p)&&Y(l)&&(s=Math.max(g.xData[m],s),n=Math.min(g.xData[m],n),p=Math.max(g.yData[m]||p,p),l=Math.min(g.yData[m]||l,l)):(s=n=g.xData[m],p=l=g.yData[m])),g.xData[m]>=S.minX-i&&g.xData[m]<=S.maxX+i&&(g.yData[m]||S.minY)>=S.minY-r&&(g.yData[m]||S.maxY)<=S.maxY+r&&(b.push(g.xData[m]),A.push(g.yData[m]),M.push(m));G(s)&&G(n)&&Y(p)&&Y(l)&&(g.dataMaxX=s,g.dataMinX=n,g.dataMaxY=p,g.dataMinY=l),d=(h=(P(u)?u:g.markerClusterAlgorithms?u&&g.markerClusterAlgorithms[u]?g.markerClusterAlgorithms[u]:b.length<o?g.markerClusterAlgorithms.kmeans:g.markerClusterAlgorithms.grid:function(){return!1}).call(this,b,A,M,c))?g.getClusteredData(h,k):h,t=k.animation&&g.markerClusterInfo&&g.markerClusterInfo.pointsState&&g.markerClusterInfo.pointsState.oldState?((x=g.markerClusterInfo.pointsState.oldState)&&L(x,function(t){t.point&&t.point.destroy&&t.point.destroy()}),g.markerClusterInfo.pointsState.newState):{},e=g.xData.length,a=g.markerClusterInfo,d&&(g.processedXData=d.groupedXData,g.processedYData=d.groupedYData,g.hasGroupedData=!0,g.markerClusterInfo=d,g.groupMap=d.groupMap),E.apply(this),d&&g.markerClusterInfo&&((g.markerClusterInfo.clusters||[]).forEach(function(t){(f=g.points[t.index]).isCluster=!0,f.clusteredData=t.data,f.clusterPointsAmount=t.data.length,t.point=f,D(f,"click",g.onDrillToCluster)}),(g.markerClusterInfo.noise||[]).forEach(function(t){t.point=g.points[t.index]}),k.animation&&g.markerClusterInfo&&(g.markerClusterInfo.pointsState={oldState:t,newState:g.getPointsState(d,a,e)}),k.animation?this.hideClusteredData():this.destroyClusteredData(),this.markerClusterSeriesData=this.hasGroupedData?this.points:null)}else E.apply(this)},D(t,"render",function(){(this.series||[]).forEach(function(e){var t,a;e.markerClusterInfo&&(t=e.options.cluster,a=((e.markerClusterInfo||{}).pointsState||{}).oldState,(t||{}).animation&&e.markerClusterInfo&&0===e.chart.pointer.pinchDown.length&&"pan"!==(e.xAxis.eventArgs||{}).trigger&&a&&Object.keys(a).length&&(e.markerClusterInfo.clusters.forEach(function(t){e.animateClusterPoint(t)}),e.markerClusterInfo.noise.forEach(function(t){e.animateClusterPoint(t)})))})}),D(o,"update",function(){if(this.dataGroup)return A("Highcharts marker-clusters module: Running `Point.update` when point belongs to clustered series is not supported.",!1,this.series.chart),!1}),D(s,"destroy",l.prototype.destroyClusteredData),D(s,"afterRender",function(){var e=(this.options.cluster||{}).drillToCluster;this.markerClusterInfo&&this.markerClusterInfo.clusters&&this.markerClusterInfo.clusters.forEach(function(t){t.point&&t.point.graphic&&(t.point.graphic.addClass("highcharts-cluster-point"),e&&t.point&&(t.point.graphic.css({cursor:"pointer"}),t.point.dataLabel&&t.point.dataLabel.css({cursor:"pointer"})),G(t.clusterZone)&&t.point.graphic.addClass(t.clusterZoneClassName||"highcharts-cluster-zone-"+t.clusterZone.zoneIndex))})}),D(o,"drillToCluster",function(t){var e=(((t.point||t.target).series.options.cluster||{}).events||{}).drillToCluster;P(e)&&e.call(this,t)}),D(e.Axis,"setExtremes",function(){var e,t=this.chart,a=0;t.series.forEach(function(t){t.markerClusterInfo&&(e=I((t.options.cluster||{}).animation),a=e.duration||0)}),k(function(){t.tooltip&&t.tooltip.destroy()},a)})}),a(e,"masters/modules/marker-clusters.src.js",[],function(){})});