"use strict";import H from"../Core/Globals.js";import U from"../Core/Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,fireEvent=U.fireEvent,pick=U.pick,seriesType=U.seriesType;import"../Core/Options.js";var pieProto=H.seriesTypes.pie.prototype;seriesType("variablepie","pie",{minPointSize:"10%",maxPointSize:"100%",zMin:void 0,zMax:void 0,sizeBy:"area",tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> {series.name}<br/>Value: {point.y}<br/>Size: {point.z}<br/>'}},{pointArrayMap:["y","z"],parallelArrays:["x","y","z"],redraw:function(){this.center=null,pieProto.redraw.call(this,arguments)},zValEval:function(t){return"number"==typeof t&&!isNaN(t)||null},calculateExtremes:function(){var t,i,a=this.chart,e=a.plotWidth,n=a.plotHeight,s=this.options,r=2*(s.slicedOffset||0),o=this.zData,l=Math.min(e,n)-r,h={},c=this.center||this.getCenter();["minPointSize","maxPointSize"].forEach(function(t){var i=s[t],a=/%$/.test(i);i=parseInt(i,10),h[t]=a?l*i/100:2*i}),this.minPxSize=c[3]+h.minPointSize,this.maxPxSize=clamp(c[2],c[3]+h.minPointSize,h.maxPointSize),o.length&&(t=pick(s.zMin,arrayMin(o.filter(this.zValEval))),i=pick(s.zMax,arrayMax(o.filter(this.zValEval))),this.getRadii(t,i,this.minPxSize,this.maxPxSize))},getRadii:function(t,i,a,e){for(var n,s,r,o=0,l=this.zData,h=l.length,c=[],p="radius"!==this.options.sizeBy,M=i-t;o<h;o++)(s=this.zValEval(l[o])?l[o]:t)<=t?r=a/2:s>=i?r=e/2:(n=M>0?(s-t)/M:.5,p&&(n=Math.sqrt(n)),r=Math.ceil(a+n*(e-a))/2),c.push(r);this.radii=c},translate:function(t){this.generatePoints();var i,a,e,n,s,r,o,l,h,c,p,M=0,d=this.options,m=d.slicedOffset,z=m+(d.borderWidth||0),f=d.startAngle||0,P=Math.PI/180*(f-90),y=Math.PI/180*(pick(d.endAngle,f+360)-90),x=y-P,u=this.points,b=d.dataLabels.distance,g=d.ignoreHiddenPoint,v=u.length;for(this.startAngleRad=P,this.endAngleRad=y,this.calculateExtremes(),t||(this.center=t=this.getCenter()),o=0;o<v;o++)l=u[o],h=this.radii[o],l.labelDistance=pick(l.options.dataLabels&&l.options.dataLabels.distance,b),this.maxLabelDistance=Math.max(this.maxLabelDistance||0,l.labelDistance),a=P+M*x,g&&!l.visible||(M+=l.percentage/100),e=P+M*x,l.shapeType="arc",l.shapeArgs={x:t[0],y:t[1],r:h,innerR:t[3]/2,start:Math.round(1e3*a)/1e3,end:Math.round(1e3*e)/1e3},(n=(e+a)/2)>1.5*Math.PI?n-=2*Math.PI:n<-Math.PI/2&&(n+=2*Math.PI),l.slicedTranslation={translateX:Math.round(Math.cos(n)*m),translateY:Math.round(Math.sin(n)*m)},s=Math.cos(n)*t[2]/2,r=Math.sin(n)*t[2]/2,c=Math.cos(n)*h,p=Math.sin(n)*h,l.tooltipPos=[t[0]+.7*s,t[1]+.7*r],l.half=n<-Math.PI/2||n>Math.PI/2?1:0,l.angle=n,i=Math.min(z,l.labelDistance/5),l.labelPosition={natural:{x:t[0]+c+Math.cos(n)*l.labelDistance,y:t[1]+p+Math.sin(n)*l.labelDistance},final:{},alignment:l.half?"right":"left",connectorPosition:{breakAt:{x:t[0]+c+Math.cos(n)*i,y:t[1]+p+Math.sin(n)*i},touchingSliceAt:{x:t[0]+c,y:t[1]+p}}};fireEvent(this,"afterTranslate")}});