"use strict";import H from"../Core/Globals.js";import SVGRenderer from"../Core/Renderer/SVG/SVGRenderer.js";import LegendSymbolMixin from"../Mixins/LegendSymbol.js";import Point from"../Core/Series/Point.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,defined=U.defined,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,pick=U.pick,relativeLength=U.relativeLength,seriesType=U.seriesType,setAnimation=U.setAnimation;import"./ColumnSeries.js";import centeredSeriesMixin from"../Mixins/CenteredSeries.js";import"../Core/Options.js";var getStartAndEndRadians=centeredSeriesMixin.getStartAndEndRadians,noop=H.noop,Series=H.Series,seriesTypes=H.seriesTypes;seriesType("pie","line",{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,connectorPadding:5,connectorShape:"fixedOffset",crookDistance:"70%",distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}},{isCartesian:!1,requireSorting:!1,directTouch:!0,noSharedTooltip:!0,trackerGroups:["group","dataLabelsGroup"],axisTypes:[],pointAttribs:seriesTypes.column.prototype.pointAttribs,animate:function(e){var t=this,i=t.points,n=t.startAngleRad;e||i.forEach(function(e){var i=e.graphic,a=e.shapeArgs;i&&a&&(i.attr({r:pick(e.startR,t.center&&t.center[3]/2),start:n,end:n}),i.animate({r:a.r,start:a.start,end:a.end},t.options.animation))})},hasData:function(){return!!this.processedXData.length},updateTotals:function(){var e,t,i=0,n=this.points,a=n.length,r=this.options.ignoreHiddenPoint;for(e=0;e<a;e++)t=n[e],i+=r&&!t.visible?0:t.isNull?0:t.y;for(this.total=i,e=0;e<a;e++)(t=n[e]).percentage=i>0&&(t.visible||!r)?t.y/i*100:0,t.total=i},generatePoints:function(){Series.prototype.generatePoints.call(this),this.updateTotals()},getX:function(e,t,i){var n,a=this.center,r=this.radii?this.radii[i.index]:a[2]/2;return n=Math.asin(clamp((e-a[1])/(r+i.labelDistance),-1,1)),a[0]+(t?-1:1)*(Math.cos(n)*(r+i.labelDistance))+(i.labelDistance>0?(t?-1:1)*this.options.dataLabels.padding:0)},translate:function(e){this.generatePoints();var t,i,n,a,r,s,o,l,h=0,d=this.options,c=d.slicedOffset,p=c+(d.borderWidth||0),g=getStartAndEndRadians(d.startAngle,d.endAngle),f=this.startAngleRad=g.start,u=(this.endAngleRad=g.end)-f,y=this.points,m=d.dataLabels.distance,b=d.ignoreHiddenPoint,v=y.length;for(e||(this.center=e=this.getCenter()),o=0;o<v;o++)l=y[o],i=f+h*u,b&&!l.visible||(h+=l.percentage/100),n=f+h*u,l.shapeType="arc",l.shapeArgs={x:e[0],y:e[1],r:e[2]/2,innerR:e[3]/2,start:Math.round(1e3*i)/1e3,end:Math.round(1e3*n)/1e3},l.labelDistance=pick(l.options.dataLabels&&l.options.dataLabels.distance,m),l.labelDistance=relativeLength(l.labelDistance,l.shapeArgs.r),this.maxLabelDistance=Math.max(this.maxLabelDistance||0,l.labelDistance),(a=(n+i)/2)>1.5*Math.PI?a-=2*Math.PI:a<-Math.PI/2&&(a+=2*Math.PI),l.slicedTranslation={translateX:Math.round(Math.cos(a)*c),translateY:Math.round(Math.sin(a)*c)},r=Math.cos(a)*e[2]/2,s=Math.sin(a)*e[2]/2,l.tooltipPos=[e[0]+.7*r,e[1]+.7*s],l.half=a<-Math.PI/2||a>Math.PI/2?1:0,l.angle=a,t=Math.min(p,l.labelDistance/5),l.labelPosition={natural:{x:e[0]+r+Math.cos(a)*l.labelDistance,y:e[1]+s+Math.sin(a)*l.labelDistance},final:{},alignment:l.labelDistance<0?"center":l.half?"right":"left",connectorPosition:{breakAt:{x:e[0]+r+Math.cos(a)*t,y:e[1]+s+Math.sin(a)*t},touchingSliceAt:{x:e[0]+r,y:e[1]+s}}};fireEvent(this,"afterTranslate")},drawEmpty:function(){var e,t,i=this.startAngleRad,n=this.endAngleRad,a=this.options;0===this.total&&this.center?(e=this.center[0],t=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(e,t,this.center[1]/2,0,i,n).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:SVGRenderer.prototype.symbols.arc(e,t,this.center[2]/2,0,{start:i,end:n,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":a.borderWidth,fill:a.fillColor||"none",stroke:a.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())},redrawPoints:function(){var e,t,i,n,a=this,r=a.chart,s=r.renderer,o=a.options.shadow;this.drawEmpty(),!o||a.shadowGroup||r.styledMode||(a.shadowGroup=s.g("shadow").attr({zIndex:-1}).add(a.group)),a.points.forEach(function(l){var h={};if(t=l.graphic,!l.isNull&&t){if(n=l.shapeArgs,e=l.getTranslate(),!r.styledMode){var d=l.shadowGroup;o&&!d&&(d=l.shadowGroup=s.g("shadow").add(a.shadowGroup)),d&&d.attr(e),i=a.pointAttribs(l,l.selected&&"select")}l.delayedRendering?(t.setRadialReference(a.center).attr(n).attr(e),r.styledMode||t.attr(i).attr({"stroke-linejoin":"round"}).shadow(o,d),l.delayedRendering=!1):(t.setRadialReference(a.center),r.styledMode||merge(!0,h,i),merge(!0,h,n,e),t.animate(h)),t.attr({visibility:l.visible?"inherit":"hidden"}),t.addClass(l.getClassName())}else t&&(l.graphic=t.destroy())})},drawPoints:function(){var e=this.chart.renderer;this.points.forEach(function(t){t.graphic&&t.hasNewShapeType()&&(t.graphic=t.graphic.destroy()),t.graphic||(t.graphic=e[t.shapeType](t.shapeArgs).add(t.series.group),t.delayedRendering=!0)})},searchPoint:noop,sortByAngle:function(e,t){e.sort(function(e,i){return void 0!==e.angle&&(i.angle-e.angle)*t})},drawLegendSymbol:LegendSymbolMixin.drawRectangle,getCenter:centeredSeriesMixin.getCenter,getSymbol:noop,drawGraph:null},{init:function(){Point.prototype.init.apply(this,arguments);var e,t=this;return t.name=pick(t.name,"Slice"),addEvent(t,"select",e=function(e){t.slice("select"===e.type)}),addEvent(t,"unselect",e),t},isValid:function(){return isNumber(this.y)&&this.y>=0},setVisible:function(e,t){var i=this,n=i.series,a=n.chart,r=n.options.ignoreHiddenPoint;t=pick(t,r),e!==i.visible&&(i.visible=i.options.visible=e=void 0===e?!i.visible:e,n.options.data[n.data.indexOf(i)]=i.options,["graphic","dataLabel","connector","shadowGroup"].forEach(function(t){i[t]&&i[t][e?"show":"hide"](!0)}),i.legendItem&&a.legend.colorizeItem(i,e),e||"hover"!==i.state||i.setState(""),r&&(n.isDirty=!0),t&&a.redraw())},slice:function(e,t,i){var n=this.series,a=n.chart;setAnimation(i,a),t=pick(t,!0),this.sliced=this.options.sliced=e=defined(e)?e:!this.sliced,n.options.data[n.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate()),this.shadowGroup&&this.shadowGroup.animate(this.getTranslate())},getTranslate:function(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}},haloPath:function(e){var t=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(t.x,t.y,t.r+e,t.r+e,{innerR:t.r-1,start:t.start,end:t.end})},connectorShapes:{fixedOffset:function(e,t,i){var n=t.breakAt,a=t.touchingSliceAt,r=i.softConnector?["C",e.x+("left"===e.alignment?-5:5),e.y,2*n.x-a.x,2*n.y-a.y,n.x,n.y]:["L",n.x,n.y];return[["M",e.x,e.y],r,["L",a.x,a.y]]},straight:function(e,t){var i=t.touchingSliceAt;return[["M",e.x,e.y],["L",i.x,i.y]]},crookedLine:function(e,t,i){var n=t.touchingSliceAt,a=this.series,r=a.center[0],s=a.chart.plotWidth,o=a.chart.plotLeft,l=e.alignment,h=this.shapeArgs.r,d=relativeLength(i.crookDistance,1),c="left"===l?r+h+(s+o-r-h)*(1-d):o+(r-h)*d,p=["L",c,e.y],g=!0;("left"===l?c>e.x||c<n.x:c<e.x||c>n.x)&&(g=!1);var f=[["M",e.x,e.y]];return g&&f.push(p),f.push(["L",n.x,n.y]),f}},getConnectorPath:function(){var e=this.labelPosition,t=this.series.options.dataLabels,i=t.connectorShape,n=this.connectorShapes;return n[i]&&(i=n[i]),i.call(this,{x:e.final.x,y:e.final.y,alignment:e.alignment},e.connectorPosition,t)}});