"use strict";import H from"../Core/Globals.js";import U from"../Core/Utilities.js";var animObject=U.animObject,seriesType=U.seriesType;import"../Core/Options.js";import NodesMixin from"../Mixins/Nodes.js";var base=H.seriesTypes.sankey.prototype;seriesType("dependencywheel","sankey",{center:[null,null],curveFactor:.6,startAngle:0},{orderNodes:!1,getCenter:H.seriesTypes.pie.prototype.getCenter,createNodeColumns:function(){var t=[this.createNodeColumn()];return this.nodes.forEach(function(e){e.column=0,t[0].push(e)}),t},getNodePadding:function(){return this.options.nodePadding/Math.PI},createNode:function(t){var e=base.createNode.call(this,t);return e.index=this.nodes.length-1,e.getSum=function(){return e.linksFrom.concat(e.linksTo).reduce(function(t,e){return t+e.weight},0)},e.offset=function(t){var n,i,a=0,r=e.linksFrom.concat(e.linksTo);function s(t){return t.fromNode===e?t.toNode:t.fromNode}for(r.sort(function(t,e){return s(t).index-s(e).index}),n=0;n<r.length;n++)if(s(r[n]).index>e.index){r=r.slice(0,n).reverse().concat(r.slice(n).reverse()),i=!0;break}for(i||r.reverse(),n=0;n<r.length;n++){if(r[n]===t)return a;a+=r[n].weight}},e},translate:function(){var t=this.options,e=2*Math.PI/(this.chart.plotHeight+this.getNodePadding()),n=this.getCenter(),i=(t.startAngle-90)*H.deg2rad;base.translate.call(this),this.nodeColumns[0].forEach(function(a){if(a.sum){var r=a.shapeArgs,s=n[0],o=n[1],c=n[2]/2,h=c-t.nodeWidth,d=i+e*r.y,p=i+e*(r.y+r.height);a.angle=d+(p-d)/2,a.shapeType="arc",a.shapeArgs={x:s,y:o,r:c,innerR:h,start:d,end:p},a.dlBox={x:s+Math.cos((d+p)/2)*(c+h)/2,y:o+Math.sin((d+p)/2)*(c+h)/2,width:1,height:1},a.linksFrom.forEach(function(n){if(n.linkBase){var a,r=n.linkBase.map(function(r,c){var d=e*r,p=Math.cos(i+d)*(h+1),l=Math.sin(i+d)*(h+1),u=t.curveFactor;return(a=Math.abs(n.linkBase[3-c]*e-d))>Math.PI&&(a=2*Math.PI-a),(a*=h)<h&&(u*=a/h),{x:s+p,y:o+l,cpX:s+(1-u)*p,cpY:o+(1-u)*l}});n.shapeArgs={d:[["M",r[0].x,r[0].y],["A",h,h,0,0,1,r[1].x,r[1].y],["C",r[1].cpX,r[1].cpY,r[2].cpX,r[2].cpY,r[2].x,r[2].y],["A",h,h,0,0,1,r[3].x,r[3].y],["C",r[3].cpX,r[3].cpY,r[0].cpX,r[0].cpY,r[0].x,r[0].y]]}}})}})},animate:function(t){if(!t){var e=animObject(this.options.animation).duration/2/this.nodes.length;this.nodes.forEach(function(t,n){var i=t.graphic;i&&(i.attr({opacity:0}),setTimeout(function(){i.animate({opacity:1},{duration:e})},e*n))},this),this.points.forEach(function(t){var e=t.graphic;!t.isNode&&e&&e.attr({opacity:0}).animate({opacity:1},this.options.animation)},this)}}},{setState:NodesMixin.setNodeState,getDataLabelPath:function(t){var e=this.series.chart.renderer,n=this.shapeArgs,i=this.angle<0||this.angle>Math.PI,a=n.start,r=n.end;return this.dataLabelPath||(this.dataLabelPath=e.arc({open:!0}).add(t)),this.dataLabelPath.attr({x:n.x,y:n.y,r:n.r+(this.dataLabel.options.distance||0),start:i?a:r,end:i?r:a,clockwise:+i}),this.dataLabelPath},isValid:function(){return!0}});