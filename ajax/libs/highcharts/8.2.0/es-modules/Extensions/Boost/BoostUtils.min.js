"use strict";import H from"../../Core/Globals.js";var win=H.win,doc=H.doc;import"../../Core/Series/Series.js";import boostableMap from"./BoostableMap.js";import createAndAttachRenderer from"./BoostAttach.js";import U from"../../Core/Utilities.js";var pick=U.pick,CHUNK_SIZE=3e3;function patientMax(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];var e=-Number.MAX_VALUE;return o.forEach(function(o){if(null!=o&&void 0!==o.length&&o.length>0)return e=o.length,!0}),e}function boostEnabled(o){return pick(o&&o.options&&o.options.boost&&o.options.boost.enabled,!0)}function shouldForceChartSeriesBoosting(o){var t,e=0,r=0,s=pick(o.options.boost&&o.options.boost.allowForce,!0);if(void 0!==o.boostForceChartBoost)return o.boostForceChartBoost;if(o.series.length>1)for(var n=0;n<o.series.length;n++)0!==(t=o.series[n]).options.boostThreshold&&!1!==t.visible&&"heatmap"!==t.type&&(boostableMap[t.type]&&++r,patientMax(t.processedXData,t.options.data,t.points)>=(t.options.boostThreshold||Number.MAX_VALUE)&&++e);return o.boostForceChartBoost=s&&(r===o.series.length&&e>0||e>5),o.boostForceChartBoost}function renderIfNotSeriesBoosting(o,t,e){o&&t.renderTarget&&t.canvas&&!(e||t.chart).isChartSeriesBoosting()&&o.render(e||t.chart)}function allocateIfNotSeriesBoosting(o,t){o&&t.renderTarget&&t.canvas&&!t.chart.isChartSeriesBoosting()&&o.allocateBufferForSingleSeries(t)}function eachAsync(o,t,e,r,s,n){for(var i=(s=s||0)+(r=r||CHUNK_SIZE),a=!0;a&&s<i&&s<o.length;)a=t(o[s],s),++s;a&&(s<o.length?n?eachAsync(o,t,e,r,s,n):win.requestAnimationFrame?win.requestAnimationFrame(function(){eachAsync(o,t,e,r,s)}):setTimeout(function(){eachAsync(o,t,e,r,s)}):e&&e())}function hasWebGLSupport(){var o,t=0,e=["webgl","experimental-webgl","moz-webgl","webkit-3d"];if(void 0!==win.WebGLRenderingContext)for(o=doc.createElement("canvas");t<e.length;t++)try{if(null!=o.getContext(e[t]))return!0}catch(o){}return!1}function pointDrawHandler(o){var t,e=!0;if(this.chart.options&&this.chart.options.boost&&(e=void 0===this.chart.options.boost.enabled||this.chart.options.boost.enabled),!e||!this.isSeriesBoosting)return o.call(this);this.chart.isBoosting=!0,(t=createAndAttachRenderer(this.chart,this))&&(allocateIfNotSeriesBoosting(t,this),t.pushSeries(this)),renderIfNotSeriesBoosting(t,this)}var funs={patientMax:patientMax,boostEnabled:boostEnabled,shouldForceChartSeriesBoosting:shouldForceChartSeriesBoosting,renderIfNotSeriesBoosting:renderIfNotSeriesBoosting,allocateIfNotSeriesBoosting:allocateIfNotSeriesBoosting,eachAsync:eachAsync,hasWebGLSupport:hasWebGLSupport,pointDrawHandler:pointDrawHandler};H.hasWebGLSupport=hasWebGLSupport;export default funs;