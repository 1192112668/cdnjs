"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFilterOptions=createFilterOptions,exports.default=useAutocomplete;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),React=_interopRequireWildcard(require("react")),_utils=require("../utils");function stripDiacritics(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function createFilterOptions(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ignoreAccents,a=void 0===t||t,n=e.ignoreCase,u=void 0===n||n,l=e.limit,r=e.matchFrom,c=void 0===r?"any":r,s=e.stringify,o=e.trim,d=void 0!==o&&o;return function(e,t){var n=t.inputValue,r=t.getOptionLabel,o=d?n.trim():n;u&&(o=o.toLowerCase()),a&&(o=stripDiacritics(o));var i=e.filter(function(e){var t=(s||r)(e);return u&&(t=t.toLowerCase()),a&&(t=stripDiacritics(t)),"start"===c?0===t.indexOf(o):-1<t.indexOf(o)});return"number"==typeof l?i.slice(0,l):i}}function findIndex(e,t){for(var n=0;n<e.length;n+=1)if(t(e[n]))return n;return-1}var defaultFilterOptions=createFilterOptions(),pageSize=5;function useAutocomplete(e){var t=e.autoComplete,c=void 0!==t&&t,n=e.autoHighlight,r=void 0!==n&&n,o=e.autoSelect,i=void 0!==o&&o,a=e.blurOnSelect,s=void 0!==a&&a,u=e.clearOnBlur,l=void 0===u?!e.freeSolo:u,d=e.clearOnEscape,f=void 0!==d&&d,p=e.componentName,v=void 0===p?"useAutocomplete":p,g=e.debug,h=void 0!==g&&g,b=e.defaultValue,m=void 0===b?e.multiple?[]:null:b,x=e.disableClearable,y=void 0!==x&&x,O=e.disableCloseOnSelect,D=void 0!==O&&O,R=e.disabledItemsFocusable,k=void 0!==R&&R,S=e.disableListWrap,_=void 0!==S&&S,C=e.filterOptions,A=void 0===C?defaultFilterOptions:C,w=e.filterSelectedOptions,E=void 0!==w&&w,T=e.freeSolo,q=void 0!==T&&T,I=e.getOptionDisabled,N=e.getOptionLabel,L=void 0===N?function(e){var t;return null!==(t=e.label)&&void 0!==t?t:e}:N,P=e.getOptionSelected,F=void 0===P?function(e,t){return e===t}:P,M=e.groupBy,H=e.handleHomeEndKeys,V=void 0===H?!e.freeSolo:H,z=e.id,B=e.includeInputInList,K=void 0!==B&&B,U=e.inputValue,W=e.multiple,j=void 0!==W&&W,J=e.onChange,Y=e.onClose,G=e.onHighlightChange,Q=e.onInputChange,X=e.onOpen,Z=e.open,$=e.openOnFocus,ee=void 0!==$&&$,te=e.options,ne=e.selectOnFocus,re=void 0===ne?!e.freeSolo:ne,oe=e.value,ie=(0,_utils.unstable_useId)(z),ae=L;"production"!==process.env.NODE_ENV&&(ae=function(e){var t,n=L(e);return"string"!=typeof n&&(t=void 0===n?"undefined":"".concat((0,_typeof2.default)(n)," (").concat(n,")"),console.error("Material-UI: The `getOptionLabel` method of ".concat(v," returned ").concat(t," instead of a string for ").concat(JSON.stringify(e),"."))),n});var ue=React.useRef(!1),le=React.useRef(!0),ce=React.useRef(null),se=React.useRef(null),de=React.useState(null),fe=de[0],pe=de[1],ve=React.useState(-1),ge=ve[0],he=ve[1],be=r?0:-1,me=React.useRef(be),xe=(0,_utils.useControlled)({controlled:oe,default:m,name:v}),ye=(0,_slicedToArray2.default)(xe,2),Oe=ye[0],De=ye[1],Re=(0,_utils.useControlled)({controlled:U,default:"",name:v,state:"inputValue"}),ke=(0,_slicedToArray2.default)(Re,2),Se=ke[0],_e=ke[1],Ce=React.useState(!1),Ae=Ce[0],we=Ce[1],Ee=(0,_utils.useEventCallback)(function(e,t){var n,r;r=!j&&null!=t&&"string"==typeof(n=ae(t))?n:"",Se!==r&&(_e(r),Q&&Q(e,r,"reset"))});React.useEffect(function(){Ee(null,Oe)},[Oe,Ee]);var Te,qe=(0,_utils.useControlled)({controlled:Z,default:!1,name:v,state:"open"}),Ie=(0,_slicedToArray2.default)(qe,2),Ne=Ie[0],Le=Ie[1],Pe=React.useState(!0),Fe=Pe[0],Me=Pe[1],He=!j&&null!=Oe&&Se===ae(Oe),Ve=Ne,ze=Ve?A(te.filter(function(t){return!E||!(j?Oe:[Oe]).some(function(e){return null!==e&&F(t,e)})}),{inputValue:He&&Fe?"":Se,getOptionLabel:ae}):[],Be=Ne&&0<ze.length;"production"!==process.env.NODE_ENV&&null!==Oe&&!q&&0<te.length&&(0<(Te=(j?Oe:[Oe]).filter(function(t){return!te.some(function(e){return F(e,t)})})).length&&console.warn(["Material-UI: The value provided to ".concat(v," is invalid."),"None of the options match with `".concat(1<Te.length?JSON.stringify(Te):JSON.stringify(Te[0]),"`."),"You can use the `getOptionSelected` prop to customize the equality test."].join("\n")));var Ke=(0,_utils.useEventCallback)(function(e){-1===e?ce.current.focus():fe.querySelector('[data-tag-index="'.concat(e,'"]')).focus()});React.useEffect(function(){j&&ge>Oe.length-1&&(he(-1),Ke(-1))},[Oe,j,ge,Ke]);var Ue=(0,_utils.useEventCallback)(function(e){var t,n,r,o,i,a=e.event,u=e.index,l=e.reason,c=void 0===l?"auto":l;-1===(me.current=u)?ce.current.removeAttribute("aria-activedescendant"):ce.current.setAttribute("aria-activedescendant","".concat(ie,"-option-").concat(u)),G&&G(a,-1===u?null:ze[u],c),se.current&&((t=se.current.querySelector("[data-focus]"))&&t.removeAttribute("data-focus"),(n=se.current.parentElement.querySelector('[role="listbox"]'))&&(-1!==u?(r=se.current.querySelector('[data-option-index="'.concat(u,'"]')))&&(r.setAttribute("data-focus","true"),n.scrollHeight>n.clientHeight&&"mouse"!==c&&(o=r,n.clientHeight+n.scrollTop<(i=o.offsetTop+o.offsetHeight)?n.scrollTop=i-n.clientHeight:o.offsetTop-o.offsetHeight*(M?1.3:0)<n.scrollTop&&(n.scrollTop=o.offsetTop-o.offsetHeight*(M?1.3:0)))):n.scrollTop=0))}),We=(0,_utils.useEventCallback)(function(e){var t,n,r=e.event,o=e.diff,i=e.direction,a=void 0===i?"next":i,u=e.reason,l=void 0===u?"auto":u;Ve&&(t=function(e,t){if(!se.current||-1===e)return-1;for(var n=e;;){if("next"===t&&n===ze.length||"previous"===t&&-1===n)return-1;var r=se.current.querySelector('[data-option-index="'.concat(n,'"]')),o=!k&&(!r||r.disabled||"true"===r.getAttribute("aria-disabled"));if(!(r&&!r.hasAttribute("tabindex")||o))return n;n+="next"===t?1:-1}}(function(){var e=ze.length-1;if("reset"===o)return be;if("start"===o)return 0;if("end"===o)return e;var t=me.current+o;return t<0?-1===t&&K?-1:_&&-1!==me.current||1<Math.abs(o)?0:e:e<t?t===1+e&&K?-1:_||1<Math.abs(o)?e:0:t}(),a),Ue({index:t,reason:l,event:r}),c&&"reset"!==o&&(-1===t?ce.current.value=Se:(n=ae(ze[t]),0===(ce.current.value=n).toLowerCase().indexOf(Se.toLowerCase())&&0<Se.length&&ce.current.setSelectionRange(Se.length,n.length))))}),je=React.useCallback(function(){if(Ve){var t=j?Oe[0]:Oe;if(0!==ze.length&&null!=t){if(se.current)if(E||null==t)me.current>=ze.length-1?Ue({index:ze.length-1}):Ue({index:me.current});else{var n=ze[me.current];if(j&&n&&-1!==findIndex(Oe,function(e){return F(n,e)}))return;var e=findIndex(ze,function(e){return F(e,t)});-1===e?We({diff:"reset"}):Ue({index:e})}}else We({diff:"reset"})}},[0===ze.length,!j&&Oe,E,We,Ue,Ve,Se,j]),Je=(0,_utils.useEventCallback)(function(e){(0,_utils.setRef)(se,e),e&&je()});React.useEffect(function(){je()},[je]);function Ye(e){Ne||(Le(!0),Me(!0),X&&X(e))}function Ge(e,t){Ne&&(Le(!1),Y&&Y(e,t))}function Qe(e,t,n,r){Oe!==t&&(J&&J(e,t,n,r),De(t))}function Xe(e,t,n,r){var o,i,a=3<arguments.length&&void 0!==r?r:"options",u=2<arguments.length&&void 0!==n?n:"select-option",l=t;j&&(l=Array.isArray(Oe)?Oe.slice():[],"production"===process.env.NODE_ENV||1<(o=l.filter(function(e){return F(t,e)})).length&&console.error(["Material-UI: The `getOptionSelected` method of ".concat(v," do not handle the arguments correctly."),"The component expects a single value to match a given option but found ".concat(o.length," matches.")].join("\n")),-1===(i=findIndex(l,function(e){return F(t,e)}))?l.push(t):"freeSolo"!==a&&(l.splice(i,1),u="remove-option")),Ee(e,l),Qe(e,l,u,{option:t}),D||e.ctrlKey||e.metaKey||Ge(e,u),(!0===s||"touch"===s&&Ze.current||"mouse"===s&&!Ze.current)&&ce.current.blur()}var Ze=React.useRef(!1);function $e(e,t){var n;j&&(Ge(e,"toggleInput"),-1===(n=ge)?""===Se&&"previous"===t&&(n=Oe.length-1):((n+="next"===t?1:-1)<0&&(n=0),n===Oe.length&&(n=-1)),n=function(e,t){if(-1===e)return-1;for(var n=e;;){if("next"===t&&n===Oe.length||"previous"===t&&-1===n)return-1;var r=fe.querySelector('[data-tag-index="'.concat(n,'"]'));if(r&&r.hasAttribute("tabindex")&&!r.disabled&&"true"!==r.getAttribute("aria-disabled"))return n;n+="next"===t?1:-1}}(n,t),he(n),Ke(n))}function et(e){ue.current=!0,_e(""),Q&&Q(e,"","clear"),Qe(e,j?[]:null,"clear")}function tt(e){we(!0),ee&&!ue.current&&Ye(e)}function nt(e){null!==se.current&&se.current.parentElement.contains(document.activeElement)?ce.current.focus():(we(!1),le.current=!0,ue.current=!1,h&&""!==Se||(i&&-1!==me.current&&Ve?Xe(e,ze[me.current],"blur"):i&&q&&""!==Se?Xe(e,Se,"blur","freeSolo"):l&&Ee(e,Oe),Ge(e,"blur")))}function rt(e){var t=e.target.value;Se!==t&&(_e(t),Me(!1),Q&&Q(e,t,"input")),""===t?y||j||Qe(e,null,"clear"):Ye(e)}function ot(e){Ue({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"mouse"})}function it(){Ze.current=!0}function at(e){var t=Number(e.currentTarget.getAttribute("data-option-index"));Xe(e,ze[t],"select-option"),Ze.current=!1}function ut(e){Ne?Ge(e,"toggleInput"):Ye(e)}function lt(e){e.target.getAttribute("id")!==ie&&e.preventDefault()}function ct(){ce.current.focus(),re&&le.current&&ce.current.selectionEnd-ce.current.selectionStart==0&&ce.current.select(),le.current=!1}function st(e){""!==Se&&Ne||ut(e)}var dt,ft,pt=(pt=q&&0<Se.length)||(j?0<Oe.length:null!==Oe),vt=ze;return M&&(dt=new Map,ft=!1,vt=ze.reduce(function(e,t,n){var r=M(t);return 0<e.length&&e[e.length-1].group===r?e[e.length-1].options.push(t):("production"!==process.env.NODE_ENV&&(dt.get(r)&&!ft&&(console.warn("Material-UI: The options provided combined with the `groupBy` method of ".concat(v," returns duplicated headers."),"You can solve the issue by sorting the options with the output of `groupBy`."),ft=!0),dt.set(r,!0)),e.push({key:n,index:n,group:r,options:[t]})),e},[])),{getRootProps:function(e){var i,t=0<arguments.length&&void 0!==e?e:{};return(0,_extends2.default)({"aria-owns":Be?"".concat(ie,"-listbox"):null,role:"combobox","aria-expanded":Be},t,{onKeyDown:(i=t,function(e){switch(-1!==ge&&-1===["ArrowLeft","ArrowRight"].indexOf(e.key)&&(he(-1),Ke(-1)),e.key){case"Home":Ve&&V&&(e.preventDefault(),We({diff:"start",direction:"next",reason:"keyboard",event:e}));break;case"End":Ve&&V&&(e.preventDefault(),We({diff:"end",direction:"previous",reason:"keyboard",event:e}));break;case"PageUp":e.preventDefault(),We({diff:-pageSize,direction:"previous",reason:"keyboard",event:e}),Ye(e);break;case"PageDown":e.preventDefault(),We({diff:pageSize,direction:"next",reason:"keyboard",event:e}),Ye(e);break;case"ArrowDown":e.preventDefault(),We({diff:1,direction:"next",reason:"keyboard",event:e}),Ye(e);break;case"ArrowUp":e.preventDefault(),We({diff:-1,direction:"previous",reason:"keyboard",event:e}),Ye(e);break;case"ArrowLeft":$e(e,"previous");break;case"ArrowRight":$e(e,"next");break;case"Enter":if(229===e.which)break;if(-1!==me.current&&Ve){var t=ze[me.current],n=!!I&&I(t);if(e.preventDefault(),n)return;Xe(e,t,"select-option"),c&&ce.current.setSelectionRange(ce.current.value.length,ce.current.value.length)}else q&&""!==Se&&0==He&&(j&&e.preventDefault(),Xe(e,Se,"create-option","freeSolo"));break;case"Escape":Ve?(e.preventDefault(),e.stopPropagation(),Ge(e,"escape")):f&&(""!==Se||j&&0<Oe.length)&&(e.preventDefault(),e.stopPropagation(),et(e));break;case"Backspace":var r,o;j&&""===Se&&0<Oe.length&&(r=-1===ge?Oe.length-1:ge,(o=Oe.slice()).splice(r,1),Qe(e,o,"remove-option",{option:Oe[r]}))}i.onKeyDown&&i.onKeyDown(e)}),onMouseDown:lt,onClick:ct})},getInputLabelProps:function(){return{id:"".concat(ie,"-label"),htmlFor:ie}},getInputProps:function(){return{id:ie,value:Se,onBlur:nt,onFocus:tt,onChange:rt,onMouseDown:st,"aria-activedescendant":Ve?"":null,"aria-autocomplete":c?"both":"list","aria-controls":Be?"".concat(ie,"-listbox"):null,autoComplete:"off",ref:ce,autoCapitalize:"none",spellCheck:"false"}},getClearProps:function(){return{tabIndex:-1,onClick:et}},getPopupIndicatorProps:function(){return{tabIndex:-1,onClick:ut}},getTagProps:function(e){var n,t=e.index;return{key:t,"data-tag-index":t,tabIndex:-1,onDelete:(n=t,function(e){var t=Oe.slice();t.splice(n,1),Qe(e,t,"remove-option",{option:Oe[n]})})}},getListboxProps:function(){return{role:"listbox",id:"".concat(ie,"-listbox"),"aria-labelledby":"".concat(ie,"-label"),ref:Je,onMouseDown:function(e){e.preventDefault()}}},getOptionProps:function(e){var t=e.index,n=e.option,r=(j?Oe:[Oe]).some(function(e){return null!=e&&F(n,e)}),o=!!I&&I(n);return{key:t,tabIndex:-1,role:"option",id:"".concat(ie,"-option-").concat(t),onMouseOver:ot,onClick:at,onTouchStart:it,"data-option-index":t,"aria-disabled":o,"aria-selected":r}},id:ie,inputValue:Se,value:Oe,dirty:pt,popupOpen:Ve,focused:Ae||-1!==ge,anchorEl:fe,setAnchorEl:pe,focusedTag:ge,groupedOptions:vt}}