"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ariaHidden=ariaHidden,exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_getScrollbarSize=_interopRequireDefault(require("../utils/getScrollbarSize")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_ownerWindow=_interopRequireDefault(require("../utils/ownerWindow"));function isOverflowing(e){var t=(0,_ownerDocument.default)(e);return t.body===e?(0,_ownerWindow.default)(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}function ariaHidden(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function getPaddingRight(e){return parseInt((0,_ownerWindow.default)(e).getComputedStyle(e).paddingRight,10)||0}function ariaHiddenSiblings(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],r=4<arguments.length?arguments[4]:void 0,a=[t,n].concat((0,_toConsumableArray2.default)(i)),o=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,function(e){-1===a.indexOf(e)&&-1===o.indexOf(e.tagName)&&ariaHidden(e,r)})}function findIndexOf(e,n){var i=-1;return e.some(function(e,t){return!!n(e)&&(i=t,!0)}),i}function handleContainer(e,t){var n,i,r,a,o,l=[],d=e.container;t.disableScrollLock||(isOverflowing(d)&&(n=(0,_getScrollbarSize.default)((0,_ownerDocument.default)(d)),l.push({value:d.style.paddingRight,property:"padding-right",el:d}),d.style.paddingRight="".concat(getPaddingRight(d)+n,"px"),i=(0,_ownerDocument.default)(d).querySelectorAll(".mui-fixed"),[].forEach.call(i,function(e){l.push({value:e.style.paddingRight,property:"padding-right",el:e}),e.style.paddingRight="".concat(getPaddingRight(e)+n,"px")})),r=d.parentElement,a=(0,_ownerWindow.default)(d),o="HTML"===(null==r?void 0:r.nodeName)&&"scroll"===a.getComputedStyle(r).overflowY?r:d,l.push({value:o.style.overflow,property:"overflow",el:o}),o.style.overflow="hidden");return function(){l.forEach(function(e){var t=e.value,n=e.el,i=e.property;t?n.style.setProperty(i,t):n.style.removeProperty(i)})}}function getHiddenSiblings(e){var t=[];return[].forEach.call(e.children,function(e){"true"===e.getAttribute("aria-hidden")&&t.push(e)}),t}var ModalManager=function(){function e(){(0,_classCallCheck2.default)(this,e),this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}return(0,_createClass2.default)(e,[{key:"add",value:function(e,t){var n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);var i=getHiddenSiblings(t);ariaHiddenSiblings(t,e.mount,e.modalRef,i,!0);var r=findIndexOf(this.containers,function(e){return e.container===t});return-1!==r?this.containers[r].modals.push(e):this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:i}),n}},{key:"mount",value:function(t,e){var n=findIndexOf(this.containers,function(e){return-1!==e.modals.indexOf(t)}),i=this.containers[n];i.restore||(i.restore=handleContainer(i,e))}},{key:"remove",value:function(t){var e=this.modals.indexOf(t);if(-1===e)return e;var n,i=findIndexOf(this.containers,function(e){return-1!==e.modals.indexOf(t)}),r=this.containers[i];return r.modals.splice(r.modals.indexOf(t),1),this.modals.splice(e,1),0===r.modals.length?(r.restore&&r.restore(),t.modalRef&&ariaHidden(t.modalRef,!0),ariaHiddenSiblings(r.container,t.mount,t.modalRef,r.hiddenSiblings,!1),this.containers.splice(i,1)):(n=r.modals[r.modals.length-1]).modalRef&&ariaHidden(n.modalRef,!1),e}},{key:"isTopModal",value:function(e){return 0<this.modals.length&&this.modals[this.modals.length-1]===e}}]),e}();exports.default=ModalManager;