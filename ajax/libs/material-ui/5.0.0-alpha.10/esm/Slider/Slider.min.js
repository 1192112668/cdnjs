import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import clsx from"clsx";import{chainPropTypes}from"@material-ui/utils";import withStyles from"../styles/withStyles";import useTheme from"../styles/useTheme";import{fade,lighten,darken}from"../styles/colorManipulator";import useIsFocusVisible from"../utils/useIsFocusVisible";import useEnhancedEffect from"../utils/useEnhancedEffect";import ownerDocument from"../utils/ownerDocument";import useEventCallback from"../utils/useEventCallback";import useForkRef from"../utils/useForkRef";import capitalize from"../utils/capitalize";import useControlled from"../utils/useControlled";import ValueLabel from"./ValueLabel";function asc(e,t){return e-t}function clamp(e,t,r){return Math.min(Math.max(t,e),r)}function findClosest(e,t){return e.reduce(function(e,r,a){var o=Math.abs(t-r);return null===e||o<e.distance||o===e.distance?{distance:o,index:a}:e},null).index}function trackFinger(e,t){if(void 0!==t.current&&e.changedTouches){for(var r=0;r<e.changedTouches.length;r+=1){var a=e.changedTouches[r];if(a.identifier===t.current)return{x:a.clientX,y:a.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function valueToPercent(e,t,r){return 100*(e-t)/(r-t)}function percentToValue(e,t,r){return(r-t)*e+t}function getDecimalPrecision(e){if(Math.abs(e)<1){var t=e.toExponential().split("e-"),r=t[0].split(".")[1];return(r?r.length:0)+parseInt(t[1],10)}var a=e.toString().split(".")[1];return a?a.length:0}function roundValueToStep(e,t,r){var a=Math.round((e-r)/t)*t+r;return Number(a.toFixed(getDecimalPrecision(t)))}function setValueIndex(e){var t=e.values,r=e.source,a=e.newValue,o=e.index;if(r[o]===a)return r;var n=t.slice();return n[o]=a,n}function focusThumb(e){var t=e.sliderRef,r=e.activeIndex,a=e.setActive,o=ownerDocument(t.current);t.current.contains(o.activeElement)&&Number(o.activeElement.getAttribute("data-index"))===r||t.current.querySelector('[role="slider"][data-index="'.concat(r,'"]')).focus(),a&&a(r)}var cachedSupportsTouchActionNone,axisProps={horizontal:{offset:function(e){return{left:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},"horizontal-reverse":{offset:function(e){return{right:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},vertical:{offset:function(e){return{bottom:"".concat(e,"%")}},leap:function(e){return{height:"".concat(e,"%")}}}},Identity=function(e){return e};function doesSupportTouchActionNone(){if(void 0===cachedSupportsTouchActionNone){var e=document.createElement("div");e.style.touchAction="none",document.body.appendChild(e),cachedSupportsTouchActionNone="none"===window.getComputedStyle(e).touchAction,e.parentElement.removeChild(e)}return cachedSupportsTouchActionNone}export var styles=function(e){return{root:{height:2,width:"100%",boxSizing:"content-box",padding:"13px 0",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:e.palette.primary.main,WebkitTapHighlightColor:"transparent","&$disabled":{pointerEvents:"none",cursor:"default",color:e.palette.grey[400]},"&$vertical":{width:2,height:"100%",padding:"0 13px"},"@media (pointer: coarse)":{padding:"20px 0","&$vertical":{padding:"0 20px"}},"@media print":{colorAdjust:"exact"}},colorPrimary:{},colorSecondary:{color:e.palette.secondary.main},marked:{marginBottom:20,"&$vertical":{marginBottom:"auto",marginRight:20}},vertical:{},disabled:{},rail:{display:"block",position:"absolute",width:"100%",height:2,borderRadius:1,backgroundColor:"currentColor",opacity:.38,"$vertical &":{height:"100%",width:2}},track:{display:"block",position:"absolute",height:2,borderRadius:1,backgroundColor:"currentColor","$vertical &":{width:2}},trackFalse:{"& $track":{display:"none"}},trackInverted:{"& $track":{backgroundColor:"light"===e.palette.type?lighten(e.palette.primary.main,.62):darken(e.palette.primary.main,.5)},"& $rail":{opacity:1}},thumb:{position:"absolute",width:12,height:12,marginLeft:-6,marginTop:-5,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",left:-15,top:-15,right:-15,bottom:-15},"&:hover, &$focusVisible":{boxShadow:"0px 0px 0px 8px ".concat(fade(e.palette.primary.main,.16)),"@media (hover: none)":{boxShadow:"none"}},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(fade(e.palette.primary.main,.16))},"&$disabled":{width:8,height:8,marginLeft:-4,marginTop:-3,"&:hover":{boxShadow:"none"}},"$vertical &":{marginLeft:-5,marginBottom:-6},"$vertical &$disabled":{marginLeft:-3,marginBottom:-4}},thumbColorPrimary:{},thumbColorSecondary:{"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(fade(e.palette.secondary.main,.16))},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(fade(e.palette.secondary.main,.16))}},active:{},focusVisible:{},valueLabel:{left:"calc(-50% - 4px)"},mark:{position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},markActive:{backgroundColor:e.palette.background.paper,opacity:.8},markLabel:_extends({},e.typography.body2,{color:e.palette.text.secondary,position:"absolute",top:26,transform:"translateX(-50%)",whiteSpace:"nowrap","$vertical &":{top:"auto",left:26,transform:"translateY(50%)"},"@media (pointer: coarse)":{top:40,"$vertical &":{left:31}}}),markLabelActive:{color:e.palette.text.primary}}};var Slider=React.forwardRef(function(e,t){var r=e["aria-label"],a=e["aria-labelledby"],o=e["aria-valuetext"],n=e.classes,i=e.className,l=e.color,u=void 0===l?"primary":l,s=e.component,c=void 0===s?"span":s,p=e.defaultValue,d=e.disabled,m=void 0!==d&&d,v=e.getAriaLabel,f=e.getAriaValueText,b=e.marks,h=void 0!==b&&b,y=e.max,g=void 0===y?100:y,x=e.min,T=void 0===x?0:x,k=e.name,P=e.onChange,w=e.onChangeCommitted,E=e.onMouseDown,C=e.orientation,A=void 0===C?"horizontal":C,L=e.scale,R=void 0===L?Identity:L,V=e.step,S=void 0===V?1:V,D=e.ThumbComponent,I=void 0===D?"span":D,N=e.track,F=void 0===N?"normal":N,O=e.value,$=e.ValueLabelComponent,M=void 0===$?ValueLabel:$,_=e.valueLabelDisplay,z=void 0===_?"off":_,j=e.valueLabelFormat,B=void 0===j?Identity:j,Y=_objectWithoutProperties(e,["aria-label","aria-labelledby","aria-valuetext","classes","className","color","component","defaultValue","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","ThumbComponent","track","value","ValueLabelComponent","valueLabelDisplay","valueLabelFormat"]),U=useTheme(),W=React.useRef(),X=React.useState(-1),q=X[0],H=X[1],K=React.useState(-1),G=K[0],J=K[1],Q=useControlled({controlled:O,default:p,name:"Slider"}),Z=_slicedToArray(Q,2),ee=Z[0],te=Z[1],re=P&&function(e,t){e instanceof Event||e.persist(),Object.defineProperty(e,"target",{writable:!0,value:{value:t,name:k}}),P(e,t)},ae=Array.isArray(ee),oe=ae?ee.slice().sort(asc):[ee];oe=oe.map(function(e){return clamp(e,T,g)});var ne=!0===h&&null!==S?_toConsumableArray(Array(Math.floor((g-T)/S)+1)).map(function(e,t){return{value:T+S*t}}):h||[],ie=useIsFocusVisible(),le=ie.isFocusVisibleRef,ue=ie.onBlur,se=ie.onFocus,ce=ie.ref,pe=React.useState(-1),de=pe[0],me=pe[1],ve=React.useRef(),fe=useForkRef(ce,ve),be=useForkRef(t,fe),he=useEventCallback(function(e){var t=Number(e.currentTarget.getAttribute("data-index"));se(e),!0===le.current&&me(t),J(t)}),ye=useEventCallback(function(e){ue(e),!1===le.current&&me(-1),J(-1)}),ge=useEventCallback(function(e){var t=Number(e.currentTarget.getAttribute("data-index"));J(t)}),xe=useEventCallback(function(){J(-1)});useEnhancedEffect(function(){m&&ve.current.contains(document.activeElement)&&document.activeElement.blur()},[m]),m&&-1!==q&&H(-1),m&&-1!==de&&me(-1);var Te="rtl"===U.direction,ke=useEventCallback(function(e){var t,r=Number(e.currentTarget.getAttribute("data-index")),a=oe[r],o=(g-T)/10,n=ne.map(function(e){return e.value}),i=n.indexOf(a),l=Te?"ArrowLeft":"ArrowRight",u=Te?"ArrowRight":"ArrowLeft";switch(e.key){case"Home":t=T;break;case"End":t=g;break;case"PageUp":S&&(t=a+o);break;case"PageDown":S&&(t=a-o);break;case l:case"ArrowUp":t=S?a+S:n[i+1]||n[n.length-1];break;case u:case"ArrowDown":t=S?a-S:n[i-1]||n[0];break;default:return}if(e.preventDefault(),S&&(t=roundValueToStep(t,S,T)),t=clamp(t,T,g),ae){var s=t;t=setValueIndex({values:oe,source:ee,newValue:t,index:r}).sort(asc),focusThumb({sliderRef:ve,activeIndex:t.indexOf(s)})}te(t),me(r),re&&re(e,t),w&&w(e,t)}),Pe=React.useRef(),we=A;Te&&"vertical"!==A&&(we+="-reverse");var Ee=function(e){var t,r,a=e.finger,o=e.move,n=void 0!==o&&o,i=e.values,l=e.source,u=ve.current.getBoundingClientRect(),s=u.width,c=u.height,p=u.bottom,d=u.left;if(t=0===we.indexOf("vertical")?(p-a.y)/c:(a.x-d)/s,-1!==we.indexOf("-reverse")&&(t=1-t),r=percentToValue(t,T,g),S)r=roundValueToStep(r,S,T);else{var m=ne.map(function(e){return e.value});r=m[findClosest(m,r)]}r=clamp(r,T,g);var v=0;if(ae){var f=r;v=(r=setValueIndex({values:i,source:l,newValue:r,index:v=n?Pe.current:findClosest(i,r)}).sort(asc)).indexOf(f),Pe.current=v}return{newValue:r,activeIndex:v}},Ce=useEventCallback(function(e){var t=trackFinger(e,W);if(t)if("mousemove"!==e.type||0!==e.buttons){var r=Ee({finger:t,move:!0,values:oe,source:ee}),a=r.newValue,o=r.activeIndex;focusThumb({sliderRef:ve,activeIndex:o,setActive:H}),te(a),re&&re(e,a)}else Ae(e)}),Ae=useEventCallback(function(e){var t=trackFinger(e,W);if(t){var r=Ee({finger:t,values:oe,source:ee}).newValue;H(-1),"touchend"===e.type&&J(-1),w&&w(e,r),W.current=void 0;var a=ownerDocument(ve.current);a.removeEventListener("mousemove",Ce),a.removeEventListener("mouseup",Ae),a.removeEventListener("touchmove",Ce),a.removeEventListener("touchend",Ae)}}),Le=useEventCallback(function(e){doesSupportTouchActionNone()||e.preventDefault();var t=e.changedTouches[0];null!=t&&(W.current=t.identifier);var r=trackFinger(e,W),a=Ee({finger:r,values:oe,source:ee}),o=a.newValue,n=a.activeIndex;focusThumb({sliderRef:ve,activeIndex:n,setActive:H}),te(o),re&&re(e,o);var i=ownerDocument(ve.current);i.addEventListener("touchmove",Ce),i.addEventListener("touchend",Ae)});React.useEffect(function(){var e=ve.current;e.addEventListener("touchstart",Le,{passive:doesSupportTouchActionNone()});var t=ownerDocument(e);return function(){e.removeEventListener("touchstart",Le,{passive:doesSupportTouchActionNone()}),t.removeEventListener("mousemove",Ce),t.removeEventListener("mouseup",Ae),t.removeEventListener("touchmove",Ce),t.removeEventListener("touchend",Ae)}},[Ae,Ce,Le]),React.useEffect(function(){if(m){var e=ownerDocument(ve.current);e.removeEventListener("mousemove",Ce),e.removeEventListener("mouseup",Ae),e.removeEventListener("touchmove",Ce),e.removeEventListener("touchend",Ae)}},[m,Ae,Ce]);var Re=useEventCallback(function(e){E&&E(e),e.preventDefault();var t=trackFinger(e,W),r=Ee({finger:t,values:oe,source:ee}),a=r.newValue,o=r.activeIndex;focusThumb({sliderRef:ve,activeIndex:o,setActive:H}),te(a),re&&re(e,a);var n=ownerDocument(ve.current);n.addEventListener("mousemove",Ce),n.addEventListener("mouseup",Ae)}),Ve=valueToPercent(ae?oe[0]:T,T,g),Se=valueToPercent(oe[oe.length-1],T,g)-Ve,De=_extends({},axisProps[we].offset(Ve),axisProps[we].leap(Se));return React.createElement(c,_extends({ref:be,className:clsx(n.root,n["color".concat(capitalize(u))],i,m&&n.disabled,ne.length>0&&ne.some(function(e){return e.label})&&n.marked,!1===F&&n.trackFalse,"vertical"===A&&n.vertical,"inverted"===F&&n.trackInverted),onMouseDown:Re},Y),React.createElement("span",{className:n.rail}),React.createElement("span",{className:n.track,style:De}),React.createElement("input",{value:oe.join(","),name:k,type:"hidden"}),ne.map(function(e,t){var r,a=valueToPercent(e.value,T,g),o=axisProps[we].offset(a);return r=!1===F?-1!==oe.indexOf(e.value):"normal"===F&&(ae?e.value>=oe[0]&&e.value<=oe[oe.length-1]:e.value<=oe[0])||"inverted"===F&&(ae?e.value<=oe[0]||e.value>=oe[oe.length-1]:e.value>=oe[0]),React.createElement(React.Fragment,{key:e.value},React.createElement("span",{style:o,"data-index":t,className:clsx(n.mark,r&&n.markActive)}),null!=e.label?React.createElement("span",{"aria-hidden":!0,"data-index":t,style:o,className:clsx(n.markLabel,r&&n.markLabelActive)},e.label):null)}),oe.map(function(e,t){var i=valueToPercent(e,T,g),l=axisProps[we].offset(i);return React.createElement(M,{key:t,valueLabelFormat:B,valueLabelDisplay:z,className:n.valueLabel,value:"function"==typeof B?B(R(e),t):B,index:t,open:G===t||q===t||"on"===z,disabled:m},React.createElement(I,{className:clsx(n.thumb,n["thumbColor".concat(capitalize(u))],q===t&&n.active,m&&n.disabled,de===t&&n.focusVisible),tabIndex:m?null:0,role:"slider",style:l,"data-index":t,"aria-label":v?v(t):r,"aria-labelledby":a,"aria-orientation":A,"aria-valuemax":R(g),"aria-valuemin":R(T),"aria-valuenow":R(e),"aria-valuetext":f?f(R(e),t):o,onKeyDown:ke,onFocus:he,onBlur:ye,onMouseOver:ge,onMouseLeave:xe}))}))});"production"!==process.env.NODE_ENV&&(Slider.propTypes={"aria-label":chainPropTypes(PropTypes.string,function(e){return Array.isArray(e.value||e.defaultValue)&&null!=e["aria-label"]?new Error("Material-UI: You need to use the `getAriaLabel` prop instead of `aria-label` when using a range slider."):null}),"aria-labelledby":PropTypes.string,"aria-valuetext":chainPropTypes(PropTypes.string,function(e){return Array.isArray(e.value||e.defaultValue)&&null!=e["aria-valuetext"]?new Error("Material-UI: You need to use the `getAriaValueText` prop instead of `aria-valuetext` when using a range slider."):null}),children:PropTypes.node,classes:PropTypes.object,className:PropTypes.string,color:PropTypes.oneOf(["primary","secondary"]),component:PropTypes.elementType,defaultValue:PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.number),PropTypes.number]),disabled:PropTypes.bool,getAriaLabel:PropTypes.func,getAriaValueText:PropTypes.func,marks:PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.shape({label:PropTypes.node,value:PropTypes.number.isRequired})),PropTypes.bool]),max:PropTypes.number,min:PropTypes.number,name:PropTypes.string,onChange:PropTypes.func,onChangeCommitted:PropTypes.func,onMouseDown:PropTypes.func,orientation:PropTypes.oneOf(["horizontal","vertical"]),scale:PropTypes.func,step:PropTypes.number,ThumbComponent:PropTypes.elementType,track:PropTypes.oneOf(["inverted","normal",!1]),value:PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.number),PropTypes.number]),ValueLabelComponent:PropTypes.elementType,valueLabelDisplay:PropTypes.oneOf(["auto","off","on"]),valueLabelFormat:PropTypes.oneOfType([PropTypes.func,PropTypes.string])});export default withStyles(styles,{name:"MuiSlider"})(Slider);