var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();import{Component}from"./Component";import{Observable}from"../Util/Observable";import{Class}from"../Class";import{InitializeEvent,PreUpdateEvent,PostUpdateEvent}from"../Events";var AddedComponent=function(){return function(t){this.data=t,this.type="Component Added"}}();export{AddedComponent};export function isAddedComponent(t){return!!t&&"Component Added"===t.type};var RemovedComponent=function(){return function(t){this.data=t,this.type="Component Removed"}}();export{RemovedComponent};export function isRemovedComponent(t){return!!t&&"Component Removed"===t.type};var Entity=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.id=e._ID++,n.active=!0,n._componentsToRemove=[],n._typesMemo=[],n._dirty=!0,n._handleChanges={defineProperty:function(t,e,o){return t[e]=o.value,n.changes.notifyAll(new AddedComponent({component:o.value,entity:n})),!0},deleteProperty:function(t,e){return e in t&&(n.changes.notifyAll(new RemovedComponent({component:t[e],entity:n})),delete t[e],!0)}},n.components=new Proxy({},n._handleChanges),n.changes=new Observable,n._isInitialized=!1,n}return __extends(e,t),e.prototype.kill=function(){this.active=!1},e.prototype.isKilled=function(){return!this.active},Object.defineProperty(e.prototype,"types",{get:function(){return this._dirty?this._typesMemo=Object.keys(this.components):this._typesMemo},enumerable:!1,configurable:!0}),e.prototype.clone=function(){for(var t=new e,n=0,o=this.types;n<o.length;n++){var i=o[n];t.addComponent(this.components[i].clone())}return t},e.prototype.addComponent=function(t,n){if(void 0===n&&(n=!1),t instanceof e)for(var o in t.components)this.addComponent(t.components[o].clone());else{if(this.components[t.type]&&!n)return this;if(this.components[t.type]&&n&&this.removeComponent(t),t.dependencies&&t.dependencies.length)for(var i=0,p=t.dependencies;i<p.length;i++){var r=p[i];this.addComponent(new r),this._dirty=!0}t.owner=this,this.components[t.type]=t,t.onAdd&&(this._dirty=!0,t.onAdd(this))}return this},e.prototype.removeComponent=function(t,e){return void 0===e&&(e=!1),e?"string"==typeof t?this._removeComponentByType(t):t instanceof Component&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this},e.prototype._removeComponentByType=function(t){this.components[t]&&(this.components[t].owner=null,this.components[t].onRemove&&this.components[t].onRemove(this),delete this.components[t],this._dirty=!0)},e.prototype.processRemoval=function(){for(var t=0,e=this._componentsToRemove;t<e.length;t++){var n=e[t],o="string"==typeof n?n:n.type;this._removeComponentByType(o)}this._componentsToRemove.length=0},e.prototype.has=function(t){return!!this.components[t]},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new InitializeEvent(e,this)),this._isInitialized=!0)},e.prototype._preupdate=function(t,e){this.emit("preupdate",new PreUpdateEvent(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new PostUpdateEvent(t,e,this)),this.onPostUpdate(t,e)},e.prototype.onInitialize=function(t){},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e._ID=0,e}(Class);export{Entity};