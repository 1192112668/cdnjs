function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var L=_interopDefault(require("leaflet"));function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(o,r.prototype),o}).apply(null,arguments)}function createElement(e,t,r,n){void 0===t&&(t=""),void 0===n&&(n={});var o=document.createElement(e);return t&&(o.className=t),Object.keys(n).forEach(function(e){var t;"function"==typeof n[e]?(t=0===e.indexOf("on")?e.substr(2).toLowerCase():e,o.addEventListener(t,n[e])):"html"===e?o.innerHTML=n[e]:"text"===e?o.innerText=n[e]:o.setAttribute(e,n[e])}),r&&r.appendChild(o),o}function stopPropagation(e){e.preventDefault(),e.stopPropagation()}function createScriptElement(e,r){var n=createElement("script",null,document.body);return n.setAttribute("type","text/javascript"),new Promise(function(t){window[r]=function(e){n.remove(),delete window[r],t(e)},n.setAttribute("src",e)})}var cx=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ").trim()};function addClassName(t,e){t&&t.classList&&(Array.isArray(e)?e:[e]).forEach(function(e){t.classList.contains(e)||t.classList.add(e)})}function removeClassName(t,e){t&&t.classList&&(Array.isArray(e)?e:[e]).forEach(function(e){t.classList.contains(e)&&t.classList.remove(e)})}function replaceClassName(e,t,r){removeClassName(e,t),addClassName(e,r)}var ENTER_KEY=13,ESCAPE_KEY=27,ARROW_DOWN_KEY=40,ARROW_UP_KEY=38,ARROW_LEFT_KEY=37,ARROW_RIGHT_KEY=39,SPECIAL_KEYS=[ENTER_KEY,ESCAPE_KEY,ARROW_DOWN_KEY,ARROW_UP_KEY,ARROW_LEFT_KEY,ARROW_RIGHT_KEY],SearchElement=function(){function e(e){var t=this,r=e.handleSubmit,n=e.searchLabel,o=e.classNames,s=void 0===o?{}:o;this.hasError=!1,this.container=createElement("div",cx("geosearch",s.container)),this.form=createElement("form",["",s.form].join(" "),this.container,{autocomplete:"none",onClick:stopPropagation,onDblClick:stopPropagation,touchStart:stopPropagation,touchEnd:stopPropagation}),this.input=createElement("input",["glass",s.input].join(" "),this.form,{type:"text",placeholder:n||"search",onInput:this.onInput,onKeyUp:function(e){return t.onKeyUp(e)},onKeyPress:function(e){return t.onKeyPress(e)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){t.input.focus(),t.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=r}var t=e.prototype;return t.onFocus=function(){addClassName(this.form,"active")},t.onBlur=function(){removeClassName(this.form,"active")},t.onSubmit=function(e){try{var t=this;return stopPropagation(e),replaceClassName(t.container,"error","pending"),Promise.resolve(t.handleSubmit({query:t.input.value})).then(function(){removeClassName(t.container,"pending")})}catch(e){return Promise.reject(e)}},t.onInput=function(){this.hasError&&(removeClassName(this.container,"error"),this.hasError=!1)},t.onKeyUp=function(e){e.keyCode===ESCAPE_KEY&&(removeClassName(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},t.onKeyPress=function(e){e.keyCode===ENTER_KEY&&this.onSubmit(e)},t.setQuery=function(e){this.input.value=e},e}(),ResultList=function(){function e(e){var n=this,t=e.handleClick,r=e.classNames,o=void 0===r?{}:r;this.selected=-1,this.results=[],this.onClick=function(e){var t,r;"function"!=typeof n.handleClick||(t=e.target)&&n.container.contains(t)&&t.hasAttribute("data-key")&&(r=Number(t.getAttribute("data-key")),n.handleClick({result:n.results[r]}))},this.handleClick=t,this.container=createElement("div",cx("results",o.container)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=createElement("div",cx(o.item))}var t=e.prototype;return t.render=function(e){var n=this;void 0===e&&(e=[]),this.clear(),e.forEach(function(e,t){var r=n.resultItem.cloneNode(!0);r.setAttribute("data-key",""+t),r.innerHTML=e.label,n.container.appendChild(r)}),0<e.length&&(addClassName(this.container.parentElement,"open"),addClassName(this.container,"active")),this.results=e},t.select=function(r){return Array.from(this.container.children).forEach(function(e,t){return(t===r?addClassName:removeClassName)(e,"active")}),this.selected=r,this.results[r]},t.count=function(){return this.results?this.results.length:0},t.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);removeClassName(this.container.parentElement,"open"),removeClassName(this.container,"active")},e}();function debounce(n,o,s){var a;return void 0===o&&(o=250),void 0===s&&(s=!1),function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];a&&clearTimeout(a),a=setTimeout(function(){a=null,s||n.apply(void 0,t)},o),s&&!a&&n.apply(void 0,t)}}var RequestType,defaultOptions={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(e){return""+e.result.label},marker:{icon:L&&L.Icon?new L.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1},wasHandlerEnabled={},mapHandlers=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard"],UNINITIALIZED_ERR="Leaflet must be loaded before instantiating the GeoSearch control",Control={options:_extends({},defaultOptions),classNames:_extends({},defaultOptions.classNames),initialize:function(e){var r=this;if(!L)throw new Error(UNINITIALIZED_ERR);if(!e.provider)throw new Error("Provider is missing from options");this.options=_extends({},this.options,{},e),this.classNames=_extends({},this.classNames,{},e.classNames),this.markers=new L.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new SearchElement({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(e){return r.onSubmit(e)}}),this.button=createElement("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(e){return r.onClick(e)},onDblClick:function(e){return stopPropagation(e)}}),this.resetButton=createElement("a",this.classNames.resetButton,this.searchElement.form,{text:"Ã—",href:"#",onClick:function(){return r.clearResults(null,!0)}}),this.options.autoComplete&&(this.resultList=new ResultList({handleClick:function(e){var t=e.result;r.searchElement.input.value=t.label,r.onSubmit({query:t.label,data:t})}}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",debounce(function(e){return r.autoSearch(e)},this.options.autoCompleteDelay),!0),this.searchElement.input.addEventListener("keydown",function(e){return r.selectResult(e)},!0),this.searchElement.input.addEventListener("keydown",function(e){return r.clearResults(e,!0)},!0)),this.searchElement.form.addEventListener("mouseenter",function(e){r.disableHandlers(e)},!0),this.searchElement.form.addEventListener("mouseleave",function(){return r.restoreHandlers()},!0),this.searchElement.form.addEventListener("click",function(e){e.preventDefault()},!1)},onAdd:function(e){var t,r=this.options,n=r.showMarker,o=r.style;return this.map=e,n&&this.markers.addTo(e),"bar"===o&&(t=e.getContainer().querySelector(".leaflet-control-container"),this.container=createElement("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),t.appendChild(this.container)),this.searchElement.container},onRemove:function(){var e;return null!=(e=this.container)&&e.remove(),this},onClick:function(e){e.preventDefault();var t=this.searchElement,r=t.container,n=t.input;r.classList.contains("active")?(removeClassName(r,"active"),this.clearResults()):(addClassName(r,"active"),n.focus())},disableHandlers:function(e){var n=this;this.searchElement.form.contains(e.target)&&mapHandlers.forEach(function(e){var t,r;wasHandlerEnabled[e]=null==(t=n.map[e])?void 0:t.enabled(),null!=(r=n.map[e])&&r.disable()})},restoreHandlers:function(e){var r=this;e&&!this.searchElement.form.includes(e.target)||mapHandlers.forEach(function(e){var t;wasHandlerEnabled[e]&&null!=(t=r.map[e])&&t.enable()})},selectResult:function(e){var t,r,n,o,s,a;-1!==[ENTER_KEY,ARROW_DOWN_KEY,ARROW_UP_KEY].indexOf(e.keyCode)&&(e.preventDefault(),e.keyCode!==ENTER_KEY?(t=this.resultList.count()-1)<0||(r=this.resultList.selected,o=(n=e.keyCode===ARROW_DOWN_KEY?r+1:r-1)<0?t:t<n?0:n,s=this.resultList.select(o),this.searchElement.input.value=s.label):(a=this.resultList.select(this.resultList.selected),this.onSubmit({query:this.searchElement.input.value,data:a})))},clearResults:function(e,t){var r,n,o;void 0===t&&(t=!1),e&&e.keyCode!==ESCAPE_KEY||(n=(r=this.options).keepResult,o=r.autoComplete,!t&&n||(this.searchElement.input.value="",this.markers.clearLayers()),o&&this.resultList.clear())},autoSearch:function(e){try{var t=this;if(-1<SPECIAL_KEYS.indexOf(e.keyCode))return Promise.resolve();var r=e.target.value,n=t.options.provider,o=function(){if(r.length)return Promise.resolve(n.search({query:r})).then(function(e){e=e.slice(0,t.options.maxSuggestions),t.resultList.render(e)});t.resultList.clear()}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},onSubmit:function(t){try{var r=this,e=r.options.provider;return Promise.resolve(e.search(t)).then(function(e){e&&0<e.length&&r.showResult(e[0],t)})}catch(e){return Promise.reject(e)}},showResult:function(e,t){var r=this.options.autoClose,n=Object.keys(this.markers._layers);n.length>=this.options.maxMarkers&&this.markers.removeLayer(n[0]);var o=this.addMarker(e,t);this.centerMap(e),this.map.fireEvent("geosearch/showlocation",{location:e,marker:o}),r&&this.closeResults()},closeResults:function(){var e=this.searchElement.container;e.classList.contains("active")&&removeClassName(e,"active"),this.restoreHandlers(),this.clearResults()},addMarker:function(e,t){var r=this,n=this.options,o=n.marker,s=n.showPopup,a=n.popupFormat,i=new L.Marker([e.y,e.x],o),c=e.label;return"function"==typeof a&&(c=a({query:t,result:e})),i.bindPopup(c),this.markers.addLayer(i),s&&i.openPopup(),o.draggable&&i.on("dragend",function(e){r.map.fireEvent("geosearch/marker/dragend",{location:i.getLatLng(),event:e})}),i},centerMap:function(e){var t=this.options,r=t.retainZoomLevel,n=t.animateZoom,o=e.bounds?new L.LatLngBounds(e.bounds):new L.LatLng(e.y,e.x).toBounds(10),s=o.isValid()?o:this.markers.getBounds();!r&&o.isValid()?this.map.fitBounds(s,{animate:n}):this.map.setView(s.getCenter(),this.getZoom(),{animate:n})},getZoom:function(){var e=this.options,t=e.retainZoomLevel,r=e.zoomLevel;return t?this.map.getZoom():r}};function SearchControl(){if(!L)throw new Error(UNINITIALIZED_ERR);for(var e=L.Control.extend(Control),t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return _construct(e,r)}!function(e){e[e.SEARCH=0]="SEARCH",e[e.REVERSE=1]="REVERSE"}(RequestType=RequestType||{});var AbstractProvider=function(){function e(e){void 0===e&&(e={}),this.options=e}var t=e.prototype;return t.getParamString=function(e){void 0===e&&(e={});var t=_extends({},this.options.params,{},e);return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},t.getUrl=function(e,t){return e+"?"+this.getParamString(t)},t.search=function(e){try{var t=this,r=t.endpoint({query:e.query,type:RequestType.SEARCH});return Promise.resolve(fetch(r)).then(function(e){return Promise.resolve(e.json()).then(function(e){return t.parse({data:e})})})}catch(e){return Promise.reject(e)}},e}(),Provider=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.endpoint=function(){return"https://places-dsn.algolia.net/1/places/query"},r.getLabel=function(e){var t,r,n,o,s;return[null==(t=e.locale_names)?void 0:t.default,null==(r=e.city)?void 0:r.default,null==(n=e.administrative)?void 0:n[0],null==(o=e.postcode)?void 0:o[0],null==(s=e.country)?void 0:s.default].filter(Boolean).join(", ")},r.parse=function(e){var t=this;return e.data.hits.map(function(e){return{x:e._geoloc.lng,y:e._geoloc.lat,label:t.getLabel(e),bounds:null,raw:e}})},r.search=function(e){var t=e.query;try{var r=this,n="string"==typeof t?{query:t}:t;return Promise.resolve(fetch(r.endpoint(),{method:"POST",body:JSON.stringify(_extends({},r.options.params,{},n))})).then(function(e){return Promise.resolve(e.json()).then(function(e){return r.parse({data:e})})})}catch(e){return Promise.reject(e)}},t}(AbstractProvider),BingProvider=function(t){function e(){var e=t.apply(this,arguments)||this;return e.searchUrl="https://dev.virtualearth.net/REST/v1/Locations",e}_inheritsLoose(e,t);var r=e.prototype;return r.endpoint=function(e){var t=e.query,r=e.jsonp,n="string"==typeof t?{q:t}:t;return n.jsonp=r,this.getUrl(this.searchUrl,n)},r.parse=function(e){return 0===e.data.resourceSets.length?[]:e.data.resourceSets[0].resources.map(function(e){return{x:e.point.coordinates[1],y:e.point.coordinates[0],label:e.address.formattedAddress,bounds:[[e.bbox[0],e.bbox[1]],[e.bbox[2],e.bbox[3]]],raw:e}})},r.search=function(e){var t=e.query;try{var r=this,n="BING_JSONP_CB_"+Date.now();return Promise.resolve(createScriptElement(r.endpoint({query:t,jsonp:n}),n)).then(function(e){return r.parse({data:e})})}catch(e){return Promise.reject(e)}},e}(AbstractProvider),EsriProvider=function(t){function e(){var e=t.apply(this,arguments)||this;return e.searchUrl="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",e}_inheritsLoose(e,t);var r=e.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{text:t}:t;return r.f="json",this.getUrl(this.searchUrl,r)},r.parse=function(e){return e.data.locations.map(function(e){return{x:e.feature.geometry.x,y:e.feature.geometry.y,label:e.name,bounds:[[e.extent.ymin,e.extent.xmin],[e.extent.ymax,e.extent.xmax]],raw:e}})},e}(AbstractProvider),GoogleProvider=function(t){function e(){var e=t.apply(this,arguments)||this;return e.searchUrl="https://maps.googleapis.com/maps/api/geocode/json",e}_inheritsLoose(e,t);var r=e.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{address:t}:t;return this.getUrl(this.searchUrl,r)},r.parse=function(e){return e.data.results.map(function(e){return{x:e.geometry.location.lng,y:e.geometry.location.lat,label:e.formatted_address,bounds:[[e.geometry.viewport.southwest.lat,e.geometry.viewport.southwest.lng],[e.geometry.viewport.northeast.lat,e.geometry.viewport.northeast.lng]],raw:e}})},e}(AbstractProvider),HereProvider=function(t){function e(){var e=t.apply(this,arguments)||this;return e.searchUrl="https://geocode.search.hereapi.com/v1/geocode",e}_inheritsLoose(e,t);var r=e.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{q:t}:t;return this.getUrl(this.searchUrl,r)},r.parse=function(e){return e.data.items.map(function(e){return{x:e.position.lng,y:e.position.lat,label:e.address.label,bounds:null,raw:e}})},e}(AbstractProvider),OpenStreetMapProvider=function(n){function e(e){var t;void 0===e&&(e={});var r="https://nominatim.openstreetmap.org";return(t=n.call(this,e)||this).searchUrl=e.searchUrl||r+"/search",t.reverseUrl=e.reverseUrl||r+"/reverse",t}_inheritsLoose(e,n);var t=e.prototype;return t.endpoint=function(e){var t=e.query,r=e.type,n="string"==typeof t?{q:t}:t;switch(n.format="json",r){case RequestType.REVERSE:return this.getUrl(this.reverseUrl,n);default:return this.getUrl(this.searchUrl,n)}},t.parse=function(e){return(Array.isArray(e.data)?e.data:[e.data]).map(function(e){return{x:Number(e.lon),y:Number(e.lat),label:e.display_name,bounds:[[parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[2])],[parseFloat(e.boundingbox[1]),parseFloat(e.boundingbox[3])]],raw:e}})},e}(AbstractProvider),LocationIQProvider=function(t){function e(e){return t.call(this,_extends({},e,{searchUrl:"https://locationiq.org/v1/search.php",reverseUrl:"https://locationiq.org/v1/reverse.php"}))||this}return _inheritsLoose(e,t),e}(OpenStreetMapProvider),OpenCageProvider=function(t){function e(){var e=t.apply(this,arguments)||this;return e.searchUrl="https://api.opencagedata.com/geocode/v1/json",e}_inheritsLoose(e,t);var r=e.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{q:t}:t;return r.format="json",this.getUrl(this.searchUrl,r)},r.parse=function(e){return e.data.results.map(function(e){return{x:e.geometry.lng,y:e.geometry.lat,label:e.formatted,bounds:[[e.bounds.southwest.lat,e.bounds.southwest.lng],[e.bounds.northeast.lat,e.bounds.northeast.lng]],raw:e}})},r.search=function(e){try{return e.query.length<2?Promise.resolve([]):Promise.resolve(t.prototype.search.call(this,e))}catch(e){return Promise.reject(e)}},e}(AbstractProvider);exports.AlgoliaProvider=Provider,exports.BingProvider=BingProvider,exports.EsriProvider=EsriProvider,exports.GeoSearchControl=SearchControl,exports.GoogleProvider=GoogleProvider,exports.HereProvider=HereProvider,exports.JsonProvider=AbstractProvider,exports.LocationIQProvider=LocationIQProvider,exports.OpenCageProvider=OpenCageProvider,exports.OpenStreetMapProvider=OpenStreetMapProvider,exports.SearchControl=SearchControl,exports.SearchElement=SearchElement;