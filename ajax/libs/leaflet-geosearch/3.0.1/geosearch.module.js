import t from"leaflet";function n(){return(n=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function r(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function o(t,n,r){return(o=e()?Reflect.construct:function(t,n,r){var e=[null];e.push.apply(e,n);var o=new(Function.bind.apply(t,e));return r&&i(o,r.prototype),o}).apply(null,arguments)}function s(t,n,r,i){void 0===n&&(n=""),void 0===i&&(i={});var e=document.createElement(t);return n&&(e.className=n),Object.keys(i).forEach(function(t){if("function"==typeof i[t]){var n=0===t.indexOf("on")?t.substr(2).toLowerCase():t;e.addEventListener(n,i[t])}else"html"===t?e.innerHTML=i[t]:"text"===t?e.innerText=i[t]:e.setAttribute(t,i[t])}),r&&r.appendChild(e),e}function u(t){t.preventDefault(),t.stopPropagation()}var a=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.filter(Boolean).join(" ").trim()};function c(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach(function(n){t.classList.contains(n)||t.classList.add(n)})}function h(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach(function(n){t.classList.contains(n)&&t.classList.remove(n)})}var f,l=13,v=40,d=38,m=[l,27,v,d,37,39],p=function(){function t(t){var n=this,r=t.handleSubmit,i=t.searchLabel,e=t.classNames,o=void 0===e?{}:e;this.hasError=!1,this.container=s("div",a("geosearch",o.container)),this.form=s("form",["",o.form].join(" "),this.container,{autocomplete:"none",onClick:u,onDblClick:u,touchStart:u,touchEnd:u}),this.input=s("input",["glass",o.input].join(" "),this.form,{type:"text",placeholder:i||"search",onInput:this.onInput,onKeyUp:function(t){return n.onKeyUp(t)},onKeyPress:function(t){return n.onKeyPress(t)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){n.input.focus(),n.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=r}var n=t.prototype;return n.onFocus=function(){c(this.form,"active")},n.onBlur=function(){h(this.form,"active")},n.onSubmit=function(t){try{var n=this;return u(t),h(r=n.container,"error"),c(r,"pending"),Promise.resolve(n.handleSubmit({query:n.input.value})).then(function(){h(n.container,"pending")})}catch(t){return Promise.reject(t)}var r},n.onInput=function(){this.hasError&&(h(this.container,"error"),this.hasError=!1)},n.onKeyUp=function(t){27===t.keyCode&&(h(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},n.onKeyPress=function(t){t.keyCode===l&&this.onSubmit(t)},n.setQuery=function(t){this.input.value=t},t}(),y=function(){function t(t){var n=this,r=t.handleClick,i=t.classNames,e=void 0===i?{}:i;this.selected=-1,this.results=[],this.onClick=function(t){if("function"==typeof n.handleClick){var r=t.target;if(r&&n.container.contains(r)&&r.hasAttribute("data-key")){var i=Number(r.getAttribute("data-key"));n.handleClick({result:n.results[i]})}}},this.handleClick=r,this.container=s("div",a("results",e.container)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=s("div",a(e.item))}var n=t.prototype;return n.render=function(t){var n=this;void 0===t&&(t=[]),this.clear(),t.forEach(function(t,r){var i=n.resultItem.cloneNode(!0);i.setAttribute("data-key",""+r),i.innerHTML=t.label,n.container.appendChild(i)}),t.length>0&&(c(this.container.parentElement,"open"),c(this.container,"active")),this.results=t},n.select=function(t){return Array.from(this.container.children).forEach(function(n,r){return r===t?c(n,"active"):h(n,"active")}),this.selected=t,this.results[t]},n.count=function(){return this.results?this.results.length:0},n.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);h(this.container.parentElement,"open"),h(this.container,"active")},t}(),g={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(t){return""+t.result.label},marker:{icon:t&&t.Icon?new t.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1},b={},w=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard"],P="Leaflet must be loaded before instantiating the GeoSearch control",k={options:n({},g),classNames:n({},g.classNames),initialize:function(r){var i,e,o,a,c=this;if(!t)throw new Error(P);if(!r.provider)throw new Error("Provider is missing from options");this.options=n({},this.options,{},r),this.classNames=n({},this.classNames,{},r.classNames),this.markers=new t.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new p({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(t){return c.onSubmit(t)}}),this.button=s("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(t){return c.onClick(t)},onDblClick:function(t){return u(t)}}),this.resetButton=s("a",this.classNames.resetButton,this.searchElement.form,{text:"Ã—",href:"#",onClick:function(){return c.clearResults(null,!0)}}),this.options.autoComplete&&(this.resultList=new y({handleClick:function(t){var n=t.result;c.searchElement.input.value=n.label,c.onSubmit({query:n.label,data:n})}}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(i=function(t){return c.autoSearch(t)},void 0===(e=this.options.autoCompleteDelay)&&(e=250),void 0===o&&(o=!1),function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];a&&clearTimeout(a),a=setTimeout(function(){a=null,o||i.apply(void 0,n)},e),o&&!a&&i.apply(void 0,n)}),!0),this.searchElement.input.addEventListener("keydown",function(t){return c.selectResult(t)},!0),this.searchElement.input.addEventListener("keydown",function(t){return c.clearResults(t,!0)},!0)),this.searchElement.form.addEventListener("mouseenter",function(t){c.disableHandlers(t)},!0),this.searchElement.form.addEventListener("mouseleave",function(){return c.restoreHandlers()},!0),this.searchElement.form.addEventListener("click",function(t){t.preventDefault()},!1)},onAdd:function(t){var n=this.options,r=n.showMarker,i=n.style;if(this.map=t,r&&this.markers.addTo(t),"bar"===i){var e=t.getContainer().querySelector(".leaflet-control-container");this.container=s("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),e.appendChild(this.container)}return this.searchElement.container},onRemove:function(){var t;return null==(t=this.container)||t.remove(),this},onClick:function(t){t.preventDefault(),t.stopPropagation();var n=this.searchElement,r=n.container,i=n.input;r.classList.contains("active")?(h(r,"active"),this.clearResults()):(c(r,"active"),i.focus())},disableHandlers:function(t){var n=this;this.searchElement.form.contains(t.target)&&w.forEach(function(t){var r,i;b[t]=null==(r=n.map[t])?void 0:r.enabled(),null==(i=n.map[t])||i.disable()})},restoreHandlers:function(t){var n=this;t&&!this.searchElement.form.includes(t.target)||w.forEach(function(t){var r;b[t]&&(null==(r=n.map[t])||r.enable())})},selectResult:function(t){if(-1!==[l,v,d].indexOf(t.keyCode))if(t.preventDefault(),t.keyCode!==l){var n=this.resultList.count()-1;if(!(n<0)){var r=this.resultList.selected,i=t.keyCode===v?r+1:r-1,e=this.resultList.select(i<0?n:i>n?0:i);this.searchElement.input.value=e.label}}else{var o=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:o})}},clearResults:function(t,n){if(void 0===n&&(n=!1),!t||27===t.keyCode){var r=this.options,i=r.autoComplete;!n&&r.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),i&&this.resultList.clear()}},autoSearch:function(t){try{var n=this;if(m.indexOf(t.keyCode)>-1)return Promise.resolve();var r=t.target.value,i=n.options.provider,e=function(){if(r.length)return Promise.resolve(i.search({query:r})).then(function(t){t=t.slice(0,n.options.maxSuggestions),n.resultList.render(t)});n.resultList.clear()}();return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},onSubmit:function(t){try{var n=this;return Promise.resolve(n.options.provider.search(t)).then(function(r){r&&r.length>0&&n.showResult(r[0],t)})}catch(t){return Promise.reject(t)}},showResult:function(t,n){var r=this.options.autoClose,i=Object.keys(this.markers.t);i.length>=this.options.maxMarkers&&this.markers.removeLayer(i[0]);var e=this.addMarker(t,n);this.centerMap(t),this.map.fireEvent("geosearch/showlocation",{location:t,marker:e}),r&&this.closeResults()},closeResults:function(){var t=this.searchElement.container;t.classList.contains("active")&&h(t,"active"),this.restoreHandlers(),this.clearResults()},addMarker:function(n,r){var i=this,e=this.options,o=e.marker,s=e.showPopup,u=e.popupFormat,a=new t.Marker([n.y,n.x],o),c=n.label;return"function"==typeof u&&(c=u({query:r,result:n})),a.bindPopup(c),this.markers.addLayer(a),s&&a.openPopup(),o.draggable&&a.on("dragend",function(t){i.map.fireEvent("geosearch/marker/dragend",{location:a.getLatLng(),event:t})}),a},centerMap:function(n){var r=this.options,i=r.retainZoomLevel,e=r.animateZoom,o=n.bounds?new t.LatLngBounds(n.bounds):new t.LatLng(n.y,n.x).toBounds(10),s=o.isValid()?o:this.markers.getBounds();!i&&o.isValid()?this.map.fitBounds(s,{animate:e}):this.map.setView(s.getCenter(),this.getZoom(),{animate:e})},getZoom:function(){var t=this.options,n=t.zoomLevel;return t.retainZoomLevel?this.map.getZoom():n}};function x(){if(!t)throw new Error(P);for(var n=t.Control.extend(k),r=arguments.length,i=new Array(r),e=0;e<r;e++)i[e]=arguments[e];return o(n,i)}!function(t){t[t.SEARCH=0]="SEARCH",t[t.REVERSE=1]="REVERSE"}(f||(f={}));var C=function(){function t(t){void 0===t&&(t={}),this.options=t}var r=t.prototype;return r.getParamString=function(t){void 0===t&&(t={});var r=n({},this.options.params,{},t);return Object.keys(r).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(r[t])}).join("&")},r.getUrl=function(t,n){return t+"?"+this.getParamString(n)},r.search=function(t){try{var n=this,r=n.endpoint({query:t.query,type:f.SEARCH});return Promise.resolve(fetch(r)).then(function(t){return Promise.resolve(t.json()).then(function(t){return n.parse({data:t})})})}catch(t){return Promise.reject(t)}},t}(),R=function(t){function i(){return t.apply(this,arguments)||this}r(i,t);var e=i.prototype;return e.endpoint=function(){return"https://places-dsn.algolia.net/1/places/query"},e.getLabel=function(t){var n,r,i,e,o;return[null==(n=t.locale_names)?void 0:n.default,null==(r=t.city)?void 0:r.default,null==(i=t.administrative)?void 0:i[0],null==(e=t.postcode)?void 0:e[0],null==(o=t.country)?void 0:o.default].filter(Boolean).join(", ")},e.parse=function(t){var n=this;return t.data.hits.map(function(t){return{x:t.i.lng,y:t.i.lat,label:n.getLabel(t),bounds:null,raw:t}})},e.search=function(t){var r=t.query;try{var i=this,e="string"==typeof r?{query:r}:r;return Promise.resolve(fetch(i.endpoint(),{method:"POST",body:JSON.stringify(n({},i.options.params,{},e))})).then(function(t){return Promise.resolve(t.json()).then(function(t){return i.parse({data:t})})})}catch(t){return Promise.reject(t)}},i}(C),q=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://dev.virtualearth.net/REST/v1/Locations",n}r(n,t);var i=n.prototype;return i.endpoint=function(t){var n=t.query,r="string"==typeof n?{q:n}:n;return r.jsonp=t.jsonp,this.getUrl(this.searchUrl,r)},i.parse=function(t){return 0===t.data.resourceSets.length?[]:t.data.resourceSets[0].resources.map(function(t){return{x:t.point.coordinates[1],y:t.point.coordinates[0],label:t.address.formattedAddress,bounds:[[t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]],raw:t}})},i.search=function(t){var n,r,i,e=t.query;try{var o=this,u="BING_JSONP_CB_"+Date.now();return Promise.resolve((n=o.endpoint({query:e,jsonp:u}),r=u,i=s("script",null,document.body),i.setAttribute("type","text/javascript"),new Promise(function(t){window[r]=function(n){i.remove(),delete window[r],t(n)},i.setAttribute("src",n)}))).then(function(t){return o.parse({data:t})})}catch(t){return Promise.reject(t)}},n}(C),S=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",n}r(n,t);var i=n.prototype;return i.endpoint=function(t){var n=t.query,r="string"==typeof n?{text:n}:n;return r.f="json",this.getUrl(this.searchUrl,r)},i.parse=function(t){return t.data.locations.map(function(t){return{x:t.feature.geometry.x,y:t.feature.geometry.y,label:t.name,bounds:[[t.extent.ymin,t.extent.xmin],[t.extent.ymax,t.extent.xmax]],raw:t}})},n}(C),j=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://maps.googleapis.com/maps/api/geocode/json",n}r(n,t);var i=n.prototype;return i.endpoint=function(t){var n=t.query;return this.getUrl(this.searchUrl,"string"==typeof n?{address:n}:n)},i.parse=function(t){return t.data.results.map(function(t){return{x:t.geometry.location.lng,y:t.geometry.location.lat,label:t.formatted_address,bounds:[[t.geometry.viewport.southwest.lat,t.geometry.viewport.southwest.lng],[t.geometry.viewport.northeast.lat,t.geometry.viewport.northeast.lng]],raw:t}})},n}(C),E=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://geocode.search.hereapi.com/v1/geocode",n}r(n,t);var i=n.prototype;return i.endpoint=function(t){var n=t.query;return this.getUrl(this.searchUrl,"string"==typeof n?{q:n}:n)},i.parse=function(t){return t.data.items.map(function(t){return{x:t.position.lng,y:t.position.lat,label:t.address.label,bounds:null,raw:t}})},n}(C),A=function(t){function n(n){var r;void 0===n&&(n={});var i="https://nominatim.openstreetmap.org";return(r=t.call(this,n)||this).searchUrl=n.searchUrl||i+"/search",r.reverseUrl=n.reverseUrl||i+"/reverse",r}r(n,t);var i=n.prototype;return i.endpoint=function(t){var n=t.query,r=t.type,i="string"==typeof n?{q:n}:n;switch(i.format="json",r){case f.REVERSE:return this.getUrl(this.reverseUrl,i);default:return this.getUrl(this.searchUrl,i)}},i.parse=function(t){return(Array.isArray(t.data)?t.data:[t.data]).map(function(t){return{x:Number(t.lon),y:Number(t.lat),label:t.display_name,bounds:[[parseFloat(t.boundingbox[0]),parseFloat(t.boundingbox[2])],[parseFloat(t.boundingbox[1]),parseFloat(t.boundingbox[3])]],raw:t}})},n}(C),O=function(t){function i(r){return t.call(this,n({},r,{searchUrl:"https://locationiq.org/v1/search.php",reverseUrl:"https://locationiq.org/v1/reverse.php"}))||this}return r(i,t),i}(A),N=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://api.opencagedata.com/geocode/v1/json",n}r(n,t);var i=n.prototype;return i.endpoint=function(t){var n=t.query,r="string"==typeof n?{q:n}:n;return r.format="json",this.getUrl(this.searchUrl,r)},i.parse=function(t){return t.data.results.map(function(t){return{x:t.geometry.lng,y:t.geometry.lat,label:t.formatted,bounds:[[t.bounds.southwest.lat,t.bounds.southwest.lng],[t.bounds.northeast.lat,t.bounds.northeast.lng]],raw:t}})},i.search=function(n){try{return Promise.resolve(n.query.length<2?[]:t.prototype.search.call(this,n))}catch(t){return Promise.reject(t)}},n}(C);export{R as AlgoliaProvider,q as BingProvider,S as EsriProvider,x as GeoSearchControl,j as GoogleProvider,E as HereProvider,C as JsonProvider,O as LocationIQProvider,N as OpenCageProvider,A as OpenStreetMapProvider,x as SearchControl,p as SearchElement};
//# sourceMappingURL=geosearch.module.js.map
