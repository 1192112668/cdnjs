import $RefParser from"json-schema-ref-parser";import RandExp from"randexp";import{JSONPath}from"jsonpath-plus";var Registry=function(){this.data={}};Registry.prototype.unregister=function(e){e?delete this.data[e]:this.data={}},Registry.prototype.register=function(e,r){this.data[e]=r},Registry.prototype.registerMany=function(e){var r=this;Object.keys(e).forEach(function(t){r.data[t]=e[t]})},Registry.prototype.get=function(e){return this.data[e]},Registry.prototype.list=function(){return this.data};var defaults={defaultInvalidTypeProduct:null,defaultRandExpMax:10,ignoreProperties:[],ignoreMissingRefs:!1,failOnInvalidTypes:!0,failOnInvalidFormat:!0,alwaysFakeOptionals:!1,optionalsProbability:!1,fixedProbabilities:!1,useExamplesValue:!1,useDefaultValue:!1,requiredOnly:!1,minItems:0,maxItems:null,minLength:0,maxLength:null,resolveJsonPath:!1,reuseProperties:!1,fillProperties:!0};defaults.random=Math.random;var OptionRegistry=function(e){function r(){e.call(this),this.data=Object.assign({},defaults),this._defaults=defaults}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var t={defaults:{configurable:!0}};return t.defaults.get=function(){return Object.assign({},this._defaults)},Object.defineProperties(r.prototype,t),r}(Registry),registry=new OptionRegistry;function optionAPI(e,r){return"string"==typeof e?void 0!==r?registry.register(e,r):registry.get(e):registry.registerMany(e)}optionAPI.getDefaults=function(){return registry.defaults};var ALL_TYPES=["array","object","integer","number","string","boolean","null"],MOST_NEAR_DATETIME=2524608e6,MIN_INTEGER=-1e8,MAX_INTEGER=1e8,MIN_NUMBER=-100,MAX_NUMBER=100,env={ALL_TYPES:ALL_TYPES,MIN_NUMBER:MIN_NUMBER,MAX_NUMBER:MAX_NUMBER,MIN_INTEGER:MIN_INTEGER,MAX_INTEGER:MAX_INTEGER,MOST_NEAR_DATETIME:MOST_NEAR_DATETIME};function getRandomInteger(e,r){return e=void 0===e?env.MIN_INTEGER:e,r=void 0===r?env.MAX_INTEGER:r,Math.floor(optionAPI("random")()*(r-e+1))+e}function _randexp(e){return RandExp.prototype.max=optionAPI("defaultRandExpMax"),RandExp.prototype.randInt=function(e,r){return e+Math.floor(optionAPI("random")()*(r-e+1))},new RandExp(e).gen()}function pick(e){return e[Math.floor(optionAPI("random")()*e.length)]}function shuffle(e){for(var r,t,n=e.length,i=e.slice();n>0;)t=Math.floor(optionAPI("random")()*n),r=i[n-=1],i[n]=i[t],i[t]=r;return i}function getRandom(e,r){return optionAPI("random")()*(r-e)+e}function number(e,r,t,n,i){return void 0===i&&(i=!1),t=void 0===t?env.MIN_NUMBER:t,n=void 0===n?env.MAX_NUMBER:n,(r=void 0===r?n:r)<(e=void 0===e?t:e)&&(r+=e),i?getRandom(e,r):getRandomInteger(e,r)}function by(e){switch(e){case"seconds":return 60*number(0,60);case"minutes":return 612*number(15,50);case"hours":return 36123*number(12,72);case"days":return 86412345*number(7,30);case"weeks":return 604812345*number(4,52);case"months":return 2592012345*number(2,13);case"years":return 31104012345*number(1,20)}}function date(e){if(e)return by(e);var r=new Date,t=number(-1e3,env.MOST_NEAR_DATETIME);return r.setTime(r.getTime()-t),r}var random={pick:pick,date:date,shuffle:shuffle,number:number,randexp:_randexp};function getSubAttribute(e,r){for(var t=r.split(".");t.length;){var n=t.shift();if(!e[n])break;e=e[n]}return e}function hasProperties(e){for(var r=[],t=arguments.length-1;t-- >0;)r[t]=arguments[t+1];return r.filter(function(r){return void 0!==e[r]}).length>0}function typecast(e,r,t){var n={};switch(e||r.type){case"integer":case"number":if(void 0!==r.minimum&&(n.minimum=r.minimum),void 0!==r.maximum&&(n.maximum=r.maximum),r.enum){var i=Math.max(n.minimum||0,0),o=Math.min(n.maximum||1/0,1/0);r.exclusiveMinimum&&i===r.minimum&&(i+=r.multipleOf||1),r.exclusiveMaximum&&o===r.maximum&&(o-=r.multipleOf||1),(i||o!==1/0)&&(r.enum=r.enum.filter(function(e){return e>=i&&e<=o}))}break;case"string":void 0!==r.minLength&&(n.minLength=r.minLength),void 0!==r.maxLength&&(n.maxLength=r.maxLength);var a=optionAPI("maxLength"),u=optionAPI("minLength");a&&n.maxLength>a&&(n.maxLength=a),u&&n.minLength<u&&(n.minLength=u)}var s=t(n);switch(e||r.type){case"number":s=parseFloat(s);break;case"integer":s=parseInt(s,10);break;case"boolean":s=!!s;break;case"string":s=String(s);for(var f=Math.max(n.minLength||0,0),c=Math.min(n.maxLength||1/0,1/0);s.length<f;)r.pattern?s+=random.randexp(r.pattern):s+=""+random.pick([" ","/","_","-","+","=","@","^"])+s;switch(s.length>c&&(s=s.substr(0,c)),r.format){case"date-time":case"datetime":s=new Date(s).toISOString().replace(/([0-9])0+Z$/,"$1Z");break;case"date":s=new Date(s).toISOString().substr(0,10);break;case"time":s=new Date("1969-01-01 "+s).toISOString().substr(11)}}return s}function merge(e,r){return Object.keys(r).forEach(function(t){"object"!=typeof r[t]||null===r[t]?e[t]=r[t]:Array.isArray(r[t])?(e[t]=e[t]||[],r[t].forEach(function(r){-1===e[t].indexOf(r)&&e[t].push(r)})):"object"!=typeof e[t]||null===e[t]||Array.isArray(e[t])?e[t]=merge({},r[t]):e[t]=merge(e[t],r[t])}),e}function clone(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(function(e){return clone(e)}):Object.keys(e).reduce(function(r,t){return r[t]=clone(e[t]),r},{}):e}function short(e){var r=JSON.stringify(e),t=JSON.stringify(e,null,2);return r.length>400?t.substr(0,400)+"...":t}function anyValue(){return random.pick([!1,!0,null,-1,NaN,Math.PI,1/0,void 0,[],{},Math.random(),Math.random().toString(36).substr(2)])}function notValue(e,r){var t=merge({},r);if(void 0!==e.minimum&&(t.maximum=e.minimum,t.exclusiveMaximum=!0),void 0!==e.maximum&&(t.minimum=e.maximum>t.maximum?0:e.maximum,t.exclusiveMinimum=!0),void 0!==e.minLength&&(t.maxLength=e.minLength),void 0!==e.maxLength&&(t.minLength=e.maxLength>t.maxLength?0:e.maxLength),e.type)t.type=random.pick(env.ALL_TYPES.filter(function(r){return(Array.isArray(e.type)?e.type:[e.type]).every(function(e){return"number"===r||"integer"===r?"number"!==e&&"integer"!==e:r!==e})}));else if(e.enum){var n;do{n=anyValue()}while(-1!==e.enum.indexOf(n));t.enum=[n]}return e.required&&t.properties&&e.required.forEach(function(e){delete t.properties[e]}),t}function validate(e,r){return!r.every(function(r){return void 0!==r.minimum&&e>=r.minimum||void 0!==r.maximum&&e<=r.maximum})}function isKey(e){return-1!==["enum","const","default","examples","required","definitions"].indexOf(e)}function omitProps(e,r){var t={};return Object.keys(e).forEach(function(n){-1===r.indexOf(n)&&(Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]instanceof Object?merge({},e[n]):e[n])}),t}function template(e,r){return Array.isArray(e)?e.map(function(e){return template(e,r)}):("string"==typeof e&&(e=e.replace(/#\{([\w.-]+)\}/g,function(e,t){return r[t]})),e)}var utils={getSubAttribute:getSubAttribute,hasProperties:hasProperties,omitProps:omitProps,typecast:typecast,merge:merge,clone:clone,short:short,notValue:notValue,anyValue:anyValue,validate:validate,isKey:isKey,template:template};function proxy(e){return function(r,t,n,i){var o=r,a=[];"object"==typeof r&&(o=Object.keys(r)[0],Array.isArray(r[o])?a=r[o]:a.push(r[o]));for(var u=o.split("."),s=e();u.length>1;)s=s[u.shift()];return"function"==typeof(r="object"==typeof s?s[u[0]]:s)&&(r=r.apply(s,a.map(function(e){return utils.template(e,i)}))),"[object Object]"===Object.prototype.toString.call(r)&&Object.keys(r).forEach(function(e){if("function"==typeof r[e])throw new Error("Cannot resolve value for '"+n+": "+o+"', given: "+r)}),r}}var Container=function(){this.registry={},this.support={}};Container.prototype.reset=function(e){e?(delete this.registry[e],delete this.support[e]):(this.registry={},this.support={})},Container.prototype.extend=function(e,r){var t=this;this.registry[e]=r(this.registry[e]),this.support[e]||(this.support[e]=proxy(function(){return t.registry[e]}))},Container.prototype.define=function(e,r){this.support[e]=r},Container.prototype.get=function(e){if(void 0===this.registry[e])throw new ReferenceError("'"+e+"' dependency doesn't exist.");return this.registry[e]},Container.prototype.wrap=function(e){for(var r=this,t=Object.keys(e),n={},i=t.length,o=function(){var o=t[i].replace(/^x-/,""),a=r.support[o];if("function"==typeof a)return Object.defineProperty(e,"generate",{configurable:!1,enumerable:!1,writable:!1,value:function(r){return a.call(n,e[t[i]],e,t[i],r)}}),"break"};i--;){if("break"===o())break}return e};var registry$1=new Registry;function formatAPI(e,r){if(void 0===e)return registry$1.list();if("string"==typeof e)if("function"==typeof r)registry$1.register(e,r);else{if(null!==r&&!1!==r)return registry$1.get(e);registry$1.unregister(e)}else registry$1.registerMany(e)}var ParseError=function(e){function r(r,t){e.call(this),e.captureStackTrace&&e.captureStackTrace(this,this.constructor),this.name="ParseError",this.message=r,this.path=t}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(Error),inferredProperties={array:["additionalItems","items","maxItems","minItems","uniqueItems"],integer:["exclusiveMaximum","exclusiveMinimum","maximum","minimum","multipleOf"],object:["additionalProperties","dependencies","maxProperties","minProperties","patternProperties","properties","required"],string:["maxLength","minLength","pattern","format"]};inferredProperties.number=inferredProperties.integer;var subschemaProperties=["additionalItems","items","additionalProperties","dependencies","patternProperties","properties"];function matchesType(e,r,t){return Object.keys(e).filter(function(e){var n=subschemaProperties.indexOf(r)>-1;return!(!(t.indexOf(e)>-1)||n)}).length>0}function inferType(e,r){for(var t=Object.keys(inferredProperties),n=0;n<t.length;n+=1){var i=t[n];if(matchesType(e,r[r.length-1],inferredProperties[i]))return i}}function booleanGenerator(){return optionAPI("random")()>.5}var booleanType=booleanGenerator;function nullGenerator(){return null}var nullType=nullGenerator;function unique(e,r,t,n,i,o){var a=[],u=[];function s(e){var r=JSON.stringify(e);return-1===u.indexOf(r)&&(u.push(r),a.push(e),!0)}r.forEach(s);for(var f=100;a.length!==r.length&&(s(o(t.items||n,e,i))||(f-=1),f););return a}function arrayType(e,r,t,n){var i=[];if(!e.items&&!e.additionalItems){if(utils.hasProperties(e,"minItems","maxItems","uniqueItems"))throw new ParseError("missing items for "+utils.short(e),r);return i}if(Array.isArray(e.items))return e.items.map(function(e,i){var o=r.concat(["items",i]);return n(e,o,t)});var o=e.minItems,a=e.maxItems;optionAPI("minItems")&&(o=a?Math.min(optionAPI("minItems"),a):optionAPI("minItems")),optionAPI("maxItems")&&(a&&a>optionAPI("maxItems")&&(a=optionAPI("maxItems")),o&&o>optionAPI("maxItems")&&(o=a));var u=!0===optionAPI("alwaysFakeOptionals")?1:optionAPI("optionalsProbability"),s=optionAPI("alwaysFakeOptionals")||optionAPI("fixedProbabilities")||!1,f=random.number(o,a,1,5);!1!==u&&(f=Math.max(s?Math.round((a||f)*u):Math.abs(random.number(o,a)*u),o||0));for(var c="object"==typeof e.additionalItems?e.additionalItems:{},m=i.length;m<f;m+=1){var p=r.concat(["items",m]),l=n(e.items||c,p,t);i.push(l)}return e.uniqueItems?unique(r.concat(["items"]),i,e,c,t,n):i}function numberType(e){var r=void 0===e.minimum?env.MIN_INTEGER:e.minimum,t=void 0===e.maximum?env.MAX_INTEGER:e.maximum,n=e.multipleOf;if(n&&(t=Math.floor(t/n)*n,r=Math.ceil(r/n)*n),e.exclusiveMinimum&&r===e.minimum&&(r+=n||1),e.exclusiveMaximum&&t===e.maximum&&(t-=n||1),r>t)return NaN;if(n){if(-1===String(n).indexOf(".")){for(var i=random.number(Math.floor(r/n),Math.floor(t/n))*n;i<r;)i+=e.multipleOf;return i}var o,a,u=(t-r)/n;do{a=(o=random.number(0,u)*n)/n%1}while(0!==a);return o}return random.number(r,t,void 0,void 0,!0)}function integerType(e){return numberType(Object.assign({multipleOf:1},e))}var LIPSUM_WORDS="Lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore\net dolore magna aliqua Ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea\ncommodo consequat Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\npariatur Excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est\nlaborum".split(/\W/);function wordsGenerator(e){return random.shuffle(LIPSUM_WORDS).slice(0,e)}var anyType={type:["string","number","integer","boolean"]};function objectType(e,r,t,n){var i={},o=e.properties||{},a=e.patternProperties||{},u="boolean"==typeof e.required?[]:(e.required||[]).slice(),s=!1!==e.additionalProperties,f=Object.keys(o),c=Object.keys(a),m=f.concat(c).reduce(function(e,r){return-1===u.indexOf(r)&&e.push(r),e},[]),p=u.concat(m),l=s&&!0===e.additionalProperties?anyType:e.additionalProperties;if(!s&&0===f.length&&0===c.length&&utils.hasProperties(e,"minProperties","maxProperties","dependencies","required"))return{};if(!0===optionAPI("requiredOnly"))return u.forEach(function(e){o[e]&&(i[e]=o[e])}),n(i,r.concat(["properties"]),t);var d=!0===optionAPI("alwaysFakeOptionals")?1:optionAPI("optionalsProbability"),h=optionAPI("alwaysFakeOptionals")||optionAPI("fixedProbabilities")||!1,y=optionAPI("ignoreProperties")||[],g=Math.max(e.minProperties||0,u.length),v=e.maxProperties||p.length+random.number(1,5),b=Math.max(0,g-u.length);1!==p.length||u.length||(b=random.number(b,p.length+(p.length-g))),!1!==d&&(b=!0===h?Math.round(g-u.length+d*(p.length-g)):random.number(g-u.length,d*(p.length-g)));var x=random.shuffle(m).slice(0,b),A=m.filter(function(e){return-1!==x.indexOf(e)}),P=u.concat(A).slice(0,v),I=[];if(e.dependencies&&(Object.keys(e.dependencies).forEach(function(r){var t=e.dependencies[r];-1!==P.indexOf(r)&&(Array.isArray(t)?t.forEach(function(e){-1===P.indexOf(e)&&P.push(e)}):I.push(t))}),I.length))return delete e.dependencies,n({allOf:I.concat(e)},r.concat(["properties"]),t);var E=[];P.forEach(function(e){for(var r=0;r<y.length;r+=1)if(y[r]instanceof RegExp&&y[r].test(e)||"string"==typeof y[r]&&y[r]===e||"function"==typeof y[r]&&y[r](o[e],e))return void E.push(e);var t;if(!1===l?-1!==u.indexOf(e)&&(i[e]=o[e]):o[e]&&(i[e]=o[e]),c.forEach(function(r){e.match(new RegExp(r))&&(t=!0,i[e]?utils.merge(i[e],a[r]):i[random.randexp(e)]=a[r])}),!t){var n=a[e]||l;n&&!1!==l&&(i[a[e]?random.randexp(e):e]=o[e]||n)}});var O=optionAPI("fillProperties"),M=optionAPI("reuseProperties"),T=Object.keys(i).length+(O?0:E.length),R=function(e){return random.randexp("_?[_a-f\\d]{1,3}"+(e?"\\$?":""))};function j(){var e;do{e=u.shift()}while(i[e]);return e}for(;O&&(c.length||s)&&!(T>=g);){if(s)if(M&&f.length-T>g){var k=0,w=void 0;do{if((k+=1)>1e3)break;w=j()||random.pick(f)}while(void 0!==i[w]);void 0===i[w]&&(i[w]=o[w],T+=1)}else if(c.length&&!l){var _=random.pick(c),N=random.randexp(_);i[N]||(i[N]=a[_],T+=1)}else{var L=j()||wordsGenerator(1)+R();i[L]||(i[L]=l||anyType,T+=1)}for(var S=0;T<g&&S<c.length;S+=1){var G=c[S],$=random.randexp(G);i[$]||(i[$]=a[G],T+=1)}}for(var q=random.number(g,v);T<q&&l;){var F=wordsGenerator(1)+R(!0);i[F]||(i[F]=l,T+=1)}return n(i,r.concat(["properties"]),t)}function produce(){return wordsGenerator(random.number(1,5)).join(" ")}function thunkGenerator(e,r){void 0===e&&(e=0),void 0===r&&(r=140);for(var t=Math.max(0,e),n=random.number(t,r),i=produce();i.length<t;)i+=produce();return i.length>n&&(i=i.substr(0,n)),i}function ipv4Generator(){return[0,0,0,0].map(function(){return random.number(0,255)}).join(".")}function dateTimeGenerator(){return random.date().toISOString()}function dateGenerator(){return dateTimeGenerator().slice(0,10)}function timeGenerator(){return dateTimeGenerator().slice(11)}var FRAGMENT="[a-zA-Z][a-zA-Z0-9+-.]*",URI_PATTERN="https?://{hostname}(?:"+FRAGMENT+")+",PARAM_PATTERN="(?:\\?([a-z]{1,7}(=\\w{1,5})?&){0,3})?",regexps={email:"[a-zA-Z\\d][a-zA-Z\\d-]{1,13}[a-zA-Z\\d]@{hostname}",hostname:"[a-zA-Z]{1,33}\\.[a-z]{2,4}",ipv6:"[a-f\\d]{4}(:[a-f\\d]{4}){7}",uri:URI_PATTERN,slug:"[a-zA-Z\\d_-]+","uri-reference":""+URI_PATTERN+PARAM_PATTERN,"uri-template":URI_PATTERN.replace("(?:","(?:/\\{[a-z][:a-zA-Z0-9-]*\\}|"),"json-pointer":"(/(?:"+FRAGMENT.replace("]*","/]*")+"|~[01]))+",uuid:"^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$"};regexps.iri=regexps["uri-reference"],regexps["iri-reference"]=regexps["uri-reference"],regexps["idn-email"]=regexps.email,regexps["idn-hostname"]=regexps.hostname;var ALLOWED_FORMATS=new RegExp("\\{("+Object.keys(regexps).join("|")+")\\}");function coreFormatGenerator(e){return random.randexp(regexps[e]).replace(ALLOWED_FORMATS,function(e,r){return random.randexp(regexps[r])})}function generateFormat(e,r){var t=formatAPI(e.format);if("function"==typeof t)return t(e);switch(e.format){case"date-time":case"datetime":return dateTimeGenerator();case"date":return dateGenerator();case"time":return timeGenerator();case"ipv4":return ipv4Generator();case"regex":return".+?";case"email":case"hostname":case"ipv6":case"uri":case"uri-reference":case"iri":case"iri-reference":case"idn-email":case"idn-hostname":case"json-pointer":case"slug":case"uri-template":case"uuid":return coreFormatGenerator(e.format);default:if(void 0===t){if(optionAPI("failOnInvalidFormat"))throw new Error("unknown registry key "+utils.short(e.format));return r()}throw new Error("unsupported format '"+e.format+"'")}}function stringType(e){return utils.typecast("string",e,function(r){return e.format?generateFormat(e,function(){return thunkGenerator(r.minLength,r.maxLength)}):e.pattern?random.randexp(e.pattern):thunkGenerator(r.minLength,r.maxLength)})}var typeMap={boolean:booleanType,null:nullType,array:arrayType,integer:integerType,number:numberType,object:objectType,string:stringType};function traverse(e,r,t,n){if(e=t(e,void 0,r)){if("properties"!==r[r.length-1]){if(optionAPI("useExamplesValue")&&Array.isArray(e.examples)){var i=e.examples.concat("default"in e?[e.default]:[]);return utils.typecast(null,e,function(){return random.pick(i)})}if(optionAPI("useDefaultValue")&&"default"in e)return e.default;if("template"in e)return utils.template(e.template,n)}if(e.not&&"object"==typeof e.not&&(e=utils.notValue(e.not,utils.omitProps(e,["not"]))),"const"in e)return e.const;if(Array.isArray(e.enum))return utils.typecast(null,e,function(){return random.pick(e.enum)});if("function"==typeof e.thunk)return traverse(e.thunk(),r,t);if("function"==typeof e.generate)return utils.typecast(null,e,function(){return e.generate(n)});var o=e.type;if(Array.isArray(o)?o=random.pick(o):void 0===o&&(o=inferType(e,r)||o)&&(e.type=o),"string"==typeof o){if(!typeMap[o]){if(optionAPI("failOnInvalidTypes"))throw new ParseError("unknown primitive "+utils.short(o),r.concat(["type"]));return optionAPI("defaultInvalidTypeProduct")}try{return typeMap[o](e,r,t,traverse)}catch(e){if(void 0===e.path)throw new ParseError(e.stack,r);throw e}}var a={};return Array.isArray(e)&&(a=[]),Object.keys(e).forEach(function(n){"object"==typeof e[n]&&"definitions"!==n?a[n]=traverse(e[n],r.concat([n]),t,a):a[n]=e[n]}),a}}function pick$1(e){return Array.isArray(e)?random.pick(e):e}function cycle(e,r){if(!Array.isArray(e))return e;var t=r?e.pop():e.shift();return r?e.unshift(t):e.push(t),t}function resolve(e,r,t,n){if(!e||"object"!=typeof e)return e;if(t||(t={}),r||(r=e),Array.isArray(e))return e.map(function(e){return resolve(e,r,t,n)});if(e.jsonPath){var i="object"!=typeof e.jsonPath?{path:e.jsonPath}:e.jsonPath;i.group=e.group||i.group||n,i.cycle=e.cycle||i.cycle||!1,i.reverse=e.reverse||i.reverse||!1,i.count=e.count||i.count||1;var o=i.group+"__"+i.path;return t[o]||(i.count>1?t[o]=JSONPath(i.path,r).slice(0,i.count):t[o]=JSONPath(i.path,r)),i.cycle||i.reverse?cycle(t[o],i.reverse):pick$1(t[o])}return Object.keys(e).forEach(function(n){e[n]=resolve(e[n],r,t,n)}),e}function run(e,r,t){try{var n=traverse(utils.clone(r),[],function n(i,o,a){if(void 0===o&&(o=random.number(1,3)),!i)return null;if("function"==typeof i.generate)return i;if("string"==typeof(i.$id||i.id)&&(delete i.id,delete i.$id,delete i.$schema),"string"==typeof i.$ref){if("#"===i.$ref)return delete i.$ref,i;var u;if(-1===i.$ref.indexOf("#/")&&(u=e[i.$ref]||null),0===i.$ref.indexOf("#/definitions/")&&(u=r.definitions[i.$ref.split("#/definitions/")[1]]||null),void 0!==u){if(!u&&!0!==optionAPI("ignoreMissingRefs"))throw new Error("Reference not found: "+i.$ref);utils.merge(i,u||{})}return delete i.$ref,i}if(Array.isArray(i.allOf)){var s=i.allOf;delete i.allOf,s.forEach(function(e){var r=n(e,o+1,a);utils.merge(i,"function"==typeof r.thunk?r.thunk():r)})}if(Array.isArray(i.oneOf||i.anyOf)){var f=i.oneOf||i.anyOf;return i.enum&&i.oneOf&&(i.enum=i.enum.filter(function(e){return utils.validate(e,f)})),{thunk:function(){var e=utils.omitProps(i,["anyOf","oneOf"]),r=random.pick(f);return utils.merge(e,r),i.oneOf&&f.forEach(function(t){t!==r&&t.required&&t.required.forEach(function(r){delete e.properties[r]})}),e}}}if(Object.keys(i).forEach(function(e){!Array.isArray(i[e])&&"object"!=typeof i[e]||utils.isKey(e)||(i[e]=n(i[e],o,a.concat(e)))}),a){var c=a[a.length-1];if("properties"===c||"items"===c)return i}return t.wrap(i)});return optionAPI("resolveJsonPath")?resolve(n):n}catch(e){throw e.path?new Error(e.message+" in /"+e.path.join("/")):e}}var container=new Container;function setupKeywords(){container.define("pattern",random.randexp),container.define("autoIncrement",function(e,r){if(!this.offset){var t=r.minimum||1,n=t+env.MAX_NUMBER,i=e.initialOffset||r.initialOffset;this.offset=i||random.number(t,n)}return!0===e?this.offset++:r}),container.define("sequentialDate",function(e,r){if(this.now||(this.now=random.date()),e){if(r=this.now.toISOString(),-1===["seconds","minutes","hours","days","weeks","months","years"].indexOf(e=!0===e?"days":e))throw new Error("Unsupported increment by "+utils.short(e));this.now.setTime(this.now.getTime()+random.date(e))}return r})}function getRefs(e){var r={};return Array.isArray(e)?e.forEach(function(e){r[e.$id||e.id]=e}):r=e||{},r}var jsf=function(e,r,t){return console.log("[json-schema-faker] calling JsonSchemaFaker() is deprecated, call either .generate() or .resolve()"),t&&console.log("[json-schema-faker] references are only supported by calling .resolve()"),jsf.generate(e,r)};jsf.generate=function(e,r){return run(getRefs(r),e,container)},jsf.resolve=function(e,r,t){"string"==typeof r&&(t=r,r={}),t=(t=t||("undefined"!=typeof process?process.cwd():"")).replace(/\/+$/,"")+"/";var n=getRefs(r),i={order:300,canRead:!0,read:function(e,r){try{r(null,n[e.url]||n[e.url.split("/").pop()])}catch(e){r(e)}}};return $RefParser.dereference(t,e,{resolve:{file:{order:100},http:{order:200},fixedRefs:i},dereference:{circular:"ignore"}}).then(function(e){return run(n,e,container)})},setupKeywords(),jsf.format=formatAPI,jsf.option=optionAPI,jsf.random=random,jsf.extend=function(e,r){return container.extend(e,r),jsf},jsf.define=function(e,r){return container.define(e,r),jsf},jsf.reset=function(e){return container.reset(e),setupKeywords(),jsf},jsf.locate=function(e){return container.get(e)},jsf.version="0.5.0-rc18";export default jsf;