!function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(e):e.ss=t(e)}("undefined"!=typeof window?window:this,function(g){var n,b=g.ss||{},t=/^\s+/,s=/\s+$/,e=/[xy]/g,i=/.*(\/|\\)/,o=/.*[.]/,r=/[\t\r\n]/g,a=0<Object.prototype.toString.call(g.HTMLElement).indexOf("Constructor"),u=-1!==navigator.userAgent.indexOf("MSIE")&&-1===navigator.userAgent.indexOf("MSIE 1"),l=-1!==navigator.userAgent.indexOf("MSIE 7"),d=document.createElement("input");d.type="file",n="multiple"in d&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload,b.obj2string=function(e,t){"use strict";var s,n,i=[];for(var o in e){e.hasOwnProperty(o)&&(s=t?t+"["+o+"]":o,n=e[o],i.push("object"==typeof n?b.obj2string(n,s):encodeURIComponent(s)+"="+encodeURIComponent(n)))}return i.join("&")},b.extendObj=function(e,t){"use strict";for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},b.addEvent=function(e,t,s){"use strict";return e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent("on"+t,s),function(){b.removeEvent(e,t,s)}},b.removeEvent=document.removeEventListener?function(e,t,s){e.removeEventListener&&e.removeEventListener(t,s,!1)}:function(e,t,s){var n="on"+t;void 0===e[n]&&(e[n]=null),e.detachEvent(n,s)},b.newXHR=function(){"use strict";if("undefined"!=typeof XMLHttpRequest)return new g.XMLHttpRequest;if(g.ActiveXObject)try{return new g.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},b.encodeUTF8=function(e){"use strict";return unescape(encodeURIComponent(e))},b.getIFrame=function(){"use strict";var e,t=b.getUID();return l?e=document.createElement('<iframe src="javascript:false;" name="'+t+'">'):((e=document.createElement("iframe")).src="javascript:false;",e.name=t),e.style.display="none",e.id=t,e},b.getForm=function(e){"use strict";var t=document.createElement("form");for(var s in t.encoding="multipart/form-data",t.enctype="multipart/form-data",t.style.display="none",e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},b.getHidden=function(e,t){"use strict";var s=document.createElement("input");return s.type="hidden",s.name=e,s.value=t,s},b.parseJSON=function(e){"use strict";if(!e)return!1;if(e=b.trim(e+""),g.JSON&&g.JSON.parse)try{return g.JSON.parse(e+"")}catch(e){return!1}var i,o=null;return!(!e||b.trim(e.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,t,s,n){return i&&t&&(o=0),0===o?e:(i=s||t,o+=!n-!s,"")})))&&Function("return "+e)()},b.getBox=function(e){"use strict";var t,s,n=0,i=0;if(e.getBoundingClientRect)t=e.getBoundingClientRect(),s=document.documentElement,n=t.top+(g.pageYOffset||s.scrollTop)-(s.clientTop||0),i=t.left+(g.pageXOffset||s.scrollLeft)-(s.clientLeft||0);else for(;i+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;);return{top:Math.round(n),left:Math.round(i)}},b.addStyles=function(e,t){"use strict";for(var s in t)t.hasOwnProperty(s)&&(e.style[s]=t[s])},b.copyLayout=function(e,t){"use strict";var s=b.getBox(e);b.addStyles(t,{position:"absolute",left:s.left+"px",top:s.top+"px",width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},b.getUID=function(){"use strict";return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})};var c="".trim;b.trim=c&&!c.call("\ufeffÂ ")?function(e){return null===e?"":c.call(e)}:function(e){return null===e?"":e.toString().replace(t,"").replace(s,"")};return b.indexOf=[].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var s=0,n=e.length;s<n;s++)if(e[s]===t)return s;return-1},b.arrayDelete=function(e,t){var s=b.indexOf(e,t);-1<s&&e.splice(s,1)},b.getFilename=function(e){"use strict";return e.replace(i,"")},b.getExt=function(e){"use strict";return-1!==e.indexOf(".")?e.replace(o,""):""},b.isVisible=function(e){"use strict";return!!e&&(1!==e.nodeType||e==document.body?!(e=null):e.parentNode&&(0<e.offsetWidth||0<e.offsetHeight||"none"!=b.getStyle(e,"display").toLowerCase())?b.isVisible(e.parentNode):(e=null,!1))},b.getStyle=function(e,t){"use strict";return g.getComputedStyle?e.ownerDocument.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:void 0},b.getFormObj=function(e){"use strict";for(var t,s=e.elements,n=["button","submit","image","reset"],i={},o=0,r=s.length;o<r;o++)if(t={},s[o].name&&!s[o].disabled&&-1===b.indexOf(n,s[o].type)){if(("checkbox"==s[o].type||"radio"==s[o].type)&&!s[o].checked)continue;t[s[o].name]=b.val(s[o]),b.extendObj(i,t)}return i},b.val=function(e){"use strict";if(e){if("SELECT"!=e.nodeName.toUpperCase())return e.value;for(var t,s=e.options,n=e.selectedIndex,i="select-one"===e.type||n<0,o=i?null:[],r=0,a=s.length;r<a;r++)if((s[r].selected||r===n)&&!s[r].disabled){if(t=s[r].value?s[r].value:s[r].text,i)return t;o.push(t)}return o}},b.hasClass=function(e,t){"use strict";return!(!e||!t)&&0<=(" "+e.className+" ").replace(r," ").indexOf(" "+t+" ")},b.addClass=function(e,t){"use strict";if(!e||!t)return!1;b.hasClass(e,t)||(e.className+=" "+t)},b.removeClass=function(){"use strict";var s={};return function(e,t){if(!e||!t)return!1;s[t]||(s[t]=new RegExp("(?:^|\\s)"+t+"(?!\\S)")),e.className=e.className.replace(s[t],"")}}(),b.purge=function(e){"use strict";var t,s,n,i=e.attributes;if(i)for(t=i.length-1;0<=t;--t)"function"==typeof e[n=i[t].name]&&(e[n]=null);if(i=e.childNodes)for(s=i.length,t=0;t<s;t+=1)b.purge(e.childNodes[t])},b.remove=function(e){"use strict";e&&e.parentNode&&(b.purge(e),e.parentNode.removeChild(e)),e=null},b.verifyElem=function(e){"use strict";return"undefined"!=typeof jQuery&&e instanceof jQuery?e=e[0]:"string"==typeof e&&("#"==e.charAt(0)&&(e=e.substr(1)),e=document.getElementById(e)),!(!e||1!==e.nodeType)&&("A"==e.nodeName.toUpperCase()&&(e.style.cursor="pointer",b.addEvent(e,"click",function(e){e&&e.preventDefault?e.preventDefault():g.event&&(g.event.returnValue=!1)})),e)},b.getCommonAncestor=function(e){if(e&&1===e.nodeType){var t=[].slice.call(arguments,1),s="compareDocumentPosition",n=16;"contains"in e&&(s="contains",n=1);e:for(;e=e&&e.parentNode;){for(var i=t.length;i--;)if((e[s](t[i])&n)!==n)continue e;return e}}},b._options={},b.uploadSetup=function(e){"use strict";b.extendObj(b._options,e)},b.SimpleUpload=function(e){"use strict";if(this._opts={button:"",url:"",dropzone:"",dragClass:"",form:"",overrideSubmit:!0,cors:!1,withCredentials:!1,progressUrl:!1,sessionProgressUrl:!1,nginxProgressUrl:!1,multiple:!1,multipleSelect:!1,maxUploads:3,queue:!0,checkProgressInterval:500,keyParamName:"APC_UPLOAD_PROGRESS",sessionProgressName:"PHP_SESSION_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",customProgressHeaders:{},corsInputName:"XHR_CORS_TARGETORIGIN",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},noParams:!0,autoSubmit:!0,multipart:!0,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",customHeaders:{},encodeHeaders:!0,autoCalibrate:!0,relativeToParent:!1,inputZIndex:16777270,onBlankSubmit:function(){},onAbort:function(e,t,s){},onChange:function(e,t,s,n,i){},onSubmit:function(e,t,s,n){},onProgress:function(e){},onUpdateFileSize:function(e){},onComplete:function(e,t,s,n){},onDone:function(e,t,s,n,i,o){},onAllDone:function(){},onExtError:function(e,t){},onSizeError:function(e,t){},onError:function(e,t,s,n,i,o,r){},startXHR:function(e,t,s){},endXHR:function(e,t,s){},startNonXHR:function(e,t){},endNonXHR:function(e,t){}},b.extendObj(this._opts,b._options),b.extendObj(this._opts,e),this._queue=[],this._active=0,this._disabled=!1,this._maxFails=10,this._progKeys={},this._sizeFlags={},this._btns=[],this.addButton(this._opts.button),delete this._opts.button,this._opts.button=e=null,this._parentElement=document.documentElement,this._opts.relativeToParent&&0!==this._btns.length&&(this._parentElement=1===this._btns.length?this._btns[0].parentNode:b.getCommonAncestor.apply(this,this._btns)),!1===this._opts.multiple&&(this._opts.maxUploads=1),""!==this._opts.dropzone&&this.addDZ(this._opts.dropzone),""===this._opts.dropzone&&this._btns.length<1)throw new Error("Invalid upload button. Make sure the element you're passing exists.");""!==this._opts.form&&this.setForm(this._opts.form),this._createInput(),this._manDisabled=!1,this.enable(!0)},b.SimpleUpload.prototype={destroy:function(){"use strict";for(var e=this._btns.length;e--;)this._btns[e].off&&this._btns[e].off(),b.removeClass(this._btns[e],this._opts.hoverClass),b.removeClass(this._btns[e],this._opts.focusClass),b.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1;this._killInput(),this._destroy=!0},log:function(e){"use strict";this._opts&&this._opts.debug&&g.console&&g.console.log&&g.console.log("[Uploader] "+e)},setData:function(e){"use strict";this._opts.data=e},setOptions:function(e){"use strict";b.extendObj(this._opts,e)},addButton:function(e){var t;if(e instanceof Array)for(var s=0,n=e.length;s<n;s++)!1!==(t=b.verifyElem(e[s]))?this._btns.push(this.rerouteClicks(t)):this.log("Button with array index "+s+" is invalid");else!1!==(t=b.verifyElem(e))&&this._btns.push(this.rerouteClicks(t))},addDZ:function(e){n&&((e=b.verifyElem(e))?this.addDropZone(e):this.log("Invalid or nonexistent element passed for drop zone"))},setProgressBar:function(e){"use strict";this._progBar=b.verifyElem(e)},setPctBox:function(e){"use strict";this._pctBox=b.verifyElem(e)},setFileSizeBox:function(e){"use strict";this._sizeBox=b.verifyElem(e)},setProgressContainer:function(e){"use strict";this._progBox=b.verifyElem(e)},setAbortBtn:function(e,t){"use strict";this._abortBtn=b.verifyElem(e),this._removeAbort=!1,t&&(this._removeAbort=!0)},setForm:function(e){"use strict";var t;this._form=b.verifyElem(e),this._form&&"FORM"==this._form.nodeName.toUpperCase()?((t=this)._opts.autoSubmit=!1,this._opts.overrideSubmit&&(b.addEvent(this._form,"submit",function(e){e.preventDefault?e.preventDefault():g.event&&(g.event.returnValue=!1),t._validateForm()&&t.submit()}),this._form.submit=function(){t._validateForm()&&t.submit()})):this.log("Invalid or nonexistent element passed for form")},getQueueSize:function(){"use strict";return this._queue.length},removeCurrent:function(e){"use strict";if(e){for(var t=this._queue.length;t--;)if(this._queue[t].id===e){this._queue.splice(t,1);break}}else this._queue.splice(0,1);this._cycleQueue()},clearQueue:function(){"use strict";this._queue.length=0},disable:function(e){"use strict";var t,s=this._btns.length;for(this._manDisabled=!e||!0===this._manDisabled,this._disabled=!0;s--;)"INPUT"!=(t=this._btns[s].nodeName.toUpperCase())&&"BUTTON"!=t||(this._btns[s].disabled=!0),""!==this._opts.disabledClass&&b.addClass(this._btns[s],this._opts.disabledClass);this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(e){"use strict";if(e||(this._manDisabled=!1),!0!==this._manDisabled){var t=this._btns.length;for(this._disabled=!1;t--;)b.removeClass(this._btns[t],this._opts.disabledClass),this._btns[t].disabled=!1}},updatePosition:function(e){"use strict";(e=e||this._btns[0])&&this._input&&this._input.parentNode&&b.copyLayout(e,this._input.parentNode),e=null},rerouteClicks:function(t){"use strict";var e,s=this,n=b.addEvent(t,"mouseover",function(){s._disabled||(s._input||s._createInput(),s._overBtn=t,b.copyLayout(t,s._input.parentNode),s._input.parentNode.style.visibility="visible")}),i=b.addEvent(t,"click",function(e){e&&e.preventDefault&&e.preventDefault(),s._disabled||(s._input||s._createInput(),s._overBtn=t,u||s._input.click())});return t.off=function(){n(),i()},s._opts.autoCalibrate&&!b.isVisible(t)&&(s.log("Upload button not visible"),e=function(){b.isVisible(t)?(s.log("Upload button now visible"),g.setTimeout(function(){s.updatePosition(t),1===s._btns.length&&(s._input.parentNode.style.visibility="hidden")},200)):g.setTimeout(e,500)},g.setTimeout(e,500)),t},submit:function(e,t){"use strict";!t&&this._queue.length<1?this._opts.onBlankSubmit.call(this):this._disabled||this._active>=this._opts.maxUploads||this._queue.length<1||this._checkFile(this._queue[0])&&(!1!==this._opts.onSubmit.call(this,this._queue[0].name,this._queue[0].ext,this._queue[0].btn,this._queue[0].size)?(this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(!0),this._initUpload(this._queue[0])):this.removeCurrent(this._queue[0].id))}},b.IframeUpload={_detachEvents:{},_detach:function(e){this._detachEvents[e]&&(this._detachEvents[e](),delete this._detachEvents[e])},_getHost:function(e){var t=document.createElement("a");return t.href=e,t.hostname?t.hostname.toLowerCase():e},_addFiles:function(e){var t=b.getFilename(e.value),s=b.getExt(t);return!1!==this._opts.onChange.call(this,t,s,this._overBtn,void 0,e)&&(this._queue.push({id:b.getUID(),file:e,name:t,ext:s,btn:this._overBtn,size:null}),!0)},_uploadIframe:function(t,s,n,i,o,r,a){"use strict";var u,l,d=this,c=this._opts,p=b.getUID(),h=b.getIFrame(),f=!1,_=!1,e=!0!==c.noParams&&c.nginxProgressUrl?e+(-1<e.indexOf("?")?"&":"?")+encodeURIComponent(c.nginxProgressHeader)+"="+encodeURIComponent(p):c.url,m=b.getForm({action:e,target:h.name,method:c.method});c.onProgress.call(this,0),o&&(o.innerHTML="0%"),i&&(i.style.width="0%"),c.cors&&(l=b.getUID(),d._detachEvents[l]=b.addEvent(g,"message",function(e){d._getHost(e.origin)==d._getHost(c.url)?(f=!0,d._detach(l),c.endNonXHR.call(d,t.name,t.btn),d._finish(t,"","",e.data,n,s,o,r,a)):d.log("Non-matching origin: "+e.origin)})),d._detachEvents[h.id]=b.addEvent(h,"load",function(){for(var e in d._detach(h.id),c.sessionProgressUrl?m.appendChild(b.getHidden(c.sessionProgressName,p)):c.progressUrl&&m.appendChild(b.getHidden(c.keyParamName,p)),d._form&&b.extendObj(c.data,b.getFormObj(d._form)),c.data)c.data.hasOwnProperty(e)&&m.appendChild(b.getHidden(e,c.data[e]));c.cors&&m.appendChild(b.getHidden(c.corsInputName,g.location.href)),m.appendChild(t.file),d._detachEvents[t.id]=b.addEvent(h,"load",function(){if(h&&h.parentNode&&!_)if(d._detach(t.id),_=!0,delete d._progKeys[p],delete d._sizeFlags[p],r&&b.removeEvent(r,"click",u),c.cors)g.setTimeout(function(){b.remove(h),f||d._errorFinish(t,"","",!1,"error",s,n,o,r,a),c=p=h=n=s=o=r=a=null},600);else{try{var e=(h.contentDocument?h.contentDocument:h.contentWindow.document).body.innerHTML;b.remove(h),h=null,c.endNonXHR.call(d,t.name,t.btn),d._finish(t,"","",e,n,s,o,r,a)}catch(e){d._errorFinish(t,"",e.message,!1,"error",s,n,o,r,a)}c=p=n=s=o=null}}),r&&(u=function(){if(b.removeEvent(r,"click",u),delete d._progKeys[p],delete d._sizeFlags[p],h){_=!0,d._detach(t.id);try{h.contentWindow.document.execCommand&&h.contentWindow.document.execCommand("Stop")}catch(e){}try{h.src="javascript".concat(":false;")}catch(e){}g.setTimeout(function(){b.remove(h),h=null},1)}d.log("Upload aborted"),c.onAbort.call(d,t.name,t.btn,t.size),d._last(n,s,o,r,a,t,"abort")},b.addEvent(r,"click",u)),d.log("Commencing upload using iframe"),m.submit(),g.setTimeout(function(){b.remove(m),m=null,d.removeCurrent(t.id)},1),d._hasProgUrl&&(d._progKeys[p]=1,g.setTimeout(function(){d._getProg(p,i,n,o,1),i=n=o=null},600))}),document.body.appendChild(m),document.body.appendChild(h)},_getProg:function(o,r,a,u,l){"use strict";var e,d,c=this,p=this._opts,t=(new Date).getTime();if(o&&p)if(p.nginxProgressUrl?e=p.nginxProgressUrl+"?"+encodeURIComponent(p.nginxProgressHeader)+"="+encodeURIComponent(o)+"&_="+t:p.sessionProgressUrl?e=p.sessionProgressUrl:p.progressUrl&&(e=p.progressUrl+"?progresskey="+encodeURIComponent(o)+"&_="+t),d=function(){var e,t,s,n,i;try{if(d&&(p.cors||4===h.readyState)){d=void 0,h.onreadystatechange=function(){};try{i=h.statusText,n=h.status}catch(e){n=i=""}if(p.cors||200<=n&&n<300){if(!1===(e=b.parseJSON(h.responseText)))return void c.log("Error parsing progress response (expecting JSON)");if(p.nginxProgressUrl){if("uploading"==e.state)0<(t=parseInt(e.size,10))&&(s=Math.round(parseInt(e.received,10)/t*100),t=Math.round(t/1024));else if("done"==e.state)s=100;else if("error"==e.state)return void c.log("Error requesting upload progress: "+e.status)}else(p.sessionProgressUrl||p.progressUrl)&&!0===e.success&&(t=parseInt(e.size,10),s=parseInt(e.pct,10));if(s&&(u&&(u.innerHTML=s+"%"),r&&(r.style.width=s+"%"),p.onProgress.call(c,s)),t&&!c._sizeFlags[o]&&(a&&(a.innerHTML=t+"K"),c._sizeFlags[o]=1,p.onUpdateFileSize.call(c,t)),!s&&!t&&l>=c._maxFails)return l++,void c.log("Failed progress request limit reached. Count: "+l);s<100&&c._progKeys[o]&&g.setTimeout(function(){c._getProg(o,r,a,u,l),o=r=a=u=l=null},p.checkProgressInterval)}else delete c._progKeys[o],c.log("Error requesting upload progress: "+n+" "+i);h=t=s=n=i=e=null}}catch(e){c.log("Error requesting upload progress: "+e.message)}},p.cors&&!p.sessionProgressUrl){if(!g.XDomainRequest)return;(h=new g.XDomainRequest).open("GET",e,!0),h.onprogress=h.ontimeout=function(){},h.onload=d,h.onerror=function(){delete c._progKeys[o],o=null,c.log("Error requesting upload progress")}}else{var s,n=p.sessionProgressUrl?"POST":"GET",i={},h=b.newXHR();for(var f in h.onreadystatechange=d,h.open(n,e,!0),p.sessionProgressUrl&&(s=encodeURIComponent(p.sessionProgressName)+"="+encodeURIComponent(o),i["Content-Type"]="application/x-www-form-urlencoded"),p.nginxProgressUrl&&(i[p.nginxProgressHeader]=o),i["X-Requested-With"]="XMLHttpRequest",i.Accept="application/json, text/javascript, */*; q=0.01",b.extendObj(i,p.customProgressHeaders),i)i.hasOwnProperty(f)&&(p.encodeHeaders?h.setRequestHeader(f,b.encodeUTF8(i[f]+"")):h.setRequestHeader(f,i[f]+""));h.send(p.sessionProgressUrl&&s||null)}},_initUpload:function(e){if(!1===this._opts.startNonXHR.call(this,e.name,e.btn))return this._disabled&&this.enable(!0),void this._active--;this._hasProgUrl=!!(this._opts.progressUrl||this._opts.sessionProgressUrl||this._opts.nginxProgressUrl),this._uploadIframe(e,this._progBox,this._sizeBox,this._progBar,this._pctBox,this._abortBtn,this._removeAbort),e=this._progBox=this._sizeBox=this._progBar=this._pctBox=this._abortBtn=this._removeAbort=null}},b.XhrUpload={_addFiles:function(e){var t,s,n,i,o=e.length;for(this._opts.multiple||(o=1),i=0;i<o;i++){if(t=b.getFilename(e[i].name),s=b.getExt(t),n=Math.round(e[i].size/1024),!1===this._opts.onChange.call(this,t,s,this._overBtn,n,e[i]))return!1;this._queue.push({id:b.getUID(),file:e[i],name:t,ext:s,btn:this._overBtn,size:n})}return!0},_uploadXhr:function(n,e,t,s,i,o,r,a,u,l){"use strict";var d,c,p=this,h=this._opts,f=b.newXHR();for(var _ in i&&(i.innerHTML=n.size+"K"),a&&(a.innerHTML="0%"),o&&(o.style.width="0%"),d=function(e,t){var s;try{if(d&&(t||4===f.readyState))if(d=void 0,f.onreadystatechange=function(){},t)4!==f.readyState&&f.abort(),h.onAbort.call(p,n.name,n.btn,n.size),p._last(i,r,a,u,l,n,"abort");else{u&&b.removeEvent(u,"click",c);try{s=f.statusText}catch(e){s=""}200<=f.status&&f.status<300?(h.endXHR.call(p,n.name,n.size,n.btn),p._finish(n,f.status,s,f.responseText,i,r,a,u,l)):p._errorFinish(n,f.status,s,f.responseText,"error",r,i,a,u,l)}}catch(e){t||p._errorFinish(n,-1,e.message,!1,"error",r,i,a,u,l)}},u&&(c=function(){b.removeEvent(u,"click",c),d&&d(void 0,!0)},b.addEvent(u,"click",c)),f.onreadystatechange=d,f.open(h.method.toUpperCase(),e,!0),f.withCredentials=!!h.withCredentials,b.extendObj(s,h.customHeaders),s)s.hasOwnProperty(_)&&(h.encodeHeaders?f.setRequestHeader(_,b.encodeUTF8(s[_]+"")):f.setRequestHeader(_,s[_]+""));if(b.addEvent(f.upload,"progress",function(e){var t;e.lengthComputable&&(t=Math.round(e.loaded/e.total*100),h.onProgress.call(p,t),a&&(a.innerHTML=t+"%"),o&&(o.style.width=t+"%"))}),h.onProgress.call(this,0),!0===h.multipart){var m=new FormData,g=!1;for(var v in t)t.hasOwnProperty(v)&&(v!==h.name||!0!==h.noParams||p._form||(g=!0),m.append(v,t[v]));g||m.append(h.name,n.file),this.log("Commencing upload using multipart form"),f.send(m)}else this.log("Commencing upload using binary stream"),f.send(n.file);this.removeCurrent(n.id)},_initUpload:function(e){"use strict";var t,s={},n={};if(!1===this._opts.startXHR.call(this,e.name,e.size,e.btn))return this._disabled&&this.enable(!0),void this._active--;n["X-Requested-With"]="XMLHttpRequest",n["X-File-Name"]=b.encodeUTF8(e.name),"json"==this._opts.responseType.toLowerCase()&&(n.Accept="application/json, text/javascript, */*; q=0.01"),this._opts.multipart||(n["Content-Type"]="application/octet-stream"),this._form&&b.extendObj(s,b.getFormObj(this._form)),b.extendObj(s,this._opts.data),t=!0===this._opts.noParams?this._opts.url:this._opts.url+(-1<this._opts.url.indexOf("?")?"&":"?")+b.obj2string(s),this._uploadXhr(e,t,s,n,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort),this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null}},b.DragAndDrop={_dragFileCheck:function(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1},addDropZone:function(e){var t=this,s=[];b.addStyles(e,{zIndex:t._opts.inputZIndex+1}),e.ondragenter=function(e){return e.stopPropagation(),e.preventDefault(),t._dragFileCheck(e)&&(0===s.length&&b.addClass(this,t._opts.dragClass),-1===b.indexOf(s,e.target)&&s.push(e.target)),!1},e.ondragover=function(e){return e.stopPropagation(),e.preventDefault(),t._dragFileCheck(e)&&(e.dataTransfer.dropEffect="copy"),!1},e.ondragend=function(){return b.removeClass(this,t._opts.dragClass),!1},e.ondragleave=function(e){return b.arrayDelete(s,e.target),0===s.length&&b.removeClass(this,t._opts.dragClass),!1},e.ondrop=function(e){e.stopPropagation(),e.preventDefault(),b.arrayDelete(s,e.target),0===s.length&&b.removeClass(this,t._opts.dragClass),t._dragFileCheck(e)&&!1!==t._addFiles(e.dataTransfer.files)&&t._cycleQueue()}}},b.extendObj(b.SimpleUpload.prototype,{_createInput:function(){"use strict";var e,t=this,s=document.createElement("div");this._input=document.createElement("input"),this._input.type="file",this._input.name=this._opts.name,n&&!a&&this._opts.multipleSelect&&(this._input.multiple=!0),"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept),b.addStyles(s,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:t._opts.inputZIndex}),"0"!==s.style.opacity&&(s.style.filter="alpha(opacity=0)"),b.addStyles(this._input,{position:"absolute",right:0,top:0,margin:0,padding:0,fontSize:"3500px",fontFamily:"sans-serif",cursor:"pointer",zIndex:t._opts.inputZIndex}),this._input.turnOff=b.addEvent(this._input,"change",function(){t._input&&""!==t._input.value&&!1!==t._addFiles(n?t._input.files:t._input)&&(b.removeClass(t._overBtn,t._opts.hoverClass),b.removeClass(t._overBtn,t._opts.focusClass),t._killInput(),t._createInput(),t._opts.autoSubmit&&t.submit())}),""!==t._opts.hoverClass&&(s.mouseOverOff=b.addEvent(s,"mouseover",function(){b.addClass(t._overBtn,t._opts.hoverClass)})),s.mouseOutOff=b.addEvent(s,"mouseout",function(){t._input.parentNode.style.visibility="hidden",""!==t._opts.hoverClass&&(b.removeClass(t._overBtn,t._opts.hoverClass),b.removeClass(t._overBtn,t._opts.focusClass))}),""!==t._opts.focusClass&&(this._input.focusOff=b.addEvent(this._input,"focus",function(){b.addClass(t._overBtn,t._opts.focusClass)}),this._input.blurOff=b.addEvent(this._input,"blur",function(){b.removeClass(t._overBtn,t._opts.focusClass)})),s.appendChild(this._input),t._opts.relativeToParent?(e=getComputedStyle(t._parentElement).position,g.console.log(e),"fixed"===e&&"absolute"===e||(t._parentElement.style.position="relative"),t._parentElement.appendChild(s)):document.body.appendChild(s),s=null},_last:function(e,t,s,n,i,o,r,a,u){"use strict";if(e&&(e.innerHTML=""),s&&(s.innerHTML=""),n&&i&&b.remove(n),t&&b.remove(t),this._active--,e=t=s=n=i=null,this._disabled&&this.enable(!0),this._destroy&&0===this._queue.length&&0===this._active)for(var l in this)this.hasOwnProperty(l)&&delete this[l];else this._opts.onDone.call(this,o.name,a,r,u,o.btn,o.size),this._cycleQueue(),0===this._queue.length&&0===this._active&&this._opts.onAllDone.call(this);o=r=a=u=null},_errorFinish:function(e,t,s,n,i,o,r,a,u,l){"use strict";this.log("Upload failed: "+t+" "+s),this._opts.onError.call(this,e.name,i,t,s,n,e.btn,e.size),this._last(r,o,a,u,l,e,"error",t,n),s=i=r=o=a=u=l=null},_finish:function(e,t,s,n,i,o,r,a,u){"use strict";this.log("Server response: "+n),"json"!=this._opts.responseType.toLowerCase()||!1!==(n=b.parseJSON(n))?(this._opts.onComplete.call(this,e.name,n,e.btn,e.size),this._last(i,o,r,a,u,e,"success",t,n),s=i=o=r=a=u=null):this._errorFinish(e,t,s,!1,"parseerror",o,i,a,u)},_checkFile:function(e){"use strict";var t=!1,s=this._opts.allowedExtensions.length;if(0<s){for(;s--;)if(this._opts.allowedExtensions[s].toLowerCase()==e.ext.toLowerCase()){t=!0;break}if(!t)return this.removeCurrent(e.id),this.log("File extension not permitted"),this._opts.onExtError.call(this,e.name,e.ext),!1}return e.size&&!1!==this._opts.maxSize&&e.size>this._opts.maxSize?(this.removeCurrent(e.id),this.log(e.name+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,e.name,e.size),!1):!(e=null)},_killInput:function(){"use strict";this._input&&(this._input.turnOff&&this._input.turnOff(),this._input.focusOff&&this._input.focusOff(),this._input.blurOff&&this._input.blurOff(),this._input.parentNode.mouseOverOff&&this._input.parentNode.mouseOverOff(),b.remove(this._input.parentNode),delete this._input,this._input=null)},_cycleQueue:function(){"use strict";0<this._queue.length&&this._opts.autoSubmit&&this.submit(void 0,!0)},_validateForm:function(){"use strict";return!(this._form.checkValidity&&!this._form.checkValidity())}}),n?b.extendObj(b.SimpleUpload.prototype,b.XhrUpload):b.extendObj(b.SimpleUpload.prototype,b.IframeUpload),b.extendObj(b.SimpleUpload.prototype,b.DragAndDrop),b});