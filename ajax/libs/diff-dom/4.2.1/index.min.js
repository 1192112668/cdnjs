"use strict";function e(t,o,n){var s;return"#text"===t.nodeName?s=n.document.createTextNode(t.data):"#comment"===t.nodeName?s=n.document.createComment(t.data):(o?s=n.document.createElementNS("http://www.w3.org/2000/svg",t.nodeName):"svg"===t.nodeName.toLowerCase()?(s=n.document.createElementNS("http://www.w3.org/2000/svg","svg"),o=!0):s=n.document.createElement(t.nodeName),t.attributes&&Object.entries(t.attributes).forEach(function(e){var t=e[0],o=e[1];return s.setAttribute(t,o)}),t.childNodes&&t.childNodes.forEach(function(t){return s.appendChild(e(t,o,n))}),n.valueDiffing&&(t.value&&(s.value=t.value),t.checked&&(s.checked=t.checked),t.selected&&(s.selected=t.selected))),s}function t(e,t){for(t=t.slice();0<t.length;){if(!e.childNodes)return!1;var o=t.splice(0,1)[0];e=e.childNodes[o]}return e}function o(o,n,s){var i,a,l,c,r=t(o,n[s._const.route]),u={diff:n,node:r};if(s.preDiffApply(u))return!0;switch(n[s._const.action]){case s._const.addAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(n[s._const.name],n[s._const.value]);break;case s._const.modifyAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(n[s._const.name],n[s._const.newValue]),"INPUT"===r.nodeName&&"value"===n[s._const.name]&&(r.value=n[s._const.newValue]);break;case s._const.removeAttribute:if(!r||!r.removeAttribute)return!1;r.removeAttribute(n[s._const.name]);break;case s._const.modifyTextElement:if(!r||3!==r.nodeType)return!1;s.textDiff(r,r.data,n[s._const.oldValue],n[s._const.newValue]);break;case s._const.modifyValue:if(!r||void 0===r.value)return!1;r.value=n[s._const.newValue];break;case s._const.modifyComment:if(!r||void 0===r.data)return!1;s.textDiff(r,r.data,n[s._const.oldValue],n[s._const.newValue]);break;case s._const.modifyChecked:if(!r||void 0===r.checked)return!1;r.checked=n[s._const.newValue];break;case s._const.modifySelected:if(!r||void 0===r.selected)return!1;r.selected=n[s._const.newValue];break;case s._const.replaceElement:r.parentNode.replaceChild(e(n[s._const.newValue],"http://www.w3.org/2000/svg"===r.namespaceURI,s),r);break;case s._const.relocateGroup:Array.apply(void 0,new Array(n.groupLength)).map(function(){return r.removeChild(r.childNodes[n[s._const.from]])}).forEach(function(e,t){0===t&&(a=r.childNodes[n[s._const.to]]),r.insertBefore(e,a||null)});break;case s._const.removeElement:r.parentNode.removeChild(r);break;case s._const.addElement:c=(l=n[s._const.route].slice()).splice(l.length-1,1)[0],(r=t(o,l)).insertBefore(e(n[s._const.element],"http://www.w3.org/2000/svg"===r.namespaceURI,s),r.childNodes[c]||null);break;case s._const.removeTextElement:if(!r||3!==r.nodeType)return!1;r.parentNode.removeChild(r);break;case s._const.addTextElement:if(c=(l=n[s._const.route].slice()).splice(l.length-1,1)[0],i=s.document.createTextNode(n[s._const.value]),!(r=t(o,l))||!r.childNodes)return!1;r.insertBefore(i,r.childNodes[c]||null);break;default:console.log("unknown action")}return u.newNode=i,s.postDiffApply(u),!0}function n(e,t,o){var n=e[t];e[t]=e[o],e[o]=n}function s(t,e,s){e.length||(e=[e]),(e=e.slice()).reverse(),e.forEach(function(e){!function(e,t,s){switch(t[s._const.action]){case s._const.addAttribute:t[s._const.action]=s._const.removeAttribute,o(e,t,s);break;case s._const.modifyAttribute:n(t,s._const.oldValue,s._const.newValue),o(e,t,s);break;case s._const.removeAttribute:t[s._const.action]=s._const.addAttribute,o(e,t,s);break;case s._const.modifyTextElement:case s._const.modifyValue:case s._const.modifyComment:case s._const.modifyChecked:case s._const.modifySelected:case s._const.replaceElement:n(t,s._const.oldValue,s._const.newValue),o(e,t,s);break;case s._const.relocateGroup:n(t,s._const.from,s._const.to),o(e,t,s);break;case s._const.removeElement:t[s._const.action]=s._const.addElement,o(e,t,s);break;case s._const.addElement:t[s._const.action]=s._const.removeElement,o(e,t,s);break;case s._const.removeTextElement:t[s._const.action]=s._const.addTextElement,o(e,t,s);break;case s._const.addTextElement:t[s._const.action]=s._const.removeTextElement,o(e,t,s);break;default:console.log("unknown action")}}(t,e,s)})}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(e){var n=this;void 0===e&&(e={}),Object.entries(e).forEach(function(e){var t=e[0],o=e[1];return n[t]=o})};function a(e){var t=[];return t.push(e.nodeName),"#text"!==e.nodeName&&"#comment"!==e.nodeName&&e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id)),t}function l(e){var o={},n={};return e.forEach(function(e){a(e).forEach(function(e){var t=e in o;t||e in n?t&&(delete o[e],n[e]=!0):o[e]=!0})}),o}function c(e,t){var o=l(e),n=l(t),s={};return Object.keys(o).forEach(function(e){n[e]&&(s[e]=!0)}),s}function r(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(r)}function u(t,o){if(!["nodeName","value","checked","selected","data"].every(function(e){return t[e]===o[e]}))return!1;if(Boolean(t.attributes)!==Boolean(o.attributes))return!1;if(Boolean(t.childNodes)!==Boolean(o.childNodes))return!1;if(t.attributes){var e=Object.keys(t.attributes),n=Object.keys(o.attributes);if(e.length!==n.length)return!1;if(!e.every(function(e){return t.attributes[e]===o.attributes[e]}))return!1}if(t.childNodes){if(t.childNodes.length!==o.childNodes.length)return!1;if(!t.childNodes.every(function(e,t){return u(e,o.childNodes[t])}))return!1}return!0}function d(e,t,o,n,s){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!s||e.data===t.data;if(e.nodeName in o)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(e.nodeName+"#"+e.attributes.id in o)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class&&e.nodeName+"."+e.attributes.class.replace(/ /g,".")in o)return!0}if(n)return!0;var i=e.childNodes?e.childNodes.slice().reverse():[],a=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==a.length)return!1;if(s)return i.every(function(e,t){return e.nodeName===a[t].nodeName});var l=c(i,a);return i.every(function(e,t){return d(e,a[t],l,!0,!0)})}function h(e){return JSON.parse(JSON.stringify(e))}function f(e,s,t,o){var n=0,i=[],l=e.length,r=s.length,u=Array.apply(void 0,new Array(l+1)).map(function(){return[]}),h=c(e,s),f=l===r;f&&e.some(function(e,t){var o=a(e),n=a(s[t]);return o.length!==n.length?!(f=!1):(o.some(function(e,t){if(e!==n[t])return!(f=!1)}),!f||void 0)});for(var p=0;p<l;p++)for(var m=e[p],_=0;_<r;_++){var V=s[_];t[p]||o[_]||!d(m,V,h,f)?u[p+1][_+1]=0:(u[p+1][_+1]=u[p][_]?u[p][_]+1:1,u[p+1][_+1]>=n&&(n=u[p+1][_+1],i=[p+1,_+1]))}return 0!==n&&{oldValue:i[0]-n,newValue:i[1]-n,length:n}}function p(e,t){return Array.apply(void 0,new Array(e)).map(function(){return t})}i.prototype.toString=function(){return JSON.stringify(this)},i.prototype.setValue=function(e,t){return this[e]=t,this};var m=function(){this.list=[]};function _(e,t){var o,n,s=e;for(t=t.slice();0<t.length;){if(!s.childNodes)return!1;n=t.splice(0,1)[0],s=(o=s).childNodes[n]}return{node:s,parentNode:o,nodeIndex:n}}function V(t,e,o){return e.forEach(function(e){!function(e,n,s){var t,o,i,a=_(e,n[s._const.route]),l=a.node,c=a.parentNode,r=a.nodeIndex,u=[],d={diff:n,node:l};if(s.preVirtualDiffApply(d))return;switch(n[s._const.action]){case s._const.addAttribute:l.attributes||(l.attributes={}),l.attributes[n[s._const.name]]=n[s._const.value],"checked"===n[s._const.name]?l.checked=!0:"selected"===n[s._const.name]?l.selected=!0:"INPUT"===l.nodeName&&"value"===n[s._const.name]&&(l.value=n[s._const.value]);break;case s._const.modifyAttribute:l.attributes[n[s._const.name]]=n[s._const.newValue];break;case s._const.removeAttribute:delete l.attributes[n[s._const.name]],0===Object.keys(l.attributes).length&&delete l.attributes,"checked"===n[s._const.name]?l.checked=!1:"selected"===n[s._const.name]?delete l.selected:"INPUT"===l.nodeName&&"value"===n[s._const.name]&&delete l.value;break;case s._const.modifyTextElement:l.data=n[s._const.newValue];break;case s._const.modifyValue:l.value=n[s._const.newValue];break;case s._const.modifyComment:l.data=n[s._const.newValue];break;case s._const.modifyChecked:l.checked=n[s._const.newValue];break;case s._const.modifySelected:l.selected=n[s._const.newValue];break;case s._const.replaceElement:(t=h(n[s._const.newValue])).outerDone=!0,t.innerDone=!0,t.valueDone=!0,c.childNodes[r]=t;break;case s._const.relocateGroup:l.childNodes.splice(n[s._const.from],n.groupLength).reverse().forEach(function(e){return l.childNodes.splice(n[s._const.to],0,e)}),l.subsets&&l.subsets.forEach(function(e){var t,o;n[s._const.from]<n[s._const.to]&&e.oldValue<=n[s._const.to]&&e.oldValue>n[s._const.from]?(e.oldValue-=n.groupLength,0<(t=e.oldValue+e.length-n[s._const.to])&&(u.push({oldValue:n[s._const.to]+n.groupLength,newValue:e.newValue+e.length-t,length:t}),e.length-=t)):n[s._const.from]>n[s._const.to]&&e.oldValue>n[s._const.to]&&e.oldValue<n[s._const.from]?(e.oldValue+=n.groupLength,0<(o=e.oldValue+e.length-n[s._const.to])&&(u.push({oldValue:n[s._const.to]+n.groupLength,newValue:e.newValue+e.length-o,length:o}),e.length-=o)):e.oldValue===n[s._const.from]&&(e.oldValue=n[s._const.to])});break;case s._const.removeElement:c.childNodes.splice(r,1),c.subsets&&c.subsets.forEach(function(e){e.oldValue>r?--e.oldValue:e.oldValue===r?e.delete=!0:e.oldValue<r&&e.oldValue+e.length>r&&(e.oldValue+e.length-1===r?e.length--:(u.push({newValue:e.newValue+r-e.oldValue,oldValue:r,length:e.length-r+e.oldValue-1}),e.length=r-e.oldValue))}),l=c;break;case s._const.addElement:o=n[s._const.route].slice(),i=o.splice(o.length-1,1)[0],l=_(e,o).node,(t=h(n[s._const.element])).outerDone=!0,t.innerDone=!0,t.valueDone=!0,l.childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(t):l.childNodes.splice(i,0,t),l.subsets&&l.subsets.forEach(function(e){var t;e.oldValue>=i?e.oldValue+=1:e.oldValue<i&&e.oldValue+e.length>i&&(t=e.oldValue+e.length-i,u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t)});break;case s._const.removeTextElement:c.childNodes.splice(r,1),"TEXTAREA"===c.nodeName&&delete c.value,c.subsets&&c.subsets.forEach(function(e){e.oldValue>r?--e.oldValue:e.oldValue===r?e.delete=!0:e.oldValue<r&&e.oldValue+e.length>r&&(e.oldValue+e.length-1===r?e.length--:(u.push({newValue:e.newValue+r-e.oldValue,oldValue:r,length:e.length-r+e.oldValue-1}),e.length=r-e.oldValue))}),l=c;break;case s._const.addTextElement:o=n[s._const.route].slice(),i=o.splice(o.length-1,1)[0],(t={}).nodeName="#text",t.data=n[s._const.value],(l=_(e,o).node).childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(t):l.childNodes.splice(i,0,t),"TEXTAREA"===l.nodeName&&(l.value=n[s._const.newValue]),l.subsets&&l.subsets.forEach(function(e){var t;e.oldValue>=i&&(e.oldValue+=1),e.oldValue<i&&e.oldValue+e.length>i&&(t=e.oldValue+e.length-i,u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t)});break;default:console.log("unknown action")}l.subsets&&(l.subsets=l.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),u.length&&(l.subsets=l.subsets.concat(u))),d.newNode=t,s.postVirtualDiffApply(d)}(t,e,o)}),!0}function g(e,t){void 0===t&&(t={});var o={};return o.nodeName=e.nodeName,"#text"===o.nodeName||"#comment"===o.nodeName?o.data=e.data:(e.attributes&&0<e.attributes.length&&(o.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){return o.attributes[e.name]=e.value})),"TEXTAREA"===o.nodeName?o.value=e.value:e.childNodes&&0<e.childNodes.length&&(o.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){return o.childNodes.push(g(e,t))})),t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?o.checked=e.checked:void 0!==e.value&&(o.value=e.value),void 0!==e.selected&&(o.selected=e.selected))),o}m.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},m.prototype.forEach=function(t){this.list.forEach(function(e){return t(e)})};var v=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,N=Object.create?Object.create(null):{},b=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function w(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}var y={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function E(e){var t={nodeName:"",attributes:{}},o=e.match(/<\/?([^\s]+?)[/\s>]/);if(o&&(t.nodeName=o[1].toUpperCase(),!y[o[1].toLowerCase()]&&"/"!==e.charAt(e.length-2)||(t.voidElement=!0),t.nodeName.startsWith("!--"))){var n=e.indexOf("--\x3e");return{type:"comment",data:-1!==n?e.slice(4,n):""}}for(var s,i,a=new RegExp(b),l=null,c=!1;!c;){null===(l=a.exec(e))?c=!0:l[0].trim()&&(l[1]?(i=[s=l[1].trim(),""],-1<s.indexOf("=")&&(i=s.split("=")),t.attributes[i[0]]=i[1],a.lastIndex--):l[2]&&(t.attributes[l[2]]=l[3].trim().substring(1,l[3].length-1)))}return t}function k(e){return function e(t){return delete t.voidElement,t.childNodes&&t.childNodes.forEach(e),t}(function(u,d){void 0===d&&(d={components:N});var h,f=[],p=-1,m=[],_=!1;return u.replace(v,function(e,t){if(_){if(e!=="</"+h.nodeName+">")return;_=!1}var o,n,s,i="/"!==e.charAt(1),a=e.startsWith("\x3c!--"),l=t+e.length,c=u.charAt(l);if(a){var r=E(e);return p<0?f.push(r):(o=m[p])&&(o.childNodes||(o.childNodes=[]),o.childNodes.push(r)),f}i&&(h=E(e),p++,"tag"===h.type&&d.components[h.nodeName]&&(h.type="component",_=!0),h.voidElement||_||!c||"<"===c||(h.childNodes||(h.childNodes=[]),h.childNodes.push({nodeName:"#text",data:w(u.slice(l,u.indexOf("<",l)))})),0===p&&f.push(h),(o=m[p-1])&&(o.childNodes||(o.childNodes=[]),o.childNodes.push(h)),m[p]=h),i&&!h.voidElement||(p--,_||"<"===c||!c)||(o=-1===p?f:m[p].childNodes||[],n=u.indexOf("<",l),s=w(u.slice(l,-1===n?void 0:n)),o.push({nodeName:"#text",data:s}))}),f[0]}(e))}var x=function(e,t,o){this.options=o,this.t1=e instanceof HTMLElement?g(e,this.options):"string"==typeof e?k(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=t instanceof HTMLElement?g(t,this.options):"string"==typeof t?k(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=g(e,this.options),this.t2Orig=g(t,this.options)),this.tracker=new m};x.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},x.prototype.findDiffs=function(e,t){var o;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));0===(o=this.findNextDiff(e,t,[])).length&&(u(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,r(e),o=this.findNextDiff(e,t,[])))),0<o.length&&(this.foundAll=!1,this.tracker.add(o),V(e,o,this.options))}while(0<o.length);return this.tracker.list},x.prototype.findNextDiff=function(e,t,o){var n,s;if(this.options.maxDepth&&o.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,o),this.options.filterOuterDiff&&(s=this.options.filterOuterDiff(e,t,n))&&(n=s),0<n.length)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if(0<(n=this.findInnerDiff(e,t,o)).length)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if(0<(n=this.findValueDiff(e,t,o)).length)return e.valueDone=!0,n;e.valueDone=!0}return[]},x.prototype.findOuterDiff=function(e,t,o){var n,s,a,l,c,r,u=[];if(e.nodeName!==t.nodeName){if(!o.length)throw new Error("Top level nodes have to be of the same kind.");return[(new i).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(e)).setValue(this.options._const.newValue,h(t)).setValue(this.options._const.route,o)]}if(o.length&&this.options.maxNodeDiffCount<Math.abs((e.childNodes||[]).length-(t.childNodes||[]).length))return[(new i).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(e)).setValue(this.options._const.newValue,h(t)).setValue(this.options._const.route,o)];if(e.data!==t.data)return"#text"===e.nodeName?[(new i).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[(new i).setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(s=e.attributes?Object.keys(e.attributes).sort():[],a=t.attributes?Object.keys(t.attributes).sort():[],l=s.length,r=0;r<l;r++)n=s[r],-1===(c=a.indexOf(n))?u.push((new i).setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,e.attributes[n])):(a.splice(c,1),e.attributes[n]!==t.attributes[n]&&u.push((new i).setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.oldValue,e.attributes[n]).setValue(this.options._const.newValue,t.attributes[n])));for(l=a.length,r=0;r<l;r++)n=a[r],u.push((new i).setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,t.attributes[n]));return u},x.prototype.findInnerDiff=function(e,c,t){var o=e.childNodes?e.childNodes.slice():[],n=c.childNodes?c.childNodes.slice():[],s=Math.max(o.length,n.length),a=Math.abs(o.length-n.length),l=[],r=0;if(!this.options.maxChildCount||s<this.options.maxChildCount){var d=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&c.childNodes?function(e){for(var t=e.childNodes?e.childNodes:[],o=c.childNodes?c.childNodes:[],n=p(t.length,!1),s=p(o.length,!1),i=[],a=!0,l=function(){return arguments[1]};a;)(a=f(t,o,n,s))&&(i.push(a),Array.apply(void 0,new Array(a.length)).map(l).forEach(function(e){return t=e,n[a.oldValue+t]=!0,void(s[a.newValue+t]=!0);var t}));return e.subsets=i,e.subsetsAge=100,i}(e):[];if(0<d.length&&0<(l=this.attemptGroupRelocation(e,c,d,t)).length)return l}for(var m=0;m<s;m+=1){var _=o[m],V=n[m];a&&(_&&!V?("#text"===_.nodeName?l.push((new i).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,t.concat(r)).setValue(this.options._const.value,_.data)):l.push((new i).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,t.concat(r)).setValue(this.options._const.element,h(_))),--r):V&&!_&&("#text"===V.nodeName?l.push((new i).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,t.concat(r)).setValue(this.options._const.value,V.data)):l.push((new i).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,t.concat(r)).setValue(this.options._const.element,h(V))))),_&&V&&(!this.options.maxChildCount||s<this.options.maxChildCount?l=l.concat(this.findNextDiff(_,V,t.concat(r))):u(_,V)||(o.length>n.length?(l=l.concat([(new i).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,h(_)).setValue(this.options._const.route,t.concat(r))]),o.splice(m,1),--r,--a):o.length<n.length?(l=l.concat([(new i).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,h(V)).setValue(this.options._const.route,t.concat(r))]),o.splice(m,0,{}),--a):l=l.concat([(new i).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(_)).setValue(this.options._const.newValue,h(V)).setValue(this.options._const.route,t.concat(r))]))),r+=1}return e.innerDone=!0,l},x.prototype.attemptGroupRelocation=function(e,t,o,n){for(var s,a,l,c,r,u,f,m,_,V,g,v=(f=t,m=o,_=e.childNodes?p(e.childNodes.length,!0):[],V=f.childNodes?p(f.childNodes.length,!0):[],g=0,m.forEach(function(e){for(var t=e.oldValue+e.length,o=e.newValue+e.length,n=e.oldValue;n<t;n+=1)_[n]=g;for(var s=e.newValue;s<o;s+=1)V[s]=g;g+=1}),{gaps1:_,gaps2:V}),N=v.gaps1,b=v.gaps2,w=Math.min(N.length,b.length),y=[],E=0,k=0;E<w;k+=1,E+=1)if(!0===N[E])if("#text"===(c=e.childNodes[k]).nodeName)if("#text"===t.childNodes[E].nodeName){if(c.data!==t.childNodes[E].data){for(u=k;e.childNodes.length>u+1&&"#text"===e.childNodes[u+1].nodeName;)if(u+=1,t.childNodes[E].data===e.childNodes[u].data){r=!0;break}if(!r)return y.push((new i).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n.concat(E)).setValue(this.options._const.oldValue,c.data).setValue(this.options._const.newValue,t.childNodes[E].data)),y}}else y.push((new i).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,n.concat(E)).setValue(this.options._const.value,c.data)),N.splice(E,1),w=Math.min(N.length,b.length),--E;else y.push((new i).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,n.concat(E)).setValue(this.options._const.element,h(c))),N.splice(E,1),w=Math.min(N.length,b.length),--E;else if(!0===b[E])w=("#text"===(c=t.childNodes[E]).nodeName?y.push((new i).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,n.concat(E)).setValue(this.options._const.value,c.data)):y.push((new i).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,n.concat(E)).setValue(this.options._const.element,h(c))),N.splice(E,0,!0),Math.min(N.length,b.length)),--k;else if(N[E]!==b[E]){if(0<y.length)return y;if(l=o[N[E]],(a=Math.min(l.newValue,e.childNodes.length-l.length))!==l.oldValue){s=!1;for(var x=0;x<l.length;x+=1)d(e.childNodes[a+x],e.childNodes[l.oldValue+x],[],!1,!0)||(s=!0);if(s)return[(new i).setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",l.length).setValue(this.options._const.from,l.oldValue).setValue(this.options._const.to,a).setValue(this.options._const.route,n)]}}return y};var A={debug:!(x.prototype.findValueDiff=function(e,t,o){var n=[];return e.selected!==t.selected&&n.push((new i).setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,o)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&n.push((new i).setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,o)),e.checked!==t.checked&&n.push((new i).setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,o)),n}),diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(e,t,o,n){e.data=n},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(!window||!window.document)&&window.document},D=function(e){var t,n=this;void 0===e&&(e={}),this.options=e,Object.entries(A).forEach(function(e){var t=e[0],o=e[1];Object.prototype.hasOwnProperty.call(n.options,t)||(n.options[t]=o)}),this.options._const||(t=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"],this.options._const={},this.options.compress?t.forEach(function(e,t){return n.options._const[e]=t}):t.forEach(function(e){return n.options._const[e]=e})),this.DiffFinder=x};D.prototype.apply=function(e,t){return n=e,s=this.options,t.every(function(e){return o(n,e,s)});var n,s},D.prototype.undo=function(e,t){return s(e,t,this.options)},D.prototype.diff=function(e,t){return new this.DiffFinder(e,t,this.options).init()};var O=function(e){var a=this;void 0===e&&(e={}),this.pad="│   ",this.padding="",this.tick=1,this.messages=[];function t(n,s){var i=n[s];n[s]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];a.fin(s,Array.prototype.slice.call(e));var o=i.apply(n,e);return a.fout(s,o),o}}for(var o in e)"function"==typeof e[o]&&t(e,o);this.log("┌ TRACELOG START")};O.prototype.fin=function(e,t){this.padding+=this.pad,this.log("├─> entering "+e,t)},O.prototype.fout=function(e,t){this.log("│<──┘ generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},O.prototype.format=function(e,t){return function(e){for(e=""+e;e.length<4;)e="0"+e;return e}(t)+"> "+this.padding+e},O.prototype.log=function(){var e=Array.prototype.slice.call(arguments),t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?"["+e.map(t).join(",")+"]":e.toString()||e.valueOf()||"<unknown>":"<falsey>"},e=e.map(t).join(", ");this.messages.push(this.format(e,this.tick++))},O.prototype.toString=function(){for(var e="└───";e.length<=this.padding.length+this.pad.length;)e+="×   ";var t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,this.messages.join("\n")+"\n"+e},exports.DiffDOM=D,exports.TraceLogger=O,exports.nodeToObj=g,exports.stringToObj=k;