"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BodyRow=void 0;var _react=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_BodyCell=require("./BodyCell"),_DomHandler=_interopRequireDefault(require("../utils/DomHandler"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var o,n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e){Object.prototype.hasOwnProperty.call(e,i)&&((o=r?Object.getOwnPropertyDescriptor(e,i):null)&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i])}return n.default=e,t&&t.set(e,n),n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function ownKeys(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(o){return function(){var e,t=_getPrototypeOf(o);return _possibleConstructorReturn(this,_isNativeReflectConstruct()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var BodyRow=function(){_inherits(n,_react.Component);var o=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=o.call(this,e)).state={editing:!1},t.onClick=t.onClick.bind(_assertThisInitialized(t)),t.onDoubleClick=t.onDoubleClick.bind(_assertThisInitialized(t)),t.onTouchEnd=t.onTouchEnd.bind(_assertThisInitialized(t)),t.onRightClick=t.onRightClick.bind(_assertThisInitialized(t)),t.onMouseDown=t.onMouseDown.bind(_assertThisInitialized(t)),t.onDragEnd=t.onDragEnd.bind(_assertThisInitialized(t)),t.onDragOver=t.onDragOver.bind(_assertThisInitialized(t)),t.onDragLeave=t.onDragLeave.bind(_assertThisInitialized(t)),t.onDrop=t.onDrop.bind(_assertThisInitialized(t)),t.onKeyDown=t.onKeyDown.bind(_assertThisInitialized(t)),t.onRowEditInit=t.onRowEditInit.bind(_assertThisInitialized(t)),t.onRowEditSave=t.onRowEditSave.bind(_assertThisInitialized(t)),t.onRowEditCancel=t.onRowEditCancel.bind(_assertThisInitialized(t)),t}return _createClass(n,[{key:"onClick",value:function(e){this.props.onClick&&this.props.onClick({originalEvent:e,data:this.props.rowData,index:this.props.rowIndex})}},{key:"onDoubleClick",value:function(e){this.props.onDoubleClick&&this.props.onDoubleClick({originalEvent:e,data:this.props.rowData,index:this.props.rowIndex})}},{key:"onTouchEnd",value:function(e){this.props.onTouchEnd&&this.props.onTouchEnd(e)}},{key:"onRightClick",value:function(e){this.props.onRightClick&&this.props.onRightClick({originalEvent:e,data:this.props.rowData,index:this.props.rowIndex})}},{key:"onMouseDown",value:function(e){_DomHandler.default.hasClass(e.target,"p-table-reorderablerow-handle")?e.currentTarget.draggable=!0:e.currentTarget.draggable=!1}},{key:"onDragEnd",value:function(e){this.props.onDragEnd&&this.props.onDragEnd(e),e.currentTarget.draggable=!1}},{key:"onDragOver",value:function(e){this.props.onDragOver&&this.props.onDragOver({originalEvent:e,rowElement:this.container}),e.preventDefault()}},{key:"onDragLeave",value:function(e){this.props.onDragLeave&&this.props.onDragLeave({originalEvent:e,rowElement:this.container})}},{key:"onDrop",value:function(e){this.props.onDrop&&this.props.onDrop({originalEvent:e,rowElement:this.container}),e.preventDefault()}},{key:"onKeyDown",value:function(e){if(this.props.selectionMode){var t=e.target;switch(e.which){case 40:var o=this.findNextSelectableRow(t);o&&o.focus(),e.preventDefault();break;case 38:var n=this.findPrevSelectableRow(t);n&&n.focus(),e.preventDefault();break;case 13:this.onClick(e)}}}},{key:"findNextSelectableRow",value:function(e){var t=e.nextElementSibling;return t?_DomHandler.default.hasClass(t,"p-datatable-row")?t:this.findNextSelectableRow(t):null}},{key:"findPrevSelectableRow",value:function(e){var t=e.previousElementSibling;return t?_DomHandler.default.hasClass(t,"p-datatable-row")?t:this.findPrevSelectableRow(t):null}},{key:"onRowEditInit",value:function(e){this.props.onRowEditInit&&this.props.onRowEditInit({originalEvent:e,data:this.props.rowData}),this.setState({editing:!0}),e.preventDefault()}},{key:"onRowEditSave",value:function(e){var t=!0;this.props.rowEditorValidator&&(t=this.props.rowEditorValidator(this.props.rowData)),this.props.onRowEditSave&&this.props.onRowEditSave({originalEvent:e,data:this.props.rowData}),this.setState({editing:!t}),e.preventDefault()}},{key:"onRowEditCancel",value:function(e){this.props.onRowEditCancel&&this.props.onRowEditCancel({originalEvent:e,data:this.props.rowData,index:this.props.rowIndex}),this.setState({editing:!1}),e.preventDefault()}},{key:"render",value:function(){var t=this,e=_react.default.Children.toArray(this.props.children),o={"p-highlight":this.props.selected,"p-highlight-contextmenu":this.props.contextMenuSelected};this.props.rowClassName&&(o=_objectSpread({},o,{},this.props.rowClassName(this.props.rowData)));for(var n=(0,_classnames.default)("p-datatable-row",o),r=this.props.virtualScroll?{height:this.props.virtualRowHeight}:{},i="rowspan"===this.props.rowGroupMode,a=[],s=0;s<e.length;s++){var l=e[s],p=void 0;if(i&&this.props.sortField===l.props.field){if(!this.props.groupRowSpan)continue;p=this.props.groupRowSpan,n+=" p-datatable-rowspan-group"}var c=_react.default.createElement(_BodyCell.BodyCell,_extends({key:s},l.props,{value:this.props.value,rowSpan:p,rowData:this.props.rowData,rowIndex:this.props.rowIndex,onRowToggle:this.props.onRowToggle,expanded:this.props.expanded,onRadioClick:this.props.onRadioClick,onCheckboxClick:this.props.onCheckboxClick,responsive:this.props.responsive,selected:this.props.selected,editMode:this.props.editMode,editing:this.state.editing,onRowEditInit:this.onRowEditInit,onRowEditSave:this.onRowEditSave,onRowEditCancel:this.onRowEditCancel,showRowReorderElement:this.props.showRowReorderElement,showSelectionElement:this.props.showSelectionElement}));a.push(c)}return _react.default.createElement("tr",{tabIndex:this.props.selectionMode?"0":null,ref:function(e){t.container=e},className:n,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onTouchEnd:this.onTouchEnd,onContextMenu:this.onRightClick,onMouseDown:this.onMouseDown,onDragStart:this.props.onDragStart,onDragEnd:this.onDragEnd,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop,style:r,onKeyDown:this.onKeyDown},a)}}]),n}();exports.BodyRow=BodyRow;