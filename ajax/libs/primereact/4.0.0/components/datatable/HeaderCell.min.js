"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HeaderCell=void 0;var _react=_interopRequireWildcard(require("react")),_InputText=require("../inputtext/InputText"),_classnames=_interopRequireDefault(require("classnames")),_RowCheckbox=require("./RowCheckbox"),_DomHandler=_interopRequireDefault(require("../utils/DomHandler"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var o,n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){Object.prototype.hasOwnProperty.call(e,s)&&((o=n?Object.getOwnPropertyDescriptor(e,s):null)&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s])}}return r.default=e,t&&t.set(e,r),r}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var HeaderCell=function(){function r(e){var t;return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e))).state={badgeVisible:!1},t.onClick=t.onClick.bind(_assertThisInitialized(t)),t.onFilterInput=t.onFilterInput.bind(_assertThisInitialized(t)),t.onMouseDown=t.onMouseDown.bind(_assertThisInitialized(t)),t.onResizerMouseDown=t.onResizerMouseDown.bind(_assertThisInitialized(t)),t.onKeyDown=t.onKeyDown.bind(_assertThisInitialized(t)),t}return _inherits(r,_react.Component),_createClass(r,[{key:"onClick",value:function(e){var t;this.props.sortable&&(t=e.target,(_DomHandler.default.hasClass(t,"p-sortable-column")||_DomHandler.default.hasClass(t,"p-column-title")||_DomHandler.default.hasClass(t,"p-sortable-column-icon")||_DomHandler.default.hasClass(t.parentElement,"p-sortable-column-icon"))&&(this.props.onSort({originalEvent:e,sortField:this.props.columnSortField||this.props.field,sortFunction:this.props.sortFunction,sortable:this.props.sortable}),_DomHandler.default.clearSelection()))}},{key:"onFilterInput",value:function(e){var t,r=this;this.props.filter&&this.props.onFilter&&(this.filterTimeout&&clearTimeout(this.filterTimeout),t=e.target.value,this.filterTimeout=setTimeout(function(){r.props.onFilter({value:t,field:r.props.field,matchMode:r.props.filterMatchMode}),r.filterTimeout=null},this.filterDelay))}},{key:"onResizerMouseDown",value:function(e){this.props.resizableColumns&&this.props.onColumnResizeStart&&(this.props.onColumnResizeStart({originalEvent:e,columnEl:e.target.parentElement,columnProps:this.props}),e.preventDefault())}},{key:"onMouseDown",value:function(e){this.props.reorderableColumns&&("INPUT"!==e.target.nodeName?this.el.draggable=!0:"INPUT"===e.target.nodeName&&(this.el.draggable=!1))}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&e.currentTarget===this.el&&(this.onClick(e),e.preventDefault())}},{key:"getMultiSortMetaDataIndex",value:function(){if(this.props.multiSortMeta)for(var e=0;e<this.props.multiSortMeta.length;e++)if(this.props.multiSortMeta[e].field===this.props.field)return e;return-1}},{key:"getAriaSort",value:function(e,t){if(this.props.sortable){var r=e?t<0?"pi-sort-down":"pi-sort-up":"pi-sort";return"pi-sort-down"==r?"descending":"pi-sort-up"==r?"ascending":"none"}return null}},{key:"renderSortIcon",value:function(e,t){if(this.props.sortable){var r=e?t<0?"pi-sort-down":"pi-sort-up":"pi-sort",o=(0,_classnames.default)("p-sortable-column-icon pi pi-fw",r);return _react.default.createElement("span",{className:o})}return null}},{key:"renderSortBadge",value:function(e){return-1!==e&&this.state.badgeVisible?_react.default.createElement("span",{className:"p-sortable-column-badge"},e+1):null}},{key:"render",value:function(){var e,t,r=this,o=this.getMultiSortMetaDataIndex(),n=-1!==o?this.props.multiSortMeta[o]:null,s=this.props.field===this.props.sortField||null!=this.props.columnSortField&&this.props.columnSortField===this.props.sortField,i=null!==n,l=0,a=this.props.resizableColumns&&_react.default.createElement("span",{className:"p-column-resizer p-clickable",onMouseDown:this.onResizerMouseDown});s?l=this.props.sortOrder:i&&(l=n.order);var p=this.props.sortable&&(s||i),u=(0,_classnames.default)({"p-sortable-column":this.props.sortable,"p-highlight":p,"p-resizable-column":this.props.resizableColumns,"p-selection-column":this.props.selectionMode},this.props.headerClassName||this.props.className),c=this.renderSortIcon(p,l),f=this.getAriaSort(p,l),h=this.renderSortBadge(o);return this.props.filter&&(e=this.props.filterElement||_react.default.createElement(_InputText.InputText,{onInput:this.onFilterInput,type:this.props.filterType,defaultValue:this.props.filters&&this.props.filters[this.props.field]?this.props.filters[this.props.field].value:null,className:"p-column-filter",placeholder:this.props.filterPlaceholder,maxLength:this.props.filterMaxLength})),"multiple"===this.props.selectionMode&&(t=_react.default.createElement(_RowCheckbox.RowCheckbox,{onClick:this.props.onHeaderCheckboxClick,selected:this.props.headerCheckboxSelected,disabled:!this.props.value||0===this.props.value.length})),_react.default.createElement("th",{ref:function(e){return r.el=e},tabIndex:this.props.sortable?this.props.tabIndex:-1,className:u,style:this.props.headerStyle||this.props.style,onClick:this.onClick,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyDown,colSpan:this.props.colSpan,rowSpan:this.props.rowSpan,"aria-sort":f,onDragStart:this.props.onDragStart,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop},a,_react.default.createElement("span",{className:"p-column-title"},this.props.header),c,h,e,t)}}],[{key:"getDerivedStateFromProps",value:function(e){return{badgeVisible:e.multiSortMeta&&1<e.multiSortMeta.length}}}]),r}();exports.HeaderCell=HeaderCell;