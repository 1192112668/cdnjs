"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ListBox=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_classnames=_interopRequireDefault(require("classnames")),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_ListBoxItem=require("./ListBoxItem"),_ListBoxHeader=require("./ListBoxHeader"),_Tooltip=_interopRequireDefault(require("../tooltip/Tooltip"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var o={};if(null!=e){var i,r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e){Object.prototype.hasOwnProperty.call(e,l)&&((i=r?Object.getOwnPropertyDescriptor(e,l):null)&&(i.get||i.set)?Object.defineProperty(o,l,i):o[l]=e[l])}}return o.default=e,t&&t.set(e,o),o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var ListBox=function(){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).state={filter:""},e.onFilter=e.onFilter.bind(_assertThisInitialized(e)),e.onOptionClick=e.onOptionClick.bind(_assertThisInitialized(e)),e}return _inherits(t,_react.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(e){e.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"renderTooltip",value:function(){this.tooltip=new _Tooltip.default({target:this.element,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"onOptionClick",value:function(e){this.props.disabled||(this.props.multiple?this.onOptionClickMultiple(e.originalEvent,e.option):this.onOptionClickSingle(e.originalEvent,e.option),this.optionTouched=!1)}},{key:"onOptionTouchEnd",value:function(){this.props.disabled||(this.optionTouched=!0)}},{key:"onOptionClickSingle",value:function(e,t){var o,i=this.isSelected(t),r=!1,l=null;!this.optionTouched&&this.props.metaKeySelection?(o=e.metaKey||e.ctrlKey,i?o&&(r=!(l=null)):(l=this.getOptionValue(t),r=!0)):(l=i?null:this.getOptionValue(t),r=!0),r&&this.updateModel(e,l)}},{key:"onOptionClickMultiple",value:function(e,t){var o,i=this.isSelected(t),r=null;(r=!this.optionTouched&&this.props.metaKeySelection?(o=e.metaKey||e.ctrlKey,i?o?this.removeOption(t):[this.getOptionValue(t)]:(r=o&&this.props.value||[],[].concat(_toConsumableArray(r),[this.getOptionValue(t)]))):i?this.removeOption(t):[].concat(_toConsumableArray(this.props.value||[]),[this.getOptionValue(t)]),0)||this.props.onChange({originalEvent:e,value:r,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:r}})}},{key:"onFilter",value:function(e){this.setState({filter:e.query})}},{key:"updateModel",value:function(e,t){this.props.onChange&&this.props.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:t}})}},{key:"removeOption",value:function(t){var o=this;return this.props.value.filter(function(e){return!_ObjectUtils.default.equals(e,o.getOptionValue(t),o.props.dataKey)})}},{key:"isSelected",value:function(e){var t=!1,o=this.getOptionValue(e);if(this.props.multiple){if(this.props.value){var i=!0,r=!1,l=void 0;try{for(var n,p=this.props.value[Symbol.iterator]();!(i=(n=p.next()).done);i=!0){var a=n.value;if(_ObjectUtils.default.equals(a,o,this.props.dataKey)){t=!0;break}}}catch(e){r=!0,l=e}finally{try{i||null==p.return||p.return()}finally{if(r)throw l}}}}else t=_ObjectUtils.default.equals(this.props.value,o,this.props.dataKey);return t}},{key:"filter",value:function(e){var t=this.state.filter.trim().toLowerCase();return-1<this.getOptionLabel(e).toLowerCase().indexOf(t.toLowerCase())}},{key:"hasFilter",value:function(){return this.state.filter&&0<this.state.filter.trim().length}},{key:"getOptionLabel",value:function(e){return this.props.optionLabel?_ObjectUtils.default.resolveFieldData(e,this.props.optionLabel):void 0!==e.label?e.label:e}},{key:"getOptionValue",value:function(e){return this.props.optionValue?_ObjectUtils.default.resolveFieldData(e,this.props.optionValue):void 0!==e.value?e.value:e}},{key:"render",value:function(){var e,t,o,i=this,r=(0,_classnames.default)("p-listbox p-inputtext p-component",this.props.className,{"p-disabled":this.props.disabled}),l=this.props.options;return this.props.options&&(this.hasFilter()&&(t=this.state.filter.trim().toLowerCase(),o=this.props.filterBy?this.props.filterBy.split(","):[this.props.optionLabel||"label"],l=_ObjectUtils.default.filter(l,o,t,this.props.filterMatchMode)),l=l.map(function(t,o){var e=i.getOptionLabel(t);return _react.default.createElement(_ListBoxItem.ListBoxItem,{key:e,label:e,option:t,template:i.props.itemTemplate,selected:i.isSelected(t),onClick:i.onOptionClick,onTouchEnd:function(e){return i.onOptionTouchEnd(e,t,o)},tabIndex:i.props.tabIndex})})),this.props.filter&&(e=_react.default.createElement(_ListBoxHeader.ListBoxHeader,{filter:this.state.filter,onFilter:this.onFilter,disabled:this.props.disabled,filterPlaceholder:this.props.filterPlaceholder})),_react.default.createElement("div",{ref:function(e){return i.element=e},id:this.props.id,className:r,style:this.props.style},e,_react.default.createElement("div",{className:"p-listbox-list-wrapper",style:this.props.listStyle},_react.default.createElement("ul",{className:"p-listbox-list",role:"listbox","aria-multiselectable":this.props.multiple},l)))}}]),t}();_defineProperty(exports.ListBox=ListBox,"defaultProps",{id:null,value:null,options:null,optionLabel:null,optionValue:null,itemTemplate:null,style:null,listStyle:null,className:null,disabled:null,dataKey:null,multiple:!1,metaKeySelection:!1,filter:!1,filterBy:null,filterMatchMode:"contains",filterPlaceholder:null,tabIndex:"0",tooltip:null,tooltipOptions:null,ariaLabelledBy:null,onChange:null}),_defineProperty(ListBox,"propTypes",{id:_propTypes.default.string,value:_propTypes.default.any,options:_propTypes.default.array,optionLabel:_propTypes.default.string,optionValue:_propTypes.default.string,itemTemplate:_propTypes.default.func,style:_propTypes.default.object,listStyle:_propTypes.default.object,className:_propTypes.default.string,dataKey:_propTypes.default.string,multiple:_propTypes.default.bool,metaKeySelection:_propTypes.default.bool,filter:_propTypes.default.bool,filterBy:_propTypes.default.string,filterMatchMode:_propTypes.default.string,filterPlaceholder:_propTypes.default.string,tabIndex:_propTypes.default.string,tooltip:_propTypes.default.string,tooltipOptions:_propTypes.default.object,ariaLabelledBy:_propTypes.default.string,onChange:_propTypes.default.func});