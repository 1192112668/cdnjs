"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BodyCell=void 0;var _react=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_RowRadioButton=require("./RowRadioButton"),_RowCheckbox=require("./RowCheckbox");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={};if(null!=e){var o,r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e){Object.prototype.hasOwnProperty.call(e,n)&&((o=r?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n])}}return i.default=e,t&&t.set(e,i),i}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var BodyCell=function(){function i(e){var t;return _classCallCheck(this,i),(t=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,e))).state={editing:t.props.editing},t.onExpanderClick=t.onExpanderClick.bind(_assertThisInitialized(t)),t.onClick=t.onClick.bind(_assertThisInitialized(t)),t.onBlur=t.onBlur.bind(_assertThisInitialized(t)),t.onKeyDown=t.onKeyDown.bind(_assertThisInitialized(t)),t.onEditorFocus=t.onEditorFocus.bind(_assertThisInitialized(t)),t}return _inherits(i,_react.Component),_createClass(i,[{key:"onExpanderClick",value:function(e){this.props.onRowToggle&&this.props.onRowToggle({originalEvent:e,data:this.props.rowData}),e.preventDefault()}},{key:"onKeyDown",value:function(e){"row"!==this.props.editMode&&(13!==e.which&&9!==e.which||this.switchCellToViewMode(!0),27===e.which&&this.switchCellToViewMode(!1))}},{key:"onClick",value:function(){"row"!==this.props.editMode&&(this.editingCellClick=!0,this.props.editor&&!this.state.editing&&(this.setState({editing:!0}),"click"===this.props.editorValidatorEvent&&this.bindDocumentEditListener()))}},{key:"onBlur",value:function(){"row"!==this.props.editMode&&this.state.editing&&"blur"===this.props.editorValidatorEvent&&this.switchCellToViewMode(!0)}},{key:"onEditorFocus",value:function(e){this.onClick(e)}},{key:"bindDocumentEditListener",value:function(){var t=this;this.documentEditListener||(this.documentEditListener=function(e){t.editingCellClick||t.switchCellToViewMode(!0),t.editingCellClick=!1},this.editingCellClick=!1,document.addEventListener("click",this.documentEditListener))}},{key:"closeCell",value:function(){this.setState({editing:!1}),this.unbindDocumentEditListener()}},{key:"switchCellToViewMode",value:function(e){this.props.editorValidator&&e?this.props.editorValidator(this.props)&&(this.props.onEditorSubmit&&this.props.onEditorSubmit(this.props),this.closeCell()):(e&&this.props.onEditorSubmit?this.props.onEditorSubmit(this.props):this.props.onEditorCancel&&this.props.onEditorCancel(this.props),this.closeCell())}},{key:"unbindDocumentEditListener",value:function(){this.documentEditListener&&(document.removeEventListener("click",this.documentEditListener),this.documentEditListener=null)}},{key:"componentDidUpdate",value:function(){var e,t=this;"row"!==this.props.editMode&&this.container&&this.props.editor&&(clearTimeout(this.tabindexTimeout),this.state.editing?((e=_DomHandler.default.findSingle(this.container,"input"))&&(e.setAttribute("data-isCellEditing",!0),e.focus()),this.keyHelper.tabIndex=-1):this.tabindexTimeout=setTimeout(function(){t.keyHelper&&t.keyHelper.setAttribute("tabindex",0)},50))}},{key:"componentWillUnmount",value:function(){this.unbindDocumentEditListener()}},{key:"render",value:function(){var e,t,i,o,r,n=this,s=(0,_classnames.default)(this.props.bodyClassName||this.props.className,{"p-selection-column":this.props.selectionMode,"p-editable-column":this.props.editor,"p-cell-editing":this.state.editing&&this.props.editor});return o=this.props.expander?(i=(0,_classnames.default)("p-row-toggler-icon pi pi-fw p-clickable",{"pi-chevron-down":this.props.expanded,"pi-chevron-right":!this.props.expanded}),_react.default.createElement("button",{onClick:this.onExpanderClick,className:"p-row-toggler p-link"},_react.default.createElement("span",{className:i}))):this.props.selectionMode?"single"===this.props.selectionMode?_react.default.createElement(_RowRadioButton.RowRadioButton,{onClick:this.props.onRadioClick,rowData:this.props.rowData,selected:this.props.selected}):_react.default.createElement(_RowCheckbox.RowCheckbox,{onClick:this.props.onCheckboxClick,rowData:this.props.rowData,selected:this.props.selected}):this.props.rowReorder?(r=(0,_classnames.default)("p-table-reorderablerow-handle",this.props.rowReorderIcon),_react.default.createElement("i",{className:r})):this.props.rowEditor?this.state.editing?_react.default.createElement(_react.default.Fragment,null,_react.default.createElement("button",{onClick:this.props.onRowEditSave,className:"p-row-editor-save p-link"},_react.default.createElement("span",{className:"p-row-editor-save-icon pi pi-fw pi-check p-clickable"})),_react.default.createElement("button",{onClick:this.props.onRowEditCancel,className:"p-row-editor-cancel p-link"},_react.default.createElement("span",{className:"p-row-editor-cancel-icon pi pi-fw pi-times p-clickable"}))):_react.default.createElement("button",{onClick:this.props.onRowEditInit,className:"p-row-editor-init p-link"},_react.default.createElement("span",{className:"p-row-editor-init-icon pi pi-fw pi-pencil p-clickable"})):this.state.editing&&this.props.editor?this.props.editor(this.props):this.props.body?this.props.body(this.props.rowData,this.props):_ObjectUtils.default.resolveFieldData(this.props.rowData,this.props.field),this.props.responsive&&(e=_react.default.createElement("span",{className:"p-column-title"},this.props.header)),"row"!==this.props.editMode&&(t=this.props.editor&&_react.default.createElement("a",{tabIndex:"0",ref:function(e){n.keyHelper=e},className:"p-cell-editor-key-helper p-hidden-accessible",onFocus:this.onEditorFocus},_react.default.createElement("span",null))),_react.default.createElement("td",{ref:function(e){n.container=e},className:s,style:this.props.bodyStyle||this.props.style,onClick:this.onClick,onKeyDown:this.onKeyDown,rowSpan:this.props.rowSpan,onBlur:this.onBlur},e,t,o)}}],[{key:"getDerivedStateFromProps",value:function(e,t){return"row"===e.editMode&&e.editing!==t.editing?{editing:e.editing}:null}}]),i}();exports.BodyCell=BodyCell;