"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Spinner=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactDom=_interopRequireDefault(require("react-dom")),_InputText=require("../inputtext/InputText"),_classnames=_interopRequireDefault(require("classnames")),_Tooltip=_interopRequireDefault(require("../tooltip/Tooltip")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var o,r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in e){Object.prototype.hasOwnProperty.call(e,p)&&((o=r?Object.getOwnPropertyDescriptor(e,p):null)&&(o.get||o.set)?Object.defineProperty(n,p,o):n[p]=e[p])}}return n.default=e,t&&t.set(e,n),n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Spinner=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).props.value&&0<t.props.value.toString().indexOf(".")?t.precision=t.props.value.toString().split(/[.]/)[1].length:t.props.step%1!=0&&(t.precision=t.props.step.toString().split(/[,]|[.]/)[1].length),t.props.formatInput&&(t.localeDecimalSeparator=1.1.toLocaleString().substring(1,2),t.localeThousandSeparator=1e3.toLocaleString().substring(1,2),t.thousandRegExp=new RegExp("[".concat(t.props.thousandSeparator||t.localeThousandSeparator,"]"),"gim"),t.props.decimalSeparator&&t.props.thousandSeparator&&t.props.decimalSeparator===t.props.thousandSeparator&&console.warn("thousandSeparator and decimalSeparator cannot have the same value.")),t.formatValue(t.props.value),t.onInputKeyDown=t.onInputKeyDown.bind(_assertThisInitialized(t)),t.onInputChange=t.onInputChange.bind(_assertThisInitialized(t)),t.onInputBlur=t.onInputBlur.bind(_assertThisInitialized(t)),t.onInputFocus=t.onInputFocus.bind(_assertThisInitialized(t)),t.onUpButtonMouseLeave=t.onUpButtonMouseLeave.bind(_assertThisInitialized(t)),t.onUpButtonMouseDown=t.onUpButtonMouseDown.bind(_assertThisInitialized(t)),t.onUpButtonMouseUp=t.onUpButtonMouseUp.bind(_assertThisInitialized(t)),t.onUpButtonKeyDown=t.onUpButtonKeyDown.bind(_assertThisInitialized(t)),t.onUpButtonKeyUp=t.onUpButtonKeyUp.bind(_assertThisInitialized(t)),t.onDownButtonMouseLeave=t.onDownButtonMouseLeave.bind(_assertThisInitialized(t)),t.onDownButtonMouseDown=t.onDownButtonMouseDown.bind(_assertThisInitialized(t)),t.onDownButtonMouseUp=t.onDownButtonMouseUp.bind(_assertThisInitialized(t)),t.onDownButtonKeyDown=t.onDownButtonKeyDown.bind(_assertThisInitialized(t)),t.onDownButtonKeyUp=t.onDownButtonKeyUp.bind(_assertThisInitialized(t)),t}return _inherits(n,_react.Component),_createClass(n,[{key:"repeat",value:function(e,t,n){var o=this,r=t||500;this.clearTimer(),this.timer=setTimeout(function(){o.repeat(e,40,n)},r),this.spin(e,n)}},{key:"spin",value:function(e,t){var n=this.props.step*t,o=this.props.value?"string"==typeof this.props.value?this.parseValue(this.props.value):this.props.value:0,r=this.precision?parseFloat(this.toFixed(o+n,this.precision)):o+n;null!==this.props.maxlength&&this.props.value.toString().length>this.props.maxlength&&(r=o),null!==this.props.min&&r<this.props.min&&(r=this.props.min),null!==this.props.max&&r>this.props.max&&(r=this.props.max),this.props.onChange&&this.props.onChange({originalEvent:e,value:r,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:r}})}},{key:"toFixed",value:function(e,t){var n=Math.pow(10,t||0);return String(Math.round(e*n)/n)}},{key:"onUpButtonMouseDown",value:function(e){this.props.disabled||(this.inputEl.focus(),this.repeat(e,null,1),e.preventDefault())}},{key:"onUpButtonMouseUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onUpButtonMouseLeave",value:function(){this.props.disabled||this.clearTimer()}},{key:"onUpButtonKeyUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onUpButtonKeyDown",value:function(e){32!==e.keyCode&&13!==e.keyCode||this.repeat(e,null,1)}},{key:"onDownButtonMouseDown",value:function(e){this.props.disabled||(this.inputEl.focus(),this.repeat(e,null,-1),e.preventDefault())}},{key:"onDownButtonMouseUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onDownButtonMouseLeave",value:function(){this.props.disabled||this.clearTimer()}},{key:"onDownButtonKeyUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onDownButtonKeyDown",value:function(e){32!==e.keyCode&&13!==e.keyCode||this.repeat(e,null,-1)}},{key:"onInputKeyDown",value:function(e){38===e.which?(this.spin(e,1),e.preventDefault()):40===e.which&&(this.spin(e,-1),e.preventDefault())}},{key:"parseValue",value:function(e){var t=e.trim();return""===e?t=null!=this.props.min?this.props.min:null:(this.props.formatInput&&(e=e.replace(this.thousandRegExp,"")),t=this.precision?(e=this.props.formatInput?e.replace(this.props.decimalSeparator||this.localeDecimalSeparator,"."):e.replace(",","."),parseFloat(e)):parseInt(e,10),isNaN(t)?t=null:(null!==this.props.max&&t>this.props.max&&(t=this.props.max),null!==this.props.min&&t<this.props.min&&(t=this.props.min))),t}},{key:"onInputFocus",value:function(){_DomHandler.default.addClass(this.element,"p-inputwrapper-focus")}},{key:"onInputChange",value:function(e){this.props.onChange&&this.props.onChange({originalEvent:e,value:e.target.value,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:e.target.value}})}},{key:"onInputBlur",value:function(e){var t;_DomHandler.default.removeClass(this.element,"p-inputwrapper-focus"),this.props.onChange&&(t=this.parseValue(e.target.value),this.props.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:t}})),this.props.onBlur&&this.props.onBlur(e)}},{key:"formatValue",value:function(e){null!=e&&(this.props.formatInput&&(e=e.toLocaleString(void 0,{maximumFractionDigits:20}),this.props.decimalSeparator&&this.props.thousandSeparator&&(e=e.split(this.localeDecimalSeparator),this.precision&&e[1]&&(e[1]=(this.props.decimalSeparator||this.localeDecimalSeparator)+e[1]),this.props.thousandSeparator&&3<e[0].length&&(e[0]=e[0].replace(new RegExp("[".concat(this.localeThousandSeparator,"]"),"gim"),this.props.thousandSeparator)),e=e.join(""))),this.formattedValue=e.toString())}},{key:"clearTimer",value:function(){this.timer&&clearInterval(this.timer)}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"shouldComponentUpdate",value:function(e){return this.props.value!==e.value&&this.formatValue(e.value),!0}},{key:"componentDidUpdate",value:function(e){e.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"renderTooltip",value:function(){this.tooltip=new _Tooltip.default({target:this.element,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"renderInputElement",value:function(){var t=this,e=(0,_classnames.default)("p-spinner-input",this.props.inputClassName);return _react.default.createElement(_InputText.InputText,{ref:function(e){return t.inputEl=_reactDom.default.findDOMNode(e)},id:this.props.inputId,style:this.props.inputStyle,className:e,value:this.formattedValue||"",type:"text",size:this.props.size,tabIndex:this.props.tabIndex,maxLength:this.props.maxlength,disabled:this.props.disabled,required:this.props.required,pattern:this.props.pattern,placeholder:this.props.placeholder,readOnly:this.props.readonly,name:this.props.name,onKeyDown:this.onInputKeyDown,onBlur:this.onInputBlur,onChange:this.onInputChange,onFocus:this.onInputFocus,"aria-valuemin":this.props.min,"aria-valuemax":this.props.max,"aria-valuenow":this.formattedValue||"","aria-labelledby":this.props.ariaLabelledBy})}},{key:"renderUpButton",value:function(){var e=(0,_classnames.default)("p-spinner-button p-spinner-button-up p-button p-component",{"p-disabled":this.props.disabled});return _react.default.createElement("button",{type:"button",className:e,onMouseLeave:this.onUpButtonMouseLeave,onMouseDown:this.onUpButtonMouseDown,onMouseUp:this.onUpButtonMouseUp,onKeyDown:this.onUpButtonKeyDown,onKeyUp:this.onUpButtonKeyUp,disabled:this.props.disabled,tabIndex:this.props.tabIndex},_react.default.createElement("span",{className:"p-spinner-button-icon pi pi-caret-up"}))}},{key:"renderDownButton",value:function(){var e=(0,_classnames.default)("p-spinner-button p-spinner-button-down p-button p-component",{"p-disabled":this.props.disabled});return _react.default.createElement("button",{type:"button",className:e,onMouseLeave:this.onDownButtonMouseLeave,onMouseDown:this.onDownButtonMouseDown,onMouseUp:this.onDownButtonMouseUp,onKeyDown:this.onDownButtonKeyDown,onKeyUp:this.onDownButtonKeyUp,disabled:this.props.disabled,tabIndex:this.props.tabIndex},_react.default.createElement("span",{className:"p-spinner-button-icon pi pi-caret-down"}))}},{key:"render",value:function(){var t=this,e=(0,_classnames.default)("p-spinner p-component",this.props.className,{"p-inputwrapper-filled":null!=this.props.value}),n=this.renderInputElement(),o=this.renderUpButton(),r=this.renderDownButton();return _react.default.createElement("span",{ref:function(e){return t.element=e},id:this.props.id,className:e,style:this.props.style},n,o,r)}}]),n}();_defineProperty(exports.Spinner=Spinner,"defaultProps",{id:null,value:null,name:null,step:1,min:null,max:null,formatInput:!1,decimalSeparator:null,thousandSeparator:null,disabled:!1,required:!1,tabIndex:null,pattern:null,placeholder:null,readonly:!1,maxlength:null,size:null,style:null,className:null,inputId:null,inputStyle:null,inputClassName:null,tooltip:null,tooltipOptions:null,ariaLabelledBy:null,onChange:null,onBlur:null}),_defineProperty(Spinner,"propTypes",{id:_propTypes.default.string,value:_propTypes.default.any,name:_propTypes.default.string,step:_propTypes.default.number,min:_propTypes.default.number,max:_propTypes.default.number,formatInput:_propTypes.default.bool,decimalSeparator:_propTypes.default.string,thousandSeparator:_propTypes.default.string,disabled:_propTypes.default.bool,required:_propTypes.default.bool,tabIndex:_propTypes.default.number,pattern:_propTypes.default.string,placeholder:_propTypes.default.string,readonly:_propTypes.default.bool,maxlength:_propTypes.default.number,size:_propTypes.default.number,style:_propTypes.default.object,className:_propTypes.default.string,inputId:_propTypes.default.string,inputStyle:_propTypes.default.object,inputClassName:_propTypes.default.string,tooltip:_propTypes.default.string,tooltipOptions:_propTypes.default.object,ariaLabelledBy:_propTypes.default.string,onChange:_propTypes.default.func,onBlur:_propTypes.default.func});