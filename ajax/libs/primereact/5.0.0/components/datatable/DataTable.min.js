"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataTable=void 0;var _classnames=_interopRequireDefault(require("classnames")),_propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireWildcard(require("react")),_Paginator=require("../paginator/Paginator"),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_FilterUtils=_interopRequireDefault(require("../utils/FilterUtils")),_ScrollableView=require("./ScrollableView"),_TableBody=require("./TableBody"),_TableFooter=require("./TableFooter"),_TableHeader=require("./TableHeader"),_TableLoadingBody=require("./TableLoadingBody");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,o={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e){Object.prototype.hasOwnProperty.call(e,n)&&((r=l?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(o,n,r):o[n]=e[n])}return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectWithoutProperties(e,t){if(null==e)return{};var r,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols)for(var l=Object.getOwnPropertySymbols(e),n=0;n<l.length;n++)r=l[n],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r]);return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,o={},l=Object.keys(e),n=0;n<l.length;n++)r=l[n],0<=t.indexOf(r)||(o[r]=e[r]);return o}function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw n}}}}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var DataTable=function(){_inherits(o,_react.Component);var r=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=r.call(this,e)).state={},t.props.onPage||(t.state.first=e.first,t.state.rows=e.rows),t.props.onSort||(t.state.sortField=e.sortField,t.state.sortOrder=e.sortOrder,t.state.multiSortMeta=e.multiSortMeta),t.props.onFilter||(t.state.filters=e.filters),t.isStateful()&&t.restoreState(t.state),t.onPageChange=t.onPageChange.bind(_assertThisInitialized(t)),t.onSort=t.onSort.bind(_assertThisInitialized(t)),t.onFilter=t.onFilter.bind(_assertThisInitialized(t)),t.onColumnResizeStart=t.onColumnResizeStart.bind(_assertThisInitialized(t)),t.onHeaderCheckboxClick=t.onHeaderCheckboxClick.bind(_assertThisInitialized(t)),t.onColumnDragStart=t.onColumnDragStart.bind(_assertThisInitialized(t)),t.onColumnDragOver=t.onColumnDragOver.bind(_assertThisInitialized(t)),t.onColumnDragLeave=t.onColumnDragLeave.bind(_assertThisInitialized(t)),t.onColumnDrop=t.onColumnDrop.bind(_assertThisInitialized(t)),t.onVirtualScroll=t.onVirtualScroll.bind(_assertThisInitialized(t)),t.frozenSelectionMode=null,t}return _createClass(o,[{key:"getFirst",value:function(){return this.props.onPage?this.props.first:this.state.first}},{key:"getRows",value:function(){return this.props.onPage?this.props.rows:this.state.rows}},{key:"getSortField",value:function(){return this.props.onSort?this.props.sortField:this.state.sortField}},{key:"getSortOrder",value:function(){return this.props.onSort?this.props.sortOrder:this.state.sortOrder}},{key:"getMultiSortMeta",value:function(){return this.props.onSort?this.props.multiSortMeta:this.state.multiSortMeta}},{key:"getFilters",value:function(){return this.props.onFilter?this.props.filters:this.state.filters}},{key:"getStorage",value:function(){switch(this.props.stateStorage){case"local":return window.localStorage;case"session":return window.sessionStorage;case"custom":return null;default:throw new Error(this.props.stateStorage+' is not a valid value for the state storage, supported values are "local", "session" and "custom".')}}},{key:"isCustomStateStorage",value:function(){return"custom"===this.props.stateStorage}},{key:"isStateful",value:function(){return null!=this.props.stateKey||this.isCustomStateStorage()}},{key:"saveState",value:function(){var e={};this.props.paginator&&(e.first=this.getFirst(),e.rows=this.getRows());var t=this.getSortField();t&&(e.sortField=t,e.sortOrder=this.getSortOrder());var r,o=this.getMultiSortMeta();o&&(e.multiSortMeta=o),this.hasFilter()&&(e.filters=this.getFilters()),this.props.resizableColumns&&this.saveColumnWidths(e),this.props.reorderableColumns&&(e.columnOrder=this.state.columnOrder),this.props.expandedRows&&(e.expandedRows=this.props.expandedRows),this.props.selection&&this.props.onSelectionChange&&(e.selection=this.props.selection),this.isCustomStateStorage()?this.props.customSaveState&&this.props.customSaveState(e):(r=this.getStorage(),Object.keys(e).length&&r.setItem(this.props.stateKey,JSON.stringify(e))),this.props.onStateSave&&this.props.onStateSave(e)}},{key:"clearState",value:function(){var e=this.getStorage();e&&this.props.stateKey&&e.removeItem(this.props.stateKey)}},{key:"restoreState",value:function(e){var t,r={};this.isCustomStateStorage()?this.props.customRestoreState&&(r=this.props.customRestoreState()):(t=this.getStorage().getItem(this.props.stateKey))&&(r=JSON.parse(t)),r&&Object.keys(r).length&&(this.props.paginator&&(this.props.onPage?this.props.onPage({first:r.first,rows:r.rows}):(e.first=r.first,e.rows=r.rows)),r.sortField&&(this.props.onSort?this.props.onSort({sortField:r.sortField,sortOrder:r.sortOrder}):(e.sortField=r.sortField,e.sortOrder=r.sortOrder)),r.multiSortMeta&&(this.props.onSort?this.props.onSort({multiSortMeta:r.multiSortMeta}):e.multiSortMeta=r.multiSortMeta),r.filters&&(this.props.onFilter?this.props.onFilter({filters:r.filters}):e.filters=r.filters),this.props.resizableColumns&&(this.columnWidthsState=r.columnWidths,this.tableWidthState=r.tableWidth),this.props.reorderableColumns&&(e.columnOrder=r.columnOrder),r.expandedRows&&this.props.onRowToggle&&this.props.onRowToggle({data:r.expandedRows}),r.selection&&this.props.onSelectionChange&&this.props.onSelectionChange({value:r.selection}),this.props.onStateRestore&&this.props.onStateRestore(r))}},{key:"saveColumnWidths",value:function(e){var t=[];_DomHandler.default.find(this.container,".p-datatable-thead > tr > th").map(function(e){return t.push(_DomHandler.default.getOuterWidth(e))}),e.columnWidths=t.join(","),"expand"===this.props.columnResizeMode&&(e.tableWidth=this.props.scrollable?_DomHandler.default.findSingle(this.container,".p-datatable-scrollable-header-table").style.width:_DomHandler.default.getOuterWidth(this.table)+"px")}},{key:"restoreColumnWidths",value:function(){var r,e,t;this.columnWidthsState&&(r=this.columnWidthsState.split(","),"expand"===this.props.columnResizeMode&&this.tableWidthState&&(this.props.scrollable?this.setScrollableItemsWidthOnExpandResize(null,this.tableWidthState,0):(this.table.style.width=this.tableWidthState,this.container.style.width=this.tableWidthState)),this.props.scrollable?(e=_DomHandler.default.find(this.container,".p-datatable-scrollable-header-table > colgroup > col"),t=_DomHandler.default.find(this.container,".p-datatable-scrollable-body-table > colgroup > col"),e.map(function(e,t){return e.style.width=r[t]+"px"}),t.map(function(e,t){return e.style.width=r[t]+"px"})):_DomHandler.default.find(this.table,".p-datatable-thead > tr > th").map(function(e,t){return e.style.width=r[t]+"px"}))}},{key:"onPageChange",value:function(e){this.props.onPage?this.props.onPage(e):this.setState({first:e.first,rows:e.rows}),this.props.onValueChange&&this.props.onValueChange()}},{key:"createPaginator",value:function(e,t){var r="p-paginator-"+e;return _react.default.createElement(_Paginator.Paginator,{first:this.getFirst(),rows:this.getRows(),pageLinkSize:this.props.pageLinkSize,className:r,onPageChange:this.onPageChange,template:this.props.paginatorTemplate,totalRecords:t,rowsPerPageOptions:this.props.rowsPerPageOptions,currentPageReportTemplate:this.props.currentPageReportTemplate,leftContent:this.props.paginatorLeft,rightContent:this.props.paginatorRight,alwaysShow:this.props.alwaysShowPaginator})}},{key:"onSort",value:function(e){var t,r,o,l,n,a=e.sortField,s=this.props.defaultSortOrder;this.columnSortable=e.sortable,this.columnSortFunction=e.sortFunction,this.columnField=e.sortField,t="multiple"===this.props.sortMode?(r=e.originalEvent.metaKey||e.originalEvent.ctrlKey,(l=this.getMultiSortMeta())&&l instanceof Array&&(s=(o=l.find(function(e){return e.field===a}))?this.getCalculatedSortOrder(o.order):s),n={field:a,order:s},s?(l&&r||(l=[]),this.addSortMeta(n,l)):this.props.removableSort&&l&&this.removeSortMeta(n,l),{multiSortMeta:l}):(s=this.getSortField()===a?this.getCalculatedSortOrder(this.getSortOrder()):s,this.props.removableSort&&(a=s?a:null),{sortField:a,sortOrder:s}),this.props.onSort?this.props.onSort(t):(t.first=0,this.setState(t)),this.props.onValueChange&&this.props.onValueChange(this.processData({sortField:a,sortOrder:s,multiSortMeta:l}))}},{key:"getCalculatedSortOrder",value:function(e){return this.props.removableSort?e?e<0?0:-1:1:-1*e}},{key:"addSortMeta",value:function(e,t){for(var r=-1,o=0;o<t.length;o++)if(t[o].field===e.field){r=o;break}0<=r?t[r]=e:t.push(e)}},{key:"removeSortMeta",value:function(e,t){for(var r=-1,o=0;o<t.length;o++)if(t[o].field===e.field){r=o;break}0<=r&&t.splice(r,1),t=0<t.length?t:null}},{key:"sortSingle",value:function(e,n,a){var t=_toConsumableArray(e);return this.columnSortable&&this.columnSortFunction?t=this.columnSortFunction({field:this.getSortField(),order:this.getSortOrder()}):t.sort(function(e,t){var r=_ObjectUtils.default.resolveFieldData(e,n),o=_ObjectUtils.default.resolveFieldData(t,n),l=null,l=null==r&&null!=o?-1:null!=r&&null==o?1:null==r&&null==o?0:"string"==typeof r&&"string"==typeof o?r.localeCompare(o,void 0,{numeric:!0}):r<o?-1:o<r?1:0;return a*l}),t}},{key:"sortMultiple",value:function(e,r){var t,o,l,n=this,a=_toConsumableArray(e);return this.columnSortable&&this.columnSortFunction?(t=r.find(function(e){return e.field===n.columnField}),o=this.columnField,l=t?t.order:this.defaultSortOrder,a=this.columnSortFunction({field:o,order:l})):a.sort(function(e,t){return n.multisortField(e,t,r,0)}),a}},{key:"multisortField",value:function(e,t,r,o){var l=_ObjectUtils.default.resolveFieldData(e,r[o].field),n=_ObjectUtils.default.resolveFieldData(t,r[o].field),a=null;if("string"==typeof l||l instanceof String){if(l.localeCompare&&l!==n)return r[o].order*l.localeCompare(n,void 0,{numeric:!0})}else a=l<n?-1:1;return l===n?r.length-1>o?this.multisortField(e,t,r,o+1):0:r[o].order*a}},{key:"filter",value:function(e,t,r){this.onFilter({value:e,field:t,matchMode:r})}},{key:"onFilter",value:function(e){var t=this.getFilters(),r=t?_objectSpread({},t):{};this.isFilterBlank(e.value)?r[e.field]&&delete r[e.field]:r[e.field]={value:e.value,matchMode:e.matchMode},this.props.onFilter?this.props.onFilter({filters:r}):this.setState({first:0,filters:r}),this.props.onValueChange&&this.props.onValueChange(this.processData({filters:r}))}},{key:"hasFilter",value:function(){var e=this.getFilters()||this.props.globalFilter;return e&&0<Object.keys(e).length}},{key:"isFilterBlank",value:function(e){return null==e||("string"==typeof e&&0===e.trim().length||e instanceof Array&&0===e.length)}},{key:"hasFooter",value:function(){return!!this.props.children&&(!!this.props.footerColumnGroup||this.hasChildrenFooter(this.props.children))}},{key:"hasChildrenFooter",value:function(e){var t=!1;if(e){if(!(e instanceof Array))return e.props&&null!==e.props.footer;for(var r=0;r<e.length;r++)t=t||this.hasChildrenFooter(e[r])}return t}},{key:"onColumnResizeStart",value:function(e){var t=_DomHandler.default.getOffset(this.container).left;this.resizeColumn=e.columnEl,this.resizeColumnProps=e.columnProps,this.columnResizing=!0,this.lastResizerHelperX=e.originalEvent.pageX-t+this.container.scrollLeft,this.bindColumnResizeEvents()}},{key:"onColumnResize",value:function(e){var t=_DomHandler.default.getOffset(this.container).left;_DomHandler.default.addClass(this.container,"p-unselectable-text"),this.resizerHelper.style.height=this.container.offsetHeight+"px",this.resizerHelper.style.top="0px",this.resizerHelper.style.left=e.pageX-t+this.container.scrollLeft+"px",this.resizerHelper.style.display="block"}},{key:"onColumnResizeEnd",value:function(){var e,t,r,o,l,n,a,s=this.resizerHelper.offsetLeft-this.lastResizerHelperX,i=this.resizeColumn.offsetWidth,p=i+s,u=this.resizeColumn.style.minWidth||15;i+s>parseInt(u,10)&&("fit"===this.props.columnResizeMode?(t=(e=this.resizeColumn.nextElementSibling).offsetWidth-s,15<p&&15<t&&(this.props.scrollable?(r=this.findParentScrollableView(this.resizeColumn),o=_DomHandler.default.findSingle(r,"table.p-datatable-scrollable-body-table"),l=_DomHandler.default.findSingle(r,"table.p-datatable-scrollable-header-table"),n=_DomHandler.default.findSingle(r,"table.p-datatable-scrollable-footer-table"),a=_DomHandler.default.index(this.resizeColumn),this.resizeColGroup(l,a,p,t),this.resizeColGroup(o,a,p,t),this.resizeColGroup(n,a,p,t)):(this.resizeColumn.style.width=p+"px",e&&(e.style.width=t+"px")))):"expand"===this.props.columnResizeMode&&(this.props.scrollable?this.setScrollableItemsWidthOnExpandResize(this.resizeColumn,p,s):(this.table.style.width=this.table.offsetWidth+s+"px",this.resizeColumn.style.width=p+"px")),this.props.onColumnResizeEnd&&this.props.onColumnResizeEnd({element:this.resizeColumn,column:this.resizeColumnProps,delta:s}),this.isStateful()&&this.saveState()),this.resizerHelper.style.display="none",this.resizeColumn=null,this.resizeColumnProps=null,_DomHandler.default.removeClass(this.container,"p-unselectable-text"),this.unbindColumnResizeEvents()}},{key:"setScrollableItemsWidthOnExpandResize",value:function(e,t,r){function o(e,t,r,o){e&&t&&(e.style.width=o?r+_DomHandler.default.calculateScrollbarWidth(a)+"px":"auto",t.style.width=r+"px")}var l,n=e?this.findParentScrollableView(e):this.container,a=_DomHandler.default.findSingle(n,".p-datatable-scrollable-body"),s=_DomHandler.default.findSingle(n,".p-datatable-scrollable-header"),i=_DomHandler.default.findSingle(n,".p-datatable-scrollable-footer"),p=_DomHandler.default.findSingle(a,"table.p-datatable-scrollable-body-table"),u=_DomHandler.default.findSingle(s,"table.p-datatable-scrollable-header-table"),d=_DomHandler.default.findSingle(i,"table.p-datatable-scrollable-footer-table"),c=e?p.offsetWidth+r:t,h=e?u.offsetWidth+r:t,f=this.container.offsetWidth>=c;o(a,p,c,f),o(s,u,h,f),o(i,d,h,f),e&&(l=_DomHandler.default.index(e),this.resizeColGroup(u,l,t,null),this.resizeColGroup(p,l,t,null),this.resizeColGroup(d,l,t,null))}},{key:"findParentScrollableView",value:function(e){if(e){for(var t=e.parentElement;t&&!_DomHandler.default.hasClass(t,"p-datatable-scrollable-view");)t=t.parentElement;return t}return null}},{key:"resizeColGroup",value:function(e,t,r,o){if(e){var l="COLGROUP"===e.children[0].nodeName?e.children[0]:null;if(!l)throw new Error("Scrollable tables require a colgroup to support resizable columns");var n=l.children[t],a=n.nextElementSibling;n.style.width=r+"px",a&&o&&(a.style.width=o+"px")}}},{key:"bindColumnResizeEvents",value:function(){var t=this;this.documentColumnResizeListener=document.addEventListener("mousemove",function(e){t.columnResizing&&t.onColumnResize(e)}),this.documentColumnResizeEndListener=document.addEventListener("mouseup",function(e){t.columnResizing&&(t.columnResizing=!1,t.onColumnResizeEnd(e))})}},{key:"unbindColumnResizeEvents",value:function(){document.removeEventListener("document",this.documentColumnResizeListener),document.removeEventListener("document",this.documentColumnResizeEndListener)}},{key:"findParentHeader",value:function(e){if("TH"===e.nodeName)return e;for(var t=e.parentElement;"TH"!==t.nodeName&&(t=t.parentElement););return t}},{key:"onColumnDragStart",value:function(e){this.columnResizing?e.preventDefault():(this.iconWidth=_DomHandler.default.getHiddenElementOuterWidth(this.reorderIndicatorUp),this.iconHeight=_DomHandler.default.getHiddenElementOuterHeight(this.reorderIndicatorUp),this.draggedColumn=this.findParentHeader(e.target),e.dataTransfer.setData("text","b"))}},{key:"onColumnDragOver",value:function(e){var t,r,o,l,n=this.findParentHeader(e.target);this.props.reorderableColumns&&this.draggedColumn&&n&&(e.preventDefault(),t=_DomHandler.default.getOffset(this.container),r=_DomHandler.default.getOffset(n),this.draggedColumn!==n&&(o=r.left-t.left,l=r.left+n.offsetWidth/2,this.reorderIndicatorUp.style.top=r.top-t.top-(this.iconHeight-1)+"px",this.reorderIndicatorDown.style.top=r.top-t.top+n.offsetHeight+"px",e.pageX>l?(this.reorderIndicatorUp.style.left=o+n.offsetWidth-Math.ceil(this.iconWidth/2)+"px",this.reorderIndicatorDown.style.left=o+n.offsetWidth-Math.ceil(this.iconWidth/2)+"px",this.dropPosition=1):(this.reorderIndicatorUp.style.left=o-Math.ceil(this.iconWidth/2)+"px",this.reorderIndicatorDown.style.left=o-Math.ceil(this.iconWidth/2)+"px",this.dropPosition=-1),this.reorderIndicatorUp.style.display="block",this.reorderIndicatorDown.style.display="block"))}},{key:"onColumnDragLeave",value:function(e){this.props.reorderableColumns&&this.draggedColumn&&(e.preventDefault(),this.reorderIndicatorUp.style.display="none",this.reorderIndicatorDown.style.display="none")}},{key:"onColumnDrop",value:function(e){if(e.preventDefault(),this.draggedColumn){var t=_DomHandler.default.index(this.draggedColumn),r=_DomHandler.default.index(this.findParentHeader(e.target)),o=t!==r;if(o&&(r-t==1&&-1===this.dropPosition||t-r==1&&1===this.dropPosition)&&(o=!1),o){var l=this.state.columnOrder?this.getColumns():_react.default.Children.toArray(this.props.children);_ObjectUtils.default.reorderArray(l,t,r);var n,a=[],s=_createForOfIteratorHelper(l);try{for(s.s();!(n=s.n()).done;){var i=n.value;a.push(i.props.columnKey||i.props.field)}}catch(e){s.e(e)}finally{s.f()}this.setState({columnOrder:a}),this.props.onColReorder&&this.props.onColReorder({originalEvent:e,dragIndex:t,dropIndex:r,columns:l})}this.reorderIndicatorUp.style.display="none",this.reorderIndicatorDown.style.display="none",this.draggedColumn.draggable=!1,this.draggedColumn=null,this.dropPosition=null}}},{key:"onVirtualScroll",value:function(e){var t=this;this.virtualScrollTimer&&clearTimeout(this.virtualScrollTimer),this.virtualScrollTimer=setTimeout(function(){t.props.onVirtualScroll&&t.props.onVirtualScroll({first:(e.page-1)*t.props.rows,rows:t.props.virtualScroll?2*t.props.rows:t.props.rows})},this.props.virtualScrollDelay)}},{key:"exportCSV",value:function(){for(var a=this,e=this.processData(),s="\ufeff",i=_react.default.Children.toArray(this.props.children),t=0;t<i.length;t++)i[t].props.field&&(s+='"'+(i[t].props.header||i[t].props.field)+'"',t<i.length-1&&(s+=this.props.csvSeparator));e.forEach(function(e,t){s+="\n";for(var r=0;r<i.length;r++){var o,l=i[r],n=l.props.field;l.props.exportable&&n&&(o=null!=(o=_ObjectUtils.default.resolveFieldData(e,n))?a.props.exportFunction?a.props.exportFunction({data:o,field:n}):String(o).replace(/"/g,'""'):"",s+='"'+o+'"',r<i.length-1&&(s+=a.props.csvSeparator))}});var r,o=new Blob([s],{type:"text/csv;charset=utf-8;"});window.navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,this.props.exportFilename+".csv"):((r=document.createElement("a")).style.display="none",document.body.appendChild(r),void 0!==r.download?(r.setAttribute("href",URL.createObjectURL(o)),r.setAttribute("download",this.props.exportFilename+".csv"),r.click()):(s="data:text/csv;charset=utf-8,"+s,window.open(encodeURI(s))),document.body.removeChild(r))}},{key:"closeEditingCell",value:function(){"row"!==this.props.editMode&&document.body.click()}},{key:"onHeaderCheckboxClick",value:function(e){var t,r,o;t=e.checked?[]:_toConsumableArray(this.hasFilter()?this.processData():this.props.value),this.props.onSelectionChange&&(r=e.originalEvent,o=_objectWithoutProperties(e,["originalEvent"]),this.props.onSelectionChange(_objectSpread({originalEvent:r,value:t},o)))}},{key:"filterLocal",value:function(e,t){for(var r=[],o=t||this.getFilters(),l=_react.default.Children.toArray(this.props.children),n=0;n<e.length;n++){for(var a=!0,s=!1,i=0;i<l.length;i++){var p=l[i],u=p.props.filterField||p.props.field,d=o?o[u]:null;if(d){var c=d.value,h=_ObjectUtils.default.resolveFieldData(e[n],u),f=d.matchMode||p.props.filterMatchMode;if(("custom"===f?p.props.filterFunction:_FilterUtils.default[f])(h,c,this.props.filterLocale)||(a=!1),!a)break}p.props.excludeGlobalFilter||!this.props.globalFilter||s||(s=_FilterUtils.default.contains(_ObjectUtils.default.resolveFieldData(e[n],u),this.props.globalFilter,this.props.filterLocale))}var y=a;this.props.globalFilter&&(y=a&&s),y&&r.push(e[n])}return r.length===e.length&&(r=e),r}},{key:"processData",value:function(e){var t,r,o,l,n=this.props.value;return this.props.lazy||n&&n.length&&(t=e&&e.sortField||this.getSortField(),r=e&&e.sortOrder||this.getSortOrder(),o=e&&e.multiSortMeta||this.getMultiSortMeta(),(t||o&&o.length)&&("single"===this.props.sortMode?n=this.sortSingle(n,t,r):"multiple"===this.props.sortMode&&(n=this.sortMultiple(n,o))),((l=e&&e.filters||this.getFilters())||this.props.globalFilter)&&(n=this.filterLocal(n,l))),n}},{key:"isAllSelected",value:function(){var e=this.hasFilter()?this.processData():this.props.value;return this.props.selection&&e&&e.length&&this.props.selection.length===e.length}},{key:"getFrozenColumns",value:function(e){var t,r=null,o=_createForOfIteratorHelper(e);try{for(o.s();!(t=o.n()).done;){var l=t.value;l.props.frozen&&(r=r||[]).push(l)}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"getScrollableColumns",value:function(e){var t,r=null,o=_createForOfIteratorHelper(e);try{for(o.s();!(t=o.n()).done;){var l=t.value;l.props.frozen||(r=r||[]).push(l)}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"getFrozenSelectionModeInColumn",value:function(e){if(Array.isArray(e)){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o.props.selectionMode)return o.props.selectionMode}}catch(e){r.e(e)}finally{r.f()}}return null}},{key:"createTableHeader",value:function(e,t,r){return _react.default.createElement(_TableHeader.TableHeader,{value:e,onSort:this.onSort,sortField:this.getSortField(),sortOrder:this.getSortOrder(),multiSortMeta:this.getMultiSortMeta(),columnGroup:r,resizableColumns:this.props.resizableColumns,onColumnResizeStart:this.onColumnResizeStart,onFilter:this.onFilter,onHeaderCheckboxClick:this.onHeaderCheckboxClick,headerCheckboxSelected:this.isAllSelected(),reorderableColumns:this.props.reorderableColumns,onColumnDragStart:this.onColumnDragStart,filters:this.getFilters(),onColumnDragOver:this.onColumnDragOver,onColumnDragLeave:this.onColumnDragLeave,onColumnDrop:this.onColumnDrop,tabIndex:this.props.tabIndex},t)}},{key:"createTableBody",value:function(e,t,r){return _react.default.createElement(_TableBody.TableBody,{value:e,first:this.getFirst(),rows:this.getRows(),lazy:this.props.lazy,paginator:this.props.paginator,dataKey:this.props.dataKey,compareSelectionBy:this.props.compareSelectionBy,selectionMode:this.props.selectionMode,selection:this.props.selection,metaKeySelection:this.props.metaKeySelection,frozen:r,frozenSelectionMode:this.frozenSelectionMode,onSelectionChange:this.props.onSelectionChange,onRowClick:this.props.onRowClick,onRowDoubleClick:this.props.onRowDoubleClick,onRowSelect:this.props.onRowSelect,onRowUnselect:this.props.onRowUnselect,contextMenuSelection:this.props.contextMenuSelection,onContextMenuSelectionChange:this.props.onContextMenuSelectionChange,onContextMenu:this.props.onContextMenu,expandedRows:this.props.expandedRows,onRowToggle:this.props.onRowToggle,rowExpansionTemplate:this.props.rowExpansionTemplate,onRowExpand:this.props.onRowExpand,onRowCollapse:this.props.onRowCollapse,emptyMessage:this.props.emptyMessage,virtualScroll:this.props.virtualScroll,virtualRowHeight:this.props.virtualRowHeight,loading:this.props.loading,groupField:this.props.groupField,rowGroupMode:this.props.rowGroupMode,rowGroupHeaderTemplate:this.props.rowGroupHeaderTemplate,rowGroupFooterTemplate:this.props.rowGroupFooterTemplate,sortField:this.getSortField(),rowClassName:this.props.rowClassName,onRowReorder:this.props.onRowReorder,editMode:this.props.editMode,rowEditorValidator:this.props.rowEditorValidator,onRowEditInit:this.props.onRowEditInit,onRowEditSave:this.props.onRowEditSave,onRowEditCancel:this.props.onRowEditCancel,expandableRowGroups:this.props.expandableRowGroups,showRowReorderElement:this.props.showRowReorderElement,showSelectionElement:this.props.showSelectionElement},t)}},{key:"createTableLoadingBody",value:function(e){return this.props.virtualScroll?_react.default.createElement(_TableLoadingBody.TableLoadingBody,{columns:e,rows:this.getRows()}):null}},{key:"createTableFooter",value:function(e,t){return this.hasFooter()?_react.default.createElement(_TableFooter.TableFooter,{columnGroup:t},e):null}},{key:"createScrollableView",value:function(e,t,r,o,l,n){return _react.default.createElement(_ScrollableView.ScrollableView,{columns:t,header:this.createTableHeader(e,t,o),body:this.createTableBody(e,t,r),loadingBody:this.createTableLoadingBody(t),frozenBody:this.props.frozenValue?this.createTableBody(this.props.frozenValue,t,!0):null,footer:this.createTableFooter(t,l),tableStyle:this.props.tableStyle,tableClassName:this.props.tableClassName,scrollHeight:this.props.scrollHeight,frozen:r,frozenWidth:this.props.frozenWidth,virtualScroll:this.props.virtualScroll,virtualRowHeight:this.props.virtualRowHeight,rows:this.props.rows,totalRecords:n,onVirtualScroll:this.onVirtualScroll,loading:this.props.loading})}},{key:"getColumns",value:function(){var e=_react.default.Children.toArray(this.props.children);if(e&&e.length){if(this.props.reorderableColumns&&this.state.columnOrder){var t,r=[],o=_createForOfIteratorHelper(this.state.columnOrder);try{for(o.s();!(t=o.n()).done;){var l=t.value,n=this.findColumnByKey(e,l);n&&r.push(n)}}catch(e){o.e(e)}finally{o.f()}return[].concat(r,_toConsumableArray(e.filter(function(e){return r.indexOf(e)<0})))}return e}return null}},{key:"findColumnByKey",value:function(e,t){if(e&&e.length)for(var r=0;r<e.length;r++){var o=e[r];if(o.props.columnKey===t||o.props.field===t)return o}return null}},{key:"getTotalRecords",value:function(e){return this.props.lazy?this.props.totalRecords:e?e.length:0}},{key:"reset",value:function(){var e={};this.props.onPage||(e.first=this.props.first,e.rows=this.props.rows),this.props.onSort||(e.sortField=this.props.sortField,e.sortOrder=this.props.sortOrder,e.multiSortMeta=this.props.multiSortMeta),this.props.onFilter||(e.filters=this.props.filters),this.resetColumnOrder(),Object.keys(e).length&&this.setState(e)}},{key:"resetColumnOrder",value:function(){var e,t=[],r=_createForOfIteratorHelper(_react.default.Children.toArray(this.props.children));try{for(r.s();!(e=r.n()).done;){var o=e.value;t.push(o.props.columnKey||o.props.field)}}catch(e){r.e(e)}finally{r.f()}this.setState({columnOrder:t})}},{key:"renderLoader",value:function(){var e=(0,_classnames.default)("p-datatable-loading-icon pi-spin",this.props.loadingIcon);return _react.default.createElement("div",{className:"p-datatable-loading-overlay p-component-overlay"},_react.default.createElement("i",{className:e}))}},{key:"componentDidMount",value:function(){this.isStateful()&&this.props.resizableColumns&&this.restoreColumnWidths()}},{key:"componentDidUpdate",value:function(){this.isStateful()&&this.saveState()}},{key:"render",value:function(){var e,t,r,o,l,n,a,s,i=this,p=this.processData(),u=this.getColumns(),d=this.getTotalRecords(p),c=(0,_classnames.default)("p-datatable p-component",{"p-datatable-resizable":this.props.resizableColumns,"p-datatable-resizable-fit":this.props.resizableColumns&&"fit"===this.props.columnResizeMode,"p-datatable-scrollable":this.props.scrollable,"p-datatable-virtual-scrollable":this.props.virtualScroll,"p-datatable-auto-layout":this.props.autoLayout,"p-datatable-hoverable-rows":this.props.rowHover||this.props.selectionMode},this.props.className),h=this.props.paginator&&"bottom"!==this.props.paginatorPosition&&this.createPaginator("top",d),f=this.props.paginator&&"top"!==this.props.paginatorPosition&&this.createPaginator("bottom",d),y=this.props.header&&_react.default.createElement("div",{className:"p-datatable-header"},this.props.header),m=this.props.footer&&_react.default.createElement("div",{className:"p-datatable-footer"},this.props.footer),g=this.props.resizableColumns&&_react.default.createElement("div",{ref:function(e){i.resizerHelper=e},className:"p-column-resizer-helper p-highlight",style:{display:"none"}}),b=null,v=this.props.reorderableColumns&&_react.default.createElement("span",{ref:function(e){i.reorderIndicatorUp=e},className:"pi pi-arrow-down p-datatable-reorder-indicator-up",style:{position:"absolute",display:"none"}}),S=this.props.reorderableColumns&&_react.default.createElement("span",{ref:function(e){i.reorderIndicatorDown=e},className:"pi pi-arrow-up p-datatable-reorder-indicator-down",style:{position:"absolute",display:"none"}});return this.props.loading&&(e=this.renderLoader()),Array.isArray(u)&&(b=this.props.scrollable?(this.frozenSelectionMode=this.frozenSelectionMode||this.getFrozenSelectionModeInColumn(u),r=(t=this.getFrozenColumns(u))?this.getScrollableColumns(u):u,t&&(o=this.createScrollableView(p,t,!0,this.props.frozenHeaderColumnGroup,this.props.frozenFooterColumnGroup,d)),l=this.createScrollableView(p,r,!1,this.props.headerColumnGroup,this.props.footerColumnGroup,d),_react.default.createElement("div",{className:"p-datatable-scrollable-wrapper"},o,l)):(n=this.createTableHeader(p,u,this.props.headerColumnGroup),a=this.createTableBody(p,u,!1),s=this.createTableFooter(u,this.props.footerColumnGroup),_react.default.createElement("div",{className:"p-datatable-wrapper"},_react.default.createElement("table",{style:this.props.tableStyle,role:"grid",className:this.props.tableClassName,ref:function(e){i.table=e}},n,s,a)))),_react.default.createElement("div",{id:this.props.id,className:c,style:this.props.style,ref:function(e){i.container=e},"data-scrollselectors":".p-datatable-scrollable-body, .p-datatable-unfrozen-view .p-datatable-scrollable-body"},e,y,h,b,f,m,g,v,S)}}]),o}();_defineProperty(exports.DataTable=DataTable,"defaultProps",{id:null,value:null,header:null,footer:null,style:null,className:null,tableStyle:null,tableClassName:null,paginator:!1,paginatorPosition:"bottom",alwaysShowPaginator:!0,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",paginatorLeft:null,paginatorRight:null,pageLinkSize:5,rowsPerPageOptions:null,currentPageReportTemplate:"({currentPage} of {totalPages})",first:null,rows:null,totalRecords:null,lazy:!1,sortField:null,sortOrder:null,multiSortMeta:null,sortMode:"single",defaultSortOrder:1,removableSort:!1,emptyMessage:null,selectionMode:null,selection:null,onSelectionChange:null,contextMenuSelection:null,onContextMenuSelectionChange:null,compareSelectionBy:"deepEquals",dataKey:null,metaKeySelection:!0,headerColumnGroup:null,footerColumnGroup:null,frozenHeaderColumnGroup:null,frozenFooterColumnGroup:null,rowExpansionTemplate:null,expandedRows:null,onRowToggle:null,resizableColumns:!1,columnResizeMode:"fit",reorderableColumns:!1,filters:null,globalFilter:null,filterLocale:void 0,scrollable:!1,scrollHeight:null,virtualScroll:!1,virtualScrollDelay:150,virtualRowHeight:28,frozenWidth:null,frozenValue:null,csvSeparator:",",exportFilename:"download",rowGroupMode:null,autoLayout:!1,rowClassName:null,rowGroupHeaderTemplate:null,rowGroupFooterTemplate:null,loading:!1,loadingIcon:"pi pi-spinner",tabIndex:"0",stateKey:null,stateStorage:"session",editMode:"cell",expandableRowGroups:!1,rowHover:!1,showSelectionElement:null,showRowReorderElement:null,onColumnResizeEnd:null,onSort:null,onPage:null,onFilter:null,onVirtualScroll:null,onRowClick:null,onRowDoubleClick:null,onRowSelect:null,onRowUnselect:null,onRowExpand:null,onRowCollapse:null,onContextMenu:null,onColReorder:null,onRowReorder:null,onValueChange:null,rowEditorValidator:null,onRowEditInit:null,onRowEditSave:null,onRowEditCancel:null,exportFunction:null,customSaveState:null,customRestoreState:null,onStateSave:null,onStateRestore:null}),_defineProperty(DataTable,"propTypes",{id:_propTypes.default.string,value:_propTypes.default.array,header:_propTypes.default.any,footer:_propTypes.default.any,style:_propTypes.default.object,className:_propTypes.default.string,tableStyle:_propTypes.default.any,tableClassName:_propTypes.default.string,paginator:_propTypes.default.bool,paginatorPosition:_propTypes.default.string,alwaysShowPaginator:_propTypes.default.bool,paginatorTemplate:_propTypes.default.string,paginatorLeft:_propTypes.default.any,paginatorRight:_propTypes.default.any,pageLinkSize:_propTypes.default.number,rowsPerPageOptions:_propTypes.default.array,currentPageReportTemplate:_propTypes.default.string,first:_propTypes.default.number,rows:_propTypes.default.number,totalRecords:_propTypes.default.number,lazy:_propTypes.default.bool,sortField:_propTypes.default.string,sortOrder:_propTypes.default.number,multiSortMeta:_propTypes.default.array,sortMode:_propTypes.default.string,defaultSortOrder:_propTypes.default.number,removableSort:_propTypes.default.bool,emptyMessage:_propTypes.default.any,selectionMode:_propTypes.default.string,selection:_propTypes.default.any,onSelectionChange:_propTypes.default.func,compareSelectionBy:_propTypes.default.string,dataKey:_propTypes.default.string,metaKeySelection:_propTypes.default.bool,headerColumnGroup:_propTypes.default.any,footerColumnGroup:_propTypes.default.any,frozenHeaderColumnGroup:_propTypes.default.any,frozenFooterColumnGroup:_propTypes.default.any,rowExpansionTemplate:_propTypes.default.func,expandedRows:_propTypes.default.oneOfType([_propTypes.default.array,_propTypes.default.object]),onRowToggle:_propTypes.default.func,resizableColumns:_propTypes.default.bool,columnResizeMode:_propTypes.default.string,reorderableColumns:_propTypes.default.bool,filters:_propTypes.default.object,globalFilter:_propTypes.default.any,filterLocale:_propTypes.default.string,scrollable:_propTypes.default.bool,scrollHeight:_propTypes.default.string,virtualScroll:_propTypes.default.bool,virtualScrollDelay:_propTypes.default.number,virtualRowHeight:_propTypes.default.number,frozenWidth:_propTypes.default.string,frozenValue:_propTypes.default.array,csvSeparator:_propTypes.default.string,exportFilename:_propTypes.default.string,rowGroupMode:_propTypes.default.string,autoLayout:_propTypes.default.bool,rowClassName:_propTypes.default.func,rowGroupHeaderTemplate:_propTypes.default.func,rowGroupFooterTemplate:_propTypes.default.func,loading:_propTypes.default.bool,loadingIcon:_propTypes.default.string,tabIndex:_propTypes.default.string,stateKey:_propTypes.default.string,stateStorage:_propTypes.default.string,editMode:_propTypes.default.string,expandableRowGroups:_propTypes.default.bool,rowHover:_propTypes.default.bool,showSelectionElement:_propTypes.default.func,showRowReorderElement:_propTypes.default.func,onColumnResizeEnd:_propTypes.default.func,onSort:_propTypes.default.func,onPage:_propTypes.default.func,onFilter:_propTypes.default.func,onVirtualScroll:_propTypes.default.func,onRowClick:_propTypes.default.func,onRowDoubleClick:_propTypes.default.func,onRowSelect:_propTypes.default.func,onRowUnselect:_propTypes.default.func,onRowExpand:_propTypes.default.func,onRowCollapse:_propTypes.default.func,onContextMenu:_propTypes.default.func,onColReorder:_propTypes.default.func,onRowReorder:_propTypes.default.func,onValueChange:_propTypes.default.func,rowEditorValidator:_propTypes.default.func,onRowEditInit:_propTypes.default.func,onRowEditSave:_propTypes.default.func,onRowEditCancel:_propTypes.default.func,exportFunction:_propTypes.default.func,customSaveState:_propTypes.default.func,customRestoreState:_propTypes.default.func,onStateSave:_propTypes.default.func,onStateRestore:_propTypes.default.func});