"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultiSelect=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_DomHandler=_interopRequireDefault(require("../utils/DomHandler")),_ObjectUtils=_interopRequireDefault(require("../utils/ObjectUtils")),_classnames=_interopRequireDefault(require("classnames")),_MultiSelectPanel=require("./MultiSelectPanel"),_MultiSelectItem=require("./MultiSelectItem"),_MultiSelectHeader=require("./MultiSelectHeader"),_Tooltip=_interopRequireDefault(require("../tooltip/Tooltip"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={};if(null!=e){var n,l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((n=l?Object.getOwnPropertyDescriptor(e,o):null)&&(n.get||n.set)?Object.defineProperty(i,o,n):i[o]=e[o])}}return i.default=e,t&&t.set(e,i),i}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var MultiSelect=function(){function i(e){var t;return _classCallCheck(this,i),(t=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,e))).state={filter:""},t.onClick=t.onClick.bind(_assertThisInitialized(t)),t.onPanelClick=t.onPanelClick.bind(_assertThisInitialized(t)),t.onOptionClick=t.onOptionClick.bind(_assertThisInitialized(t)),t.onOptionKeyDown=t.onOptionKeyDown.bind(_assertThisInitialized(t)),t.onFocus=t.onFocus.bind(_assertThisInitialized(t)),t.onBlur=t.onBlur.bind(_assertThisInitialized(t)),t.onFilter=t.onFilter.bind(_assertThisInitialized(t)),t.onCloseClick=t.onCloseClick.bind(_assertThisInitialized(t)),t.onToggleAll=t.onToggleAll.bind(_assertThisInitialized(t)),t}return _inherits(i,_react.Component),_createClass(i,[{key:"onOptionClick",value:function(e){var t=this.getOptionValue(e.option),i=this.findSelectionIndex(t),n=-1!==i?this.props.value.filter(function(e,t){return t!==i}):[].concat(_toConsumableArray(this.props.value||[]),[t]);this.updateModel(e.originalEvent,n)}},{key:"onOptionKeyDown",value:function(e){var t=e.originalEvent.currentTarget;switch(e.originalEvent.which){case 40:var i=this.findNextItem(t);i&&i.focus(),e.originalEvent.preventDefault();break;case 38:var n=this.findPrevItem(t);n&&n.focus(),e.originalEvent.preventDefault();break;case 13:this.onOptionClick(e),e.originalEvent.preventDefault()}}},{key:"findNextItem",value:function(e){var t=e.nextElementSibling;return t?_DomHandler.default.hasClass(t,"p-multiselect-item")?t:this.findNextItem(t):null}},{key:"findPrevItem",value:function(e){var t=e.previousElementSibling;return t?_DomHandler.default.hasClass(t,"p-multiselect-item")?t:this.findPrevItem(t):null}},{key:"onClick",value:function(){this.props.disabled||(this.documentClickListener&&(this.selfClick=!0),this.panelClick||(this.panel.element.offsetParent?this.hide():(this.focusInput.focus(),this.show())))}},{key:"onToggleAll",value:function(e){var t;if(e.checked)t=[];else{var i=this.hasFilter()?this.filterOptions(this.props.options):this.props.options;if(i){var n=!0,l=!(t=[]),o=void 0;try{for(var r,s=i[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value;t.push(this.getOptionValue(a))}}catch(e){l=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(l)throw o}}}}this.updateModel(e.originalEvent,t)}},{key:"updateModel",value:function(e,t){this.props.onChange&&this.props.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:t}})}},{key:"onFilter",value:function(e){this.setState({filter:e.query})}},{key:"onPanelClick",value:function(){this.panelClick=!0}},{key:"show",value:function(){var e=this;this.props.options&&this.props.options.length&&(this.panel.element.style.zIndex=String(_DomHandler.default.generateZIndex()),this.panel.element.style.display="block",setTimeout(function(){_DomHandler.default.addClass(e.panel.element,"p-input-overlay-visible"),_DomHandler.default.removeClass(e.panel.element,"p-input-overlay-hidden")},1),this.alignPanel(),this.bindDocumentClickListener())}},{key:"hide",value:function(){var e=this;_DomHandler.default.addClass(this.panel.element,"p-input-overlay-hidden"),_DomHandler.default.removeClass(this.panel.element,"p-input-overlay-visible"),this.unbindDocumentClickListener(),this.clearClickState(),setTimeout(function(){e.panel.element.style.display="none",_DomHandler.default.removeClass(e.panel.element,"p-input-overlay-hidden")},150)}},{key:"alignPanel",value:function(){this.props.appendTo?(this.panel.element.style.minWidth=_DomHandler.default.getWidth(this.container)+"px",_DomHandler.default.absolutePosition(this.panel.element,this.container)):_DomHandler.default.relativePosition(this.panel.element,this.container)}},{key:"onCloseClick",value:function(e){this.hide(),e.preventDefault(),e.stopPropagation()}},{key:"findSelectionIndex",value:function(e){var t=-1;if(this.props.value)for(var i=0;i<this.props.value.length;i++)if(_ObjectUtils.default.equals(this.props.value[i],e,this.props.dataKey)){t=i;break}return t}},{key:"isSelected",value:function(e){return-1!==this.findSelectionIndex(this.getOptionValue(e))}},{key:"findLabelByValue",value:function(e){for(var t=null,i=0;i<this.props.options.length;i++){var n=this.props.options[i],l=this.getOptionValue(n);if(_ObjectUtils.default.equals(l,e)){t=this.getOptionLabel(n);break}}return t}},{key:"onFocus",value:function(e){_DomHandler.default.addClass(this.container,"p-focus"),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){_DomHandler.default.removeClass(this.container,"p-focus"),this.props.onBlur&&this.props.onBlur(e)}},{key:"bindDocumentClickListener",value:function(){this.documentClickListener||(this.documentClickListener=this.onDocumentClick.bind(this),document.addEventListener("click",this.documentClickListener))}},{key:"unbindDocumentClickListener",value:function(){this.documentClickListener&&(document.removeEventListener("click",this.documentClickListener),this.documentClickListener=null)}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(e){e.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip())}},{key:"componentWillUnmount",value:function(){this.unbindDocumentClickListener(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"onDocumentClick",value:function(){this.selfClick||this.panelClick||!this.panel.element.offsetParent||this.hide(),this.clearClickState()}},{key:"clearClickState",value:function(){this.selfClick=!1,this.panelClick=!1}},{key:"filterOption",value:function(e){var t=this.state.filter.trim().toLowerCase();return-1<this.getOptionLabel(e).toLowerCase().indexOf(t.toLowerCase())}},{key:"hasFilter",value:function(){return this.state.filter&&0<this.state.filter.trim().length}},{key:"isAllChecked",value:function(e){return this.hasFilter()?this.props.value&&e&&e.length&&this.props.value.length===e.length:this.props.value&&this.props.options&&this.props.value.length===this.props.options.length}},{key:"filterOptions",value:function(e){var t=this;return e.filter(function(e){return t.filterOption(e)})}},{key:"getOptionValue",value:function(e){return this.props.optionLabel?e:e.value}},{key:"getOptionLabel",value:function(e){return this.props.optionLabel?_ObjectUtils.default.resolveFieldData(e,this.props.optionLabel):e.label}},{key:"isEmpty",value:function(){return!this.props.value||0===this.props.value.length}},{key:"getSelectedItemsLabel",value:function(){var e=/{(.*?)}/;return e.test(this.props.selectedItemsLabel)?this.props.selectedItemsLabel.replace(this.props.selectedItemsLabel.match(e)[0],this.props.value.length+""):this.props.selectedItemsLabel}},{key:"getLabel",value:function(){var e;if(this.isEmpty()||this.props.fixedPlaceholder)return e;e="";for(var t=0;t<this.props.value.length;t++)0!==t&&(e+=","),e+=this.findLabelByValue(this.props.value[t]);return this.props.value.length<=this.props.maxSelectedLabels?e:this.getSelectedItemsLabel()}},{key:"getLabelContent",value:function(){var i=this;return this.props.selectedItemTemplate?this.isEmpty()?this.props.selectedItemTemplate():this.props.value.length<=this.props.maxSelectedLabels?this.props.value.map(function(e,t){return _react.default.createElement(_react.default.Fragment,{key:t},i.props.selectedItemTemplate(e))}):this.getSelectedItemsLabel():this.getLabel()}},{key:"renderTooltip",value:function(){this.tooltip=new _Tooltip.default({target:this.container,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"renderHeader",value:function(e){return _react.default.createElement(_MultiSelectHeader.MultiSelectHeader,{filter:this.props.filter,filterValue:this.state.filter,onFilter:this.onFilter,onClose:this.onCloseClick,onToggleAll:this.onToggleAll,allChecked:this.isAllChecked(e)})}},{key:"renderLabel",value:function(){var e=this.isEmpty(),t=this.getLabelContent(),i=(0,_classnames.default)("p-multiselect-label",{"p-placeholder":e&&this.props.placeholder,"p-multiselect-label-empty":e&&!this.props.placeholder&&!this.props.selectedItemTemplate});return _react.default.createElement("div",{className:"p-multiselect-label-container"},_react.default.createElement("label",{className:i},t||this.props.placeholder||"empty"))}},{key:"render",value:function(){var n=this,e=(0,_classnames.default)("p-multiselect p-component",this.props.className,{"p-disabled":this.props.disabled}),t=this.renderLabel(),i=this.props.options;i&&(this.hasFilter()&&(i=this.filterOptions(i)),i=i.map(function(e,t){var i=n.getOptionLabel(e);return _react.default.createElement(_MultiSelectItem.MultiSelectItem,{key:i+"_"+t,label:i,option:e,template:n.props.itemTemplate,selected:n.isSelected(e),onClick:n.onOptionClick,onKeyDown:n.onOptionKeyDown,tabIndex:n.props.tabIndex})}));var l=this.renderHeader(i);return _react.default.createElement("div",{id:this.props.id,className:e,onClick:this.onClick,ref:function(e){return n.container=e},style:this.props.style},_react.default.createElement("div",{className:"p-hidden-accessible"},_react.default.createElement("input",{readOnly:!0,type:"text",onFocus:this.onFocus,onBlur:this.onBlur,ref:function(e){return n.focusInput=e}})),t,_react.default.createElement("div",{className:"p-multiselect-trigger"},_react.default.createElement("span",{className:"p-multiselect-trigger-icon pi pi-chevron-down p-c"})),_react.default.createElement(_MultiSelectPanel.MultiSelectPanel,{ref:function(e){return n.panel=e},header:l,appendTo:this.props.appendTo,onClick:this.onPanelClick,scrollHeight:this.props.scrollHeight},i))}}]),i}();_defineProperty(exports.MultiSelect=MultiSelect,"defaultProps",{id:null,value:null,options:null,optionLabel:null,style:null,className:null,scrollHeight:"200px",placeholder:null,fixedPlaceholder:!1,disabled:!1,filter:!1,tabIndex:"0",dataKey:null,appendTo:null,tooltip:null,tooltipOptions:null,maxSelectedLabels:3,selectedItemsLabel:"{0} items selected",itemTemplate:null,selectedItemTemplate:null,onChange:null,onFocus:null,onBlur:null}),_defineProperty(MultiSelect,"propTypes",{id:_propTypes.default.string,value:_propTypes.default.any,options:_propTypes.default.array,optionLabel:_propTypes.default.string,style:_propTypes.default.object,className:_propTypes.default.string,scrollHeight:_propTypes.default.string,placeholder:_propTypes.default.string,fixedPlaceholder:_propTypes.default.bool,disabled:_propTypes.default.bool,filter:_propTypes.default.bool,tabIndex:_propTypes.default.string,dataKey:_propTypes.default.string,appendTo:_propTypes.default.object,tooltip:_propTypes.default.string,tooltipOptions:_propTypes.default.object,maxSelectedLabels:_propTypes.default.number,selectedItemsLabel:_propTypes.default.string,itemTemplate:_propTypes.default.func,selectedItemTemplate:_propTypes.default.func,onChange:_propTypes.default.func,onFocus:_propTypes.default.func,onBlur:_propTypes.default.func});