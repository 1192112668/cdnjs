"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HeaderCell=void 0;var _react=_interopRequireWildcard(require("react")),_InputText=require("../inputtext/InputText"),_classnames=_interopRequireDefault(require("classnames")),_RowCheckbox=require("./RowCheckbox"),_DomHandler=_interopRequireDefault(require("../utils/DomHandler"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){Object.prototype.hasOwnProperty.call(e,s)&&((r=n?Object.getOwnPropertyDescriptor(e,s):null)&&(r.get||r.set)?Object.defineProperty(o,s,r):o[s]=e[s])}return o.default=e,t&&t.set(e,o),o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,_isNativeReflectConstruct()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var HeaderCell=function(){_inherits(o,_react.Component);var r=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=r.call(this,e)).state={badgeVisible:!1},t.onClick=t.onClick.bind(_assertThisInitialized(t)),t.onFilterInput=t.onFilterInput.bind(_assertThisInitialized(t)),t.onMouseDown=t.onMouseDown.bind(_assertThisInitialized(t)),t.onResizerMouseDown=t.onResizerMouseDown.bind(_assertThisInitialized(t)),t.onKeyDown=t.onKeyDown.bind(_assertThisInitialized(t)),t}return _createClass(o,[{key:"onClick",value:function(e){var t;this.props.columnProps.sortable&&(t=e.target,(_DomHandler.default.hasClass(t,"p-sortable-column")||_DomHandler.default.hasClass(t,"p-column-title")||_DomHandler.default.hasClass(t,"p-sortable-column-icon")||_DomHandler.default.hasClass(t.parentElement,"p-sortable-column-icon"))&&(this.props.onSort({originalEvent:e,sortField:this.props.columnProps.sortField||this.props.columnProps.field,sortFunction:this.props.columnProps.sortFunction,sortable:this.props.columnProps.sortable}),_DomHandler.default.clearSelection()))}},{key:"onFilterInput",value:function(e){var t,r=this;this.props.columnProps.filter&&this.props.onFilter&&(this.filterTimeout&&clearTimeout(this.filterTimeout),t=e.target.value,this.filterTimeout=setTimeout(function(){r.props.onFilter({value:t,field:r.props.columnProps.filterField||r.props.columnProps.field,matchMode:r.props.columnProps.filterMatchMode}),r.filterTimeout=null},this.filterDelay))}},{key:"onResizerMouseDown",value:function(e){this.props.resizableColumns&&this.props.onColumnResizeStart&&(this.props.onColumnResizeStart({originalEvent:e,columnEl:e.target.parentElement,columnProps:this.props.columnProps}),e.preventDefault())}},{key:"onMouseDown",value:function(e){this.props.reorderableColumns&&this.props.columnProps.reorderable&&("INPUT"!==e.target.nodeName?this.el.draggable=!0:"INPUT"===e.target.nodeName&&(this.el.draggable=!1))}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&e.currentTarget===this.el&&(this.onClick(e),e.preventDefault())}},{key:"getMultiSortMetaDataIndex",value:function(){if(this.props.multiSortMeta)for(var e=this.props.columnProps.sortField||this.props.columnProps.field,t=0;t<this.props.multiSortMeta.length;t++)if(this.props.multiSortMeta[t].field===e)return t;return-1}},{key:"getAriaSort",value:function(e,t){if(this.props.columnProps.sortable){var r=e?t<0?"pi-sort-amount-down":"pi-sort-amount-up-alt":"pi-sort-alt";return"pi-sort-down"==r?"descending":"pi-sort-up"==r?"ascending":"none"}return null}},{key:"renderSortIcon",value:function(e,t){if(this.props.columnProps.sortable){var r=e?t<0?"pi-sort-amount-down":"pi-sort-amount-up-alt":"pi-sort-alt",o=(0,_classnames.default)("p-sortable-column-icon pi pi-fw",r);return _react.default.createElement("span",{className:o})}return null}},{key:"renderSortBadge",value:function(e){return-1!==e&&this.state.badgeVisible?_react.default.createElement("span",{className:"p-sortable-column-badge"},e+1):null}},{key:"render",value:function(){var e,t,r,o=this;if(this.props.columnProps.filter&&this.props.renderOptions.renderFilter&&(t=this.props.columnProps.filterField||this.props.columnProps.field,r=this.props.columnProps.filterElement||_react.default.createElement(_InputText.InputText,{onInput:this.onFilterInput,type:this.props.columnProps.filterType,defaultValue:this.props.filters&&this.props.filters[t]?this.props.filters[t].value:null,className:"p-column-filter",placeholder:this.props.columnProps.filterPlaceholder,maxLength:this.props.columnProps.filterMaxLength})),"multiple"===this.props.columnProps.selectionMode&&this.props.renderOptions.renderHeaderCheckbox&&(e=_react.default.createElement(_RowCheckbox.RowCheckbox,{onClick:this.props.onHeaderCheckboxClick,selected:this.props.headerCheckboxSelected,disabled:!this.props.value||0===this.props.value.length})),this.props.renderOptions.filterOnly)return _react.default.createElement("th",{ref:function(e){return o.el=e},className:(0,_classnames.default)("p-filter-column",this.props.columnProps.filterHeaderClassName),style:this.props.columnProps.filterHeaderStyle||this.props.columnProps.style,colSpan:this.props.columnProps.colSpan,rowSpan:this.props.columnProps.rowSpan},r,e);var n=this.getMultiSortMetaDataIndex(),s=-1!==n?this.props.multiSortMeta[n]:null,i=null!==this.props.sortField&&(this.props.columnProps.field===this.props.sortField||this.props.columnProps.sortField===this.props.sortField),l=null!==s,p=0,a=this.props.resizableColumns&&_react.default.createElement("span",{className:"p-column-resizer p-clickable",onMouseDown:this.onResizerMouseDown});i?p=this.props.sortOrder:l&&(p=s.order);var u=this.props.columnProps.sortable&&(i||l),c=(0,_classnames.default)({"p-sortable-column":this.props.columnProps.sortable,"p-highlight":u,"p-resizable-column":this.props.resizableColumns,"p-selection-column":this.props.columnProps.selectionMode},this.props.columnProps.headerClassName||this.props.columnProps.className),f=this.renderSortIcon(u,p),h=this.getAriaSort(u,p),d=this.renderSortBadge(n);return _react.default.createElement("th",{ref:function(e){return o.el=e},tabIndex:this.props.columnProps.sortable?this.props.columnProps.tabIndex:null,className:c,style:this.props.columnProps.headerStyle||this.props.columnProps.style,onClick:this.onClick,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyDown,colSpan:this.props.columnProps.colSpan,rowSpan:this.props.columnProps.rowSpan,"aria-sort":h,onDragStart:this.props.onDragStart,onDragOver:this.props.onDragOver,onDragLeave:this.props.onDragLeave,onDrop:this.props.onDrop},a,_react.default.createElement("span",{className:"p-column-title"},this.props.columnProps.header),f,d,r,e)}}],[{key:"getDerivedStateFromProps",value:function(e){return{badgeVisible:e.multiSortMeta&&1<e.multiSortMeta.length}}}]),o}();exports.HeaderCell=HeaderCell;