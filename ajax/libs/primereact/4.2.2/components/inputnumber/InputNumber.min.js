"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InputNumber=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactDom=_interopRequireDefault(require("react-dom")),_InputText=require("../inputtext/InputText"),_classnames=_interopRequireDefault(require("classnames")),_Tooltip=_interopRequireDefault(require("../tooltip/Tooltip"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var n,i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t){Object.prototype.hasOwnProperty.call(t,o)&&((n=r?Object.getOwnPropertyDescriptor(t,o):null)&&(n.get||n.set)?Object.defineProperty(i,o,n):i[o]=t[o])}return i.default=t,e&&e.set(t,i),i}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(n){var i=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(n);return _possibleConstructorReturn(this,i?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var InputNumber=function(){_inherits(i,_react.Component);var n=_createSuper(i);function i(t){var e;return _classCallCheck(this,i),(e=n.call(this,t)).constructParser(),e.onInput=e.onInput.bind(_assertThisInitialized(e)),e.onInputKeyDown=e.onInputKeyDown.bind(_assertThisInitialized(e)),e.onInputKeyPress=e.onInputKeyPress.bind(_assertThisInitialized(e)),e.onInputClick=e.onInputClick.bind(_assertThisInitialized(e)),e.onInputBlur=e.onInputBlur.bind(_assertThisInitialized(e)),e.onInputFocus=e.onInputFocus.bind(_assertThisInitialized(e)),e.onPaste=e.onPaste.bind(_assertThisInitialized(e)),e.onUpButtonMouseLeave=e.onUpButtonMouseLeave.bind(_assertThisInitialized(e)),e.onUpButtonMouseDown=e.onUpButtonMouseDown.bind(_assertThisInitialized(e)),e.onUpButtonMouseUp=e.onUpButtonMouseUp.bind(_assertThisInitialized(e)),e.onUpButtonKeyDown=e.onUpButtonKeyDown.bind(_assertThisInitialized(e)),e.onUpButtonKeyUp=e.onUpButtonKeyUp.bind(_assertThisInitialized(e)),e.onDownButtonMouseLeave=e.onDownButtonMouseLeave.bind(_assertThisInitialized(e)),e.onDownButtonMouseDown=e.onDownButtonMouseDown.bind(_assertThisInitialized(e)),e.onDownButtonMouseUp=e.onDownButtonMouseUp.bind(_assertThisInitialized(e)),e.onDownButtonKeyDown=e.onDownButtonKeyDown.bind(_assertThisInitialized(e)),e.onDownButtonKeyUp=e.onDownButtonKeyUp.bind(_assertThisInitialized(e)),e}return _createClass(i,[{key:"getOptions",value:function(){return{localeMatcher:this.props.localeMatcher,style:this.props.mode,currency:this.props.currency,currencyDisplay:this.props.currencyDisplay,useGrouping:this.props.useGrouping,minimumFractionDigits:this.props.minFractionDigits,maximumFractionDigits:this.props.maxFractionDigits}}},{key:"constructParser",value:function(){this.numberFormat=new Intl.NumberFormat(this.props.locale,this.getOptions());var t=_toConsumableArray(new Intl.NumberFormat(this.props.locale,{useGrouping:!1}).format(9876543210)).reverse(),e=new Map(t.map(function(t,e){return[t,e]}));this._numeral=new RegExp("[".concat(t.join(""),"]"),"g"),this._decimal=this.getDecimalExpression(),this._group=this.getGroupingExpression(),this._minusSign=this.getMinusSignExpression(),this._currency=this.getCurrencyExpression(),this._suffix=new RegExp("[".concat(this.props.suffix||"","]"),"g"),this._prefix=new RegExp("[".concat(this.props.prefix||"","]"),"g"),this._index=function(t){return e.get(t)}}},{key:"getDecimalExpression",value:function(){var t=new Intl.NumberFormat(this.props.locale,{useGrouping:!1});return new RegExp("[".concat(t.format(1.1).trim().replace(this._numeral,""),"]"),"g")}},{key:"getGroupingExpression",value:function(){var t=new Intl.NumberFormat(this.props.locale,{useGrouping:!0});return new RegExp("[".concat(t.format(1e3).trim().replace(this._numeral,""),"]"),"g")}},{key:"getMinusSignExpression",value:function(){var t=new Intl.NumberFormat(this.props.locale,{useGrouping:!1});return new RegExp("[".concat(t.format(-1).trim().replace(this._numeral,""),"]"),"g")}},{key:"getCurrencyExpression",value:function(){if(this.props.currency){var t=new Intl.NumberFormat(this.props.locale,{style:"currency",currency:this.props.currency,currencyDisplay:this.props.currencyDisplay});return new RegExp("[".concat(t.format(1).replace(/\s/g,"").replace(this._numeral,"").replace(this._decimal,"").replace(this._group,""),"]"),"g")}return new RegExp("[]","g")}},{key:"formatValue",value:function(t){if(null==t)return"";if(this.props.format){var e=new Intl.NumberFormat(this.props.locale,this.getOptions()).format(t);return this.props.prefix&&(e=this.props.prefix+e),this.props.suffix&&(e+=this.props.suffix),e}return t}},{key:"parseValue",value:function(t){var e=t.trim().replace(/\s/g,"").replace(this._currency,"").replace(this._group,"").replace(this._suffix,"").replace(this._prefix,"").replace(this._minusSign,"-").replace(this._decimal,".").replace(this._numeral,this._index);if(e){var n=+e;return isNaN(n)?null:n}return null}},{key:"repeat",value:function(t,e,n){var i=this,r=e||500;this.clearTimer(),this.timer=setTimeout(function(){i.repeat(t,40,n)},r),this.spin(t,n)}},{key:"spin",value:function(t,e){var n=this.props.step*e,i=(this.props.value||0)+n;null!==this.props.min&&i<this.props.min&&(i=this.props.min),null!==this.props.max&&i>this.props.max&&(i=this.props.max),this.updateInput(i,"spin"),this.updateModel(t,i)}},{key:"onUpButtonMouseDown",value:function(t){this.props.disabled||(this.inputEl.focus(),this.repeat(t,null,1),t.preventDefault())}},{key:"onUpButtonMouseUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onUpButtonMouseLeave",value:function(){this.props.disabled||this.clearTimer()}},{key:"onUpButtonKeyUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onUpButtonKeyDown",value:function(t){32!==t.keyCode&&13!==t.keyCode||this.repeat(t,null,1)}},{key:"onDownButtonMouseDown",value:function(t){this.props.disabled||(this.inputEl.focus(),this.repeat(t,null,-1),t.preventDefault())}},{key:"onDownButtonMouseUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onDownButtonMouseLeave",value:function(){this.props.disabled||this.clearTimer()}},{key:"onDownButtonKeyUp",value:function(){this.props.disabled||this.clearTimer()}},{key:"onDownButtonKeyDown",value:function(t){32!==t.keyCode&&13!==t.keyCode||this.repeat(t,null,-1)}},{key:"onInput",value:function(t){this.isSpecialChar&&(t.target.value=this.lastValue),this.isSpecialChar=!1}},{key:"onInputKeyDown",value:function(t){if(this.lastValue=t.target.value,t.shiftKey||t.altKey)this.isSpecialChar=!0;else{var e=t.target.selectionStart,n=t.target.selectionEnd,i=t.target.value;switch(t.altKey&&t.preventDefault(),t.which){case 38:this.spin(t,1),t.preventDefault();break;case 40:this.spin(t,-1),t.preventDefault();break;case 37:var r=i.charAt(e-1);this.isNumeralChar(r)||t.preventDefault();break;case 39:var o=i.charAt(e);this.isNumeralChar(o)||t.preventDefault();break;case 8:t.preventDefault();var s,u,a=null;e===n?(s=i.charAt(e-1),u=i.search(this._decimal),this._decimal.lastIndex=0,this.isNumeralChar(s)&&(this._group.test(s)?(this._group.lastIndex=0,a=i.slice(0,e-2)+i.slice(e-1)):this._decimal.test(s)?(this._decimal.lastIndex=0,this.inputEl.setSelectionRange(e-1,e-1)):a=0<u&&u<e?i.slice(0,e-1)+"0"+i.slice(e):i.slice(0,e-1)+i.slice(e)),null!=a&&this.updateValue(t,a,"delete-single")):(a=this.deleteRange(i,e,n),this.updateValue(t,a,"delete-range"))}}}},{key:"onInputKeyPress",value:function(t){t.preventDefault();var e=t.which||t.keyCode,n=String.fromCharCode(e);(48<=e&&e<=57||this.isMinusSign(n))&&this.insert(t,n)}},{key:"onPaste",value:function(t){t.preventDefault();var e,n=(t.clipboardData||window.clipboardData).getData("Text");!n||null!=(e=this.parseValue(n))&&this.insert(t,e.toString())}},{key:"isMinusSign",value:function(t){return!!this._minusSign.test(t)&&!(this._minusSign.lastIndex=0)}},{key:"insert",value:function(t,e){var n,i=this.inputEl.selectionStart,r=this.inputEl.selectionEnd,o=this.inputEl.value.trim(),s=this.numberFormat.resolvedOptions().maximumFractionDigits,u=o.search(this._decimal);(this._decimal.lastIndex=0)<u&&u<i?i+e.length-(u+1)<=s&&(n=o.slice(0,i)+e+o.slice(i+e.length),this.updateValue(t,n,"insert")):(n=this.insertText(o,e,i,r),this.updateValue(t,n,"insert"))}},{key:"insertText",value:function(t,e,n,i){var r=i-n===t.length?e:0===n?e+t.slice(i):i===t.length?t.slice(0,n)+e:t.slice(0,n)+e+t.slice(i);return r}},{key:"deleteRange",value:function(t,e,n){var i=n-e===t.length?"":0===e?t.slice(n):n===t.length?t.slice(0,e):t.slice(0,e)+t.slice(n);return i}},{key:"initCursor",value:function(){var t=this.inputEl.selectionStart,e=this.inputEl.value,n=e.length,i=null,r=e.charAt(t);if(!this.isNumeralChar(r)){for(var o=t-1;0<=o;){if(r=e.charAt(o),this.isNumeralChar(r)){i=o;break}o--}if(null!==i)this.inputEl.setSelectionRange(i+1,i+1);else{for(o=t+1;o<n;){if(r=e.charAt(o),this.isNumeralChar(r)){i=o;break}o++}null!==i&&this.inputEl.setSelectionRange(i,i)}}}},{key:"onInputClick",value:function(){this.initCursor()}},{key:"isNumeralChar",value:function(t){return!(1!==t.length||!(this._numeral.test(t)||this._decimal.test(t)||this._group.test(t)||this._minusSign.test(t)))&&(this.resetRegex(),!0)}},{key:"resetRegex",value:function(){this._numeral.lastIndex=0,this._decimal.lastIndex=0,this._group.lastIndex=0,this._minusSign.lastIndex=0}},{key:"updateValue",value:function(t,e,n){var i;null!=e&&(i=this.parseValue(e),this.isWithinRange(i)&&(this.updateInput(i,n),this.updateModel(t,i)))}},{key:"isWithinRange",value:function(t){return null==t||(null==this.props.min||t>this.props.min)&&(null==this.props.max||t<this.props.max)}},{key:"updateInput",value:function(t,e){var n,i,r,o=this.inputEl.value.length;0===o?(this.inputEl.value=this.formatValue(t),this.inputEl.setSelectionRange(0,0),this.initCursor(),this.inputEl.setSelectionRange(this.inputEl.selectionStart+1,this.inputEl.selectionStart+1)):(n=this.inputEl.selectionEnd,i=this.inputEl.selectionEnd,this.inputEl.value=this.formatValue(t),(r=this.inputEl.value.length)===o?"insert"===e?this.inputEl.setSelectionRange(i+1,i+1):"delete-single"===e?this.inputEl.setSelectionRange(i-1,i-1):"delete-range"===e?this.inputEl.setSelectionRange(n,n):"spin"===e&&this.inputEl.setSelectionRange(n,i):(i+=r-o,this.inputEl.setSelectionRange(i,i))),this.inputEl.setAttribute("aria-valuenow",t)}},{key:"updateModel",value:function(t,e){this.props.onChange&&this.props.onChange({originalEvent:t,value:e,stopPropagation:function(){},preventDefault:function(){},target:{name:this.props.name,id:this.props.id,value:e}})}},{key:"onInputFocus",value:function(t){this.focus=!0,this.props.onFocus&&this.props.onFocus(t)}},{key:"onInputBlur",value:function(t){this.focus=!1,this.props.onBlur&&this.props.onBlur(t)}},{key:"clearTimer",value:function(){this.timer&&clearInterval(this.timer)}},{key:"isStacked",value:function(){return this.props.showButtons&&"stacked"===this.props.buttonLayout}},{key:"isHorizontal",value:function(){return this.props.showButtons&&"horizontal"===this.props.buttonLayout}},{key:"isVertical",value:function(){return this.props.showButtons&&"vertical"===this.props.buttonLayout}},{key:"getInputMode",value:function(){return this.props.inputMode||("decimal"!==this.props.mode||this.props.minFractionDigits?"decimal":"numeric")}},{key:"componentDidMount",value:function(){this.props.tooltip&&this.renderTooltip()}},{key:"componentDidUpdate",value:function(t){t.tooltip!==this.props.tooltip&&(this.tooltip?this.tooltip.updateContent(this.props.tooltip):this.renderTooltip());var e=this.formatValue(this.props.value);this.inputEl.value!==e&&(this.inputEl.value=e,this.inputEl.setAttribute("aria-valuenow",this.props.value))}},{key:"componentWillUnmount",value:function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)}},{key:"renderTooltip",value:function(){this.tooltip=new _Tooltip.default({target:this.element,content:this.props.tooltip,options:this.props.tooltipOptions})}},{key:"renderInputElement",value:function(){var e=this,t=(0,_classnames.default)("p-inputnumber-input",this.props.inputClassName),n=this.formatValue(this.props.value);return _react.default.createElement(_InputText.InputText,{ref:function(t){return e.inputEl=_reactDom.default.findDOMNode(t)},id:this.props.inputId,style:this.props.inputStyle,role:"spinbutton",className:t,defaultValue:n,type:this.props.type,size:this.props.size,tabIndex:this.props.tabIndex,inputMode:this.getInputMode(),maxLength:this.props.maxlength,disabled:this.props.disabled,required:this.props.required,pattern:this.props.pattern,placeholder:this.props.placeholder,readOnly:this.props.readonly,name:this.props.name,onKeyDown:this.onInputKeyDown,onKeyPress:this.onInputKeyPress,onInput:this.onInput,onClick:this.onInputClick,onBlur:this.onInputBlur,onFocus:this.onInputFocus,onPaste:this.onPaste,"aria-valuemin":this.props.min,"aria-valuemax":this.props.max,"aria-valuenow":this.props.value,"aria-labelledby":this.props.ariaLabelledBy})}},{key:"renderUpButton",value:function(){var t=(0,_classnames.default)("p-inputnumber-button p-inputnumber-button-up p-button p-button-icon-only p-component",this.props.incrementButtonClassName,{"p-disabled":this.props.disabled}),e=(0,_classnames.default)("p-inputnumber-button-icon",this.props.incrementButtonIcon);return _react.default.createElement("button",{type:"button",className:t,onMouseLeave:this.onUpButtonMouseLeave,onMouseDown:this.onUpButtonMouseDown,onMouseUp:this.onUpButtonMouseUp,onKeyDown:this.onUpButtonKeyDown,onKeyUp:this.onUpButtonKeyUp,disabled:this.props.disabled,tabIndex:"-1"},_react.default.createElement("span",{className:e}))}},{key:"renderDownButton",value:function(){var t=(0,_classnames.default)("p-inputnumber-button p-inputnumber-button-down p-button p-button-icon-only p-component",this.props.decrementButtonClassName,{"p-disabled":this.props.disabled}),e=(0,_classnames.default)("p-inputnumber-button-icon",this.props.decrementButtonIcon);return _react.default.createElement("button",{type:"button",className:t,onMouseLeave:this.onDownButtonMouseLeave,onMouseDown:this.onDownButtonMouseDown,onMouseUp:this.onDownButtonMouseUp,onKeyDown:this.onDownButtonKeyDown,onKeyUp:this.onDownButtonKeyUp,disabled:this.props.disabled,tabIndex:"-1"},_react.default.createElement("span",{className:e}))}},{key:"renderButtonGroup",value:function(){var t=this.props.showButtons&&this.renderUpButton(),e=this.props.showButtons&&this.renderDownButton();return this.isStacked()?_react.default.createElement("span",{className:"p-inputnumber-button-group"},t,e):_react.default.createElement(_react.default.Fragment,null,t,e)}},{key:"render",value:function(){var e=this,t=(0,_classnames.default)("p-inputnumber p-component",this.props.className,{"p-inputwrapper-filled":null!=this.props.value,"p-inputwrapper-focus":this.focus,"p-inputnumber-buttons-stacked":this.isStacked(),"p-inputnumber-buttons-horizontal":this.isHorizontal(),"p-inputnumber-buttons-vertical":this.isVertical()}),n=this.renderInputElement(),i=this.renderButtonGroup();return _react.default.createElement("span",{ref:function(t){return e.element=t},id:this.props.id,className:t,style:this.props.style},n,i)}}]),i}();_defineProperty(exports.InputNumber=InputNumber,"defaultProps",{value:null,format:!0,showButtons:!1,buttonLayout:"stacked",incrementButtonClassName:null,decrementButtonClassName:null,incrementButtonIcon:"pi pi-caret-up",decrementButtonIcon:"pi pi-caret-down",locale:void 0,localeMatcher:void 0,mode:"decimal",suffix:null,prefix:null,currency:void 0,currencyDisplay:void 0,useGrouping:!0,minFractionDigits:void 0,maxFractionDigits:void 0,id:null,name:null,type:"text",step:1,min:null,max:null,disabled:!1,required:!1,tabIndex:null,pattern:null,inputMode:null,placeholder:null,readonly:!1,size:null,style:null,className:null,inputId:null,inputStyle:null,inputClassName:null,tooltip:null,tooltipOptions:null,ariaLabelledBy:null,onChange:null,onBlur:null,onFocus:null}),_defineProperty(InputNumber,"propTypes",{value:_propTypes.default.number,format:_propTypes.default.bool,showButtons:_propTypes.default.bool,buttonLayout:_propTypes.default.string,incrementButtonClassName:_propTypes.default.string,decrementButtonClassName:_propTypes.default.string,incrementButtonIcon:_propTypes.default.string,decrementButtonIcon:_propTypes.default.string,locale:_propTypes.default.string,localeMatcher:_propTypes.default.string,mode:_propTypes.default.string,suffix:_propTypes.default.string,prefix:_propTypes.default.string,currency:_propTypes.default.string,currencyDisplay:_propTypes.default.string,useGrouping:_propTypes.default.bool,minFractionDigits:_propTypes.default.number,maxFractionDigits:_propTypes.default.number,id:_propTypes.default.string,name:_propTypes.default.string,type:_propTypes.default.string,step:_propTypes.default.number,min:_propTypes.default.number,max:_propTypes.default.number,disabled:_propTypes.default.bool,required:_propTypes.default.bool,tabIndex:_propTypes.default.number,pattern:_propTypes.default.string,inputMode:_propTypes.default.string,placeholder:_propTypes.default.string,readonly:_propTypes.default.bool,size:_propTypes.default.number,style:_propTypes.default.object,className:_propTypes.default.string,inputId:_propTypes.default.string,inputStyle:_propTypes.default.object,inputClassName:_propTypes.default.string,tooltip:_propTypes.default.string,tooltipOptions:_propTypes.default.object,ariaLabelledBy:_propTypes.default.string,onChange:_propTypes.default.func,onBlur:_propTypes.default.func,onFocus:_propTypes.default.func});