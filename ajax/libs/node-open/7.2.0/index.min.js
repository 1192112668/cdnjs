"use strict";const{promisify:promisify}=require("util"),path=require("path"),childProcess=require("child_process"),fs=require("fs"),isWsl=require("is-wsl"),isDocker=require("is-docker"),pAccess=promisify(fs.access),pExecFile=promisify(childProcess.execFile),localXdgOpenPath=path.join(__dirname,"xdg-open"),wslToWindowsPath=async e=>{const{stdout:s}=await pExecFile("wslpath",["-w",e]);return s.trim()};module.exports=(async(e,s)=>{if("string"!=typeof e)throw new TypeError("Expected a `target`");let r,i;s={wait:!1,background:!1,allowNonzeroExitCode:!1,...s};let o=[];const t=[],a={};if(Array.isArray(s.app)&&(o=s.app.slice(1),i=s.app[0]),"darwin"===process.platform)r="open",s.wait&&t.push("--wait-apps"),s.background&&t.push("--background"),i&&t.push("-a",i);else if("win32"===process.platform||isWsl&&!isDocker()){r="powershell"+(isWsl?".exe":""),t.push("-NoProfile","-NonInteractive","â€“ExecutionPolicy","Bypass","-EncodedCommand"),isWsl||(a.windowsVerbatimArguments=!0);const n=["Start"];if(s.wait&&n.push("-Wait"),i){if(isWsl&&i.startsWith("/mnt/")){i=await wslToWindowsPath(i)}n.push(`"\`"${i}\`""`,"-ArgumentList"),o.unshift(e)}else n.push(`"\`"${e}\`""`);o.length>0&&(o=o.map(e=>`"\`"${e}\`""`),n.push(o.join(","))),e=Buffer.from(n.join(" "),"utf16le").toString("base64")}else{if(i)r=i;else{const e=!__dirname||"/"===__dirname;let s=!1;try{await pAccess(localXdgOpenPath,fs.constants.X_OK),s=!0}catch(e){}r=process.versions.electron||"android"===process.platform||e||!s?"xdg-open":localXdgOpenPath}o.length>0&&t.push(...o),s.wait||(a.stdio="ignore",a.detached=!0)}t.push(e),"darwin"===process.platform&&o.length>0&&t.push("--args",...o);const n=childProcess.spawn(r,t,a);return s.wait?new Promise((e,r)=>{n.once("error",r),n.once("close",i=>{s.allowNonzeroExitCode&&i>0?r(new Error(`Exited with code ${i}`)):e(n)})}):(n.unref(),n)});