"use strict";const{promisify:promisify}=require("util"),path=require("path"),childProcess=require("child_process"),isWsl=require("is-wsl"),pExecFile=promisify(childProcess.execFile),wslToWindowsPath=async s=>{const{stdout:e}=await pExecFile("wslpath",["-w",s]);return e.trim()};module.exports=(async(s,e)=>{if("string"!=typeof s)throw new TypeError("Expected a `target`");let p;e={wait:!1,...e};let r=[];const i=[],t={};if(Array.isArray(e.app)&&(r=e.app.slice(1),e.app=e.app[0]),"darwin"===process.platform)p="open",e.wait&&i.push("-W"),e.app&&i.push("-a",e.app);else if("win32"===process.platform||isWsl){if(p="cmd"+(isWsl?".exe":""),i.push("/c","start",'""',"/b"),s=s.replace(/&/g,"^&"),e.wait&&i.push("/wait"),e.app){if(isWsl&&e.app.startsWith("/mnt/")){const s=await wslToWindowsPath(e.app);e.app=s}i.push(e.app)}r.length>0&&i.push(...r)}else{if(e.app)p=e.app;else{p=process.versions.electron||"android"===process.platform?"xdg-open":path.join(__dirname,"xdg-open")}r.length>0&&i.push(...r),e.wait||(t.stdio="ignore",t.detached=!0)}i.push(s),"darwin"===process.platform&&r.length>0&&i.push("--args",...r);const a=childProcess.spawn(p,i,t);return e.wait?new Promise((s,e)=>{a.once("error",e),a.once("close",p=>{p>0?e(new Error(`Exited with code ${p}`)):s(a)})}):(a.unref(),a)});