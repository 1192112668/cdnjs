"use strict";const{promisify:promisify}=require("util"),path=require("path"),childProcess=require("child_process"),fs=require("fs"),isWsl=require("is-wsl"),pAccess=promisify(fs.access),pExecFile=promisify(childProcess.execFile),localXdgOpenPath=path.join(__dirname,"xdg-open"),wslToWindowsPath=async s=>{const{stdout:e}=await pExecFile("wslpath",["-w",s]);return e.trim()};module.exports=(async(s,e)=>{if("string"!=typeof s)throw new TypeError("Expected a `target`");let r;e={wait:!1,background:!1,url:!1,...e};let p=[];const a=[],t={};if(Array.isArray(e.app)&&(p=e.app.slice(1),e.app=e.app[0]),e.url&&(s=encodeURI(s)),"darwin"===process.platform)r="open",e.wait&&a.push("--wait-apps"),e.background&&a.push("--background"),e.app&&a.push("-a",e.app);else if("win32"===process.platform||isWsl){if(r="cmd"+(isWsl?".exe":""),a.push("/s","/c","start",'""',"/b"),s=`"${s}"`,t.windowsVerbatimArguments=!0,e.wait&&a.push("/wait"),e.app){if(isWsl&&e.app.startsWith("/mnt/")){const s=await wslToWindowsPath(e.app);e.app=s}a.push(e.app)}p.length>0&&a.push(...p)}else{if(e.app)r=e.app;else{const s=!__dirname||"/"===__dirname;let e=!1;try{await pAccess(localXdgOpenPath,fs.constants.X_OK),e=!0}catch(s){}r=process.versions.electron||"android"===process.platform||s||!e?"xdg-open":localXdgOpenPath}p.length>0&&a.push(...p),e.wait||(t.stdio="ignore",t.detached=!0)}a.push(s),"darwin"===process.platform&&p.length>0&&a.push("--args",...p);const i=childProcess.spawn(r,a,t);return e.wait?new Promise((s,e)=>{i.once("error",e),i.once("close",r=>{r>0?e(new Error(`Exited with code ${r}`)):s(i)})}):(i.unref(),i)});