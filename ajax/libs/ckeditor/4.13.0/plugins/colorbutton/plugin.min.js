CKEDITOR.plugins.add("colorbutton",{requires:"panelbutton,floatpanel",lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"bgcolor,textcolor",hidpi:!0,init:function(g){function t(t,l,e,o,r){var a,n=new CKEDITOR.style(b["colorButton_"+l+"Style"]),c=CKEDITOR.tools.getNextId()+"_colorBox",s={type:l};r=r||{},g.ui.add(t,CKEDITOR.UI_PANELBUTTON,{label:e,title:e,modes:{wysiwyg:1},editorFocus:0,toolbar:"colors,"+o,allowedContent:n,requiredContent:n,contentTransformations:r.contentTransformations,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":p.panelTitle}},onBlock:function(t,e){(a=e).autoSize=!0,e.element.addClass("cke_colorblock"),e.element.setHtml(function(t,e,o,r){t=[];var n=b.colorButton_colors.split(","),l=b.colorButton_colorsPerRow||6,a=g.plugins.colordialog&&!1!==b.colorButton_enableMore,c=n.length+(a?2:1),s=CKEDITOR.tools.addFunction(function(t,o){function e(t){var e=b["colorButton_"+o+"Style"];g.removeStyle(new CKEDITOR.style(e,{color:"inherit"})),e.childRule="back"==o?d:function(t){return!(t.is("a")||t.getElementsByTag("a").count())||d(t)},g.focus(),t&&g.applyStyle(new CKEDITOR.style(e,{color:t})),g.fire("saveSnapshot")}if(g.focus(),g.fire("saveSnapshot"),"?"!=t)return e(t&&"#"+t);g.getColorFromDialog(function(t){if(t)return e(t)},null,r)});for(!1!==b.colorButton_enableAutomatic&&t.push('<a class="cke_colorauto" _cke_focus=1 hidefocus=true title="',p.auto,'" draggable="false" ondragstart="return false;" onclick="CKEDITOR.tools.callFunction(',s,",null,'",e,"');return false;\" href=\"javascript:void('",p.auto,'\')" role="option" aria-posinset="1" aria-setsize="',c,'"><table role="presentation" cellspacing=0 cellpadding=0 width="100%"><tr><td colspan="'+l+'" align="center"><span class="cke_colorbox" id="',o,'"></span>',p.auto,"</td></tr></table></a>"),t.push('<table role="presentation" cellspacing=0 cellpadding=0 width="100%">'),o=0;o<n.length;o++){0==o%l&&t.push("</tr><tr>");var i=n[o].split("/"),u=i[0],f=i[1]||u;t.push('<td><a class="cke_colorbox" _cke_focus=1 hidefocus=true title="',i[1]?u:g.lang.colorbutton.colors[f]||f,'" draggable="false" ondragstart="return false;" onclick="CKEDITOR.tools.callFunction(',s,",'",f,"','",e,"'); return false;\" href=\"javascript:void('",f,'\')" data-value="'+f+'" role="option" aria-posinset="',o+2,'" aria-setsize="',c,'"><span class="cke_colorbox" style="background-color:#',f,'"></span></a></td>')}return a&&t.push('</tr><tr><td colspan="'+l+'" align="center"><a class="cke_colormore" _cke_focus=1 hidefocus=true title="',p.more,'" draggable="false" ondragstart="return false;" onclick="CKEDITOR.tools.callFunction(',s,",'?','",e,"');return false;\" href=\"javascript:void('",p.more,"')\"",' role="option" aria-posinset="',c,'" aria-setsize="',c,'">',p.more,"</a></td>"),t.push("</tr></table>"),t.join("")}(t,l,c,s)),e.element.getDocument().getBody().setStyle("overflow","hidden"),CKEDITOR.ui.fire("ready",this);var o=e.keys,r="rtl"==g.lang.dir;o[r?37:39]="next",o[40]="next",o[9]="next",o[r?39:37]="prev",o[38]="prev",o[CKEDITOR.SHIFT+9]="prev",o[32]="click"},refresh:function(){g.activeFilter.check(n)||this.setState(CKEDITOR.TRISTATE_DISABLED)},onOpen:function(){var t=(o=g.getSelection())&&o.getStartElement(),e=g.elementPath(t);if(e){for(t=e.block||e.blockLimit||g.document.getBody();e=t&&t.getComputedStyle("back"==l?"background-color":"color")||"transparent","back"==l&&"transparent"==e&&t&&(t=t.getParent()););if(e&&"transparent"!=e||(e="#ffffff"),!1!==b.colorButton_enableAutomatic&&this._.panel._.iframe.getFrameDocument().getById(c).setStyle("background-color",e),t=o&&o.getRanges()[0]){for(var o=new CKEDITOR.dom.walker(t),r=t.collapsed?t.startContainer:o.next(),t="";r;){if(r.type!==CKEDITOR.NODE_ELEMENT&&(r=r.getParent()),r=i(r.getComputedStyle("back"==l?"background-color":"color")),(t=t||r)!==r){t="";break}r=o.next()}for("transparent"==t&&(t=""),"fore"==l&&(s.automaticTextColor="#"+i(e)),s.selectionColor=t?"#"+t:"",o=t,t=a._.getItems(),r=0;r<t.count();r++){var n=t.getItem(r);n.removeAttribute("aria-selected"),o&&o==i(n.getAttribute("data-value"))&&n.setAttribute("aria-selected",!0)}}return e}}})}function d(t){return"false"==t.getAttribute("contentEditable")||t.getAttribute("data-nostyle")}function i(t){return CKEDITOR.tools.normalizeHex("#"+CKEDITOR.tools.convertRgbToHex(t||"")).replace(/#/g,"")}var e,o,b=g.config,p=g.lang.colorbutton;CKEDITOR.env.hc||(t("TextColor","fore",p.textColorTitle,10,{contentTransformations:[[{element:"font",check:"span{color}",left:function(t){return!!t.attributes.color},right:function(t){t.name="span",t.attributes.color&&(t.styles.color=t.attributes.color),delete t.attributes.color}}]]}),e={},void 0!==(o=g.config.colorButton_normalizeBackground)&&!o||(e.contentTransformations=[[{element:"span",left:function(t){var e=CKEDITOR.tools;return!("span"!=t.name||!t.styles||!t.styles.background)&&((t=e.style.parse.background(t.styles.background)).color&&1===e.object.keys(t).length)},right:function(t){var e=new CKEDITOR.style(g.config.colorButton_backStyle,{color:t.styles.background}).getDefinition();return t.name=e.element,t.styles=e.styles,t.attributes=e.attributes||{},t}}]]),t("BGColor","back",p.bgColorTitle,20,e))}}),CKEDITOR.config.colorButton_colors="1ABC9C,2ECC71,3498DB,9B59B6,4E5F70,F1C40F,16A085,27AE60,2980B9,8E44AD,2C3E50,F39C12,E67E22,E74C3C,ECF0F1,95A5A6,DDD,FFF,D35400,C0392B,BDC3C7,7F8C8D,999,000",CKEDITOR.config.colorButton_foreStyle={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},CKEDITOR.config.colorButton_backStyle={element:"span",styles:{"background-color":"#(color)"}};