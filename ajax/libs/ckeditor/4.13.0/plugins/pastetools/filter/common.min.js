!function(){function g(e){var t,r,n=e.margin?"margin":!!e.MARGIN&&"MARGIN";if(n){for(t in r=CKEDITOR.tools.style.parse.margin(e[n]))e["margin-"+t]=r[t];delete e[n]}}var u,b=CKEDITOR.tools,m={};(CKEDITOR.plugins.pastetools.filters.common=m).rules=function(e,i,l){return{elements:{table:function(e){e.filterChildren(l);var t,r,n=e.parent,o=n&&n.parent;if(n.name&&"div"===n.name&&n.attributes.align&&1===b.object.keys(n.attributes).length&&1===n.children.length){for(e.attributes.align=n.attributes.align,t=n.children.splice(0),e.remove(),r=t.length-1;0<=r;r--)o.add(t[r],n.getIndex());n.remove()}u.convertStyleToPx(e)},tr:function(e){e.attributes={}},td:function(e){var t=e.getAscendant("table");(n=(t=b.parseCssText(t.attributes.style,!0)).background)&&u.setStyle(e,"background",n,!0),(t=t["background-color"])&&u.setStyle(e,"background-color",t,!0);var r,n=(t=b.parseCssText(e.attributes.style,!0)).border?CKEDITOR.tools.style.border.fromCssRule(t.border):{},n=b.style.border.splitCssValues(t,n),o=CKEDITOR.tools.clone(t);for(r in o)0==r.indexOf("border")&&delete o[r];for(var s in e.attributes.style=CKEDITOR.tools.writeCssText(o),t.background&&((r=CKEDITOR.tools.style.parse.background(t.background)).color&&(u.setStyle(e,"background-color",r.color,!0),u.setStyle(e,"background",""))),n)"none"===(r=t[s]?CKEDITOR.tools.style.border.fromCssRule(t[s]):n[s]).style?u.setStyle(e,s,"none"):u.setStyle(e,s,r.toString());u.mapCommonStyles(e),u.convertStyleToPx(e),u.createStyleStack(e,l,i,/margin|text\-align|padding|list\-style\-type|width|height|border|white\-space|vertical\-align|background/i)}}}},m.styles={setStyle:function(e,t,r,n){var o=b.parseCssText(e.attributes.style);n&&o[t]||(""===r?delete o[t]:o[t]=r,e.attributes.style=CKEDITOR.tools.writeCssText(o))},convertStyleToPx:function(e){var t=e.attributes.style;t&&(e.attributes.style=t.replace(/\d+(\.\d+)?pt/g,function(e){return CKEDITOR.tools.convertToPx(e)+"px"}))},mapStyles:function(e,t){for(var r in t)e.attributes[r]&&("function"==typeof t[r]?t[r](e.attributes[r]):u.setStyle(e,t[r],e.attributes[r]),delete e.attributes[r])},mapCommonStyles:function(t){return u.mapStyles(t,{vAlign:function(e){u.setStyle(t,"vertical-align",e)},width:function(e){u.setStyle(t,"width",e+"px")},height:function(e){u.setStyle(t,"height",e+"px")}})},normalizedStyles:function(e,t){function r(){for(var e=[],t=0;t<arguments.length;t++)arguments[t]&&e.push(arguments[t]);return-1!==b.indexOf(n,e.join(":"))}var n="background-color:transparent border-image:none color:windowtext direction:ltr mso- visibility:visible div:border:none".split(" "),o="font-family font font-size color background-color line-height text-decoration".split(" "),s=!0===CKEDITOR.plugins.pastetools.getConfigValue(t,"removeFontStyles"),i=b.parseCssText(e.attributes.style);"cke:li"==e.name&&(i["TEXT-INDENT"]&&i.MARGIN?(e.attributes["cke-indentation"]=m.lists.getElementIndentation(e),i.MARGIN=i.MARGIN.replace(/(([\w\.]+ ){3,3})[\d\.]+(\w+$)/,"$10$3")):delete i["TEXT-INDENT"],delete i["text-indent"]);for(var l=b.object.keys(i),a=0;a<l.length;a++){var d=l[a].toLowerCase(),c=i[l[a]],u=CKEDITOR.tools.indexOf;(s&&-1!==u(o,d.toLowerCase())||r(null,d,c)||r(null,d.replace(/\-.*$/,"-"))||r(null,d)||r(e.name,d,c)||r(e.name,d.replace(/\-.*$/,"-"))||r(e.name,d)||r(c))&&delete i[l[a]]}var f=CKEDITOR.plugins.pastetools.getConfigValue(t,"keepZeroMargins");return g(i),CKEDITOR.tools.array.forEach(["top","right","bottom","left"],function(e){var t;(e="margin-"+e)in i&&((t=CKEDITOR.tools.convertToPx(i[e]))||f?i[e]=t?t+"px":0:delete i[e])}),CKEDITOR.tools.writeCssText(i)},createStyleStack:function(e,t,r,n){var o=[];for(e.filterChildren(t),t=e.children.length-1;0<=t;t--)o.unshift(e.children[t]),e.children[t].remove();u.sortStyles(e),t=b.parseCssText(u.normalizedStyles(e,r));var s,i,l="span"===(r=e).name;for(s in t){s.match(n||/margin((?!-)|-left|-top|-bottom|-right)|text-indent|text-align|width|border|padding/i)||(l?l=!1:((i=new CKEDITOR.htmlParser.element("span")).attributes.style=s+":"+t[s],r.add(i),r=i,delete t[s]))}for(CKEDITOR.tools.isEmpty(t)?delete e.attributes.style:e.attributes.style=CKEDITOR.tools.writeCssText(t),t=0;t<o.length;t++)r.add(o[t])},sortStyles:function(e){for(var r=["border","border-bottom","font-size","background"],t=b.parseCssText(e.attributes.style),n=b.object.keys(t),o=[],s=[],i=0;i<n.length;i++)-1!==b.indexOf(r,n[i].toLowerCase())?o.push(n[i]):s.push(n[i]);for(o.sort(function(e,t){return b.indexOf(r,e.toLowerCase())-b.indexOf(r,t.toLowerCase())}),n=[].concat(o,s),o={},i=0;i<n.length;i++)o[n[i]]=t[n[i]];e.attributes.style=CKEDITOR.tools.writeCssText(o)},pushStylesLower:function(e,t,r){if(!e.attributes.style||0===e.children.length)return!1;t=t||{};var n,o={"list-style-type":!0,width:!0,height:!0,border:!0,"border-":!0},s=b.parseCssText(e.attributes.style);for(n in s)if(!(n.toLowerCase()in o||o[n.toLowerCase().replace(/\-.*$/,"-")]||n.toLowerCase()in t)){for(var i=!1,l=0;l<e.children.length;l++){var a,d=e.children[l];d.type===CKEDITOR.NODE_TEXT&&r&&((a=new CKEDITOR.htmlParser.element("span")).setHtml(d.value),d.replaceWith(a),d=a),d.type===CKEDITOR.NODE_ELEMENT&&(i=!0,u.setStyle(d,n,s[n]))}i&&delete s[n]}return e.attributes.style=CKEDITOR.tools.writeCssText(s),!0},inliner:{filtered:"break-before break-after break-inside page-break page-break-before page-break-after page-break-inside".split(" "),parse:function(e){var t,r,n,o,s,i,l,a=CKEDITOR.tools.parseCssText,d=u.inliner.filter,c=e.is?e.$.sheet:(t=e,r=new CKEDITOR.dom.element("style"),(n=new CKEDITOR.dom.element("iframe")).hide(),CKEDITOR.document.getBody().append(n),n.$.contentDocument.documentElement.appendChild(r.$),r.$.textContent=t,n.remove(),r.$.sheet);if(e=[],c)for(c=c.cssRules,o=0;o<c.length;o++)c[o].type===window.CSSRule.STYLE_RULE&&e.push({selector:c[o].selectorText,styles:d((s=c[o].cssText,0,i=s.indexOf("{"),l=s.indexOf("}"),a(s.substring(i+1,l),!0)))});return e},filter:function(e){var t,r=u.inliner.filtered,n=b.array.indexOf,o={};for(t in e)-1===n(r,t)&&(o[t]=e[t]);return o},sort:function(e){return e.sort((n=CKEDITOR.tools.array.map(e,function(e){return e.selector}),function(e,t){var r=-1!==(""+e.selector).indexOf(".")?1:0;return 0!=(r=(-1!==(""+t.selector).indexOf(".")?1:0)-r)?r:n.indexOf(t.selector)-n.indexOf(e.selector)}));var n},inline:function(e){var t,n=u.inliner.parse,r=u.inliner.sort,s=(t=e,t=(new DOMParser).parseFromString(t,"text/html"),new CKEDITOR.dom.document(t)),r=r(function(e){for(var t=[],r=0;r<e.count();r++)t=t.concat(n(e.getItem(r)));return t}(e=s.find("style")));return CKEDITOR.tools.array.forEach(r,function(e){var t,r,n,o=e.styles;for(e=s.find(e.selector),g(o),n=0;n<e.count();n++)t=e.getItem(n),g(r=CKEDITOR.tools.parseCssText(t.getAttribute("style"))),r=CKEDITOR.tools.extend({},r,o),t.setAttribute("style",CKEDITOR.tools.writeCssText(r))}),s}}},u=m.styles,m.lists={getElementIndentation:function(e){var t;return((e=b.parseCssText(e.attributes.style)).margin||e.MARGIN)&&(e.margin=e.margin||e.MARGIN,t={styles:{margin:e.margin}},CKEDITOR.filter.transformationsTools.splitMarginShorthand(t),e["margin-left"]=t.styles["margin-left"]),parseInt(b.convertToPx(e["margin-left"]||"0px"),10)}},m.elements={replaceWithChildren:function(e){for(var t=e.children.length-1;0<=t;t--)e.children[t].insertAfter(e)}},m.createAttributeStack=function(e,t){var r,n=[];for(e.filterChildren(t),r=e.children.length-1;0<=r;r--)n.unshift(e.children[r]),e.children[r].remove();r=e.attributes;var o,s,i=e,l=!0;for(o in r){l?l=!1:((s=new CKEDITOR.htmlParser.element(e.name)).attributes[o]=r[o],i.add(s),i=s,delete r[o])}for(r=0;r<n.length;r++)i.add(n[r])},m.parseShorthandMargins=g}();