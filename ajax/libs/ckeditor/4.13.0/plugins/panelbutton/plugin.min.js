CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function n(t){var e=this._;e.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(t),e.on?e.panel.hide():e.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){var e=t.panel||{};delete t.panel,this.base(t),this.document=e.parent&&e.parent.getDocument()||CKEDITOR.document,e.block={attributes:e.attributes},e.toolbarRelated=!0,this.hasArrow="listbox",this.click=n,this._={panelDefinition:e}},statics:{handler:{create:function(t){return new CKEDITOR.ui.panelButton(t)}}},proto:{createPanel:function(e){var t,n,o,a,i,s=this._;s.panel||(a=this._.panelDefinition,t=this._.panelDefinition.block,n=a.parent||CKEDITOR.document.getBody(),a=(o=this._.panel=new CKEDITOR.ui.floatPanel(e,n,a)).addBlock(s.id,t),i=this,o.onShow=function(){i.className&&this.element.addClass(i.className+"_panel"),i.setState(CKEDITOR.TRISTATE_ON),s.on=1,i.editorFocus&&e.focus(),i.onOpen&&i.onOpen()},o.onHide=function(t){i.className&&this.element.getFirst().removeClass(i.className+"_panel"),i.setState(i.modes&&i.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),s.on=0,!t&&i.onClose&&i.onClose()},o.onEscape=function(){o.hide(1),i.document.getById(s.id).focus()},this.onBlock&&this.onBlock(o,a),a.onHide=function(){s.on=0,i.setState(CKEDITOR.TRISTATE_OFF)})}}})},beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}}),CKEDITOR.UI_PANELBUTTON="panelbutton";