"use strict";function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}import AnimatedInterpolation from"./AnimatedInterpolation";import AnimatedNode from"./AnimatedNode";import AnimatedWithChildren from"./AnimatedWithChildren";import InteractionManager from"../../../../exports/InteractionManager";import NativeAnimatedHelper from"../NativeAnimatedHelper";var NativeAnimatedAPI=NativeAnimatedHelper.API,_uniqueId=1;function _flush(t){var e=new Set;!function t(i){"function"==typeof i.update?e.add(i):i.__getChildren().forEach(t)}(t),e.forEach(function(t){return t.update()})}var AnimatedValue=function(t){function e(e){var i;return(i=t.call(this)||this)._startingValue=i._value=e,i._offset=0,i._animation=null,i._listeners={},i}_inheritsLoose(e,t);var i=e.prototype;return i.__detach=function(){this.stopAnimation(),t.prototype.__detach.call(this)},i.__getValue=function(){return this._value+this._offset},i.__makeNative=function(){t.prototype.__makeNative.call(this),Object.keys(this._listeners).length&&this._startListeningToNativeValueUpdates()},i.setValue=function(t){this._animation&&(this._animation.stop(),this._animation=null),this._updateValue(t,!this.__isNative),this.__isNative&&NativeAnimatedAPI.setAnimatedNodeValue(this.__getNativeTag(),t)},i.setOffset=function(t){this._offset=t,this.__isNative&&NativeAnimatedAPI.setAnimatedNodeOffset(this.__getNativeTag(),t)},i.flattenOffset=function(){this._value+=this._offset,this._offset=0,this.__isNative&&NativeAnimatedAPI.flattenAnimatedNodeOffset(this.__getNativeTag())},i.extractOffset=function(){this._offset+=this._value,this._value=0,this.__isNative&&NativeAnimatedAPI.extractAnimatedNodeOffset(this.__getNativeTag())},i.addListener=function(t){var e=String(_uniqueId++);return this._listeners[e]=t,this.__isNative&&this._startListeningToNativeValueUpdates(),e},i.removeListener=function(t){delete this._listeners[t],this.__isNative&&0===Object.keys(this._listeners).length&&this._stopListeningForNativeValueUpdates()},i.removeAllListeners=function(){this._listeners={},this.__isNative&&this._stopListeningForNativeValueUpdates()},i._startListeningToNativeValueUpdates=function(){var t=this;this.__nativeAnimatedValueListener||(NativeAnimatedAPI.startListeningToAnimatedNodeValue(this.__getNativeTag()),this.__nativeAnimatedValueListener=NativeAnimatedHelper.nativeEventEmitter.addListener("onAnimatedValueUpdate",function(e){e.tag===t.__getNativeTag()&&t._updateValue(e.value,!1)}))},i._stopListeningForNativeValueUpdates=function(){this.__nativeAnimatedValueListener&&(this.__nativeAnimatedValueListener.remove(),this.__nativeAnimatedValueListener=null,NativeAnimatedAPI.stopListeningToAnimatedNodeValue(this.__getNativeTag()))},i.stopAnimation=function(t){this.stopTracking(),this._animation&&this._animation.stop(),this._animation=null,t&&t(this.__getValue())},i.resetAnimation=function(t){this.stopAnimation(t),this._value=this._startingValue},i.interpolate=function(t){return new AnimatedInterpolation(this,t)},i.animate=function(t,e){var i=this,n=null;t.__isInteraction&&(n=InteractionManager.createInteractionHandle());var a=this._animation;this._animation&&this._animation.stop(),this._animation=t,t.start(this._value,function(t){i._updateValue(t,!0)},function(t){i._animation=null,null!==n&&InteractionManager.clearInteractionHandle(n),e&&e(t)},a,this)},i.stopTracking=function(){this._tracking&&this._tracking.__detach(),this._tracking=null},i.track=function(t){this.stopTracking(),this._tracking=t},i._updateValue=function(t,e){for(var i in this._value=t,e&&_flush(this),this._listeners)this._listeners[i]({value:this.__getValue()})},i.__getNativeConfig=function(){return{type:"value",value:this._value,offset:this._offset}},e}(AnimatedWithChildren);export default AnimatedValue;