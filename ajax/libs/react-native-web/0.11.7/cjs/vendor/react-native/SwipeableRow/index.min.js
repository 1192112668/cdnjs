"use strict";exports.__esModule=!0,exports.default=void 0;var _Animated=_interopRequireDefault(require("../../../exports/Animated")),_I18nManager=_interopRequireDefault(require("../../../exports/I18nManager")),_PanResponder=_interopRequireDefault(require("../../../exports/PanResponder")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_StyleSheet=_interopRequireDefault(require("../../../exports/StyleSheet")),_reactTimerMixin=_interopRequireDefault(require("react-timer-mixin")),_View=_interopRequireDefault(require("../../../exports/View")),_createReactClass=_interopRequireDefault(require("create-react-class")),_emptyFunction=_interopRequireDefault(require("fbjs/lib/emptyFunction"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var isRTL=function(){return _I18nManager.default.isRTL},CLOSED_LEFT_POSITION=0,HORIZONTAL_SWIPE_DISTANCE_THRESHOLD=10,HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD=.3,SLOW_SPEED_SWIPE_FACTOR=4,SWIPE_DURATION=300,ON_MOUNT_BOUNCE_DELAY=700,ON_MOUNT_BOUNCE_DURATION=400,RIGHT_SWIPE_BOUNCE_BACK_DISTANCE=30,RIGHT_SWIPE_BOUNCE_BACK_DURATION=300,RIGHT_SWIPE_THRESHOLD=30*SLOW_SPEED_SWIPE_FACTOR,SwipeableRow=(0,_createReactClass.default)({displayName:"SwipeableRow",_panResponder:{},_previousLeft:CLOSED_LEFT_POSITION,mixins:[_reactTimerMixin.default],propTypes:{children:_propTypes.default.any,isOpen:_propTypes.default.bool,preventSwipeRight:_propTypes.default.bool,maxSwipeDistance:_propTypes.default.number.isRequired,onOpen:_propTypes.default.func.isRequired,onClose:_propTypes.default.func.isRequired,onSwipeEnd:_propTypes.default.func.isRequired,onSwipeStart:_propTypes.default.func.isRequired,shouldBounceOnMount:_propTypes.default.bool,slideoutView:_propTypes.default.node.isRequired,swipeThreshold:_propTypes.default.number.isRequired},getInitialState:function(){return{currentLeft:new _Animated.default.Value(this._previousLeft),isSwipeableViewRendered:!1,rowHeight:null}},getDefaultProps:function(){return{isOpen:!1,preventSwipeRight:!1,maxSwipeDistance:0,onOpen:_emptyFunction.default,onClose:_emptyFunction.default,onSwipeEnd:_emptyFunction.default,onSwipeStart:_emptyFunction.default,swipeThreshold:30}},UNSAFE_componentWillMount:function(){this._panResponder=_PanResponder.default.create({onMoveShouldSetPanResponderCapture:this._handleMoveShouldSetPanResponderCapture,onPanResponderGrant:this._handlePanResponderGrant,onPanResponderMove:this._handlePanResponderMove,onPanResponderRelease:this._handlePanResponderEnd,onPanResponderTerminationRequest:this._onPanResponderTerminationRequest,onPanResponderTerminate:this._handlePanResponderEnd,onShouldBlockNativeResponder:function(){return!1}})},componentDidMount:function(){var e=this;this.props.shouldBounceOnMount&&this.setTimeout(function(){e._animateBounceBack(ON_MOUNT_BOUNCE_DURATION)},ON_MOUNT_BOUNCE_DELAY)},UNSAFE_componentWillReceiveProps:function(e){this.props.isOpen&&!e.isOpen&&this._animateToClosedPosition()},render:function(){var e;this.state.isSwipeableViewRendered&&this.state.rowHeight&&(e=_react.default.createElement(_View.default,{style:[styles.slideOutContainer,{height:this.state.rowHeight}]},this.props.slideoutView));var t=_react.default.createElement(_Animated.default.View,{onLayout:this._onSwipeableViewLayout,style:{transform:[{translateX:this.state.currentLeft}]}},this.props.children);return _react.default.createElement(_View.default,this._panResponder.panHandlers,e,t)},close:function(){this.props.onClose(),this._animateToClosedPosition()},_onSwipeableViewLayout:function(e){this.setState({isSwipeableViewRendered:!0,rowHeight:e.nativeEvent.layout.height})},_handleMoveShouldSetPanResponderCapture:function(e,t){return t.dy<10&&this._isValidSwipe(t)},_handlePanResponderGrant:function(){},_handlePanResponderMove:function(e,t){this._isSwipingExcessivelyRightFromClosedPosition(t)||(this.props.onSwipeStart(),this._isSwipingRightFromClosed(t)?this._swipeSlowSpeed(t):this._swipeFullSpeed(t))},_isSwipingRightFromClosed:function(e){var t=isRTL()?-e.dx:e.dx;return this._previousLeft===CLOSED_LEFT_POSITION&&0<t},_swipeFullSpeed:function(e){this.state.currentLeft.setValue(this._previousLeft+e.dx)},_swipeSlowSpeed:function(e){this.state.currentLeft.setValue(this._previousLeft+e.dx/SLOW_SPEED_SWIPE_FACTOR)},_isSwipingExcessivelyRightFromClosedPosition:function(e){var t=isRTL()?-e.dx:e.dx;return this._isSwipingRightFromClosed(e)&&RIGHT_SWIPE_THRESHOLD<t},_onPanResponderTerminationRequest:function(){return!1},_animateTo:function(e,t,i){var n=this;void 0===t&&(t=SWIPE_DURATION),void 0===i&&(i=_emptyFunction.default),_Animated.default.timing(this.state.currentLeft,{duration:t,toValue:e,useNativeDriver:!0}).start(function(){n._previousLeft=e,i()})},_animateToOpenPosition:function(){var e=isRTL()?-this.props.maxSwipeDistance:this.props.maxSwipeDistance;this._animateTo(-e)},_animateToOpenPositionWith:function(e,t){e=HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD<e?e:HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD;var i=Math.abs((this.props.maxSwipeDistance-Math.abs(t))/e),n=isRTL()?-this.props.maxSwipeDistance:this.props.maxSwipeDistance;this._animateTo(-n,i)},_animateToClosedPosition:function(e){void 0===e&&(e=SWIPE_DURATION),this._animateTo(CLOSED_LEFT_POSITION,e)},_animateToClosedPositionDuringBounce:function(){this._animateToClosedPosition(RIGHT_SWIPE_BOUNCE_BACK_DURATION)},_animateBounceBack:function(e){var t=isRTL()?-RIGHT_SWIPE_BOUNCE_BACK_DISTANCE:RIGHT_SWIPE_BOUNCE_BACK_DISTANCE;this._animateTo(-t,e,this._animateToClosedPositionDuringBounce)},_isValidSwipe:function(e){return!(this.props.preventSwipeRight&&this._previousLeft===CLOSED_LEFT_POSITION&&0<e.dx)&&Math.abs(e.dx)>HORIZONTAL_SWIPE_DISTANCE_THRESHOLD},_shouldAnimateRemainder:function(e){return Math.abs(e.dx)>this.props.swipeThreshold||e.vx>HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD},_handlePanResponderEnd:function(e,t){var i=isRTL()?-t.dx:t.dx;this._isSwipingRightFromClosed(t)?(this.props.onOpen(),this._animateBounceBack(RIGHT_SWIPE_BOUNCE_BACK_DURATION)):this._shouldAnimateRemainder(t)?i<0?(this.props.onOpen(),this._animateToOpenPositionWith(t.vx,i)):(this.props.onClose(),this._animateToClosedPosition()):this._previousLeft===CLOSED_LEFT_POSITION?this._animateToClosedPosition():this._animateToOpenPosition(),this.props.onSwipeEnd()}}),styles=_StyleSheet.default.create({slideOutContainer:{bottom:0,left:0,position:"absolute",right:0,top:0}}),_default=SwipeableRow;exports.default=SwipeableRow,module.exports=exports.default;