"use strict";exports.__esModule=!0,exports.default=void 0;var _Batchinator=_interopRequireDefault(require("../Batchinator")),_FillRateHelper=_interopRequireDefault(require("../FillRateHelper")),_propTypes=_interopRequireDefault(require("prop-types")),React=_interopRequireWildcard(require("react")),_RefreshControl=_interopRequireDefault(require("../../../exports/RefreshControl")),_ScrollView=_interopRequireDefault(require("../../../exports/ScrollView")),_StyleSheet=_interopRequireDefault(require("../../../exports/StyleSheet")),_UIManager=_interopRequireDefault(require("../../../exports/UIManager")),_View=_interopRequireDefault(require("../../../exports/View")),_ViewabilityHelper=_interopRequireDefault(require("../ViewabilityHelper")),_findNodeHandle=_interopRequireDefault(require("../../../exports/findNodeHandle")),_infoLog=_interopRequireDefault(require("../infoLog")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_warning=_interopRequireDefault(require("fbjs/lib/warning")),_VirtualizeUtils=require("../VirtualizeUtils");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var i,s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((i=s?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o])}}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var flattenStyle=_StyleSheet.default.flatten,__DEV__="production"!==process.env.NODE_ENV,_usedIndexForKey=!1,_keylessItemComponentName="",VirtualizedList=function(s){_inheritsLoose(t,s);var e=t.prototype;function t(e,t){var R=s.call(this,e,t)||this;R._getScrollMetrics=function(){return R._scrollMetrics},R._getOutermostParentListRef=function(){return R._isNestedWithSameOrientation()?R.context.virtualizedList.getOutermostParentListRef():_assertThisInitialized(R)},R._getNestedChildState=function(e){var t=R._nestedChildLists.get(e);return t&&t.state},R._registerAsNestedChild=function(e){var t=R._cellKeysToChildListKeys.get(e.cellKey)||new Set;t.add(e.key),R._cellKeysToChildListKeys.set(e.cellKey,t);var r=R._nestedChildLists.get(e.key);r&&null!==r.ref&&console.error("A VirtualizedList contains a cell which itself contains more than one VirtualizedList of the same orientation as the parent list. You must pass a unique listKey prop to each sibling list."),R._nestedChildLists.set(e.key,{ref:e.ref,state:null}),R._hasInteracted&&e.ref.recordInteraction()},R._unregisterAsNestedChild=function(e){R._nestedChildLists.set(e.key,{ref:null,state:e.state})},R._onUpdateSeparators=function(e,r){e.forEach(function(e){var t=null!=e&&R._cellRefs[e];t&&t.updateSeparatorProps(r)})},R._averageCellLength=0,R._cellKeysToChildListKeys=new Map,R._cellRefs={},R._frames={},R._footerLength=0,R._hasDataChangedSinceEndReached=!0,R._hasDoneInitialScroll=!1,R._hasInteracted=!1,R._hasMore=!1,R._hasWarned={},R._headerLength=0,R._hiPriInProgress=!1,R._highestMeasuredFrameIndex=0,R._indicesToKeys=new Map,R._nestedChildLists=new Map,R._offsetFromParentVirtualizedList=0,R._prevParentOffset=0,R._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0},R._scrollRef=null,R._sentEndForContentLength=0,R._totalCellLength=0,R._totalCellsMeasured=0,R._viewabilityTuples=[],R._captureScrollRef=function(e){R._scrollRef=e},R._defaultRenderScrollComponent=function(e){var t=e.onRefresh;return R._isNestedWithSameOrientation()?React.createElement(_View.default,e):t?((0,_invariant.default)("boolean"==typeof e.refreshing,"`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify(e.refreshing)+"`"),React.createElement(_ScrollView.default,_extends({},e,{refreshControl:null==e.refreshControl?React.createElement(_RefreshControl.default,{refreshing:e.refreshing,onRefresh:t,progressViewOffset:e.progressViewOffset}):e.refreshControl}))):React.createElement(_ScrollView.default,e)},R._onCellUnmount=function(e){var t=R._frames[e];t&&(R._frames[e]=_objectSpread({},t,{inLayout:!1}))},R._onLayout=function(e){R._isNestedWithSameOrientation()?R.measureLayoutRelativeToContainingList():R._scrollMetrics.visibleLength=R._selectLength(e.nativeEvent.layout),R.props.onLayout&&R.props.onLayout(e),R._scheduleCellsToRenderUpdate(),R._maybeCallOnEndReached()},R._onLayoutEmpty=function(e){R.props.onLayout&&R.props.onLayout(e)},R._onLayoutFooter=function(e){R._footerLength=R._selectLength(e.nativeEvent.layout)},R._onLayoutHeader=function(e){R._headerLength=R._selectLength(e.nativeEvent.layout)},R._onContentSizeChange=function(e,t){0<e&&0<t&&null!=R.props.initialScrollIndex&&0<R.props.initialScrollIndex&&!R._hasDoneInitialScroll&&(R.scrollToIndex({animated:!1,index:R.props.initialScrollIndex}),R._hasDoneInitialScroll=!0),R.props.onContentSizeChange&&R.props.onContentSizeChange(e,t),R._scrollMetrics.contentLength=R._selectLength({height:t,width:e}),R._scheduleCellsToRenderUpdate(),R._maybeCallOnEndReached()},R._convertParentScrollMetrics=function(e){var t=e.offset-R._offsetFromParentVirtualizedList,r=e.visibleLength,i=t-R._scrollMetrics.offset;return{visibleLength:r,contentLength:R._scrollMetrics.contentLength,offset:t,dOffset:i}},R._onScroll=function(t){R._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScroll(t)}),R.props.onScroll&&R.props.onScroll(t);var e=t.timeStamp,r=R._selectLength(t.nativeEvent.layoutMeasurement),i=R._selectLength(t.nativeEvent.contentSize),s=(n=R._selectOffset(t.nativeEvent.contentOffset))-R._scrollMetrics.offset;if(R._isNestedWithSameOrientation()){if(0===R._scrollMetrics.contentLength)return;var o=R._convertParentScrollMetrics({visibleLength:r,offset:n}),r=o.visibleLength,i=o.contentLength,n=o.offset,s=o.dOffset}var l=R._scrollMetrics.timestamp?Math.max(1,e-R._scrollMetrics.timestamp):1,a=s/l;500<l&&500<R._scrollMetrics.dt&&5*r<i&&!R._hasWarned.perf&&((0,_infoLog.default)("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:l,prevDt:R._scrollMetrics.dt,contentLength:i}),R._hasWarned.perf=!0),R._scrollMetrics={contentLength:i,dt:l,dOffset:s,offset:n,timestamp:e,velocity:a,visibleLength:r},R._updateViewableItems(R.props.data),R.props&&(R._maybeCallOnEndReached(),0!=a&&R._fillRateHelper.activate(),R._computeBlankness(),R._scheduleCellsToRenderUpdate())},R._onScrollBeginDrag=function(t){R._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScrollBeginDrag(t)}),R._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),R._hasInteracted=!0,R.props.onScrollBeginDrag&&R.props.onScrollBeginDrag(t)},R._onScrollEndDrag=function(e){var t=e.nativeEvent.velocity;t&&(R._scrollMetrics.velocity=R._selectOffset(t)),R._computeBlankness(),R.props.onScrollEndDrag&&R.props.onScrollEndDrag(e)},R._onMomentumScrollEnd=function(e){R._scrollMetrics.velocity=0,R._computeBlankness(),R.props.onMomentumScrollEnd&&R.props.onMomentumScrollEnd(e)},R._updateCellsToRender=function(){var e=R.props,m=e.data,v=e.getItemCount,C=e.onEndReachedThreshold,L=R._isVirtualizationDisabled();R._updateViewableItems(m),m&&R.setState(function(e){var t,r,i,s,o,n;if(L?(r=(t=R._scrollMetrics).contentLength,i=t.offset,o=r-(s=t.visibleLength)-i<C*s?R.props.maxToRenderPerBatch:0,n={first:0,last:Math.min(e.last+o,v(m)-1)}):R._scrollMetrics.visibleLength&&(R.props.initialScrollIndex&&!R._scrollMetrics.offset||(n=(0,_VirtualizeUtils.computeWindowedRenderLimits)(R.props,e,R._getFrameMetricsApprox,R._scrollMetrics))),n&&0<R._nestedChildLists.size)for(var l=n.first,a=n.last,c=l;c<=a;c++){var p=R._indicesToKeys.get(c),h=p&&R._cellKeysToChildListKeys.get(p);if(h){for(var d,u=!1,f=h,_=Array.isArray(f),g=0,f=_?f:f[Symbol.iterator]();;){if(_){if(g>=f.length)break;d=f[g++]}else{if((g=f.next()).done)break;d=g.value}var y=R._nestedChildLists.get(d);if(y&&y.ref&&y.ref.hasMore()){u=!0;break}}if(u){n.last=c;break}}}return n})},R._createViewToken=function(e,t){var r=R.props,i=r.data,s=r.getItem,o=r.keyExtractor,n=s(i,e);return{index:e,item:n,key:o(n,e),isViewable:t}},R._getFrameMetricsApprox=function(e){var t=R._getFrameMetrics(e);if(t&&t.index===e)return t;var r=R.props.getItemLayout;return(0,_invariant.default)(!r,"Should not have to estimate frames when a measurement metrics function is provided"),{length:R._averageCellLength,offset:R._averageCellLength*e}},R._getFrameMetrics=function(e){var t=R.props,r=t.data,i=t.getItem,s=t.getItemCount,o=t.getItemLayout,n=t.keyExtractor;(0,_invariant.default)(s(r)>e,"Tried to get frame for out of range index "+e);var l,a=i(r,e),c=a&&R._frames[n(a,e)];return c&&c.index===e||o&&(c=o(r,e),__DEV__&&(l=_propTypes.default.shape({length:_propTypes.default.number.isRequired,offset:_propTypes.default.number.isRequired,index:_propTypes.default.number.isRequired}).isRequired,_propTypes.default.checkPropTypes({frame:l},{frame:c},"frame","VirtualizedList.getItemLayout"))),c},(0,_invariant.default)(!e.onScroll||!e.onScroll.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),(0,_invariant.default)(0<e.windowSize,"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),R._fillRateHelper=new _FillRateHelper.default(R._getFrameMetrics),R._updateCellsToRenderBatcher=new _Batchinator.default(R._updateCellsToRender,R.props.updateCellsBatchingPeriod),R.props.viewabilityConfigCallbackPairs?R._viewabilityTuples=R.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityHelper:new _ViewabilityHelper.default(e.viewabilityConfig),onViewableItemsChanged:e.onViewableItemsChanged}}):R.props.onViewableItemsChanged&&R._viewabilityTuples.push({viewabilityHelper:new _ViewabilityHelper.default(R.props.viewabilityConfig),onViewableItemsChanged:R.props.onViewableItemsChanged});var r,i={first:R.props.initialScrollIndex||0,last:Math.min(R.props.getItemCount(R.props.data),(R.props.initialScrollIndex||0)+R.props.initialNumToRender)-1};return!R._isNestedWithSameOrientation()||(r=R.context.virtualizedList.getNestedChildState(R.props.listKey||R._getCellKey()))&&(i=r,R.state=r,R._frames=r.frames),R.state=i,R}return e.scrollToEnd=function(e){var t=!e||e.animated,r=this.props.getItemCount(this.props.data)-1,i=this._getFrameMetricsApprox(r),s=Math.max(0,i.offset+i.length+this._footerLength-this._scrollMetrics.visibleLength);this._scrollRef.scrollTo(this.props.horizontal?{x:s,animated:t}:{y:s,animated:t})},e.scrollToIndex=function(e){var t=this.props,r=t.data,i=t.horizontal,s=t.getItemCount,o=t.getItemLayout,n=t.onScrollToIndexFailed,l=e.animated,a=e.index,c=e.viewOffset,p=e.viewPosition;if((0,_invariant.default)(0<=a&&a<s(r),"scrollToIndex out of range: "+a+" vs "+(s(r)-1)),!o&&a>this._highestMeasuredFrameIndex)return(0,_invariant.default)(!!n,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),void n({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:a});var h=this._getFrameMetricsApprox(a),d=Math.max(0,h.offset-(p||0)*(this._scrollMetrics.visibleLength-h.length))-(c||0);this._scrollRef.scrollTo(i?{x:d,animated:l}:{y:d,animated:l})},e.scrollToItem=function(e){for(var t=e.item,r=this.props,i=r.data,s=r.getItem,o=(0,r.getItemCount)(i),n=0;n<o;n++)if(s(i,n)===t){this.scrollToIndex(_objectSpread({},e,{index:n}));break}},e.scrollToOffset=function(e){var t=e.animated,r=e.offset;this._scrollRef.scrollTo(this.props.horizontal?{x:r,animated:t}:{y:r,animated:t})},e.recordInteraction=function(){this._nestedChildLists.forEach(function(e){e.ref&&e.ref.recordInteraction()}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props.data)},e.flashScrollIndicators=function(){this._scrollRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()},e.getScrollableNode=function(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():(0,_findNodeHandle.default)(this._scrollRef)},e.getScrollRef=function(){return this._scrollRef&&this._scrollRef.getScrollRef?this._scrollRef.getScrollRef():this._scrollRef},e.setNativeProps=function(e){this._scrollRef&&this._scrollRef.setNativeProps(e)},e.getChildContext=function(){return{virtualizedList:{getScrollMetrics:this._getScrollMetrics,horizontal:this.props.horizontal,getOutermostParentListRef:this._getOutermostParentListRef,getNestedChildState:this._getNestedChildState,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild}}},e._getCellKey=function(){return this.context.virtualizedCell&&this.context.virtualizedCell.cellKey||"rootList"},e.hasMore=function(){return this._hasMore},e.componentDidMount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.registerAsNestedChild({cellKey:this._getCellKey(),key:this.props.listKey||this._getCellKey(),ref:this})},e.componentWillUnmount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.unregisterAsNestedChild({key:this.props.listKey||this._getCellKey(),state:{first:this.state.first,last:this.state.last,frames:this._frames}}),this._updateViewableItems(null),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush()},t.getDerivedStateFromProps=function(e,t){var r=e.data,i=e.getItemCount,s=e.maxToRenderPerBatch;return{first:Math.max(0,Math.min(t.first,i(r)-1-s)),last:Math.max(0,Math.min(t.last,i(r)-1))}},e._pushCells=function(i,s,o,e,t,n){var l,a=this,r=this.props,c=r.CellRendererComponent,p=r.ItemSeparatorComponent,h=r.data,d=r.getItem,u=r.getItemCount,f=r.horizontal,_=r.keyExtractor,g=this.props.ListHeaderComponent?1:0,y=u(h)-1;t=Math.min(y,t);for(var m=function(t){var e=d(h,t),r=_(e,t);a._indicesToKeys.set(t,r),o.has(t+g)&&s.push(i.length),i.push(React.createElement(CellRenderer,{CellRendererComponent:c,ItemSeparatorComponent:t<y?p:void 0,cellKey:r,fillRateHelper:a._fillRateHelper,horizontal:f,index:t,inversionStyle:n,item:e,key:r,prevCellKey:l,onUpdateSeparators:a._onUpdateSeparators,onLayout:function(e){return a._onCellLayout(e,r,t)},onUnmount:a._onCellUnmount,parentProps:a.props,ref:function(e){a._cellRefs[r]=e}})),l=r},v=e;v<=t;v++)m(v)},e._isVirtualizationDisabled=function(){return this.props.disableVirtualization||!1},e._isNestedWithSameOrientation=function(){var e=this.context.virtualizedList;return!(!e||!!e.horizontal!=!!this.props.horizontal)},e.render=function(){var e,t=this;__DEV__&&(e=flattenStyle(this.props.contentContainerStyle),(0,_warning.default)(null==e||"wrap"!==e.flexWrap,"`flexWrap: `wrap`` is not supported with the `VirtualizedList` components.Consider using `numColumns` with `FlatList` instead."));var r,i=this.props,s=i.ListEmptyComponent,o=i.ListFooterComponent,n=i.ListHeaderComponent,l=this.props,a=l.data,c=l.horizontal,p=this._isVirtualizationDisabled(),h=this.props.inverted?this.props.horizontal?styles.horizontallyInverted:styles.verticallyInverted:null,d=[],u=new Set(this.props.stickyHeaderIndices),f=[];n&&(u.has(0)&&f.push(0),r=React.isValidElement(n)?n:React.createElement(n,null),d.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-header",key:"$header"},React.createElement(_View.default,{onLayout:this._onLayoutHeader,style:_StyleSheet.default.compose(h,this.props.ListHeaderComponentStyle)},r))));var _,g,y=this.props.getItemCount(a);if(0<y){_usedIndexForKey=!1,_keylessItemComponentName="";var m=c?"width":"height",v=this.props.initialScrollIndex?-1:this.props.initialNumToRender-1,C=this.state,L=C.first,R=C.last;this._pushCells(d,f,u,0,v,h);var b,S,w,x,M,I=Math.max(1+v,L);if(!p&&1+v<L){var T,E,V,z=!1;if(0<u.size)for(var O=n?1:0,k=I-1;v<k;k--)if(u.has(k+O)){var P,D,F=this._getFrameMetricsApprox(v),K=this._getFrameMetricsApprox(k),N=K.offset-F.offset-(this.props.initialScrollIndex?0:F.length);d.push(React.createElement(_View.default,{key:"$sticky_lead",style:((P={})[m]=N,P)})),this._pushCells(d,f,u,k,k,h);var q=this._getFrameMetricsApprox(L).offset-(K.offset+K.length);d.push(React.createElement(_View.default,{key:"$sticky_trail",style:((D={})[m]=q,D)})),z=!0;break}z||(E=this._getFrameMetricsApprox(v),V=this._getFrameMetricsApprox(L).offset-(E.offset+E.length),d.push(React.createElement(_View.default,{key:"$lead_spacer",style:((T={})[m]=V,T)})))}this._pushCells(d,f,u,I,R,h),!this._hasWarned.keys&&_usedIndexForKey&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key or id property on each item or provide a custom keyExtractor.",_keylessItemComponentName),this._hasWarned.keys=!0),!p&&R<y-1&&(S=this._getFrameMetricsApprox(R),w=this.props.getItemLayout?y-1:Math.min(y-1,this._highestMeasuredFrameIndex),M=(x=this._getFrameMetricsApprox(w)).offset+x.length-(S.offset+S.length),d.push(React.createElement(_View.default,{key:"$tail_spacer",style:((b={})[m]=M,b)})))}else{s&&(_=React.isValidElement(s)?s:React.createElement(s,null),d.push(React.cloneElement(_,{key:"$empty",onLayout:function(e){t._onLayoutEmpty(e),_.props.onLayout&&_.props.onLayout(e)},style:_StyleSheet.default.compose(h,_.props.style)})))}o&&(g=React.isValidElement(o)?o:React.createElement(o,null),d.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-footer",key:"$footer"},React.createElement(_View.default,{onLayout:this._onLayoutFooter,style:_StyleSheet.default.compose(h,this.props.ListFooterComponentStyle)},g))));var A=_objectSpread({},this.props,{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:this.props.scrollEventThrottle,invertStickyHeaders:void 0!==this.props.invertStickyHeaders?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:f});h&&(A.style=[h,this.props.style]),this._hasMore=this.state.last<this.props.getItemCount(this.props.data)-1;var H=React.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)(A),{ref:this._captureScrollRef},d);return this.props.debug?React.createElement(_View.default,{style:styles.debug},H,this._renderDebugOverlay()):H},e.componentDidUpdate=function(e){var t=this.props,r=t.data,i=t.extraData;r===e.data&&i===e.extraData||(this._hasDataChangedSinceEndReached=!0,this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.resetViewableIndices()}));var s=this._hiPriInProgress;this._scheduleCellsToRenderUpdate(),s&&(this._hiPriInProgress=!1)},e._computeBlankness=function(){this._fillRateHelper.computeBlankness(this.props,this.state,this._scrollMetrics)},e._onCellLayout=function(e,t,r){var i=e.nativeEvent.layout,s={offset:this._selectOffset(i),length:this._selectLength(i),index:r,inLayout:!0},o=this._frames[t];o&&s.offset===o.offset&&s.length===o.length&&r===o.index?this._frames[t].inLayout=!0:(this._totalCellLength+=s.length-(o?o.length:0),this._totalCellsMeasured+=o?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[t]=s,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,r),this._scheduleCellsToRenderUpdate());var n=this._cellKeysToChildListKeys.get(t);if(n)for(var l,a=n,c=Array.isArray(a),p=0,a=c?a:a[Symbol.iterator]();;){if(c){if(p>=a.length)break;l=a[p++]}else{if((p=a.next()).done)break;l=p.value}var h=this._nestedChildLists.get(l);h&&h.ref&&h.ref.measureLayoutRelativeToContainingList()}this._computeBlankness(),this._updateViewableItems(this.props.data)},e.measureLayoutRelativeToContainingList=function(){var o=this;try{if(!this._scrollRef)return;this._scrollRef.measureLayout(this.context.virtualizedList.getOutermostParentListRef().getScrollRef().getNativeScrollRef(),function(e,t,r,i){o._offsetFromParentVirtualizedList=o._selectOffset({x:e,y:t}),o._scrollMetrics.contentLength=o._selectLength({width:r,height:i});var s=o._convertParentScrollMetrics(o.context.virtualizedList.getScrollMetrics());o._scrollMetrics.visibleLength=s.visibleLength,o._scrollMetrics.offset=s.offset},function(e){console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")})}catch(e){console.warn("measureLayoutRelativeToContainingList threw an error",e.stack)}},e._renderDebugOverlay=function(){for(var r=this._scrollMetrics.visibleLength/(this._scrollMetrics.contentLength||1),e=[],t=this.props.getItemCount(this.props.data),i=0;i<t;i++){var s=this._getFrameMetricsApprox(i);s.inLayout&&e.push(s)}var o=this._getFrameMetricsApprox(this.state.first).offset,n=this._getFrameMetricsApprox(this.state.last),l=n.offset+n.length-o,a=this._scrollMetrics.offset,c=this._scrollMetrics.visibleLength;return React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlay]},e.map(function(e,t){return React.createElement(_View.default,{key:"f"+t,style:[styles.debugOverlayBase,styles.debugOverlayFrame,{top:e.offset*r,height:e.length*r}]})}),React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlayFrameLast,{top:o*r,height:l*r}]}),React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlayFrameVis,{top:a*r,height:c*r}]}))},e._selectLength=function(e){return this.props.horizontal?e.width:e.height},e._selectOffset=function(e){return this.props.horizontal?e.x:e.y},e._maybeCallOnEndReached=function(){var e=this.props,t=e.data,r=e.getItemCount,i=e.onEndReached,s=e.onEndReachedThreshold,o=this._scrollMetrics,n=o.contentLength,l=o.visibleLength,a=n-l-o.offset;i&&this.state.last===r(t)-1&&a<s*l&&(this._hasDataChangedSinceEndReached||this._scrollMetrics.contentLength!==this._sentEndForContentLength)&&(this._hasDataChangedSinceEndReached=!1,this._sentEndForContentLength=this._scrollMetrics.contentLength,i({distanceFromEnd:a}))},e._scheduleCellsToRenderUpdate=function(){var e,t,r=this.state,i=r.first,s=r.last,o=this._scrollMetrics,n=o.offset,l=o.visibleLength,a=o.velocity,c=this.props.getItemCount(this.props.data),p=!1,h=this.props.onEndReachedThreshold*l/2;if(0<i&&(e=n-this._getFrameMetricsApprox(i).offset,p=p||e<0||a<-2&&e<h),s<c-1&&(t=this._getFrameMetricsApprox(s).offset-(n+l),p=p||t<0||2<a&&t<h),p&&(this._averageCellLength||this.props.getItemLayout)&&!this._hiPriInProgress)return this._hiPriInProgress=!0,this._updateCellsToRenderBatcher.dispose({abort:!0}),void this._updateCellsToRender();this._updateCellsToRenderBatcher.schedule()},e._updateViewableItems=function(t){var r=this,i=this.props.getItemCount;this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.onUpdate(i(t),r._scrollMetrics.offset,r._scrollMetrics.visibleLength,r._getFrameMetrics,r._createViewToken,e.onViewableItemsChanged,r.state)})},t}(React.PureComponent);VirtualizedList.defaultProps={disableVirtualization:!1,horizontal:!1,initialNumToRender:10,keyExtractor:function(e,t){return null!=e.key?e.key:null!=e.id?e.id:(_usedIndexForKey=!0,e.type&&e.type.displayName&&(_keylessItemComponentName=e.type.displayName),String(t))},maxToRenderPerBatch:10,onEndReachedThreshold:2,scrollEventThrottle:50,updateCellsBatchingPeriod:50,windowSize:21},VirtualizedList.contextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string}),virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})},VirtualizedList.childContextTypes={virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})};var CellRenderer=function(i){function e(){for(var o,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(o=i.call.apply(i,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:o.props.item}},o._separators={highlight:function(){var e=o.props,t=e.cellKey,r=e.prevCellKey;o.props.onUpdateSeparators([t,r],{highlighted:!0})},unhighlight:function(){var e=o.props,t=e.cellKey,r=e.prevCellKey;o.props.onUpdateSeparators([t,r],{highlighted:!1})},updateProps:function(e,t){var r=o.props,i=r.cellKey,s=r.prevCellKey;o.props.onUpdateSeparators(["leading"===e?s:i],t)}},o}_inheritsLoose(e,i);var t=e.prototype;return t.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,{},t)}})},t.componentWillUnmount=function(){this.props.onUnmount(this.props.cellKey)},t.render=function(){var e=this.props,t=e.CellRendererComponent,r=e.ItemSeparatorComponent,i=e.fillRateHelper,s=e.horizontal,o=e.item,n=e.index,l=e.inversionStyle,a=e.parentProps,c=a.renderItem,p=a.getItemLayout;(0,_invariant.default)(c,"no renderItem!");var h=c({item:o,index:n,separators:this._separators}),d=!p||a.debug||i.enabled()?this.props.onLayout:void 0,u=r&&React.createElement(r,this.state.separatorProps),f=l?s?[styles.rowReverse,l]:[styles.columnReverse,l]:s?[styles.row,l]:l;return t?React.createElement(t,_extends({},this.props,{style:f,onLayout:d}),h,u):React.createElement(_View.default,{style:f,onLayout:d},h,u)},e}(React.Component);CellRenderer.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var VirtualizedCellWrapper=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},r.render=function(){return this.props.children},t}(React.Component);VirtualizedCellWrapper.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var styles=_StyleSheet.default.create({verticallyInverted:{transform:[{scaleY:-1}]},horizontallyInverted:{transform:[{scaleX:-1}]},row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"},debug:{flex:1},debugOverlayBase:{position:"absolute",top:0,right:0},debugOverlay:{bottom:0,width:20,borderColor:"blue",borderWidth:1},debugOverlayFrame:{left:0,backgroundColor:"orange"},debugOverlayFrameLast:{left:0,borderColor:"green",borderWidth:2},debugOverlayFrameVis:{left:0,borderColor:"red",borderWidth:2}}),_default=VirtualizedList;exports.default=VirtualizedList,module.exports=exports.default;