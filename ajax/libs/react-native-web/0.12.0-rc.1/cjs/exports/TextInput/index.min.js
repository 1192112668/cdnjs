"use strict";exports.__esModule=!0,exports.default=void 0;var _applyLayout=_interopRequireDefault(require("../../modules/applyLayout")),_applyNativeMethods=_interopRequireDefault(require("../../modules/applyNativeMethods")),_ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment"),_createElement=_interopRequireDefault(require("../createElement")),_css=_interopRequireDefault(require("../StyleSheet/css")),_filterSupportedProps=_interopRequireDefault(require("../View/filterSupportedProps")),_findNodeHandle=_interopRequireDefault(require("../findNodeHandle")),_react=_interopRequireDefault(require("react")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var isAndroid=_ExecutionEnvironment.canUseDOM&&/Android/i.test(navigator&&navigator.userAgent),emptyObject={},normalizeEventHandler=function(t){return function(e){if(t)return e.nativeEvent.text=e.target.value,t(e)}},isSelectionStale=function(e,t){if(null==e||null==t)return!1;var n=e.selectionEnd,o=e.selectionStart,a=t.start,r=t.end;return a!==o||r!==n},setSelection=function(e,t){try{var n,o;null!=e&&null!=t&&isSelectionStale(e,t)&&(n=t.start,o=t.end,isAndroid?setTimeout(function(){return e.setSelectionRange(n,o||n)},10):e.setSelectionRange(n,o||n))}catch(e){}},TextInput=function(o){function e(){for(var u,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(u=o.call.apply(o,[this].concat(t))||this)._handleBlur=function(e){var t=u.props.onBlur;_TextInputState.default._currentlyFocusedNode=null,t&&t(e)},u._handleContentSizeChange=function(){var e,t,n=u.props,o=n.onContentSizeChange;n.multiline&&o&&(e=u._node.scrollHeight,t=u._node.scrollWidth,e===u._nodeHeight&&t===u._nodeWidth||(u._nodeHeight=e,u._nodeWidth=t,o({nativeEvent:{contentSize:{height:u._nodeHeight,width:u._nodeWidth}}})))},u._handleChange=function(e){var t=u.props,n=t.onChange,o=t.onChangeText,a=e.nativeEvent.text;u._handleContentSizeChange(),n&&n(e),o&&o(a),u._handleSelectionChange(e)},u._handleFocus=function(e){var t=u.props,n=t.clearTextOnFocus,o=t.onFocus,a=t.selectTextOnFocus,r=u._node;_TextInputState.default._currentlyFocusedNode=u._node,o&&o(e),n&&u.clear(),a&&r&&r.select()},u._handleKeyDown=function(e){e.stopPropagation(),("ArrowLeft"===e.key||"ArrowUp"===e.key||"ArrowRight"===e.key||"ArrowDown"===e.key||"Backspace"===e.key||"Escape"===e.key||"Enter"===e.key&&e.metaKey||"Tab"===e.key)&&u._handleKeyPress(e)},u._handleKeyPress=function(e){var t,n=u.props,o=n.blurOnSubmit,a=n.multiline,r=n.onKeyPress,i=n.onSubmitEditing,l=null==o?!a:o;!r||(t=e.key)&&(e.nativeEvent={altKey:e.altKey,ctrlKey:e.ctrlKey,key:t,metaKey:e.metaKey,shiftKey:e.shiftKey,target:e.target},r(e)),e.isDefaultPrevented()||"Enter"!==e.key||e.shiftKey||(!o&&a||!i||(e.preventDefault(),e.nativeEvent={target:e.target,text:e.target.value},i(e)),l&&u.blur())},u._handleSelectionChange=function(e){var t=u.props,n=t.onSelectionChange,o=t.selection,a=void 0===o?emptyObject:o;if(n)try{var r,i,l=e.target;isSelectionStale(l,a)&&(r=l.selectionStart,i=l.selectionEnd,e.nativeEvent.selection={start:r,end:i},n(e))}catch(e){}},u._setNode=function(e){u._node=(0,_findNodeHandle.default)(e),u._node&&u._handleContentSizeChange()},u}_inheritsLoose(e,o);var t=e.prototype;return t.clear=function(){this._node.value=""},t.isFocused=function(){return _TextInputState.default.currentlyFocusedField()===this._node},t.componentDidMount=function(){setSelection(this._node,this.props.selection),document.activeElement===this._node&&(_TextInputState.default._currentlyFocusedNode=this._node)},t.componentDidUpdate=function(){setSelection(this._node,this.props.selection)},t.render=function(){var e,t=this.props,n=t.autoCapitalize,o=void 0===n?"sentences":n,a=t.autoComplete,r=t.autoCompleteType,i=t.autoCorrect,l=void 0===i||i,u=t.autoFocus,s=t.defaultValue,d=t.disabled,c=t.editable,p=void 0===c||c,h=t.keyboardType,_=void 0===h?"default":h,f=t.maxLength,y=t.multiline,v=void 0!==y&&y,m=t.numberOfLines,g=void 0===m?1:m,S=t.placeholder,x=t.returnKeyType,b=t.secureTextEntry,C=void 0!==b&&b,E=t.spellCheck,k=t.value;switch(_){case"email-address":e="email";break;case"number-pad":case"numeric":e="number";break;case"phone-pad":e="tel";break;case"search":case"web-search":e="search";break;case"url":e="url";break;default:e="text"}C&&(e="password");var T=v?"textarea":"input",K=(0,_filterSupportedProps.default)(this.props);return Object.assign(K,{autoCapitalize:o,autoComplete:a||r||"on",autoCorrect:l?"on":"off",autoFocus:u,classList:[classes.textinput],defaultValue:s,dir:"auto",disabled:d,enterkeyhint:x,maxLength:f,onBlur:normalizeEventHandler(this._handleBlur),onChange:normalizeEventHandler(this._handleChange),onFocus:normalizeEventHandler(this._handleFocus),onKeyDown:this._handleKeyDown,onKeyPress:this._handleKeyPress,onSelect:normalizeEventHandler(this._handleSelectionChange),placeholder:S,readOnly:!p,ref:this._setNode,spellCheck:null!=E?E:l,value:k}),v?K.rows=g:K.type=e,(0,_createElement.default)(T,K)},e}(_react.default.Component);TextInput.displayName="TextInput",TextInput.State=_TextInputState.default;var classes=_css.default.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}}),_default=(0,_applyLayout.default)((0,_applyNativeMethods.default)(TextInput));exports.default=_default,module.exports=exports.default;