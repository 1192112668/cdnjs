"use strict";exports.__esModule=!0,exports.default=void 0;var _AnimatedInterpolation=_interopRequireDefault(require("./AnimatedInterpolation")),_AnimatedNode=_interopRequireDefault(require("./AnimatedNode")),_AnimatedWithChildren2=_interopRequireDefault(require("./AnimatedWithChildren")),_InteractionManager=_interopRequireDefault(require("../../../../exports/InteractionManager")),_NativeAnimatedHelper=_interopRequireDefault(require("../NativeAnimatedHelper"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}var NativeAnimatedAPI=_NativeAnimatedHelper.default.API,_uniqueId=1;function _flush(t){var i=new Set;!function t(e){"function"==typeof e.update?i.add(e):e.__getChildren().forEach(t)}(t),i.forEach(function(t){return t.update()})}var AnimatedValue=function(i){function t(t){var e=i.call(this)||this;return e._startingValue=e._value=t,e._offset=0,e._animation=null,e._listeners={},e}_inheritsLoose(t,i);var e=t.prototype;return e.__detach=function(){this.stopAnimation(),i.prototype.__detach.call(this)},e.__getValue=function(){return this._value+this._offset},e.__makeNative=function(){i.prototype.__makeNative.call(this),Object.keys(this._listeners).length&&this._startListeningToNativeValueUpdates()},e.setValue=function(t){this._animation&&(this._animation.stop(),this._animation=null),this._updateValue(t,!this.__isNative),this.__isNative&&NativeAnimatedAPI.setAnimatedNodeValue(this.__getNativeTag(),t)},e.setOffset=function(t){this._offset=t,this.__isNative&&NativeAnimatedAPI.setAnimatedNodeOffset(this.__getNativeTag(),t)},e.flattenOffset=function(){this._value+=this._offset,this._offset=0,this.__isNative&&NativeAnimatedAPI.flattenAnimatedNodeOffset(this.__getNativeTag())},e.extractOffset=function(){this._offset+=this._value,this._value=0,this.__isNative&&NativeAnimatedAPI.extractAnimatedNodeOffset(this.__getNativeTag())},e.addListener=function(t){var e=String(_uniqueId++);return this._listeners[e]=t,this.__isNative&&this._startListeningToNativeValueUpdates(),e},e.removeListener=function(t){delete this._listeners[t],this.__isNative&&0===Object.keys(this._listeners).length&&this._stopListeningForNativeValueUpdates()},e.removeAllListeners=function(){this._listeners={},this.__isNative&&this._stopListeningForNativeValueUpdates()},e._startListeningToNativeValueUpdates=function(){var e=this;this.__nativeAnimatedValueListener||(NativeAnimatedAPI.startListeningToAnimatedNodeValue(this.__getNativeTag()),this.__nativeAnimatedValueListener=_NativeAnimatedHelper.default.nativeEventEmitter.addListener("onAnimatedValueUpdate",function(t){t.tag===e.__getNativeTag()&&e._updateValue(t.value,!1)}))},e._stopListeningForNativeValueUpdates=function(){this.__nativeAnimatedValueListener&&(this.__nativeAnimatedValueListener.remove(),this.__nativeAnimatedValueListener=null,NativeAnimatedAPI.stopListeningToAnimatedNodeValue(this.__getNativeTag()))},e.stopAnimation=function(t){this.stopTracking(),this._animation&&this._animation.stop(),this._animation=null,t&&t(this.__getValue())},e.resetAnimation=function(t){this.stopAnimation(t),this._value=this._startingValue},e.interpolate=function(t){return new _AnimatedInterpolation.default(this,t)},e.animate=function(t,e){var i=this,a=null;t.__isInteraction&&(a=_InteractionManager.default.createInteractionHandle());var n=this._animation;this._animation&&this._animation.stop(),(this._animation=t).start(this._value,function(t){i._updateValue(t,!0)},function(t){(i._animation=null)!==a&&_InteractionManager.default.clearInteractionHandle(a),e&&e(t)},n,this)},e.stopTracking=function(){this._tracking&&this._tracking.__detach(),this._tracking=null},e.track=function(t){this.stopTracking(),this._tracking=t},e._updateValue=function(t,e){for(var i in this._value=t,e&&_flush(this),this._listeners)this._listeners[i]({value:this.__getValue()})},e.__getNativeConfig=function(){return{type:"value",value:this._value,offset:this._offset}},t}(_AnimatedWithChildren2.default),_default=AnimatedValue;exports.default=AnimatedValue,module.exports=exports.default;