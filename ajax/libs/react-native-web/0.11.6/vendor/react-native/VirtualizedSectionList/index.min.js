function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}import React from"react";import View from"../../../exports/View";import VirtualizedList from"../VirtualizedList";import invariant from"fbjs/lib/invariant";var VirtualizedSectionList=function(e){_inheritsLoose(r,e);var t=r.prototype;function r(t,r){var n;return(n=e.call(this,t,r)||this)._keyExtractor=function(e,t){var r=n._subExtractor(t);return r&&r.key||String(t)},n._convertViewable=function(e){invariant(null!=e.index,"Received a broken ViewToken");var t=n._subExtractor(e.index);if(!t)return null;var r=t.section.keyExtractor||n.props.keyExtractor;return _objectSpread({},e,{index:t.index,key:r(e.item,t.index),section:t.section})},n._onViewableItemsChanged=function(e){var t=e.viewableItems,r=e.changed;n.props.onViewableItemsChanged&&n.props.onViewableItemsChanged({viewableItems:t.map(n._convertViewable,_assertThisInitialized(_assertThisInitialized(n))).filter(Boolean),changed:r.map(n._convertViewable,_assertThisInitialized(_assertThisInitialized(n))).filter(Boolean)})},n._renderItem=function(e){var t=e.item,r=e.index,i=n._subExtractor(r);if(!i)return null;var o=i.index;if(null==o){var a=i.section;if(!0===i.header){var s=n.props.renderSectionHeader;return s?s({section:a}):null}var p=n.props.renderSectionFooter;return p?p({section:a}):null}var c=i.section.renderItem||n.props.renderItem,l=n._getSeparatorComponent(r,i);return invariant(c,"no renderItem!"),React.createElement(ItemWithSeparator,{SeparatorComponent:l,LeadingSeparatorComponent:0===o?n.props.SectionSeparatorComponent:void 0,cellKey:i.key,index:o,item:t,leadingItem:i.leadingItem,leadingSection:i.leadingSection,onUpdateSeparator:n._onUpdateSeparator,prevCellKey:(n._subExtractor(r-1)||{}).key,ref:function(e){n._cellRefs[i.key]=e},renderItem:c,section:i.section,trailingItem:i.trailingItem,trailingSection:i.trailingSection})},n._onUpdateSeparator=function(e,t){var r=n._cellRefs[e];r&&r.updateSeparatorProps(t)},n._cellRefs={},n._captureRef=function(e){n._listRef=e},n.state=n._computeState(t),n}return t.scrollToLocation=function(e){for(var t=e.itemIndex+1,r=0;r<e.sectionIndex;r++)t+=this.props.sections[r].data.length+2;var n=_objectSpread({},e,{index:t});this._listRef.scrollToIndex(n)},t.getListRef=function(){return this._listRef},t._subExtractor=function(e){for(var t=e,r=this.props.keyExtractor,n=0;n<this.props.sections.length;n++){var i=this.props.sections[n],o=i.key||String(n);if((t-=1)>=i.data.length+1)t-=i.data.length+1;else return-1===t?{section:i,key:o+":header",index:null,header:!0,trailingSection:this.props.sections[n+1]}:t===i.data.length?{section:i,key:o+":footer",index:null,header:!1,trailingSection:this.props.sections[n+1]}:{section:i,key:o+":"+(i.keyExtractor||r)(i.data[t],t),index:t,leadingItem:i.data[t-1],leadingSection:this.props.sections[n-1],trailingItem:i.data[t+1],trailingSection:this.props.sections[n+1]}}},t._getSeparatorComponent=function(e,t){if(!(t=t||this._subExtractor(e)))return null;var r=t.section.ItemSeparatorComponent||this.props.ItemSeparatorComponent,n=this.props.SectionSeparatorComponent,i=e===this.state.childProps.getItemCount()-1,o=t.index===t.section.data.length-1;return n&&o?n:!r||o||i?null:r},t._computeState=function(e){var t=e.ListHeaderComponent?1:0,r=[],n=e.sections.reduce(function(e,n){return r.push(e+t),e+n.data.length+2},0);return{childProps:_objectSpread({},e,{renderItem:this._renderItem,ItemSeparatorComponent:void 0,data:e.sections,getItemCount:function(){return n},getItem:getItem,keyExtractor:this._keyExtractor,onViewableItemsChanged:e.onViewableItemsChanged?this._onViewableItemsChanged:void 0,stickyHeaderIndices:e.stickySectionHeadersEnabled?r:void 0})}},t.UNSAFE_componentWillReceiveProps=function(e){this.setState(this._computeState(e))},t.render=function(){return React.createElement(VirtualizedList,_extends({},this.state.childProps,{ref:this._captureRef}))},r}(React.PureComponent);VirtualizedSectionList.defaultProps=_objectSpread({},VirtualizedList.defaultProps,{data:[]});var ItemWithSeparator=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).state={separatorProps:{highlighted:!1,leadingItem:t.props.item,leadingSection:t.props.leadingSection,section:t.props.section,trailingItem:t.props.trailingItem,trailingSection:t.props.trailingSection},leadingSeparatorProps:{highlighted:!1,leadingItem:t.props.leadingItem,leadingSection:t.props.leadingSection,section:t.props.section,trailingItem:t.props.item,trailingSection:t.props.trailingSection}},t._separators={highlight:function(){["leading","trailing"].forEach(function(e){return t._separators.updateProps(e,{highlighted:!0})})},unhighlight:function(){["leading","trailing"].forEach(function(e){return t._separators.updateProps(e,{highlighted:!1})})},updateProps:function(e,r){var n=t.props,i=n.LeadingSeparatorComponent,o=n.cellKey,a=n.prevCellKey;"leading"===e&&i?t.setState(function(e){return{leadingSeparatorProps:_objectSpread({},e.leadingSeparatorProps,r)}}):t.props.onUpdateSeparator("leading"===e&&a||o,r)}},t}_inheritsLoose(t,e);var r=t.prototype;return r.UNSAFE_componentWillReceiveProps=function(e){var t=this;this.setState(function(r){return{separatorProps:_objectSpread({},t.state.separatorProps,{leadingItem:e.item,leadingSection:e.leadingSection,section:e.section,trailingItem:e.trailingItem,trailingSection:e.trailingSection}),leadingSeparatorProps:_objectSpread({},t.state.leadingSeparatorProps,{leadingItem:e.leadingItem,leadingSection:e.leadingSection,section:e.section,trailingItem:e.item,trailingSection:e.trailingSection})}})},r.updateSeparatorProps=function(e){this.setState(function(t){return{separatorProps:_objectSpread({},t.separatorProps,e)}})},r.render=function(){var e=this.props,t=e.LeadingSeparatorComponent,r=e.SeparatorComponent,n=e.item,i=e.index,o=e.section,a=this.props.renderItem({item:n,index:i,section:o,separators:this._separators}),s=t&&React.createElement(t,this.state.leadingSeparatorProps),p=r&&React.createElement(r,this.state.separatorProps);return s||p?React.createElement(View,null,s,a,p):a},t}(React.Component);function getItem(e,t){if(!e)return null;for(var r=t-1,n=0;n<e.length;n++){if(-1===r||r===e[n].data.length)return e[n];if(r<e[n].data.length)return e[n].data[r];r-=e[n].data.length+2}return null}export default VirtualizedSectionList;