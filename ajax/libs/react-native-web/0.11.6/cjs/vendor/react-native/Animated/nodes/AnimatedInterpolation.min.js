"use strict";exports.__esModule=!0,exports.default=void 0;var _AnimatedNode=_interopRequireDefault(require("./AnimatedNode")),_AnimatedWithChildren2=_interopRequireDefault(require("./AnimatedWithChildren")),_NativeAnimatedHelper=_interopRequireDefault(require("../NativeAnimatedHelper")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_normalizeCssColor=_interopRequireDefault(require("normalize-css-color"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),a.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var linear=function(t){return t};function createInterpolation(t){if(t.outputRange&&"string"==typeof t.outputRange[0])return createInterpolationFromStringOutputRange(t);var n=t.outputRange;checkInfiniteRange("outputRange",n);var a=t.inputRange;checkInfiniteRange("inputRange",a),checkValidInputRange(a),(0,_invariant.default)(a.length===n.length,"inputRange ("+a.length+") and outputRange ("+n.length+") must have the same length");var r=t.easing||linear,i="extend";void 0!==t.extrapolateLeft?i=t.extrapolateLeft:void 0!==t.extrapolate&&(i=t.extrapolate);var o="extend";return void 0!==t.extrapolateRight?o=t.extrapolateRight:void 0!==t.extrapolate&&(o=t.extrapolate),function(t){(0,_invariant.default)("number"==typeof t,"Cannot interpolation an input which is not a number");var e=findRange(t,a);return interpolate(t,a[e],a[e+1],n[e],n[e+1],r,i,o)}}function interpolate(t,e,n,a,r,i,o,u){var l=t;if(l<e){if("identity"===o)return l;"clamp"===o&&(l=e)}if(n<l){if("identity"===u)return l;"clamp"===u&&(l=n)}return a===r?a:e===n?t<=e?a:r:(e===-1/0?l=-l:n===1/0?l-=e:l=(l-e)/(n-e),l=i(l),a===-1/0?l=-l:r===1/0?l+=a:l=l*(r-a)+a,l)}function colorToRgba(t){var e=(0,_normalizeCssColor.default)(t);return null===e?t:"rgba("+((4278190080&(e=e||0))>>>24)+", "+((16711680&e)>>>16)+", "+((65280&e)>>>8)+", "+(255&e)/255+")"}var stringShapeRegex=/[0-9\.-]+/g;function createInterpolationFromStringOutputRange(n){var t=n.outputRange;(0,_invariant.default)(2<=t.length,"Bad output range"),checkPattern(t=t.map(colorToRgba));var a=t[0].match(stringShapeRegex).map(function(){return[]});t.forEach(function(t){t.match(stringShapeRegex).forEach(function(t,e){a[e].push(+t)})});var r=t[0].match(stringShapeRegex).map(function(t,e){return createInterpolation(_objectSpread({},n,{outputRange:a[e]}))}),i=isRgbOrRgba(t[0]);return function(n){var a=0;return t[0].replace(stringShapeRegex,function(){var t=+r[a++](n),e=i&&a<4?Math.round(t):Math.round(1e3*t)/1e3;return String(e)})}}function isRgbOrRgba(t){return"string"==typeof t&&t.startsWith("rgb")}function checkPattern(t){for(var e=t[0].replace(stringShapeRegex,""),n=1;n<t.length;++n)(0,_invariant.default)(e===t[n].replace(stringShapeRegex,""),"invalid pattern "+t[0]+" and "+t[n])}function findRange(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}function checkValidInputRange(t){(0,_invariant.default)(2<=t.length,"inputRange must have at least 2 elements");for(var e=1;e<t.length;++e)(0,_invariant.default)(t[e]>=t[e-1],"inputRange must be monotonically increasing "+t)}function checkInfiniteRange(t,e){(0,_invariant.default)(2<=e.length,t+" must have at least 2 elements"),(0,_invariant.default)(2!==e.length||e[0]!==-1/0||e[1]!==1/0,t+"cannot be ]-infinity;+infinity[ "+e)}var AnimatedInterpolation=function(a){function e(t,e){var n=a.call(this)||this;return n._parent=t,n._config=e,n._interpolation=createInterpolation(e),n}_inheritsLoose(e,a);var t=e.prototype;return t.__makeNative=function(){this._parent.__makeNative(),a.prototype.__makeNative.call(this)},t.__getValue=function(){var t=this._parent.__getValue();return(0,_invariant.default)("number"==typeof t,"Cannot interpolate an input which is not a number."),this._interpolation(t)},t.interpolate=function(t){return new e(this,t)},t.__attach=function(){this._parent.__addChild(this)},t.__detach=function(){this._parent.__removeChild(this),a.prototype.__detach.call(this)},t.__transformDataType=function(t){return t.map(function(t){return"string"!=typeof t?t:/deg$/.test(t)?(parseFloat(t)||0)*Math.PI/180:parseFloat(t)||0})},t.__getNativeConfig=function(){return"production"!==process.env.NODE_ENV&&_NativeAnimatedHelper.default.validateInterpolation(this._config),{inputRange:this._config.inputRange,outputRange:this.__transformDataType(this._config.outputRange),extrapolateLeft:this._config.extrapolateLeft||this._config.extrapolate||"extend",extrapolateRight:this._config.extrapolateRight||this._config.extrapolate||"extend",type:"interpolation"}},e}(_AnimatedWithChildren2.default);AnimatedInterpolation.__createInterpolation=createInterpolation;var _default=AnimatedInterpolation;exports.default=AnimatedInterpolation,module.exports=exports.default;