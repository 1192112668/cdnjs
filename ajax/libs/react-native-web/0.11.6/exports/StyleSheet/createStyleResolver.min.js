function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}import{canUseDOM}from"fbjs/lib/ExecutionEnvironment";import createCSSStyleSheet from"./createCSSStyleSheet";import createCompileableStyle from"./createCompileableStyle";import createOrderedCSSStyleSheet from"./createOrderedCSSStyleSheet";import flattenArray from"../../modules/flattenArray";import flattenStyle from"./flattenStyle";import I18nManager from"../I18nManager";import i18nStyle from"./i18nStyle";import{atomic,classic,inline,stringifyValueWithProperty}from"./compile";import initialRules from"./initialRules";import modality from"./modality";import{STYLE_ELEMENT_ID,STYLE_GROUPS}from"./constants";var emptyObject={};export default function createStyleResolver(){var e,t,r,n={css:{},ltr:{},rtl:{},rtlNoSwap:{}},a=function(){e={css:{},ltr:{},rtl:{},rtlNoSwap:{}},t=createOrderedCSSStyleSheet(createCSSStyleSheet(STYLE_ELEMENT_ID)),r={byClassName:{},byProp:{}},modality(function(e){return t.insert(e,STYLE_GROUPS.modality)}),initialRules.forEach(function(e){t.insert(e,STYLE_GROUPS.reset)})};function l(n){var a=I18nManager.doLeftAndRightSwapInRTL,l=I18nManager.isRTL?a?"rtl":"rtlNoSwap":"ltr";if(!e[l][n]){var i=createCompileableStyle(i18nStyle(flattenStyle(n))),o=atomic(i);Object.keys(o).forEach(function(e){var n=o[e],a=n.identifier,l=n.property,i=n.rules,s=n.value;!function(e,t,n){r.byProp[t]||(r.byProp[t]={}),r.byProp[t][n]=e,r.byClassName[e]={prop:t,value:n}}(a,l,s),i.forEach(function(e){var r=STYLE_GROUPS.custom[l]||STYLE_GROUPS.atomic;t.insert(e,r)})}),e[l][n]=!0}}function i(r,a){var i=[],s={};if(!r&&!a)return s;if(Array.isArray(a)&&flattenArray(a).forEach(function(r){if(r){if(null==e.css[r]&&null!=n.css[r]){var a=n.css[r];a.rules.forEach(function(e){t.insert(e,a.group)}),e.css[r]=!0}i.push(r)}}),"number"==typeof r)l(r),s=o(r,createCacheKey(r));else if(Array.isArray(r)){for(var c=flattenArray(r),f=!0,u="",y=0;y<c.length;y++){var S=c[y];"number"!=typeof S?f=!1:(f&&(u+=S+"-"),l(S))}s=o(c,f?createCacheKey(u):null)}else s=o(r);i.push.apply(i,s.classList);var p={className:classListToString(i),classList:i};return s.style&&(p.style=s.style),p}function o(e,a){var l=I18nManager.doLeftAndRightSwapInRTL,i=I18nManager.isRTL?l?"rtl":"rtlNoSwap":"ltr";if(null!=a&&null!=n[i][a])return n[i][a];var o=flattenStyle(e),s=createCompileableStyle(i18nStyle(o)),c=Object.keys(s).sort().reduce(function(e,n){var a=s[n];if(null!=a){var l=function(e,t){var n=stringifyValueWithProperty(t,e),a=r.byProp;return a[e]&&a[e].hasOwnProperty(n)&&a[e][n]}(n,a);if(l)e.classList.push(l);else if("animationKeyframes"===n||"placeholderTextColor"===n||"pointerEvents"===n||"scrollbarWidth"===n){var i,o=atomic(((i={})[n]=a,i));Object.values(o).forEach(function(r){var n=r.identifier,a=r.rules;e.classList.push(n),a.forEach(function(e){t.insert(e,STYLE_GROUPS.atomic)})})}else e.style||(e.style={}),e.style[n]=a}return e},{classList:[]});return c.style&&(c.style=inline(c.style)),null!=a&&(n[i][a]=c),c}return a(),{getStyleSheet:function(){var e=t.getTextContent();return canUseDOM||a(),{id:STYLE_ELEMENT_ID,textContent:e}},createCSS:function(e,t){var r={};return Object.keys(e).forEach(function(a){var l=e[a],i=classic(l,a);Object.values(i).forEach(function(e){var l=e.identifier,i=e.rules;n.css[l]={group:t||STYLE_GROUPS.classic,rules:i},r[a]=l})}),r},resolve:i,sheet:t,resolveWithNode:function(e,t){function n(e){return r.byClassName[e]||emptyObject}var a=getDOMStyleInfo(t),l=a.classList,o=a.style,s=l.reduce(function(e,t){var r=n(t),a=r.prop,l=r.value;return a?e.style[a]=l:e.classList.push(t),e},{classList:[],style:{}}),c=s.classList,f=s.style,u=i([i18nStyle(f),e]),y=u.classList,S=u.style,p=classListToString(y.concat(c)),m=_objectSpread({},o);return y.forEach(function(e){var t=n(e).prop;m[t]&&(m[t]="")}),Object.assign(m,S),{className:p,style:m}}}};var createCacheKey=function(e){return"rn-"+e},classListToString=function(e){return e.join(" ").trim()},hyphenPattern=/-([a-z])/g,toCamelCase=function(e){return e.replace(hyphenPattern,function(e){return e[1].toUpperCase()})},getDOMStyleInfo=function(e){for(var t=e.style,r=Array.prototype.slice.call(e.classList),n={},a=0;a<t.length;a+=1){var l=t.item(a);l&&(n[toCamelCase(l)]=t.getPropertyValue(l))}return{classList:r,style:n}};