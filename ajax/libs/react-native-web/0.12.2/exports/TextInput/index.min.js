function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}import applyLayout from"../../modules/applyLayout";import applyNativeMethods from"../../modules/applyNativeMethods";import{canUseDOM}from"fbjs/lib/ExecutionEnvironment";import createElement from"../createElement";import css from"../StyleSheet/css";import filterSupportedProps from"../View/filterSupportedProps";import findNodeHandle from"../findNodeHandle";import React from"react";import StyleSheet from"../StyleSheet";import TextInputState from"../../modules/TextInputState";var isAndroid=canUseDOM&&/Android/i.test(navigator&&navigator.userAgent),emptyObject={},normalizeEventHandler=function(e){return function(t){if(e)return t.nativeEvent.text=t.target.value,e(t)}},isSelectionStale=function(e,t){if(null!=e&&null!=t){var n=e.selectionEnd,o=e.selectionStart,a=t.start,r=t.end;return a!==o||r!==n}return!1},setSelection=function(e,t){try{if(null!=e&&null!=t&&isSelectionStale(e,t)){var n=t.start,o=t.end;isAndroid?setTimeout(function(){return e.setSelectionRange(n,o||n)},10):e.setSelectionRange(n,o||n)}}catch(e){}},TextInput=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this)._handleBlur=function(e){var n=t.props.onBlur;TextInputState._currentlyFocusedNode=null,n&&n(e)},t._handleContentSizeChange=function(){var e=t.props,n=e.onContentSizeChange;if(e.multiline&&n){var o=t._node.scrollHeight,a=t._node.scrollWidth;o===t._nodeHeight&&a===t._nodeWidth||(t._nodeHeight=o,t._nodeWidth=a,n({nativeEvent:{contentSize:{height:t._nodeHeight,width:t._nodeWidth}}}))}},t._handleChange=function(e){var n=t.props,o=n.onChange,a=n.onChangeText,r=e.nativeEvent.text;t._handleContentSizeChange(),o&&o(e),a&&a(r),t._handleSelectionChange(e)},t._handleFocus=function(e){var n=t.props,o=n.clearTextOnFocus,a=n.onFocus,r=n.selectTextOnFocus,i=t._node;TextInputState._currentlyFocusedNode=t._node,a&&a(e),o&&t.clear(),r&&i&&i.select()},t._handleKeyDown=function(e){e.stopPropagation(),("ArrowLeft"===e.key||"ArrowUp"===e.key||"ArrowRight"===e.key||"ArrowDown"===e.key||"Backspace"===e.key||"Escape"===e.key||"Enter"===e.key&&e.metaKey||"Tab"===e.key)&&t._handleKeyPress(e)},t._handleKeyPress=function(e){var n=t.props,o=n.blurOnSubmit,a=n.multiline,r=n.onKeyPress,i=n.onSubmitEditing,l=null==o?!a:o;if(r){var s=e.key;s&&(e.nativeEvent={altKey:e.altKey,ctrlKey:e.ctrlKey,key:s,metaKey:e.metaKey,shiftKey:e.shiftKey,target:e.target},r(e))}e.isDefaultPrevented()||"Enter"!==e.key||e.shiftKey||(!o&&a||!i||(e.preventDefault(),e.nativeEvent={target:e.target,text:e.target.value},i(e)),l&&t.blur())},t._handleSelectionChange=function(e){var n=t.props,o=n.onSelectionChange,a=n.selection,r=void 0===a?emptyObject:a;if(o)try{var i=e.target;if(isSelectionStale(i,r)){var l=i.selectionStart,s=i.selectionEnd;e.nativeEvent.selection={start:l,end:s},o(e)}}catch(e){}},t._setNode=function(e){t._node=findNodeHandle(e),t._node&&t._handleContentSizeChange()},t}_inheritsLoose(t,e);var n=t.prototype;return n.clear=function(){this._node.value=""},n.isFocused=function(){return TextInputState.currentlyFocusedField()===this._node},n.componentDidMount=function(){setSelection(this._node,this.props.selection),document.activeElement===this._node&&(TextInputState._currentlyFocusedNode=this._node)},n.componentDidUpdate=function(){setSelection(this._node,this.props.selection)},n.render=function(){var e,t=this.props,n=t.autoCapitalize,o=void 0===n?"sentences":n,a=t.autoComplete,r=t.autoCompleteType,i=t.autoCorrect,l=void 0===i||i,s=t.autoFocus,c=t.defaultValue,d=t.disabled,u=t.editable,p=void 0===u||u,h=t.keyboardType,y=void 0===h?"default":h,f=t.maxLength,m=t.multiline,v=void 0!==m&&m,S=t.numberOfLines,_=void 0===S?1:S,g=t.placeholder,x=t.placeholderTextColor,b=t.returnKeyType,C=t.secureTextEntry,k=void 0!==C&&C,E=t.spellCheck,T=t.style,K=t.value;switch(y){case"email-address":e="email";break;case"number-pad":case"numeric":e="number";break;case"phone-pad":e="tel";break;case"search":case"web-search":e="search";break;case"url":e="url";break;default:e="text"}k&&(e="password");var w=v?"textarea":"input",z=filterSupportedProps(this.props);return Object.assign(z,{autoCapitalize:o,autoComplete:a||r||"on",autoCorrect:l?"on":"off",autoFocus:s,classList:[classes.textinput],defaultValue:c,dir:"auto",disabled:d,enterkeyhint:b,maxLength:f,onBlur:normalizeEventHandler(this._handleBlur),onChange:normalizeEventHandler(this._handleChange),onFocus:normalizeEventHandler(this._handleFocus),onKeyDown:this._handleKeyDown,onKeyPress:this._handleKeyPress,onSelect:normalizeEventHandler(this._handleSelectionChange),placeholder:g,readOnly:!p,ref:this._setNode,spellCheck:null!=E?E:l,style:StyleSheet.compose(T,x&&{placeholderTextColor:x}),value:K}),v?z.rows=_:z.type=e,createElement(w,z)},t}(React.Component);TextInput.displayName="TextInput",TextInput.State=TextInputState;var classes=css.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}});export default applyLayout(applyNativeMethods(TextInput));