function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}import{canUseDOM}from"fbjs/lib/ExecutionEnvironment";import createCSSStyleSheet from"./createCSSStyleSheet";import createCompileableStyle from"./createCompileableStyle";import createOrderedCSSStyleSheet from"./createOrderedCSSStyleSheet";import flattenArray from"../../modules/flattenArray";import flattenStyle from"./flattenStyle";import I18nManager from"../I18nManager";import i18nStyle from"./i18nStyle";import{atomic,classic,inline,stringifyValueWithProperty}from"./compile";import initialRules from"./initialRules";import modality from"./modality";import{STYLE_ELEMENT_ID,STYLE_GROUPS}from"./constants";var emptyObject={};export default function createStyleResolver(){var e,t,r,n={css:{},ltr:{},rtl:{},rtlNoSwap:{}},a=function(){e={css:{},ltr:{},rtl:{},rtlNoSwap:{}},t=createOrderedCSSStyleSheet(createCSSStyleSheet(STYLE_ELEMENT_ID)),r={byClassName:{},byProp:{}},modality(function(e){return t.insert(e,STYLE_GROUPS.modality)}),initialRules.forEach(function(e){t.insert(e,STYLE_GROUPS.reset)})};function i(n){var a=I18nManager.doLeftAndRightSwapInRTL,i=I18nManager.isRTL?a?"rtl":"rtlNoSwap":"ltr";if(!e[i][n]){var l=createCompileableStyle(i18nStyle(flattenStyle(n))),o=atomic(l);Object.keys(o).forEach(function(e){var n=o[e],a=n.identifier,i=n.property,l=n.rules,s=n.value;!function(e,t,n){r.byProp[t]||(r.byProp[t]={}),r.byProp[t][n]=e,r.byClassName[e]={prop:t,value:n}}(a,i,s),l.forEach(function(e){var r=STYLE_GROUPS.custom[i]||STYLE_GROUPS.atomic;t.insert(e,r)})}),e[i][n]=!0}}function l(r,a){var l=[],s={};if(!r&&!a)return s;if(Array.isArray(a)&&flattenArray(a).forEach(function(r){if(r){if(null==e.css[r]&&null!=n.css[r]){var a=n.css[r];a.rules.forEach(function(e){t.insert(e,a.group)}),e.css[r]=!0}l.push(r)}}),"number"==typeof r)i(r),s=o(r,createCacheKey(r));else if(Array.isArray(r)){for(var c=flattenArray(r),f=!0,y="",u=0;u<c.length;u++){var p=c[u];"number"!=typeof p?f=!1:(f&&(y+=p+"-"),i(p))}s=o(c,f?createCacheKey(y):null)}else s=o(r);l.push.apply(l,s.classList);var S={className:classListToString(l),classList:l};return s.style&&(S.style=s.style),S}function o(e,a){var i=I18nManager.doLeftAndRightSwapInRTL,l=I18nManager.isRTL?i?"rtl":"rtlNoSwap":"ltr";if(null!=a&&null!=n[l][a])return n[l][a];var o=flattenStyle(e),s=createCompileableStyle(i18nStyle(o)),c=Object.keys(s).sort().reduce(function(e,n){var a=s[n];if(null!=a){var i=function(e,t){var n=stringifyValueWithProperty(t,e),a=r.byProp;return a[e]&&a[e].hasOwnProperty(n)&&a[e][n]}(n,a);if(i)e.classList.push(i);else if("animationKeyframes"===n||"placeholderTextColor"===n||"pointerEvents"===n||"scrollbarWidth"===n){var l,o=atomic(((l={})[n]=a,l));Object.keys(o).forEach(function(r){var n=o[r],a=n.identifier,i=n.rules;e.classList.push(a),i.forEach(function(e){t.insert(e,STYLE_GROUPS.atomic)})})}else e.style||(e.style={}),e.style[n]=a}return e},{classList:[]});return c.style&&(c.style=inline(c.style)),null!=a&&(n[l][a]=c),c}return a(),{getStyleSheet:function(){var e=t.getTextContent();return canUseDOM||a(),{id:STYLE_ELEMENT_ID,textContent:e}},createCSS:function(e,t){var r={};return Object.keys(e).forEach(function(a){var i=e[a],l=classic(i,a);Object.keys(l).forEach(function(e){var i=l[e],o=i.identifier,s=i.rules;n.css[o]={group:t||STYLE_GROUPS.classic,rules:s},r[a]=o})}),r},resolve:l,sheet:t,resolveWithNode:function(e,t){function n(e){return r.byClassName[e]||emptyObject}var a=getDOMStyleInfo(t),i=a.classList,o=a.style,s=i.reduce(function(e,t){var r=n(t),a=r.prop,i=r.value;return a?e.style[a]=i:e.classList.push(t),e},{classList:[],style:{}}),c=s.classList,f=s.style,y=l([i18nStyle(f),e]),u=y.classList,p=y.style,S=classListToString(u.concat(c)),m=_objectSpread({},o);return u.forEach(function(e){var t=n(e).prop;m[t]&&(m[t]="")}),Object.assign(m,p),{className:S,style:m}}}};var createCacheKey=function(e){return"rn-"+e},classListToString=function(e){return e.join(" ").trim()},hyphenPattern=/-([a-z])/g,toCamelCase=function(e){return e.replace(hyphenPattern,function(e){return e[1].toUpperCase()})},getDOMStyleInfo=function(e){for(var t=e.style,r=Array.prototype.slice.call(e.classList),n={},a=0;a<t.length;a+=1){var i=t.item(a);i&&(n[toCamelCase(i)]=t.getPropertyValue(i))}return{classList:r,style:n}};