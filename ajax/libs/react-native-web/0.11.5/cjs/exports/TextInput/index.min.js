"use strict";exports.__esModule=!0,exports.default=void 0;var _applyLayout=_interopRequireDefault(require("../../modules/applyLayout")),_applyNativeMethods=_interopRequireDefault(require("../../modules/applyNativeMethods")),_ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment"),_react=require("react"),_ColorPropType=_interopRequireDefault(require("../ColorPropType")),_createElement=_interopRequireDefault(require("../createElement")),_css=_interopRequireDefault(require("../StyleSheet/css")),_findNodeHandle=_interopRequireDefault(require("../findNodeHandle")),_StyleSheetPropType=_interopRequireDefault(require("../../modules/StyleSheetPropType")),_TextInputStylePropTypes=_interopRequireDefault(require("./TextInputStylePropTypes")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState")),_ViewPropTypes=_interopRequireDefault(require("../ViewPropTypes")),_propTypes=require("prop-types");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var n,o={},r=Object.keys(e),a=0;a<r.length;a++)n=r[a],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var isAndroid=_ExecutionEnvironment.canUseDOM&&/Android/i.test(navigator&&navigator.userAgent),emptyObject={},normalizeEventHandler=function(t){return function(e){if(t)return e.nativeEvent.text=e.target.value,t(e)}},isSelectionStale=function(e,t){if(e&&t){var n=e.selectionEnd,o=e.selectionStart,r=t.start,a=t.end;return r!==o||a!==n}return!1},setSelection=function(e,t){try{var n,o;isSelectionStale(e,t)&&(n=t.start,o=t.end,isAndroid?setTimeout(function(){return e.setSelectionRange(n,o||n)},10):e.setSelectionRange(n,o||n))}catch(e){}},TextInput=function(o){function e(){for(var l,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(l=o.call.apply(o,[this].concat(t))||this)._handleBlur=function(e){var t=l.props.onBlur;_TextInputState.default._currentlyFocusedNode=null,t&&t(e)},l._handleContentSizeChange=function(){var e,t,n=l.props,o=n.onContentSizeChange;n.multiline&&o&&(e=l._node.scrollHeight,t=l._node.scrollWidth,e===l._nodeHeight&&t===l._nodeWidth||(l._nodeHeight=e,l._nodeWidth=t,o({nativeEvent:{contentSize:{height:l._nodeHeight,width:l._nodeWidth}}})))},l._handleChange=function(e){var t=l.props,n=t.onChange,o=t.onChangeText,r=e.nativeEvent.text;l._handleContentSizeChange(),n&&n(e),o&&o(r),l._handleSelectionChange(e)},l._handleFocus=function(e){var t=l.props,n=t.clearTextOnFocus,o=t.onFocus,r=t.selectTextOnFocus,a=l._node;_TextInputState.default._currentlyFocusedNode=l._node,o&&o(e),n&&l.clear(),r&&a&&a.select()},l._handleKeyDown=function(e){e.stopPropagation(),("ArrowLeft"===e.key||"ArrowUp"===e.key||"ArrowRight"===e.key||"ArrowDown"===e.key||"Backspace"===e.key||"Escape"===e.key||"Enter"===e.key&&e.metaKey||"Tab"===e.key)&&l._handleKeyPress(e)},l._handleKeyPress=function(e){var t,n=l.props,o=n.blurOnSubmit,r=n.multiline,a=n.onKeyPress,i=n.onSubmitEditing,p=null==o?!r:o;!a||(t=e.key)&&(e.nativeEvent={altKey:e.altKey,ctrlKey:e.ctrlKey,key:t,metaKey:e.metaKey,shiftKey:e.shiftKey,target:e.target},a(e)),e.isDefaultPrevented()||"Enter"!==e.key||e.shiftKey||(!o&&r||!i||(e.preventDefault(),e.nativeEvent={target:e.target,text:e.target.value},i(e)),p&&l.blur())},l._handleSelectionChange=function(e){var t=l.props,n=t.onSelectionChange,o=t.selection,r=void 0===o?emptyObject:o;if(n)try{var a,i,p=e.target;isSelectionStale(p,r)&&(a=p.selectionStart,i=p.selectionEnd,e.nativeEvent.selection={start:a,end:i},n(e))}catch(e){}},l._setNode=function(e){l._node=(0,_findNodeHandle.default)(e),l._node&&l._handleContentSizeChange()},l}_inheritsLoose(e,o);var t=e.prototype;return t.clear=function(){this._node.value=""},t.isFocused=function(){return _TextInputState.default.currentlyFocusedField()===this._node},t.componentDidMount=function(){setSelection(this._node,this.props.selection),document.activeElement===this._node&&(_TextInputState.default._currentlyFocusedNode=this._node)},t.componentDidUpdate=function(){setSelection(this._node,this.props.selection)},t.render=function(){var e,t=this.props,n=t.autoComplete,o=t.autoCorrect,r=t.editable,a=t.keyboardType,i=t.multiline,p=t.numberOfLines,l=t.secureTextEntry,s=(t.blurOnSubmit,t.clearTextOnFocus,t.onChangeText,t.onLayout,t.onSelectionChange,t.onSubmitEditing,t.selection,t.selectTextOnFocus,t.spellCheck),u=(t.accessibilityViewIsModal,t.allowFontScaling,t.caretHidden,t.clearButtonMode,t.dataDetectorTypes,t.disableFullscreenUI,t.enablesReturnKeyAutomatically,t.hitSlop,t.inlineImageLeft,t.inlineImagePadding,t.inputAccessoryViewID,t.keyboardAppearance,t.maxFontSizeMultiplier,t.needsOffscreenAlphaCompositing,t.onAccessibilityTap,t.onContentSizeChange,t.onEndEditing,t.onMagicTap,t.onScroll,t.removeClippedSubviews,t.renderToHardwareTextureAndroid,t.returnKeyLabel,t.returnKeyType,t.scrollEnabled,t.selectionColor,t.selectionState,t.shouldRasterizeIOS,t.textBreakStrategy,t.textContentType,t.underlineColorAndroid,_objectWithoutPropertiesLoose(t,["autoComplete","autoCorrect","editable","keyboardType","multiline","numberOfLines","secureTextEntry","blurOnSubmit","clearTextOnFocus","onChangeText","onLayout","onSelectionChange","onSubmitEditing","selection","selectTextOnFocus","spellCheck","accessibilityViewIsModal","allowFontScaling","caretHidden","clearButtonMode","dataDetectorTypes","disableFullscreenUI","enablesReturnKeyAutomatically","hitSlop","inlineImageLeft","inlineImagePadding","inputAccessoryViewID","keyboardAppearance","maxFontSizeMultiplier","needsOffscreenAlphaCompositing","onAccessibilityTap","onContentSizeChange","onEndEditing","onMagicTap","onScroll","removeClippedSubviews","renderToHardwareTextureAndroid","returnKeyLabel","returnKeyType","scrollEnabled","selectionColor","selectionState","shouldRasterizeIOS","textBreakStrategy","textContentType","underlineColorAndroid"]));switch(a){case"email-address":e="email";break;case"number-pad":case"numeric":e="number";break;case"phone-pad":e="tel";break;case"search":case"web-search":e="search";break;case"url":e="url";break;default:e="text"}l&&(e="password");var c=i?"textarea":"input";return Object.assign(u,{autoComplete:"off"===n?"noop":n,autoCorrect:o?"on":"off",classList:[classes.textinput],dir:"auto",onBlur:normalizeEventHandler(this._handleBlur),onChange:normalizeEventHandler(this._handleChange),onFocus:normalizeEventHandler(this._handleFocus),onKeyDown:this._handleKeyDown,onKeyPress:this._handleKeyPress,onSelect:normalizeEventHandler(this._handleSelectionChange),readOnly:!r,ref:this._setNode,spellCheck:null!=s?s:o}),i?u.rows=p:u.type=e,(0,_createElement.default)(c,u)},e}(_react.Component);TextInput.displayName="TextInput",TextInput.defaultProps={autoCapitalize:"sentences",autoComplete:"on",autoCorrect:!0,editable:!0,keyboardType:"default",multiline:!1,numberOfLines:1,secureTextEntry:!1},TextInput.State=_TextInputState.default,TextInput.propTypes="production"!==process.env.NODE_ENV?_objectSpread({},_ViewPropTypes.default,{autoCapitalize:(0,_propTypes.oneOf)(["characters","none","sentences","words"]),autoComplete:_propTypes.string,autoCorrect:_propTypes.bool,autoFocus:_propTypes.bool,blurOnSubmit:_propTypes.bool,clearTextOnFocus:_propTypes.bool,defaultValue:_propTypes.string,editable:_propTypes.bool,inputAccessoryViewID:_propTypes.string,keyboardType:(0,_propTypes.oneOf)(["default","email-address","number-pad","numbers-and-punctuation","numeric","phone-pad","search","url","web-search"]),maxFontSizeMultiplier:_propTypes.number,maxLength:_propTypes.number,multiline:_propTypes.bool,numberOfLines:_propTypes.number,onBlur:_propTypes.func,onChange:_propTypes.func,onChangeText:_propTypes.func,onFocus:_propTypes.func,onKeyPress:_propTypes.func,onSelectionChange:_propTypes.func,onSubmitEditing:_propTypes.func,placeholder:_propTypes.string,placeholderTextColor:_ColorPropType.default,secureTextEntry:_propTypes.bool,selectTextOnFocus:_propTypes.bool,selection:(0,_propTypes.shape)({start:_propTypes.number.isRequired,end:_propTypes.number}),spellCheck:_propTypes.bool,style:(0,_StyleSheetPropType.default)(_TextInputStylePropTypes.default),value:_propTypes.string,caretHidden:_propTypes.bool,clearButtonMode:_propTypes.string,dataDetectorTypes:_propTypes.string,disableFullscreenUI:_propTypes.bool,enablesReturnKeyAutomatically:_propTypes.bool,keyboardAppearance:_propTypes.string,inlineImageLeft:_propTypes.string,inlineImagePadding:_propTypes.number,onContentSizeChange:_propTypes.func,onEndEditing:_propTypes.func,onScroll:_propTypes.func,returnKeyLabel:_propTypes.string,returnKeyType:_propTypes.string,selectionColor:_ColorPropType.default,selectionState:_propTypes.any,textBreakStrategy:_propTypes.string,underlineColorAndroid:_ColorPropType.default}):{};var classes=_css.default.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",padding:0,resize:"none"}}),_default=(0,_applyLayout.default)((0,_applyNativeMethods.default)(TextInput));exports.default=_default,module.exports=exports.default;