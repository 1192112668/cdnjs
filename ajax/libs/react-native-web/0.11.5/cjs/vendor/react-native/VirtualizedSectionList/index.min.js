"use strict";exports.__esModule=!0,exports.default=void 0;var _react=_interopRequireDefault(require("react")),_View=_interopRequireDefault(require("../../../exports/View")),_VirtualizedList=_interopRequireDefault(require("../VirtualizedList")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var VirtualizedSectionList=function(r){_inheritsLoose(t,r);var e=t.prototype;function t(e,t){var c=r.call(this,e,t)||this;return c._keyExtractor=function(e,t){var r=c._subExtractor(t);return r&&r.key||String(t)},c._convertViewable=function(e){(0,_invariant.default)(null!=e.index,"Received a broken ViewToken");var t=c._subExtractor(e.index);if(!t)return null;var r=t.section.keyExtractor||c.props.keyExtractor;return _objectSpread({},e,{index:t.index,key:r(e.item,t.index),section:t.section})},c._onViewableItemsChanged=function(e){var t=e.viewableItems,r=e.changed;c.props.onViewableItemsChanged&&c.props.onViewableItemsChanged({viewableItems:t.map(c._convertViewable,_assertThisInitialized(_assertThisInitialized(c))).filter(Boolean),changed:r.map(c._convertViewable,_assertThisInitialized(_assertThisInitialized(c))).filter(Boolean)})},c._renderItem=function(e){var t=e.item,r=e.index,n=c._subExtractor(r);if(!n)return null;var i=n.index;if(null==i){var a=n.section;if(!0===n.header){var o=c.props.renderSectionHeader;return o?o({section:a}):null}var s=c.props.renderSectionFooter;return s?s({section:a}):null}var l=n.section.renderItem||c.props.renderItem,p=c._getSeparatorComponent(r,n);return(0,_invariant.default)(l,"no renderItem!"),_react.default.createElement(ItemWithSeparator,{SeparatorComponent:p,LeadingSeparatorComponent:0===i?c.props.SectionSeparatorComponent:void 0,cellKey:n.key,index:i,item:t,leadingItem:n.leadingItem,leadingSection:n.leadingSection,onUpdateSeparator:c._onUpdateSeparator,prevCellKey:(c._subExtractor(r-1)||{}).key,ref:function(e){c._cellRefs[n.key]=e},renderItem:l,section:n.section,trailingItem:n.trailingItem,trailingSection:n.trailingSection})},c._onUpdateSeparator=function(e,t){var r=c._cellRefs[e];r&&r.updateSeparatorProps(t)},c._cellRefs={},c._captureRef=function(e){c._listRef=e},c.state=c._computeState(e),c}return e.scrollToLocation=function(e){for(var t=e.itemIndex+1,r=0;r<e.sectionIndex;r++)t+=this.props.sections[r].data.length+2;var n=_objectSpread({},e,{index:t});this._listRef.scrollToIndex(n)},e.getListRef=function(){return this._listRef},e._subExtractor=function(e){for(var t=e,r=this.props.keyExtractor,n=0;n<this.props.sections.length;n++){var i=this.props.sections[n],a=i.key||String(n);if(--t>=i.data.length+1)t-=i.data.length+1;else return-1===t?{section:i,key:a+":header",index:null,header:!0,trailingSection:this.props.sections[n+1]}:t===i.data.length?{section:i,key:a+":footer",index:null,header:!1,trailingSection:this.props.sections[n+1]}:{section:i,key:a+":"+(i.keyExtractor||r)(i.data[t],t),index:t,leadingItem:i.data[t-1],leadingSection:this.props.sections[n-1],trailingItem:i.data[t+1],trailingSection:this.props.sections[n+1]}}},e._getSeparatorComponent=function(e,t){if(!(t=t||this._subExtractor(e)))return null;var r=t.section.ItemSeparatorComponent||this.props.ItemSeparatorComponent,n=this.props.SectionSeparatorComponent,i=e===this.state.childProps.getItemCount()-1,a=t.index===t.section.data.length-1;return n&&a?n:!r||a||i?null:r},e._computeState=function(e){var r=e.ListHeaderComponent?1:0,n=[],t=e.sections.reduce(function(e,t){return n.push(e+r),e+t.data.length+2},0);return{childProps:_objectSpread({},e,{renderItem:this._renderItem,ItemSeparatorComponent:void 0,data:e.sections,getItemCount:function(){return t},getItem:getItem,keyExtractor:this._keyExtractor,onViewableItemsChanged:e.onViewableItemsChanged?this._onViewableItemsChanged:void 0,stickyHeaderIndices:e.stickySectionHeadersEnabled?n:void 0})}},e.UNSAFE_componentWillReceiveProps=function(e){this.setState(this._computeState(e))},e.render=function(){return _react.default.createElement(_VirtualizedList.default,_extends({},this.state.childProps,{ref:this._captureRef}))},t}(_react.default.PureComponent);VirtualizedSectionList.defaultProps=_objectSpread({},_VirtualizedList.default.defaultProps,{data:[]});var ItemWithSeparator=function(n){function e(){for(var o,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(o=n.call.apply(n,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:o.props.item,leadingSection:o.props.leadingSection,section:o.props.section,trailingItem:o.props.trailingItem,trailingSection:o.props.trailingSection},leadingSeparatorProps:{highlighted:!1,leadingItem:o.props.leadingItem,leadingSection:o.props.leadingSection,section:o.props.section,trailingItem:o.props.item,trailingSection:o.props.trailingSection}},o._separators={highlight:function(){["leading","trailing"].forEach(function(e){return o._separators.updateProps(e,{highlighted:!0})})},unhighlight:function(){["leading","trailing"].forEach(function(e){return o._separators.updateProps(e,{highlighted:!1})})},updateProps:function(e,t){var r=o.props,n=r.LeadingSeparatorComponent,i=r.cellKey,a=r.prevCellKey;"leading"===e&&n?o.setState(function(e){return{leadingSeparatorProps:_objectSpread({},e.leadingSeparatorProps,t)}}):o.props.onUpdateSeparator("leading"===e&&a||i,t)}},o}_inheritsLoose(e,n);var t=e.prototype;return t.UNSAFE_componentWillReceiveProps=function(t){var r=this;this.setState(function(e){return{separatorProps:_objectSpread({},r.state.separatorProps,{leadingItem:t.item,leadingSection:t.leadingSection,section:t.section,trailingItem:t.trailingItem,trailingSection:t.trailingSection}),leadingSeparatorProps:_objectSpread({},r.state.leadingSeparatorProps,{leadingItem:t.leadingItem,leadingSection:t.leadingSection,section:t.section,trailingItem:t.item,trailingSection:t.trailingSection})}})},t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,t)}})},t.render=function(){var e=this.props,t=e.LeadingSeparatorComponent,r=e.SeparatorComponent,n=e.item,i=e.index,a=e.section,o=this.props.renderItem({item:n,index:i,section:a,separators:this._separators}),s=t&&_react.default.createElement(t,this.state.leadingSeparatorProps),l=r&&_react.default.createElement(r,this.state.separatorProps);return s||l?_react.default.createElement(_View.default,null,s,o,l):o},e}(_react.default.Component);function getItem(e,t){if(!e)return null;for(var r=t-1,n=0;n<e.length;n++){if(-1===r||r===e[n].data.length)return e[n];if(r<e[n].data.length)return e[n].data[r];r-=e[n].data.length+2}return null}var _default=VirtualizedSectionList;exports.default=VirtualizedSectionList,module.exports=exports.default;