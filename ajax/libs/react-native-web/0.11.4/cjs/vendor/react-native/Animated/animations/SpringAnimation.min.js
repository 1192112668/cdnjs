"use strict";exports.__esModule=!0,exports.default=void 0;var _AnimatedValue=_interopRequireDefault(require("../nodes/AnimatedValue")),_AnimatedValueXY=_interopRequireDefault(require("../nodes/AnimatedValueXY")),_Animation2=_interopRequireDefault(require("./Animation")),_SpringConfig=_interopRequireDefault(require("../SpringConfig")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_NativeAnimatedHelper=require("../NativeAnimatedHelper");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _inheritsLoose(t,i){t.prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i}function withDefault(t,i){return null==t?i:t}var SpringAnimation=function(a){function l(t){var i,e,s=a.call(this)||this;return s._overshootClamping=withDefault(t.overshootClamping,!1),s._restDisplacementThreshold=withDefault(t.restDisplacementThreshold,.001),s._restSpeedThreshold=withDefault(t.restSpeedThreshold,.001),s._initialVelocity=withDefault(t.velocity,0),s._lastVelocity=withDefault(t.velocity,0),s._toValue=t.toValue,s._delay=withDefault(t.delay,0),s._useNativeDriver=(0,_NativeAnimatedHelper.shouldUseNativeDriver)(t),s.__isInteraction=void 0===t.isInteraction||t.isInteraction,s.__iterations=void 0!==t.iterations?t.iterations:1,void 0!==t.stiffness||void 0!==t.damping||void 0!==t.mass?((0,_invariant.default)(void 0===t.bounciness&&void 0===t.speed&&void 0===t.tension&&void 0===t.friction,"You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one"),s._stiffness=withDefault(t.stiffness,100),s._damping=withDefault(t.damping,10),s._mass=withDefault(t.mass,1)):(void 0!==t.bounciness||void 0!==t.speed?((0,_invariant.default)(void 0===t.tension&&void 0===t.friction&&void 0===t.stiffness&&void 0===t.damping&&void 0===t.mass,"You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one"),i=_SpringConfig.default.fromBouncinessAndSpeed(withDefault(t.bounciness,8),withDefault(t.speed,12)),s._stiffness=i.stiffness,s._damping=i.damping):(e=_SpringConfig.default.fromOrigamiTensionAndFriction(withDefault(t.tension,40),withDefault(t.friction,7)),s._stiffness=e.stiffness,s._damping=e.damping),s._mass=1),(0,_invariant.default)(0<s._stiffness,"Stiffness value must be greater than 0"),(0,_invariant.default)(0<s._damping,"Damping value must be greater than 0"),(0,_invariant.default)(0<s._mass,"Mass value must be greater than 0"),s}_inheritsLoose(l,a);var t=l.prototype;return t.__getNativeAnimationConfig=function(){return{type:"spring",overshootClamping:this._overshootClamping,restDisplacementThreshold:this._restDisplacementThreshold,restSpeedThreshold:this._restSpeedThreshold,stiffness:this._stiffness,damping:this._damping,mass:this._mass,initialVelocity:withDefault(this._initialVelocity,this._lastVelocity),toValue:this._toValue,iterations:this.__iterations}},t.start=function(t,i,e,s,a){var n,o=this;this.__active=!0,this._startPosition=t,this._lastPosition=this._startPosition,this._onUpdate=i,this.__onEnd=e,this._lastTime=Date.now(),this._frameTime=0,s instanceof l&&(n=s.getInternalState(),this._lastPosition=n.lastPosition,this._lastVelocity=n.lastVelocity,this._initialVelocity=this._lastVelocity,this._lastTime=n.lastTime);function r(){o._useNativeDriver?o.__startNativeAnimation(a):o.onUpdate()}this._delay?this._timeout=setTimeout(r,this._delay):r()},t.getInternalState=function(){return{lastPosition:this._lastPosition,lastVelocity:this._lastVelocity,lastTime:this._lastTime}},t.onUpdate=function(){var t=Date.now();t>this._lastTime+64&&(t=this._lastTime+64);var i=(t-this._lastTime)/1e3;this._frameTime+=i;var e,s,a=this._damping,n=this._mass,o=this._stiffness,r=-this._initialVelocity,l=a/(2*Math.sqrt(o*n)),h=Math.sqrt(o/n),_=h*Math.sqrt(1-l*l),u=this._toValue-this._startPosition,f=0,d=0,m=this._frameTime;if(d=l<1?(e=Math.exp(-l*h*m),f=this._toValue-e*((r+l*h*u)/_*Math.sin(_*m)+u*Math.cos(_*m)),l*h*e*(Math.sin(_*m)*(r+l*h*u)/_+u*Math.cos(_*m))-e*(Math.cos(_*m)*(r+l*h*u)-_*u*Math.sin(_*m))):(s=Math.exp(-h*m),f=this._toValue-s*(u+(r+h*u)*m),s*(r*(m*h-1)+m*u*(h*h))),this._lastTime=t,this._lastPosition=f,this._lastVelocity=d,this._onUpdate(f),this.__active){var p=!1;this._overshootClamping&&0!==this._stiffness&&(p=this._startPosition<this._toValue?f>this._toValue:f<this._toValue);var c=Math.abs(d)<=this._restSpeedThreshold,v=!0;if(0!==this._stiffness&&(v=Math.abs(this._toValue-f)<=this._restDisplacementThreshold),p||c&&v)return 0!==this._stiffness&&(this._lastPosition=this._toValue,this._lastVelocity=0,this._onUpdate(this._toValue)),void this.__debouncedOnEnd({finished:!0});this._animationFrame=requestAnimationFrame(this.onUpdate.bind(this))}},t.stop=function(){a.prototype.stop.call(this),this.__active=!1,clearTimeout(this._timeout),global.cancelAnimationFrame(this._animationFrame),this.__debouncedOnEnd({finished:!1})},l}(_Animation2.default),_default=SpringAnimation;exports.default=SpringAnimation,module.exports=exports.default;