"use strict";exports.__esModule=!0,exports.default=void 0;var _Batchinator=_interopRequireDefault(require("../Batchinator")),_FillRateHelper=_interopRequireDefault(require("../FillRateHelper")),_propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_RefreshControl=_interopRequireDefault(require("../../../exports/RefreshControl")),_ScrollView=_interopRequireDefault(require("../../../exports/ScrollView")),_StyleSheet=_interopRequireDefault(require("../../../exports/StyleSheet")),_UIManager=_interopRequireDefault(require("../../../exports/UIManager")),_View=_interopRequireDefault(require("../../../exports/View")),_ViewabilityHelper=_interopRequireDefault(require("../ViewabilityHelper")),_VirtualizeUtils=require("../VirtualizeUtils"),_findNodeHandle=_interopRequireDefault(require("../../../exports/findNodeHandle")),_infoLog=_interopRequireDefault(require("../infoLog")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_warning=_interopRequireDefault(require("fbjs/lib/warning"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var flattenStyle=_StyleSheet.default.flatten,__DEV__="production"!==process.env.NODE_ENV,_usedIndexForKey=!1,VirtualizedList=function(s){_inheritsLoose(t,s);var e=t.prototype;function t(e,t){var S=s.call(this,e,t)||this;S._getScrollMetrics=function(){return S._scrollMetrics},S._getOutermostParentListRef=function(){return S._isNestedWithSameOrientation()?S.context.virtualizedList.getOutermostParentListRef():_assertThisInitialized(_assertThisInitialized(S))},S._getNestedChildState=function(e){var t=S._nestedChildLists.get(e);return t&&t.state},S._registerAsNestedChild=function(e){var t=S._cellKeysToChildListKeys.get(e.cellKey)||new Set;t.add(e.key),S._cellKeysToChildListKeys.set(e.cellKey,t);var r=S._nestedChildLists.get(e.key);(0,_invariant.default)(!(r&&null!==r.ref),"A VirtualizedList contains a cell which itself contains more than one VirtualizedList of the same orientation as the parent list. You must pass a unique listKey prop to each sibling list."),S._nestedChildLists.set(e.key,{ref:e.ref,state:null}),S._hasInteracted&&e.ref.recordInteraction()},S._unregisterAsNestedChild=function(e){S._nestedChildLists.set(e.key,{ref:null,state:e.state})},S._onUpdateSeparators=function(e,r){e.forEach(function(e){var t=null!=e&&S._cellRefs[e];t&&t.updateSeparatorProps(r)})},S._averageCellLength=0,S._cellKeysToChildListKeys=new Map,S._cellRefs={},S._frames={},S._footerLength=0,S._hasDataChangedSinceEndReached=!0,S._hasInteracted=!1,S._hasMore=!1,S._hasWarned={},S._highestMeasuredFrameIndex=0,S._headerLength=0,S._indicesToKeys=new Map,S._hasDoneInitialScroll=!1,S._nestedChildLists=new Map,S._offsetFromParentVirtualizedList=0,S._prevParentOffset=0,S._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0},S._scrollRef=null,S._sentEndForContentLength=0,S._totalCellLength=0,S._totalCellsMeasured=0,S._viewabilityTuples=[],S._captureScrollRef=function(e){S._scrollRef=e},S._defaultRenderScrollComponent=function(e){return S._isNestedWithSameOrientation()?_react.default.createElement(_View.default,e):e.onRefresh?((0,_invariant.default)("boolean"==typeof e.refreshing,"`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify(e.refreshing)+"`"),_react.default.createElement(_ScrollView.default,_extends({},e,{refreshControl:_react.default.createElement(_RefreshControl.default,{refreshing:e.refreshing,onRefresh:e.onRefresh,progressViewOffset:e.progressViewOffset})}))):_react.default.createElement(_ScrollView.default,e)},S._onCellUnmount=function(e){var t=S._frames[e];t&&(S._frames[e]=_objectSpread({},t,{inLayout:!1}))},S._onLayout=function(e){S._isNestedWithSameOrientation()?S._measureLayoutRelativeToContainingList():S._scrollMetrics.visibleLength=S._selectLength(e.nativeEvent.layout),S.props.onLayout&&S.props.onLayout(e),S._scheduleCellsToRenderUpdate(),S._maybeCallOnEndReached()},S._onLayoutEmpty=function(e){S.props.onLayout&&S.props.onLayout(e)},S._onLayoutFooter=function(e){S._footerLength=S._selectLength(e.nativeEvent.layout)},S._onLayoutHeader=function(e){S._headerLength=S._selectLength(e.nativeEvent.layout)},S._onContentSizeChange=function(e,t){0<e&&0<t&&null!=S.props.initialScrollIndex&&0<S.props.initialScrollIndex&&!S._hasDoneInitialScroll&&(S.scrollToIndex({animated:!1,index:S.props.initialScrollIndex}),S._hasDoneInitialScroll=!0),S.props.onContentSizeChange&&S.props.onContentSizeChange(e,t),S._scrollMetrics.contentLength=S._selectLength({height:t,width:e}),S._scheduleCellsToRenderUpdate(),S._maybeCallOnEndReached()},S._convertParentScrollMetrics=function(e){var t=e.offset-S._offsetFromParentVirtualizedList,r=e.visibleLength,i=t-S._scrollMetrics.offset;return{visibleLength:r,contentLength:S._scrollMetrics.contentLength,offset:t,dOffset:i}},S._onScroll=function(t){S._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScroll(t)}),S.props.onScroll&&S.props.onScroll(t);var e=t.timeStamp,r=S._selectLength(t.nativeEvent.layoutMeasurement),i=S._selectLength(t.nativeEvent.contentSize),s=(o=S._selectOffset(t.nativeEvent.contentOffset))-S._scrollMetrics.offset;if(S._isNestedWithSameOrientation()){if(0===S._scrollMetrics.contentLength)return;var n=S._convertParentScrollMetrics({visibleLength:r,offset:o}),r=n.visibleLength,i=n.contentLength,o=n.offset,s=n.dOffset}var a=S._scrollMetrics.timestamp?Math.max(1,e-S._scrollMetrics.timestamp):1,l=s/a;500<a&&500<S._scrollMetrics.dt&&5*r<i&&!S._hasWarned.perf&&((0,_infoLog.default)("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:a,prevDt:S._scrollMetrics.dt,contentLength:i}),S._hasWarned.perf=!0),S._scrollMetrics={contentLength:i,dt:a,dOffset:s,offset:o,timestamp:e,velocity:l,visibleLength:r},S._updateViewableItems(S.props.data),S.props&&(S._maybeCallOnEndReached(),0!=l&&S._fillRateHelper.activate(),S._computeBlankness(),S._scheduleCellsToRenderUpdate())},S._onScrollBeginDrag=function(t){S._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScrollBeginDrag(t)}),S._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),S._hasInteracted=!0,S.props.onScrollBeginDrag&&S.props.onScrollBeginDrag(t)},S._onScrollEndDrag=function(e){var t=e.nativeEvent.velocity;t&&(S._scrollMetrics.velocity=S._selectOffset(t)),S._computeBlankness(),S.props.onScrollEndDrag&&S.props.onScrollEndDrag(e)},S._onMomentumScrollEnd=function(e){S._scrollMetrics.velocity=0,S._computeBlankness(),S.props.onMomentumScrollEnd&&S.props.onMomentumScrollEnd(e)},S._updateCellsToRender=function(){var e=S.props,y=e.data,v=e.getItemCount,C=e.onEndReachedThreshold,L=S._isVirtualizationDisabled();S._updateViewableItems(y),y&&S.setState(function(e){var t,r,i,s,n,o;if(L?(r=(t=S._scrollMetrics).contentLength,i=t.offset,n=r-(s=t.visibleLength)-i<C*s?S.props.maxToRenderPerBatch:0,o={first:0,last:Math.min(e.last+n,v(y)-1)}):S._scrollMetrics.visibleLength&&(S.props.initialScrollIndex&&!S._scrollMetrics.offset||(o=(0,_VirtualizeUtils.computeWindowedRenderLimits)(S.props,e,S._getFrameMetricsApprox,S._scrollMetrics))),o&&0<S._nestedChildLists.size)for(var a=o.first,l=o.last,c=a;c<=l;c++){var d=S._indicesToKeys.get(c),p=d&&S._cellKeysToChildListKeys.get(d);if(p){for(var u,h=!1,f=p,_=Array.isArray(f),g=0,f=_?f:f[Symbol.iterator]();;){if(_){if(g>=f.length)break;u=f[g++]}else{if((g=f.next()).done)break;u=g.value}var m=S._nestedChildLists.get(u);if(m&&m.ref&&m.ref.hasMore()){h=!0;break}}if(h){o.last=c;break}}}return o})},S._createViewToken=function(e,t){var r=S.props,i=r.data,s=r.getItem,n=r.keyExtractor,o=s(i,e);return{index:e,item:o,key:n(o,e),isViewable:t}},S._getFrameMetricsApprox=function(e){var t=S._getFrameMetrics(e);if(t&&t.index===e)return t;var r=S.props.getItemLayout;return(0,_invariant.default)(!r,"Should not have to estimate frames when a measurement metrics function is provided"),{length:S._averageCellLength,offset:S._averageCellLength*e}},S._getFrameMetrics=function(e){var t=S.props,r=t.data,i=t.getItem,s=t.getItemCount,n=t.getItemLayout,o=t.keyExtractor;(0,_invariant.default)(s(r)>e,"Tried to get frame for out of range index "+e);var a,l=i(r,e),c=l&&S._frames[o(l,e)];return c&&c.index===e||n&&(c=n(r,e),__DEV__&&(a=_propTypes.default.shape({length:_propTypes.default.number.isRequired,offset:_propTypes.default.number.isRequired,index:_propTypes.default.number.isRequired}).isRequired,_propTypes.default.checkPropTypes({frame:a},{frame:c},"frame","VirtualizedList.getItemLayout"))),c},(0,_invariant.default)(!e.onScroll||!e.onScroll.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),(0,_invariant.default)(0<e.windowSize,"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),S._fillRateHelper=new _FillRateHelper.default(S._getFrameMetrics),S._updateCellsToRenderBatcher=new _Batchinator.default(S._updateCellsToRender,S.props.updateCellsBatchingPeriod),S.props.viewabilityConfigCallbackPairs?S._viewabilityTuples=S.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityHelper:new _ViewabilityHelper.default(e.viewabilityConfig),onViewableItemsChanged:e.onViewableItemsChanged}}):S.props.onViewableItemsChanged&&S._viewabilityTuples.push({viewabilityHelper:new _ViewabilityHelper.default(S.props.viewabilityConfig),onViewableItemsChanged:S.props.onViewableItemsChanged});var r,i={first:S.props.initialScrollIndex||0,last:Math.min(S.props.getItemCount(S.props.data),(S.props.initialScrollIndex||0)+S.props.initialNumToRender)-1};return!S._isNestedWithSameOrientation()||(r=S.context.virtualizedList.getNestedChildState(S.props.listKey||S._getCellKey()))&&(i=r,S.state=r,S._frames=r.frames),S.state=i,S}return e.scrollToEnd=function(e){var t=!e||e.animated,r=this.props.getItemCount(this.props.data)-1,i=this._getFrameMetricsApprox(r),s=Math.max(0,i.offset+i.length+this._footerLength-this._scrollMetrics.visibleLength);this._scrollRef.scrollTo(this.props.horizontal?{x:s,animated:t}:{y:s,animated:t})},e.scrollToIndex=function(e){var t=this.props,r=t.data,i=t.horizontal,s=t.getItemCount,n=t.getItemLayout,o=t.onScrollToIndexFailed,a=e.animated,l=e.index,c=e.viewOffset,d=e.viewPosition;if((0,_invariant.default)(0<=l&&l<s(r),"scrollToIndex out of range: "+l+" vs "+(s(r)-1)),!n&&l>this._highestMeasuredFrameIndex)return(0,_invariant.default)(!!o,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),void o({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:l});var p=this._getFrameMetricsApprox(l),u=Math.max(0,p.offset-(d||0)*(this._scrollMetrics.visibleLength-p.length))-(c||0);this._scrollRef.scrollTo(i?{x:u,animated:a}:{y:u,animated:a})},e.scrollToItem=function(e){for(var t=e.item,r=this.props,i=r.data,s=r.getItem,n=(0,r.getItemCount)(i),o=0;o<n;o++)if(s(i,o)===t){this.scrollToIndex(_objectSpread({},e,{index:o}));break}},e.scrollToOffset=function(e){var t=e.animated,r=e.offset;this._scrollRef.scrollTo(this.props.horizontal?{x:r,animated:t}:{y:r,animated:t})},e.recordInteraction=function(){this._nestedChildLists.forEach(function(e){e.ref&&e.ref.recordInteraction()}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props.data)},e.flashScrollIndicators=function(){this._scrollRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()},e.getScrollableNode=function(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():(0,_findNodeHandle.default)(this._scrollRef)},e.setNativeProps=function(e){this._scrollRef&&this._scrollRef.setNativeProps(e)},e.getChildContext=function(){return{virtualizedList:{getScrollMetrics:this._getScrollMetrics,horizontal:this.props.horizontal,getOutermostParentListRef:this._getOutermostParentListRef,getNestedChildState:this._getNestedChildState,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild}}},e._getCellKey=function(){return this.context.virtualizedCell&&this.context.virtualizedCell.cellKey||"rootList"},e.hasMore=function(){return this._hasMore},e.componentDidMount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.registerAsNestedChild({cellKey:this._getCellKey(),key:this.props.listKey||this._getCellKey(),ref:this})},e.componentWillUnmount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.unregisterAsNestedChild({key:this.props.listKey||this._getCellKey(),state:{first:this.state.first,last:this.state.last,frames:this._frames}}),this._updateViewableItems(null),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush()},t.getDerivedStateFromProps=function(e,t){var r=e.data,i=(e.extraData,e.getItemCount),s=e.maxToRenderPerBatch;return{first:Math.max(0,Math.min(t.first,i(r)-1-s)),last:Math.max(0,Math.min(t.last,i(r)-1))}},e._pushCells=function(i,s,n,e,t,o){var a,l=this,r=this.props,c=r.CellRendererComponent,d=r.ItemSeparatorComponent,p=r.data,u=r.getItem,h=r.getItemCount,f=r.horizontal,_=r.keyExtractor,g=this.props.ListHeaderComponent?1:0,m=h(p)-1;t=Math.min(m,t);for(var y=function(t){var e=u(p,t),r=_(e,t);l._indicesToKeys.set(t,r),n.has(t+g)&&s.push(i.length),i.push(_react.default.createElement(CellRenderer,{CellRendererComponent:c,ItemSeparatorComponent:t<m?d:void 0,cellKey:r,fillRateHelper:l._fillRateHelper,horizontal:f,index:t,inversionStyle:o,item:e,key:r,prevCellKey:a,onUpdateSeparators:l._onUpdateSeparators,onLayout:function(e){return l._onCellLayout(e,r,t)},onUnmount:l._onCellUnmount,parentProps:l.props,ref:function(e){l._cellRefs[r]=e}})),a=r},v=e;v<=t;v++)y(v)},e._isVirtualizationDisabled=function(){return this.props.disableVirtualization},e._isNestedWithSameOrientation=function(){var e=this.context.virtualizedList;return!(!e||!!e.horizontal!=!!this.props.horizontal)},e.render=function(){var e;__DEV__&&(e=flattenStyle(this.props.contentContainerStyle),(0,_warning.default)(null==e||"wrap"!==e.flexWrap,"`flexWrap: `wrap`` is not supported with the `VirtualizedList` components.Consider using `numColumns` with `FlatList` instead."));var t,r=this.props,i=r.ListEmptyComponent,s=r.ListFooterComponent,n=r.ListHeaderComponent,o=this.props,a=o.data,l=o.horizontal,c=this._isVirtualizationDisabled(),d=this.props.inverted?this.props.horizontal?styles.horizontallyInverted:styles.verticallyInverted:null,p=[],u=new Set(this.props.stickyHeaderIndices),h=[];n&&(u.has(0)&&h.push(0),t=_react.default.isValidElement(n)?n:_react.default.createElement(n,null),p.push(_react.default.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-header",key:"$header"},_react.default.createElement(_View.default,{onLayout:this._onLayoutHeader,style:d},t))));var f,_,g=this.props.getItemCount(a);if(0<g){_usedIndexForKey=!1;var m=l?"width":"height",y=this.props.initialScrollIndex?-1:this.props.initialNumToRender-1,v=this.state,C=v.first,L=v.last;this._pushCells(p,h,u,0,y,d);var S,b,w,x,R,M=Math.max(1+y,C);if(!c&&1+y<C){var I,E,T,z=!1;if(0<u.size)for(var V=n?1:0,k=M-1;y<k;k--)if(u.has(k+V)){var D,O,F=this._getFrameMetricsApprox(y),K=this._getFrameMetricsApprox(k),N=K.offset-(F.offset+F.length);p.push(_react.default.createElement(_View.default,{key:"$sticky_lead",style:((D={})[m]=N,D)})),this._pushCells(p,h,u,k,k,d);var P=this._getFrameMetricsApprox(C).offset-(K.offset+K.length);p.push(_react.default.createElement(_View.default,{key:"$sticky_trail",style:((O={})[m]=P,O)})),z=!0;break}z||(E=this._getFrameMetricsApprox(y),T=this._getFrameMetricsApprox(C).offset-(E.offset+E.length),p.push(_react.default.createElement(_View.default,{key:"$lead_spacer",style:((I={})[m]=T,I)})))}this._pushCells(p,h,u,M,L,d),!this._hasWarned.keys&&_usedIndexForKey&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key property on each item or provide a custom keyExtractor."),this._hasWarned.keys=!0),!c&&L<g-1&&(b=this._getFrameMetricsApprox(L),w=this.props.getItemLayout?g-1:Math.min(g-1,this._highestMeasuredFrameIndex),R=(x=this._getFrameMetricsApprox(w)).offset+x.length-(b.offset+b.length),p.push(_react.default.createElement(_View.default,{key:"$tail_spacer",style:((S={})[m]=R,S)})))}else{i&&(f=_react.default.isValidElement(i)?i:_react.default.createElement(i,null),p.push(_react.default.createElement(_View.default,{key:"$empty",onLayout:this._onLayoutEmpty,style:d},f)))}s&&(_=_react.default.isValidElement(s)?s:_react.default.createElement(s,null),p.push(_react.default.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-footer",key:"$footer"},_react.default.createElement(_View.default,{onLayout:this._onLayoutFooter,style:d},_))));var q=_objectSpread({},this.props,{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:this.props.scrollEventThrottle,invertStickyHeaders:void 0!==this.props.invertStickyHeaders?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:h});d&&(q.style=[d,this.props.style]),this._hasMore=this.state.last<this.props.getItemCount(this.props.data)-1;var A=_react.default.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)(q),{ref:this._captureScrollRef},p);return this.props.debug?_react.default.createElement(_View.default,{style:{flex:1}},A,this._renderDebugOverlay()):A},e.componentDidUpdate=function(e){var t=this.props,r=t.data,i=t.extraData;r===e.data&&i===e.extraData||(this._hasDataChangedSinceEndReached=!0,this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.resetViewableIndices()})),this._scheduleCellsToRenderUpdate()},e._computeBlankness=function(){this._fillRateHelper.computeBlankness(this.props,this.state,this._scrollMetrics)},e._onCellLayout=function(e,t,r){var i=e.nativeEvent.layout,s={offset:this._selectOffset(i),length:this._selectLength(i),index:r,inLayout:!0},n=this._frames[t];n&&s.offset===n.offset&&s.length===n.length&&r===n.index?this._frames[t].inLayout=!0:(this._totalCellLength+=s.length-(n?n.length:0),this._totalCellsMeasured+=n?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[t]=s,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,r),this._scheduleCellsToRenderUpdate()),this._computeBlankness()},e._measureLayoutRelativeToContainingList=function(){var n=this;_UIManager.default.measureLayout((0,_findNodeHandle.default)(this),(0,_findNodeHandle.default)(this.context.virtualizedList.getOutermostParentListRef()),function(e){console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")},function(e,t,r,i){n._offsetFromParentVirtualizedList=n._selectOffset({x:e,y:t}),n._scrollMetrics.contentLength=n._selectLength({width:r,height:i});var s=n._convertParentScrollMetrics(n.context.virtualizedList.getScrollMetrics());n._scrollMetrics.visibleLength=s.visibleLength,n._scrollMetrics.offset=s.offset})},e._renderDebugOverlay=function(){for(var r=this._scrollMetrics.visibleLength/this._scrollMetrics.contentLength,e=[],t=this.props.getItemCount(this.props.data),i=0;i<t;i++){var s=this._getFrameMetricsApprox(i);s.inLayout&&e.push(s)}var n=this._getFrameMetricsApprox(this.state.first).offset,o=this._getFrameMetricsApprox(this.state.last),a=o.offset+o.length-n,l=this._scrollMetrics.offset,c=this._scrollMetrics.visibleLength,d={position:"absolute",top:0,right:0};return _react.default.createElement(_View.default,{style:_objectSpread({},d,{bottom:0,width:20,borderColor:"blue",borderWidth:1})},e.map(function(e,t){return _react.default.createElement(_View.default,{key:"f"+t,style:_objectSpread({},d,{left:0,top:e.offset*r,height:e.length*r,backgroundColor:"orange"})})}),_react.default.createElement(_View.default,{style:_objectSpread({},d,{left:0,top:n*r,height:a*r,borderColor:"green",borderWidth:2})}),_react.default.createElement(_View.default,{style:_objectSpread({},d,{left:0,top:l*r,height:c*r,borderColor:"red",borderWidth:2})}))},e._selectLength=function(e){return this.props.horizontal?e.width:e.height},e._selectOffset=function(e){return this.props.horizontal?e.x:e.y},e._maybeCallOnEndReached=function(){var e=this.props,t=e.data,r=e.getItemCount,i=e.onEndReached,s=e.onEndReachedThreshold,n=this._scrollMetrics,o=n.contentLength,a=n.visibleLength,l=o-a-n.offset;i&&this.state.last===r(t)-1&&l<s*a&&(this._hasDataChangedSinceEndReached||this._scrollMetrics.contentLength!==this._sentEndForContentLength)&&(this._hasDataChangedSinceEndReached=!1,this._sentEndForContentLength=this._scrollMetrics.contentLength,i({distanceFromEnd:l}))},e._scheduleCellsToRenderUpdate=function(){var e,t,r,i=this.state,s=i.first,n=i.last,o=this._scrollMetrics,a=o.offset,l=o.visibleLength,c=o.velocity,d=this.props.getItemCount(this.props.data),p=!1;if((0<s||n<d-1)&&(e=a-this._getFrameMetricsApprox(s).offset,t=this._getFrameMetricsApprox(n).offset-(a+l),r=this.props.onEndReachedThreshold*l/2,p=Math.min(e,t)<0||c<-2&&e<r||2<c&&t<r),p&&this._averageCellLength)return this._updateCellsToRenderBatcher.dispose({abort:!0}),void this._updateCellsToRender();this._updateCellsToRenderBatcher.schedule()},e._updateViewableItems=function(t){var r=this,i=this.props.getItemCount;this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.onUpdate(i(t),r._scrollMetrics.offset,r._scrollMetrics.visibleLength,r._getFrameMetrics,r._createViewToken,e.onViewableItemsChanged,r.state)})},t}(_react.default.PureComponent);VirtualizedList.defaultProps={disableVirtualization:"test"===process.env.NODE_ENV,horizontal:!1,initialNumToRender:10,keyExtractor:function(e,t){return null!=e.key?e.key:(_usedIndexForKey=!0,String(t))},maxToRenderPerBatch:10,onEndReachedThreshold:2,scrollEventThrottle:50,updateCellsBatchingPeriod:50,windowSize:21},VirtualizedList.contextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string}),virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})},VirtualizedList.childContextTypes={virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})};var CellRenderer=function(i){function e(){for(var n,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(n=i.call.apply(i,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:n.props.item}},n._separators={highlight:function(){var e=n.props,t=e.cellKey,r=e.prevCellKey;n.props.onUpdateSeparators([t,r],{highlighted:!0})},unhighlight:function(){var e=n.props,t=e.cellKey,r=e.prevCellKey;n.props.onUpdateSeparators([t,r],{highlighted:!1})},updateProps:function(e,t){var r=n.props,i=r.cellKey,s=r.prevCellKey;n.props.onUpdateSeparators(["leading"===e?s:i],t)}},n}_inheritsLoose(e,i);var t=e.prototype;return t.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,t)}})},t.componentWillUnmount=function(){this.props.onUnmount(this.props.cellKey)},t.render=function(){var e=this.props,t=e.CellRendererComponent,r=e.ItemSeparatorComponent,i=e.fillRateHelper,s=e.horizontal,n=e.item,o=e.index,a=e.inversionStyle,l=e.parentProps,c=l.renderItem,d=l.getItemLayout;(0,_invariant.default)(c,"no renderItem!");var p=c({item:n,index:o,separators:this._separators}),u=!d||l.debug||i.enabled()?this.props.onLayout:void 0,h=r&&_react.default.createElement(r,this.state.separatorProps),f=a?s?[styles.rowReverse,a]:[styles.columnReverse,a]:s?[styles.row,a]:a;return t?_react.default.createElement(t,_extends({},this.props,{style:f,onLayout:u}),p,h):_react.default.createElement(_View.default,{style:f,onLayout:u},p,h)},e}(_react.default.Component);CellRenderer.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var VirtualizedCellWrapper=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},r.render=function(){return this.props.children},t}(_react.default.Component);VirtualizedCellWrapper.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var styles=_StyleSheet.default.create({verticallyInverted:{transform:[{scaleY:-1}]},horizontallyInverted:{transform:[{scaleX:-1}]},row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"}}),_default=VirtualizedList;exports.default=VirtualizedList,module.exports=exports.default;