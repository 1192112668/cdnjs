"use strict";exports.__esModule=!0,exports.default=void 0;var _ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment"),_debounce=_interopRequireDefault(require("debounce")),_findNodeHandle=_interopRequireDefault(require("../../exports/findNodeHandle"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var resizeObserver,triggerAll,emptyObject={},registry={},id=1,guid=function(){return"r-"+id++};_ExecutionEnvironment.canUseDOM&&(void 0!==window.ResizeObserver?resizeObserver=new window.ResizeObserver(function(e){e.forEach(function(e){var t=e.target,o=registry[t._layoutId];o&&o._handleLayout()})}):("production"!==process.env.NODE_ENV&&"test"!==process.env.NODE_ENV&&console.warn("onLayout relies on ResizeObserver which is not supported by your browser. Please include a polyfill, e.g., https://github.com/que-etc/resize-observer-polyfill. Falling back to window.onresize."),triggerAll=function(){Object.keys(registry).forEach(function(e){registry[e]._handleLayout()})},window.addEventListener("resize",(0,_debounce.default)(triggerAll,16),!1)));var observe=function(e){var t,o=guid();registry[o]=e,resizeObserver?(t=(0,_findNodeHandle.default)(e))&&(t._layoutId=o,resizeObserver.observe(t)):(e._layoutId=o,e._handleLayout())},unobserve=function(e){var t;resizeObserver?(t=(0,_findNodeHandle.default)(e))&&(delete registry[t._layoutId],delete t._layoutId,resizeObserver.unobserve(t)):(delete registry[e._layoutId],delete e._layoutId)},safeOverride=function(e,t){return e?function(){e.call(this,arguments),t.call(this,arguments)}:t},applyLayout=function(e){var t=e.prototype.componentDidMount,o=e.prototype.componentDidUpdate,r=e.prototype.componentWillUnmount;return e.prototype.componentDidMount=safeOverride(t,function(){this._layoutState=emptyObject,this._isMounted=!0,this.props.onLayout&&observe(this)}),e.prototype.componentDidUpdate=safeOverride(o,function(e){this.props.onLayout&&!e.onLayout?observe(this):!this.props.onLayout&&e.onLayout&&unobserve(this)}),e.prototype.componentWillUnmount=safeOverride(r,function(){this._isMounted=!1,this.props.onLayout&&unobserve(this)}),e.prototype._handleLayout=function(){var i=this,u=this._layoutState,s=this.props.onLayout;s&&this.measure(function(e,t,o,r){var n;i._isMounted&&(u.x===e&&u.y===t&&u.width===o&&u.height===r||(i._layoutState={x:e,y:t,width:o,height:r},n={layout:i._layoutState},Object.defineProperty(n,"target",{enumerable:!0,get:function(){return(0,_findNodeHandle.default)(i)}}),s({nativeEvent:n,timeStamp:Date.now()})))})},e},_default=applyLayout;exports.default=applyLayout,module.exports=exports.default;