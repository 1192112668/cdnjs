"use strict";import Animated from"../../../exports/Animated";import I18nManager from"../../../exports/I18nManager";import PanResponder from"../../../exports/PanResponder";import React from"react";import PropTypes from"prop-types";import StyleSheet from"../../../exports/StyleSheet";import TimerMixin from"react-timer-mixin";import View from"../../../exports/View";import createReactClass from"create-react-class";import emptyFunction from"fbjs/lib/emptyFunction";var isRTL=function(){return I18nManager.isRTL},CLOSED_LEFT_POSITION=0,HORIZONTAL_SWIPE_DISTANCE_THRESHOLD=10,HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD=.3,SLOW_SPEED_SWIPE_FACTOR=4,SWIPE_DURATION=300,ON_MOUNT_BOUNCE_DELAY=700,ON_MOUNT_BOUNCE_DURATION=400,RIGHT_SWIPE_BOUNCE_BACK_DISTANCE=30,RIGHT_SWIPE_BOUNCE_BACK_DURATION=300,RIGHT_SWIPE_THRESHOLD=30*SLOW_SPEED_SWIPE_FACTOR,SwipeableRow=createReactClass({displayName:"SwipeableRow",_panResponder:{},_previousLeft:CLOSED_LEFT_POSITION,mixins:[TimerMixin],propTypes:{children:PropTypes.any,isOpen:PropTypes.bool,preventSwipeRight:PropTypes.bool,maxSwipeDistance:PropTypes.number.isRequired,onOpen:PropTypes.func.isRequired,onClose:PropTypes.func.isRequired,onSwipeEnd:PropTypes.func.isRequired,onSwipeStart:PropTypes.func.isRequired,shouldBounceOnMount:PropTypes.bool,slideoutView:PropTypes.node.isRequired,swipeThreshold:PropTypes.number.isRequired},getInitialState:function(){return{currentLeft:new Animated.Value(this._previousLeft),isSwipeableViewRendered:!1,rowHeight:null}},getDefaultProps:function(){return{isOpen:!1,preventSwipeRight:!1,maxSwipeDistance:0,onOpen:emptyFunction,onClose:emptyFunction,onSwipeEnd:emptyFunction,onSwipeStart:emptyFunction,swipeThreshold:30}},UNSAFE_componentWillMount:function(){this._panResponder=PanResponder.create({onMoveShouldSetPanResponderCapture:this._handleMoveShouldSetPanResponderCapture,onPanResponderGrant:this._handlePanResponderGrant,onPanResponderMove:this._handlePanResponderMove,onPanResponderRelease:this._handlePanResponderEnd,onPanResponderTerminationRequest:this._onPanResponderTerminationRequest,onPanResponderTerminate:this._handlePanResponderEnd,onShouldBlockNativeResponder:function(e,i){return!1}})},componentDidMount:function(){var e=this;this.props.shouldBounceOnMount&&this.setTimeout(function(){e._animateBounceBack(ON_MOUNT_BOUNCE_DURATION)},ON_MOUNT_BOUNCE_DELAY)},UNSAFE_componentWillReceiveProps:function(e){this.props.isOpen&&!e.isOpen&&this._animateToClosedPosition()},render:function(){var e;this.state.isSwipeableViewRendered&&this.state.rowHeight&&(e=React.createElement(View,{style:[styles.slideOutContainer,{height:this.state.rowHeight}]},this.props.slideoutView));var i=React.createElement(Animated.View,{onLayout:this._onSwipeableViewLayout,style:{transform:[{translateX:this.state.currentLeft}]}},this.props.children);return React.createElement(View,this._panResponder.panHandlers,e,i)},close:function(){this.props.onClose(),this._animateToClosedPosition()},_onSwipeableViewLayout:function(e){this.setState({isSwipeableViewRendered:!0,rowHeight:e.nativeEvent.layout.height})},_handleMoveShouldSetPanResponderCapture:function(e,i){return i.dy<10&&this._isValidSwipe(i)},_handlePanResponderGrant:function(e,i){},_handlePanResponderMove:function(e,i){this._isSwipingExcessivelyRightFromClosedPosition(i)||(this.props.onSwipeStart(),this._isSwipingRightFromClosed(i)?this._swipeSlowSpeed(i):this._swipeFullSpeed(i))},_isSwipingRightFromClosed:function(e){var i=isRTL()?-e.dx:e.dx;return this._previousLeft===CLOSED_LEFT_POSITION&&i>0},_swipeFullSpeed:function(e){this.state.currentLeft.setValue(this._previousLeft+e.dx)},_swipeSlowSpeed:function(e){this.state.currentLeft.setValue(this._previousLeft+e.dx/SLOW_SPEED_SWIPE_FACTOR)},_isSwipingExcessivelyRightFromClosedPosition:function(e){var i=isRTL()?-e.dx:e.dx;return this._isSwipingRightFromClosed(e)&&i>RIGHT_SWIPE_THRESHOLD},_onPanResponderTerminationRequest:function(e,i){return!1},_animateTo:function(e,i,t){var n=this;void 0===i&&(i=SWIPE_DURATION),void 0===t&&(t=emptyFunction),Animated.timing(this.state.currentLeft,{duration:i,toValue:e,useNativeDriver:!0}).start(function(){n._previousLeft=e,t()})},_animateToOpenPosition:function(){var e=isRTL()?-this.props.maxSwipeDistance:this.props.maxSwipeDistance;this._animateTo(-e)},_animateToOpenPositionWith:function(e,i){e=e>HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD?e:HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD;var t=Math.abs((this.props.maxSwipeDistance-Math.abs(i))/e),n=isRTL()?-this.props.maxSwipeDistance:this.props.maxSwipeDistance;this._animateTo(-n,t)},_animateToClosedPosition:function(e){void 0===e&&(e=SWIPE_DURATION),this._animateTo(CLOSED_LEFT_POSITION,e)},_animateToClosedPositionDuringBounce:function(){this._animateToClosedPosition(RIGHT_SWIPE_BOUNCE_BACK_DURATION)},_animateBounceBack:function(e){var i=isRTL()?-RIGHT_SWIPE_BOUNCE_BACK_DISTANCE:RIGHT_SWIPE_BOUNCE_BACK_DISTANCE;this._animateTo(-i,e,this._animateToClosedPositionDuringBounce)},_isValidSwipe:function(e){return!(this.props.preventSwipeRight&&this._previousLeft===CLOSED_LEFT_POSITION&&e.dx>0)&&Math.abs(e.dx)>HORIZONTAL_SWIPE_DISTANCE_THRESHOLD},_shouldAnimateRemainder:function(e){return Math.abs(e.dx)>this.props.swipeThreshold||e.vx>HORIZONTAL_FULL_SWIPE_SPEED_THRESHOLD},_handlePanResponderEnd:function(e,i){var t=isRTL()?-i.dx:i.dx;this._isSwipingRightFromClosed(i)?(this.props.onOpen(),this._animateBounceBack(RIGHT_SWIPE_BOUNCE_BACK_DURATION)):this._shouldAnimateRemainder(i)?t<0?(this.props.onOpen(),this._animateToOpenPositionWith(i.vx,t)):(this.props.onClose(),this._animateToClosedPosition()):this._previousLeft===CLOSED_LEFT_POSITION?this._animateToClosedPosition():this._animateToOpenPosition(),this.props.onSwipeEnd()}}),styles=StyleSheet.create({slideOutContainer:{bottom:0,left:0,position:"absolute",right:0,top:0}});export default SwipeableRow;