"use strict";exports.__esModule=!0,exports.default=void 0;var _UnimplementedView=_interopRequireDefault(require("../../../modules/UnimplementedView")),_react=_interopRequireDefault(require("react")),_View=_interopRequireDefault(require("../../../exports/View")),_VirtualizedList=_interopRequireDefault(require("../VirtualizedList")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,i[e])})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var defaultProps=_objectSpread({},_VirtualizedList.default.defaultProps,{numColumns:1}),FlatList=function(t){_inheritsLoose(i,t);var e=i.prototype;function i(e){var s=t.call(this,e)||this;return s._hasWarnedLegacy=!1,s._virtualizedListPairs=[],s._captureRef=function(e){s._listRef=e},s._getItem=function(e,t){var i=s.props.numColumns;if(1<i){for(var n=[],r=0;r<i;r++){var a=e[t*i+r];a&&n.push(a)}return n}return e[t]},s._getItemCount=function(e){return e?Math.ceil(e.length/s.props.numColumns):0},s._keyExtractor=function(e,i){var t=s.props,n=t.keyExtractor,r=t.numColumns;return 1<r?((0,_invariant.default)(Array.isArray(e),"FlatList: Encountered internal consistency error, expected each item to consist of an array with 1-%s columns; instead, received a single item.",r),e.map(function(e,t){return n(e,i*r+t)}).join(":")):n(e,i)},s._renderItem=function(n){var e=s.props,r=e.renderItem,a=e.numColumns,t=e.columnWrapperStyle;if(1<a){var i=n.item,o=n.index;return(0,_invariant.default)(Array.isArray(i),"Expected array of items with numColumns > 1"),_react.default.createElement(_View.default,{style:[{flexDirection:"row"},t]},i.map(function(e,t){var i=r({item:e,index:o*a+t,separators:n.separators});return i&&_react.default.cloneElement(i,{key:t})}))}return r(n)},s.props.viewabilityConfigCallbackPairs?s._virtualizedListPairs=s.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityConfig:e.viewabilityConfig,onViewableItemsChanged:s._createOnViewableItemsChanged(e.onViewableItemsChanged)}}):s.props.onViewableItemsChanged&&s._virtualizedListPairs.push({viewabilityConfig:s.props.viewabilityConfig,onViewableItemsChanged:s._createOnViewableItemsChanged(s.props.onViewableItemsChanged)}),s}return e.scrollToEnd=function(e){this._listRef&&this._listRef.scrollToEnd(e)},e.scrollToIndex=function(e){this._listRef&&this._listRef.scrollToIndex(e)},e.scrollToItem=function(e){this._listRef&&this._listRef.scrollToItem(e)},e.scrollToOffset=function(e){this._listRef&&this._listRef.scrollToOffset(e)},e.recordInteraction=function(){this._listRef&&this._listRef.recordInteraction()},e.flashScrollIndicators=function(){this._listRef&&this._listRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._listRef)return this._listRef.getScrollResponder()},e.getScrollableNode=function(){if(this._listRef)return this._listRef.getScrollableNode()},e.setNativeProps=function(e){this._listRef&&this._listRef.setNativeProps(e)},e.UNSAFE_componentWillMount=function(){this._checkProps(this.props)},e.UNSAFE_componentWillReceiveProps=function(e){(0,_invariant.default)(e.numColumns===this.props.numColumns,"Changing numColumns on the fly is not supported. Change the key prop on FlatList when changing the number of columns to force a fresh render of the component."),(0,_invariant.default)(e.onViewableItemsChanged===this.props.onViewableItemsChanged,"Changing onViewableItemsChanged on the fly is not supported"),(0,_invariant.default)(e.viewabilityConfig===this.props.viewabilityConfig,"Changing viewabilityConfig on the fly is not supported"),(0,_invariant.default)(e.viewabilityConfigCallbackPairs===this.props.viewabilityConfigCallbackPairs,"Changing viewabilityConfigCallbackPairs on the fly is not supported"),this._checkProps(e)},e._checkProps=function(e){var t=e.getItem,i=e.getItemCount,n=e.horizontal,r=e.legacyImplementation,a=e.numColumns,o=e.columnWrapperStyle,s=e.onViewableItemsChanged,l=e.viewabilityConfigCallbackPairs;(0,_invariant.default)(!t&&!i,"FlatList does not support custom data formats."),1<a?(0,_invariant.default)(!n,"numColumns does not support horizontal."):(0,_invariant.default)(!o,"columnWrapperStyle not supported for single column lists"),r&&((0,_invariant.default)(1===a,"Legacy list does not support multiple columns."),this._hasWarnedLegacy||(console.warn("FlatList: Using legacyImplementation - some features not supported and performance may suffer"),this._hasWarnedLegacy=!0)),(0,_invariant.default)(!(s&&l),"FlatList does not support setting both onViewableItemsChanged and viewabilityConfigCallbackPairs.")},e._pushMultiColumnViewable=function(n,r){var e=this.props,a=e.numColumns,o=e.keyExtractor;r.item.forEach(function(e,t){(0,_invariant.default)(null!=r.index,"Missing index!");var i=r.index*a+t;n.push(_objectSpread({},r,{item:e,key:o(e,i),index:i}))})},e._createOnViewableItemsChanged=function(r){var a=this;return function(e){var t,i,n=a.props.numColumns;r&&(1<n?(t=[],i=[],e.viewableItems.forEach(function(e){return a._pushMultiColumnViewable(i,e)}),e.changed.forEach(function(e){return a._pushMultiColumnViewable(t,e)}),r({viewableItems:i,changed:t})):r(e))}},e.render=function(){return this.props.legacyImplementation?_react.default.createElement(_UnimplementedView.default,_extends({},this.props,{items:this.props.data,ref:this._captureRef})):_react.default.createElement(_VirtualizedList.default,_extends({},this.props,{renderItem:this._renderItem,getItem:this._getItem,getItemCount:this._getItemCount,keyExtractor:this._keyExtractor,ref:this._captureRef,viewabilityConfigCallbackPairs:this._virtualizedListPairs}))},i}(_react.default.PureComponent);FlatList.defaultProps=defaultProps;var _default=FlatList;exports.default=FlatList,module.exports=exports.default;