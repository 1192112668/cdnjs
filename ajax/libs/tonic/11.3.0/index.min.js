class TonicRaw{constructor(t,e){this.isTonicRaw=!0,this.rawText=t,this.templateStrings=e}valueOf(){return this.rawText}toString(){return this.rawText}}class Tonic extends window.HTMLElement{constructor(){super();const t=Tonic._states[this.id];delete Tonic._states[this.id],this.state=t||{},this.props={},this.elements=[...this.children],this.elements.__children__=!0,this.nodes=[...this.childNodes],this.nodes.__children__=!0,this._events()}static _createId(){return`tonic${Tonic._index++}`}static _maybePromise(t){t&&"function"==typeof t.then&&"function"==typeof t.catch&&t.catch(t=>setTimeout(()=>{throw t},0))}static _splitName(t){return t.match(/[A-Z][a-z]*/g).join("-")}static _normalizeAttrs(t,e={}){return[...t].forEach(t=>e[t.name]=t.value),e}_events(){const t=Object.getOwnPropertyNames(window.HTMLElement.prototype);for(const e of this._props)-1!==t.indexOf("on"+e)&&this.addEventListener(e,this)}_prop(t){const e=this._id,s=`__${e}__${Tonic._createId()}__`;return Tonic._data[e]=Tonic._data[e]||{},Tonic._data[e][s]=t,s}_placehold(t){const e=this._id,s=`placehold:${e}:${Tonic._createId()}__`;return Tonic._children[e]=Tonic._children[e]||{},Tonic._children[e][s]=t,s}static match(t,e){return t.matches||(t=t.parentElement),t.matches(e)?t:t.closest(e)}static getPropertyNames(t){const e=[];for(;t&&t!==Tonic.prototype;)e.push(...Object.getOwnPropertyNames(t)),t=Object.getPrototypeOf(t);return e}static add(t,e){if(!(e||t.name&&t.name.length>1))throw Error("Mangling. https://bit.ly/2TkJ6zP");if(e||(e=Tonic._splitName(t.name).toLowerCase()),!window.customElements.get(e)){if(!t.prototype.isTonicComponent){const e={[t.name]:class extends Tonic{}}[t.name];e.prototype.render=t,t=e}t.prototype._props=Tonic.getPropertyNames(t.prototype),Tonic._reg[e]=t,Tonic._tags=Object.keys(Tonic._reg).join(),window.customElements.define(e,t),t.stylesheet&&Tonic.registerStyles(t.stylesheet)}}static registerStyles(t){if(Tonic._stylesheetRegistry.includes(t))return;Tonic._stylesheetRegistry.push(t);const e=document.createElement("style");e.appendChild(document.createTextNode(t())),document.head&&document.head.appendChild(e)}static escape(t){return t.replace(Tonic.ESC,t=>Tonic.MAP[t])}static raw(t,e){return new TonicRaw(t,e)}html(t,...e){const s=t=>{if(t&&t.__children__)return this._placehold(t);if(t&&t.isTonicRaw)return t.rawText;switch(Object.prototype.toString.call(t)){case"[object HTMLCollection]":case"[object NodeList]":return this._placehold([...t]);case"[object Array]":case"[object Object]":case"[object Function]":return this._prop(t);case"[object NamedNodeMap]":return this._prop(Tonic._normalizeAttrs(t));case"[object Number]":return`${t}__float`;case"[object String]":return Tonic.escape(t);case"[object Boolean]":return`${t}__boolean`;case"[object Null]":return`${t}__null`;case"[object HTMLElement]":return this._placehold([t])}return"object"==typeof t&&t&&1===t.nodeType&&"function"==typeof t.cloneNode?this._placehold([t]):t},n=[];for(let i=0;i<t.length-1;i++)n.push(t[i],s(e[i]));n.push(t[t.length-1]);const i=n.join("").replace(Tonic.SPREAD,(t,e)=>{const s=Tonic._data[e.split("__")[1]][e];return Object.entries(s).map(([t,e])=>{const s=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return!0===e?s:e?`${s}="${Tonic.escape(String(e))}"`:""}).filter(Boolean).join(" ")});return Tonic.raw(i,t)}setState(t){this.state="function"==typeof t?t(this.state):t}getState(){return this.state}scheduleReRender(t){return this.pendingReRender?this.pendingReRender:(this.pendingReRender=new Promise(e=>{window.requestAnimationFrame(()=>{const s=this._set(this.root,this.render);this.pendingReRender=null,s&&s.then?Tonic._maybePromise(s.then(()=>{this.updated&&this.updated(t),e()})):(this.updated&&this.updated(t),e())})}),this.pendingReRender)}reRender(t=this.props){const e={...this.props};return this.props="function"==typeof t?t(e):t,this.scheduleReRender(e)}getProps(){return this.props}handleEvent(t){Tonic._maybePromise(this[t.type](t))}_drainIterator(t,e){return e.next().then(s=>{if(this._set(t,null,s.value),!s.done)return this._drainIterator(t,e)})}_set(t,e,s=""){for(const e of t.querySelectorAll(Tonic._tags))e.isTonicComponent&&e.id&&Tonic._refIds.includes(e.id)&&(Tonic._states[e.id]=e.getState());if(e instanceof Tonic.AsyncFunction){return(e.call(this)||"").then(e=>this._apply(t,e))}if(e instanceof Tonic.AsyncFunctionGenerator){const s=e.call(this);return this._drainIterator(t,s)}return e instanceof Function?(s=e.call(this)||"",this._apply(t,s)):this._apply(t,s)}_apply(t,e){if(e&&e.isTonicRaw&&(e=e.rawText),"string"==typeof e){if(this.stylesheet&&(e=`<style>${this.stylesheet()}</style>${e}`),t.innerHTML=e,this.styles){const e=this.styles();for(const s of t.querySelectorAll("[styles]"))for(const t of s.getAttribute("styles").split(/\s+/))Object.assign(s.style,e[t.trim()])}const s=Tonic._children[this._id]||{},n=(t,e)=>{if(3===t.nodeType){const n=t.textContent.trim();s[n]&&e(t,s[n])}const i=t.childNodes;if(i)for(let t=0;t<i.length;t++)n(i[t],e)};n(t,(t,e)=>{for(const s of e)t.parentNode.insertBefore(s,t);delete Tonic._children[this._id][t.id],t.parentNode.removeChild(t)})}else t.innerHTML="",t.appendChild(e.cloneNode(!0))}connectedCallback(){this.root=this.shadowRoot||this,this.wrap&&(this.wrapped=this.render,this.render=this.wrap),this.id&&!Tonic._refIds.includes(this.id)&&Tonic._refIds.push(this.id);const t=t=>t.replace(/-(.)/g,(t,e)=>e.toUpperCase());for(const{name:e,value:s}of this.attributes){const n=t(e),i=this.props[n]=s;if(/__\w+__\w+__/.test(i)){const{1:t}=i.split("__");this.props[n]=Tonic._data[t][i]}else if(/\d+__float/.test(i))this.props[n]=parseFloat(i,10);else if("null__null"===i)this.props[n]=null;else if(/\w+__boolean/.test(i))this.props[n]=i.includes("true");else if(/placehold:\w+:\w+__/.test(i)){const{1:t}=i.split(":");this.props[n]=Tonic._children[t][i][0]}}this.props=Object.assign(this.defaults?this.defaults():{},this.props),this._source?this.innerHTML=this._source:this._source=this.innerHTML,this._id=this._id||Tonic._createId(),this.willConnect&&this.willConnect(),Tonic._maybePromise(this._set(this.root,this.render)),Tonic._maybePromise(this.connected&&this.connected())}disconnectedCallback(){Tonic._maybePromise(this.disconnected&&this.disconnected()),delete Tonic._data[this._id],delete Tonic._children[this._id]}}Tonic.prototype.isTonicComponent=!0,Object.assign(Tonic,{_tags:"",_refIds:[],_data:{},_states:{},_children:{},_reg:{},_stylesheetRegistry:[],_index:0,version:"undefined"!=typeof require?require("./package").version:null,SPREAD:/\.\.\.\s?(__\w+__\w+__)/g,ESC:/["&'<>`]/g,AsyncFunctionGenerator:async function*(){}.constructor,AsyncFunction:async function(){}.constructor,MAP:{'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;"}}),"object"==typeof module&&(module.exports=Tonic);