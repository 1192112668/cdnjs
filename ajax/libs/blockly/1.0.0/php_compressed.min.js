"use strict";Blockly.PHP=new Blockly.Generator("PHP"),Blockly.PHP.addReservedWords("__halt_compiler,abstract,and,array,as,break,callable,case,catch,class,clone,const,continue,declare,default,die,do,echo,else,elseif,empty,enddeclare,endfor,endforeach,endif,endswitch,endwhile,eval,exit,extends,final,for,foreach,function,global,goto,if,implements,include,include_once,instanceof,insteadof,interface,isset,list,namespace,new,or,print,private,protected,public,require,require_once,return,static,switch,throw,trait,try,unset,use,var,while,xor,PHP_VERSION,PHP_MAJOR_VERSION,PHP_MINOR_VERSION,PHP_RELEASE_VERSION,PHP_VERSION_ID,PHP_EXTRA_VERSION,PHP_ZTS,PHP_DEBUG,PHP_MAXPATHLEN,PHP_OS,PHP_SAPI,PHP_EOL,PHP_INT_MAX,PHP_INT_SIZE,DEFAULT_INCLUDE_PATH,PEAR_INSTALL_DIR,PEAR_EXTENSION_DIR,PHP_EXTENSION_DIR,PHP_PREFIX,PHP_BINDIR,PHP_BINARY,PHP_MANDIR,PHP_LIBDIR,PHP_DATADIR,PHP_SYSCONFDIR,PHP_LOCALSTATEDIR,PHP_CONFIG_FILE_PATH,PHP_CONFIG_FILE_SCAN_DIR,PHP_SHLIB_SUFFIX,E_ERROR,E_WARNING,E_PARSE,E_NOTICE,E_CORE_ERROR,E_CORE_WARNING,E_COMPILE_ERROR,E_COMPILE_WARNING,E_USER_ERROR,E_USER_WARNING,E_USER_NOTICE,E_DEPRECATED,E_USER_DEPRECATED,E_ALL,E_STRICT,__COMPILER_HALT_OFFSET__,TRUE,FALSE,NULL,__CLASS__,__DIR__,__FILE__,__FUNCTION__,__LINE__,__METHOD__,__NAMESPACE__,__TRAIT__"),Blockly.PHP.ORDER_ATOMIC=0,Blockly.PHP.ORDER_CLONE=1,Blockly.PHP.ORDER_NEW=1,Blockly.PHP.ORDER_MEMBER=2.1,Blockly.PHP.ORDER_FUNCTION_CALL=2.2,Blockly.PHP.ORDER_POWER=3,Blockly.PHP.ORDER_INCREMENT=4,Blockly.PHP.ORDER_DECREMENT=4,Blockly.PHP.ORDER_BITWISE_NOT=4,Blockly.PHP.ORDER_CAST=4,Blockly.PHP.ORDER_SUPPRESS_ERROR=4,Blockly.PHP.ORDER_INSTANCEOF=5,Blockly.PHP.ORDER_LOGICAL_NOT=6,Blockly.PHP.ORDER_UNARY_PLUS=7.1,Blockly.PHP.ORDER_UNARY_NEGATION=7.2,Blockly.PHP.ORDER_MULTIPLICATION=8.1,Blockly.PHP.ORDER_DIVISION=8.2,Blockly.PHP.ORDER_MODULUS=8.3,Blockly.PHP.ORDER_ADDITION=9.1,Blockly.PHP.ORDER_SUBTRACTION=9.2,Blockly.PHP.ORDER_STRING_CONCAT=9.3,Blockly.PHP.ORDER_BITWISE_SHIFT=10,Blockly.PHP.ORDER_RELATIONAL=11,Blockly.PHP.ORDER_EQUALITY=12,Blockly.PHP.ORDER_REFERENCE=13,Blockly.PHP.ORDER_BITWISE_AND=13,Blockly.PHP.ORDER_BITWISE_XOR=14,Blockly.PHP.ORDER_BITWISE_OR=15,Blockly.PHP.ORDER_LOGICAL_AND=16,Blockly.PHP.ORDER_LOGICAL_OR=17,Blockly.PHP.ORDER_IF_NULL=18,Blockly.PHP.ORDER_CONDITIONAL=19,Blockly.PHP.ORDER_ASSIGNMENT=20,Blockly.PHP.ORDER_LOGICAL_AND_WEAK=21,Blockly.PHP.ORDER_LOGICAL_XOR=22,Blockly.PHP.ORDER_LOGICAL_OR_WEAK=23,Blockly.PHP.ORDER_COMMA=24,Blockly.PHP.ORDER_NONE=99,Blockly.PHP.ORDER_OVERRIDES=[[Blockly.PHP.ORDER_MEMBER,Blockly.PHP.ORDER_FUNCTION_CALL],[Blockly.PHP.ORDER_MEMBER,Blockly.PHP.ORDER_MEMBER],[Blockly.PHP.ORDER_LOGICAL_NOT,Blockly.PHP.ORDER_LOGICAL_NOT],[Blockly.PHP.ORDER_MULTIPLICATION,Blockly.PHP.ORDER_MULTIPLICATION],[Blockly.PHP.ORDER_ADDITION,Blockly.PHP.ORDER_ADDITION],[Blockly.PHP.ORDER_LOGICAL_AND,Blockly.PHP.ORDER_LOGICAL_AND],[Blockly.PHP.ORDER_LOGICAL_OR,Blockly.PHP.ORDER_LOGICAL_OR]],Blockly.PHP.ONE_BASED_INDEXING=!0,Blockly.PHP.init=function(l){Blockly.PHP.definitions_=Object.create(null),Blockly.PHP.functionNames_=Object.create(null),Blockly.PHP.variableDB_?Blockly.PHP.variableDB_.reset():Blockly.PHP.variableDB_=new Blockly.Names(Blockly.PHP.RESERVED_WORDS_,"$");var e=[];l=Blockly.Variables.allVariables(l);for(var o=0;o<l.length;o++)e[o]=Blockly.PHP.variableDB_.getName(l[o],Blockly.Variables.NAME_TYPE)+";";Blockly.PHP.definitions_.variables=e.join("\n")},Blockly.PHP.finish=function(l){var e,o=[];for(e in Blockly.PHP.definitions_)o.push(Blockly.PHP.definitions_[e]);return delete Blockly.PHP.definitions_,delete Blockly.PHP.functionNames_,Blockly.PHP.variableDB_.reset(),o.join("\n\n")+"\n\n\n"+l},Blockly.PHP.scrubNakedValue=function(l){return l+";\n"},Blockly.PHP.quote_=function(l){return"'"+(l=l.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"},Blockly.PHP.scrub_=function(l,e){var o="";if(!l.outputConnection||!l.outputConnection.targetConnection){var P=l.getCommentText();(P=Blockly.utils.wrap(P,Blockly.PHP.COMMENT_WRAP-3))&&(o+=Blockly.PHP.prefixLines(P,"// ")+"\n");for(var t=0;t<l.inputList.length;t++)l.inputList[t].type==Blockly.INPUT_VALUE&&(P=l.inputList[t].connection.targetBlock())&&(P=Blockly.PHP.allNestedComments(P))&&(o+=Blockly.PHP.prefixLines(P,"// "))}return t=l.nextConnection&&l.nextConnection.targetBlock(),o+e+(t=Blockly.PHP.blockToCode(t))},Blockly.PHP.getAdjusted=function(l,e,o,P,t){o=o||0,t=t||Blockly.PHP.ORDER_NONE,Blockly.PHP.ONE_BASED_INDEXING&&o--;var c,r=Blockly.PHP.ONE_BASED_INDEXING?"1":"0";return l=0<o?Blockly.PHP.valueToCode(l,e,Blockly.PHP.ORDER_ADDITION)||r:o<0?Blockly.PHP.valueToCode(l,e,Blockly.PHP.ORDER_SUBTRACTION)||r:P?Blockly.PHP.valueToCode(l,e,Blockly.PHP.ORDER_UNARY_NEGATION)||r:Blockly.PHP.valueToCode(l,e,t)||r,Blockly.isNumber(l)?(l=parseFloat(l)+o,P&&(l=-l)):(0<o?(l=l+" + "+o,c=Blockly.PHP.ORDER_ADDITION):o<0&&(l=l+" - "+-o,c=Blockly.PHP.ORDER_SUBTRACTION),P&&(l=o?"-("+l+")":"-"+l,c=Blockly.PHP.ORDER_UNARY_NEGATION),c=Math.floor(c),t=Math.floor(t),c&&c<=t&&(l="("+l+")")),l},Blockly.PHP.colour={},Blockly.PHP.colour_picker=function(l){return["'"+l.getFieldValue("COLOUR")+"'",Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.colour_random=function(l){return[Blockly.PHP.provideFunction_("colour_random",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"() {","  return '#' . str_pad(dechex(mt_rand(0, 0xFFFFFF)), 6, '0', STR_PAD_LEFT);","}"])+"()",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.colour_rgb=function(l){var e=Blockly.PHP.valueToCode(l,"RED",Blockly.PHP.ORDER_COMMA)||0,o=Blockly.PHP.valueToCode(l,"GREEN",Blockly.PHP.ORDER_COMMA)||0;return l=Blockly.PHP.valueToCode(l,"BLUE",Blockly.PHP.ORDER_COMMA)||0,[Blockly.PHP.provideFunction_("colour_rgb",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($r, $g, $b) {","  $r = round(max(min($r, 100), 0) * 2.55);","  $g = round(max(min($g, 100), 0) * 2.55);","  $b = round(max(min($b, 100), 0) * 2.55);","  $hex = '#';","  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);","  return $hex;","}"])+"("+e+", "+o+", "+l+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.colour_blend=function(l){var e=Blockly.PHP.valueToCode(l,"COLOUR1",Blockly.PHP.ORDER_COMMA)||"'#000000'",o=Blockly.PHP.valueToCode(l,"COLOUR2",Blockly.PHP.ORDER_COMMA)||"'#000000'";return l=Blockly.PHP.valueToCode(l,"RATIO",Blockly.PHP.ORDER_COMMA)||.5,[Blockly.PHP.provideFunction_("colour_blend",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($c1, $c2, $ratio) {","  $ratio = max(min($ratio, 1), 0);","  $r1 = hexdec(substr($c1, 1, 2));","  $g1 = hexdec(substr($c1, 3, 2));","  $b1 = hexdec(substr($c1, 5, 2));","  $r2 = hexdec(substr($c2, 1, 2));","  $g2 = hexdec(substr($c2, 3, 2));","  $b2 = hexdec(substr($c2, 5, 2));","  $r = round($r1 * (1 - $ratio) + $r2 * $ratio);","  $g = round($g1 * (1 - $ratio) + $g2 * $ratio);","  $b = round($b1 * (1 - $ratio) + $b2 * $ratio);","  $hex = '#';","  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);","  return $hex;","}"])+"("+e+", "+o+", "+l+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists={},Blockly.PHP.lists_create_empty=function(l){return["array()",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_create_with=function(l){for(var e=Array(l.itemCount_),o=0;o<l.itemCount_;o++)e[o]=Blockly.PHP.valueToCode(l,"ADD"+o,Blockly.PHP.ORDER_COMMA)||"null";return[e="array("+e.join(", ")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_repeat=function(l){return[Blockly.PHP.provideFunction_("lists_repeat",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value, $count) {","  $array = array();","  for ($index = 0; $index < $count; $index++) {","    $array[] = $value;","  }","  return $array;","}"])+"("+(Blockly.PHP.valueToCode(l,"ITEM",Blockly.PHP.ORDER_COMMA)||"null")+", "+(l=Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_COMMA)||"0")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_length=function(l){return[Blockly.PHP.provideFunction_("length",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(l=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_isEmpty=function(l){return["empty("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_indexOf=function(l){var e,o=Blockly.PHP.valueToCode(l,"FIND",Blockly.PHP.ORDER_NONE)||"''",P=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_MEMBER)||"[]",t=Blockly.PHP.ONE_BASED_INDEXING?(e=" 0"," + 1"):(e=" -1","");return[("FIRST"==l.getFieldValue("END")?Blockly.PHP.provideFunction_("indexOf",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) return $index"+t+";","  }","  return "+e+";","}"]):Blockly.PHP.provideFunction_("lastIndexOf",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  $last = "+e+";","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) $last = $index"+t+";","  }","  return $last;","}"]))+"("+P+", "+o+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_getIndex=function(l){var e=l.getFieldValue("MODE")||"GET";switch(l.getFieldValue("WHERE")||"FROM_START"){case"FIRST":if("GET"==e){var o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_MEMBER)||"array()";return[o+"[0]",Blockly.PHP.ORDER_MEMBER]}if("GET_REMOVE"==e)return["array_shift("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_shift("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+");\n";break;case"LAST":if("GET"==e)return["end("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return["array_pop("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_pop("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+");\n";break;case"FROM_START":var P=Blockly.PHP.getAdjusted(l,"AT");if("GET"==e)return[(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_MEMBER)||"array()")+"["+P+"]",Blockly.PHP.ORDER_MEMBER];if("GET_REMOVE"==e)return["array_splice("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_COMMA)||"array()")+", "+P+", 1)[0]",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_splice("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_COMMA)||"array()")+", "+P+", 1);\n";break;case"FROM_END":if("GET"==e)return["array_slice("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_COMMA)||"array()")+", "+(P=Blockly.PHP.getAdjusted(l,"AT",1,!0))+", 1)[0]",Blockly.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e||"REMOVE"==e){if(o="array_splice("+(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()")+", count("+o+") - "+(P=Blockly.PHP.getAdjusted(l,"AT",1,!1,Blockly.PHP.ORDER_SUBTRACTION))+", 1)[0]","GET_REMOVE"==e)return[o,Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return o+";\n"}break;case"RANDOM":if(o=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"array()","GET"==e)return[(e=Blockly.PHP.provideFunction_("lists_get_random_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  return $list[rand(0,count($list)-1)];","}"]))+"("+o+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return[(e=Blockly.PHP.provideFunction_("lists_get_remove_random_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  $x = rand(0,count($list)-1);","  unset($list[$x]);","  return array_values($list);","}"]))+"("+o+")",Blockly.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return(e=Blockly.PHP.provideFunction_("lists_remove_random_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  unset($list[rand(0,count($list)-1)]);","}"]))+"("+o+");\n"}throw"Unhandled combination (lists_getIndex)."},Blockly.PHP.lists_setIndex=function(l){var e=l.getFieldValue("MODE")||"GET",o=l.getFieldValue("WHERE")||"FROM_START",P=Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_ASSIGNMENT)||"null";switch(o){case"FIRST":if("SET"==e)return(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_MEMBER)||"array()")+"[0] = "+P+";\n";if("INSERT"==e)return"array_unshift("+(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_COMMA)||"array()")+", "+P+");\n";break;case"LAST":if(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_COMMA)||"array()","SET"==e)return(e=Blockly.PHP.provideFunction_("lists_set_last_item",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $value) {","  $list[count($list) - 1] = $value;","}"]))+"("+o+", "+P+");\n";if("INSERT"==e)return"array_push("+o+", "+P+");\n";break;case"FROM_START":var t=Blockly.PHP.getAdjusted(l,"AT");if("SET"==e)return(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_MEMBER)||"array()")+"["+t+"] = "+P+";\n";if("INSERT"==e)return"array_splice("+(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_COMMA)||"array()")+", "+t+", 0, "+P+");\n";break;case"FROM_END":if(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_COMMA)||"array()",t=Blockly.PHP.getAdjusted(l,"AT",1),"SET"==e)return(e=Blockly.PHP.provideFunction_("lists_set_from_end",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  $list[count($list) - $at] = $value;","}"]))+"("+o+", "+t+", "+P+");\n";if("INSERT"==e)return(e=Blockly.PHP.provideFunction_("lists_insert_from_end",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  return array_splice($list, count($list) - $at, 0, $value);","}"]))+"("+o+", "+t+", "+P+");\n";break;case"RANDOM":if(l=(o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_REFERENCE)||"array()").match(/^\$\w+$/)?"":(t=(l=Blockly.PHP.variableDB_.getDistinctName("tmp_list",Blockly.Variables.NAME_TYPE))+" = &"+o+";\n",o=l,t),l+=(t=Blockly.PHP.variableDB_.getDistinctName("tmp_x",Blockly.Variables.NAME_TYPE))+" = rand(0, count("+o+")-1);\n","SET"==e)return l+(o+"[")+t+"] = "+P+";\n";if("INSERT"==e)return l+"array_splice("+o+", "+t+", 0, "+P+");\n"}throw"Unhandled combination (lists_setIndex)."},Blockly.PHP.lists_getSublist=function(l){var e=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_COMMA)||"array()",o=l.getFieldValue("WHERE1"),P=l.getFieldValue("WHERE2");if("FIRST"!=o||"LAST"!=P)if(e.match(/^\$\w+$/)||"FROM_END"!=o&&"FROM_START"==P){switch(o){case"FROM_START":var t=Blockly.PHP.getAdjusted(l,"AT1");break;case"FROM_END":t="count("+e+") - "+(t=Blockly.PHP.getAdjusted(l,"AT1",1,!1,Blockly.PHP.ORDER_SUBTRACTION));break;case"FIRST":t="0";break;default:throw"Unhandled option (lists_getSublist)."}switch(P){case"FROM_START":o=(l=Blockly.PHP.getAdjusted(l,"AT2",0,!1,Blockly.PHP.ORDER_SUBTRACTION))+" - ",o=Blockly.isNumber(String(t))||String(t).match(/^\(.+\)$/)?o+t:o+"("+t+")",o+=" + 1";break;case"FROM_END":o="count("+e+") - "+(l=Blockly.PHP.getAdjusted(l,"AT2",0,!1,Blockly.PHP.ORDER_SUBTRACTION))+" - ",o=Blockly.isNumber(String(t))||String(t).match(/^\(.+\)$/)?o+t:o+"("+t+")";break;case"LAST":o="count("+e+") - ",o=Blockly.isNumber(String(t))||String(t).match(/^\(.+\)$/)?o+t:o+"("+t+")";break;default:throw"Unhandled option (lists_getSublist)."}e="array_slice("+e+", "+t+", "+o+")"}else t=Blockly.PHP.getAdjusted(l,"AT1"),l=Blockly.PHP.getAdjusted(l,"AT2"),e=Blockly.PHP.provideFunction_("lists_get_sublist",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = count($list) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START'){","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = count($list) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = count($list) - $at1;","  } else {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  return array_slice($list, $at1, $length);","}"])+"("+e+", '"+o+"', "+t+", '"+P+"', "+l+")";return[e,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_sort=function(l){var e=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_COMMA)||"array()",o="1"===l.getFieldValue("DIRECTION")?1:-1;return l=l.getFieldValue("TYPE"),[Blockly.PHP.provideFunction_("lists_sort",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $type, $direction) {","  $sortCmpFuncs = array(",'    "NUMERIC" => "strnatcasecmp",','    "TEXT" => "strcmp",','    "IGNORE_CASE" => "strcasecmp"',"  );","  $sortCmp = $sortCmpFuncs[$type];","  $list2 = $list;","  usort($list2, $sortCmp);","  if ($direction == -1) {","    $list2 = array_reverse($list2);","  }","  return $list2;","}"])+"("+e+', "'+l+'", '+o+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.lists_split=function(l){var e=Blockly.PHP.valueToCode(l,"INPUT",Blockly.PHP.ORDER_COMMA),o=Blockly.PHP.valueToCode(l,"DELIM",Blockly.PHP.ORDER_COMMA)||"''";if("SPLIT"==(l=l.getFieldValue("MODE")))e=e||"''",l="explode";else{if("JOIN"!=l)throw"Unknown mode: "+l;e=e||"array()",l="implode"}return[l+"("+o+", "+e+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.logic={},Blockly.PHP.controls_if=function(l){for(var e=0,o=Blockly.PHP.valueToCode(l,"IF"+e,Blockly.PHP.ORDER_NONE)||"false",P=Blockly.PHP.statementToCode(l,"DO"+e),t="if ("+o+") {\n"+P+"}",e=1;e<=l.elseifCount_;e++)t+=" else if ("+(o=Blockly.PHP.valueToCode(l,"IF"+e,Blockly.PHP.ORDER_NONE)||"false")+") {\n"+(P=Blockly.PHP.statementToCode(l,"DO"+e))+"}";return l.elseCount_&&(t+=" else {\n"+(P=Blockly.PHP.statementToCode(l,"ELSE"))+"}"),t+"\n"},Blockly.PHP.logic_compare=function(l){var e={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[l.getFieldValue("OP")],o="=="==e||"!="==e?Blockly.PHP.ORDER_EQUALITY:Blockly.PHP.ORDER_RELATIONAL;return[(Blockly.PHP.valueToCode(l,"A",o)||"0")+" "+e+" "+(l=Blockly.PHP.valueToCode(l,"B",o)||"0"),o]},Blockly.PHP.logic_operation=function(l){var e,o="AND"==l.getFieldValue("OP")?"&&":"||",P="&&"==o?Blockly.PHP.ORDER_LOGICAL_AND:Blockly.PHP.ORDER_LOGICAL_OR,t=Blockly.PHP.valueToCode(l,"A",P);return l=Blockly.PHP.valueToCode(l,"B",P),l=t||l?(e="&&"==o?"true":"false",t=t||e,l||e):t="false",[t+" "+o+" "+l,P]},Blockly.PHP.logic_negate=function(l){var e=Blockly.PHP.ORDER_LOGICAL_NOT;return["!"+(Blockly.PHP.valueToCode(l,"BOOL",e)||"true"),e]},Blockly.PHP.logic_boolean=function(l){return["TRUE"==l.getFieldValue("BOOL")?"true":"false",Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.logic_null=function(l){return["null",Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.logic_ternary=function(l){return[(Blockly.PHP.valueToCode(l,"IF",Blockly.PHP.ORDER_CONDITIONAL)||"false")+" ? "+(Blockly.PHP.valueToCode(l,"THEN",Blockly.PHP.ORDER_CONDITIONAL)||"null")+" : "+(l=Blockly.PHP.valueToCode(l,"ELSE",Blockly.PHP.ORDER_CONDITIONAL)||"null"),Blockly.PHP.ORDER_CONDITIONAL]},Blockly.PHP.loops={},Blockly.PHP.controls_repeat_ext=function(l){var e=l.getField("TIMES")?String(Number(l.getFieldValue("TIMES"))):Blockly.PHP.valueToCode(l,"TIMES",Blockly.PHP.ORDER_ASSIGNMENT)||"0",o=Blockly.PHP.statementToCode(l,"DO"),o=Blockly.PHP.addLoopTrap(o,l.id);l="";var P=Blockly.PHP.variableDB_.getDistinctName("count",Blockly.Variables.NAME_TYPE),t=e;return e.match(/^\w+$/)||Blockly.isNumber(e)||(l+=(t=Blockly.PHP.variableDB_.getDistinctName("repeat_end",Blockly.Variables.NAME_TYPE))+" = "+e+";\n"),l+"for ("+P+" = 0; "+P+" < "+t+"; "+P+"++) {\n"+o+"}\n"},Blockly.PHP.controls_repeat=Blockly.PHP.controls_repeat_ext,Blockly.PHP.controls_whileUntil=function(l){var e="UNTIL"==l.getFieldValue("MODE"),o=Blockly.PHP.valueToCode(l,"BOOL",e?Blockly.PHP.ORDER_LOGICAL_NOT:Blockly.PHP.ORDER_NONE)||"false",P=Blockly.PHP.statementToCode(l,"DO");return e&&(o="!"+o),"while ("+o+") {\n"+(P=Blockly.PHP.addLoopTrap(P,l.id))+"}\n"},Blockly.PHP.controls_for=function(l){var e,o=Blockly.PHP.variableDB_.getName(l.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE),P=Blockly.PHP.valueToCode(l,"FROM",Blockly.PHP.ORDER_ASSIGNMENT)||"0",t=Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_ASSIGNMENT)||"0",c=Blockly.PHP.valueToCode(l,"BY",Blockly.PHP.ORDER_ASSIGNMENT)||"1",r=Blockly.PHP.statementToCode(l,"DO"),r=Blockly.PHP.addLoopTrap(r,l.id);return Blockly.isNumber(P)&&Blockly.isNumber(t)&&Blockly.isNumber(c)?(l="for ("+o+" = "+P+"; "+o+((e=parseFloat(P)<=parseFloat(t))?" <= ":" >= ")+t+"; "+o,l=(1==(o=Math.abs(parseFloat(c)))?l+(e?"++":"--"):l+(e?" += ":" -= ")+o)+") {\n"+r+"}\n"):(l="",(e=P).match(/^\w+$/)||Blockly.isNumber(P)||(l+=(e=Blockly.PHP.variableDB_.getDistinctName(o+"_start",Blockly.Variables.NAME_TYPE))+" = "+P+";\n"),(P=t).match(/^\w+$/)||Blockly.isNumber(t)||(l+=(P=Blockly.PHP.variableDB_.getDistinctName(o+"_end",Blockly.Variables.NAME_TYPE))+" = "+t+";\n"),l+=(t=Blockly.PHP.variableDB_.getDistinctName(o+"_inc",Blockly.Variables.NAME_TYPE))+" = ",l=(l=Blockly.isNumber(c)?l+(Math.abs(c)+";\n"):l+"abs("+c+");\n")+"if ("+e+" > "+P+") {\n"+(Blockly.PHP.INDENT+t)+" = -"+t+";\n",l+="}\n",l+="for ("+o+" = "+e+"; "+t+" >= 0 ? "+o+" <= "+P+" : "+o+" >= "+P+"; "+o+" += "+t+") {\n"+r+"}\n"),l},Blockly.PHP.controls_forEach=function(l){var e=Blockly.PHP.variableDB_.getName(l.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE),o=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_ASSIGNMENT)||"[]",P=Blockly.PHP.statementToCode(l,"DO");return"foreach ("+o+" as "+e+") {\n"+(P=Blockly.PHP.addLoopTrap(P,l.id))+"}\n"},Blockly.PHP.controls_flow_statements=function(l){switch(l.getFieldValue("FLOW")){case"BREAK":return"break;\n";case"CONTINUE":return"continue;\n"}throw"Unknown flow statement."},Blockly.PHP.math={},Blockly.PHP.math_number=function(l){return 1/0==(l=parseFloat(l.getFieldValue("NUM")))?l="INF":-1/0==l&&(l="-INF"),[l,Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.math_arithmetic=function(l){var e=(o={ADD:[" + ",Blockly.PHP.ORDER_ADDITION],MINUS:[" - ",Blockly.PHP.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.PHP.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.PHP.ORDER_DIVISION],POWER:[" ** ",Blockly.PHP.ORDER_POWER]}[l.getFieldValue("OP")])[0],o=o[1];return[(Blockly.PHP.valueToCode(l,"A",o)||"0")+e+(l=Blockly.PHP.valueToCode(l,"B",o)||"0"),o]},Blockly.PHP.math_single=function(l){var e,o=l.getFieldValue("OP");if("NEG"==o)return"-"==(l=Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_UNARY_NEGATION)||"0")[0]&&(l=" "+l),["-"+l,Blockly.PHP.ORDER_UNARY_NEGATION];switch(l="SIN"==o||"COS"==o||"TAN"==o?Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_DIVISION)||"0":Blockly.PHP.valueToCode(l,"NUM",Blockly.PHP.ORDER_NONE)||"0",o){case"ABS":e="abs("+l+")";break;case"ROOT":e="sqrt("+l+")";break;case"LN":e="log("+l+")";break;case"EXP":e="exp("+l+")";break;case"POW10":e="pow(10,"+l+")";break;case"ROUND":e="round("+l+")";break;case"ROUNDUP":e="ceil("+l+")";break;case"ROUNDDOWN":e="floor("+l+")";break;case"SIN":e="sin("+l+" / 180 * pi())";break;case"COS":e="cos("+l+" / 180 * pi())";break;case"TAN":e="tan("+l+" / 180 * pi())"}if(e)return[e,Blockly.PHP.ORDER_FUNCTION_CALL];switch(o){case"LOG10":e="log("+l+") / log(10)";break;case"ASIN":e="asin("+l+") / pi() * 180";break;case"ACOS":e="acos("+l+") / pi() * 180";break;case"ATAN":e="atan("+l+") / pi() * 180";break;default:throw"Unknown math operator: "+o}return[e,Blockly.PHP.ORDER_DIVISION]},Blockly.PHP.math_constant=function(l){return{PI:["M_PI",Blockly.PHP.ORDER_ATOMIC],E:["M_E",Blockly.PHP.ORDER_ATOMIC],GOLDEN_RATIO:["(1 + sqrt(5)) / 2",Blockly.PHP.ORDER_DIVISION],SQRT2:["M_SQRT2",Blockly.PHP.ORDER_ATOMIC],SQRT1_2:["M_SQRT1_2",Blockly.PHP.ORDER_ATOMIC],INFINITY:["INF",Blockly.PHP.ORDER_ATOMIC]}[l.getFieldValue("CONSTANT")]},Blockly.PHP.math_number_property=function(l){var e,o=Blockly.PHP.valueToCode(l,"NUMBER_TO_CHECK",Blockly.PHP.ORDER_MODULUS)||"0",P=l.getFieldValue("PROPERTY");if("PRIME"==P)return[Blockly.PHP.provideFunction_("math_isPrime",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if ($n == 2 || $n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (!is_numeric($n) || $n <= 1 || $n % 1 != 0 || $n % 2 == 0 || $n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for ($x = 6; $x <= sqrt($n) + 1; $x += 6) {","    if ($n % ($x - 1) == 0 || $n % ($x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+o+")",Blockly.JavaScript.ORDER_FUNCTION_CALL];switch(P){case"EVEN":e=o+" % 2 == 0";break;case"ODD":e=o+" % 2 == 1";break;case"WHOLE":e="is_int("+o+")";break;case"POSITIVE":e=o+" > 0";break;case"NEGATIVE":e=o+" < 0";break;case"DIVISIBLE_BY":e=o+" % "+(l=Blockly.PHP.valueToCode(l,"DIVISOR",Blockly.PHP.ORDER_MODULUS)||"0")+" == 0"}return[e,Blockly.PHP.ORDER_EQUALITY]},Blockly.PHP.math_change=function(l){var e=Blockly.PHP.valueToCode(l,"DELTA",Blockly.PHP.ORDER_ADDITION)||"0";return Blockly.PHP.variableDB_.getName(l.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE)+" += "+e+";\n"},Blockly.PHP.math_round=Blockly.PHP.math_single,Blockly.PHP.math_trig=Blockly.PHP.math_single,Blockly.PHP.math_on_list=function(l){var e=l.getFieldValue("OP");switch(e){case"SUM":l="array_sum("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MIN":l="min("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MAX":l="max("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"AVERAGE":l=(e=Blockly.PHP.provideFunction_("math_mean",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($myList) {","  return array_sum($myList) / count($myList);","}"]))+"("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"array()")+")";break;case"MEDIAN":l=(e=Blockly.PHP.provideFunction_("math_median",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($arr) {","  sort($arr,SORT_NUMERIC);","  return (count($arr) % 2) ? $arr[floor(count($arr)/2)] : ","      ($arr[floor(count($arr)/2)] + $arr[floor(count($arr)/2) - 1]) / 2;","}"]))+"("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;case"MODE":l=(e=Blockly.PHP.provideFunction_("math_modes",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($values) {","  if (empty($values)) return array();","  $counts = array_count_values($values);","  arsort($counts); // Sort counts in descending order","  $modes = array_keys($counts, current($counts), true);","  return $modes;","}"]))+"("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;case"STD_DEV":l=(e=Blockly.PHP.provideFunction_("math_standard_deviation",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($numbers) {","  $n = count($numbers);","  if (!$n) return null;","  $mean = array_sum($numbers) / count($numbers);","  foreach($numbers as $key => $num) $devs[$key] = pow($num - $mean, 2);","  return sqrt(array_sum($devs) / (count($devs) - 1));","}"]))+"("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;case"RANDOM":l=(e=Blockly.PHP.provideFunction_("math_random_list",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  $x = rand(0, count($list)-1);","  return $list[$x];","}"]))+"("+(l=Blockly.PHP.valueToCode(l,"LIST",Blockly.PHP.ORDER_NONE)||"[]")+")";break;default:throw"Unknown operator: "+e}return[l,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_modulo=function(l){return[(Blockly.PHP.valueToCode(l,"DIVIDEND",Blockly.PHP.ORDER_MODULUS)||"0")+" % "+(l=Blockly.PHP.valueToCode(l,"DIVISOR",Blockly.PHP.ORDER_MODULUS)||"0"),Blockly.PHP.ORDER_MODULUS]},Blockly.PHP.math_constrain=function(l){return["min(max("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_COMMA)||"0")+", "+(Blockly.PHP.valueToCode(l,"LOW",Blockly.PHP.ORDER_COMMA)||"0")+"), "+(l=Blockly.PHP.valueToCode(l,"HIGH",Blockly.PHP.ORDER_COMMA)||"Infinity")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_random_int=function(l){var e=Blockly.PHP.valueToCode(l,"FROM",Blockly.PHP.ORDER_COMMA)||"0";return l=Blockly.PHP.valueToCode(l,"TO",Blockly.PHP.ORDER_COMMA)||"0",[Blockly.PHP.provideFunction_("math_random_int",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($a, $b) {","  if ($a > $b) {","    return rand($b, $a);","  }","  return rand($a, $b);","}"])+"("+e+", "+l+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.math_random_float=function(l){return["(float)rand()/(float)getrandmax()",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.procedures={},Blockly.PHP.procedures_defreturn=function(l){for(var e=(P=l.workspace.variableList).length-1;0<=e;e--){var o=P[e];-1==l.arguments_.indexOf(o)?P[e]=Blockly.PHP.variableDB_.getName(o,Blockly.Variables.NAME_TYPE):P.splice(e,1)}var P=P.length?"  global "+P.join(", ")+";\n":"",o=Blockly.PHP.variableDB_.getName(l.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE),t=Blockly.PHP.statementToCode(l,"STACK");Blockly.PHP.STATEMENT_PREFIX&&(t=Blockly.PHP.prefixLines(Blockly.PHP.STATEMENT_PREFIX.replace(/%1/g,"'"+l.id+"'"),Blockly.PHP.INDENT)+t),Blockly.PHP.INFINITE_LOOP_TRAP&&(t=Blockly.PHP.INFINITE_LOOP_TRAP.replace(/%1/g,"'"+l.id+"'")+t);for(var c=(c=Blockly.PHP.valueToCode(l,"RETURN",Blockly.PHP.ORDER_NONE)||"")&&"  return "+c+";\n",r=[],e=0;e<l.arguments_.length;e++)r[e]=Blockly.PHP.variableDB_.getName(l.arguments_[e],Blockly.Variables.NAME_TYPE);return P="function "+o+"("+r.join(", ")+") {\n"+P+t+c+"}",P=Blockly.PHP.scrub_(l,P),Blockly.PHP.definitions_["%"+o]=P,null},Blockly.PHP.procedures_defnoreturn=Blockly.PHP.procedures_defreturn,Blockly.PHP.procedures_callreturn=function(l){for(var e=Blockly.PHP.variableDB_.getName(l.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE),o=[],P=0;P<l.arguments_.length;P++)o[P]=Blockly.PHP.valueToCode(l,"ARG"+P,Blockly.PHP.ORDER_COMMA)||"null";return[e+"("+o.join(", ")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.procedures_callnoreturn=function(l){for(var e=Blockly.PHP.variableDB_.getName(l.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE),o=[],P=0;P<l.arguments_.length;P++)o[P]=Blockly.PHP.valueToCode(l,"ARG"+P,Blockly.PHP.ORDER_COMMA)||"null";return e+"("+o.join(", ")+");\n"},Blockly.PHP.procedures_ifreturn=function(l){var e="if ("+(Blockly.PHP.valueToCode(l,"CONDITION",Blockly.PHP.ORDER_NONE)||"false")+") {\n";return l.hasReturnValue_?e+="  return "+(l=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"null")+";\n":e+="  return;\n",e+"}\n"},Blockly.PHP.texts={},Blockly.PHP.text=function(l){return[Blockly.PHP.quote_(l.getFieldValue("TEXT")),Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.text_join=function(l){if(0==l.itemCount_)return["''",Blockly.PHP.ORDER_ATOMIC];if(1==l.itemCount_)return[Blockly.PHP.valueToCode(l,"ADD0",Blockly.PHP.ORDER_NONE)||"''",Blockly.PHP.ORDER_FUNCTION_CALL];if(2==l.itemCount_)return[(e=Blockly.PHP.valueToCode(l,"ADD0",Blockly.PHP.ORDER_NONE)||"''")+" . "+(l=Blockly.PHP.valueToCode(l,"ADD1",Blockly.PHP.ORDER_NONE)||"''"),Blockly.PHP.ORDER_ADDITION];for(var e=Array(l.itemCount_),o=0;o<l.itemCount_;o++)e[o]=Blockly.PHP.valueToCode(l,"ADD"+o,Blockly.PHP.ORDER_COMMA)||"''";return[l="implode('', array("+e.join(",")+"))",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_append=function(l){return Blockly.PHP.variableDB_.getName(l.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE)+" .= "+(l=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_ASSIGNMENT)||"''")+";\n"},Blockly.PHP.text_length=function(l){return[Blockly.PHP.provideFunction_("length",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(l=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_isEmpty=function(l){return["empty("+(Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_indexOf=function(l){var e,o="FIRST"==l.getFieldValue("END")?"strpos":"strrpos",P=Blockly.PHP.valueToCode(l,"FIND",Blockly.PHP.ORDER_NONE)||"''",t=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_NONE)||"''",c=Blockly.PHP.ONE_BASED_INDEXING?(e=" 0"," + 1"):(e=" -1","");return[Blockly.PHP.provideFunction_("FIRST"==l.getFieldValue("END")?"text_indexOf":"text_lastIndexOf",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $search) {","  $pos = "+o+"($text, $search);","  return $pos === false ? "+e+" : $pos"+c+";","}"])+"("+t+", "+P+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_charAt=function(l){var e=l.getFieldValue("WHERE")||"FROM_START",o=Blockly.PHP.valueToCode(l,"VALUE","RANDOM"==e?Blockly.PHP.ORDER_NONE:Blockly.PHP.ORDER_COMMA)||"''";switch(e){case"FIRST":return["substr("+o+", 0, 1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"LAST":return["substr("+o+", -1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"FROM_START":return["substr("+o+", "+(l=Blockly.PHP.getAdjusted(l,"AT"))+", 1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"FROM_END":return["substr("+o+", "+(l=Blockly.PHP.getAdjusted(l,"AT",1,!0))+", 1)",Blockly.PHP.ORDER_FUNCTION_CALL];case"RANDOM":return[Blockly.PHP.provideFunction_("text_random_letter",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text) {","  return $text[rand(0, strlen($text) - 1)];","}"])+"("+o+")",Blockly.PHP.ORDER_FUNCTION_CALL]}throw"Unhandled option (text_charAt)."},Blockly.PHP.text_getSubstring=function(l){var e,o=Blockly.PHP.valueToCode(l,"STRING",Blockly.PHP.ORDER_FUNCTION_CALL)||"''",P=l.getFieldValue("WHERE1"),t=l.getFieldValue("WHERE2");return"FIRST"==P&&"LAST"==t||(e=Blockly.PHP.getAdjusted(l,"AT1"),l=Blockly.PHP.getAdjusted(l,"AT2"),o=Blockly.PHP.provideFunction_("text_get_substring",["function "+Blockly.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = strlen($text) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START'){","    throw new Exception('Unhandled option (text_get_substring).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = strlen($text) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = strlen($text) - $at1;","  } else {","    throw new Exception('Unhandled option (text_get_substring).');","  }","  return substr($text, $at1, $length);","}"])+"("+o+", '"+P+"', "+e+", '"+t+"', "+l+")"),[o,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_changeCase=function(l){var e,o=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''";return"UPPERCASE"==l.getFieldValue("CASE")?e="strtoupper("+o+")":"LOWERCASE"==l.getFieldValue("CASE")?e="strtolower("+o+")":"TITLECASE"==l.getFieldValue("CASE")&&(e="ucwords(strtolower("+o+"))"),[e,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_trim=function(l){return[{LEFT:"ltrim",RIGHT:"rtrim",BOTH:"trim"}[l.getFieldValue("MODE")]+"("+(l=Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''")+")",Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_print=function(l){return"print("+(Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''")+");\n"},Blockly.PHP.text_prompt_ext=function(l){var e="readline("+(l.getField("TEXT")?Blockly.PHP.quote_(l.getFieldValue("TEXT")):Blockly.PHP.valueToCode(l,"TEXT",Blockly.PHP.ORDER_NONE)||"''")+")";return"NUMBER"==l.getFieldValue("TYPE")&&(e="floatval("+e+")"),[e,Blockly.PHP.ORDER_FUNCTION_CALL]},Blockly.PHP.text_prompt=Blockly.PHP.text_prompt_ext,Blockly.PHP.variables={},Blockly.PHP.variables_get=function(l){return[Blockly.PHP.variableDB_.getName(l.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE),Blockly.PHP.ORDER_ATOMIC]},Blockly.PHP.variables_set=function(l){var e=Blockly.PHP.valueToCode(l,"VALUE",Blockly.PHP.ORDER_ASSIGNMENT)||"0";return Blockly.PHP.variableDB_.getName(l.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE)+" = "+e+";\n"};