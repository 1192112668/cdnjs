!function(e,P){"function"==typeof define&&define.amd?define(["./core"],P):"object"==typeof exports?module.exports=P(require("./core")):e.Blockly.PHP=P(e.Blockly)}(this,function(i){"use strict";return i.PHP=new i.Generator("PHP"),i.PHP.addReservedWords("__halt_compiler,abstract,and,array,as,break,callable,case,catch,class,clone,const,continue,declare,default,die,do,echo,else,elseif,empty,enddeclare,endfor,endforeach,endif,endswitch,endwhile,eval,exit,extends,final,for,foreach,function,global,goto,if,implements,include,include_once,instanceof,insteadof,interface,isset,list,namespace,new,or,print,private,protected,public,require,require_once,return,static,switch,throw,trait,try,unset,use,var,while,xor,PHP_VERSION,PHP_MAJOR_VERSION,PHP_MINOR_VERSION,PHP_RELEASE_VERSION,PHP_VERSION_ID,PHP_EXTRA_VERSION,PHP_ZTS,PHP_DEBUG,PHP_MAXPATHLEN,PHP_OS,PHP_SAPI,PHP_EOL,PHP_INT_MAX,PHP_INT_SIZE,DEFAULT_INCLUDE_PATH,PEAR_INSTALL_DIR,PEAR_EXTENSION_DIR,PHP_EXTENSION_DIR,PHP_PREFIX,PHP_BINDIR,PHP_BINARY,PHP_MANDIR,PHP_LIBDIR,PHP_DATADIR,PHP_SYSCONFDIR,PHP_LOCALSTATEDIR,PHP_CONFIG_FILE_PATH,PHP_CONFIG_FILE_SCAN_DIR,PHP_SHLIB_SUFFIX,E_ERROR,E_WARNING,E_PARSE,E_NOTICE,E_CORE_ERROR,E_CORE_WARNING,E_COMPILE_ERROR,E_COMPILE_WARNING,E_USER_ERROR,E_USER_WARNING,E_USER_NOTICE,E_DEPRECATED,E_USER_DEPRECATED,E_ALL,E_STRICT,__COMPILER_HALT_OFFSET__,TRUE,FALSE,NULL,__CLASS__,__DIR__,__FILE__,__FUNCTION__,__LINE__,__METHOD__,__NAMESPACE__,__TRAIT__"),i.PHP.ORDER_ATOMIC=0,i.PHP.ORDER_CLONE=1,i.PHP.ORDER_NEW=1,i.PHP.ORDER_MEMBER=2.1,i.PHP.ORDER_FUNCTION_CALL=2.2,i.PHP.ORDER_POWER=3,i.PHP.ORDER_INCREMENT=4,i.PHP.ORDER_DECREMENT=4,i.PHP.ORDER_BITWISE_NOT=4,i.PHP.ORDER_CAST=4,i.PHP.ORDER_SUPPRESS_ERROR=4,i.PHP.ORDER_INSTANCEOF=5,i.PHP.ORDER_LOGICAL_NOT=6,i.PHP.ORDER_UNARY_PLUS=7.1,i.PHP.ORDER_UNARY_NEGATION=7.2,i.PHP.ORDER_MULTIPLICATION=8.1,i.PHP.ORDER_DIVISION=8.2,i.PHP.ORDER_MODULUS=8.3,i.PHP.ORDER_ADDITION=9.1,i.PHP.ORDER_SUBTRACTION=9.2,i.PHP.ORDER_STRING_CONCAT=9.3,i.PHP.ORDER_BITWISE_SHIFT=10,i.PHP.ORDER_RELATIONAL=11,i.PHP.ORDER_EQUALITY=12,i.PHP.ORDER_REFERENCE=13,i.PHP.ORDER_BITWISE_AND=13,i.PHP.ORDER_BITWISE_XOR=14,i.PHP.ORDER_BITWISE_OR=15,i.PHP.ORDER_LOGICAL_AND=16,i.PHP.ORDER_LOGICAL_OR=17,i.PHP.ORDER_IF_NULL=18,i.PHP.ORDER_CONDITIONAL=19,i.PHP.ORDER_ASSIGNMENT=20,i.PHP.ORDER_LOGICAL_AND_WEAK=21,i.PHP.ORDER_LOGICAL_XOR=22,i.PHP.ORDER_LOGICAL_OR_WEAK=23,i.PHP.ORDER_COMMA=24,i.PHP.ORDER_NONE=99,i.PHP.ORDER_OVERRIDES=[[i.PHP.ORDER_MEMBER,i.PHP.ORDER_FUNCTION_CALL],[i.PHP.ORDER_MEMBER,i.PHP.ORDER_MEMBER],[i.PHP.ORDER_LOGICAL_NOT,i.PHP.ORDER_LOGICAL_NOT],[i.PHP.ORDER_MULTIPLICATION,i.PHP.ORDER_MULTIPLICATION],[i.PHP.ORDER_ADDITION,i.PHP.ORDER_ADDITION],[i.PHP.ORDER_LOGICAL_AND,i.PHP.ORDER_LOGICAL_AND],[i.PHP.ORDER_LOGICAL_OR,i.PHP.ORDER_LOGICAL_OR]],i.PHP.init=function(e){i.PHP.definitions_=Object.create(null),i.PHP.functionNames_=Object.create(null),i.PHP.variableDB_?i.PHP.variableDB_.reset():i.PHP.variableDB_=new i.Names(i.PHP.RESERVED_WORDS_,"$"),i.PHP.variableDB_.setVariableMap(e.getVariableMap());for(var P=[],t=i.Variables.allDeveloperVariables(e),r=0;r<t.length;r++)P.push(i.PHP.variableDB_.getName(t[r],i.Names.DEVELOPER_VARIABLE_TYPE)+";");for(e=i.Variables.allUsedVarModels(e),r=0;t=e[r];r++)P.push(i.PHP.variableDB_.getName(t.getId(),i.Variables.NAME_TYPE)+";");i.PHP.definitions_.variables=P.join("\n")},i.PHP.finish=function(e){var P,t=[];for(P in i.PHP.definitions_)t.push(i.PHP.definitions_[P]);return delete i.PHP.definitions_,delete i.PHP.functionNames_,i.PHP.variableDB_.reset(),t.join("\n\n")+"\n\n\n"+e},i.PHP.scrubNakedValue=function(e){return e+";\n"},i.PHP.quote_=function(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"},i.PHP.multiline_quote_=function(e){return"<<<EOT\n"+e+"\nEOT"},i.PHP.scrub_=function(e,P,t){var r="";if(!e.outputConnection||!e.outputConnection.targetConnection){var n=e.getCommentText();n&&(n=i.utils.string.wrap(n,i.PHP.COMMENT_WRAP-3),r+=i.PHP.prefixLines(n,"// ")+"\n");for(var a=0;a<e.inputList.length;a++)e.inputList[a].type==i.INPUT_VALUE&&(n=e.inputList[a].connection.targetBlock())&&(n=i.PHP.allNestedComments(n))&&(r+=i.PHP.prefixLines(n,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),r+P+(t=t?"":i.PHP.blockToCode(e))},i.PHP.getAdjusted=function(e,P,t,r,n){t=t||0,n=n||i.PHP.ORDER_NONE,e.workspace.options.oneBasedIndex&&t--;var a,_=e.workspace.options.oneBasedIndex?"1":"0";return e=0<t?i.PHP.valueToCode(e,P,i.PHP.ORDER_ADDITION)||_:t<0?i.PHP.valueToCode(e,P,i.PHP.ORDER_SUBTRACTION)||_:r?i.PHP.valueToCode(e,P,i.PHP.ORDER_UNARY_NEGATION)||_:i.PHP.valueToCode(e,P,n)||_,i.isNumber(e)?(e=Number(e)+t,r&&(e=-e)):(0<t?(e=e+" + "+t,a=i.PHP.ORDER_ADDITION):t<0&&(e=e+" - "+-t,a=i.PHP.ORDER_SUBTRACTION),r&&(e=t?"-("+e+")":"-"+e,a=i.PHP.ORDER_UNARY_NEGATION),a=Math.floor(a),n=Math.floor(n),a&&a<=n&&(e="("+e+")")),e},i.PHP.colour={},i.PHP.colour_picker=function(e){return[i.PHP.quote_(e.getFieldValue("COLOUR")),i.PHP.ORDER_ATOMIC]},i.PHP.colour_random=function(e){return[i.PHP.provideFunction_("colour_random",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"() {","  return '#' . str_pad(dechex(mt_rand(0, 0xFFFFFF)), 6, '0', STR_PAD_LEFT);","}"])+"()",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.colour_rgb=function(e){var P=i.PHP.valueToCode(e,"RED",i.PHP.ORDER_COMMA)||0,t=i.PHP.valueToCode(e,"GREEN",i.PHP.ORDER_COMMA)||0;return e=i.PHP.valueToCode(e,"BLUE",i.PHP.ORDER_COMMA)||0,[i.PHP.provideFunction_("colour_rgb",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($r, $g, $b) {","  $r = round(max(min($r, 100), 0) * 2.55);","  $g = round(max(min($g, 100), 0) * 2.55);","  $b = round(max(min($b, 100), 0) * 2.55);","  $hex = '#';","  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);","  return $hex;","}"])+"("+P+", "+t+", "+e+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.colour_blend=function(e){var P=i.PHP.valueToCode(e,"COLOUR1",i.PHP.ORDER_COMMA)||"'#000000'",t=i.PHP.valueToCode(e,"COLOUR2",i.PHP.ORDER_COMMA)||"'#000000'";return e=i.PHP.valueToCode(e,"RATIO",i.PHP.ORDER_COMMA)||.5,[i.PHP.provideFunction_("colour_blend",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($c1, $c2, $ratio) {","  $ratio = max(min($ratio, 1), 0);","  $r1 = hexdec(substr($c1, 1, 2));","  $g1 = hexdec(substr($c1, 3, 2));","  $b1 = hexdec(substr($c1, 5, 2));","  $r2 = hexdec(substr($c2, 1, 2));","  $g2 = hexdec(substr($c2, 3, 2));","  $b2 = hexdec(substr($c2, 5, 2));","  $r = round($r1 * (1 - $ratio) + $r2 * $ratio);","  $g = round($g1 * (1 - $ratio) + $g2 * $ratio);","  $b = round($b1 * (1 - $ratio) + $b2 * $ratio);","  $hex = '#';","  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);","  return $hex;","}"])+"("+P+", "+t+", "+e+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists={},i.PHP.lists_create_empty=function(e){return["array()",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_create_with=function(e){for(var P=Array(e.itemCount_),t=0;t<e.itemCount_;t++)P[t]=i.PHP.valueToCode(e,"ADD"+t,i.PHP.ORDER_COMMA)||"null";return[P="array("+P.join(", ")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_repeat=function(e){return[i.PHP.provideFunction_("lists_repeat",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value, $count) {","  $array = array();","  for ($index = 0; $index < $count; $index++) {","    $array[] = $value;","  }","  return $array;","}"])+"("+(i.PHP.valueToCode(e,"ITEM",i.PHP.ORDER_COMMA)||"null")+", "+(e=i.PHP.valueToCode(e,"NUM",i.PHP.ORDER_COMMA)||"0")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_length=function(e){return[i.PHP.provideFunction_("length",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(e=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"''")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_isEmpty=function(e){return["empty("+(i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_FUNCTION_CALL)||"array()")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_indexOf=function(e){var P,t=i.PHP.valueToCode(e,"FIND",i.PHP.ORDER_NONE)||"''",r=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_MEMBER)||"[]",n=e.workspace.options.oneBasedIndex?(P=" 0"," + 1"):(P=" -1","");return[("FIRST"==e.getFieldValue("END")?i.PHP.provideFunction_("indexOf",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) return $index"+n+";","  }","  return "+P+";","}"]):i.PHP.provideFunction_("lastIndexOf",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  $last = "+P+";","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) $last = $index"+n+";","  }","  return $last;","}"]))+"("+r+", "+t+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_getIndex=function(e){var P=e.getFieldValue("MODE")||"GET";switch(e.getFieldValue("WHERE")||"FROM_START"){case"FIRST":if("GET"==P){var t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_MEMBER)||"array()";return[t+"[0]",i.PHP.ORDER_MEMBER]}if("GET_REMOVE"==P)return["array_shift("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()")+")",i.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==P)return"array_shift("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()")+");\n";break;case"LAST":if("GET"==P)return["end("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()")+")",i.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==P)return["array_pop("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()")+")",i.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==P)return"array_pop("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()")+");\n";break;case"FROM_START":var r=i.PHP.getAdjusted(e,"AT");if("GET"==P)return[(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_MEMBER)||"array()")+"["+r+"]",i.PHP.ORDER_MEMBER];if("GET_REMOVE"==P)return["array_splice("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_COMMA)||"array()")+", "+r+", 1)[0]",i.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==P)return"array_splice("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_COMMA)||"array()")+", "+r+", 1);\n";break;case"FROM_END":if("GET"==P)return["array_slice("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_COMMA)||"array()")+", "+(r=i.PHP.getAdjusted(e,"AT",1,!0))+", 1)[0]",i.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==P||"REMOVE"==P){if(t="array_splice("+(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()")+", count("+t+") - "+(r=i.PHP.getAdjusted(e,"AT",1,!1,i.PHP.ORDER_SUBTRACTION))+", 1)[0]","GET_REMOVE"==P)return[t,i.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==P)return t+";\n"}break;case"RANDOM":if(t=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"array()","GET"==P)return[(P=i.PHP.provideFunction_("lists_get_random_item",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  return $list[rand(0,count($list)-1)];","}"]))+"("+t+")",i.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==P)return[(P=i.PHP.provideFunction_("lists_get_remove_random_item",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  $x = rand(0,count($list)-1);","  unset($list[$x]);","  return array_values($list);","}"]))+"("+t+")",i.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==P)return(P=i.PHP.provideFunction_("lists_remove_random_item",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  unset($list[rand(0,count($list)-1)]);","}"]))+"("+t+");\n"}throw Error("Unhandled combination (lists_getIndex).")},i.PHP.lists_setIndex=function(e){var P=e.getFieldValue("MODE")||"GET",t=e.getFieldValue("WHERE")||"FROM_START",r=i.PHP.valueToCode(e,"TO",i.PHP.ORDER_ASSIGNMENT)||"null";switch(t){case"FIRST":if("SET"==P)return(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_MEMBER)||"array()")+"[0] = "+r+";\n";if("INSERT"==P)return"array_unshift("+(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"array()")+", "+r+");\n";break;case"LAST":if(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"array()","SET"==P)return(P=i.PHP.provideFunction_("lists_set_last_item",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $value) {","  $list[count($list) - 1] = $value;","}"]))+"("+t+", "+r+");\n";if("INSERT"==P)return"array_push("+t+", "+r+");\n";break;case"FROM_START":var n=i.PHP.getAdjusted(e,"AT");if("SET"==P)return(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_MEMBER)||"array()")+"["+n+"] = "+r+";\n";if("INSERT"==P)return"array_splice("+(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"array()")+", "+n+", 0, "+r+");\n";break;case"FROM_END":if(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"array()",n=i.PHP.getAdjusted(e,"AT",1),"SET"==P)return(P=i.PHP.provideFunction_("lists_set_from_end",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  $list[count($list) - $at] = $value;","}"]))+"("+t+", "+n+", "+r+");\n";if("INSERT"==P)return(P=i.PHP.provideFunction_("lists_insert_from_end",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  return array_splice($list, count($list) - $at, 0, $value);","}"]))+"("+t+", "+n+", "+r+");\n";break;case"RANDOM":if(e=(t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_REFERENCE)||"array()").match(/^\$\w+$/)?"":(n=(e=i.PHP.variableDB_.getDistinctName("tmp_list",i.Variables.NAME_TYPE))+" = &"+t+";\n",t=e,n),e+=(n=i.PHP.variableDB_.getDistinctName("tmp_x",i.Variables.NAME_TYPE))+" = rand(0, count("+t+")-1);\n","SET"==P)return e+(t+"[")+n+"] = "+r+";\n";if("INSERT"==P)return e+"array_splice("+t+", "+n+", 0, "+r+");\n"}throw Error("Unhandled combination (lists_setIndex).")},i.PHP.lists_getSublist=function(e){var P=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"array()",t=e.getFieldValue("WHERE1"),r=e.getFieldValue("WHERE2");if("FIRST"!=t||"LAST"!=r)if(P.match(/^\$\w+$/)||"FROM_END"!=t&&"FROM_START"==r){switch(t){case"FROM_START":var n=i.PHP.getAdjusted(e,"AT1");break;case"FROM_END":n="count("+P+") - "+(n=i.PHP.getAdjusted(e,"AT1",1,!1,i.PHP.ORDER_SUBTRACTION));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":t=(e=i.PHP.getAdjusted(e,"AT2",0,!1,i.PHP.ORDER_SUBTRACTION))+" - ",t=i.isNumber(String(n))||String(n).match(/^\(.+\)$/)?t+n:t+"("+n+")",t+=" + 1";break;case"FROM_END":t="count("+P+") - "+(e=i.PHP.getAdjusted(e,"AT2",0,!1,i.PHP.ORDER_SUBTRACTION))+" - ",t=i.isNumber(String(n))||String(n).match(/^\(.+\)$/)?t+n:t+"("+n+")";break;case"LAST":t="count("+P+") - ",t=i.isNumber(String(n))||String(n).match(/^\(.+\)$/)?t+n:t+"("+n+")";break;default:throw Error("Unhandled option (lists_getSublist).")}P="array_slice("+P+", "+n+", "+t+")"}else n=i.PHP.getAdjusted(e,"AT1"),e=i.PHP.getAdjusted(e,"AT2"),P=i.PHP.provideFunction_("lists_get_sublist",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = count($list) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START') {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = count($list) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = count($list) - $at1;","  } else {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  return array_slice($list, $at1, $length);","}"])+"("+P+", '"+t+"', "+n+", '"+r+"', "+e+")";return[P,i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_sort=function(e){var P=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"array()",t="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[i.PHP.provideFunction_("lists_sort",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $type, $direction) {","  $sortCmpFuncs = array(",'    "NUMERIC" => "strnatcasecmp",','    "TEXT" => "strcmp",','    "IGNORE_CASE" => "strcasecmp"',"  );","  $sortCmp = $sortCmpFuncs[$type];","  $list2 = $list;","  usort($list2, $sortCmp);","  if ($direction == -1) {","    $list2 = array_reverse($list2);","  }","  return $list2;","}"])+"("+P+', "'+e+'", '+t+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_split=function(e){var P=i.PHP.valueToCode(e,"INPUT",i.PHP.ORDER_COMMA),t=i.PHP.valueToCode(e,"DELIM",i.PHP.ORDER_COMMA)||"''";if("SPLIT"==(e=e.getFieldValue("MODE")))P=P||"''",e="explode";else{if("JOIN"!=e)throw Error("Unknown mode: "+e);P=P||"array()",e="implode"}return[e+"("+t+", "+P+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.lists_reverse=function(e){return["array_reverse("+(i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_COMMA)||"[]")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.logic={},i.PHP.controls_if=function(e){var P=0,t="";i.PHP.STATEMENT_PREFIX&&(t+=i.PHP.injectId(i.PHP.STATEMENT_PREFIX,e));do{var r=i.PHP.valueToCode(e,"IF"+P,i.PHP.ORDER_NONE)||"false",n=i.PHP.statementToCode(e,"DO"+P);i.PHP.STATEMENT_SUFFIX&&(n=i.PHP.prefixLines(i.PHP.injectId(i.PHP.STATEMENT_SUFFIX,e),i.PHP.INDENT)+n),t+=(0<P?" else ":"")+"if ("+r+") {\n"+n+"}",++P}while(e.getInput("IF"+P));return(e.getInput("ELSE")||i.PHP.STATEMENT_SUFFIX)&&(n=i.PHP.statementToCode(e,"ELSE"),i.PHP.STATEMENT_SUFFIX&&(n=i.PHP.prefixLines(i.PHP.injectId(i.PHP.STATEMENT_SUFFIX,e),i.PHP.INDENT)+n),t+=" else {\n"+n+"}"),t+"\n"},i.PHP.controls_ifelse=i.PHP.controls_if,i.PHP.logic_compare=function(e){var P={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],t="=="==P||"!="==P?i.PHP.ORDER_EQUALITY:i.PHP.ORDER_RELATIONAL;return[(i.PHP.valueToCode(e,"A",t)||"0")+" "+P+" "+(e=i.PHP.valueToCode(e,"B",t)||"0"),t]},i.PHP.logic_operation=function(e){var P,t="AND"==e.getFieldValue("OP")?"&&":"||",r="&&"==t?i.PHP.ORDER_LOGICAL_AND:i.PHP.ORDER_LOGICAL_OR,n=i.PHP.valueToCode(e,"A",r);return e=i.PHP.valueToCode(e,"B",r),e=n||e?(P="&&"==t?"true":"false",n=n||P,e||P):n="false",[n+" "+t+" "+e,r]},i.PHP.logic_negate=function(e){var P=i.PHP.ORDER_LOGICAL_NOT;return["!"+(i.PHP.valueToCode(e,"BOOL",P)||"true"),P]},i.PHP.logic_boolean=function(e){return["TRUE"==e.getFieldValue("BOOL")?"true":"false",i.PHP.ORDER_ATOMIC]},i.PHP.logic_null=function(e){return["null",i.PHP.ORDER_ATOMIC]},i.PHP.logic_ternary=function(e){return[(i.PHP.valueToCode(e,"IF",i.PHP.ORDER_CONDITIONAL)||"false")+" ? "+(i.PHP.valueToCode(e,"THEN",i.PHP.ORDER_CONDITIONAL)||"null")+" : "+(e=i.PHP.valueToCode(e,"ELSE",i.PHP.ORDER_CONDITIONAL)||"null"),i.PHP.ORDER_CONDITIONAL]},i.PHP.loops={},i.PHP.controls_repeat_ext=function(e){var P=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.PHP.valueToCode(e,"TIMES",i.PHP.ORDER_ASSIGNMENT)||"0",t=i.PHP.statementToCode(e,"DO"),t=i.PHP.addLoopTrap(t,e);e="";var r=i.PHP.variableDB_.getDistinctName("count",i.Variables.NAME_TYPE),n=P;return P.match(/^\w+$/)||i.isNumber(P)||(e+=(n=i.PHP.variableDB_.getDistinctName("repeat_end",i.Variables.NAME_TYPE))+" = "+P+";\n"),e+"for ("+r+" = 0; "+r+" < "+n+"; "+r+"++) {\n"+t+"}\n"},i.PHP.controls_repeat=i.PHP.controls_repeat_ext,i.PHP.controls_whileUntil=function(e){var P="UNTIL"==e.getFieldValue("MODE"),t=i.PHP.valueToCode(e,"BOOL",P?i.PHP.ORDER_LOGICAL_NOT:i.PHP.ORDER_NONE)||"false",r=i.PHP.statementToCode(e,"DO");return P&&(t="!"+t),"while ("+t+") {\n"+(r=i.PHP.addLoopTrap(r,e))+"}\n"},i.PHP.controls_for=function(e){var P,t=i.PHP.variableDB_.getName(e.getFieldValue("VAR"),i.Variables.NAME_TYPE),r=i.PHP.valueToCode(e,"FROM",i.PHP.ORDER_ASSIGNMENT)||"0",n=i.PHP.valueToCode(e,"TO",i.PHP.ORDER_ASSIGNMENT)||"0",a=i.PHP.valueToCode(e,"BY",i.PHP.ORDER_ASSIGNMENT)||"1",_=i.PHP.statementToCode(e,"DO"),_=i.PHP.addLoopTrap(_,e);return i.isNumber(r)&&i.isNumber(n)&&i.isNumber(a)?(e="for ("+t+" = "+r+"; "+t+((P=Number(r)<=Number(n))?" <= ":" >= ")+n+"; "+t,e=(1==(t=Math.abs(Number(a)))?e+(P?"++":"--"):e+(P?" += ":" -= ")+t)+") {\n"+_+"}\n"):(e="",(P=r).match(/^\w+$/)||i.isNumber(r)||(e+=(P=i.PHP.variableDB_.getDistinctName(t+"_start",i.Variables.NAME_TYPE))+" = "+r+";\n"),(r=n).match(/^\w+$/)||i.isNumber(n)||(e+=(r=i.PHP.variableDB_.getDistinctName(t+"_end",i.Variables.NAME_TYPE))+" = "+n+";\n"),e+=(n=i.PHP.variableDB_.getDistinctName(t+"_inc",i.Variables.NAME_TYPE))+" = ",e=(e=i.isNumber(a)?e+(Math.abs(a)+";\n"):e+"abs("+a+");\n")+"if ("+P+" > "+r+") {\n"+(i.PHP.INDENT+n)+" = -"+n+";\n",e+="}\n",e+="for ("+t+" = "+P+"; "+n+" >= 0 ? "+t+" <= "+r+" : "+t+" >= "+r+"; "+t+" += "+n+") {\n"+_+"}\n"),e},i.PHP.controls_forEach=function(e){var P=i.PHP.variableDB_.getName(e.getFieldValue("VAR"),i.Variables.NAME_TYPE),t=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_ASSIGNMENT)||"[]",r=i.PHP.statementToCode(e,"DO");return"foreach ("+t+" as "+P+") {\n"+(r=i.PHP.addLoopTrap(r,e))+"}\n"},i.PHP.controls_flow_statements=function(e){var P,t="";switch(i.PHP.STATEMENT_PREFIX&&(t+=i.PHP.injectId(i.PHP.STATEMENT_PREFIX,e)),i.PHP.STATEMENT_SUFFIX&&(t+=i.PHP.injectId(i.PHP.STATEMENT_SUFFIX,e)),!i.PHP.STATEMENT_PREFIX||(P=i.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(e))&&!P.suppressPrefixSuffix&&(t+=i.PHP.injectId(i.PHP.STATEMENT_PREFIX,P)),e.getFieldValue("FLOW")){case"BREAK":return t+"break;\n";case"CONTINUE":return t+"continue;\n"}throw Error("Unknown flow statement.")},i.PHP.math={},i.PHP.math_number=function(e){var P=0<=(e=Number(e.getFieldValue("NUM")))?i.PHP.ORDER_ATOMIC:i.PHP.ORDER_UNARY_NEGATION;return 1/0==e?e="INF":-1/0==e&&(e="-INF"),[e,P]},i.PHP.math_arithmetic=function(e){var P=(t={ADD:[" + ",i.PHP.ORDER_ADDITION],MINUS:[" - ",i.PHP.ORDER_SUBTRACTION],MULTIPLY:[" * ",i.PHP.ORDER_MULTIPLICATION],DIVIDE:[" / ",i.PHP.ORDER_DIVISION],POWER:[" ** ",i.PHP.ORDER_POWER]}[e.getFieldValue("OP")])[0],t=t[1];return[(i.PHP.valueToCode(e,"A",t)||"0")+P+(e=i.PHP.valueToCode(e,"B",t)||"0"),t]},i.PHP.math_single=function(e){var P=e.getFieldValue("OP");if("NEG"==P)return"-"==(e=i.PHP.valueToCode(e,"NUM",i.PHP.ORDER_UNARY_NEGATION)||"0")[0]&&(e=" "+e),["-"+e,i.PHP.ORDER_UNARY_NEGATION];switch(e="SIN"==P||"COS"==P||"TAN"==P?i.PHP.valueToCode(e,"NUM",i.PHP.ORDER_DIVISION)||"0":i.PHP.valueToCode(e,"NUM",i.PHP.ORDER_NONE)||"0",P){case"ABS":var t="abs("+e+")";break;case"ROOT":t="sqrt("+e+")";break;case"LN":t="log("+e+")";break;case"EXP":t="exp("+e+")";break;case"POW10":t="pow(10,"+e+")";break;case"ROUND":t="round("+e+")";break;case"ROUNDUP":t="ceil("+e+")";break;case"ROUNDDOWN":t="floor("+e+")";break;case"SIN":t="sin("+e+" / 180 * pi())";break;case"COS":t="cos("+e+" / 180 * pi())";break;case"TAN":t="tan("+e+" / 180 * pi())"}if(t)return[t,i.PHP.ORDER_FUNCTION_CALL];switch(P){case"LOG10":t="log("+e+") / log(10)";break;case"ASIN":t="asin("+e+") / pi() * 180";break;case"ACOS":t="acos("+e+") / pi() * 180";break;case"ATAN":t="atan("+e+") / pi() * 180";break;default:throw Error("Unknown math operator: "+P)}return[t,i.PHP.ORDER_DIVISION]},i.PHP.math_constant=function(e){return{PI:["M_PI",i.PHP.ORDER_ATOMIC],E:["M_E",i.PHP.ORDER_ATOMIC],GOLDEN_RATIO:["(1 + sqrt(5)) / 2",i.PHP.ORDER_DIVISION],SQRT2:["M_SQRT2",i.PHP.ORDER_ATOMIC],SQRT1_2:["M_SQRT1_2",i.PHP.ORDER_ATOMIC],INFINITY:["INF",i.PHP.ORDER_ATOMIC]}[e.getFieldValue("CONSTANT")]},i.PHP.math_number_property=function(e){var P=i.PHP.valueToCode(e,"NUMBER_TO_CHECK",i.PHP.ORDER_MODULUS)||"0",t=e.getFieldValue("PROPERTY");if("PRIME"==t)return[i.PHP.provideFunction_("math_isPrime",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if ($n == 2 || $n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (!is_numeric($n) || $n <= 1 || $n % 1 != 0 || $n % 2 == 0 || $n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for ($x = 6; $x <= sqrt($n) + 1; $x += 6) {","    if ($n % ($x - 1) == 0 || $n % ($x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+P+")",i.PHP.ORDER_FUNCTION_CALL];switch(t){case"EVEN":var r=P+" % 2 == 0";break;case"ODD":r=P+" % 2 == 1";break;case"WHOLE":r="is_int("+P+")";break;case"POSITIVE":r=P+" > 0";break;case"NEGATIVE":r=P+" < 0";break;case"DIVISIBLE_BY":r=P+" % "+(e=i.PHP.valueToCode(e,"DIVISOR",i.PHP.ORDER_MODULUS)||"0")+" == 0"}return[r,i.PHP.ORDER_EQUALITY]},i.PHP.math_change=function(e){var P=i.PHP.valueToCode(e,"DELTA",i.PHP.ORDER_ADDITION)||"0";return i.PHP.variableDB_.getName(e.getFieldValue("VAR"),i.Variables.NAME_TYPE)+" += "+P+";\n"},i.PHP.math_round=i.PHP.math_single,i.PHP.math_trig=i.PHP.math_single,i.PHP.math_on_list=function(e){var P=e.getFieldValue("OP");switch(P){case"SUM":e="array_sum("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MIN":e="min("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MAX":e="max("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"AVERAGE":e=(P=i.PHP.provideFunction_("math_mean",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($myList) {","  return array_sum($myList) / count($myList);","}"]))+"("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_NONE)||"array()")+")";break;case"MEDIAN":e=(P=i.PHP.provideFunction_("math_median",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($arr) {","  sort($arr,SORT_NUMERIC);","  return (count($arr) % 2) ? $arr[floor(count($arr)/2)] : ","      ($arr[floor(count($arr)/2)] + $arr[floor(count($arr)/2) - 1]) / 2;","}"]))+"("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_NONE)||"[]")+")";break;case"MODE":e=(P=i.PHP.provideFunction_("math_modes",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($values) {","  if (empty($values)) return array();","  $counts = array_count_values($values);","  arsort($counts); // Sort counts in descending order","  $modes = array_keys($counts, current($counts), true);","  return $modes;","}"]))+"("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_NONE)||"[]")+")";break;case"STD_DEV":e=(P=i.PHP.provideFunction_("math_standard_deviation",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($numbers) {","  $n = count($numbers);","  if (!$n) return null;","  $mean = array_sum($numbers) / count($numbers);","  foreach($numbers as $key => $num) $devs[$key] = pow($num - $mean, 2);","  return sqrt(array_sum($devs) / (count($devs) - 1));","}"]))+"("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_NONE)||"[]")+")";break;case"RANDOM":e=(P=i.PHP.provideFunction_("math_random_list",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  $x = rand(0, count($list)-1);","  return $list[$x];","}"]))+"("+(e=i.PHP.valueToCode(e,"LIST",i.PHP.ORDER_NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+P)}return[e,i.PHP.ORDER_FUNCTION_CALL]},i.PHP.math_modulo=function(e){return[(i.PHP.valueToCode(e,"DIVIDEND",i.PHP.ORDER_MODULUS)||"0")+" % "+(e=i.PHP.valueToCode(e,"DIVISOR",i.PHP.ORDER_MODULUS)||"0"),i.PHP.ORDER_MODULUS]},i.PHP.math_constrain=function(e){return["min(max("+(i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_COMMA)||"0")+", "+(i.PHP.valueToCode(e,"LOW",i.PHP.ORDER_COMMA)||"0")+"), "+(e=i.PHP.valueToCode(e,"HIGH",i.PHP.ORDER_COMMA)||"Infinity")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.math_random_int=function(e){var P=i.PHP.valueToCode(e,"FROM",i.PHP.ORDER_COMMA)||"0";return e=i.PHP.valueToCode(e,"TO",i.PHP.ORDER_COMMA)||"0",[i.PHP.provideFunction_("math_random_int",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($a, $b) {","  if ($a > $b) {","    return rand($b, $a);","  }","  return rand($a, $b);","}"])+"("+P+", "+e+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.math_random_float=function(e){return["(float)rand()/(float)getrandmax()",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.math_atan2=function(e){var P=i.PHP.valueToCode(e,"X",i.PHP.ORDER_COMMA)||"0";return["atan2("+(i.PHP.valueToCode(e,"Y",i.PHP.ORDER_COMMA)||"0")+", "+P+") / pi() * 180",i.PHP.ORDER_DIVISION]},i.PHP.procedures={},i.PHP.procedures_defreturn=function(e){for(var P,t=[],r=e.workspace,n=i.Variables.allUsedVarModels(r)||[],a=0;P=n[a];a++)P=P.name,-1==e.arguments_.indexOf(P)&&t.push(i.PHP.variableDB_.getName(P,i.Variables.NAME_TYPE));for(r=i.Variables.allDeveloperVariables(r),a=0;a<r.length;a++)t.push(i.PHP.variableDB_.getName(r[a],i.Names.DEVELOPER_VARIABLE_TYPE));t=t.length?i.PHP.INDENT+"global "+t.join(", ")+";\n":"",r=i.PHP.variableDB_.getName(e.getFieldValue("NAME"),i.Procedures.NAME_TYPE),n="",i.PHP.STATEMENT_PREFIX&&(n+=i.PHP.injectId(i.PHP.STATEMENT_PREFIX,e)),i.PHP.STATEMENT_SUFFIX&&(n+=i.PHP.injectId(i.PHP.STATEMENT_SUFFIX,e)),n=n&&i.PHP.prefixLines(n,i.PHP.INDENT),P="",i.PHP.INFINITE_LOOP_TRAP&&(P=i.PHP.prefixLines(i.PHP.injectId(i.PHP.INFINITE_LOOP_TRAP,e),i.PHP.INDENT));for(var _=i.PHP.statementToCode(e,"STACK"),E=i.PHP.valueToCode(e,"RETURN",i.PHP.ORDER_NONE)||"",o=_&&E?n:"",E=E&&i.PHP.INDENT+"return "+E+";\n",R=[],a=0;a<e.arguments_.length;a++)R[a]=i.PHP.variableDB_.getName(e.arguments_[a],i.Variables.NAME_TYPE);return t="function "+r+"("+R.join(", ")+") {\n"+t+n+P+_+o+E+"}",t=i.PHP.scrub_(e,t),i.PHP.definitions_["%"+r]=t,null},i.PHP.procedures_defnoreturn=i.PHP.procedures_defreturn,i.PHP.procedures_callreturn=function(e){for(var P=i.PHP.variableDB_.getName(e.getFieldValue("NAME"),i.Procedures.NAME_TYPE),t=[],r=0;r<e.arguments_.length;r++)t[r]=i.PHP.valueToCode(e,"ARG"+r,i.PHP.ORDER_COMMA)||"null";return[P+"("+t.join(", ")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.procedures_callnoreturn=function(e){return i.PHP.procedures_callreturn(e)[0]+";\n"},i.PHP.procedures_ifreturn=function(e){var P="if ("+(i.PHP.valueToCode(e,"CONDITION",i.PHP.ORDER_NONE)||"false")+") {\n";return i.PHP.STATEMENT_SUFFIX&&(P+=i.PHP.prefixLines(i.PHP.injectId(i.PHP.STATEMENT_SUFFIX,e),i.PHP.INDENT)),e.hasReturnValue_?(e=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"null",P+=i.PHP.INDENT+"return "+e+";\n"):P+=i.PHP.INDENT+"return;\n",P+"}\n"},i.PHP.texts={},i.PHP.text=function(e){return[i.PHP.quote_(e.getFieldValue("TEXT")),i.PHP.ORDER_ATOMIC]},i.PHP.text_multiline=function(e){return[i.PHP.multiline_quote_(e.getFieldValue("TEXT")),i.PHP.ORDER_ATOMIC]},i.PHP.text_join=function(e){if(0==e.itemCount_)return["''",i.PHP.ORDER_ATOMIC];if(1==e.itemCount_)return[i.PHP.valueToCode(e,"ADD0",i.PHP.ORDER_NONE)||"''",i.PHP.ORDER_FUNCTION_CALL];if(2==e.itemCount_){var P=i.PHP.valueToCode(e,"ADD0",i.PHP.ORDER_ATOMIC)||"''";return[P+" . "+(e=i.PHP.valueToCode(e,"ADD1",i.PHP.ORDER_ATOMIC)||"''"),i.PHP.ORDER_STRING_CONCAT]}P=Array(e.itemCount_);for(var t=0;t<e.itemCount_;t++)P[t]=i.PHP.valueToCode(e,"ADD"+t,i.PHP.ORDER_COMMA)||"''";return[e="implode('', array("+P.join(",")+"))",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_append=function(e){return i.PHP.variableDB_.getName(e.getFieldValue("VAR"),i.Variables.NAME_TYPE)+" .= "+(e=i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_ASSIGNMENT)||"''")+";\n"},i.PHP.text_length=function(e){return[i.PHP.provideFunction_("length",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(e=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"''")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_isEmpty=function(e){return["empty("+(i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"''")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_indexOf=function(e){var P,t="FIRST"==e.getFieldValue("END")?"strpos":"strrpos",r=i.PHP.valueToCode(e,"FIND",i.PHP.ORDER_NONE)||"''",n=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_NONE)||"''",a=e.workspace.options.oneBasedIndex?(P=" 0"," + 1"):(P=" -1","");return[i.PHP.provideFunction_("FIRST"==e.getFieldValue("END")?"text_indexOf":"text_lastIndexOf",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $search) {","  $pos = "+t+"($text, $search);","  return $pos === false ? "+P+" : $pos"+a+";","}"])+"("+n+", "+r+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_charAt=function(e){var P=e.getFieldValue("WHERE")||"FROM_START",t=i.PHP.valueToCode(e,"VALUE","RANDOM"==P?i.PHP.ORDER_NONE:i.PHP.ORDER_COMMA)||"''";switch(P){case"FIRST":return["substr("+t+", 0, 1)",i.PHP.ORDER_FUNCTION_CALL];case"LAST":return["substr("+t+", -1)",i.PHP.ORDER_FUNCTION_CALL];case"FROM_START":return["substr("+t+", "+(e=i.PHP.getAdjusted(e,"AT"))+", 1)",i.PHP.ORDER_FUNCTION_CALL];case"FROM_END":return["substr("+t+", "+(e=i.PHP.getAdjusted(e,"AT",1,!0))+", 1)",i.PHP.ORDER_FUNCTION_CALL];case"RANDOM":return[i.PHP.provideFunction_("text_random_letter",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text) {","  return $text[rand(0, strlen($text) - 1)];","}"])+"("+t+")",i.PHP.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},i.PHP.text_getSubstring=function(e){var P,t=i.PHP.valueToCode(e,"STRING",i.PHP.ORDER_FUNCTION_CALL)||"''",r=e.getFieldValue("WHERE1"),n=e.getFieldValue("WHERE2");return"FIRST"==r&&"LAST"==n||(P=i.PHP.getAdjusted(e,"AT1"),e=i.PHP.getAdjusted(e,"AT2"),t=i.PHP.provideFunction_("text_get_substring",["function "+i.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = strlen($text) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START') {","    throw new Exception('Unhandled option (text_get_substring).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = strlen($text) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = strlen($text) - $at1;","  } else {","    throw new Exception('Unhandled option (text_get_substring).');","  }","  return substr($text, $at1, $length);","}"])+"("+t+", '"+r+"', "+P+", '"+n+"', "+e+")"),[t,i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_changeCase=function(e){var P,t=i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_NONE)||"''";return"UPPERCASE"==e.getFieldValue("CASE")?P="strtoupper("+t+")":"LOWERCASE"==e.getFieldValue("CASE")?P="strtolower("+t+")":"TITLECASE"==e.getFieldValue("CASE")&&(P="ucwords(strtolower("+t+"))"),[P,i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_trim=function(e){return[{LEFT:"ltrim",RIGHT:"rtrim",BOTH:"trim"}[e.getFieldValue("MODE")]+"("+(e=i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_NONE)||"''")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_print=function(e){return"print("+(i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_NONE)||"''")+");\n"},i.PHP.text_prompt_ext=function(e){var P="readline("+(e.getField("TEXT")?i.PHP.quote_(e.getFieldValue("TEXT")):i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_NONE)||"''")+")";return"NUMBER"==e.getFieldValue("TYPE")&&(P="floatval("+P+")"),[P,i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_prompt=i.PHP.text_prompt_ext,i.PHP.text_count=function(e){var P=i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_MEMBER)||"''";return["strlen("+(e=i.PHP.valueToCode(e,"SUB",i.PHP.ORDER_NONE)||"''")+") === 0 ? strlen("+P+") + 1 : substr_count("+P+", "+e+")",i.PHP.ORDER_CONDITIONAL]},i.PHP.text_replace=function(e){var P=i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_MEMBER)||"''";return["str_replace("+(i.PHP.valueToCode(e,"FROM",i.PHP.ORDER_NONE)||"''")+", "+(e=i.PHP.valueToCode(e,"TO",i.PHP.ORDER_NONE)||"''")+", "+P+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.text_reverse=function(e){return["strrev("+(i.PHP.valueToCode(e,"TEXT",i.PHP.ORDER_MEMBER)||"''")+")",i.PHP.ORDER_FUNCTION_CALL]},i.PHP.variables={},i.PHP.variables_get=function(e){return[i.PHP.variableDB_.getName(e.getFieldValue("VAR"),i.Variables.NAME_TYPE),i.PHP.ORDER_ATOMIC]},i.PHP.variables_set=function(e){var P=i.PHP.valueToCode(e,"VALUE",i.PHP.ORDER_ASSIGNMENT)||"0";return i.PHP.variableDB_.getName(e.getFieldValue("VAR"),i.Variables.NAME_TYPE)+" = "+P+";\n"},i.PHP.variablesDynamic={},i.PHP.variables_get_dynamic=i.PHP.variables_get,i.PHP.variables_set_dynamic=i.PHP.variables_set,i.PHP});