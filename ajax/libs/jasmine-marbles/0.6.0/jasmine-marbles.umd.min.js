!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/testing"),require("lodash"),require("rxjs/internal/testing/HotObservable"),require("rxjs/internal/testing/ColdObservable")):"function"==typeof define&&define.amd?define(["exports","rxjs","rxjs/testing","lodash","rxjs/internal/testing/HotObservable","rxjs/internal/testing/ColdObservable"],t):t(e["jasmine-marbles"]=e["jasmine-marbles"]||{},e.Rx,e.Rx,e._,e.rxjs_internal_testing_HotObservable,e.rxjs_internal_testing_ColdObservable)}(this,function(e,t,r,s,n,i){"use strict";function o(e){return JSON.stringify(e,function(e,t){return Array.isArray(t)?"["+t.map(function(e){return"\n\t"+o(e)})+"\n]":t}).replace(/\\"/g,'"').replace(/\\t/g,"\t").replace(/\\n/g,"\n")}function a(e){const{notification:t}=e;if(t){const{kind:e,exception:r}=t;"E"===e&&r instanceof Error&&(t.exception={name:r.name,message:r.message})}return e}function c(e,t){if(Array.isArray(e)&&Array.isArray(t)){e=e.map(a),t=t.map(a);const r=s.isEqual(e,t);if(r)return;let n="\nExpected \n";e.forEach(e=>n+=`\t${o(e)}\n`),n+="\t\nto deep equal \n",t.forEach(e=>n+=`\t${o(e)}\n`),expect(r).toEqual(n)}else expect(e).toEqual(t)}let u;function l(){u=new r.TestScheduler(c)}function f(){if(u)return u;throw new Error("No test scheduler initialized")}function b(){u=null}class p extends t.Observable{constructor(e,t,s){super(),this.marbles=e,this.values=t,this.error=s;const n=f(),o=r.TestScheduler.parseMarbles(e,t,s,void 0,!0),a=new i.ColdObservable(o,n);this.source=a,n.coldObservables.push(a)}getSubscriptions(){return this.source.subscriptions}}class m extends t.Observable{constructor(e,t,s){super(),this.marbles=e,this.values=t,this.error=s;const i=f(),o=r.TestScheduler.parseMarbles(e,t,s,void 0,!0),a=new n.HotObservable(o,i);this.source=a,i.hotObservables.push(a)}getSubscriptions(){return this.source.subscriptions}}function h(){jasmine.addMatchers({toHaveSubscriptions:()=>({compare:function(e,t){const s=("string"==typeof t?[t]:t).map(e=>r.TestScheduler.parseMarblesAsSubscriptions(e));return expect(s).toEqual(e.getSubscriptions()),{pass:!0}}}),toBeObservable:()=>({compare:function(e,s){const n=[];let i;const o=f();o.schedule(()=>{i=e.subscribe(e=>{let r=e;e instanceof t.Observable&&(r=function(e,r){const s=[],n=f();return e.subscribe(e=>{s.push({frame:n.frame-r,notification:t.Notification.createNext(e)})},e=>{s.push({frame:n.frame-r,notification:t.Notification.createError(e)})},()=>{s.push({frame:n.frame-r,notification:t.Notification.createComplete()})}),s}(r,o.frame)),n.push({frame:o.frame,notification:t.Notification.createNext(r)})},e=>{n.push({frame:o.frame,notification:t.Notification.createError(e)})},()=>{n.push({frame:o.frame,notification:t.Notification.createComplete()})})}),o.flush();const a=r.TestScheduler.parseMarbles(s.marbles,s.values,s.error,!0,!0);return expect(n).toEqual(a),{pass:!0}}})})}function d(){jasmine.getEnv().beforeAll(()=>h()),jasmine.getEnv().beforeEach(()=>l()),jasmine.getEnv().afterEach(()=>{f().flush(),b()})}d(),e.hot=function(e,t,r){return new m(e.trim(),t,r)},e.cold=function(e,t,r){return new p(e.trim(),t,r)},e.time=function(e){return f().createTime(e.trim())},e.addMatchers=h,e.setupEnvironment=d,e.getTestScheduler=f,e.initTestScheduler=l,e.resetTestScheduler=b,Object.defineProperty(e,"__esModule",{value:!0})});