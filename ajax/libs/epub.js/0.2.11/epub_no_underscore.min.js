!function(e){var t,p,l,u,d;u={},d={},l=p=function(s){if(l._eak_seen=u,d[s])return d[s];if(d[s]={},!u[s])throw new Error("Could not find module "+s);for(var e,t=u[s],r=t.deps,n=t.callback,i=[],o=0,a=r.length;o<a;o++)"exports"===r[o]?i.push(e={}):i.push(p(h(r[o])));var c=n.apply(this,i);return d[s]=e||c;function h(e){if("."!==e.charAt(0))return e;for(var t=e.split("/"),r=s.split("/").slice(0,-1),n=0,i=t.length;n<i;n++){var o=t[n];if(".."===o)r.pop();else{if("."===o)continue;r.push(o)}}return r.join("/")}},(t=function(e,t,r){u[e]={deps:t,callback:r}})("rsvp/all",["./promise","exports"],function(e,t){"use strict";var r=e.default;t.default=function(e,t){return r.all(e,t)}}),t("rsvp/all_settled",["./promise","./utils","exports"],function(e,t,r){"use strict";var p=e.default,l=t.isArray,u=t.isNonThenable;function d(e){return{state:"fulfilled",value:e}}r.default=function(h,e){return new p(function(r,e){if(!l(h))throw new TypeError("You must pass an array to allSettled.");var t,n=h.length;if(0!==n)for(var i=new Array(n),o=0;o<h.length;o++)t=h[o],u(t)?c(o,d(t)):p.cast(t).then(s(o),a(o));else r([]);function s(t){return function(e){c(t,d(e))}}function a(t){return function(e){c(t,{state:"rejected",reason:e})}}function c(e,t){i[e]=t,0==--n&&r(i)}},e)}}),t("rsvp/asap",["exports"],function(e){"use strict";e.default=function(e,t){1===a.push([e,t])&&n()};var t="undefined"!=typeof window?window:{},r=t.MutationObserver||t.WebKitMutationObserver;var n,i,o,s,a=[];function c(){for(var e=0;e<a.length;e++){var t=a[e];(0,t[0])(t[1])}a=[]}n="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){process.nextTick(c)}:r?(i=0,o=new r(c),s=document.createTextNode(""),o.observe(s,{characterData:!0}),function(){s.data=i=++i%2}):function(){setTimeout(c,1)}}),t("rsvp/config",["./events","exports"],function(e,t){"use strict";var r=e.default,n={instrument:!1};r.mixin(n),t.config=n,t.configure=function(e,t){if("onerror"!==e)return 2!==arguments.length?n[e]:void(n[e]=t);n.on("error",t)}}),t("rsvp/defer",["./promise","exports"],function(e,t){"use strict";var n=e.default;t.default=function(e){var r={};return r.promise=new n(function(e,t){r.resolve=e,r.reject=t},e),r}}),t("rsvp/events",["exports"],function(e){"use strict";function o(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function s(e){return e._promiseCallbacks||(e._promiseCallbacks={})}e.default={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var r=s(this),n=r[e];n=n||(r[e]=[]),-1===o(n,t)&&n.push(t)},off:function(e,t){var r,n,i=s(this);t?(r=i[e],-1!==(n=o(r,t))&&r.splice(n,1)):i[e]=[]},trigger:function(e,t){var r;if(r=s(this)[e])for(var n=0;n<r.length;n++)(0,r[n])(t)}}}),t("rsvp/filter",["./all","./map","./utils","exports"],function(e,t,r,n){"use strict";var i=e.default,o=t.default,s=r.isFunction,a=r.isArray;n.default=function(e,t,r){if(!a(e))throw new TypeError("You must pass an array to filter.");if(!s(t))throw new TypeError("You must pass a function to filter's second argument.");return i(e,r).then(function(i){return o(e,t,r).then(function(e){for(var t=i.length,r=[],n=0;n<t;n++)e[n]&&r.push(i[n]);return r})})}}),t("rsvp/hash",["./promise","./utils","exports"],function(e,t,r){"use strict";var l=e.default,u=t.isNonThenable,d=t.keysOf;r.default=function(p){return new l(function(r,t){var e,n,i={},o=d(p),s=o.length;if(0!==s)for(var a=0;a<o.length;a++)n=o[a],e=p[n],u(e)?(i[n]=e,0==--s&&r(i)):l.cast(e).then(c(n),h);else r(i);function c(t){return function(e){i[t]=e,0==--s&&r(i)}}function h(e){s=0,t(e)}})}}),t("rsvp/instrument",["./config","./utils","exports"],function(e,t,r){"use strict";var n=e.config,i=t.now;r.default=function(e,t,r){try{n.trigger(e,{guid:t._guidKey+t._id,eventName:e,detail:t._detail,childGuid:r&&t._guidKey+r._id,label:t._label,timeStamp:i(),stack:new Error(t._label).stack})}catch(e){setTimeout(function(){throw e},0)}}}),t("rsvp/map",["./promise","./all","./utils","exports"],function(e,t,r,n){"use strict";e.default;var s=t.default,a=r.isArray,c=r.isFunction;n.default=function(e,i,o){if(!a(e))throw new TypeError("You must pass an array to map.");if(!c(i))throw new TypeError("You must pass a function to map's second argument.");return s(e,o).then(function(e){for(var t=e.length,r=[],n=0;n<t;n++)r.push(i(e[n]));return s(r,o)})}}),t("rsvp/node",["./promise","exports"],function(e,t){"use strict";var r=e.default,a=Array.prototype.slice;t.default=function(s,t){return function(){var e=a.call(arguments),o=this||t;return new r(function(t,i){r.all(e).then(function(e){try{e.push((r=t,n=i,function(e,t){e?n(e):r(2<arguments.length?a.call(arguments,1):t)})),s.apply(o,e)}catch(e){i(e)}var r,n})})}}}),t("rsvp/promise",["./config","./events","./instrument","./utils","./promise/cast","./promise/all","./promise/race","./promise/resolve","./promise/reject","exports"],function(e,t,r,n,i,o,s,a,c,h){"use strict";var l=e.config,u=(t.default,r.default),p=n.objectOrFunction,d=n.isFunction,f=n.now,g=i.default,m=o.default,y=s.default,E=a.default,v=c.default,P="rsvp_"+f()+"-",S=0;function B(){}function U(e,t){if(!d(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof U))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._id=S++,this._label=t,this._subscribers=[],l.instrument&&u("created",this),B!==e&&function(e,t){function r(e){N(t,e)}try{e(function(e){L(t,e)},r)}catch(e){r(e)}}(e,this)}(h.default=U).cast=g,U.all=m,U.race=y,U.resolve=E,U.reject=v;var b=void 0,J=0,x=1,w=2;function R(e,t){var r=e._subscribers,n=e._detail;l.instrument&&u(t===x?"fulfilled":"rejected",e);for(var i=0;i<r.length;i+=3)C(t,r[i],r[i+t],n);e._subscribers=null}function C(e,t,r,n){var i,o,s,a,c=d(r);if(c)try{i=r(n),s=!0}catch(e){a=!0,o=e}else i=n,s=!0;k(t,i)||(c&&s?L(t,i):a?N(t,o):e===x?L(t,i):e===w&&N(t,i))}function k(t,r){var n,e=null;try{if(t===r)throw new TypeError("A promises callback cannot return that same promise.");if(p(r)&&(e=r.then,d(e)))return e.call(r,function(e){if(n)return!0;n=!0,(r!==e?L:T)(t,e)},function(e){if(n)return!0;n=!0,N(t,e)},"derived from: "+(t._label||" unknown promise")),1}catch(e){return n?1:(N(t,e),1)}}function L(e,t){e!==t&&k(e,t)||T(e,t)}function T(e,t){e._state===b&&(e._state=J,e._detail=t,l.async(_,e))}function N(e,t){e._state===b&&(e._state=J,e._detail=t,l.async(F,e))}function _(e){R(e,e._state=x)}function F(e){e._onerror&&e._onerror(e._detail),R(e,e._state=w)}U.prototype={constructor:U,_id:void 0,_guidKey:P,_label:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,_onerror:function(e){l.trigger("error",e)},then:function(e,t,r){var n=this;this._onerror=null;var i,o,s,a,c,h,p=new this.constructor(B,r);return this._state?(i=arguments,l.async(function(){C(n._state,p,i[n._state-1],n._detail)})):(o=p,s=e,a=t,c=this._subscribers,h=c.length,c[h]=o,c[h+x]=s,c[h+w]=a),l.instrument&&u("chained",n,p),p},catch:function(e,t){return this.then(null,e,t)},finally:function(t,e){var r=this.constructor;return this.then(function(e){return r.cast(t()).then(function(){return e})},function(e){return r.cast(t()).then(function(){throw e})},e)}}}),t("rsvp/promise/all",["../utils","exports"],function(e,t){"use strict";var p=e.isArray,l=e.isNonThenable;t.default=function(c,e){var h=this;return new h(function(r,t){if(!p(c))throw new TypeError("You must pass an array to all.");var e,n=c.length,i=new Array(n);if(0!==n)for(var o=0;o<c.length;o++)e=c[o],l(e)?(i[o]=e,0==--n&&r(i)):h.cast(e).then(s(o),a);else r(i);function s(t){return function(e){i[t]=e,0==--n&&r(i)}}function a(e){n=0,t(e)}},e)}}),t("rsvp/promise/cast",["exports"],function(e){"use strict";e.default=function(t,e){return t&&"object"==typeof t&&t.constructor===this?t:new this(function(e){e(t)},e)}}),t("rsvp/promise/race",["../utils","exports"],function(e,t){"use strict";var h=e.isArray,p=(e.isFunction,e.isNonThenable);t.default=function(s,e){var a,c=this;return new c(function(t,r){if(!h(s))throw new TypeError("You must pass an array to race.");var n=!0;function e(e){n&&(n=!1,t(e))}function i(e){n&&(n=!1,r(e))}for(var o=0;o<s.length;o++){if(a=s[o],p(a))return n=!1,void t(a);c.cast(a).then(e,i)}},e)}}),t("rsvp/promise/reject",["exports"],function(e){"use strict";e.default=function(r,e){return new this(function(e,t){t(r)},e)}}),t("rsvp/promise/resolve",["exports"],function(e){"use strict";e.default=function(r,e){return new this(function(e,t){e(r)},e)}}),t("rsvp/race",["./promise","exports"],function(e,t){"use strict";var r=e.default;t.default=function(e,t){return r.race(e,t)}}),t("rsvp/reject",["./promise","exports"],function(e,t){"use strict";var r=e.default;t.default=function(e,t){return r.reject(e,t)}}),t("rsvp/resolve",["./promise","exports"],function(e,t){"use strict";var r=e.default;t.default=function(e,t){return r.resolve(e,t)}}),t("rsvp/rethrow",["exports"],function(e){"use strict";e.default=function(e){throw setTimeout(function(){throw e}),e}}),t("rsvp/utils",["exports"],function(e){"use strict";function t(e){return"function"==typeof e||"object"==typeof e&&null!==e}e.objectOrFunction=t,e.isFunction=function(e){return"function"==typeof e},e.isNonThenable=function(e){return!t(e)},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};var r=Date.now||function(){return(new Date).getTime()};e.now=r;var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.keysOf=n}),t("rsvp",["./rsvp/promise","./rsvp/events","./rsvp/node","./rsvp/all","./rsvp/all_settled","./rsvp/race","./rsvp/hash","./rsvp/rethrow","./rsvp/defer","./rsvp/config","./rsvp/map","./rsvp/resolve","./rsvp/reject","./rsvp/asap","./rsvp/filter","exports"],function(e,t,r,n,i,o,s,a,c,h,p,l,u,d,f,g){"use strict";var m=e.default,y=t.default,E=r.default,v=n.default,P=i.default,S=o.default,B=s.default,U=a.default,b=c.default,J=h.config,x=h.configure,w=p.default,R=l.default,C=u.default,k=d.default,L=f.default;function T(){J.on.apply(J,arguments)}if(J.async=k,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var N=window.__PROMISE_INSTRUMENTATION__;for(var _ in x("instrument",!0),N)N.hasOwnProperty(_)&&T(_,N[_])}g.Promise=m,g.EventTarget=y,g.all=v,g.allSettled=P,g.race=S,g.hash=B,g.rethrow=U,g.defer=b,g.denodeify=E,g.configure=x,g.on=T,g.off=function(){J.off.apply(J,arguments)},g.resolve=R,g.reject=C,g.async=function(e,t){J.async(e,t)},g.map=w,g.filter=L}),e.RSVP=p("rsvp")}(window);var EPUBJS=EPUBJS||{};EPUBJS.VERSION="0.2.7",EPUBJS.plugins=EPUBJS.plugins||{},EPUBJS.filePath=EPUBJS.filePath||"/epubjs/",EPUBJS.Render={},function(e){var t=e.ePub||{},r=e.ePub=function(){var e,t;return void 0!==arguments[0]&&"string"==typeof arguments[0]&&(e=arguments[0],arguments[1]&&"object"==typeof arguments[1]?(t=arguments[1]).bookPath=e:t={bookPath:e}),arguments[0]&&"object"==typeof arguments[0]&&(t=arguments[0]),new EPUBJS.Book(t)};EPUBJS.core.extend(r,{noConflict:function(){return e.ePub=t,this}}),"function"==typeof define&&define.amd?define(function(){return r}):"undefined"!=typeof module&&module.exports&&(module.exports=r)}(window),EPUBJS.Book=function(e){this.settings=EPUBJS.core.defaults(e||{},{bookPath:null,bookKey:null,packageUrl:null,storage:!1,fromStorage:!1,saved:!1,online:!0,contained:!1,width:null,height:null,layoutOveride:null,orientation:null,minSpreadWidth:800,gap:"auto",version:1,restore:!1,reload:!1,goto:!1,styles:{},headTags:{},withCredentials:!1,render_method:"Iframe"}),this.settings.EPUBJSVERSION=EPUBJS.VERSION,this.spinePos=0,this.stored=!1,this.online=this.settings.online||navigator.onLine,this.networkListeners(),this.ready={manifest:new RSVP.defer,spine:new RSVP.defer,metadata:new RSVP.defer,cover:new RSVP.defer,toc:new RSVP.defer,pageList:new RSVP.defer},this.readyPromises=[this.ready.manifest.promise,this.ready.spine.promise,this.ready.metadata.promise,this.ready.cover.promise,this.ready.toc.promise],this.pageList=[],this.pagination=new EPUBJS.Pagination,this.pageListReady=this.ready.pageList.promise,this.ready.all=RSVP.all(this.readyPromises),this.ready.all.then(this._ready.bind(this)),this.isRendered=!1,this._q=EPUBJS.core.queue(this),this._rendering=!1,this._displayQ=EPUBJS.core.queue(this),this._moving=!1,this._gotoQ=EPUBJS.core.queue(this),this.renderer=new EPUBJS.Renderer(this.settings.render_method),this.renderer.setMinSpreadWidth(this.settings.minSpreadWidth),this.renderer.setGap(this.settings.gap),this.listenToRenderer(this.renderer),this.defer_opened=new RSVP.defer,this.opened=this.defer_opened.promise,(this.store=!1)!==this.settings.storage&&this.fromStorage(!0),"string"==typeof this.settings.bookPath&&this.open(this.settings.bookPath,this.settings.reload),window.addEventListener("beforeunload",this.unload.bind(this),!1)},EPUBJS.Book.prototype.open=function(e,t){var r,n=this,i=new RSVP.defer;return this.settings.bookPath=e,this.bookUrl=this.urlFrom(e),r=this.settings.contained||this.isContained(e)?(this.settings.contained=this.contained=!0,this.bookUrl="",this.unarchive(e).then(function(){return n.loadPackage()})):this.loadPackage(),this.settings.restore&&!t&&localStorage?r.then(function(e){var t=n.packageIdentifier(e);n.restore(t)||n.unpack(e),i.resolve(),n.defer_opened.resolve()}):r.then(function(e){n.unpack(e),i.resolve(),n.defer_opened.resolve()}),this._registerReplacements(this.renderer),i.promise},EPUBJS.Book.prototype.loadPackage=function(e){var t=this,r=new EPUBJS.Parser,n=e||"META-INF/container.xml",i=this.settings.packageUrl?t.loadXml(t.settings.packageUrl):t.loadXml(t.bookUrl+n).then(function(e){return r.container(e)}).then(function(e){return t.settings.contentsPath=t.bookUrl+e.basePath,t.settings.packageUrl=t.bookUrl+e.packagePath,t.settings.encoding=e.encoding,t.loadXml(t.settings.packageUrl)});return i.catch(function(e){console.error("Could not load book at: "+n),t.trigger("book:loadFailed",n)}),i},EPUBJS.Book.prototype.packageIdentifier=function(e){return(new EPUBJS.Parser).identifier(e)},EPUBJS.Book.prototype.unpack=function(e){var i=this,t=new EPUBJS.Parser;i.contents=t.packageContents(e,i.settings.contentsPath),i.manifest=i.contents.manifest,i.spine=i.contents.spine,i.spineIndexByURL=i.contents.spineIndexByURL,i.metadata=i.contents.metadata,i.settings.bookKey||(i.settings.bookKey=i.generateBookKey(i.metadata.identifier)),i.globalLayoutProperties=i.parseLayoutProperties(i.metadata),i.contents.coverPath&&(i.cover=i.contents.cover=i.settings.contentsPath+i.contents.coverPath),i.spineNodeIndex=i.contents.spineNodeIndex,i.ready.manifest.resolve(i.contents.manifest),i.ready.spine.resolve(i.contents.spine),i.ready.metadata.resolve(i.contents.metadata),i.ready.cover.resolve(i.contents.cover),i.locations=new EPUBJS.Locations(i.spine),i.contents.navPath?(i.settings.navUrl=i.settings.contentsPath+i.contents.navPath,i.loadXml(i.settings.navUrl).then(function(e){return t.nav(e,i.spineIndexByURL,i.spine)}).then(function(e){i.toc=i.contents.toc=e,i.ready.toc.resolve(i.contents.toc)},function(e){i.ready.toc.resolve(!1)}),i.loadXml(i.settings.navUrl).then(function(e){return t.pageList(e,i.spineIndexByURL,i.spine)}).then(function(e){var r=new EPUBJS.EpubCFI,n=0;0!==e.length&&(i.pageList=i.contents.pageList=e,i.pageList.forEach(function(t){t.cfi||(n+=1,r.generateCfiFromHref(t.href,i).then(function(e){t.cfi=e,t.packageUrl=i.settings.packageUrl,0===--n&&(i.pagination.process(i.pageList),i.ready.pageList.resolve(i.pageList))}))}),n||(i.pagination.process(i.pageList),i.ready.pageList.resolve(i.pageList)))},function(e){i.ready.pageList.resolve([])})):i.contents.tocPath?(i.settings.tocUrl=i.settings.contentsPath+i.contents.tocPath,i.loadXml(i.settings.tocUrl).then(function(e){return t.toc(e,i.spineIndexByURL,i.spine)}).then(function(e){i.toc=i.contents.toc=e,i.ready.toc.resolve(i.contents.toc)},function(e){i.ready.toc.resolve(!1)})):i.ready.toc.resolve(!1)},EPUBJS.Book.prototype.createHiddenRender=function(e,t,r){var n,i,o=this.element.getBoundingClientRect(),s=t||this.settings.width||o.width,a=r||this.settings.height||o.height;return e.setMinSpreadWidth(this.settings.minSpreadWidth),e.setGap(this.settings.gap),this._registerReplacements(e),this.settings.forceSingle&&e.forceSingle(!0),(n=document.createElement("div")).style.visibility="hidden",n.style.overflow="hidden",n.style.width="0",n.style.height="0",this.element.appendChild(n),(i=document.createElement("div")).style.visibility="hidden",i.style.overflow="hidden",i.style.width=s+"px",i.style.height=a+"px",n.appendChild(i),e.initialize(i),n},EPUBJS.Book.prototype.generatePageList=function(e,t){var i=[],o=new EPUBJS.Renderer(this.settings.render_method,!1),r=this.createHiddenRender(o,e,t),n=new RSVP.defer,s=-1,a=this.spine.length,c=0,h=function(e){var t,r=s+1,n=e||new RSVP.defer;return a<=r?n.resolve():(s=r,t=new EPUBJS.Chapter(this.spine[s],this.store),o.displayChapter(t,this.globalLayoutProperties).then(function(e){o.pageMap.forEach(function(e){c+=1,i.push({cfi:e.start,page:c})}),0<o.pageMap.length%2&&o.spreads&&(c+=1,i.push({cfi:o.pageMap[o.pageMap.length-1].end,page:c})),setTimeout(function(){h(n)},1)})),n.promise}.bind(this);h().then(function(){o.remove(),this.element.removeChild(r),n.resolve(i)}.bind(this));return n.promise},EPUBJS.Book.prototype.generatePagination=function(e,t){var r=this,n=new RSVP.defer;return this.ready.spine.promise.then(function(){r.generatePageList(e,t).then(function(e){r.pageList=r.contents.pageList=e,r.pagination.process(e),r.ready.pageList.resolve(r.pageList),n.resolve(r.pageList)})}),n.promise},EPUBJS.Book.prototype.loadPagination=function(e){var t=JSON.parse(e);return t&&t.length&&(this.pageList=t,this.pagination.process(this.pageList),this.ready.pageList.resolve(this.pageList)),this.pageList},EPUBJS.Book.prototype.getPageList=function(){return this.ready.pageList.promise},EPUBJS.Book.prototype.getMetadata=function(){return this.ready.metadata.promise},EPUBJS.Book.prototype.getToc=function(){return this.ready.toc.promise},EPUBJS.Book.prototype.networkListeners=function(){var t=this;window.addEventListener("offline",function(e){t.online=!1,t.settings.storage&&t.fromStorage(!0),t.trigger("book:offline")},!1),window.addEventListener("online",function(e){t.online=!0,t.settings.storage&&t.fromStorage(!1),t.trigger("book:online")},!1)},EPUBJS.Book.prototype.listenToRenderer=function(e){var r=this;e.Events.forEach(function(t){e.on(t,function(e){r.trigger(t,e)})}),e.on("renderer:visibleRangeChanged",function(e){var t,r,n,i=[];0<this.pageList.length&&(t=this.pagination.pageFromCfi(e.start),n=this.pagination.percentageFromPage(t),i.push(t),e.end&&(r=this.pagination.pageFromCfi(e.end),i.push(r)),this.trigger("book:pageChanged",{anchorPage:t,percentage:n,pageRange:i}))}.bind(this)),e.on("render:loaded",this.loadChange.bind(this))},EPUBJS.Book.prototype.loadChange=function(e){var t,r,n=EPUBJS.core.uri(e),i=EPUBJS.core.uri(this.currentChapter.absolute);n.path!=i.path?(console.warn("Miss Match",n.path,this.currentChapter.absolute),t=this.spineIndexByURL[n.filename],r=new EPUBJS.Chapter(this.spine[t],this.store),this.currentChapter=r,this.renderer.currentChapter=r,this.renderer.afterLoad(this.renderer.render.docEl),this.renderer.beforeDisplay(function(){this.renderer.afterDisplay()}.bind(this))):this._rendering||this.renderer.reformat()},EPUBJS.Book.prototype.unlistenToRenderer=function(t){t.Events.forEach(function(e){t.off(e)})},EPUBJS.Book.prototype.loadXml=function(e){return this.settings.fromStorage?this.store.getXml(e,this.settings.encoding):this.settings.contained?this.zip.getXml(e,this.settings.encoding):EPUBJS.core.request(e,"xml",this.settings.withCredentials)},EPUBJS.Book.prototype.urlFrom=function(e){var t,r=EPUBJS.core.uri(e),n=r.protocol,i="/"==r.path[0],o=window.location,s=o.origin||o.protocol+"//"+o.host,a=document.getElementsByTagName("base");return a.length&&(t=a[0].href),r.protocol?r.origin+r.path:!n&&i?(t||s)+r.path:n||i?void 0:EPUBJS.core.resolveUrl(t||o.pathname,r.path)},EPUBJS.Book.prototype.unarchive=function(e){return this.zip=new EPUBJS.Unarchiver,this.store=this.zip,this.zip.open(e)},EPUBJS.Book.prototype.isContained=function(e){var t=EPUBJS.core.uri(e);return!(!t.extension||"epub"!=t.extension&&"zip"!=t.extension)},EPUBJS.Book.prototype.isSaved=function(e){var t;return!!localStorage&&(t=localStorage.getItem(e),!(!localStorage||null===t))},EPUBJS.Book.prototype.generateBookKey=function(e){return"epubjs:"+EPUBJS.VERSION+":"+window.location.host+":"+e},EPUBJS.Book.prototype.saveContents=function(){if(!localStorage)return!1;localStorage.setItem(this.settings.bookKey,JSON.stringify(this.contents))},EPUBJS.Book.prototype.removeSavedContents=function(){if(!localStorage)return!1;localStorage.removeItem(this.settings.bookKey)},EPUBJS.Book.prototype.renderTo=function(e){var t=this;if(EPUBJS.core.isElement(e))this.element=e;else{if("string"!=typeof e)return void console.error("Not an Element");this.element=EPUBJS.core.getEl(e)}return this.opened.then(function(){return t.renderer.initialize(t.element,t.settings.width,t.settings.height),t.metadata.direction&&t.renderer.setDirection(t.metadata.direction),t._rendered(),t.startDisplay()})},EPUBJS.Book.prototype.startDisplay=function(){var e=this.settings.goto?this.goto(this.settings.goto):this.settings.previousLocationCfi?this.gotoCfi(this.settings.previousLocationCfi):this.displayChapter(this.spinePos);return e},EPUBJS.Book.prototype.restore=function(e){var t,r=["manifest","spine","metadata","cover","toc","spineNodeIndex","spineIndexByURL","globalLayoutProperties"],n=!1,i=this.generateBookKey(e),o=localStorage.getItem(i),s=r.length;if(this.settings.clearSaved&&(n=!0),!n&&"undefined"!=o&&null!==o)for(this.contents=JSON.parse(o),t=0;t<s;t++){var a=r[t];if(!this.contents[a]){n=!0;break}this[a]=this.contents[a]}return!(n||!o||!this.contents||!this.settings.contentsPath)&&(this.settings.bookKey=i,this.ready.manifest.resolve(this.manifest),this.ready.spine.resolve(this.spine),this.ready.metadata.resolve(this.metadata),this.ready.cover.resolve(this.cover),this.ready.toc.resolve(this.toc),!0)},EPUBJS.Book.prototype.displayChapter=function(e,t,r){var n,i,o,s,a=this,c=r||new RSVP.defer;return this.isRendered?this._rendering||this._rendering?this._displayQ.enqueue("displayChapter",[e,t,c]):(((o=EPUBJS.core.isNumber(e)?e:(i=new EPUBJS.EpubCFI(e)).spinePos)<0||o>=this.spine.length)&&(console.warn("Not A Valid Location"),o=0,i=t=!1),s=new EPUBJS.Chapter(this.spine[o],this.store),this._rendering=!0,this._needsAssetReplacement()&&s.registerHook("beforeChapterRender",[EPUBJS.replace.head,EPUBJS.replace.resources,EPUBJS.replace.svg],!0),a.currentChapter=s,n=a.renderer.displayChapter(s,this.globalLayoutProperties),i?a.renderer.gotoCfi(i):t&&a.renderer.lastPage(),n.then(function(e){a.spinePos=o,c.resolve(a.renderer),!1===a.settings.fromStorage&&!1===a.settings.contained&&a.preloadNextChapter(),a._rendering=!1,a._displayQ.dequeue(),0===a._displayQ.length()&&a._gotoQ.dequeue()},function(e){console.error("Could not load Chapter: "+s.absolute,e),a.trigger("book:chapterLoadFailed",s.absolute),a._rendering=!1,c.reject(e)})):(this._q.enqueue("displayChapter",arguments),c.reject({message:"Rendering",stack:(new Error).stack})),c.promise},EPUBJS.Book.prototype.nextPage=function(){return this.isRendered?this.renderer.nextPage()?void 0:this.nextChapter():this._q.enqueue("nextPage",arguments)},EPUBJS.Book.prototype.prevPage=function(){return this.isRendered?this.renderer.prevPage()?void 0:this.prevChapter():this._q.enqueue("prevPage",arguments)},EPUBJS.Book.prototype.nextChapter=function(){var e;if(this.spinePos<this.spine.length-1){for(e=this.spinePos+1;this.spine[e]&&this.spine[e].linear&&"no"==this.spine[e].linear;)e++;if(e<this.spine.length)return this.displayChapter(e);this.trigger("book:atEnd")}else this.trigger("book:atEnd")},EPUBJS.Book.prototype.prevChapter=function(){var e;if(0<this.spinePos){for(e=this.spinePos-1;this.spine[e]&&this.spine[e].linear&&"no"==this.spine[e].linear;)e--;if(0<=e)return this.displayChapter(e,!0);this.trigger("book:atStart")}else this.trigger("book:atStart")},EPUBJS.Book.prototype.getCurrentLocationCfi=function(){return!!this.isRendered&&this.renderer.currentLocationCfi},EPUBJS.Book.prototype.goto=function(e){return 0===e.indexOf("epubcfi(")?this.gotoCfi(e):e.indexOf("%")===e.length-1?this.gotoPercentage(parseInt(e.substring(0,e.length-1))/100):"number"==typeof e||!1===isNaN(e)?this.gotoPage(e):this.gotoHref(e)},EPUBJS.Book.prototype.gotoCfi=function(e,t){var r,n,i,o=t||new RSVP.defer;return this.isRendered?this._moving||this._rendering?(console.warn("Renderer is moving"),this._gotoQ.enqueue("gotoCfi",[e,o]),!1):-1!=(n=(r=new EPUBJS.EpubCFI(e)).spinePos)&&(i=this.spine[n],promise=o.promise,this._moving=!0,this.currentChapter&&this.spinePos===n?(this.renderer.gotoCfi(r),this._moving=!1,o.resolve(this.renderer.currentLocationCfi)):(i&&-1!=n||(n=0,i=this.spine[n]),this.currentChapter=new EPUBJS.Chapter(i,this.store),this.currentChapter&&(this.spinePos=n,render=this.renderer.displayChapter(this.currentChapter,this.globalLayoutProperties),this.renderer.gotoCfi(r),render.then(function(e){this._moving=!1,o.resolve(e.currentLocationCfi)}.bind(this)))),promise.then(function(){this._gotoQ.dequeue()}.bind(this)),promise):(console.warn("Not yet Rendered"),this.settings.previousLocationCfi=e,!1)},EPUBJS.Book.prototype.gotoHref=function(e,t){var r,n,i,o,s,a=t||new RSVP.defer;return this.isRendered?this._moving||this._rendering?(this._gotoQ.enqueue("gotoHref",[e,a]),!1):(n=(r=e.split("#"))[0],i=r[1]||!1,o=n.replace(this.settings.contentsPath,""),s=this.spineIndexByURL[o],n||(s=this.currentChapter?this.currentChapter.spinePos:0),"number"==typeof s&&(this.currentChapter&&s==this.currentChapter.spinePos?(i?this.renderer.section(i):this.renderer.firstPage(),a.resolve(this.renderer.currentLocationCfi),a.promise.then(function(){this._gotoQ.dequeue()}.bind(this)),a.promise):this.displayChapter(s).then(function(){i&&this.renderer.section(i),a.resolve(this.renderer.currentLocationCfi)}.bind(this)))):(this.settings.goto=e,!1)},EPUBJS.Book.prototype.gotoPage=function(e){var t=this.pagination.cfiFromPage(e);return this.gotoCfi(t)},EPUBJS.Book.prototype.gotoPercentage=function(e){var t=this.pagination.pageFromPercentage(e);return this.gotoPage(t)},EPUBJS.Book.prototype.preloadNextChapter=function(){var e,t=this.spinePos+1;if(t>=this.spine.length)return!1;(e=new EPUBJS.Chapter(this.spine[t]))&&EPUBJS.core.request(e.absolute)},EPUBJS.Book.prototype.storeOffline=function(){var e=this,t=EPUBJS.core.values(this.manifest);return this.store.put(t).then(function(){e.settings.stored=!0,e.trigger("book:stored")})},EPUBJS.Book.prototype.availableOffline=function(){return 0<this.settings.stored},EPUBJS.Book.prototype.toStorage=function(){var t=this.settings.bookKey;this.store.isStored(t).then(function(e){return!0===e?this.settings.stored=!0:this.storeOffline().then(function(){this.store.token(t,!0)}.bind(this))}.bind(this))},EPUBJS.Book.prototype.fromStorage=function(e){EPUBJS.replace.head,EPUBJS.replace.resources,EPUBJS.replace.svg;this.contained||this.settings.contained||(this.online&&this.opened.then(this.toStorage.bind(this)),this.store&&this.settings.fromStorage&&!1===e?(this.settings.fromStorage=!1,this.store.off("offline"),this.store=!1):this.settings.fromStorage||(this.store=new EPUBJS.Storage(this.settings.credentials),this.store.on("offline",function(e){e?(this.offline=!0,this.settings.fromStorage=!0,this.trigger("book:offline")):(this.offline=!1,this.settings.fromStorage=!1,this.trigger("book:online"))}.bind(this))))},EPUBJS.Book.prototype.setStyle=function(e,t,r){if(!this.isRendered)return this._q.enqueue("setStyle",arguments);this.settings.styles[e]=t,this.renderer.setStyle(e,t,r),-1===["color","background","background-color"].indexOf(e)&&this.renderer.reformat()},EPUBJS.Book.prototype.removeStyle=function(e){if(!this.isRendered)return this._q.enqueue("removeStyle",arguments);this.renderer.removeStyle(e),this.renderer.reformat(),delete this.settings.styles[e]},EPUBJS.Book.prototype.addHeadTag=function(e,t){if(!this.isRendered)return this._q.enqueue("addHeadTag",arguments);this.settings.headTags[e]=t},EPUBJS.Book.prototype.useSpreads=function(e){console.warn("useSpreads is deprecated, use forceSingle or set a layoutOveride instead"),!1===e?this.forceSingle(!0):this.forceSingle(!1)},EPUBJS.Book.prototype.forceSingle=function(e){var t=void 0===e||e;this.renderer.forceSingle(t),this.settings.forceSingle=t,this.isRendered&&this.renderer.reformat()},EPUBJS.Book.prototype.setMinSpreadWidth=function(e){this.settings.minSpreadWidth=e,this.isRendered&&(this.renderer.setMinSpreadWidth(this.settings.minSpreadWidth),this.renderer.reformat())},EPUBJS.Book.prototype.setGap=function(e){this.settings.gap=e,this.isRendered&&(this.renderer.setGap(this.settings.gap),this.renderer.reformat())},EPUBJS.Book.prototype.chapter=function(e){var t,r,n=this.spineIndexByURL[e];return n&&(t=this.spine[n],(r=new EPUBJS.Chapter(t,this.store)).load()),r},EPUBJS.Book.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveContents(),this.unlistenToRenderer(this.renderer),this.trigger("book:unload")},EPUBJS.Book.prototype.destroy=function(){window.removeEventListener("beforeunload",this.unload),this.currentChapter&&this.currentChapter.unload(),this.unload(),this.renderer&&this.renderer.remove()},EPUBJS.Book.prototype._ready=function(){this.trigger("book:ready")},EPUBJS.Book.prototype._rendered=function(e){this.isRendered=!0,this.trigger("book:rendered"),this._q.flush()},EPUBJS.Book.prototype.applyStyles=function(e,t){e.applyStyles(this.settings.styles),t()},EPUBJS.Book.prototype.applyHeadTags=function(e,t){e.applyHeadTags(this.settings.headTags),t()},EPUBJS.Book.prototype._registerReplacements=function(e){e.registerHook("beforeChapterDisplay",this.applyStyles.bind(this,e),!0),e.registerHook("beforeChapterDisplay",this.applyHeadTags.bind(this,e),!0),e.registerHook("beforeChapterDisplay",EPUBJS.replace.hrefs.bind(this),!0)},EPUBJS.Book.prototype._needsAssetReplacement=function(){return!!this.settings.fromStorage||!!this.settings.contained},EPUBJS.Book.prototype.parseLayoutProperties=function(e){return{layout:this.layoutOveride&&this.layoutOveride.layout||e.layout||"reflowable",spread:this.layoutOveride&&this.layoutOveride.spread||e.spread||"auto",orientation:this.layoutOveride&&this.layoutOveride.orientation||e.orientation||"auto"}},RSVP.EventTarget.mixin(EPUBJS.Book.prototype),RSVP.on("error",function(e){}),RSVP.configure("instrument",!1),EPUBJS.Chapter=function(e,t){this.href=e.href,this.absolute=e.url,this.id=e.id,this.spinePos=e.index,this.cfiBase=e.cfiBase,this.properties=e.properties,this.manifestProperties=e.manifestProperties,this.linear=e.linear,this.pages=1,this.store=t,this.epubcfi=new EPUBJS.EpubCFI,this.deferred=new RSVP.defer,this.loaded=this.deferred.promise,EPUBJS.Hooks.mixin(this),this.getHooks("beforeChapterRender"),this.caches={}},EPUBJS.Chapter.prototype.load=function(e){var t=e||this.store,r=t?t.getXml(this.absolute):EPUBJS.core.request(this.absolute,"xml");return r.then(function(e){this.setDocument(e),this.deferred.resolve(this)}.bind(this)),r},EPUBJS.Chapter.prototype.render=function(e){return this.load().then(function(r){var e=r.querySelector("head"),t=r.createElement("base");return t.setAttribute("href",this.absolute),e.insertBefore(t,e.firstChild),this.contents=r,new RSVP.Promise(function(e,t){this.triggerHooks("beforeChapterRender",function(){e(r)}.bind(this),this)}.bind(this))}.bind(this)).then(function(e){return(new XMLSerializer).serializeToString(e)}.bind(this))},EPUBJS.Chapter.prototype.url=function(e){var t,r=new RSVP.defer,n=e||this.store,i=this;return n?this.tempUrl?(t=this.tempUrl,r.resolve(t)):n.getUrl(this.absolute).then(function(e){i.tempUrl=e,r.resolve(e)}):(t=this.absolute,r.resolve(t)),r.promise},EPUBJS.Chapter.prototype.setPages=function(e){this.pages=e},EPUBJS.Chapter.prototype.getPages=function(e){return this.pages},EPUBJS.Chapter.prototype.getID=function(){return this.ID},EPUBJS.Chapter.prototype.unload=function(e){this.document=null,this.tempUrl&&e&&(e.revokeUrl(this.tempUrl),this.tempUrl=!1)},EPUBJS.Chapter.prototype.setDocument=function(e){var t=e.namespaceURI;e.doctype;this.document=e.implementation.createDocument(t,null,null),this.contents=this.document.importNode(e.documentElement,!0),this.document.appendChild(this.contents),!this.document.evaluate&&document.evaluate&&(this.document.evaluate=document.evaluate)},EPUBJS.Chapter.prototype.cfiFromRange=function(e){var t,r,n,i,o;if(this.document){if(void 0!==document.evaluate){if(r=EPUBJS.core.getElementXPath(e.startContainer),n=EPUBJS.core.getElementXPath(e.endContainer),i=this.document.evaluate(r,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,e.collapsed||(o=this.document.evaluate(n,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),t=this.document.createRange(),i)try{t.setStart(i,e.startOffset),!e.collapsed&&o&&t.setEnd(o,e.endOffset)}catch(e){console.log("missed"),i=!1}i||(console.log("not found, try fuzzy match"),cleanStartTextContent=EPUBJS.core.cleanStringForXpath(e.startContainer.textContent),r="//text()[contains(.,"+cleanStartTextContent+")]",(i=this.document.evaluate(r,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&(t.setStart(i,e.startOffset),e.collapsed||(n="//text()[contains(.,"+EPUBJS.core.cleanStringForXpath(e.endContainer.textContent)+")]",(o=this.document.evaluate(n,this.document,EPUBJS.core.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&t.setEnd(o,e.endOffset))))}else t=e;return this.epubcfi.generateCfiFromRange(t,this.cfiBase)}},EPUBJS.Chapter.prototype.find=function(e){var a=this,c=[],h=e.toLowerCase();return this.textSprint(this.document,function(e){!function(e){for(var t,r,n,i=e.textContent.toLowerCase(),o=a.document.createRange(),s=-1;-1!=r;)-1!=(r=i.indexOf(h,s+1))&&((o=a.document.createRange()).setStart(e,r),o.setEnd(e,r+h.length),t=a.cfiFromRange(o),n=e.textContent.length<150?e.textContent:"..."+(n=e.textContent.substring(r-75,r+75))+"...",c.push({cfi:t,excerpt:n})),s=r}(e)}),c},EPUBJS.Chapter.prototype.textSprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return e.data&&!/^\s*$/.test(e.data)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);r=n.nextNode();)t(r)},EPUBJS.Chapter.prototype.replace=function(e,t,n,i){var r=this.contents.querySelectorAll(e),o=Array.prototype.slice.call(r),s=o.length;0!==s?o.forEach(function(e){var r=!1;t(e,function(e,t){!1===r&&(s--,i&&i(e,t,s),s<=0&&n&&n(!0),r=!0)})}.bind(this)):n(!1)},EPUBJS.Chapter.prototype.replaceWithStored=function(o,e,s,t){var a,c={},h=this.store,r=this.caches[o],p=EPUBJS.core.uri(this.absolute).base,l=e;h&&(r=r||{},a=EPUBJS.core.clone(r),this.replace(o,function(e,n){function t(t){var r;e.onload=function(){clearTimeout(r),n(t,i)},e.onerror=function(e){clearTimeout(r),n(t,i),console.error(e)},"image"==o&&e.setAttribute("externalResourcesRequired","true"),"link[href]"==o&&"stylesheet"!==e.getAttribute("rel")?n(t,i):r=setTimeout(function(){n(t,i)},5),e.setAttribute(l,t)}var r=e.getAttribute(l),i=EPUBJS.core.resolveUrl(p,r);i in a?(t(a[i]),c[i]=a[i],delete a[i]):s(h,i,t,e)},function(e){t&&t(),a.forEach(function(e){h.revokeUrl(e)}),r=c},function(e,t,r){c[t]=e}))},(EPUBJS=EPUBJS||{}).core={},EPUBJS.core.getEl=function(e){return document.getElementById(e)},EPUBJS.core.getEls=function(e){return document.getElementsByClassName(e)},EPUBJS.core.request=function(e,t,r){var n=window.URL,i=n?"blob":"arraybuffer",o=new RSVP.defer,s=new XMLHttpRequest,a=XMLHttpRequest.prototype;return"overrideMimeType"in a||Object.defineProperty(a,"overrideMimeType",{value:function(){}}),r&&(s.withCredentials=!0),s.open("GET",e,!0),s.onreadystatechange=function(){{var e;this.readyState===this.DONE&&(200===this.status||0===this.status&&this.response?(e="xml"==t?this.responseXML:"json"==t?JSON.parse(this.response):"blob"!=t||n?this.response:new Blob([this.response]),o.resolve(e)):o.reject({message:this.response,stack:(new Error).stack}))}},"blob"==t&&(s.responseType=i),"json"==t&&s.setRequestHeader("Accept","application/json"),"xml"==t&&s.overrideMimeType("text/xml"),"binary"==t&&(s.responseType="arraybuffer"),s.send(),o.promise},EPUBJS.core.toArray=function(e){var t,r=[];for(var n in e){e.hasOwnProperty(n)&&((t=e[n]).ident=n,r.push(t))}return r},EPUBJS.core.uri=function(e){var t,r,n,i={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:e},o=e.indexOf("blob:"),s=e.indexOf("://"),a=e.indexOf("?"),c=e.indexOf("#");return 0===o?(i.protocol="blob",i.base=e.indexOf(0,c)):(-1!=c&&(i.fragment=e.slice(c+1),e=e.slice(0,c)),-1!=a&&(i.search=e.slice(a+1),e=e.slice(0,a),href=e),-1!=s?(i.protocol=e.slice(0,s),-1===(n=(t=e.slice(s+3)).indexOf("/"))?(i.host=i.path,i.path=""):(i.host=t.slice(0,n),i.path=t.slice(n)),i.origin=i.protocol+"://"+i.host,i.directory=EPUBJS.core.folder(i.path),i.base=i.origin+i.directory):(i.path=e,i.directory=EPUBJS.core.folder(e),i.base=i.directory),i.filename=e.replace(i.base,""),-1!=(r=i.filename.lastIndexOf("."))&&(i.extension=i.filename.slice(r+1))),i},EPUBJS.core.folder=function(e){var t=e.lastIndexOf("/");return-1==t&&0,e.slice(0,t+1)},EPUBJS.core.dataURLToBlob=function(e){var t,r,n,i,o,s=";base64,";if(-1==e.indexOf(s))return r=(t=e.split(","))[0].split(":")[1],n=t[1],new Blob([n],{type:r});r=(t=e.split(s))[0].split(":")[1],i=(n=window.atob(t[1])).length,o=new Uint8Array(i);for(var a=0;a<i;++a)o[a]=n.charCodeAt(a);return new Blob([o],{type:r})},EPUBJS.core.addScript=function(e,t,r){var n=!1,i=document.createElement("script");i.type="text/javascript",i.async=!1,i.src=e,i.onload=i.onreadystatechange=function(){n||this.readyState&&"complete"!=this.readyState||(n=!0,t&&t())},(r=r||document.body).appendChild(i)},EPUBJS.core.addScripts=function(e,t,r){var n=e.length,i=0,o=function(){n==++i?t&&t():EPUBJS.core.addScript(e[i],o,r)};EPUBJS.core.addScript(e[i],o,r)},EPUBJS.core.addCss=function(e,t,r){var n=!1,i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,i.onload=i.onreadystatechange=function(){n||this.readyState&&"complete"!=this.readyState||(n=!0,t&&t())},(r=r||document.body).appendChild(i)},EPUBJS.core.prefixed=function(e){var t=["Webkit","Moz","O","ms"],r=e[0].toUpperCase()+e.slice(1),n=t.length;if(void 0!==document.documentElement.style[e])return e;for(var i=0;i<n;i++)if(void 0!==document.documentElement.style[t[i]+r])return t[i]+r;return e},EPUBJS.core.resolveUrl=function(e,t){var r=[],n=EPUBJS.core.uri(t),i=e.split("/");return n.host?t:(i.pop(),t.split("/").forEach(function(e){".."===e?i.pop():r.push(e)}),i.concat(r).join("/"))},EPUBJS.core.uuid=function(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:7&t|8).toString(16)})},EPUBJS.core.insert=function(e,t,r){var n=EPUBJS.core.locationOf(e,t,r);return t.splice(n,0,e),n},EPUBJS.core.locationOf=function(e,t,r,n,i){var o,s=n||0,a=i||t.length,c=parseInt(s+(a-s)/2);return a-s<=0?c:(o=(r=r||function(e,t){return t<e?1:e<t?-1:(e=t)?0:void 0})(t[c],e),a-s==1?0<o?c:c+1:0===o?c:-1===o?EPUBJS.core.locationOf(e,t,r,c,a):EPUBJS.core.locationOf(e,t,r,s,c))},EPUBJS.core.indexOfSorted=function(e,t,r,n,i){var o,s=n||0,a=i||t.length,c=parseInt(s+(a-s)/2);return a-s<=0?-1:(o=(r=r||function(e,t){return t<e?1:e<t?-1:(e=t)?0:void 0})(t[c],e),a-s==1?0===o?c:-1:0===o?c:-1===o?EPUBJS.core.indexOfSorted(e,t,r,c,a):EPUBJS.core.indexOfSorted(e,t,r,s,c))},EPUBJS.core.queue=function(e){function t(){var e;n.length&&(e=n.shift(),r[e.funcName].apply(e.context||r,e.args))}var n=[],r=e;return{enqueue:function(e,t,r){return n.push({funcName:e,args:t,context:r}),n},dequeue:t,flush:function(){for(;n.length;)t()},clear:function(){n=[]},length:function(){return n.length}}},EPUBJS.core.getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':EPUBJS.core.getElementTreeXPath(e)},EPUBJS.core.getElementTreeXPath=function(e){var t,r,n,i,o=[],s="http://www.w3.org/1999/xhtml"===e.ownerDocument.documentElement.getAttribute("xmlns");for(e.nodeType===Node.TEXT_NODE&&(t=EPUBJS.core.indexOfTextNode(e)+1,o.push("text()["+t+"]"),e=e.parentNode);e&&1==e.nodeType;e=e.parentNode){t=0;for(var a=e.previousSibling;a;a=a.previousSibling)a.nodeType!=Node.DOCUMENT_TYPE_NODE&&a.nodeName==e.nodeName&&++t;r=e.nodeName.toLowerCase(),n=s?"xhtml:"+r:r,i=t?"["+(t+1)+"]":"",o.splice(0,0,n+i)}return o.length?"./"+o.join("/"):null},EPUBJS.core.nsResolver=function(e){return{xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"}[e]||null},EPUBJS.core.cleanStringForXpath=function(e){return"concat('',"+e.match(/[^'"]+|['"]/g).map(function(e){return"'"===e?'"\'"':'"'===e?"'\"'":"'"+e+"'"}).join(",")+")"},EPUBJS.core.indexOfTextNode=function(e){for(var t,r=e.parentNode.childNodes,n=-1,i=0;i<r.length&&((t=r[i]).nodeType===Node.TEXT_NODE&&n++,t!=e);i++);return n},EPUBJS.core.defaults=function(e){for(var t=1,r=arguments.length;t<r;t++){var n=arguments[t];for(var i in n)void 0===e[i]&&(e[i]=n[i])}return e},EPUBJS.core.extend=function(r){return[].slice.call(arguments,1).forEach(function(t){t&&Object.getOwnPropertyNames(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}),r},EPUBJS.core.clone=function(e){return EPUBJS.core.isArray(e)?e.slice():EPUBJS.core.extend({},e)},EPUBJS.core.isElement=function(e){return!(!e||1!=e.nodeType)},EPUBJS.core.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},EPUBJS.core.isString=function(e){return"string"==typeof e||e instanceof String},EPUBJS.core.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},EPUBJS.core.values=function(e){for(var t=-1,r=Object.keys(e),n=r.length,i=Array(n);++t<n;)i[t]=e[r[t]];return i},EPUBJS.EpubCFI=function(e){if(e)return this.parse(e)},EPUBJS.EpubCFI.prototype.generateChapterComponent=function(e,t,r){var n="/"+(e+1)+"/";return n+=2*(parseInt(t)+1),r&&(n+="["+r+"]"),n},EPUBJS.EpubCFI.prototype.generatePathComponent=function(e){var r=[];return e.forEach(function(e){var t="";t+=2*(e.index+1),e.id&&(t+="["+e.id+"]"),r.push(t)}),r.join("/")},EPUBJS.EpubCFI.prototype.generateCfiFromElement=function(e,t){var r=this.pathTo(e),n=this.generatePathComponent(r);return n.length?"epubcfi("+t+"!"+n+"/1:0)":"epubcfi("+t+"!/4/)"},EPUBJS.EpubCFI.prototype.pathTo=function(e){for(var t,r=[];e&&null!==e.parentNode&&9!=e.parentNode.nodeType;)t=e.parentNode.children,r.unshift({id:e.id,tagName:e.tagName,index:t?Array.prototype.indexOf.call(t,e):0}),e=e.parentNode;return r},EPUBJS.EpubCFI.prototype.getChapterComponent=function(e){return e.split("!")[0]},EPUBJS.EpubCFI.prototype.getPathComponent=function(e){var t=e.split("!");return(t[1]?t[1].split(":"):"")[0]},EPUBJS.EpubCFI.prototype.getCharecterOffsetComponent=function(e){return e.split(":")[1]||""},EPUBJS.EpubCFI.prototype.parse=function(e){function r(e){var t,r=parseInt(e)/2-1,n=e.match(/\[(.*)\]/);return n&&n[1]&&(t=n[1]),{type:"element",index:r,id:t||!1}}var t,n,i,o,s,a,c,h,p,l={};return"string"!=typeof e?{spinePos:-1}:(0===(l.str=e).indexOf("epubcfi(")&&")"===e[e.length-1]&&(e=e.slice(8,e.length-1)),n=this.getChapterComponent(e),i=this.getPathComponent(e)||"",o=this.getCharecterOffsetComponent(e),n&&(t=n.split("/")[2]||"")?(l.spinePos=parseInt(t)/2-1||0,a=t.match(/\[(.*)\]/),l.spineId=!!a&&a[1],-1!=i.indexOf(",")&&console.warn("CFI Ranges are not supported"),h=(c=i.split("/")).pop(),l.steps=[],c.forEach(function(e){var t;e&&(t=r(e),l.steps.push(t))}),p=parseInt(h),isNaN(p)||(p%2==0?l.steps.push(r(h)):l.steps.push({type:"text",index:(p-1)/2})),(s=o.match(/\[(.*)\]/))&&s[1]?(l.characterOffset=parseInt(o.split("[")[0]),l.textLocationAssertion=s[1]):l.characterOffset=parseInt(o),l):{spinePos:-1})},EPUBJS.EpubCFI.prototype.addMarker=function(e,t,r){var n,i,o,s,a=t||document,c=r||this.createMarker(a);return"string"==typeof e&&(e=this.parse(e)),i=e.steps[e.steps.length-1],-1!==e.spinePos&&(!!(n=this.findParent(e,a))&&(i&&"text"===i.type?(o=n.childNodes[i.index],e.characterOffset?(s=o.splitText(e.characterOffset),c.classList.add("EPUBJS-CFI-SPLIT"),n.insertBefore(c,s)):n.insertBefore(c,o)):n.insertBefore(c,n.firstChild),c))},EPUBJS.EpubCFI.prototype.createMarker=function(e){var t=(e||document).createElement("span");return t.id="EPUBJS-CFI-MARKER:"+EPUBJS.core.uuid(),t.classList.add("EPUBJS-CFI-MARKER"),t},EPUBJS.EpubCFI.prototype.removeMarker=function(e,t){t||document;e.classList.contains("EPUBJS-CFI-SPLIT")?(nextSib=e.nextSibling,prevSib=e.previousSibling,nextSib&&prevSib&&3===nextSib.nodeType&&3===prevSib.nodeType&&(prevSib.textContent+=nextSib.textContent,e.parentNode.removeChild(nextSib)),e.parentNode.removeChild(e)):e.classList.contains("EPUBJS-CFI-MARKER")&&e.parentNode.removeChild(e)},EPUBJS.EpubCFI.prototype.findParent=function(e,t){var r,n,i=t||document,o=i.getElementsByTagName("html")[0],s=Array.prototype.slice.call(o.children);if("string"==typeof e&&(e=this.parse(e)),!(n=e.steps.slice(0)).length)return i.getElementsByTagName("body")[0];for(;n&&0<n.length;){if(void 0===(o="text"===(r=n.shift()).type?o.childNodes[r.index].parentNode||o:r.id?i.getElementById(r.id):s[r.index]))return console.error("No Element For",r,e.str),!1;s=Array.prototype.slice.call(o.children)}return o},EPUBJS.EpubCFI.prototype.compare=function(e,t){if("string"==typeof e&&(e=new EPUBJS.EpubCFI(e)),"string"==typeof t&&(t=new EPUBJS.EpubCFI(t)),e.spinePos>t.spinePos)return 1;if(e.spinePos<t.spinePos)return-1;for(var r=0;r<e.steps.length;r++){if(!t.steps[r])return 1;if(e.steps[r].index>t.steps[r].index)return 1;if(e.steps[r].index<t.steps[r].index)return-1}return e.steps.length<t.steps.length?-1:e.characterOffset>t.characterOffset?1:e.characterOffset<t.characterOffset?-1:0},EPUBJS.EpubCFI.prototype.generateCfiFromHref=function(e,t){var n,r=EPUBJS.core.uri(e),i=r.path,o=r.fragment,s=t.spineIndexByURL[i],a=new RSVP.defer,c=new EPUBJS.EpubCFI;return void 0!==s&&(n=t.spine[s],t.loadXml(n.url).then(function(e){var t=e.getElementById(o),r=c.generateCfiFromElement(t,n.cfiBase);a.resolve(r)})),a.promise},EPUBJS.EpubCFI.prototype.generateCfiFromTextNode=function(e,t,r){var n=e.parentNode,i=this.pathTo(n);return"epubcfi("+r+"!"+this.generatePathComponent(i)+"/"+(1+2*Array.prototype.indexOf.call(n.childNodes,e))+":"+(t||0)+")"},EPUBJS.EpubCFI.prototype.generateCfiFromRangeAnchor=function(e,t){var r=e.anchorNode,n=e.anchorOffset;return this.generateCfiFromTextNode(r,n,t)},EPUBJS.EpubCFI.prototype.generateCfiFromRange=function(e,t){var r,n,i,o,s,a,c,h,p,l,u,d=e.startContainer;if(3===d.nodeType)r=d.parentNode,s=1+2*EPUBJS.core.indexOfTextNode(d),n=this.pathTo(r);else{if(e.collapsed)return this.generateCfiFromElement(d,t);n=this.pathTo(d)}return i=this.generatePathComponent(n),o=e.startOffset,e.collapsed?"epubcfi("+t+"!"+i+"/"+s+":"+o+")":(h=3===(a=e.endContainer).nodeType?(c=a.parentNode,u=1+2*EPUBJS.core.indexOfTextNode(a),this.pathTo(c)):this.pathTo(a),p=this.generatePathComponent(h),l=e.endOffset,(p=p.replace(i,"")).length&&(p+="/"),"epubcfi("+t+"!"+i+"/"+s+":"+o+","+p+u+":"+l+")")},EPUBJS.EpubCFI.prototype.generateXpathFromSteps=function(e){var r=[".","*"];return e.forEach(function(e){var t=e.index+1;e.id?r.push("*[position()="+t+" and @id='"+e.id+"']"):"text"===e.type?r.push("text()["+t+"]"):r.push("*["+t+"]")}),r.join("/")},EPUBJS.EpubCFI.prototype.generateQueryFromSteps=function(e){var r=["html"];return e.forEach(function(e){var t=e.index+1;e.id?r.push("#"+e.id):"text"===e.type||r.push("*:nth-child("+t+")")}),r.join(">")},EPUBJS.EpubCFI.prototype.generateRangeFromCfi=function(e,t){var r,n,i,o,s,a,c=t||document,h=c.createRange();return"string"==typeof e&&(e=this.parse(e)),-1!==e.spinePos&&(r=e.steps[e.steps.length-1],void 0!==document.evaluate?(n=this.generateXpathFromSteps(e.steps),i=c.evaluate(n,c,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):(s=this.generateQueryFromSteps(e.steps),(a=c.querySelector(s))&&"text"==r.type&&(i=a.childNodes[r.index])),i?(i&&0<=e.characterOffset?(o=i.length,e.characterOffset<o?h.setStart(i,e.characterOffset):(console.debug("offset greater than length:",e.characterOffset,o),h.setStart(i,o-1)),h.setEnd(i,o)):i&&h.selectNode(i),h):null)},EPUBJS.EpubCFI.prototype.isCfiString=function(e){return"string"==typeof e&&0===e.indexOf("epubcfi(")},EPUBJS.Events=function(e,t){return this.events={},this.el=t||document.createElement("div"),e.createEvent=this.createEvent,e.tell=this.tell,e.listen=this.listen,e.deafen=this.deafen,e.listenUntil=this.listenUntil,this},EPUBJS.Events.prototype.createEvent=function(e){var t=new CustomEvent(e);return this.events[e]=t},EPUBJS.Events.prototype.tell=function(e,t){var r=this.events[e]?this.events[e]:(console.warn("No event:",e,"defined yet, creating."),this.createEvent(e));t&&(r.msg=t),this.el.dispatchEvent(r)},EPUBJS.Events.prototype.listen=function(e,t,r){if(!this.events[e])return console.warn("No event:",e,"defined yet, creating."),void this.createEvent(e);r?this.el.addEventListener(e,t.bind(r),!1):this.el.addEventListener(e,t,!1)},EPUBJS.Events.prototype.deafen=function(e,t){this.el.removeEventListener(e,t,!1)},EPUBJS.Events.prototype.listenUntil=function(t,r,n,e){this.listen(t,n,e),this.listen(r,function e(){this.deafen(t,n),this.deafen(r,e)},this)},EPUBJS.hooks={},EPUBJS.Hooks=function(){function r(){}return r.prototype.getHooks=function(){for(var t in this.hooks={},Array.prototype.slice.call(arguments).forEach(function(e){this.hooks[e]=[]},this),this.hooks)EPUBJS.core.values(EPUBJS.hooks[t]).forEach(function(e){this.registerHook(t,e)},this)},r.prototype.registerHook=function(t,e,r){void 0!==this.hooks[t]?"function"==typeof e?r?this.hooks[t].unshift(e):this.hooks[t].push(e):Array.isArray(e)&&e.forEach(function(e){r?this.hooks[t].unshift(e):this.hooks[t].push(e)},this):(this.hooks[t]=[e],"function"==typeof e?this.hooks[t]=[e]:Array.isArray(e)&&(this.hooks[t]=[],e.forEach(function(e){this.hooks[t].push(e)},this)))},r.prototype.removeHook=function(t,e){var r;void 0!==this.hooks[t]&&("function"==typeof e?-1<(r=this.hooks[t].indexOf(e))&&this.hooks[t].splice(r,1):Array.isArray(e)&&e.forEach(function(e){-1<(r=this.hooks[t].indexOf(e))&&this.hooks[t].splice(r,1)},this))},r.prototype.triggerHooks=function(e,t,r){var n,i;if(void 0===this.hooks[e])return!1;function o(){--i<=0&&t&&t()}n=this.hooks[e],0===(i=n.length)&&t&&t(),n.forEach(function(e){e(o,r)})},{register:function(e){if(void 0===EPUBJS.hooks[e]&&(EPUBJS.hooks[e]={}),"object"!=typeof EPUBJS.hooks[e])throw"Already registered: "+e;return EPUBJS.hooks[e]},mixin:function(e){for(var t in r.prototype)e[t]=r.prototype[t]}}}(),EPUBJS.Layout=EPUBJS.Layout||{},EPUBJS.Layout.Reflowable=function(){this.documentElement=null,this.spreadWidth=null},EPUBJS.Layout.Reflowable.prototype.format=function(e,t,r,n){var i=EPUBJS.core.prefixed("columnAxis"),o=EPUBJS.core.prefixed("columnGap"),s=EPUBJS.core.prefixed("columnWidth"),a=EPUBJS.core.prefixed("columnFill"),c=Math.floor(t),h=Math.floor(c/8),p=0<=n?n:h%2==0?h:h-1;return this.documentElement=e,this.spreadWidth=c+p,e.style.overflow="hidden",e.style.width=c+"px",e.style.height=r+"px",e.style[i]="horizontal",e.style[a]="auto",e.style[s]=c+"px",e.style[o]=p+"px",this.colWidth=c,this.gap=p,{pageWidth:this.spreadWidth,pageHeight:r}},EPUBJS.Layout.Reflowable.prototype.calculatePages=function(){var e,t;return this.documentElement.style.width="auto",e=this.documentElement.scrollWidth,{displayedPages:t=Math.ceil(e/this.spreadWidth),pageCount:t}},EPUBJS.Layout.ReflowableSpreads=function(){this.documentElement=null,this.spreadWidth=null},EPUBJS.Layout.ReflowableSpreads.prototype.format=function(e,t,r,n){var i=EPUBJS.core.prefixed("columnAxis"),o=EPUBJS.core.prefixed("columnGap"),s=EPUBJS.core.prefixed("columnWidth"),a=EPUBJS.core.prefixed("columnFill"),c=Math.floor(t),h=c%2==0?c:c-1,p=Math.floor(h/8),l=0<=n?n:p%2==0?p:p-1,u=Math.floor((h-l)/2);return this.documentElement=e,this.spreadWidth=2*(u+l),e.style.overflow="hidden",e.style.width=h+"px",e.style.height=r+"px",e.style[i]="horizontal",e.style[a]="auto",e.style[o]=l+"px",e.style[s]=u+"px",this.colWidth=u,this.gap=l,{pageWidth:this.spreadWidth,pageHeight:r}},EPUBJS.Layout.ReflowableSpreads.prototype.calculatePages=function(){var e=this.documentElement.scrollWidth,t=Math.ceil(e/this.spreadWidth);return this.documentElement.style.width=t*this.spreadWidth-this.gap+"px",{displayedPages:t,pageCount:2*t}},EPUBJS.Layout.Fixed=function(){this.documentElement=null},EPUBJS.Layout.Fixed.prototype.format=function(e,t,r,n){var i,o,s,a=EPUBJS.core.prefixed("columnWidth"),c=e.querySelector("[name=viewport]");return this.documentElement=e,c&&c.hasAttribute("content")&&((i=c.getAttribute("content").split(","))[0]&&(o=i[0].replace("width=","")),i[1]&&(s=i[1].replace("height=",""))),e.style.width=o+"px"||"auto",e.style.height=s+"px"||"auto",e.style[a]="auto",e.style.overflow="auto",this.colWidth=o,this.gap=0,{pageWidth:o,pageHeight:s}},EPUBJS.Layout.Fixed.prototype.calculatePages=function(){return{displayedPages:1,pageCount:1}},EPUBJS.Locations=function(e,t){this.spine=e,this.store=t,this.epubcfi=new EPUBJS.EpubCFI,this._locations=[],this.total=0,this.break=150,this._current=0},EPUBJS.Locations.prototype.generate=function(e){var t=new RSVP.defer,i=-1,o=this.spine.length,s=function(e){var t,r=i+1,n=e||new RSVP.defer;return o<=r?n.resolve():(i=r,t=new EPUBJS.Chapter(this.spine[i],this.store),this.process(t).then(function(){setTimeout(function(){s(n)},1)})),n.promise}.bind(this);s().then(function(){this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),t.resolve(this._locations)}.bind(this));return t.promise},EPUBJS.Locations.prototype.process=function(a){return a.load(this.request).then(function(e){var n,i,o=e,t=o.documentElement.querySelector("body"),s=0;this.sprint(t,function(e){var t=e.length,r=0;for(0===s&&(n=o.createRange()).setStart(e,0),t<this.break-s&&(s+=t,r=t);r<t;)s=this.break,t<=(r+=this.break)?s=t-(r-this.break):(n.setEnd(e,r),cfi=a.cfiFromRange(n),this._locations.push(cfi),s=0,r+=1,(n=o.createRange()).setStart(e,r));i=e}.bind(this)),n&&(n.setEnd(i,i.length),cfi=a.cfiFromRange(n),this._locations.push(cfi),s=0)}.bind(this))},EPUBJS.Locations.prototype.sprint=function(e,t){for(var r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);node=r.nextNode();)t(node)},EPUBJS.Locations.prototype.locationFromCfi=function(e){return 0===this._locations.length?-1:EPUBJS.core.locationOf(e,this._locations,this.epubcfi.compare)},EPUBJS.Locations.prototype.percentageFromCfi=function(e){var t=this.locationFromCfi(e);return this.percentageFromLocation(t)},EPUBJS.Locations.prototype.percentageFromLocation=function(e){return e&&this.total?e/this.total:0},EPUBJS.Locations.prototype.cfiFromLocation=function(e){var t=-1;return"number"!=typeof e&&(e=parseInt(e)),0<=e&&e<this._locations.length&&(t=this._locations[e]),t},EPUBJS.Locations.prototype.cfiFromPercentage=function(e){var t=1<e?e/100:e,r=Math.ceil(this.total*t);return this.cfiFromLocation(r)},EPUBJS.Locations.prototype.load=function(e){return this._locations=JSON.parse(e),this.total=this._locations.length-1,this._locations},EPUBJS.Locations.prototype.save=function(e){return JSON.stringify(this._locations)},EPUBJS.Locations.prototype.getCurrent=function(e){return this._current},EPUBJS.Locations.prototype.setCurrent=function(e){var t;if("string"==typeof e)this._currentCfi=e;else{if("number"!=typeof e)return;this._current=e}0!==this._locations.length&&("string"==typeof e?(t=this.locationFromCfi(e),this._current=t):t=e,this.trigger("changed",{percentage:this.percentageFromLocation(t)}))},Object.defineProperty(EPUBJS.Locations.prototype,"currentLocation",{get:function(){return this._current},set:function(e){this.setCurrent(e)}}),RSVP.EventTarget.mixin(EPUBJS.Locations.prototype),EPUBJS.Pagination=function(e){this.pages=[],this.locations=[],this.epubcfi=new EPUBJS.EpubCFI,e&&e.length&&this.process(e)},EPUBJS.Pagination.prototype.process=function(e){e.forEach(function(e){this.pages.push(e.page),this.locations.push(e.cfi)},this),this.pageList=e,this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage},EPUBJS.Pagination.prototype.pageFromCfi=function(e){var t=-1;if(0===this.locations.length)return-1;var r=EPUBJS.core.indexOfSorted(e,this.locations,this.epubcfi.compare);return-1!=r&&r<this.pages.length-1?t=this.pages[r]:void 0!==(t=0<=(r=EPUBJS.core.locationOf(e,this.locations,this.epubcfi.compare))-1?this.pages[r-1]:this.pages[0])||(t=-1),t},EPUBJS.Pagination.prototype.cfiFromPage=function(e){var t=-1;"number"!=typeof e&&(e=parseInt(e));var r=this.pages.indexOf(e);return-1!=r&&(t=this.locations[r]),t},EPUBJS.Pagination.prototype.pageFromPercentage=function(e){return Math.round(this.totalPages*e)},EPUBJS.Pagination.prototype.percentageFromPage=function(e){var t=(e-this.firstPage)/this.totalPages;return Math.round(1e3*t)/1e3},EPUBJS.Pagination.prototype.percentageFromCfi=function(e){var t=this.pageFromCfi(e);return this.percentageFromPage(t)},EPUBJS.Parser=function(e){this.baseUrl=e||""},EPUBJS.Parser.prototype.container=function(e){var t,r;if(e){if(t=e.querySelector("rootfile"))return{packagePath:r=t.getAttribute("full-path"),basePath:EPUBJS.core.uri(r).directory,encoding:e.xmlEncoding};console.error("No RootFile Found")}else console.error("Container File Not Found")},EPUBJS.Parser.prototype.identifier=function(e){var t;if(e){if(t=e.querySelector("metadata"))return this.getElementText(t,"identifier");console.error("No Metadata Found")}else console.error("Package File Not Found")},EPUBJS.Parser.prototype.packageContents=function(e,t){var r,n,i,o,s,a,c,h,p,l,u,d=this;if(t&&(this.baseUrl=t),e)if(r=e.querySelector("metadata"))if(n=e.querySelector("manifest")){if(i=e.querySelector("spine"))return o=d.manifest(n),s=d.findNavPath(n),a=d.findTocPath(n,i),c=d.findCoverPath(n),h=Array.prototype.indexOf.call(i.parentNode.childNodes,i),p=d.spine(i,o),l={},p.forEach(function(e){l[e.href]=e.index}),(u=d.metadata(r)).direction=i.getAttribute("page-progression-direction"),{metadata:u,spine:p,manifest:o,navPath:s,tocPath:a,coverPath:c,spineNodeIndex:h,spineIndexByURL:l};console.error("No Spine Found")}else console.error("No Manifest Found");else console.error("No Metadata Found");else console.error("Package File Not Found")},EPUBJS.Parser.prototype.findNavPath=function(e){var t=e.querySelector("item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']");return!!t&&t.getAttribute("href")},EPUBJS.Parser.prototype.findTocPath=function(e,t){var r,n=e.querySelector("item[media-type='application/x-dtbncx+xml']");return n||(r=t.getAttribute("toc"))&&(n=e.querySelector("item[id='"+r+"']")),!!n&&n.getAttribute("href")},EPUBJS.Parser.prototype.findCoverPath=function(e){var t=e.querySelector("item[properties='cover-image']");return!!t&&t.getAttribute("href")},EPUBJS.Parser.prototype.metadata=function(e){var t={},r=this;return t.bookTitle=r.getElementText(e,"title"),t.creator=r.getElementText(e,"creator"),t.description=r.getElementText(e,"description"),t.pubdate=r.getElementText(e,"date"),t.publisher=r.getElementText(e,"publisher"),t.identifier=r.getElementText(e,"identifier"),t.language=r.getElementText(e,"language"),t.rights=r.getElementText(e,"rights"),t.modified_date=r.querySelectorText(e,"meta[property='dcterms:modified']"),t.layout=r.querySelectorText(e,"meta[property='rendition:layout']"),t.orientation=r.querySelectorText(e,"meta[property='rendition:orientation']"),t.spread=r.querySelectorText(e,"meta[property='rendition:spread']"),t},EPUBJS.Parser.prototype.getElementText=function(e,t){var r,n=e.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",t);return n&&0!==n.length&&(r=n[0]).childNodes.length?r.childNodes[0].nodeValue:""},EPUBJS.Parser.prototype.querySelectorText=function(e,t){var r=e.querySelector(t);return r&&r.childNodes.length?r.childNodes[0].nodeValue:""},EPUBJS.Parser.prototype.manifest=function(e){var o=this.baseUrl,s={},t=e.querySelectorAll("item");return Array.prototype.slice.call(t).forEach(function(e){var t=e.getAttribute("id"),r=e.getAttribute("href")||"",n=e.getAttribute("media-type")||"",i=e.getAttribute("properties")||"";s[t]={href:r,url:o+r,type:n,properties:i}}),s},EPUBJS.Parser.prototype.spine=function(e,h){var p=[],t=e.getElementsByTagName("itemref"),r=Array.prototype.slice.call(t),l=Array.prototype.indexOf.call(e.parentNode.childNodes,e),u=new EPUBJS.EpubCFI;return r.forEach(function(e,t){var r=e.getAttribute("idref"),n=u.generateChapterComponent(l,t,r),i=e.getAttribute("properties")||"",o=i.length?i.split(" "):[],s=h[r].properties,a=s.length?s.split(" "):[],c={id:r,linear:e.getAttribute("linear")||"",properties:o,manifestProperties:a,href:h[r].href,url:h[r].url,index:t,cfiBase:n,cfi:"epub("+n+")"};p.push(c)}),p},EPUBJS.Parser.prototype.nav=function(e,g,m){var t=e.querySelector('nav[*|type="toc"]'),y=0;if(!t)return[];return function u(d){var e,t,f=[],r=(e=d,t=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){"ol"==e.tagName&&Array.prototype.slice.call(e.childNodes).forEach(function(e){"li"==e.tagName&&t.push(e)})}),t),n=Array.prototype.slice.call(r);return 0!==n.length&&(n.forEach(function(e){var t,r,n=e.getAttribute("id")||!1,i=(t=e,r=null,Array.prototype.slice.call(t.childNodes).forEach(function(e){"a"!=e.tagName&&"span"!=e.tagName||(r=e)}),r),o=i.getAttribute("href")||"",s=i.textContent||"",a=o.split("#")[0],c=u(e),h=g[a],p=m[h],l=p?p.cfi:"";n||(h?(n=(p=m[h]).id,l=p.cfi):n="epubjs-autogen-toc-id-"+y++),e.setAttribute("id",n),f.push({id:n,href:o,label:s,subitems:c,parent:d?d.getAttribute("id"):null,cfi:l})}),f)}(t)},EPUBJS.Parser.prototype.toc=function(m,y,E){var e=m.querySelector("navMap");if(!e)return[];return function e(t){var r=[],n=m.evaluate("*[local-name()='navPoint']",t,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),i=n.snapshotLength;if(0===i)return[];for(var o=i-1;0<=o;o--){var s=n.snapshotItem(o),a=s.getAttribute("id")||!1,c=s.querySelector("content").getAttribute("src"),h=s.querySelector("navLabel"),p=h.textContent?h.textContent:"",l=c.split("#")[0],u=y[l],d=E[u],f=e(s),g=d?d.cfi:"";a||(u?(a=(d=E[u]).id,g=d.cfi):a="epubjs-autogen-toc-id-"+idCounter++),r.unshift({id:a,href:c,label:p,spinePos:u,subitems:f,parent:t?t.getAttribute("id"):null,cfi:g})}return r}(e)},EPUBJS.Parser.prototype.pageList=function(e,t,r){var n,i,p,o,s,a=e.querySelector('nav[*|type="page-list"]');if(!a)return[];return p=[],n=a,i=[],Array.prototype.slice.call(n.childNodes).forEach(function(e){"ol"==e.tagName&&Array.prototype.slice.call(e.childNodes).forEach(function(e){"li"==e.tagName&&i.push(e)})}),o=i,0!==(s=Array.prototype.slice.call(o)).length&&(s.forEach(function(e){e.getAttribute("id");var t,r,n,i,o,s=(i=e,o=null,Array.prototype.slice.call(i.childNodes).forEach(function(e){"a"!=e.tagName&&"span"!=e.tagName||(o=e)}),o),a=s.getAttribute("href")||"",c=s.textContent||"",h=parseInt(c);-1!=a.indexOf("epubcfi")?(r=(t=a.split("#"))[0],n=1<t.length&&t[1],p.push({cfi:n,href:a,packageUrl:r,page:h})):p.push({href:a,page:h})}),p)},EPUBJS.Render.Iframe=function(){this.iframe=null,this.document=null,this.window=null,this.docEl=null,this.bodyEl=null,this.leftPos=0,this.pageWidth=0,this.isMobile=navigator.userAgent.match(/(iPad|iPhone|iPod|Mobile|Android)/g),this.transform=EPUBJS.core.prefixed("transform")},EPUBJS.Render.Iframe.prototype.create=function(){return this.iframe=document.createElement("iframe"),this.iframe.id="epubjs-iframe:"+EPUBJS.core.uuid(),this.iframe.scrolling="no",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.addEventListener("load",this.loaded.bind(this),!1),this.iframe},EPUBJS.Render.Iframe.prototype.load=function(e,t){var r=this,n=new RSVP.defer;return this.window&&this.unload(),this.iframe.onload=function(e){r.document=r.iframe.contentDocument,r.docEl=r.document.documentElement,r.headEl=r.document.head,r.bodyEl=r.document.body||r.document.querySelector("body"),r.window=r.iframe.contentWindow,r.window.addEventListener("resize",r.resized.bind(r),!1),r.leftPos=0,r.setLeft(0),r.bodyEl&&(r.bodyEl.style.margin="0"),"rtl"==r.direction&&"rtl"!=r.docEl.dir&&(r.docEl.dir="rtl",r.docEl.style.position="absolute",r.docEl.style.right="0"),n.resolve(r.docEl)},this.iframe.onerror=function(e){n.reject({message:"Error Loading Contents: "+e,stack:(new Error).stack})},this.document=this.iframe.contentDocument,this.document?(this.document.open(),this.document.write(e),this.document.close(),n.promise):(n.reject(new Error("No Document Available")),n)},EPUBJS.Render.Iframe.prototype.loaded=function(e){var t,r=this.iframe.contentWindow.location.href;this.document=this.iframe.contentDocument,this.docEl=this.document.documentElement,this.headEl=this.document.head,this.bodyEl=this.document.body||this.document.querySelector("body"),this.window=this.iframe.contentWindow,"about:blank"!=r&&(t=this.iframe.contentDocument.querySelector("base").getAttribute("href"),this.trigger("render:loaded",t))},EPUBJS.Render.Iframe.prototype.resize=function(e,t){this.iframe&&(this.iframe.height=t,isNaN(e)||e%2==0||(e+=1),this.iframe.width=e,this.width=this.iframe.getBoundingClientRect().width||e,this.height=this.iframe.getBoundingClientRect().height||t)},EPUBJS.Render.Iframe.prototype.resized=function(e){this.width=this.iframe.getBoundingClientRect().width,this.height=this.iframe.getBoundingClientRect().height},EPUBJS.Render.Iframe.prototype.totalWidth=function(){return this.docEl.scrollWidth},EPUBJS.Render.Iframe.prototype.totalHeight=function(){return this.docEl.scrollHeight},EPUBJS.Render.Iframe.prototype.setPageDimensions=function(e,t){this.pageWidth=e,this.pageHeight=t},EPUBJS.Render.Iframe.prototype.setDirection=function(e){this.direction=e,this.docEl&&"rtl"==this.docEl.dir&&(this.docEl.dir="rtl",this.docEl.style.position="static",this.docEl.style.right="auto")},EPUBJS.Render.Iframe.prototype.setLeft=function(e){this.isMobile?this.docEl.style[this.transform]="translate("+-e+"px, 0)":this.document.defaultView.scrollTo(e,0)},EPUBJS.Render.Iframe.prototype.setStyle=function(e,t,r){r&&(e=EPUBJS.core.prefixed(e)),this.bodyEl&&(this.bodyEl.style[e]=t)},EPUBJS.Render.Iframe.prototype.removeStyle=function(e){this.bodyEl&&(this.bodyEl.style[e]="")},EPUBJS.Render.Iframe.prototype.addHeadTag=function(e,t,r){var n=r||this.document,i=n.createElement(e),o=n.head;for(var s in t)i.setAttribute(s,t[s]);o&&o.insertBefore(i,o.firstChild)},EPUBJS.Render.Iframe.prototype.page=function(e){this.leftPos=this.pageWidth*(e-1),"rtl"===this.direction&&(this.leftPos=-1*this.leftPos),this.setLeft(this.leftPos)},EPUBJS.Render.Iframe.prototype.getPageNumberByElement=function(e){var t;if(e)return t=this.leftPos+e.getBoundingClientRect().left,Math.floor(t/this.pageWidth)+1},EPUBJS.Render.Iframe.prototype.getPageNumberByRect=function(e){var t=this.leftPos+e.left;return Math.floor(t/this.pageWidth)+1},EPUBJS.Render.Iframe.prototype.getBaseElement=function(){return this.bodyEl},EPUBJS.Render.Iframe.prototype.getDocumentElement=function(){return this.docEl},EPUBJS.Render.Iframe.prototype.isElementVisible=function(e){var t,r;return!!(e&&"function"==typeof e.getBoundingClientRect&&(r=(t=e.getBoundingClientRect()).left,0!==t.width&&0!==t.height&&0<=r&&r<this.pageWidth))},EPUBJS.Render.Iframe.prototype.scroll=function(e){this.iframe.scrolling=e?"yes":"no"},EPUBJS.Render.Iframe.prototype.unload=function(){this.window.removeEventListener("resize",this.resized)},RSVP.EventTarget.mixin(EPUBJS.Render.Iframe.prototype),EPUBJS.Renderer=function(e,t){this.listenedEvents=["keydown","keyup","keypressed","mouseup","mousedown","click"],this.upEvent="mouseup",this.downEvent="mousedown","ontouchstart"in document.documentElement&&(this.listenedEvents.push("touchstart","touchend"),this.upEvent="touchend",this.downEvent="touchstart"),e&&void 0!==EPUBJS.Render[e]?this.render=new EPUBJS.Render[e]:console.error("Not a Valid Rendering Method"),this.render.on("render:loaded",this.loaded.bind(this)),this.caches={},this.epubcfi=new EPUBJS.EpubCFI,this.spreads=!0,this.isForcedSingle=!1,this.resized=this.onResized.bind(this),this.layoutSettings={},this.hidden=t||!1,EPUBJS.Hooks.mixin(this),this.getHooks("beforeChapterDisplay"),this._q=EPUBJS.core.queue(this),this._moving=!1},EPUBJS.Renderer.prototype.Events=["renderer:keydown","renderer:keyup","renderer:keypressed","renderer:mouseup","renderer:mousedown","renderer:click","renderer:touchstart","renderer:touchend","renderer:selected","renderer:chapterUnloaded","renderer:chapterDisplayed","renderer:locationChanged","renderer:visibleLocationChanged","renderer:resized","renderer:spreads"],EPUBJS.Renderer.prototype.initialize=function(e,t,r){this.container=e,this.element=this.render.create(),this.initWidth=t,this.initHeight=r,this.width=t||this.container.clientWidth,this.height=r||this.container.clientHeight,this.container.appendChild(this.element),t&&r?this.render.resize(this.width,this.height):this.render.resize("100%","100%"),document.addEventListener("orientationchange",this.onResized)},EPUBJS.Renderer.prototype.displayChapter=function(t,r){if(!this._moving)return this._moving=!0,t.render().then(function(e){return this.currentChapter&&(this.currentChapter.unload(),this.render.window&&this.render.window.removeEventListener("resize",this.resized),this.removeEventListeners(),this.removeSelectionListeners(),this.trigger("renderer:chapterUnloaded"),this.contents=null,this.doc=null,this.pageMap=null),this.currentChapter=t,this.chapterPos=1,this.currentChapterCfiBase=t.cfiBase,this.layoutSettings=this.reconcileLayoutSettings(r,t.properties),this.load(e,t.href)}.bind(this));console.error("Rendering In Progress")},EPUBJS.Renderer.prototype.load=function(e,t){var r=new RSVP.defer;return this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod],this.visible(!1),render=this.render.load(e,t),render.then(function(e){this.afterLoad(e),this.beforeDisplay(function(){this.afterDisplay(),this.visible(!0),r.resolve(this)}.bind(this))}.bind(this)),r.promise},EPUBJS.Renderer.prototype.afterLoad=function(e){this.currentChapter.setDocument(this.render.document),this.contents=e,this.doc=this.render.document,this.formated=this.layout.format(e,this.render.width,this.render.height,this.gap),this.render.setPageDimensions(this.formated.pageWidth,this.formated.pageHeight),this.initWidth||this.initHeight||this.render.window.addEventListener("resize",this.resized,!1),this.addEventListeners(),this.addSelectionListeners()},EPUBJS.Renderer.prototype.afterDisplay=function(e){var t=this.layout.calculatePages(),r=this.currentChapter,n=this._q.length();this._moving=!1,this.updatePages(t),this.visibleRangeCfi=this.getVisibleRangeCfi(),this.currentLocationCfi=this.visibleRangeCfi.start,0===n&&(this.trigger("renderer:locationChanged",this.currentLocationCfi),this.trigger("renderer:visibleRangeChanged",this.visibleRangeCfi)),r.cfi=this.currentLocationCfi,this.trigger("renderer:chapterDisplayed",r)},EPUBJS.Renderer.prototype.loaded=function(e){this.trigger("render:loaded",e)},EPUBJS.Renderer.prototype.reconcileLayoutSettings=function(e,t){var o={};for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);return t.forEach(function(e){var t,r,n=e.replace("rendition:",""),i=n.indexOf("-");-1!=i&&(t=n.slice(0,i),r=n.slice(i+1),o[t]=r)}),o},EPUBJS.Renderer.prototype.determineLayout=function(e){var t=this.determineSpreads(this.minSpreadWidth),r=t?"ReflowableSpreads":"Reflowable",n=!1;return"pre-paginated"===e.layout&&(r="Fixed",t=!(n=!0)),"reflowable"===e.layout&&"none"===e.spread&&(t=n=!(r="Reflowable")),"reflowable"===e.layout&&"both"===e.spread&&(t=!(n=!(r="ReflowableSpreads"))),this.spreads=t,this.render.scroll(n),this.trigger("renderer:spreads",t),r},EPUBJS.Renderer.prototype.beforeDisplay=function(e,t){this.triggerHooks("beforeChapterDisplay",e,this)},EPUBJS.Renderer.prototype.updatePages=function(e){this.pageMap=this.mapPage(),this.spreads?this.displayedPages=Math.ceil(this.pageMap.length/2):this.displayedPages=this.pageMap.length,this.currentChapter.pages=this.pageMap.length,this._q.flush()},EPUBJS.Renderer.prototype.reformat=function(){var e,t=this;this.contents&&(spreads=this.determineSpreads(this.minSpreadWidth),spreads!=this.spreads&&(this.spreads=spreads,this.layoutMethod=this.determineLayout(this.layoutSettings),this.layout=new EPUBJS.Layout[this.layoutMethod]),this.chapterPos=1,this.render.page(this.chapterPos),t.formated=t.layout.format(t.render.docEl,t.render.width,t.render.height,t.gap),t.render.setPageDimensions(t.formated.pageWidth,t.formated.pageHeight),e=t.layout.calculatePages(),t.updatePages(e),t.currentLocationCfi&&t.gotoCfi(t.currentLocationCfi))},EPUBJS.Renderer.prototype.visible=function(e){if(void 0===e)return this.element.style.visibility;!0!==e||this.hidden?!1===e&&(this.element.style.visibility="hidden"):this.element.style.visibility="visible"},EPUBJS.Renderer.prototype.remove=function(){this.render.window&&(this.render.unload(),this.render.window.removeEventListener("resize",this.resized),this.removeEventListeners(),this.removeSelectionListeners()),this.container.removeChild(this.element)},EPUBJS.Renderer.prototype.applyStyles=function(e){for(var t in e)this.render.setStyle(t,e[t])},EPUBJS.Renderer.prototype.setStyle=function(e,t,r){this.render.setStyle(e,t,r)},EPUBJS.Renderer.prototype.removeStyle=function(e){this.render.removeStyle(e)},EPUBJS.Renderer.prototype.applyHeadTags=function(e){for(var t in e)this.render.addHeadTag(t,e[t])},EPUBJS.Renderer.prototype.page=function(e){return this.pageMap?1<=e&&e<=this.displayedPages&&(this.chapterPos=e,this.render.page(e),this.visibleRangeCfi=this.getVisibleRangeCfi(),this.currentLocationCfi=this.visibleRangeCfi.start,this.trigger("renderer:locationChanged",this.currentLocationCfi),this.trigger("renderer:visibleRangeChanged",this.visibleRangeCfi),!0):(console.warn("pageMap not set, queuing"),this._q.enqueue("page",arguments),!0)},EPUBJS.Renderer.prototype.nextPage=function(){return this.page(this.chapterPos+1)},EPUBJS.Renderer.prototype.prevPage=function(){return this.page(this.chapterPos-1)},EPUBJS.Renderer.prototype.pageByElement=function(e){var t;e&&(t=this.render.getPageNumberByElement(e),this.page(t))},EPUBJS.Renderer.prototype.lastPage=function(){if(this._moving)return this._q.enqueue("lastPage",arguments);this.page(this.displayedPages)},EPUBJS.Renderer.prototype.firstPage=function(){if(this._moving)return this._q.enqueue("firstPage",arguments);this.page(1)},EPUBJS.Renderer.prototype.section=function(e){var t=this.doc.getElementById(e);t&&this.pageByElement(t)},EPUBJS.Renderer.prototype.firstElementisTextNode=function(e){var t=e.childNodes;return!!(t.length&&t[0]&&3===t[0].nodeType&&t[0].textContent.trim().length)},EPUBJS.Renderer.prototype.isGoodNode=function(e){return-1!==["audio","canvas","embed","iframe","img","math","object","svg","video"].indexOf(e.tagName.toLowerCase())||this.firstElementisTextNode(e)},EPUBJS.Renderer.prototype.walk=function(e,t,r){for(var n,i,o,s=e,a=[s],c=0;!n&&a.length;){if(e=a.shift(),this.containsPoint(e,t,r)&&this.isGoodNode(e)&&(n=e),!n&&e&&0<e.childElementCount){if(!(i=e.children)||!i.length)return n;for(var h=(i.length?i.length:0)-1;0<=h;h--)i[h]!=o&&a.unshift(i[h])}if(!n&&0===a.length&&s&&null!==s.parentNode&&(a.push(s.parentNode),s=(o=s).parentNode),1e4<++c){console.error("ENDLESS LOOP");break}}return n},EPUBJS.Renderer.prototype.containsPoint=function(e,t,r){var n;return!!(e&&"function"==typeof e.getBoundingClientRect&&0!==(n=e.getBoundingClientRect()).width&&0!==n.height&&n.left>=t&&t<=n.left+n.width)},EPUBJS.Renderer.prototype.textSprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^\s*$/.test(e.data)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},!1);r=n.nextNode();)t(r)},EPUBJS.Renderer.prototype.sprint=function(e,t){for(var r,n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1);r=n.nextNode();)t(r)},EPUBJS.Renderer.prototype.mapPage=function(){var r,n,i=this,o=[],e=this.render.getBaseElement(),s=1,a=this.layout.colWidth+this.layout.gap,c=this.formated.pageWidth*(this.chapterPos-1),h=a*s-c,p=0,l=function(e){i.splitTextNodeIntoWordsRanges(e).forEach(function(e){var t=e.getBoundingClientRect();!t||0===t.width&&0===t.height||(t.left+t.width<h?o[s-1]||(e.collapse(!0),n=i.currentChapter.cfiFromRange(e),o.push({start:n,end:null})):(r&&(r.collapse(!0),n=i.currentChapter.cfiFromRange(r),o[o.length-1].end=n),e.collapse(!0),n=i.currentChapter.cfiFromRange(e),o.push({start:n,end:null}),p=h=a*(s+=1)-c),r=e)})},t=this.render.getDocumentElement(),u=t.dir;return"rtl"==u&&(t.dir="ltr",t.style.position="static"),this.sprint(e,function(e){var t,r,n=Array.prototype.slice.call(e.childNodes);if(e.nodeType==Node.ELEMENT_NODE){if((r=document.createRange()).selectNodeContents(e),!(t=r.getBoundingClientRect())||0===t.width&&0===t.height)return;t.left>p&&n.forEach(function(e){e.nodeType==Node.TEXT_NODE&&e.textContent.trim().length&&l(e)}),t.right>p&&n.forEach(function(e){e.nodeType==Node.TEXT_NODE&&e.textContent.trim().length&&l(e)})}}),"rtl"==u&&(t.dir=u,t.style.left="auto",t.style.right="0"),r&&(r.collapse(!0),n=i.currentChapter.cfiFromRange(r),o[o.length-1].end=n),o.length||(range=this.doc.createRange(),range.selectNodeContents(e),range.collapse(!0),n=i.currentChapter.cfiFromRange(range),o.push({start:n,end:n})),ranges=r=null,e=range=null,o},EPUBJS.Renderer.prototype.indexOfBreakableChar=function(e,t){for(var r=t=t||0;r<e.length;r++)if(-1!="- \t\r\n\b\f".indexOf(e.charAt(r)))return r;return-1},EPUBJS.Renderer.prototype.splitTextNodeIntoWordsRanges=function(e){var t,r=[],n=e.textContent.trim();if(pos=this.indexOfBreakableChar(n),-1===pos)return(t=this.doc.createRange()).selectNodeContents(e),[t];for((t=this.doc.createRange()).setStart(e,0),t.setEnd(e,pos),r.push(t),(t=this.doc.createRange()).setStart(e,pos+1);-1!=pos;)pos=this.indexOfBreakableChar(n,pos+1),0<pos&&(t&&(t.setEnd(e,pos),r.push(t)),(t=this.doc.createRange()).setStart(e,pos+1));return t&&(t.setEnd(e,n.length),r.push(t)),r},EPUBJS.Renderer.prototype.rangePosition=function(e){var t=e.getClientRects();return t.length?t[0]:null},EPUBJS.Renderer.prototype.getPageCfi=function(){var e;return startRange=this.spreads?(e=2*this.chapterPos,this.pageMap[e-2]):(e=this.chapterPos,this.pageMap[e-1]),this.pageMap[2*this.chapterPos-1].start},EPUBJS.Renderer.prototype.getRange=function(e,t,r){var n=this.doc.createRange();return document.caretPositionFromPoint,document.caretRangeFromPoint,this.visibileEl=this.findElementAfter(e,t),n.setStart(this.visibileEl,1),n},EPUBJS.Renderer.prototype.pagesInCurrentChapter=function(){var e;return this.pageMap?(e=this.pageMap.length,this.spreads?Math.ceil(e/2):e):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.currentRenderedPage=function(){return this.pageMap?this.spreads&&1<this.layout.pageCount?2*this.chapterPos:this.chapterPos:(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.getRenderedPagesLeft=function(){return this.pageMap?this.pageMap.length-(this.spreads?2*this.chapterPos:this.chapterPos):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.getVisibleRangeCfi=function(){var e,t,r;return this.pageMap?(this.spreads?(e=2*this.chapterPos,r=t=this.pageMap[e-2],1<this.layout.pageCount&&(r=this.pageMap[e-1])):(e=this.chapterPos,r=t=this.pageMap[e-1]),t||(console.warn("page range miss:",e,this.pageMap),r=t=this.pageMap[this.pageMap.length-1]),{start:t.start,end:r.end}):(console.warn("page map not loaded"),!1)},EPUBJS.Renderer.prototype.gotoCfi=function(e){var t,r,n,i;if(this._moving)return this._q.enqueue("gotoCfi",arguments);EPUBJS.core.isString(e)&&(e=this.epubcfi.parse(e)),void 0===document.evaluate?(t=this.epubcfi.addMarker(e,this.doc))&&(n=this.render.getPageNumberByElement(t),this.epubcfi.removeMarker(t,this.doc),this.page(n)):(i=this.epubcfi.generateRangeFromCfi(e,this.doc))?(n=(r=i.getBoundingClientRect())?this.render.getPageNumberByRect(r):1,this.page(n),this.currentLocationCfi=e.str):this.page(1)},EPUBJS.Renderer.prototype.findFirstVisible=function(e){var t=e||this.render.getBaseElement(),r=this.walk(t,0,0);return r||e},EPUBJS.Renderer.prototype.findElementAfter=function(e,t,r){var n=r||this.render.getBaseElement(),i=this.walk(n,e,t);return i||n},EPUBJS.Renderer.prototype.resize=function(e,t,r){this.width=e,this.height=t,!1!==r&&this.render.resize(this.width,this.height),this.contents&&this.reformat(),this.trigger("renderer:resized",{width:this.width,height:this.height})},EPUBJS.Renderer.prototype.onResized=function(e){var t=this.container.clientWidth,r=this.container.clientHeight;this.resize(t,r,!1)},EPUBJS.Renderer.prototype.addEventListeners=function(){this.render.document&&this.listenedEvents.forEach(function(e){this.render.document.addEventListener(e,this.triggerEvent.bind(this),!1)},this)},EPUBJS.Renderer.prototype.removeEventListeners=function(){this.render.document&&this.listenedEvents.forEach(function(e){this.render.document.removeEventListener(e,this.triggerEvent,!1)},this)},EPUBJS.Renderer.prototype.triggerEvent=function(e){this.trigger("renderer:"+e.type,e)},EPUBJS.Renderer.prototype.addSelectionListeners=function(){this.render.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)},EPUBJS.Renderer.prototype.removeSelectionListeners=function(){this.render.document&&this.doc.removeEventListener("selectionchange",this.onSelectionChange,!1)},EPUBJS.Renderer.prototype.onSelectionChange=function(e){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){this.selectedRange=this.render.window.getSelection(),this.trigger("renderer:selected",this.selectedRange)}.bind(this),500)},EPUBJS.Renderer.prototype.setMinSpreadWidth=function(e){this.minSpreadWidth=e,this.spreads=this.determineSpreads(e)},EPUBJS.Renderer.prototype.determineSpreads=function(e){return!(this.isForcedSingle||!e||this.width<e)},EPUBJS.Renderer.prototype.forceSingle=function(e){this.isForcedSingle=!!e},EPUBJS.Renderer.prototype.setGap=function(e){this.gap=e},EPUBJS.Renderer.prototype.setDirection=function(e){this.direction=e,this.render.setDirection(this.direction)},EPUBJS.Renderer.prototype.replace=function(e,t,n,i){var r=this.contents.querySelectorAll(e),o=Array.prototype.slice.call(r),s=o.length;0!==s?o.forEach(function(e){var r=!1;t(e,function(e,t){!1===r&&(s--,i&&i(e,t,s),s<=0&&n&&n(!0),r=!0)})}.bind(this)):n(!1)},RSVP.EventTarget.mixin(EPUBJS.Renderer.prototype),(EPUBJS=EPUBJS||{}).replace={},EPUBJS.replace.hrefs=function(e,s){var a=this;s.replace("a[href]",function(e,t){var r,n,i,o=e.getAttribute("href");-1!=o.search("://")?e.setAttribute("target","_blank"):(r=EPUBJS.core.uri(s.render.window.location.href),i=(n=r.directory)?"file"===r.protocol?EPUBJS.core.resolveUrl(r.base,o):EPUBJS.core.resolveUrl(n,o):o,e.onclick=function(){return a.goto(i),!1}),t()},e)},EPUBJS.replace.head=function(e,t){t.replaceWithStored("link[href]","href",EPUBJS.replace.links,e)},EPUBJS.replace.resources=function(e,t){t.replaceWithStored("[src]","src",EPUBJS.replace.srcs,e)},EPUBJS.replace.svg=function(e,t){t.replaceWithStored("image","xlink:href",function(e,t,r){e.getUrl(t).then(r)},e)},EPUBJS.replace.srcs=function(e,t,r){e.getUrl(t).then(r)},EPUBJS.replace.links=function(e,t,r,n){"stylesheet"===n.getAttribute("rel")?EPUBJS.replace.stylesheets(e,t).then(function(e,t){r(e,t)},function(e){r(null)}):e.getUrl(t).then(r,function(e){r(null)})},EPUBJS.replace.stylesheets=function(t,r){var i=new RSVP.defer;if(t)return t.getText(r).then(function(e){EPUBJS.replace.cssUrls(t,r,e).then(function(e){var t=window.URL||window.webkitURL||window.mozURL,r=new Blob([e],{type:"text/css"}),n=t.createObjectURL(r);i.resolve(n)},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},EPUBJS.replace.cssUrls=function(n,i,o){var s=new RSVP.defer,a=[],e=o.match(/url\(\'?\"?([^\'|^\"^\)]*)\'?\"?\)/g);if(n)return e?(e.forEach(function(t){var e=EPUBJS.core.resolveUrl(i,t.replace(/url\(|[|\)|\'|\"]/g,"")),r=n.getUrl(e).then(function(e){o=o.replace(t,'url("'+e+'")')},function(e){s.reject(e)});a.push(r)}),RSVP.all(a).then(function(){s.resolve(o)})):s.resolve(o),s.promise},EPUBJS.Storage=function(e){this.checkRequirements(),this.urlCache={},this.withCredentials=e,this.URL=window.URL||window.webkitURL||window.mozURL,this.offline=!1},EPUBJS.Storage.prototype.checkRequirements=function(e){"undefined"==typeof localforage&&console.error("localForage library not loaded")},EPUBJS.Storage.prototype.put=function(i,e){var t=new RSVP.defer,o=i.length,s=0,a=function(e){var t,r,n=e||new RSVP.defer;return o<=s?n.resolve():(t=i[s].url,r=window.encodeURIComponent(t),EPUBJS.core.request(t,"binary").then(function(e){return localforage.setItem(r,e)}).then(function(e){s++,setTimeout(function(){a(n)},1)})),n.promise}.bind(this);return Array.isArray(i)||(i=[i]),a().then(function(){t.resolve()}.bind(this)),t.promise},EPUBJS.Storage.prototype.token=function(e,t){var r=window.encodeURIComponent(e);return localforage.setItem(r,t).then(function(e){return null!==e})},EPUBJS.Storage.prototype.isStored=function(e){var t=window.encodeURIComponent(e);return localforage.getItem(t).then(function(e){return null!==e})},EPUBJS.Storage.prototype.getText=function(o){var t=window.encodeURIComponent(o);return EPUBJS.core.request(o,"arraybuffer",this.withCredentials).then(function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,e),e}.bind(this)).then(function(e){var t=new RSVP.defer,r=EPUBJS.core.getMimeType(o),n=new Blob([e],{type:r}),i=new FileReader;return i.addEventListener("loadend",function(){t.resolve(i.result)}),i.readAsText(n,r),t.promise}).catch(function(){var i=new RSVP.defer,e=localforage.getItem(t);return this.offline||(this.offline=!0,this.trigger("offline",!0)),e?e.then(function(e){var t=EPUBJS.core.getMimeType(o),r=new Blob([e],{type:t}),n=new FileReader;n.addEventListener("loadend",function(){i.resolve(n.result)}),n.readAsText(r,t)}):i.reject({message:"File not found in the storage: "+o,stack:(new Error).stack}),i.promise}.bind(this))},EPUBJS.Storage.prototype.getUrl=function(o){var s=window.encodeURIComponent(o);return EPUBJS.core.request(o,"arraybuffer",this.withCredentials).then(function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(s,e),o}.bind(this)).catch(function(){var e,r,n=new RSVP.defer,i=window.URL||window.webkitURL||window.mozURL;return this.offline||(this.offline=!0,this.trigger("offline",!0)),s in this.urlCache?n.resolve(this.urlCache[s]):(e=localforage.getItem(s))?e.then(function(e){var t=new Blob([e],{type:EPUBJS.core.getMimeType(o)});r=i.createObjectURL(t),n.resolve(r),this.urlCache[s]=r}.bind(this)):n.reject({message:"File not found in the storage: "+o,stack:(new Error).stack}),n.promise}.bind(this))},EPUBJS.Storage.prototype.getXml=function(o){var t=window.encodeURIComponent(o);return EPUBJS.core.request(o,"arraybuffer",this.withCredentials).then(function(e){return this.offline&&(this.offline=!1,this.trigger("offline",!1)),localforage.setItem(t,e),e}.bind(this)).then(function(e){var t=new RSVP.defer,r=EPUBJS.core.getMimeType(o),n=new Blob([e],{type:r}),i=new FileReader;return i.addEventListener("loadend",function(){var e=(new DOMParser).parseFromString(i.result,"text/xml");t.resolve(e)}),i.readAsText(n,r),t.promise}).catch(function(){var i=new RSVP.defer,e=localforage.getItem(t);return this.offline||(this.offline=!0,this.trigger("offline",!0)),e?e.then(function(e){var t=EPUBJS.core.getMimeType(o),r=new Blob([e],{type:t}),n=new FileReader;n.addEventListener("loadend",function(){var e=(new DOMParser).parseFromString(n.result,"text/xml");i.resolve(e)}),n.readAsText(r,t)}):i.reject({message:"File not found in the storage: "+o,stack:(new Error).stack}),i.promise}.bind(this))},EPUBJS.Storage.prototype.revokeUrl=function(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)},EPUBJS.Storage.prototype.failed=function(e){console.error(e)},RSVP.EventTarget.mixin(EPUBJS.Storage.prototype),EPUBJS.Unarchiver=function(e){this.checkRequirements(),this.urlCache={}},EPUBJS.Unarchiver.prototype.checkRequirements=function(e){"undefined"==typeof JSZip&&console.error("JSZip lib not loaded")},EPUBJS.Unarchiver.prototype.open=function(e,t){new RSVP.defer;return EPUBJS.core.request(e,"binary").then(function(e){this.zip=new JSZip(e)}.bind(this))},EPUBJS.Unarchiver.prototype.getXml=function(e,t){var r=window.decodeURIComponent(e);return this.getText(r,t).then(function(e){return(new DOMParser).parseFromString(e,"text/xml")})},EPUBJS.Unarchiver.prototype.getUrl=function(e,t){var r,n,i=new RSVP.defer,o=window.decodeURIComponent(e),s=this.zip.file(o),a=window.URL||window.webkitURL||window.mozURL;return s?e in this.urlCache?i.resolve(this.urlCache[e]):(n=new Blob([s.asUint8Array()],{type:EPUBJS.core.getMimeType(s.name)}),r=a.createObjectURL(n),i.resolve(r),this.urlCache[e]=r):i.reject({message:"File not found in the epub: "+e,stack:(new Error).stack}),i.promise},EPUBJS.Unarchiver.prototype.getText=function(e,t){var r,n=new RSVP.defer,i=window.decodeURIComponent(e),o=this.zip.file(i);return o?(r=o.asText(),n.resolve(r)):n.reject({message:"File not found in the epub: "+e,stack:(new Error).stack}),n.promise},EPUBJS.Unarchiver.prototype.revokeUrl=function(e){var t=window.URL||window.webkitURL||window.mozURL,r=this.urlCache[e];r&&t.revokeObjectURL(r)},EPUBJS.Unarchiver.prototype.failed=function(e){console.error(e)},EPUBJS.Unarchiver.prototype.afterSaved=function(e){this.callback()},EPUBJS.Unarchiver.prototype.toStorage=function(e){var t=0,r=this,n=e.length;function i(){0===--n&&r.afterSaved()}e.forEach(function(e){setTimeout(function(e){r.saveEntryFileToStorage(e,i)},t,e),t+=20}),console.log("time",t)},function(){"use strict";var o={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcard":"vcf",sgml:["sgml","sgm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},t=function(){var e,t,r,n,i={};for(e in o)if(o.hasOwnProperty(e))for(t in o[e])if(o[e].hasOwnProperty(t))if("string"==typeof(r=o[e][t]))i[r]=e+"/"+t;else for(n=0;n<r.length;n++)i[r[n]]=e+"/"+t;return i}();EPUBJS.core.getMimeType=function(e){return e&&t[e.split(".").pop().toLowerCase()]||"text/plain"}}();