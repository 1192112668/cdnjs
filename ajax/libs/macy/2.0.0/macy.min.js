!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Macy=e()}(this,function(){"use strict";function l(t){var e=document.body.clientWidth,o=void 0;for(var n in t.breakAt)if(e<n){o=t.breakAt[n];break}return o=o||t.columns}function u(t,e){var o=!(1<arguments.length&&void 0!==e)||e,n=l(t),r=100/n;return o?1===n?"100%":"calc("+r+"% - "+(n-1)*t.margin/n+"px)":r}function a(t){for(var e=0,o=t.container,n=t.rows,r=n.length-1;0<=r;r--)e=n[r]>e?n[r]:e;o.style.height=e+"px"}function i(r,t,e,o){var n=2<arguments.length&&void 0!==e&&e,i=!(3<arguments.length&&void 0!==o)||o,s=l(r.options);p(r,s,n),t.forEach(function(t){r.lastcol===s&&(r.lastcol=0);var e,o,n=(e=t,o="height",window.getComputedStyle(e,null).getPropertyValue(o)),n=parseInt(n.replace("px",""),10);isNaN(n)||(t.style.position="absolute",t.style.top=r.rows[r.lastcol]+"px",t.style.left=""+r.cols[r.lastcol],r.rows[r.lastcol]+=isNaN(n)?0:n+r.options.margin,r.lastcol+=1,i&&(t.dataset.macyComplete=1))}),i&&(r.tmpRows=null),a(r)}Object.getOwnPropertyNames(Array.prototype).forEach(function(t){"length"!==t&&(NodeList.prototype[t]=Array.prototype[t],HTMLCollection.prototype[t]=Array.prototype[t])});function c(t,e){if(!(this instanceof c))return new c(t,e);if(t=t.replace(/^\s*/,"").replace(/\s*$/,""),e)return this.byCss(t,e);for(var o in this.selectors)if(e=o.split("/"),new RegExp(e[1],e[2]).test(t))return this.selectors[o](t);return this.byCss(t)}c.prototype.byCss=function(t,e){return(e||document).querySelectorAll(t)},(c.prototype.selectors={})[/^\.[\w\-]+$/]=function(t){return document.getElementsByClassName(t.substring(1))},c.prototype.selectors[/^\w+$/]=function(t){return document.getElementsByTagName(t)},c.prototype.selectors[/^\#[\w\-]+$/]=function(t){return document.getElementById(t.substring(1))};function p(t,e){var o,n,r,i,s,a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(t.lastcol||(t.lastcol=0),a){t.rows=[],t.cols=[],t.lastcol=0;for(var c=e-1;0<=c;c--)t.rows[c]=0,t.cols[c]=(n=c,s=i=void 0,r=l((o=t).options),s=void(i=0),1==++n?0:(s=(o.options.margin-(r-1)*o.options.margin/r)*(n-1),"calc("+(i+=u(o.options,!1)*(n-1))+"% + "+s+"px)"))}if(t.tmpRows){t.rows=[];for(c=e-1;0<=c;c--)t.rows[c]=t.tmpRows[c]}else{t.tmpRows=[];for(c=e-1;0<=c;c--)t.tmpRows[c]=t.rows[c]}}function t(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=e?t.container.children:c(':scope > *:not([data-macy-complete="1"])',t.container),r=u(t.options);return n.forEach(function(t){e&&(t.dataset.macyComplete=0),t.style.width=r}),(t.options.trueOrder?i:function(n,t,e,o){var r=2<arguments.length&&void 0!==e&&e,i=!(3<arguments.length&&void 0!==o)||o;p(n,l(n.options),r),t.forEach(function(t){var o=0,e=parseInt(t.offsetHeight,10);isNaN(e)||(n.rows.forEach(function(t,e){t<n.rows[o]&&(o=e)}),t.style.position="absolute",t.style.top=n.rows[o]+"px",t.style.left=""+n.cols[o],n.rows[o]+=isNaN(e)?0:e+n.options.margin,i&&(t.dataset.macyComplete=1))}),i&&(n.tmpRows=null),a(n)})(t,n,e,o)}function n(e,o){setTimeout(function(){var t=e();o&&o(t)},0)}function s(t,e,o){t&&n(t),o.req===o.complete&&n(e)}function f(t,e,o){var n=t.length,r=0;t.forEach(function(t){t.complete&&s(e,o,{req:n,complete:++r}),t.addEventListener("load",function(){s(e,o,{req:n,complete:++r})})})}function h(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:m;if(!(this instanceof h))return new h(t);if(this.options={},d(this.options,m,t),this.container=c(t.container),this.container instanceof c||!this.container)return!!t.debug&&console.error("Error: Container not found");delete this.options.container,this.container.length&&(this.container=this.container[0]),this.container.style.position="relative",this.rows=[];var e,o,n,r=this.recalculate.bind(this,!1,!1),i=this.recalculate.bind(this,!0,!0),s=c("img",this.container);if(this.resizer=(e=function(){i()},o=100,n=void 0,function(){n&&clearTimeout(n),n=setTimeout(e,o)}),window.addEventListener("resize",this.resizer),t.waitForImages)return f(s,null,i);this.recalculate(!0,!1),f(s,r,i)}var d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},m={columns:4,margin:2,trueOrder:!0,waitForImages:!1};return h.init=function(t){return console.warn("Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) "),new h(t)},h.prototype.recalculateOnImageLoad=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=c("img",this.container),n=this.recalculate.bind(this,e,!1),r=this.recalculate.bind(this,e,!0);return t?f(o,null,r):(n(),f(o,n,r))},h.prototype.runOnImageLoad=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=c("img",this.container);return f(o,e?t:null,t)},h.prototype.recalculate=function(){return t(this,0<arguments.length&&void 0!==arguments[0]&&arguments[0],!(1<arguments.length&&void 0!==arguments[1])||arguments[1])},h.prototype.remove=function(){window.removeEventListener("resize",this.resizer),this.container.children.forEach(function(t){t.removeAttribute("data-macy-complete"),t.removeAttribute("style")}),this.container.removeAttribute("style")},h.prototype.reInit=function(){this.recalculate(!0,!0),window.addEventListener("resize",this.resizer)},h});