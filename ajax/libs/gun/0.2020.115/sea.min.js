!function(){var t;"undefined"!=typeof window&&(t=window),"undefined"!=typeof global&&(t=global);var e=(t=t||{}).console||{log:function(){}};function r(t,e){return e?require(t):t.slice?r[n(t)]:function(e,a){t(e={exports:{}}),r[n(a)]=e.exports};function n(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var n=module;r(function(t){"undefined"!=typeof window&&(t.window=window);var e=(t.window||t).SEA||{};(e.window=t.window)&&(e.window.SEA=e);try{void 0!==n&&(n.exports=e)}catch(t){}t.exports=e})(r,"./root"),r(function(t){var e=r("./root");try{e.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&location.protocol.indexOf("file:")<0&&(location.protocol="https:")}catch(t){}})(r,"./https"),r(function(e){"undefined"==typeof btoa&&("undefined"==typeof Buffer&&(t.Buffer=require("buffer").Buffer),t.btoa=function(t){return Buffer.from(t,"binary").toString("base64")},t.atob=function(t){return Buffer.from(t,"base64").toString("binary")})})(r,"./base64"),r(function(t){function e(){}r("./base64"),Object.assign(e,{from:Array.from}),e.prototype=Object.create(Array.prototype),e.prototype.toString=function(t,e,r){t=t||"utf8",e=e||0;const n=this.length;if("hex"===t){const t=new Uint8Array(this);return[...Array((r&&r+1||n)-e).keys()].map(r=>t[r+e].toString(16).padStart(2,"0")).join("")}return"utf8"===t?Array.from({length:(r||n)-e},(t,r)=>String.fromCharCode(this[r+e])).join(""):"base64"===t?btoa(this):void 0},t.exports=e})(r,"./array"),r(function(t){r("./base64");var n=r("./array");function a(...t){return e.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),a.from(...t)}a.prototype=Object.create(Array.prototype),Object.assign(a,{from(){if(!Object.keys(arguments).length||null==arguments[0])throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const t=arguments[0];let r;if("string"==typeof t){const a=arguments[1]||"utf8";if("hex"===a){const e=t.match(/([\da-fA-F]{2})/g).map(t=>parseInt(t,16));if(!e||!e.length)throw new TypeError("Invalid first argument for type 'hex'.");r=n.from(e)}else if("utf8"===a){const e=t.length,a=new Uint16Array(e);Array.from({length:e},(e,r)=>a[r]=t.charCodeAt(r)),r=n.from(a)}else if("base64"===a){const e=atob(t),a=e.length,o=new Uint8Array(a);Array.from({length:a},(t,r)=>o[r]=e.charCodeAt(r)),r=n.from(o)}else"binary"===a?r=n.from(t):e.info("SafeBuffer.from unknown encoding: "+a);return r}t.byteLength;if(t.byteLength?t.byteLength:t.length){let e;return t instanceof ArrayBuffer&&(e=new Uint8Array(t)),n.from(e||t)}},alloc:(t,e=0)=>n.from(new Uint8Array(Array.from({length:t},()=>e))),allocUnsafe:t=>n.from(new Uint8Array(Array.from({length:t}))),concat(t){if(!Array.isArray(t))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return n.from(t.reduce((t,e)=>t.concat(Array.from(e)),[]))}}),a.prototype.from=a.from,a.prototype.toString=n.prototype.toString,t.exports=a})(r,"./buffer"),r(function(t){const n=r("./root"),a=r("./buffer"),o={Buffer:a};var i={};if(n.window&&(o.crypto=navigator&&"ReactNative"===navigator.product?require("isomorphic-webcrypto"):window.crypto||window.msCrypto||require("isomorphic-webcrypto"),o.subtle=(o.crypto||i).subtle||(o.crypto||i).webkitSubtle,o.TextEncoder=window.TextEncoder,o.TextDecoder=window.TextDecoder,o.random=(t=>a.from(o.crypto.getRandomValues(new Uint8Array(a.alloc(t)))))),!o.TextDecoder){const{TextEncoder:t,TextDecoder:e}=require("text-encoding");o.TextDecoder=e,o.TextEncoder=t}if(!o.crypto)try{var s=r("crypto",1);Object.assign(o,{crypto:s,random:t=>a.from(s.randomBytes(t))});const t=require("isomorphic-webcrypto");o.ossl=o.subtle=t.subtle}catch(t){e.log("text-encoding and @peculiar/webcrypto may not be included by default, please add it to your package.json!"),TEXT_ENCODING_OR_PECULIAR_WEBCRYPTO_NOT_INSTALLED}t.exports=o})(r,"./shim"),r(function(t){var e=r("./root"),n=(r("./buffer"),{pbkdf2:{hash:{name:"SHA-256"},iter:1e5,ks:64},ecdsa:{pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},ecdh:{name:"ECDH",namedCurve:"P-256"},jwk:function(t,e){var r={kty:"EC",crv:"P-256",x:(t=t.split("."))[0],y:t[1],ext:!0};return r.key_ops=e?["sign"]:["verify"],e&&(r.d=e),r},keyToJwk:function(t){return{kty:"oct",k:t.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},recall:{validity:43200,hook:function(t){return t}},check:function(t){return"string"==typeof t&&"SEA{"===t.slice(0,4)},parse:function(t){try{var e="string"==typeof t;return e&&"SEA{"===t.slice(0,4)&&(t=t.slice(3)),e?JSON.parse(t):t}catch(t){}return t}});e.opt=n,t.exports=n})(r,"./settings"),r(function(t){var e=r("./shim");t.exports=async function(t,r){var n="string"==typeof t?t:JSON.stringify(t),a=await e.subtle.digest({name:r||"SHA-256"},(new e.TextEncoder).encode(n));return e.Buffer.from(a)}})(r,"./sha256"),r(function(t){const e=r("./shim"),n=e.subtle,a=e.ossl?e.ossl:n;t.exports=(t=>a.digest({name:"SHA-1"},new ArrayBuffer(t)))})(r,"./sha1"),r(function(t){var n=r("./root"),a=r("./shim"),o=r("./settings"),i=r("./sha256");n.work=n.work||(async(t,r,s,u)=>{try{var c=(r||{}).epub||r;u=u||{};if(c instanceof Function&&(s=c,c=void 0),c=c||a.random(9),t="string"==typeof t?t:JSON.stringify(t),"sha"===(u.name||"").toLowerCase().slice(0,3)){var f=a.Buffer.from(await i(t,u.name),"binary").toString(u.encode||"base64");if(s)try{s(f)}catch(t){e.log(t)}return f}var p=await(a.ossl||a.subtle).importKey("raw",(new a.TextEncoder).encode(t),{name:u.name||"PBKDF2"},!1,["deriveBits"]),l=await(a.ossl||a.subtle).deriveBits({name:u.name||"PBKDF2",iterations:u.iterations||o.pbkdf2.iter,salt:(new a.TextEncoder).encode(u.salt||c),hash:u.hash||o.pbkdf2.hash},p,u.length||8*o.pbkdf2.ks);t=a.random(t.length);var y=a.Buffer.from(l,"binary").toString(u.encode||"base64");if(s)try{s(y)}catch(t){e.log(t)}return y}catch(t){if(e.log(t),n.err=t,n.throw)throw t;return void(s&&s())}}),t.exports=n.work})(r,"./work"),r(function(t){var n=r("./root"),a=r("./shim");r("./settings");n.name=n.name||(async(t,r)=>{try{if(t)try{t()}catch(t){e.log(t)}return}catch(r){if(e.log(r),n.err=r,n.throw)throw r;return void(t&&t())}}),n.pair=n.pair||(async(t,r)=>{try{var o=a.ossl||a.subtle,i=await a.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async t=>{var e={};e.priv=(await a.subtle.exportKey("jwk",t.privateKey)).d;var r=await a.subtle.exportKey("jwk",t.publicKey);return e.pub=r.x+"."+r.y,e});try{var s=await o.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async t=>{var e={};e.epriv=(await o.exportKey("jwk",t.privateKey)).d;var r=await o.exportKey("jwk",t.publicKey);return e.epub=r.x+"."+r.y,e})}catch(t){if(n.window)throw t;if("Error: ECDH is not a supported algorithm"!=t)throw t;e.log("Ignoring ECDH...")}s=s||{};var u={pub:i.pub,priv:i.priv,epub:s.epub,epriv:s.epriv};if(t)try{t(u)}catch(t){e.log(t)}return u}catch(r){if(e.log(r),n.err=r,n.throw)throw r;return void(t&&t())}}),t.exports=n.pair})(r,"./pair"),r(function(t){var n,a=r("./root"),o=r("./shim"),i=r("./settings"),s=r("./sha256");a.sign=a.sign||(async(t,r,u,c)=>{try{if(c=c||{},(r||c).priv||(r=await a.I(null,{what:t,how:"sign",why:c.why})),n===t)throw"`undefined` not allowed.";var f=i.parse(t),p=c.check=c.check||f;if(a.verify&&(a.opt.check(p)||p&&p.s&&p.m)&&n!==await a.verify(p,r)){var l=i.parse(p);if(c.raw||(l="SEA"+JSON.stringify(l)),u)try{u(l)}catch(t){e.log(t)}return l}var y=r.pub,h=r.priv,d=i.jwk(y,h),g=await s(f),w=await(o.ossl||o.subtle).importKey("jwk",d,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(t=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new Uint8Array(g)));l={m:f,s:o.Buffer.from(w,"binary").toString(c.encode||"base64")};if(c.raw||(l="SEA"+JSON.stringify(l)),u)try{u(l)}catch(t){e.log(t)}return l}catch(t){if(e.log(t),a.err=t,a.throw)throw t;return void(u&&u())}}),t.exports=a.sign})(r,"./sign"),r(function(t){var n,a=r("./root"),o=r("./shim"),i=r("./settings"),s=r("./sha256");a.verify=a.verify||(async(t,r,u,c)=>{try{var f=i.parse(t);if(!1===r){var p=i.parse(f.m);if(u)try{u(p)}catch(t){e.log(t)}return p}c=c||{};var l,y,h,d=r.pub||r,g=a.opt.slow_leak?await a.opt.slow_leak(d):await(o.ossl||o.subtle).importKey("jwk",jwk,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),w=await s(f.m);try{if(l=o.Buffer.from(f.s,c.encode||"base64"),y=new Uint8Array(l),!(h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,y,new Uint8Array(w))))throw"Signature did not match."}catch(e){if(a.opt.fallback)return await a.opt.fall_verify(t,r,u,c)}var v=h?i.parse(f.m):n;if(u)try{u(v)}catch(t){e.log(t)}return v}catch(t){if(e.log(t),a.err=t,a.throw)throw t;return void(u&&u())}}),t.exports=a.verify;var u={};a.opt.slow_leak=(t=>{if(u[t])return u[t];var e=i.jwk(t);return u[t]=(o.ossl||o.subtle).importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),u[t]});a.opt.fall_verify=async function(t,r,u,c,f){if(f===a.opt.fallback)throw"Signature did not match";f=f||1;var p,l,y,h=i.parse(t),d=r.pub||r,g=await a.opt.slow_leak(d),w=f<=a.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},(new o.TextEncoder).encode(i.parse(h.m)))):await s(h.m);try{if(p=o.Buffer.from(h.s,c.encode||"base64"),l=new Uint8Array(p),!(y=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,l,new Uint8Array(w))))throw"Signature did not match."}catch(t){if(p=o.Buffer.from(h.s,"utf8"),l=new Uint8Array(p),!(y=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,l,new Uint8Array(w))))throw"Signature did not match."}var v=y?i.parse(h.m):n;if(u)try{u(v)}catch(t){e.log(t)}return v},a.opt.fallback=2})(r,"./verify"),r(function(t){var e=r("./shim"),n=r("./settings"),a=r("./sha256");t.exports=(async(t,r,o)=>{const i=t+(r||e.random(8)).toString("utf8"),s=e.Buffer.from(await a(i),"binary"),u=n.keyToJwk(s);return await e.subtle.importKey("jwk",u,{name:"AES-GCM"},!1,["encrypt","decrypt"])})})(r,"./aeskey"),r(function(t){var n=r("./root"),a=r("./shim"),o=(r("./settings"),r("./aeskey"));n.encrypt=n.encrypt||(async(t,r,i,s)=>{try{s=s||{};var u=(r||s).epriv||r;if(void 0===t)throw"`undefined` not allowed.";u||(u=(r=await n.I(null,{what:t,how:"encrypt",why:s.why})).epriv||r);var c="string"==typeof t?t:JSON.stringify(t),f={s:a.random(9),iv:a.random(15)},p=await o(u,f.s,s).then(t=>a.subtle.encrypt({name:s.name||"AES-GCM",iv:new Uint8Array(f.iv)},t,(new a.TextEncoder).encode(c))),l={ct:a.Buffer.from(p,"binary").toString(s.encode||"base64"),iv:f.iv.toString(s.encode||"base64"),s:f.s.toString(s.encode||"base64")};if(s.raw||(l="SEA"+JSON.stringify(l)),i)try{i(l)}catch(t){e.log(t)}return l}catch(t){if(e.log(t),n.err=t,n.throw)throw t;return void(i&&i())}}),t.exports=n.encrypt})(r,"./encrypt"),r(function(t){var n=r("./root"),a=r("./shim"),o=r("./settings"),i=r("./aeskey");n.decrypt=n.decrypt||(async(t,r,s,u)=>{try{u=u||{};var c=(r||u).epriv||r;c||(c=(r=await n.I(null,{what:t,how:"decrypt",why:u.why})).epriv||r);var f,p,l,y=o.parse(t);try{f=a.Buffer.from(y.s,u.encode||"base64"),p=a.Buffer.from(y.iv,u.encode||"base64"),l=a.Buffer.from(y.ct,u.encode||"base64");var h=await i(c,f,u).then(t=>a.subtle.decrypt({name:u.name||"AES-GCM",iv:new Uint8Array(p),tagLength:128},t,new Uint8Array(l)))}catch(e){if("utf8"===u.encode)throw"Could not decrypt";if(n.opt.fallback)return u.encode="utf8",await n.decrypt(t,r,s,u)}var d=o.parse(new a.TextDecoder("utf8").decode(h));if(s)try{s(d)}catch(t){e.log(t)}return d}catch(t){if(e.log(t),n.err=t,n.throw)throw t;return void(s&&s())}}),t.exports=n.decrypt})(r,"./decrypt"),r(function(t){var n=r("./root"),a=r("./shim");r("./settings");n.secret=n.secret||(async(t,r,i,s)=>{try{s=s||{},r&&r.epriv&&r.epub||(r=await n.I(null,{what:t,how:"secret",why:s.why}));var u=t.epub||t,c=r.epub,f=r.epriv,p=a.ossl||a.subtle,l=o(u),y=Object.assign({public:await p.importKey(...l,!0,[])},{name:"ECDH",namedCurve:"P-256"}),h=o(c,f),d=await p.importKey(...h,!1,["deriveBits"]).then(async t=>{var e=await p.deriveBits(y,t,256),r=new Uint8Array(e),n=await p.importKey("raw",r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return p.exportKey("jwk",n).then(({k:t})=>t)});if(i)try{i(d)}catch(t){e.log(t)}return d}catch(t){if(e.log(t),n.err=t,n.throw)throw t;return void(i&&i())}});var o=(t,e)=>{var[r,n]=t.split("."),a=e?{d:e}:{};return["jwk",Object.assign(a,{x:r,y:n,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};t.exports=n.secret})(r,"./secret"),r(function(t){var a=r("./shim"),o=r("./root");o.work=r("./work"),o.sign=r("./sign"),o.verify=r("./verify"),o.encrypt=r("./encrypt"),o.decrypt=r("./decrypt"),o.opt.aeskey=r("./aeskey"),o.random=o.random||a.random,o.Buffer=o.Buffer||r("./buffer"),o.keyid=o.keyid||(async t=>{try{const r=Buffer.concat(t.replace(/-/g,"+").replace(/_/g,"/").split(".").map(t=>Buffer.from(t,"base64"))),n=Buffer.concat([Buffer.from([153,r.length/256,r.length%256]),r]),a=await sha1hash(n),o=Buffer.from(a,"binary");return o.toString("hex",o.length-8)}catch(t){throw e.log(t),t}});var i=(o.window||{}).Gun||r((void 0===n?".":"")+"./gun",1);i.SEA=o,o.GUN=o.Gun=i,t.exports=o})(r,"./sea"),r(function(t){r("./sea").Gun.chain.then=function(t){var e=this,r=new Promise(function(t,r){e.once(t)});return t?r.then(t):r}})(r,"./then"),r(function(t){var e=r("./sea").Gun;r("./then");function n(t){this._={$:this}}n.prototype=function(){function t(){}return t.prototype=e.chain,new t}(),n.prototype.constructor=n,e.chain.user=function(t){var r,a=this.back(-1);if(t)return a.get("~"+t);if(r=a.back("user"))return r;var o=a=a._,i=o.opt.uuid||e.state.lex;return(o=(r=o.user=this.chain(new n))._).opt={},o.opt.uuid=function(t){var e=i(),r=a.user;return r&&(r=r.is)&&(r=r.pub)?(e=e+"~"+r+".",t&&t.call&&t(null,e),e):e},r},e.User=n,t.exports=n})(r,"./user"),r(function(t){var n=r("./sea"),a=r("./user"),o=(r("./settings"),n.Gun),i=function(){};a.prototype.create=function(t,e,r,a){var s=this,u=s._,c=s.back(-1);if(r=r||i,u.ing)return r({err:o.log("User is already being created or authenticated!"),wait:!0}),s;u.ing=!0,a=a||{};var f={};return f.a=function(t){if(f.pubs=t,t&&!a.already){var i={err:o.log("User already created!")};return u.ing=!1,r(i),void s.leave()}f.salt=o.text.random(64),n.work(e,f.salt,f.b)},f.b=function(t){f.proof=t,n.pair(f.c)},f.c=function(e){var r;f.pair=e||{},(r=u.root.user)&&(r._.sea=e,r.is={pub:e.pub,epub:e.epub,alias:t}),f.data={pub:e.pub},f.d()},f.d=function(){f.data.alias=t,f.e()},f.e=function(){f.data.epub=f.pair.epub,n.encrypt({priv:f.pair.priv,epriv:f.pair.epriv},f.proof,f.f,{raw:1})},f.f=function(t){f.data.auth=JSON.stringify({ek:t,s:f.salt}),f.g(f.data.auth)},f.g=function(n){var a;f.data.auth=f.data.auth||n,c.get(a="~"+f.pair.pub).put(f.data),c.get("~@"+t).put(o.obj.put({},a,o.val.link.ify(a))),setTimeout(function(){u.ing=!1,r({ok:0,pub:f.pair.pub}),i===r&&s.auth(t,e)},10)},c.get("~@"+t).once(f.a),s},a.prototype.auth=function(t,r,a,i){var s=this,u=s._,c=s.back(-1);if(a=a||function(){},u.ing)return a({err:o.log("User is already being created or authenticated!"),wait:!0}),s;u.ing=!0,i=i||{};var f,p=t&&(t.pub||t.epub)?t:r&&(r.pub||r.epub)?r:null,l={};return l.a=function(t){if(!t)return l.b();if(!t.pub){var e=[];return o.node.is(t,function(t){e.push(t)}),l.b(e)}if(l.name)return l.f(t);l.c((l.data=t).auth)},l.b=function(t){var e=(l.list=(l.list||[]).concat(t||[])).shift();if(f===e)return l.name?l.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer."):l.err("Wrong user or password.");c.get(e).once(l.a)},l.c=function(t){return f===t?l.b():o.text.is(t)?l.c(o.obj.ify(t)):void n.work(r,(l.auth=t).s,l.d,l.enc)},l.d=function(t){n.decrypt(l.auth.ek,t,l.e,l.enc)},l.e=function(t){if(f===t)return l.enc?(l.enc=null,l.b()):(l.enc={encode:"utf8"},l.c(l.auth));l.half=t,l.f(l.data)},l.f=function(t){if(!t||!t.pub)return l.b();var e=l.half||{};l.g({pub:t.pub,epub:t.epub,priv:e.priv,epriv:e.epriv})},l.g=function(e){l.pair=e;var f=c._.user,p=f._,y=(p.tag,p.opt);(p=f._=c.get("~"+e.pub)._).opt=y,f.is={pub:e.pub,epub:e.epub,alias:t},p.sea=l.pair,u.ing=!1;try{r&&!o.obj.has(o.obj.ify(u.root.graph["~"+e.pub].auth),":")&&(i.shuffle=i.change=r)}catch(t){}if(i.change?l.z():a(p),n.window&&(s.back("user")._.opt||i).remember)try{var h={};(h=window.sessionStorage).recall=!0,h.alias=t,h.tmp=r}catch(t){}try{c._.on("auth",p)}catch(t){o.log("Your 'auth' callback crashed with:",t)}},l.z=function(){l.salt=o.text.random(64),n.work(i.change,l.salt,l.y)},l.y=function(t){n.encrypt({priv:l.pair.priv,epriv:l.pair.epriv},t,l.x,{raw:1})},l.x=function(t){l.w(JSON.stringify({ek:t,s:l.salt}))},l.w=function(t){if(i.shuffle){e.log("migrate core account from UTF8 & shuffle");var r=o.obj.to(l.data);o.obj.del(r,"_"),r.auth=t,c.get("~"+l.pair.pub).put(r)}c.get("~"+l.pair.pub).get("auth").put(t,a)},l.err=function(t){var e={err:o.log(t||"User cannot be found!")};u.ing=!1,a(e)},l.plugin=function(t){if(!(l.name=t))return l.err();var e=[t];"~"!==t[0]&&(e[1]="~"+t,e[2]="~@"+t),l.b(e)},p?l.g(p):t?c.get("~@"+t).once(l.a):t||r||n.name(l.plugin),s},a.prototype.pair=function(){e.log("user.pair() IS DEPRECATED AND WILL BE DELETED!!!");return!!this.is&&this._.sea},a.prototype.leave=function(t,e){var r=this.back(-1)._.user;if(r&&(delete r.is,delete r._.is,delete r._.sea),n.window)try{var a={};delete(a=window.sessionStorage).alias,delete a.tmp,delete a.recall}catch(t){}return this},a.prototype.delete=async function(t,r,n){e.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");this.back(-1);var a=this.back("user");try{a.auth(t,r,function(t){(a.is||{}).pub;a.map().once(function(){this.put(null)}),a.leave(),(n||i)({ok:0})})}catch(t){o.log("User.delete failed! Error:",t)}return this},a.prototype.recall=function(t,e){var r=this.back(-1);if((t=t||{})&&t.sessionStorage){if(n.window)try{var a;(a=window.sessionStorage)&&(r._.opt.remember=!0,(this.back("user")._.opt||t).remember=!0,(a.recall||a.alias&&a.tmp)&&r.user().auth(a.alias,a.tmp,e))}catch(t){}return this}return this},a.prototype.alive=async function(){e.log("user.alive() IS DEPRECATED!!!");const t=this.back(-1);try{return await authRecall(t),t._.user._}catch(t){const e="No session!";throw o.log(e),{err:e}}},a.prototype.trust=async function(t){o.is(t)&&t.get("pub").get((t,r)=>{e.log(t,r)}),t.get("trust").get(path).put(theirPubkey)},a.prototype.grant=function(t,r){e.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var a=this.back(-1).user(),o=a._.sea,i="";return this.back(function(t){t.is||(i+=t.get||"")}),async function(){var e,s=await a.get("grant").get(o.pub).get(i).then();(s=await n.decrypt(s,o))||(s=n.random(16).toString(),e=await n.encrypt(s,o),a.get("grant").get(o.pub).get(i).put(e));var u=t.get("pub").then(),c=t.get("epub").then();u=await u,c=await c;var f=await n.secret(c,o);e=await n.encrypt(s,f),a.get("grant").get(u).get(i).put(e,r)}(),this},a.prototype.secret=function(t,r){e.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var a=this,o=a.back(-1).user(),i=o.pair(),s="";return a.back(function(t){t.is||(s+=t.get||"")}),async function(){var e,u=await o.get("trust").get(i.pub).get(s).then();(u=await n.decrypt(u,i))||(u=n.random(16).toString(),e=await n.encrypt(u,i),o.get("trust").get(i.pub).get(s).put(e)),e=await n.encrypt(t,u),a.put(e,r)}(),a},t.exports=a})(r,"./create"),r(function(t){const n=r("./sea"),a=n.Gun;function o(t){var e,r=this.to,o=(t.$._.put,0);a.node.is(t.put,function(i,s,f){var p=a.obj.ify(i)||c;u===p[":"]?n.opt.check(i)&&(o++,n.verify(i,!1,function(a){o--,f[s]=n.opt.unpack(a,s,f),e&&!o&&(o=-1)&&r.next(t)})):f[s]=n.opt.unpack(p)}),(e=!0)&&!o&&r.next(t)}function i(t){if((t._||c).user)return this.to.next(t);var e=this.as;(t._||(t._=function(){})).user=e.user,s.call(this,t)}function s(t){var r=this.as,o=(r.sea,this.to);if(r.opt.faith&&(t._||c).faith)this.to.next(t);else{if(t.get){var i=t.get["#"];if(i)return"string"!=typeof i?o.next(t):"alias"===i?o.next(t):(i.slice(0,2),o.next(t))}if(t.put){var u,f={},p={};return p.node=function(t,e){if(a.obj.empty(t,"_"))return f["node"+e]=0;a.obj.map(t,p.way,{soul:e,node:t})},p.way=function(e,r){var n,a=this.soul,o=this.node;"_"!==r&&("~@"!==a?"~@"!==a.slice(0,2)?"~"!==a.slice(0,1)||2!==(n=a.slice(1)).split(".").length?p.any(e,r,o,a,(t._||c).user):p.pub(e,r,o,a,n,(t._||c).user):p.pubs(e,r,o,a):p.alias(e,r,o,a))},p.alias=function(t,e,r,n){return t?"~@"+e===a.val.link.is(t)?f["alias"+e]=0:void p.end({err:"Mismatching alias."}):p.end({err:"Data must exist!"})},p.pubs=function(t,e,r,n){return t?e===a.val.link.is(t)?f["pubs"+n+e]=0:void p.end({err:"Alias must match!"}):p.end({err:"Alias must exist!"})},p.pub=function(e,o,i,s,c,l){var y;if("pub"===o)return e===c?f["pub"+s+o]=0:p.end({err:"Account must match!"});f["user"+s+o]=1,a.is(t.$)&&l&&l.is&&c===l.is.pub?n.sign(n.opt.prep(y=n.opt.parse(e),o,i,s),l._.sea,function(t){var l;if(u===t)return p.end({err:n.err||"Pub signature fail."});(l=a.val.link.is(e))&&((r.sea.own[l]=r.sea.own[l]||{})[c]=!0),i[o]=JSON.stringify({":":n.opt.unpack(t.m),"~":t.s}),f["user"+s+o]=0,p.end({ok:1})},{check:n.opt.pack(y,o,i,s),raw:1}):n.verify(n.opt.pack(e,o,i,s),c,function(t){var e;if(t=n.opt.unpack(t,o,i),u===t)return p.end({err:"Unverified data."});(e=a.val.link.is(t))&&c===n.opt.pub(e)&&((r.sea.own[e]=r.sea.own[e]||{})[c]=!0),f["user"+s+o]=0,p.end({ok:1})})},p.any=function(e,o,i,s,c){var l,y;return(y=n.opt.pub(s))?a.is(t.$)&&c&&c.is&&y===c.is.pub?(f["any"+s+o]=1,void n.sign(n.opt.prep(l=n.opt.parse(e),o,i,s),c._.sea,function(t){if(u===t)return p.end({err:"My signature fail."});i[o]=JSON.stringify({":":n.opt.unpack(t.m),"~":t.s}),f["any"+s+o]=0,p.end({ok:1})},{check:n.opt.pack(l,o,i,s),raw:1})):(f["any"+s+o]=1,void n.verify(n.opt.pack(e,o,i,s),y,function(t){var e;if(t=n.opt.unpack(t,o,i),u===t)return p.end({err:"Mismatched owner on '"+o+"'."});(e=a.val.link.is(t))&&y===n.opt.pub(e)&&((r.sea.own[e]=r.sea.own[e]||{})[y]=!0),f["any"+s+o]=0,p.end({ok:1})})):r.opt.secure?void p.end({err:"Soul is missing public key at '"+o+"'."}):(f["any"+s+o]=1,void r.on("secure",function(t){this.off(),f["any"+s+o]=0,r.opt.secure&&(t=null),p.end(t||{err:"Data cannot be modified."})}).on.on("secure",t))},p.end=function(n){p.err||((p.err=n.err)||n.no?e.log("NO!",p.err,t.put):p.end.ed&&(a.obj.map(f,function(t){if(t)return!0})||((t._||{}).user=r.user||s,o.next(t))))},a.obj.map(t.put,p.node),void p.end({end:p.end.ed=!0})}o.next(t)}}a.on("opt",function(t){t.sea||(t.sea={own:{}},t.on("in",s,t),t.on("out",i,t),t.on("node",o,t)),this.to.next(t)}),n.opt.pub=function(t){if(t&&(t=t.split("~"))&&(t=t[1])&&(t=t.split("."))&&!(2>t.length))return t=t.slice(0,2).join(".")},n.opt.prep=function(t,e,r,o){return{"#":o,".":e,":":n.opt.parse(t),">":a.state.is(r,e)}},n.opt.pack=function(t,e,r,o){if(n.opt.check(t))return t;var i=a.obj.ify(t)||c,s=i["~"];return s?{m:{"#":o,".":e,":":i[":"],">":a.state.is(r,e)},s:s}:t},n.opt.unpack=function(t,e,r){var o;if(u!==t){if(t&&u!==(o=t[":"]))return o;if(e&&r){if(t===r[e])return t;if(!n.opt.check(r[e]))return t;var i=a.node.soul(r),s=a.state.is(r,e);return t&&4===t.length&&i===t[0]&&e===t[1]&&f(s)===f(t[3])?t[2]:s<n.opt.shuffle_attack?t:void 0}}},n.opt.shuffle_attack=15463296e5;var u,c=function(){},f=Math.floor;a.val.rel.is})(r,"./index")}();