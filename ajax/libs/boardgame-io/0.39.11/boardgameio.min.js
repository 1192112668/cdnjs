!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).BoardgameIO={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(n,!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var f=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),v=function(){return Math.random().toString(36).substring(7).split("").join(".")},h={INIT:"@@redux/INIT"+v(),REPLACE:"@@redux/REPLACE"+v(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+v()}};function m(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function g(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(g)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,a=t,i=[],l=i,s=!1;function c(){l===i&&(l=i.slice())}function u(){if(s)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return a}function d(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(s)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return c(),l.push(e),function(){if(t){if(s)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,c();var n=l.indexOf(e);l.splice(n,1)}}}function p(e){if(!m(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(s)throw new Error("Reducers may not dispatch actions.");try{s=!0,a=o(a,e)}finally{s=!1}for(var t=i=l,n=0;n<t.length;n++){(0,t[n])()}return e}function v(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,p({type:h.REPLACE})}function y(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[f]=function(){return this},e}return p({type:h.INIT}),(r={dispatch:p,subscribe:d,getState:u,replaceReducer:v})[f]=y,r}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function w(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return x({},n,{dispatch:r=$.apply(void 0,a)(n.dispatch)})}}}const P=(e,t,n,r)=>({type:"MAKE_MOVE",payload:{type:e,args:t,playerID:n,credentials:r}}),O=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r}}),k=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}),_=e=>({type:"SYNC",state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),I=e=>({type:"RESET",state:e,clientOnly:!0}),E=(e,t)=>({type:"UNDO",payload:{type:null,args:null,playerID:e,credentials:t}}),D=(e,t)=>({type:"REDO",payload:{type:null,args:null,playerID:e,credentials:t}});var j,A,S,C=Object.freeze({makeMove:P,gameEvent:O,automaticGameEvent:k,sync:_,update:(e,t)=>({type:"UPDATE",state:e,deltalog:t,clientOnly:!0}),reset:I,undo:E,redo:D,plugin:(e,t,n,r)=>({type:"PLUGIN",payload:{type:e,args:t,playerID:n,credentials:r}})}),M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),N="undefined"!=typeof Symbol?Symbol("immer-nothing"):(S=!0,(A="immer-nothing")in(j={})?Object.defineProperty(j,A,{value:S,enumerable:!0,configurable:!0,writable:!0}):j[A]=S,j),G="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",B="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function q(e){return!!e&&!!e[B]}function L(e){if(!e||"object"!==(void 0===e?"undefined":M(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[G]||!!e.constructor[G])}var T=Object.assign||function(e,t){for(var n in t)V(t,n)&&(e[n]=t[n]);return e},R="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function K(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return R(e).forEach((function(r){if(r!==B){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}})),n}function F(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else R(e).forEach((function(n){return t(n,e[n],e)}))}function U(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function V(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var H={},W=[],Y=function(){return W[W.length-1]};function Q(e,t){var n=Array.isArray(e),r=ne(e);F(r,(function(t){!function(e,t,n){var r=H[t];r?r.enumerable=n:H[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){re(e);var n=Z(e)[t];if(!e.finalizing&&n===e.base[t]&&L(n))return te(e),e.copy[t]=Q(n,e);return n}(this[B],t)},set:function(e){!function(e,t,n){if(re(e),e.assigned[t]=!0,!e.modified){if(J(Z(e)[t],n))return;ee(e),te(e)}e.copy[t]=n}(this[B],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||U(e,t))}));var o={scope:t?t.scope:Y(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:X,revoked:!1};return function(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0})}(r,B,o),o.scope.push(o),r}function X(){this.revoked=!0}function Z(e){return e.copy||e.base}function ee(e){e.modified||(e.modified=!0,e.parent&&ee(e.parent))}function te(e){e.copy||(e.copy=ne(e.base))}function ne(e){var t=e&&e[B];if(t){t.finalizing=!0;var n=K(t.draft,!0);return t.finalizing=!1,n}return K(e)}function re(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(Z(e)))}function oe(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!V(t,r[o]))return!0;return r.length!==Object.keys(t).length}function ae(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var ie=Object.freeze({scopes:W,currentScope:Y,willFinalize:function(e,t,n){var r=Y();r.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(n&&function e(t){if(!t||"object"!==(void 0===t?"undefined":M(t)))return;var n=t[B];if(!n)return;var r=n.base,o=n.draft,a=n.assigned;if(Array.isArray(t)){if(ae(n)){if(ee(n),a.length=!0,o.length<r.length)for(var i=o.length;i<r.length;i++)a[i]=!1;else for(var l=r.length;l<o.length;l++)a[l]=!0;for(var s=0;s<o.length;s++)void 0===a[s]&&e(o[s])}}else Object.keys(o).forEach((function(t){void 0!==r[t]||V(r,t)?a[t]||e(o[t]):(a[t]=!0,ee(n))})),Object.keys(r).forEach((function(e){void 0!==o[e]||V(o,e)||(a[e]=!1,ee(n))}))}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?ae(n)&&ee(n):oe(n)&&ee(n))}}(r))},createDraft:Q}),le=[],se=function(){return le[le.length-1]};function ce(e,t){var n={scope:t?t.scope:se(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],de):Proxy.revocable(n,ue),o=r.revoke,a=r.proxy;return n.draft=a,n.revoke=o,n.scope.push(n),a}var ue={get:function(e,t){if(t===B)return e;var n=e.drafts;if(!e.modified&&V(n,t))return n[t];var r=pe(e)[t];if(e.finalized||!L(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=ce(r,e)},has:function(e,t){return t in pe(e)},ownKeys:function(e){return Reflect.ownKeys(pe(e))},set:function(e,t,n){if(!e.modified){if(n?J(e.base[t],n)||n===e.drafts[t]:J(e.base[t],n)&&t in e.base)return!0;fe(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,fe(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=pe(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},de={};function pe(e){return e.copy||e.base}function fe(e){e.modified||(e.modified=!0,e.copy=T(K(e.base),e.drafts),e.drafts=null,e.parent&&fe(e.parent))}F(ue,(function(e,t){de[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),de.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return ue.deleteProperty.call(this,e[0],t)},de.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return ue.set.call(this,e[0],t,n)};var ve=Object.freeze({scopes:le,currentScope:se,willFinalize:function(){},createDraft:ce});function he(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,a=e.copy,i=e.assigned,l=Math.min(o.length,a.length),s=0;s<l;s++)if(i[s]&&o[s]!==a[s]){var c=t.concat(s);n.push({op:"replace",path:c,value:a[s]}),r.push({op:"replace",path:c,value:o[s]})}if(l<a.length){for(var u=l;u<a.length;u++)n.push({op:"add",path:t.concat(u),value:a[u]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(l<o.length){n.push({op:"replace",path:t.concat("length"),value:a.length});for(var d=l;d<o.length;d++)r.push({op:"add",path:t.concat(d),value:o[d]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,a=e.copy;F(e.assigned,(function(e,i){var l=o[e],s=a[e],c=i?e in o?"replace":"add":"remove";if(l!==s||"replace"!==c){var u=t.concat(e);n.push("remove"===c?{op:c,path:u}:{op:c,path:u,value:s}),r.push("add"===c?{op:"remove",path:u}:"remove"===c?{op:"add",path:u,value:l}:{op:"replace",path:u,value:l})}}))}(e,t,n,r)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var a=e,i=0;i<o.length-1;i++)if(!(a=a[o[i]])||"object"!==(void 0===a?"undefined":M(a)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var l=o[o.length-1];switch(r.op){case"replace":case"add":a[l]=r.value;break;case"remove":if(Array.isArray(a)){if(l!==a.length-1)throw new Error("Only the last index of an array can be removed, index: "+l+", length: "+a.length);a.length-=1}else delete a[l];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var ge={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},ye=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,ge,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return z(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(i,(function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var a=void 0;if(L(e)){this.scopes.push([]);var i=this.createDraft(e);try{a=t.call(i,i),this.willFinalize(a,i,!!n);var l=n&&[],s=n&&[];if(void 0===a||a===i)a=this.finalize(i,[],l,s);else{if(i[B].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");L(a)&&(a=this.finalize(a)),n&&(l.push({op:"replace",path:[],value:a}),s.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}n&&n(l,s)}else if(void 0===(a=t(e)))return e;return a===N?void 0:a}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,T(this,e?ve:ie)}},{key:"applyPatches",value:function(e,t){return q(e)?me(e,t):this.produce(e,(function(e){return me(e,t)}))}},{key:"finalize",value:function(e,t,n,r){var o=this,a=e[B];if(!a)return Object.isFrozen(e)?e:this.finalizeTree(e);if(a.scope!==this.currentScope())return e;if(!a.modified)return a.base;if(!a.finalized){if(a.finalized=!0,this.finalizeTree(a.draft,t,n,r),this.onDelete)if(this.useProxies){var i=a.assigned;for(var l in i)i[l]||this.onDelete(a,l)}else{var s=a.base,c=a.copy;F(s,(function(e){V(c,e)||o.onDelete(a,e)}))}this.onCopy&&this.onCopy(a),this.autoFreeze&&1===this.scopes.length&&Object.freeze(a.copy),n&&he(a,t,n,r)}return a.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,a=e[B];a&&(this.useProxies||(a.finalizing=!0,a.copy=K(a.draft,!0),a.finalizing=!1),e=a.copy);var i=this.onAssign;return F(e,(function l(s,c,u){if(c===u)throw Error("Immer forbids circular references");var d=!!a&&u===e;if(q(c)){if(c=n&&d&&!a.assigned[s]?o.finalize(c,t.concat(s),n,r):o.finalize(c),Array.isArray(u)||U(u,s)?u[s]=c:Object.defineProperty(u,s,{value:c}),d&&c===a.base[s])return}else{if(d&&J(c,a.base[s]))return;L(c)&&!Object.isFrozen(c)&&F(c,l)}d&&i&&i(a,s,c)})),e}}]),e}()),be=ye.produce;ye.setAutoFreeze.bind(ye),ye.setUseProxies.bind(ye),ye.applyPatches.bind(ye);const xe=console.log,$e=console.error;function we(e){$e("ERROR:",e)}function Pe({game:e,isClient:t}){return e=Fe(e),(n=null,r)=>{switch(r.type){case"GAME_EVENT":{if(n={...n,deltalog:[]},t)return n;if(void 0!==n.ctx.gameover)return we("cannot call event after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return we(`disallowed event: ${r.payload.type}`),n;n=Me(n,{game:e,isClient:!1,playerID:r.payload.playerID});let o=e.flow.processEvent(n,r);return o=ze(o,{game:e,isClient:!1}),{...o,_stateID:n._stateID+1}}case"MAKE_MOVE":{n={...n,deltalog:[]};const o=e.flow.getMove(n.ctx,r.payload.type,r.payload.playerID||n.ctx.currentPlayer);if(null===o)return we(`disallowed move: ${r.payload.type}`),n;if(t&&!1===o.client)return n;if(void 0!==n.ctx.gameover)return we("cannot make move after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return we(`disallowed move: ${r.payload.type}`),n;n=Me(n,{game:e,isClient:t,playerID:r.payload.playerID});let a=e.processMove(n,r.payload);if("INVALID_MOVE"===a)return we(`invalid move: ${r.payload.type} args: ${r.payload.args}`),n;let i={action:r,_stateID:n._stateID,turn:n.ctx.turn,phase:n.ctx.phase};!0===o.redact&&(i.redact=!0);const l={...n,G:a,deltalog:[i],_stateID:n._stateID+1};return t&&Ne(l,{game:e})?n:(n=l,t?n=ze(n,{game:e,isClient:!0}):(n=e.flow.processMove(n,r.payload),n=ze(n,{game:e})))}case"RESET":case"UPDATE":case"SYNC":return r.state;case"UNDO":{const{_undo:t,_redo:r}=n;if(t.length<2)return n;const l=t[t.length-1],s=t[t.length-2],c=e.flow.getMove(n.ctx,l.moveType,n.ctx.currentPlayer);return o=n.G,a=n.ctx,!function(e){return void 0!==e.undoable}(i=c)||(i.undoable instanceof Function?i.undoable(o,a):i.undoable)?{...n,G:s.G,ctx:s.ctx,_undo:t.slice(0,t.length-1),_redo:[l,...r]}:n}case"REDO":{const{_undo:e,_redo:t}=n;if(0==t.length)return n;const r=t[0];return{...n,G:r.G,ctx:r.ctx,_undo:[...e,r],_redo:t.slice(1)}}case"PLUGIN":return Ae(n,r,{game:e});default:return n}var o,a,i}}const Oe={name:"plugin-immer",fnWrap:e=>(t,n,...r)=>{let o=!1;const a=be(t,t=>{const a=e(t,n,...r);if("INVALID_MOVE"!==a)return a;o=!0});return o?"INVALID_MOVE":a}};function ke(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function _e(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function Ie(e,n){var r=new ke(e),o=n&&n.state,a=r.next;return a.quick=a,o&&("object"==t(o)&&_e(o,r),a.state=function(){return _e(r,{})}),a}var Ee=function(){function e(t){n(this,e),this.state=t,this.used=!1}return o(e,[{key:"isUsed",value:function(){return this.used}},{key:"getState",value:function(){return this.state}},{key:"_random",value:function(){this.used=!0;var e,t=this.state,n=(e=void 0===t.prngstate?new Ie(t.seed,{state:!0}):new Ie("",{state:t.prngstate}))();return this.state=l({},t,{prngstate:e.state()}),n}},{key:"api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:p(new Array(t).keys()).map((function(){return Math.floor(e()*o)+1}))}};for(var o in t)r(o);return l({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:p(new Array(n).keys()).map((function(){return Math.floor(e()*t)+1}))},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,a=new Array(r);r;){var i=r*e()|0;a[o++]=n[i],n[i]=n[--r]}return a},_obj:this})}}]),e}();Ee.seed=function(){return(+new Date).toString(36).slice(-10)};class De{constructor(e,t){this.flow=e,this.playerID=t,this.dispatch=[]}api(e){const t={_obj:this},{phase:n,turn:r}=e;for(const e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({key:e,args:t,phase:n,turn:r})};return t}isUsed(){return this.dispatch.length>0}update(e){for(let t=0;t<this.dispatch.length;t++){const n=this.dispatch[t];if("endTurn"===n.key&&n.turn!==e.ctx.turn)continue;if(("endPhase"===n.key||"setPhase"===n.key)&&n.phase!==e.ctx.phase)continue;const r=k(n.key,n.args,this.playerID);e={...e,...this.flow.processEvent(e,r)}}return e}}const je=[Oe,{name:"random",noClient:({api:e})=>e._obj.isUsed(),flush:({api:e})=>e._obj.getState(),api:({data:e})=>new Ee(e).api(),setup:({game:e})=>{let t=e.seed;return void 0===t&&(t=Ee.seed()),{seed:t}}},{name:"events",noClient:({api:e})=>e._obj.isUsed(),dangerouslyFlushRawState:({state:e,api:t})=>t._obj.update(e),api:({game:e,playerID:t,ctx:n})=>new De(e.flow,t).api(n)}],Ae=(e,t,n)=>(n.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},a=n.action(o.data,t.payload);e={...e,plugins:{...e.plugins,[r]:{...o,data:a}}}}),e),Se=e=>{let t={...e.ctx};const n=e.plugins||{};return Object.entries(n).forEach(([e,{api:n}])=>{t[e]=n}),t},Ce=(e,t)=>[...je,...t].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:t})=>t(e),e),Me=(e,t)=>([...je,...t.game.plugins].filter(e=>void 0!==e.api).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},a=n.api({G:e.G,ctx:e.ctx,data:o.data,game:t.game,playerID:t.playerID});e={...e,plugins:{...e.plugins,[r]:{...o,api:a}}}}),e),ze=(e,t)=>([...je,...t.game.plugins].reverse().forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}};if(n.flush){const r=n.flush({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data});e={...e,plugins:{...e.plugins,[n.name]:{data:r}}}}else if(n.dangerouslyFlushRawState){const a=(e=n.dangerouslyFlushRawState({state:e,game:t.game,api:o.api,data:o.data})).plugins[r].data;e={...e,plugins:{...e.plugins,[n.name]:{data:a}}}}}),e),Ne=(e,t)=>[...je,...t.game.plugins].filter(e=>void 0!==e.noClient).map(n=>{const r=n.name,o=e.plugins[r];return!!o&&n.noClient({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data})}).some(e=>!0===e);function Ge(e,t,n){return{...e,ctx:Be(e.ctx,n)}}function Be(e,t){let{_prevActivePlayers:n}=e,r={},o=null,a={};if(Array.isArray(t)){let e={};t.forEach(t=>e[t]=Re.NULL),r=e}else{if(t.next&&(o=t.next),n=t.revert?n.concat({activePlayers:e.activePlayers,_activePlayersMoveLimit:e._activePlayersMoveLimit,_activePlayersNumMoves:e._activePlayersNumMoves}):[],void 0!==t.currentPlayer&&qe(r,a,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(let n=0;n<e.playOrder.length;n++){const o=e.playOrder[n];o!==e.currentPlayer&&qe(r,a,o,t.others)}if(void 0!==t.all)for(let n=0;n<e.playOrder.length;n++){qe(r,a,e.playOrder[n],t.all)}if(t.value)for(const e in t.value)qe(r,a,e,t.value[e]);if(t.moveLimit)for(const e in r)void 0===a[e]&&(a[e]=t.moveLimit)}0==Object.keys(r).length&&(r=null),0==Object.keys(a).length&&(a=null);let i={};for(const e in r)i[e]=0;return{...e,activePlayers:r,_activePlayersMoveLimit:a,_activePlayersNumMoves:i,_prevActivePlayers:n,_nextActivePlayers:o}}function qe(e,t,n,r){"object"==typeof r&&r!==Re.NULL||(r={stage:r}),void 0!==r.stage&&(e[n]=r.stage,r.moveLimit&&(t[n]=r.moveLimit))}function Le(e,t){return e[t]+""}const Te={first:(e,t)=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},Re={NULL:null};function Ke({moves:e,phases:t,endIf:n,onEnd:r,turn:o,events:a,plugins:i}){void 0===e&&(e={}),void 0===a&&(a={}),void 0===i&&(i=[]),void 0===t&&(t={}),n||(n=()=>{}),r||(r=e=>e),o||(o={});const l={...t};""in l&&we("cannot specify phase with empty name"),l[""]={};let s={},c=new Set,u=null;Object.keys(e).forEach(e=>c.add(e));const d=e=>{const t=Ce(e,i);return e=>{const n=Se(e);return t(e.G,n)}},p=e=>t=>{let n=Se(t);return e(t.G,n)},f={onEnd:d(r),endIf:p(n)};for(let e in l){const t=l[e];if(!0===t.start&&(u=e),void 0!==t.moves)for(let n of Object.keys(t.moves))s[e+"."+n]=t.moves[n],c.add(n);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=e=>e),void 0===t.onEnd&&(t.onEnd=e=>e),void 0===t.turn&&(t.turn=o),void 0===t.turn.order&&(t.turn.order=Te),void 0===t.turn.onBegin&&(t.turn.onBegin=e=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=e=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=e=>e),void 0===t.turn.stages&&(t.turn.stages={});for(const n in t.turn.stages){const r=t.turn.stages[n].moves||{};for(let t of Object.keys(r)){s[e+"."+n+"."+t]=r[t],c.add(t)}}t.wrapped={onBegin:d(t.onBegin),onEnd:d(t.onEnd),endIf:p(t.endIf)},t.turn.wrapped={onMove:d(t.turn.onMove),onBegin:d(t.turn.onBegin),onEnd:d(t.turn.onEnd),endIf:p(t.turn.endIf)}}function v(e){return e.phase?l[e.phase]:l[""]}function h(e){return e}function m(e,t){const n=new Set,r=new Set;for(let o=0;o<t.length;o++){const{fn:a,arg:i,...l}=t[o];if(a===E){r.clear();const t=e.ctx.phase;if(n.has(t)){const t={...e.ctx,phase:null};return{...e,ctx:t}}n.add(t)}let s=[];if(e=a(e,{...l,arg:i,next:s}),a===I)break;const c=P(e);if(c){t.push({fn:I,arg:c,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}const u=k(e);if(u)t.push({fn:E,arg:u,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});else{if(a===h){const n=_(e);if(n){t.push({fn:D,arg:n,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...s)}}return e}function g(e,{next:t}){return t.push({fn:y}),e}function y(e,{next:t}){let{G:n,ctx:r}=e;return n=v(r).wrapped.onBegin(e),t.push({fn:b}),{...e,G:n,ctx:r}}function b(e,{currentPlayer:t}){let{G:n,ctx:r}=e;const o=v(r);t?(r={...r,currentPlayer:t},o.turn.activePlayers&&(r=Be(r,o.turn.activePlayers))):r=function(e,t){let{G:n,ctx:r}=e;const o=Se(e),a=t.order;let i=[...new Array(r.numPlayers)].map((e,t)=>t+"");void 0!==a.playOrder&&(i=a.playOrder(n,o));const l=a.first(n,o),s=typeof l;"number"!==s&&we(`invalid value returned by turn.order.first — expected number got ${s} “${l}”.`);const c=Le(i,l);return r={...r,currentPlayer:c,playOrderPos:l,playOrder:i},r=Be(r,t.activePlayers||{}),r}(e,o.turn);const a=r.turn+1;r={...r,turn:a,numMoves:0,_prevActivePlayers:[]},n=o.turn.wrapped.onBegin({...e,G:n,ctx:r});const i=[{G:n,ctx:r}];return{...e,G:n,ctx:r,_undo:i,_redo:[]}}function x(e,{arg:t,next:n,phase:r}){const o=v({phase:r});let{ctx:a}=e;if(t&&t.next){if(!(t.next in l))return we("invalid phase: "+t.next),e;a={...a,phase:t.next}}else a=void 0!==o.next?{...a,phase:o.next}:{...a,phase:null};return e={...e,ctx:a},n.push({fn:y}),e}function $(e,{arg:t,currentPlayer:n,next:r}){let{G:o,ctx:a}=e;const i=v(a),{endPhase:l,ctx:s}=function(e,t,n,r){const o=n.order;let{G:a,ctx:i}=e,l=i.playOrderPos,s=!1;if(r&&!0!==r)"object"!=typeof r&&we(`invalid argument to endTurn: ${r}`),Object.keys(r).forEach(e=>{switch(e){case"remove":t=Le(i.playOrder,l);break;case"next":l=i.playOrder.indexOf(r.next),t=r.next;break;default:we(`invalid argument to endTurn: ${e}`)}});else{const n=Se(e),r=o.next(a,n),c=typeof r;void 0!==r&&"number"!==c&&we(`invalid value returned by turn.order.next — expected number or undefined got ${c} “${r}”.`),void 0===r?s=!0:(l=r,t=Le(i.playOrder,l))}return i={...i,playOrderPos:l,currentPlayer:t},{endPhase:s,ctx:i}}(e,n,i.turn,t);return a=s,e={...e,G:o,ctx:a},l?r.push({fn:E,turn:a.turn,phase:a.phase}):r.push({fn:b,currentPlayer:a.currentPlayer}),e}function w(e,{arg:t,playerID:n}){"string"==typeof t&&(t={stage:t});let{ctx:r}=e,{activePlayers:o,_activePlayersMoveLimit:a,_activePlayersNumMoves:i}=r;return t.stage&&(null===o&&(o={}),o[n]=t.stage,i[n]=0,t.moveLimit&&(null===a&&(a={}),a[n]=t.moveLimit)),r={...r,activePlayers:o,_activePlayersMoveLimit:a,_activePlayersNumMoves:i},{...e,ctx:r}}function P(e){return f.endIf(e)}function k(e){return v(e.ctx).wrapped.endIf(e)}function _(e){const t=v(e.ctx),n=e.ctx.numMoves||0;return!!(t.turn.moveLimit&&n>=t.turn.moveLimit)||t.turn.wrapped.endIf(e)}function I(e,{arg:t,phase:n}){e=E(e,{phase:n}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};const r=f.onEnd(e);return{...e,G:r}}function E(e,{arg:t,next:n,turn:r,automatic:o}){let a=(e=D(e,{turn:r,force:!0})).G,i=e.ctx;if(n&&n.push({fn:x,arg:t,phase:i.phase}),null===i.phase)return e;a=v(i).wrapped.onEnd(e),i={...i,phase:null};const l={action:O("endPhase",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};o&&(l.automatic=!0);const s=[...e.deltalog,l];return{...e,G:a,ctx:i,deltalog:s}}function D(e,{arg:t,next:n,turn:r,force:o,automatic:a,playerID:i}){if(r!==e.ctx.turn)return e;let{G:l,ctx:s}=e;const c=v(s),u=s.numMoves||0;if(!o&&c.turn.moveLimit&&u<c.turn.moveLimit)return d=`cannot end turn before making ${c.turn.moveLimit} moves`,xe(`INFO: ${d}`),e;var d;if(l=c.turn.wrapped.onEnd(e),n&&n.push({fn:$,arg:t,currentPlayer:s.currentPlayer}),s={...s,activePlayers:null},t&&t.remove){i=i||s.currentPlayer;const t=s.playOrder.filter(e=>e!=i),r=s.playOrderPos>t.length-1?0:s.playOrderPos;if(s={...s,playOrder:t,playOrderPos:r},0===t.length)return n.push({fn:E,turn:s.turn,phase:s.phase}),e}const p={action:O("endTurn",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};a&&(p.automatic=!0);const f=[...e.deltalog||[],p];return{...e,G:l,ctx:s,deltalog:f,_undo:[],_redo:[]}}function j(e,{arg:t,next:n,automatic:r,playerID:o}){o=o||e.ctx.currentPlayer;let{ctx:a}=e,{activePlayers:i,_activePlayersMoveLimit:l}=a;const s=null!==i&&o in i;if(!t&&s){const e=v(a).turn.stages[i[o]];e&&e.next&&(t=e.next)}if(n&&t&&n.push({fn:w,arg:t,playerID:o}),!s)return e;i=Object.keys(i).filter(e=>e!==o).reduce((e,t)=>(e[t]=i[t],e),{}),l&&(l=Object.keys(l).filter(e=>e!==o).reduce((e,t)=>(e[t]=l[t],e),{})),a=function(e){let{activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e;if(t&&0==Object.keys(t).length)if(e._nextActivePlayers)e=Be(e,e._nextActivePlayers),({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e);else if(o.length>0){const e=o.length-1;({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r}=o[e]),o=o.slice(0,e)}else t=null,n=null;return{...e,activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}}({...a,activePlayers:i,_activePlayersMoveLimit:l});const c={action:O("endStage",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};r&&(c.automatic=!0);const u=[...e.deltalog||[],c];return{...e,ctx:a,deltalog:u}}function A(t,n,r){const o=v(t),a=o.turn.stages,{activePlayers:i}=t;if(i&&void 0!==i[r]&&i[r]!==Re.NULL&&void 0!==a[i[r]]&&void 0!==a[i[r]].moves){const e=a[i[r]].moves;if(n in e)return e[n]}else if(o.moves){if(n in o.moves)return o.moves[n]}else if(n in e)return e[n];return null}const S={endStage:function(e,t){return m(e,[{fn:j,playerID:t}])},setStage:function(e,t,n){return m(e,[{fn:j,arg:n,playerID:t}])},endTurn:function(e,t,n){return m(e,[{fn:D,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},pass:function(e,t,n){return m(e,[{fn:D,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:n}])},endPhase:function(e){return m(e,[{fn:E,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,n){return m(e,[{fn:E,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:n}}])},endGame:function(e,t,n){return m(e,[{fn:I,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},setActivePlayers:Ge};let C=[];return!1!==a.endTurn&&C.push("endTurn"),!1!==a.pass&&C.push("pass"),!1!==a.endPhase&&C.push("endPhase"),!1!==a.setPhase&&C.push("setPhase"),!1!==a.endGame&&C.push("endGame"),!1!==a.setActivePlayers&&C.push("setActivePlayers"),!1!==a.endStage&&C.push("endStage"),!1!==a.setStage&&C.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...new Array(e)].map((e,t)=>t+""),playOrderPos:0,phase:u,activePlayers:null}),init:e=>m(e,[{fn:g}]),isPlayerActive:function(e,t,n){return t.activePlayers?n in t.activePlayers:t.currentPlayer===n},eventHandlers:S,eventNames:Object.keys(S),enabledEventNames:C,moveMap:s,moveNames:[...c.values()],processMove:function(e,t){let n=v(e.ctx);const r=A(e.ctx,t.type,t.playerID),o=!r||"function"==typeof r||!0!==r.noLimit;let{ctx:a}=e,{_activePlayersNumMoves:i}=a;const{playerID:l}=t;let s=e.ctx.numMoves;o&&(l==e.ctx.currentPlayer&&s++,a.activePlayers&&i[l]++),e={...e,ctx:{...a,numMoves:s,_activePlayersNumMoves:i}},a._activePlayersMoveLimit&&i[l]>=a._activePlayersMoveLimit[l]&&(e=j(e,{playerID:l,automatic:!0}));const c=n.turn.wrapped.onMove(e),u=(e={...e,G:c})._undo||[],d=t.type;return m(e={...e,_undo:[...u,{G:e.G,ctx:e.ctx,moveType:d}],_redo:[]},[{fn:h}])},processEvent:function(e,t){const{type:n,playerID:r,args:o}=t.payload;if(S.hasOwnProperty(n)){const t=[e,r].concat(o);return S[n].apply({},t)}return e},getMove:A}}function Fe(e){if(function(e){return void 0!==e.processMove}(e))return e;if(void 0===e.name&&(e.name="default"),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=e=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw new Error("Plugin missing name attribute");if(e.name.includes(" "))throw new Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw new Error(e.name+": Game name must not include spaces");const t=Ke(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(n,r)=>{let o=t.getMove(n.ctx,r.type,r.playerID);var a;if((a=o)instanceof Object&&void 0!==a.move&&(o=o.move),o instanceof Function){const t=Ce(o,e.plugins),a={...Se(n),playerID:r.playerID};let i=[];return void 0!==r.args&&(i=i.concat(r.args)),t(n.G,a,...i)}return we(`invalid move object: ${r.type}`),n.G}}}function Ue(){}const Ve=e=>e;function Je(e,t){for(const n in t)e[n]=t[n];return e}function He(e){return e()}function We(){return Object.create(null)}function Ye(e){e.forEach(He)}function Qe(e){return"function"==typeof e}function Xe(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function Ze(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function et(e,t,n){return e[1]?Je({},Je(t.$$scope.ctx,e[1](n?n(t):{}))):t.$$scope.ctx}function tt(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}const nt="undefined"!=typeof window;let rt=nt?()=>window.performance.now():()=>Date.now(),ot=nt?e=>requestAnimationFrame(e):Ue;const at=new Set;let it,lt=!1;function st(){at.forEach(e=>{e[0](rt())||(at.delete(e),e[1]())}),lt=at.size>0,lt&&ot(st)}function ct(e,t){e.appendChild(t)}function ut(e,t,n){e.insertBefore(t,n||null)}function dt(e){e.parentNode.removeChild(e)}function pt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function ft(e){return document.createElement(e)}function vt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ht(e){return document.createTextNode(e)}function mt(){return ht(" ")}function gt(){return ht("")}function yt(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function bt(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function xt(e,t){t=""+t,e.data!==t&&(e.data=t)}function $t(e,t){(null!=t||e.value)&&(e.value=t)}function wt(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}}function Pt(e,t,n){e.classList[n?"add":"remove"](t)}function Ot(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}let kt,_t=0,It={};function Et(e,t,n,r,o,a,i,l=0){const s=16.666/r;let c="{\n";for(let e=0;e<=1;e+=s){const r=t+(n-t)*a(e);c+=100*e+`%{${i(r,1-r)}}\n`}const u=c+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`;if(!It[d]){if(!it){const e=ft("style");document.head.appendChild(e),it=e.sheet}It[d]=!0,it.insertRule(`@keyframes ${d} ${u}`,it.cssRules.length)}const p=e.style.animation||"";return e.style.animation=`${p?`${p}, `:""}${d} ${r}ms linear ${o}ms 1 both`,_t+=1,d}function Dt(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--_t&&ot(()=>{if(_t)return;let e=it.cssRules.length;for(;e--;)it.deleteRule(e);It={}})}function jt(e){kt=e}function At(){if(!kt)throw new Error("Function called outside component initialization");return kt}function St(e){At().$$.on_destroy.push(e)}function Ct(){const e=kt;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=Ot(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}function Mt(e,t){At().$$.context.set(e,t)}function zt(e){return At().$$.context.get(e)}const Nt=[],Gt=[],Bt=[],qt=[],Lt=Promise.resolve();let Tt,Rt=!1;function Kt(e){Bt.push(e)}function Ft(){const e=new Set;do{for(;Nt.length;){const e=Nt.shift();jt(e),Ut(e.$$)}for(;Gt.length;)Gt.pop()();for(let t=0;t<Bt.length;t+=1){const n=Bt[t];e.has(n)||(n(),e.add(n))}Bt.length=0}while(Nt.length);for(;qt.length;)qt.pop()();Rt=!1}function Ut(e){e.fragment&&(e.update(e.dirty),Ye(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(Kt))}function Vt(e,t,n){e.dispatchEvent(Ot(`${t?"intro":"outro"}${n}`))}const Jt=new Set;let Ht;function Wt(){Ht={r:0,c:[],p:Ht}}function Yt(){Ht.r||Ye(Ht.c),Ht=Ht.p}function Qt(e,t){e&&e.i&&(Jt.delete(e),e.i(t))}function Xt(e,t,n,r){if(e&&e.o){if(Jt.has(e))return;Jt.add(e),Ht.c.push(()=>{Jt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}const Zt={duration:0};function en(e,t,n,r){let o=t(e,n),a=r?0:1,i=null,l=null,s=null;function c(){s&&Dt(e,s)}function u(e,t){const n=e.b-a;return t*=Math.abs(n),{a:a,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function d(t){const{delay:n=0,duration:r=300,easing:d=Ve,tick:p=Ue,css:f}=o||Zt,v={start:rt()+n,b:t};t||(v.group=Ht,Ht.r+=1),i?l=v:(f&&(c(),s=Et(e,a,t,r,n,d,f)),t&&p(0,1),i=u(v,r),Kt(()=>Vt(e,t,"start")),function(e){let t;lt||(lt=!0,ot(st)),new Promise(n=>{at.add(t=[e,n])})}(t=>{if(l&&t>l.start&&(i=u(l,r),l=null,Vt(e,i.b,"start"),f&&(c(),s=Et(e,a,i.b,i.duration,0,d,o.css))),i)if(t>=i.end)p(a=i.b,1-a),Vt(e,i.b,"end"),l||(i.b?c():--i.group.r||Ye(i.group.c)),i=null;else if(t>=i.start){const e=t-i.start;a=i.a+i.d*d(e/i.duration),p(a,1-a)}return!(!i&&!l)}))}return{run(e){Qe(o)?(Tt||(Tt=Promise.resolve(),Tt.then(()=>{Tt=null})),Tt).then(()=>{o=o(),d(e)}):d(e)},end(){c(),i=l=null}}}const tn="undefined"!=typeof window?window:global;function nn(e,t,n){const{fragment:r,on_mount:o,on_destroy:a,after_update:i}=e.$$;r.m(t,n),Kt(()=>{const t=o.map(He).filter(Qe);a?a.push(...t):Ye(t),e.$$.on_mount=[]}),i.forEach(Kt)}function rn(e,t){e.$$.fragment&&(Ye(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function on(e,t){e.$$.dirty||(Nt.push(e),Rt||(Rt=!0,Lt.then(Ft)),e.$$.dirty=We()),e.$$.dirty[t]=!0}function an(e,t,n,r,o,a){const i=kt;jt(e);const l=t.props||{},s=e.$$={fragment:null,ctx:null,props:a,update:Ue,not_equal:o,bound:We(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:We(),dirty:null};let c=!1;s.ctx=n?n(e,l,(t,n,r=n)=>(s.ctx&&o(s.ctx[t],s.ctx[t]=r)&&(s.bound[t]&&s.bound[t](r),c&&on(e,t)),n)):l,s.update(),c=!0,Ye(s.before_update),s.fragment=r(s.ctx),t.target&&(t.hydrate?s.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):s.fragment.c(),t.intro&&Qt(e.$$.fragment),nn(e,t.target,t.anchor),Ft()),jt(i)}class ln{$destroy(){rn(this,1),this.$destroy=Ue}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const sn=[];function cn(e,t=Ue){let n;const r=[];function o(t){if(Xe(e,t)&&(e=t,n)){const t=!sn.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),sn.push(n,e)}if(t){for(let e=0;e<sn.length;e+=2)sn[e][0](sn[e+1]);sn.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(a,i=Ue){const l=[a,i];return r.push(l),1===r.length&&(n=t(o)||Ue),a(e),()=>{const e=r.indexOf(l);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}function un(e){const t=e-1;return t*t*t+1}function dn(e,{delay:t=0,duration:n=400,easing:r=un,x:o=0,y:a=0,opacity:i=0}){const l=getComputedStyle(e),s=+l.opacity,c="none"===l.transform?"":l.transform,u=s*(1-i);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*o}px, ${(1-e)*a}px);\n\t\t\topacity: ${s-u*t}`}}function pn(e,t,n){const r=Object.create(e);return r.key=t[n][0],r.label=t[n][1].label,r}function fn(e){var t,n,r,o,a=e.label+"";function i(){return e.click_handler(e)}return{c(){t=ft("div"),n=ht(a),r=mt(),bt(t,"class","menu-item svelte-19bfq8g"),Pt(t,"active",e.pane==e.key),o=yt(t,"click",i)},m(e,o){ut(e,t,o),ct(t,n),ct(t,r)},p(r,o){e=o,r.panes&&a!==(a=e.label+"")&&xt(n,a),(r.pane||r.panes)&&Pt(t,"active",e.pane==e.key)},d(e){e&&dt(t),o()}}}function vn(e){var t;let n=Object.entries(e.panes).reverse(),r=[];for(let t=0;t<n.length;t+=1)r[t]=fn(pn(e,n,t));return{c(){t=ft("div");for(let e=0;e<r.length;e+=1)r[e].c();bt(t,"class","menu svelte-19bfq8g")},m(e,n){ut(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.pane||e.panes){let a;for(n=Object.entries(o.panes).reverse(),a=0;a<n.length;a+=1){const i=pn(o,n,a);r[a]?r[a].p(e,i):(r[a]=fn(i),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ue,o:Ue,d(e){e&&dt(t),pt(r,e)}}}function hn(e,t,n){let{pane:r,panes:o}=t;const a=Ct();return e.$set=e=>{"pane"in e&&n("pane",r=e.pane),"panes"in e&&n("panes",o=e.panes)},{pane:r,panes:o,dispatch:a,click_handler:({key:e})=>a("change",e)}}class mn extends ln{constructor(e){var t;super(),document.getElementById("svelte-19bfq8g-style")||((t=ft("style")).id="svelte-19bfq8g-style",t.textContent=".menu.svelte-19bfq8g{display:flex;margin-top:-10px;flex-direction:row;border:1px solid #ccc;border-radius:5px 5px 0 0;height:25px;line-height:25px;margin-right:-500px;transform-origin:bottom right;transform:rotate(-90deg) translate(0, -500px)}.menu-item.svelte-19bfq8g{line-height:25px;cursor:pointer;background:#fefefe;color:#555;padding-left:15px;padding-right:15px;text-align:center}.menu-item.svelte-19bfq8g:last-child{border-radius:0 5px 0 0}.menu-item.svelte-19bfq8g:first-child{border-radius:5px 0 0 0}.menu-item.active.svelte-19bfq8g{cursor:default;font-weight:bold;background:#ddd;color:#555}.menu-item.svelte-19bfq8g:hover{background:#ddd;color:#555}",ct(document.head,t)),an(this,e,hn,vn,Xe,["pane","panes"])}}function gn(e){var t,n;return{c(){t=ft("div"),n=ht(e.label),bt(t,"class","label svelte-1olzq4i")},m(e,r){ut(e,t,r),ct(t,n)},p(e,t){e.label&&xt(n,t.label)},d(e){e&&dt(t)}}}function yn(e){var t,n,r,o,a,i=e.label&&gn(e);return{c(){t=ft("div"),n=ft("div"),r=ht(e.value),o=mt(),i&&i.c(),bt(n,"class","key-box svelte-1olzq4i"),bt(t,"class","key svelte-1olzq4i"),Pt(t,"active",e.active),a=[yt(window,"keydown",e.Keypress),yt(n,"click",e.Activate)]},m(e,a){ut(e,t,a),ct(t,n),ct(n,r),ct(t,o),i&&i.m(t,null)},p(e,n){e.value&&xt(r,n.value),n.label?i?i.p(e,n):((i=gn(n)).c(),i.m(t,null)):i&&(i.d(1),i=null),e.active&&Pt(t,"active",n.active)},i:Ue,o:Ue,d(e){e&&dt(t),i&&i.d(),Ye(a)}}}function bn(e,t,n){let r,{value:o,onPress:a=null,label:i=null,disable:l=!1}=t;const{disableHotkeys:s}=zt("hotkeys");Ze(e,s,e=>{r=e,n("$disableHotkeys",r)});let c=!1;function u(){n("active",c=!1)}function d(){n("active",c=!0),setTimeout(u,200),a&&setTimeout(a,1)}return e.$set=e=>{"value"in e&&n("value",o=e.value),"onPress"in e&&n("onPress",a=e.onPress),"label"in e&&n("label",i=e.label),"disable"in e&&n("disable",l=e.disable)},{value:o,onPress:a,label:i,disable:l,disableHotkeys:s,active:c,Activate:d,Keypress:function(e){r||l||e.ctrlKey||e.metaKey||e.key!=o||(e.preventDefault(),d())}}}class xn extends ln{constructor(e){var t;super(),document.getElementById("svelte-1olzq4i-style")||((t=ft("style")).id="svelte-1olzq4i-style",t.textContent=".key.svelte-1olzq4i{display:flex;flex-direction:row;align-items:center}.key-box.svelte-1olzq4i{cursor:pointer;min-width:10px;padding-left:5px;padding-right:5px;height:20px;line-height:20px;text-align:center;border:1px solid #ccc;box-shadow:1px 1px 1px #888;background:#eee;color:#444}.key-box.svelte-1olzq4i:hover{background:#ddd}.key.active.svelte-1olzq4i .key-box.svelte-1olzq4i{background:#ddd;border:1px solid #999;box-shadow:none}.label.svelte-1olzq4i{margin-left:10px}",ct(document.head,t)),an(this,e,bn,yn,Xe,["value","onPress","label","disable"])}}function $n(e){var t,n,r,o,a,i,l,s,c,u;return{c(){var d;t=ft("div"),n=ft("span"),r=ht(e.name),o=mt(),(a=ft("span")).textContent="(",i=mt(),l=ft("span"),s=mt(),(c=ft("span")).textContent=")",bt(l,"class","arg-field svelte-1mppqmp"),bt(l,"contenteditable",""),bt(t,"class","move svelte-1mppqmp"),Pt(t,"active",e.active),u=[yt(l,"blur",e.Deactivate),yt(l,"keypress",(d=wn,function(e){return e.stopPropagation(),d.call(this,e)})),yt(l,"keydown",e.OnKeyDown),yt(t,"click",e.Activate)]},m(u,d){ut(u,t,d),ct(t,n),ct(n,r),ct(t,o),ct(t,a),ct(t,i),ct(t,l),e.span2_binding(l),ct(t,s),ct(t,c)},p(e,n){e.name&&xt(r,n.name),e.active&&Pt(t,"active",n.active)},i:Ue,o:Ue,d(n){n&&dt(t),e.span2_binding(null),Ye(u)}}}const wn=()=>{};function Pn(e,t,n){let r,{Activate:o,Deactivate:a,name:i,active:l}=t;const s=Ct();var c;return c=()=>{l?r.focus():r.blur()},At().$$.after_update.push(c),e.$set=e=>{"Activate"in e&&n("Activate",o=e.Activate),"Deactivate"in e&&n("Deactivate",a=e.Deactivate),"name"in e&&n("name",i=e.name),"active"in e&&n("active",l=e.active)},{Activate:o,Deactivate:a,name:i,active:l,span:r,OnKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),function(){try{const e=r.innerText;let t=new Function(`return [${e}]`)();s("submit",t)}catch(e){s("error",e)}n("span",r.innerText="",r)}()),"Escape"==e.key&&(e.preventDefault(),a())},span2_binding:function(e){Gt[e?"unshift":"push"](()=>{n("span",r=e)})}}}class On extends ln{constructor(e){var t;super(),document.getElementById("svelte-1mppqmp-style")||((t=ft("style")).id="svelte-1mppqmp-style",t.textContent=".move.svelte-1mppqmp{display:flex;flex-direction:row;cursor:pointer;margin-left:10px;color:#666}.move.svelte-1mppqmp:hover{color:#333}.move.active.svelte-1mppqmp{color:#111;font-weight:bold}.arg-field.svelte-1mppqmp{outline:none;font-family:monospace}",ct(document.head,t)),an(this,e,Pn,$n,Xe,["Activate","Deactivate","name","active"])}}function kn(e){var t,n;return{c(){t=ft("span"),n=ht(e.error),bt(t,"class","move-error svelte-smqssc")},m(e,r){ut(e,t,r),ct(t,n)},p(e,t){e.error&&xt(n,t.error)},d(e){e&&dt(t)}}}function _n(e){var t,n,r,o,a,i=new xn({props:{value:e.shortcut,onPress:e.Activate}}),l=new On({props:{Activate:e.Activate,Deactivate:e.Deactivate,name:e.name,active:e.active}});l.$on("submit",e.Submit),l.$on("error",e.Error);var s=e.error&&kn(e);return{c(){t=ft("div"),n=ft("div"),i.$$.fragment.c(),r=mt(),l.$$.fragment.c(),o=mt(),s&&s.c(),bt(n,"class","wrapper svelte-smqssc")},m(e,c){ut(e,t,c),ct(t,n),nn(i,n,null),ct(n,r),nn(l,n,null),ct(t,o),s&&s.m(t,null),a=!0},p(e,n){var r={};e.shortcut&&(r.value=n.shortcut),i.$set(r);var o={};e.name&&(o.name=n.name),e.active&&(o.active=n.active),l.$set(o),n.error?s?s.p(e,n):((s=kn(n)).c(),s.m(t,null)):s&&(s.d(1),s=null)},i(e){a||(Qt(i.$$.fragment,e),Qt(l.$$.fragment,e),a=!0)},o(e){Xt(i.$$.fragment,e),Xt(l.$$.fragment,e),a=!1},d(e){e&&dt(t),rn(i),rn(l),s&&s.d()}}}function In(e,t,n){let{shortcut:r,name:o,fn:a}=t;const{disableHotkeys:i}=zt("hotkeys");let l="",s=!1;function c(){i.set(!1),n("error",l=""),n("active",s=!1)}return e.$set=e=>{"shortcut"in e&&n("shortcut",r=e.shortcut),"name"in e&&n("name",o=e.name),"fn"in e&&n("fn",a=e.fn)},{shortcut:r,name:o,fn:a,error:l,active:s,Activate:function(){i.set(!0),n("active",s=!0)},Deactivate:c,Submit:function(e){n("error",l=""),c(),a.apply(this,e.detail)},Error:function(e){n("error",l=e.detail),we(e.detail)}}}class En extends ln{constructor(e){var t;super(),document.getElementById("svelte-smqssc-style")||((t=ft("style")).id="svelte-smqssc-style",t.textContent=".move-error.svelte-smqssc{color:#a00;font-weight:bold}.wrapper.svelte-smqssc{display:flex;flex-direction:row;align-items:center}",ct(document.head,t)),an(this,e,In,_n,Xe,["shortcut","name","fn"])}}var Dn=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),a=n[0];return"object"==typeof a&&a?function t(n,r,o){return Object.keys(o).reduce((function(o,a){var i=o[a];if(i instanceof e){var l=n[i];"object"!=typeof l||r.has(l)?o[a]=l:(r.add(l),o[a]=t(n,r,l))}return o}),o)}(n,new Set,a):a},stringify:function(e){for(var t,r=new Map,o=[],a=[],i=+n(r,o,e),l=function(e,a){if(t)return t=!t,a;switch(typeof a){case"object":if(null===a)return a;case"string":return r.get(a)||n(r,o,a)}return a};i<o.length;i++)t=!0,a[i]=JSON.stringify(o[i],l);return"["+a.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(t,n){return"string"==typeof n?new e(n):n}}(String);const jn=Dn.parse,An=Dn.stringify;function Sn(e){var t,n,r,o,a,i,l,s,c,u=new xn({props:{value:"1",onPress:e.client.reset,label:"reset"}}),d=new xn({props:{value:"2",onPress:e.Save,label:"save"}}),p=new xn({props:{value:"3",onPress:e.Restore,label:"restore"}}),f=new xn({props:{value:".",disable:!0,label:"hide"}});return{c(){t=ft("section"),n=ft("li"),u.$$.fragment.c(),r=mt(),o=ft("li"),d.$$.fragment.c(),a=mt(),i=ft("li"),p.$$.fragment.c(),l=mt(),s=ft("li"),f.$$.fragment.c(),bt(n,"class","svelte-1x2w9i0"),bt(o,"class","svelte-1x2w9i0"),bt(i,"class","svelte-1x2w9i0"),bt(s,"class","svelte-1x2w9i0"),bt(t,"id","debug-controls"),bt(t,"class","controls")},m(e,v){ut(e,t,v),ct(t,n),nn(u,n,null),ct(t,r),ct(t,o),nn(d,o,null),ct(t,a),ct(t,i),nn(p,i,null),ct(t,l),ct(t,s),nn(f,s,null),c=!0},p(e,t){var n={};e.client&&(n.onPress=t.client.reset),u.$set(n)},i(e){c||(Qt(u.$$.fragment,e),Qt(d.$$.fragment,e),Qt(p.$$.fragment,e),Qt(f.$$.fragment,e),c=!0)},o(e){Xt(u.$$.fragment,e),Xt(d.$$.fragment,e),Xt(p.$$.fragment,e),Xt(f.$$.fragment,e),c=!1},d(e){e&&dt(t),rn(u),rn(d),rn(p),rn(f)}}}function Cn(e,t,n){let{client:r}=t;return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,Save:function(){const{G:e,ctx:t}=r.getState(),n=An({G:e,ctx:t});window.localStorage.setItem("gamestate",n)},Restore:function(){const e=window.localStorage.getItem("gamestate");if(null!==e){const t=jn(e);r.store.dispatch(_(t))}}}}class Mn extends ln{constructor(e){var t;super(),document.getElementById("svelte-1x2w9i0-style")||((t=ft("style")).id="svelte-1x2w9i0-style",t.textContent="li.svelte-1x2w9i0{list-style:none;margin:none;margin-bottom:5px}",ct(document.head,t)),an(this,e,Cn,Sn,Xe,["client"])}}function zn(e,t,n){const r=Object.create(e);return r.player=t[n],r}function Nn(e){var t,n,r,o,a=e.player+"";function i(){return e.click_handler(e)}return{c(){t=ft("div"),n=ht(a),r=mt(),bt(t,"class","player svelte-6sf87x"),Pt(t,"current",e.player==e.ctx.currentPlayer),Pt(t,"active",e.player==e.playerID),o=yt(t,"click",i)},m(e,o){ut(e,t,o),ct(t,n),ct(t,r)},p(r,o){e=o,r.players&&a!==(a=e.player+"")&&xt(n,a),(r.players||r.ctx)&&Pt(t,"current",e.player==e.ctx.currentPlayer),(r.players||r.playerID)&&Pt(t,"active",e.player==e.playerID)},d(e){e&&dt(t),o()}}}function Gn(e){var t;let n=e.players,r=[];for(let t=0;t<n.length;t+=1)r[t]=Nn(zn(e,n,t));return{c(){t=ft("div");for(let e=0;e<r.length;e+=1)r[e].c();bt(t,"class","player-box svelte-6sf87x")},m(e,n){ut(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.players||e.ctx||e.playerID){let a;for(n=o.players,a=0;a<n.length;a+=1){const i=zn(o,n,a);r[a]?r[a].p(e,i):(r[a]=Nn(i),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ue,o:Ue,d(e){e&&dt(t),pt(r,e)}}}function Bn(e,t,n){let{ctx:r,playerID:o}=t;const a=Ct();function i(e){a("change",e==o?{playerID:null}:{playerID:e})}let l;return e.$set=e=>{"ctx"in e&&n("ctx",r=e.ctx),"playerID"in e&&n("playerID",o=e.playerID)},e.$$.update=(e={ctx:1})=>{e.ctx&&n("players",l=r?[...Array(r.numPlayers).keys()].map(e=>e.toString()):[])},{ctx:r,playerID:o,OnClick:i,players:l,click_handler:({player:e})=>i(e)}}class qn extends ln{constructor(e){var t;super(),document.getElementById("svelte-6sf87x-style")||((t=ft("style")).id="svelte-6sf87x-style",t.textContent=".player-box.svelte-6sf87x{display:flex;flex-direction:row}.player.svelte-6sf87x{cursor:pointer;text-align:center;width:30px;height:30px;line-height:30px;background:#eee;border:3px solid #fefefe;box-sizing:content-box}.player.current.svelte-6sf87x{background:#555;color:#eee;font-weight:bold}.player.active.svelte-6sf87x{border:3px solid #ff7f50}",ct(document.head,t)),an(this,e,Bn,Gn,Xe,["ctx","playerID"])}}function Ln(e,t,n){const r=Object.create(e);return r.name=t[n][0],r.fn=t[n][1],r}function Tn(e){var t,n,r,o=new En({props:{shortcut:e.shortcuts[e.name],fn:e.fn,name:e.name}});return{c(){t=ft("li"),o.$$.fragment.c(),n=mt(),bt(t,"class","svelte-1vg2l2b")},m(e,a){ut(e,t,a),nn(o,t,null),ct(t,n),r=!0},p(e,t){var n={};e.client&&(n.shortcut=t.shortcuts[t.name]),e.client&&(n.fn=t.fn),e.client&&(n.name=t.name),o.$set(n)},i(e){r||(Qt(o.$$.fragment,e),r=!0)},o(e){Xt(o.$$.fragment,e),r=!1},d(e){e&&dt(t),rn(o)}}}function Rn(e){var t,n;return{c(){(t=ft("button")).textContent="End Turn",bt(t,"class","svelte-1vg2l2b"),n=yt(t,"click",e.click_handler)},m(e,n){ut(e,t,n)},d(e){e&&dt(t),n()}}}function Kn(e){var t,n;return{c(){(t=ft("button")).textContent="End Phase",bt(t,"class","svelte-1vg2l2b"),n=yt(t,"click",e.click_handler_1)},m(e,n){ut(e,t,n)},d(e){e&&dt(t),n()}}}function Fn(e){var t,n;return{c(){(t=ft("button")).textContent="End Stage",bt(t,"class","svelte-1vg2l2b"),n=yt(t,"click",e.click_handler_2)},m(e,n){ut(e,t,n)},d(e){e&&dt(t),n()}}}function Un(e){var t,n,r,o,a,i,l,s,c,u,d,p,f,v,h,m,g,y,b,x,$,w,P,O,k,_,I,E,D,j,A,S=JSON.stringify(e.G,null,2)+"",C=JSON.stringify(Vn(e.ctx),null,2)+"",M=new Mn({props:{client:e.client}}),z=new qn({props:{ctx:e.ctx,playerID:e.playerID}});z.$on("change",e.change_handler);let N=Object.entries(e.client.moves),G=[];for(let t=0;t<N.length;t+=1)G[t]=Tn(Ln(e,N,t));const B=e=>Xt(G[e],1,1,()=>{G[e]=null});var q=e.client.events.endTurn&&Rn(e),L=e.ctx.phase&&e.client.events.endPhase&&Kn(e),T=e.ctx.activePlayers&&e.client.events.endStage&&Fn(e);return{c(){t=ft("section"),(n=ft("h3")).textContent="Controls",r=mt(),M.$$.fragment.c(),o=mt(),a=ft("section"),(i=ft("h3")).textContent="Players",l=mt(),z.$$.fragment.c(),s=mt(),c=ft("section"),(u=ft("h3")).textContent="Moves",d=mt();for(let e=0;e<G.length;e+=1)G[e].c();p=mt(),f=ft("section"),(v=ft("h3")).textContent="Events",h=mt(),m=ft("div"),q&&q.c(),g=mt(),L&&L.c(),y=mt(),T&&T.c(),b=mt(),x=ft("section"),($=ft("label")).textContent="G",w=mt(),P=ft("pre"),O=ht(S),k=mt(),_=ft("section"),(I=ft("label")).textContent="ctx",E=mt(),D=ft("pre"),j=ht(C),bt(n,"class","svelte-1vg2l2b"),bt(i,"class","svelte-1vg2l2b"),bt(u,"class","svelte-1vg2l2b"),bt(v,"class","svelte-1vg2l2b"),bt(m,"class","events svelte-1vg2l2b"),bt($,"class","svelte-1vg2l2b"),bt(P,"class","json svelte-1vg2l2b"),bt(I,"class","svelte-1vg2l2b"),bt(D,"class","json svelte-1vg2l2b")},m(e,S){ut(e,t,S),ct(t,n),ct(t,r),nn(M,t,null),ut(e,o,S),ut(e,a,S),ct(a,i),ct(a,l),nn(z,a,null),ut(e,s,S),ut(e,c,S),ct(c,u),ct(c,d);for(let e=0;e<G.length;e+=1)G[e].m(c,null);ut(e,p,S),ut(e,f,S),ct(f,v),ct(f,h),ct(f,m),q&&q.m(m,null),ct(m,g),L&&L.m(m,null),ct(m,y),T&&T.m(m,null),ut(e,b,S),ut(e,x,S),ct(x,$),ct(x,w),ct(x,P),ct(P,O),ut(e,k,S),ut(e,_,S),ct(_,I),ct(_,E),ct(_,D),ct(D,j),A=!0},p(e,t){var n={};e.client&&(n.client=t.client),M.$set(n);var r={};if(e.ctx&&(r.ctx=t.ctx),e.playerID&&(r.playerID=t.playerID),z.$set(r),e.shortcuts||e.client){let n;for(N=Object.entries(t.client.moves),n=0;n<N.length;n+=1){const r=Ln(t,N,n);G[n]?(G[n].p(e,r),Qt(G[n],1)):(G[n]=Tn(r),G[n].c(),Qt(G[n],1),G[n].m(c,null))}for(Wt(),n=N.length;n<G.length;n+=1)B(n);Yt()}t.client.events.endTurn?q||((q=Rn(t)).c(),q.m(m,g)):q&&(q.d(1),q=null),t.ctx.phase&&t.client.events.endPhase?L||((L=Kn(t)).c(),L.m(m,y)):L&&(L.d(1),L=null),t.ctx.activePlayers&&t.client.events.endStage?T||((T=Fn(t)).c(),T.m(m,null)):T&&(T.d(1),T=null),A&&!e.G||S===(S=JSON.stringify(t.G,null,2)+"")||xt(O,S),A&&!e.ctx||C===(C=JSON.stringify(Vn(t.ctx),null,2)+"")||xt(j,C)},i(e){if(!A){Qt(M.$$.fragment,e),Qt(z.$$.fragment,e);for(let e=0;e<N.length;e+=1)Qt(G[e]);A=!0}},o(e){Xt(M.$$.fragment,e),Xt(z.$$.fragment,e),G=G.filter(Boolean);for(let e=0;e<G.length;e+=1)Xt(G[e]);A=!1},d(e){e&&dt(t),rn(M),e&&(dt(o),dt(a)),rn(z),e&&(dt(s),dt(c)),pt(G,e),e&&(dt(p),dt(f)),q&&q.d(),L&&L.d(),T&&T.d(),e&&(dt(b),dt(x),dt(k),dt(_))}}}function Vn(e){let t={};for(const n in e)n.startsWith("_")||(t[n]=e[n]);return t}function Jn(e,t,n){let{client:r}=t;const o=function(e,t,n){var r={},o={};for(var a in e)o[a]=a;for(var i in t)o[i]=i;for(var l={},s=0;s<n.length;s++){l[n[s]]=!0}var c=l,u=!0;for(var d in o){var p=d[0];if(c[p]){u=!1;break}c[p]=!0,r[d]=p}if(u)return r;c=l;var f=97;for(var v in r={},o){for(var h=String.fromCharCode(f);c[h];)f++,h=String.fromCharCode(f);c[h]=!0,r[v]=h}return r}(r.moves,r.events,"mlia");let a=r.playerID,i={},l={};r.subscribe(e=>{e&&(n("G",l=e.G),n("ctx",i=e.ctx)),n("playerID",a=r.playerID)});return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,shortcuts:o,playerID:a,ctx:i,G:l,change_handler:e=>r.updatePlayerID(e.detail.playerID),click_handler:()=>r.events.endTurn(),click_handler_1:()=>r.events.endPhase(),click_handler_2:()=>r.events.endStage()}}class Hn extends ln{constructor(e){var t;super(),document.getElementById("svelte-1vg2l2b-style")||((t=ft("style")).id="svelte-1vg2l2b-style",t.textContent=".json.svelte-1vg2l2b{font-family:monospace;color:#888}label.svelte-1vg2l2b{font-weight:bold;font-size:1.1em;display:inline}h3.svelte-1vg2l2b{text-transform:uppercase}li.svelte-1vg2l2b{list-style:none;margin:none;margin-bottom:5px}.events.svelte-1vg2l2b{display:flex;flex-direction:column}.events.svelte-1vg2l2b button.svelte-1vg2l2b{width:100px}.events.svelte-1vg2l2b button.svelte-1vg2l2b:not(:last-child){margin-bottom:10px}",ct(document.head,t)),an(this,e,Jn,Un,Xe,["client"])}}function Wn(e){var t,n,r,o,a,i,l=JSON.stringify(e.value)+"";return{c(){t=ft("div"),n=ft("strong"),r=ht(e.name),o=mt(),a=ft("div"),i=ht(l),bt(a,"class","svelte-13qih23"),bt(t,"class","item svelte-13qih23")},m(e,l){ut(e,t,l),ct(t,n),ct(n,r),ct(t,o),ct(t,a),ct(a,i)},p(e,t){e.name&&xt(r,t.name),e.value&&l!==(l=JSON.stringify(t.value)+"")&&xt(i,l)},i:Ue,o:Ue,d(e){e&&dt(t)}}}function Yn(e,t,n){let{name:r,value:o}=t;return e.$set=e=>{"name"in e&&n("name",r=e.name),"value"in e&&n("value",o=e.value)},{name:r,value:o}}class Qn extends ln{constructor(e){var t;super(),document.getElementById("svelte-13qih23-style")||((t=ft("style")).id="svelte-13qih23-style",t.textContent=".item.svelte-13qih23{padding:10px}.item.svelte-13qih23:not(:first-child){border-top:1px dashed #aaa}.item.svelte-13qih23 div.svelte-13qih23{float:right;text-align:right}",ct(document.head,t)),an(this,e,Yn,Wn,Xe,["name","value"])}}function Xn(e){var t,n,r,o=new Qn({props:{name:"isConnected",value:e.$client.isConnected}}),a=new Qn({props:{name:"isMultiplayer",value:e.$client.isMultiplayer}});return{c(){t=ft("span"),o.$$.fragment.c(),n=mt(),a.$$.fragment.c()},m(e,i){ut(e,t,i),nn(o,t,null),ct(t,n),nn(a,t,null),r=!0},p(e,t){var n={};e.$client&&(n.value=t.$client.isConnected),o.$set(n);var r={};e.$client&&(r.value=t.$client.isMultiplayer),a.$set(r)},i(e){r||(Qt(o.$$.fragment,e),Qt(a.$$.fragment,e),r=!0)},o(e){Xt(o.$$.fragment,e),Xt(a.$$.fragment,e),r=!1},d(e){e&&dt(t),rn(o),rn(a)}}}function Zn(e){var t,n,r,o,a,i=new Qn({props:{name:"gameID",value:e.client.gameID}}),l=new Qn({props:{name:"playerID",value:e.client.playerID}}),s=new Qn({props:{name:"isActive",value:e.$client.isActive}}),c=e.$client.isMultiplayer&&Xn(e);return{c(){t=ft("section"),i.$$.fragment.c(),n=mt(),l.$$.fragment.c(),r=mt(),s.$$.fragment.c(),o=mt(),c&&c.c(),bt(t,"class","gameinfo svelte-1yzq5o8")},m(e,u){ut(e,t,u),nn(i,t,null),ct(t,n),nn(l,t,null),ct(t,r),nn(s,t,null),ct(t,o),c&&c.m(t,null),a=!0},p(e,n){var r={};e.client&&(r.value=n.client.gameID),i.$set(r);var o={};e.client&&(o.value=n.client.playerID),l.$set(o);var a={};e.$client&&(a.value=n.$client.isActive),s.$set(a),n.$client.isMultiplayer?c?(c.p(e,n),Qt(c,1)):((c=Xn(n)).c(),Qt(c,1),c.m(t,null)):c&&(Wt(),Xt(c,1,1,()=>{c=null}),Yt())},i(e){a||(Qt(i.$$.fragment,e),Qt(l.$$.fragment,e),Qt(s.$$.fragment,e),Qt(c),a=!0)},o(e){Xt(i.$$.fragment,e),Xt(l.$$.fragment,e),Xt(s.$$.fragment,e),Xt(c),a=!1},d(e){e&&dt(t),rn(i),rn(l),rn(s),c&&c.d()}}}function er(e,t,n){let r,{client:o}=t;return Ze(e,o,e=>{r=e,n("$client",r)}),e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,$client:r}}class tr extends ln{constructor(e){var t;super(),document.getElementById("svelte-1yzq5o8-style")||((t=ft("style")).id="svelte-1yzq5o8-style",t.textContent=".gameinfo.svelte-1yzq5o8{padding:10px}",ct(document.head,t)),an(this,e,er,Zn,Xe,["client"])}}function nr(e){var t,n;return{c(){t=ft("div"),n=ht(e.turn),bt(t,"class","turn-marker svelte-6eza86"),bt(t,"style",e.style)},m(e,r){ut(e,t,r),ct(t,n)},p(e,t){e.turn&&xt(n,t.turn)},i:Ue,o:Ue,d(e){e&&dt(t)}}}function rr(e,t,n){let{turn:r,numEvents:o}=t;const a=`grid-row: span ${o}`;return e.$set=e=>{"turn"in e&&n("turn",r=e.turn),"numEvents"in e&&n("numEvents",o=e.numEvents)},{turn:r,numEvents:o,style:a}}class or extends ln{constructor(e){var t;super(),document.getElementById("svelte-6eza86-style")||((t=ft("style")).id="svelte-6eza86-style",t.textContent=".turn-marker.svelte-6eza86{display:flex;justify-content:center;align-items:center;grid-column:1;background:#555;color:#eee;text-align:center;font-weight:bold;border:1px solid #888}",ct(document.head,t)),an(this,e,rr,nr,Xe,["turn","numEvents"])}}function ar(e){var t,n,r=e.phase||"";return{c(){t=ft("div"),n=ht(r),bt(t,"class","phase-marker svelte-1t4xap"),bt(t,"style",e.style)},m(e,r){ut(e,t,r),ct(t,n)},p(e,t){e.phase&&r!==(r=t.phase||"")&&xt(n,r)},i:Ue,o:Ue,d(e){e&&dt(t)}}}function ir(e,t,n){let{phase:r,numEvents:o}=t;const a=`grid-row: span ${o}`;return e.$set=e=>{"phase"in e&&n("phase",r=e.phase),"numEvents"in e&&n("numEvents",o=e.numEvents)},{phase:r,numEvents:o,style:a}}class lr extends ln{constructor(e){var t;super(),document.getElementById("svelte-1t4xap-style")||((t=ft("style")).id="svelte-1t4xap-style",t.textContent=".phase-marker.svelte-1t4xap{grid-column:3;background:#555;border:1px solid #888;color:#eee;text-align:center;font-weight:bold;padding-top:10px;padding-bottom:10px;text-orientation:sideways;writing-mode:vertical-rl;line-height:30px;width:100%}",ct(document.head,t)),an(this,e,ir,ar,Xe,["phase","numEvents"])}}function sr(e){var t,n;return{c(){t=ft("div"),n=ht(e.custompayload)},m(e,r){ut(e,t,r),ct(t,n)},p:Ue,i:Ue,o:Ue,d(e){e&&dt(t)}}}function cr(e,t,n){let{payload:r}=t;const o=void 0!==r?JSON.stringify(r,null,4):"";return e.$set=e=>{"payload"in e&&n("payload",r=e.payload)},{payload:r,custompayload:o}}class ur extends ln{constructor(e){super(),an(this,e,cr,sr,Xe,["payload"])}}function dr(e){var t,n=new ur({props:{payload:e.payload}});return{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.payload&&(r.payload=t.payload),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Xt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function pr(e){var t,n,r=e.payloadComponent;function o(e){return{props:{payload:e.payload}}}if(r)var a=new r(o(e));return{c(){a&&a.$$.fragment.c(),t=gt()},m(e,r){a&&nn(a,e,r),ut(e,t,r),n=!0},p(e,n){var i={};if(e.payload&&(i.payload=n.payload),r!==(r=n.payloadComponent)){if(a){Wt();const e=a;Xt(e.$$.fragment,1,0,()=>{rn(e,1)}),Yt()}r?((a=new r(o(n))).$$.fragment.c(),Qt(a.$$.fragment,1),nn(a,t.parentNode,t)):a=null}else r&&a.$set(i)},i(e){n||(a&&Qt(a.$$.fragment,e),n=!0)},o(e){a&&Xt(a.$$.fragment,e),n=!1},d(e){e&&dt(t),a&&rn(a,e)}}}function fr(e){var t,n,r,o,a,i,l,s,c,u,d,p=e.action.payload.type+"",f=e.args.join(",")+"",v=[pr,dr],h=[];function m(e,t){return t.payloadComponent?0:1}return s=m(0,e),c=h[s]=v[s](e),{c(){t=ft("div"),n=ft("div"),r=ht(p),o=ht("("),a=ht(f),i=ht(")"),l=mt(),c.c(),bt(t,"class","log-event player"+e.playerID+" svelte-10wdo7v"),Pt(t,"pinned",e.pinned),d=[yt(t,"click",e.click_handler),yt(t,"mouseenter",e.mouseenter_handler),yt(t,"mouseleave",e.mouseleave_handler)]},m(e,c){ut(e,t,c),ct(t,n),ct(n,r),ct(n,o),ct(n,a),ct(n,i),ct(t,l),h[s].m(t,null),u=!0},p(e,n){u&&!e.action||p===(p=n.action.payload.type+"")||xt(r,p);var o=s;(s=m(0,n))===o?h[s].p(e,n):(Wt(),Xt(h[o],1,1,()=>{h[o]=null}),Yt(),(c=h[s])||(c=h[s]=v[s](n)).c(),Qt(c,1),c.m(t,null)),e.pinned&&Pt(t,"pinned",n.pinned)},i(e){u||(Qt(c),u=!0)},o(e){Xt(c),u=!1},d(e){e&&dt(t),h[s].d(),Ye(d)}}}function vr(e,t,n){let{logIndex:r,action:o,pinned:a,payload:i,payloadComponent:l}=t;const s=Ct(),c=o.payload.args||[],u=o.payload.playerID;return e.$set=e=>{"logIndex"in e&&n("logIndex",r=e.logIndex),"action"in e&&n("action",o=e.action),"pinned"in e&&n("pinned",a=e.pinned),"payload"in e&&n("payload",i=e.payload),"payloadComponent"in e&&n("payloadComponent",l=e.payloadComponent)},{logIndex:r,action:o,pinned:a,payload:i,payloadComponent:l,dispatch:s,args:c,playerID:u,click_handler:()=>s("click",{logIndex:r}),mouseenter_handler:()=>s("mouseenter",{logIndex:r}),mouseleave_handler:()=>s("mouseleave")}}class hr extends ln{constructor(e){var t;super(),document.getElementById("svelte-10wdo7v-style")||((t=ft("style")).id="svelte-10wdo7v-style",t.textContent=".log-event.svelte-10wdo7v{grid-column:2;cursor:pointer;overflow:hidden;display:flex;flex-direction:column;justify-content:center;background:#fff;border:1px dotted #ccc;border-left:5px solid #ccc;padding:5px;text-align:center;color:#888;font-size:14px;min-height:25px;line-height:25px}.log-event.svelte-10wdo7v:hover{border-style:solid;background:#eee}.log-event.pinned.svelte-10wdo7v{border-style:solid;background:#eee;opacity:1}.player0.svelte-10wdo7v{border-left-color:#ff851b}.player1.svelte-10wdo7v{border-left-color:#7fdbff}.player2.svelte-10wdo7v{border-left-color:#0074d9}.player3.svelte-10wdo7v{border-left-color:#39cccc}.player4.svelte-10wdo7v{border-left-color:#3d9970}.player5.svelte-10wdo7v{border-left-color:#2ecc40}.player6.svelte-10wdo7v{border-left-color:#01ff70}.player7.svelte-10wdo7v{border-left-color:#ffdc00}.player8.svelte-10wdo7v{border-left-color:#001f3f}.player9.svelte-10wdo7v{border-left-color:#ff4136}.player10.svelte-10wdo7v{border-left-color:#85144b}.player11.svelte-10wdo7v{border-left-color:#f012be}.player12.svelte-10wdo7v{border-left-color:#b10dc9}.player13.svelte-10wdo7v{border-left-color:#111111}.player14.svelte-10wdo7v{border-left-color:#aaaaaa}.player15.svelte-10wdo7v{border-left-color:#dddddd}",ct(document.head,t)),an(this,e,vr,fr,Xe,["logIndex","action","pinned","payload","payloadComponent"])}}function mr(e){var t,n;return{c(){t=vt("title"),n=ht(e.title)},m(e,r){ut(e,t,r),ct(t,n)},p(e,t){e.title&&xt(n,t.title)},d(e){e&&dt(t)}}}function gr(e){var t,n,r,o=e.title&&mr(e);const a=e.$$slots.default,i=function(e,t,n){if(e){const r=et(e,t,n);return e[0](r)}}(a,e,null);return{c(){t=vt("svg"),o&&o.c(),n=gt(),i&&i.c(),bt(t,"xmlns","http://www.w3.org/2000/svg"),bt(t,"viewBox",e.viewBox),bt(t,"class","svelte-c8tyih")},l(e){i&&i.l(svg_nodes)},m(e,a){ut(e,t,a),o&&o.m(t,null),ct(t,n),i&&i.m(t,null),r=!0},p(e,l){l.title?o?o.p(e,l):((o=mr(l)).c(),o.m(t,n)):o&&(o.d(1),o=null),i&&i.p&&e.$$scope&&i.p(function(e,t,n,r){return e[1]?Je({},Je(t.$$scope.changed||{},e[1](r?r(n):{}))):t.$$scope.changed||{}}(a,l,e,null),et(a,l,null)),r&&!e.viewBox||bt(t,"viewBox",l.viewBox)},i(e){r||(Qt(i,e),r=!0)},o(e){Xt(i,e),r=!1},d(e){e&&dt(t),o&&o.d(),i&&i.d(e)}}}function yr(e,t,n){let{title:r=null,viewBox:o}=t,{$$slots:a={},$$scope:i}=t;return e.$set=e=>{"title"in e&&n("title",r=e.title),"viewBox"in e&&n("viewBox",o=e.viewBox),"$$scope"in e&&n("$$scope",i=e.$$scope)},{title:r,viewBox:o,$$slots:a,$$scope:i}}class br extends ln{constructor(e){var t;super(),document.getElementById("svelte-c8tyih-style")||((t=ft("style")).id="svelte-c8tyih-style",t.textContent="svg.svelte-c8tyih{stroke:currentColor;fill:currentColor;stroke-width:0;width:100%;height:auto;max-height:100%}",ct(document.head,t)),an(this,e,yr,gr,Xe,["title","viewBox"])}}function xr(e){var t;return{c(){bt(t=vt("path"),"d","M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z")},m(e,n){ut(e,t,n)},d(e){e&&dt(t)}}}function $r(e){var t,n=[{viewBox:"0 0 512 512"},e.$$props];let r={$$slots:{default:[xr]},$$scope:{ctx:e}};for(var o=0;o<n.length;o+=1)r=Je(r,n[o]);var a=new br({props:r});return{c(){a.$$.fragment.c()},m(e,n){nn(a,e,n),t=!0},p(e,t){var r,o=e.$$props?function(e,t){const n={},r={},o={$$scope:1};let a=e.length;for(;a--;){const i=e[a],l=t[a];if(l){for(const e in i)e in l||(r[e]=1);for(const e in l)o[e]||(n[e]=l[e],o[e]=1);e[a]=l}else for(const e in i)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(n,[n[0],(r=t.$$props,"object"==typeof r&&null!==r?r:{})]):{};e.$$scope&&(o.$$scope={changed:e,ctx:t}),a.$set(o)},i(e){t||(Qt(a.$$.fragment,e),t=!0)},o(e){Xt(a.$$.fragment,e),t=!1},d(e){rn(a,e)}}}function wr(e,t,n){return e.$set=e=>{n("$$props",t=Je(Je({},t),e))},{$$props:t,$$props:t=tt(t)}}class Pr extends ln{constructor(e){super(),an(this,e,wr,$r,Xe,[])}}function Or(e){var t,n;return{c(){t=ft("div"),n=ht(e.text),bt(t,"alt",e.text),bt(t,"class","svelte-1a7time")},m(e,r){ut(e,t,r),ct(t,n)},p(e,r){e.text&&(xt(n,r.text),bt(t,"alt",r.text))},i:Ue,o:Ue,d(e){e&&dt(t)}}}function kr(e,t,n){let r,{action:o}=t;return e.$set=e=>{"action"in e&&n("action",o=e.action)},e.$$.update=(e={action:1})=>{if(e.action){const{type:e,args:t}=o.payload,a=(t||[]).join(",");n("text",r=`${e}(${a})`)}},{action:o,text:r}}class _r extends ln{constructor(e){var t;super(),document.getElementById("svelte-1a7time-style")||((t=ft("style")).id="svelte-1a7time-style",t.textContent="div.svelte-1a7time{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:500px}",ct(document.head,t)),an(this,e,kr,Or,Xe,["action"])}}function Ir(e,t,n){const r=Object.create(e);return r.child=t[n],r.i=n,r}function Er(e){var t,n,r,o,a,i,l,s,c,u,d,p=e.child.value+"",f=e.child.visits+"",v=new _r({props:{action:e.child.parentAction}});function h(){return e.click_handler(e)}function m(){return e.mouseout_handler(e)}function g(){return e.mouseover_handler(e)}return{c(){t=ft("tr"),n=ft("td"),r=ht(p),o=mt(),a=ft("td"),i=ht(f),l=mt(),s=ft("td"),v.$$.fragment.c(),c=mt(),bt(n,"class","svelte-ztcwsu"),bt(a,"class","svelte-ztcwsu"),bt(s,"class","svelte-ztcwsu"),bt(t,"class","svelte-ztcwsu"),Pt(t,"clickable",e.children.length>0),Pt(t,"selected",e.i===e.selectedIndex),d=[yt(t,"click",h),yt(t,"mouseout",m),yt(t,"mouseover",g)]},m(e,d){ut(e,t,d),ct(t,n),ct(n,r),ct(t,o),ct(t,a),ct(a,i),ct(t,l),ct(t,s),nn(v,s,null),ct(t,c),u=!0},p(n,o){e=o,u&&!n.children||p===(p=e.child.value+"")||xt(r,p),u&&!n.children||f===(f=e.child.visits+"")||xt(i,f);var a={};n.children&&(a.action=e.child.parentAction),v.$set(a),n.children&&Pt(t,"clickable",e.children.length>0),n.selectedIndex&&Pt(t,"selected",e.i===e.selectedIndex)},i(e){u||(Qt(v.$$.fragment,e),u=!0)},o(e){Xt(v.$$.fragment,e),u=!1},d(e){e&&dt(t),rn(v),Ye(d)}}}function Dr(e){var t,n,r,o,a;let i=e.children,l=[];for(let t=0;t<i.length;t+=1)l[t]=Er(Ir(e,i,t));const s=e=>Xt(l[e],1,1,()=>{l[e]=null});return{c(){t=ft("table"),(n=ft("thead")).innerHTML='<th class="svelte-ztcwsu">Value</th> <th class="svelte-ztcwsu">Visits</th> <th class="svelte-ztcwsu">Action</th>',r=mt(),o=ft("tbody");for(let e=0;e<l.length;e+=1)l[e].c();bt(t,"class","svelte-ztcwsu")},m(e,i){ut(e,t,i),ct(t,n),ct(t,r),ct(t,o);for(let e=0;e<l.length;e+=1)l[e].m(o,null);a=!0},p(e,t){if(e.children||e.selectedIndex){let n;for(i=t.children,n=0;n<i.length;n+=1){const r=Ir(t,i,n);l[n]?(l[n].p(e,r),Qt(l[n],1)):(l[n]=Er(r),l[n].c(),Qt(l[n],1),l[n].m(o,null))}for(Wt(),n=i.length;n<l.length;n+=1)s(n);Yt()}},i(e){if(!a){for(let e=0;e<i.length;e+=1)Qt(l[e]);a=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)Xt(l[e]);a=!1},d(e){e&&dt(t),pt(l,e)}}}function jr(e,t,n){let{root:r,selectedIndex:o=null}=t;const a=Ct();let i=[],l=[];function s(e,t){a("select",{node:e,selectedIndex:t})}function c(e,t){null===o&&a("preview",{node:e})}return e.$set=e=>{"root"in e&&n("root",r=e.root),"selectedIndex"in e&&n("selectedIndex",o=e.selectedIndex)},e.$$.update=(e={root:1,parents:1})=>{if(e.root||e.parents){let e=r;for(n("parents",i=[]);e.parent;){const t=e.parent,{type:n,args:r}=e.parentAction.payload,o=`${n}(${(r||[]).join(",")})`;i.push({parent:t,arrowText:o}),e=t}i.reverse(),n("children",l=[...r.children].sort((e,t)=>e.visits<t.visits?1:-1).slice(0,50))}},{root:r,selectedIndex:o,children:l,Select:s,Preview:c,click_handler:({child:e,i:t})=>s(e,t),mouseout_handler:({i:e})=>c(null),mouseover_handler:({child:e,i:t})=>c(e)}}class Ar extends ln{constructor(e){var t;super(),document.getElementById("svelte-ztcwsu-style")||((t=ft("style")).id="svelte-ztcwsu-style",t.textContent="table.svelte-ztcwsu{font-size:12px;border-collapse:collapse;border:1px solid #ddd;padding:0}tr.svelte-ztcwsu{cursor:pointer}tr.svelte-ztcwsu:hover td.svelte-ztcwsu{background:#eee}tr.selected.svelte-ztcwsu td.svelte-ztcwsu{background:#eee}td.svelte-ztcwsu{padding:10px;height:10px;line-height:10px;font-size:12px;border:none}th.svelte-ztcwsu{background:#888;color:#fff;padding:10px;text-align:center}",ct(document.head,t)),an(this,e,jr,Dr,Xe,["root","selectedIndex"])}}function Sr(e,t,n){const r=Object.create(e);return r.node=t[n].node,r.selectedIndex=t[n].selectedIndex,r.i=n,r}function Cr(e){var t;var n=new Ar({props:{root:e.node,selectedIndex:e.selectedIndex}});return n.$on("select",(function(...t){return e.select_handler_1(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),t.nodes&&(o.selectedIndex=e.selectedIndex),n.$set(o)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Xt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Mr(e){var t;var n=new Ar({props:{root:e.node}});return n.$on("select",(function(...t){return e.select_handler(e,...t)})),n.$on("preview",(function(...t){return e.preview_handler(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),n.$set(o)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Xt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function zr(e){var t,n,r,o,a,i=0!==e.i&&function(e){var t,n,r=new Pr({});return{c(){t=ft("div"),r.$$.fragment.c(),bt(t,"class","icon svelte-1f0amz4")},m(e,o){ut(e,t,o),nn(r,t,null),n=!0},i(e){n||(Qt(r.$$.fragment,e),n=!0)},o(e){Xt(r.$$.fragment,e),n=!1},d(e){e&&dt(t),rn(r)}}}(),l=[Mr,Cr],s=[];function c(e,t){return t.i===t.nodes.length-1?0:1}return r=c(0,e),o=s[r]=l[r](e),{c(){i&&i.c(),t=mt(),n=ft("section"),o.c()},m(e,o){i&&i.m(e,o),ut(e,t,o),ut(e,n,o),s[r].m(n,null),a=!0},p(e,t){var a=r;(r=c(0,t))===a?s[r].p(e,t):(Wt(),Xt(s[a],1,1,()=>{s[a]=null}),Yt(),(o=s[r])||(o=s[r]=l[r](t)).c(),Qt(o,1),o.m(n,null))},i(e){a||(Qt(i),Qt(o),a=!0)},o(e){Xt(i),Xt(o),a=!1},d(e){i&&i.d(e),e&&(dt(t),dt(n)),s[r].d()}}}function Nr(e){var t,n,r,o,a=new Pr({}),i=new Ar({props:{root:e.preview}});return{c(){t=ft("div"),a.$$.fragment.c(),n=mt(),r=ft("section"),i.$$.fragment.c(),bt(t,"class","icon svelte-1f0amz4"),bt(r,"class","preview svelte-1f0amz4")},m(e,l){ut(e,t,l),nn(a,t,null),ut(e,n,l),ut(e,r,l),nn(i,r,null),o=!0},p(e,t){var n={};e.preview&&(n.root=t.preview),i.$set(n)},i(e){o||(Qt(a.$$.fragment,e),Qt(i.$$.fragment,e),o=!0)},o(e){Xt(a.$$.fragment,e),Xt(i.$$.fragment,e),o=!1},d(e){e&&dt(t),rn(a),e&&(dt(n),dt(r)),rn(i)}}}function Gr(e){var t,n,r;let o=e.nodes,a=[];for(let t=0;t<o.length;t+=1)a[t]=zr(Sr(e,o,t));const i=e=>Xt(a[e],1,1,()=>{a[e]=null});var l=e.preview&&Nr(e);return{c(){t=ft("div");for(let e=0;e<a.length;e+=1)a[e].c();n=mt(),l&&l.c(),bt(t,"class","visualizer svelte-1f0amz4")},m(e,o){ut(e,t,o);for(let e=0;e<a.length;e+=1)a[e].m(t,null);ct(t,n),l&&l.m(t,null),r=!0},p(e,r){if(e.nodes){let l;for(o=r.nodes,l=0;l<o.length;l+=1){const i=Sr(r,o,l);a[l]?(a[l].p(e,i),Qt(a[l],1)):(a[l]=zr(i),a[l].c(),Qt(a[l],1),a[l].m(t,n))}for(Wt(),l=o.length;l<a.length;l+=1)i(l);Yt()}r.preview?l?(l.p(e,r),Qt(l,1)):((l=Nr(r)).c(),Qt(l,1),l.m(t,null)):l&&(Wt(),Xt(l,1,1,()=>{l=null}),Yt())},i(e){if(!r){for(let e=0;e<o.length;e+=1)Qt(a[e]);Qt(l),r=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)Xt(a[e]);Xt(l),r=!1},d(e){e&&dt(t),pt(a,e),l&&l.d()}}}function Br(e,t,n){let{metadata:r}=t,o=[],a=null;function i({node:e,selectedIndex:t},r){n("preview",a=null),n("nodes",o[r].selectedIndex=t,o),n("nodes",o=[...o.slice(0,r+1),{node:e}])}function l({node:e},t){n("preview",a=e)}return e.$set=e=>{"metadata"in e&&n("metadata",r=e.metadata)},e.$$.update=(e={metadata:1})=>{e.metadata&&n("nodes",o=[{node:r}])},{metadata:r,nodes:o,preview:a,SelectNode:i,PreviewNode:l,select_handler:({i:e},t)=>i(t.detail,e),preview_handler:({i:e},t)=>l(t.detail),select_handler_1:({i:e},t)=>i(t.detail,e)}}class qr extends ln{constructor(e){var t;super(),document.getElementById("svelte-1f0amz4-style")||((t=ft("style")).id="svelte-1f0amz4-style",t.textContent=".visualizer.svelte-1f0amz4{display:flex;flex-direction:column;align-items:center;padding:50px}.preview.svelte-1f0amz4{opacity:0.5}.icon.svelte-1f0amz4{color:#777;width:32px;height:32px;margin-bottom:20px}",ct(document.head,t)),an(this,e,Br,Gr,Xe,["metadata"])}}function Lr(e,t,n){const r=Object.create(e);return r.phase=t[n].phase,r.i=n,r}function Tr(e,t,n){const r=Object.create(e);return r.action=t[n].action,r.payload=t[n].payload,r.i=n,r}function Rr(e,t,n){const r=Object.create(e);return r.turn=t[n].turn,r.i=n,r}function Kr(e){var t,n=new or({props:{turn:e.turn,numEvents:e.turnBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.turn=t.turn),e.turnBoundaries&&(r.numEvents=t.turnBoundaries[t.i]),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Xt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Fr(e){var t,n,r=e.i in e.turnBoundaries&&Kr(e);return{c(){r&&r.c(),t=gt()},m(e,o){r&&r.m(e,o),ut(e,t,o),n=!0},p(e,n){n.i in n.turnBoundaries?r?(r.p(e,n),Qt(r,1)):((r=Kr(n)).c(),Qt(r,1),r.m(t.parentNode,t)):r&&(Wt(),Xt(r,1,1,()=>{r=null}),Yt())},i(e){n||(Qt(r),n=!0)},o(e){Xt(r),n=!1},d(e){r&&r.d(e),e&&dt(t)}}}function Ur(e){var t,n=new hr({props:{pinned:e.i===e.pinned,logIndex:e.i,action:e.action,payload:e.payload}});return n.$on("click",e.OnLogClick),n.$on("mouseenter",e.OnMouseEnter),n.$on("mouseleave",e.OnMouseLeave),{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.pinned&&(r.pinned=t.i===t.pinned),e.renderedLogEntries&&(r.action=t.action),e.renderedLogEntries&&(r.payload=t.payload),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Xt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Vr(e){var t,n=new lr({props:{phase:e.phase,numEvents:e.phaseBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.phase=t.phase),e.phaseBoundaries&&(r.numEvents=t.phaseBoundaries[t.i]),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Xt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Jr(e){var t,n,r=e.i in e.phaseBoundaries&&Vr(e);return{c(){r&&r.c(),t=gt()},m(e,o){r&&r.m(e,o),ut(e,t,o),n=!0},p(e,n){n.i in n.phaseBoundaries?r?(r.p(e,n),Qt(r,1)):((r=Vr(n)).c(),Qt(r,1),r.m(t.parentNode,t)):r&&(Wt(),Xt(r,1,1,()=>{r=null}),Yt())},i(e){n||(Qt(r),n=!0)},o(e){Xt(r),n=!1},d(e){r&&r.d(e),e&&dt(t)}}}function Hr(e){var t,n,r,o,a;let i=e.renderedLogEntries,l=[];for(let t=0;t<i.length;t+=1)l[t]=Fr(Rr(e,i,t));const s=e=>Xt(l[e],1,1,()=>{l[e]=null});let c=e.renderedLogEntries,u=[];for(let t=0;t<c.length;t+=1)u[t]=Ur(Tr(e,c,t));const d=e=>Xt(u[e],1,1,()=>{u[e]=null});let p=e.renderedLogEntries,f=[];for(let t=0;t<p.length;t+=1)f[t]=Jr(Lr(e,p,t));const v=e=>Xt(f[e],1,1,()=>{f[e]=null});return{c(){t=ft("div");for(let e=0;e<l.length;e+=1)l[e].c();n=mt();for(let e=0;e<u.length;e+=1)u[e].c();r=mt();for(let e=0;e<f.length;e+=1)f[e].c();bt(t,"class","gamelog svelte-1pq5e4b"),Pt(t,"pinned",e.pinned),a=yt(window,"keydown",e.OnKeyDown)},m(e,a){ut(e,t,a);for(let e=0;e<l.length;e+=1)l[e].m(t,null);ct(t,n);for(let e=0;e<u.length;e+=1)u[e].m(t,null);ct(t,r);for(let e=0;e<f.length;e+=1)f[e].m(t,null);o=!0},p(e,o){if(e.turnBoundaries||e.renderedLogEntries){let r;for(i=o.renderedLogEntries,r=0;r<i.length;r+=1){const a=Rr(o,i,r);l[r]?(l[r].p(e,a),Qt(l[r],1)):(l[r]=Fr(a),l[r].c(),Qt(l[r],1),l[r].m(t,n))}for(Wt(),r=i.length;r<l.length;r+=1)s(r);Yt()}if(e.pinned||e.renderedLogEntries){let n;for(c=o.renderedLogEntries,n=0;n<c.length;n+=1){const a=Tr(o,c,n);u[n]?(u[n].p(e,a),Qt(u[n],1)):(u[n]=Ur(a),u[n].c(),Qt(u[n],1),u[n].m(t,r))}for(Wt(),n=c.length;n<u.length;n+=1)d(n);Yt()}if(e.phaseBoundaries||e.renderedLogEntries){let n;for(p=o.renderedLogEntries,n=0;n<p.length;n+=1){const r=Lr(o,p,n);f[n]?(f[n].p(e,r),Qt(f[n],1)):(f[n]=Jr(r),f[n].c(),Qt(f[n],1),f[n].m(t,null))}for(Wt(),n=p.length;n<f.length;n+=1)v(n);Yt()}e.pinned&&Pt(t,"pinned",o.pinned)},i(e){if(!o){for(let e=0;e<i.length;e+=1)Qt(l[e]);for(let e=0;e<c.length;e+=1)Qt(u[e]);for(let e=0;e<p.length;e+=1)Qt(f[e]);o=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)Xt(l[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)Xt(u[e]);f=f.filter(Boolean);for(let e=0;e<f.length;e+=1)Xt(f[e]);o=!1},d(e){e&&dt(t),pt(l,e),pt(u,e),pt(f,e),a()}}}function Wr(e,t,n){let r,{client:o}=t;Ze(e,o,e=>{r=e,n("$client",r)});const{secondaryPane:a}=zt("secondaryPane"),i=o.getInitialState();let l,{log:s}=r,c=null;function u(e){let t=i;for(let n=0;n<s.length;n++){const{action:r,automatic:a}=s[n];if(a||(t=o.reducer(t,r)),"MAKE_MOVE"==r.type){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}function d(){n("pinned",c=null),o.overrideGameState(null),a.set(null)}St(d);let p={},f={};return e.$set=e=>{"client"in e&&n("client",o=e.client)},e.$$.update=(e={$client:1,log:1,renderedLogEntries:1})=>{if(e.$client||e.log||e.renderedLogEntries){n("log",s=r.log),n("renderedLogEntries",l=s.filter(e=>"MAKE_MOVE"==e.action.type));let e=0,t=0;n("turnBoundaries",p={}),n("phaseBoundaries",f={});for(let r=0;r<l.length;r++){const{action:o,payload:a,turn:i,phase:s}=l[r];t++,e++,r!=l.length-1&&l[r+1].turn==i||(n("turnBoundaries",p[r]=t,p),t=0),r!=l.length-1&&l[r+1].phase==s||(n("phaseBoundaries",f[r]=e,f),e=0)}}},{client:o,pinned:c,OnLogClick:function(e){const{logIndex:t}=e.detail,r=u(t),i=s.filter(e=>"MAKE_MOVE"==e.action.type);if(o.overrideGameState(r),c==t)n("pinned",c=null),a.set(null);else{n("pinned",c=t);const{metadata:e}=i[t].action.payload;e&&a.set({component:qr,metadata:e})}},OnMouseEnter:function(e){const{logIndex:t}=e.detail;if(null===c){const e=u(t);o.overrideGameState(e)}},OnMouseLeave:function(){null===c&&o.overrideGameState(null)},OnKeyDown:function(e){27==e.keyCode&&d()},renderedLogEntries:l,turnBoundaries:p,phaseBoundaries:f}}class Yr extends ln{constructor(e){var t;super(),document.getElementById("svelte-1pq5e4b-style")||((t=ft("style")).id="svelte-1pq5e4b-style",t.textContent=".gamelog.svelte-1pq5e4b{display:grid;grid-template-columns:30px 1fr 30px;grid-auto-rows:auto;grid-auto-flow:column}",ct(document.head,t)),an(this,e,Wr,Hr,Xe,["client"])}}const{Object:Qr}=tn;function Xr(e,t,n){const r=Qr.create(e);return r.key=t[n][0],r.value=t[n][1],r}function Zr(e){var t,n,r,o,a,i,l,s=e.values[e.key]+"";function c(){e.input_change_input_handler.call(o,e)}return{c(){t=ft("span"),n=ht(s),r=mt(),o=ft("input"),bt(t,"class","value svelte-7cel4i"),bt(o,"type","range"),bt(o,"min",a=e.value.range.min),bt(o,"max",i=e.value.range.max),l=[yt(o,"change",c),yt(o,"input",c),yt(o,"change",e.OnChange)]},m(a,i){ut(a,t,i),ct(t,n),ut(a,r,i),ut(a,o,i),$t(o,e.values[e.key])},p(t,r){e=r,(t.values||t.bot)&&s!==(s=e.values[e.key]+"")&&xt(n,s),(t.values||t.Object||t.bot)&&$t(o,e.values[e.key]),t.bot&&a!==(a=e.value.range.min)&&bt(o,"min",a),t.bot&&i!==(i=e.value.range.max)&&bt(o,"max",i)},d(e){e&&(dt(t),dt(r),dt(o)),Ye(l)}}}function eo(e){var t,n;function r(){e.input_change_handler.call(t,e)}return{c(){bt(t=ft("input"),"type","checkbox"),bt(t,"class","svelte-7cel4i"),n=[yt(t,"change",r),yt(t,"change",e.OnChange)]},m(n,r){ut(n,t,r),t.checked=e.values[e.key]},p(n,r){e=r,(n.values||n.Object||n.bot)&&(t.checked=e.values[e.key])},d(e){e&&dt(t),Ye(n)}}}function to(e){var t,n,r,o,a,i,l=e.key+"",s=e.value.range&&Zr(e),c="boolean"==typeof e.value.value&&eo(e);return{c(){t=ft("div"),n=ft("label"),r=ht(l),o=mt(),s&&s.c(),a=mt(),c&&c.c(),i=mt(),bt(n,"class","svelte-7cel4i"),bt(t,"class","option svelte-7cel4i")},m(e,l){ut(e,t,l),ct(t,n),ct(n,r),ct(t,o),s&&s.m(t,null),ct(t,a),c&&c.m(t,null),ct(t,i)},p(e,n){e.bot&&l!==(l=n.key+"")&&xt(r,l),n.value.range?s?s.p(e,n):((s=Zr(n)).c(),s.m(t,a)):s&&(s.d(1),s=null),"boolean"==typeof n.value.value?c?c.p(e,n):((c=eo(n)).c(),c.m(t,i)):c&&(c.d(1),c=null)},d(e){e&&dt(t),s&&s.d(),c&&c.d()}}}function no(e){var t;let n=e.Object.entries(e.bot.opts()),r=[];for(let t=0;t<n.length;t+=1)r[t]=to(Xr(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=gt()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);ut(e,t,n)},p(e,o){if(e.Object||e.bot||e.values){let a;for(n=o.Object.entries(o.bot.opts()),a=0;a<n.length;a+=1){const i=Xr(o,n,a);r[a]?r[a].p(e,i):(r[a]=to(i),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ue,o:Ue,d(e){pt(r,e),e&&dt(t)}}}function ro(e,t,n){let{bot:r}=t,o={};for(let[e,t]of Object.entries(r.opts()))n("values",o[e]=t.value,o);return e.$set=e=>{"bot"in e&&n("bot",r=e.bot)},{bot:r,values:o,OnChange:function(){for(let[e,t]of Object.entries(o))r.setOpt(e,t)},Object:Object,input_change_input_handler:function({key:e}){o[e]=function(e){return""===e?void 0:+e}(this.value),n("values",o),n("Object",Object),n("bot",r)},input_change_handler:function({key:e}){o[e]=this.checked,n("values",o),n("Object",Object),n("bot",r)}}}class oo extends ln{constructor(e){var t;super(),document.getElementById("svelte-7cel4i-style")||((t=ft("style")).id="svelte-7cel4i-style",t.textContent="label.svelte-7cel4i{font-weight:bold;color:#999}.option.svelte-7cel4i{margin-bottom:20px}.value.svelte-7cel4i{font-weight:bold}input[type='checkbox'].svelte-7cel4i{vertical-align:middle}",ct(document.head,t)),an(this,e,ro,no,Xe,["bot"])}}var ao=function(){function e(t){var r=this,o=t.enumerate,i=t.seed;n(this,e),a(this,"enumerate",(function(e,t,n){return r.enumerateFn(e,t,n).map((function(e){return void 0!==e.payload?e:void 0!==e.move?P(e.move,e.args,n):void 0!==e.event?O(e.event,e.args,n):void 0}))})),this.enumerateFn=o,this.seed=i,this.iterationCounter=0,this._opts={}}return o(e,[{key:"addOpt",value:function(e){var t=e.key,n=e.range,r=e.initial;this._opts[t]={range:n,value:r}}},{key:"getOpt",value:function(e){return this._opts[e].value}},{key:"setOpt",value:function(e,t){e in this._opts&&(this._opts[e].value=t)}},{key:"opts",value:function(){return this._opts}},{key:"random",value:function(e){var t;if(void 0!==this.seed){var n=null;t=(n=this.prngstate?new Ie("",{state:this.prngstate}):new Ie(this.seed,{state:!0}))(),this.prngstate=n.state()}else t=Math.random();return e?e.length?e[Math.floor(t*e.length)]:Math.floor(t*e):t}}]),e}(),io=function(e){function r(e){var t,o=e.enumerate,a=e.seed,i=e.objectives,l=e.game,s=e.iterations,u=e.playoutDepth,p=e.iterationCallback;return n(this,r),void 0===i&&(i=function(){return{}}),(t=d(this,c(r).call(this,{enumerate:o,seed:a}))).objectives=i,t.iterationCallback=p||function(){},t.reducer=Pe({game:l}),t.iterations=s,t.playoutDepth=u,t.addOpt({key:"async",initial:!1}),t.addOpt({key:"iterations",initial:"number"==typeof s?s:1e3,range:{min:1,max:2e3}}),t.addOpt({key:"playoutDepth",initial:"number"==typeof u?u:50,range:{min:1,max:100}}),t}return s(r,e),o(r,[{key:"createNode",value:function(e){var t=e.state,n=e.parentAction,r=e.parent,o=e.playerID,a=t.G,i=t.ctx,l=[],s=[];if(void 0!==o)l=this.enumerate(a,i,o),s=this.objectives(a,i,o);else if(i.activePlayers)for(var c in i.activePlayers)l=l.concat(this.enumerate(a,i,c)),s=s.concat(this.objectives(a,i,c));else l=l.concat(this.enumerate(a,i,i.currentPlayer)),s=s.concat(this.objectives(a,i,i.currentPlayer));return{state:t,parent:r,parentAction:n,actions:l,objectives:s,children:[],visits:0,value:0}}},{key:"select",value:function(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;var t=null,n=0,r=!0,o=!1,a=void 0;try{for(var i,l=e.children[Symbol.iterator]();!(r=(i=l.next()).done);r=!0){var s=i.value,c=s.visits+Number.EPSILON,u=s.value/c+Math.sqrt(2*Math.log(e.visits)/c);(null==t||u>n)&&(n=u,t=s)}}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return this.select(t)}},{key:"expand",value:function(e){var t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;var n=this.random(t.length),r=t[n];e.actions.splice(n,1);var o=this.reducer(e.state,r),a=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(a),a}},{key:"playout",value:function(e){var n=this,r=e.state,o=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(o=this.playoutDepth(r.G,r.ctx));for(var a=function(e){var t=r,o=t.G,a=t.ctx,i=a.currentPlayer;a.activePlayers&&(i=Object.keys(a.activePlayers)[0]);var l=n.enumerate(o,a,i),s=n.objectives(o,a),c=Object.keys(s).reduce((function(e,t){var n=s[t];return n.checker(o,a)?e+n.weight:e}),0);if(c>0)return{v:{score:c}};if(!l||0==l.length)return{v:void 0};var u=n.random(l.length),d=n.reducer(r,l[u]);r=d},i=0;i<o&&void 0===r.ctx.gameover;i++){var l=a();if("object"===t(l))return l.v}return r.ctx.gameover}},{key:"backpropagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}},{key:"play",value:function(e,t){var n=this,r=this.createNode({state:e,playerID:t}),o=this.getOpt("iterations");"function"==typeof this.iterations&&(o=this.iterations(e.G,e.ctx));var a=function(){var e=null,t=!0,n=!1,o=void 0;try{for(var a,i=r.children[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var l=a.value;(null==e||l.visits>e.visits)&&(e=l)}}catch(e){n=!0,o=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw o}}return{action:e&&e.parentAction,metadata:r}};return new Promise((function(e){var t=function(){for(var e=0;e<25&&n.iterationCounter<o;e++){var t=n.select(r),a=n.expand(t),i=n.playout(a);n.backpropagate(a,i),n.iterationCounter++}n.iterationCallback({iterationCounter:n.iterationCounter,numIterations:o,metadata:r})};if(n.iterationCounter=0,n.getOpt("async")){!function r(){n.iterationCounter<o?(t(),setTimeout(r,0)):e(a())}()}else{for(;n.iterationCounter<o;)t();e(a())}}))}}]),r}(ao),lo=function(e){function t(){return n(this,t),d(this,c(t).apply(this,arguments))}return s(t,e),o(t,[{key:"play",value:function(e,t){var n=e.G,r=e.ctx,o=this.enumerate(n,r,t);return Promise.resolve({action:this.random(o)})}}]),t}(ao);async function so(e,t){var n=e.store.getState(),r=n.ctx.currentPlayer;n.ctx.activePlayers&&(r=Object.keys(n.ctx.activePlayers)[0]);var o=await t.play(n,r),a=o.action,i=o.metadata;return a&&(a.payload.metadata=i,e.store.dispatch(a)),a}function co(e,t,n){const r=Object.create(e);return r.bot=t[n],r}function uo(e){var t,n,r;return{c(){(t=ft("p")).textContent="No bots available.",n=mt(),(r=ft("p")).innerHTML='\n\t\t\t        Follow the instructions\n\t\t\t        <a href="https://boardgame.io/documentation/#/tutorial?id=bots" target="_blank">\n\t\t\t          here</a>\n\t\t\t        to set up bots.\n\t\t\t      '},m(e,o){ut(e,t,o),ut(e,n,o),ut(e,r,o)},p:Ue,i:Ue,o:Ue,d(e){e&&(dt(t),dt(n),dt(r))}}}function po(e){var t;return{c(){(t=ft("p")).textContent="The bot debugger is only available in singleplayer mode."},m(e,n){ut(e,t,n)},p:Ue,i:Ue,o:Ue,d(e){e&&dt(t)}}}function fo(e){var t,n,r,o,a,i,l,s,c,u,d,p,f,v,h,m,g,y,b=Object.keys(e.bot.opts()).length,x=new xn({props:{value:"1",onPress:e.Reset,label:"reset"}}),$=new xn({props:{value:"2",onPress:e.Step,label:"play"}}),w=new xn({props:{value:"3",onPress:e.Simulate,label:"simulate"}});let P=Object.keys(e.bots),O=[];for(let t=0;t<P.length;t+=1)O[t]=vo(co(e,P,t));var k=b&&ho(e),_=(e.botAction||e.iterationCounter)&&mo(e);return{c(){t=ft("section"),(n=ft("h3")).textContent="Controls",r=mt(),o=ft("li"),x.$$.fragment.c(),a=mt(),i=ft("li"),$.$$.fragment.c(),l=mt(),s=ft("li"),w.$$.fragment.c(),c=mt(),u=ft("section"),(d=ft("h3")).textContent="Bot",p=mt(),f=ft("select");for(let e=0;e<O.length;e+=1)O[e].c();v=mt(),k&&k.c(),h=mt(),_&&_.c(),m=gt(),bt(n,"class","svelte-hsd9fq"),bt(o,"class","svelte-hsd9fq"),bt(i,"class","svelte-hsd9fq"),bt(s,"class","svelte-hsd9fq"),bt(d,"class","svelte-hsd9fq"),void 0===e.selectedBot&&Kt(()=>e.select_change_handler.call(f)),y=[yt(f,"change",e.select_change_handler),yt(f,"change",e.ChangeBot)]},m(y,b){ut(y,t,b),ct(t,n),ct(t,r),ct(t,o),nn(x,o,null),ct(t,a),ct(t,i),nn($,i,null),ct(t,l),ct(t,s),nn(w,s,null),ut(y,c,b),ut(y,u,b),ct(u,d),ct(u,p),ct(u,f);for(let e=0;e<O.length;e+=1)O[e].m(f,null);wt(f,e.selectedBot),ut(y,v,b),k&&k.m(y,b),ut(y,h,b),_&&_.m(y,b),ut(y,m,b),g=!0},p(e,t){if(e.bots){let n;for(P=Object.keys(t.bots),n=0;n<P.length;n+=1){const r=co(t,P,n);O[n]?O[n].p(e,r):(O[n]=vo(r),O[n].c(),O[n].m(f,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=P.length}e.selectedBot&&wt(f,t.selectedBot),e.bot&&(b=Object.keys(t.bot.opts()).length),b?k?(k.p(e,t),Qt(k,1)):((k=ho(t)).c(),Qt(k,1),k.m(h.parentNode,h)):k&&(Wt(),Xt(k,1,1,()=>{k=null}),Yt()),t.botAction||t.iterationCounter?_?_.p(e,t):((_=mo(t)).c(),_.m(m.parentNode,m)):_&&(_.d(1),_=null)},i(e){g||(Qt(x.$$.fragment,e),Qt($.$$.fragment,e),Qt(w.$$.fragment,e),Qt(k),g=!0)},o(e){Xt(x.$$.fragment,e),Xt($.$$.fragment,e),Xt(w.$$.fragment,e),Xt(k),g=!1},d(e){e&&dt(t),rn(x),rn($),rn(w),e&&(dt(c),dt(u)),pt(O,e),e&&dt(v),k&&k.d(e),e&&dt(h),_&&_.d(e),e&&dt(m),Ye(y)}}}function vo(e){var t,n,r=e.bot+"";return{c(){t=ft("option"),n=ht(r),t.__value=e.bot,t.value=t.__value},m(e,r){ut(e,t,r),ct(t,n)},p:Ue,d(e){e&&dt(t)}}}function ho(e){var t,n,r,o,a,i,l,s,c,u=new oo({props:{bot:e.bot}});return{c(){t=ft("section"),(n=ft("h3")).textContent="Options",r=mt(),(o=ft("label")).textContent="debug",a=mt(),i=ft("input"),l=mt(),u.$$.fragment.c(),bt(n,"class","svelte-hsd9fq"),bt(o,"class","svelte-hsd9fq"),bt(i,"type","checkbox"),bt(i,"class","svelte-hsd9fq"),c=[yt(i,"change",e.input_change_handler),yt(i,"change",e.OnDebug)]},m(c,d){ut(c,t,d),ct(t,n),ct(t,r),ct(t,o),ct(t,a),ct(t,i),i.checked=e.debug,ct(t,l),nn(u,t,null),s=!0},p(e,t){e.debug&&(i.checked=t.debug);var n={};e.bot&&(n.bot=t.bot),u.$set(n)},i(e){s||(Qt(u.$$.fragment,e),s=!0)},o(e){Xt(u.$$.fragment,e),s=!1},d(e){e&&dt(t),rn(u),Ye(c)}}}function mo(e){var t,n,r,o,a=e.progress&&e.progress<1&&go(e),i=e.botAction&&yo(e);return{c(){t=ft("section"),(n=ft("h3")).textContent="Result",r=mt(),a&&a.c(),o=mt(),i&&i.c(),bt(n,"class","svelte-hsd9fq")},m(e,l){ut(e,t,l),ct(t,n),ct(t,r),a&&a.m(t,null),ct(t,o),i&&i.m(t,null)},p(e,n){n.progress&&n.progress<1?a?a.p(e,n):((a=go(n)).c(),a.m(t,o)):a&&(a.d(1),a=null),n.botAction?i?i.p(e,n):((i=yo(n)).c(),i.m(t,null)):i&&(i.d(1),i=null)},d(e){e&&dt(t),a&&a.d(),i&&i.d()}}}function go(e){var t;return{c(){(t=ft("progress")).value=e.progress},m(e,n){ut(e,t,n)},p(e,n){e.progress&&(t.value=n.progress)},d(e){e&&dt(t)}}}function yo(e){var t,n,r,o,a,i,l,s=JSON.stringify(e.botActionArgs)+"";return{c(){t=ft("li"),n=ht("Action: "),r=ht(e.botAction),o=mt(),a=ft("li"),i=ht("Args: "),l=ht(s),bt(t,"class","svelte-hsd9fq"),bt(a,"class","svelte-hsd9fq")},m(e,s){ut(e,t,s),ct(t,n),ct(t,r),ut(e,o,s),ut(e,a,s),ct(a,i),ct(a,l)},p(e,t){e.botAction&&xt(r,t.botAction),e.botActionArgs&&s!==(s=JSON.stringify(t.botActionArgs)+"")&&xt(l,s)},d(e){e&&(dt(t),dt(o),dt(a))}}}function bo(e){var t,n,r,o,a,i=[fo,po,uo],l=[];function s(e,t){return t.client.game.ai&&!t.client.multiplayer?0:t.client.multiplayer?1:2}return n=s(0,e),r=l[n]=i[n](e),{c(){t=ft("section"),r.c(),a=yt(window,"keydown",e.OnKeyDown)},m(e,r){ut(e,t,r),l[n].m(t,null),o=!0},p(e,o){var a=n;(n=s(0,o))===a?l[n].p(e,o):(Wt(),Xt(l[a],1,1,()=>{l[a]=null}),Yt(),(r=l[n])||(r=l[n]=i[n](o)).c(),Qt(r,1),r.m(t,null))},i(e){o||(Qt(r),o=!0)},o(e){Xt(r),o=!1},d(e){e&&dt(t),l[n].d(),a()}}}function xo(e,t,n){let{client:r}=t;const{secondaryPane:o}=zt("secondaryPane"),a={MCTS:io,Random:lo};let i=!1,l=null,s=0,c=null;const u=({iterationCounter:e,numIterations:t,metadata:r})=>{n("iterationCounter",s=e),n("progress",l=e/t),c=r,i&&c&&o.set({component:qr,metadata:c})};let d,p,f,v;function h(){r.overrideGameState(null),o.set(null),n("debug",i=!1)}return r.game.ai&&(n("bot",d=new io({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),d.setOpt("async",!0)),St(h),e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,bots:a,debug:i,progress:l,iterationCounter:s,OnDebug:function(){i&&c?o.set({component:qr,metadata:c}):o.set(null)},bot:d,selectedBot:p,botAction:f,botActionArgs:v,ChangeBot:function(){n("bot",d=new(0,a[p])({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),d.setOpt("async",!0),n("botAction",f=null),c=null,o.set(null),n("iterationCounter",s=0)},Step:async function(){n("botAction",f=null),c=null,n("iterationCounter",s=0);const e=await so(r,d);e&&(n("botAction",f=e.payload.type),n("botActionArgs",v=e.payload.args))},Simulate:function(e=1e4,t=100){return n("botAction",f=null),c=null,n("iterationCounter",s=0),(async()=>{for(let n=0;n<e;n++){if(!await so(r,d))break;await new Promise(e=>setTimeout(e,t))}})()},Reset:function(){r.reset(),n("botAction",f=null),c=null,n("iterationCounter",s=0),h()},OnKeyDown:function(e){27==e.keyCode&&h()},select_change_handler:function(){p=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n("selectedBot",p),n("bots",a)},input_change_handler:function(){i=this.checked,n("debug",i)}}}class $o extends ln{constructor(e){var t;super(),document.getElementById("svelte-hsd9fq-style")||((t=ft("style")).id="svelte-hsd9fq-style",t.textContent="li.svelte-hsd9fq{list-style:none;margin:none;margin-bottom:5px}h3.svelte-hsd9fq{text-transform:uppercase}label.svelte-hsd9fq{font-weight:bold;color:#999}input[type='checkbox'].svelte-hsd9fq{vertical-align:middle}",ct(document.head,t)),an(this,e,xo,bo,Xe,["client"])}}function wo(e){var t,n,r,o,a,i,l=new mn({props:{panes:e.panes,pane:e.pane}});l.$on("change",e.MenuChange);var s=e.panes[e.pane].component;function c(e){return{props:{client:e.client}}}if(s)var u=new s(c(e));var d=e.$secondaryPane&&Po(e);return{c(){t=ft("div"),l.$$.fragment.c(),n=mt(),r=ft("div"),u&&u.$$.fragment.c(),o=mt(),d&&d.c(),bt(r,"class","pane svelte-1h5kecx"),bt(t,"class","debug-panel svelte-1h5kecx")},m(e,a){ut(e,t,a),nn(l,t,null),ct(t,n),ct(t,r),u&&nn(u,r,null),ct(t,o),d&&d.m(t,null),i=!0},p(e,n){var o={};e.pane&&(o.pane=n.pane),l.$set(o);var a={};if(e.client&&(a.client=n.client),s!==(s=n.panes[n.pane].component)){if(u){Wt();const e=u;Xt(e.$$.fragment,1,0,()=>{rn(e,1)}),Yt()}s?((u=new s(c(n))).$$.fragment.c(),Qt(u.$$.fragment,1),nn(u,r,null)):u=null}else s&&u.$set(a);n.$secondaryPane?d?(d.p(e,n),Qt(d,1)):((d=Po(n)).c(),Qt(d,1),d.m(t,null)):d&&(Wt(),Xt(d,1,1,()=>{d=null}),Yt())},i(e){i||(Qt(l.$$.fragment,e),u&&Qt(u.$$.fragment,e),Qt(d),Kt(()=>{a||(a=en(t,dn,{x:400},!0)),a.run(1)}),i=!0)},o(e){Xt(l.$$.fragment,e),u&&Xt(u.$$.fragment,e),Xt(d),a||(a=en(t,dn,{x:400},!1)),a.run(0),i=!1},d(e){e&&dt(t),rn(l),u&&rn(u),d&&d.d(),e&&a&&a.end()}}}function Po(e){var t,n,r=e.$secondaryPane.component;function o(e){return{props:{metadata:e.$secondaryPane.metadata}}}if(r)var a=new r(o(e));return{c(){t=ft("div"),a&&a.$$.fragment.c(),bt(t,"class","secondary-pane svelte-1h5kecx")},m(e,r){ut(e,t,r),a&&nn(a,t,null),n=!0},p(e,n){var i={};if(e.$secondaryPane&&(i.metadata=n.$secondaryPane.metadata),r!==(r=n.$secondaryPane.component)){if(a){Wt();const e=a;Xt(e.$$.fragment,1,0,()=>{rn(e,1)}),Yt()}r?((a=new r(o(n))).$$.fragment.c(),Qt(a.$$.fragment,1),nn(a,t,null)):a=null}else r&&a.$set(i)},i(e){n||(a&&Qt(a.$$.fragment,e),n=!0)},o(e){a&&Xt(a.$$.fragment,e),n=!1},d(e){e&&dt(t),a&&rn(a)}}}function Oo(e){var t,n,r,o=e.visible&&wo(e);return{c(){o&&o.c(),t=gt(),r=yt(window,"keypress",e.Keypress)},m(e,r){o&&o.m(e,r),ut(e,t,r),n=!0},p(e,n){n.visible?o?(o.p(e,n),Qt(o,1)):((o=wo(n)).c(),Qt(o,1),o.m(t.parentNode,t)):o&&(Wt(),Xt(o,1,1,()=>{o=null}),Yt())},i(e){n||(Qt(o),n=!0)},o(e){Xt(o),n=!1},d(e){o&&o.d(e),e&&dt(t),r()}}}function ko(e,t,n){let r,{client:o}=t;const a={main:{label:"Main",shortcut:"m",component:Hn},log:{label:"Log",shortcut:"l",component:Yr},info:{label:"Info",shortcut:"i",component:tr},ai:{label:"AI",shortcut:"a",component:$o}},i=cn(!1),l=cn(null);Ze(e,l,e=>{r=e,n("$secondaryPane",r)}),Mt("hotkeys",{disableHotkeys:i}),Mt("secondaryPane",{secondaryPane:l});let s="main";let c=!0;return e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,panes:a,secondaryPane:l,pane:s,MenuChange:function(e){n("pane",s=e.detail)},visible:c,Keypress:function(e){"."!=e.key?c&&Object.entries(a).forEach(([t,{shortcut:r}])=>{e.key==r&&n("pane",s=t)}):n("visible",c=!c)},$secondaryPane:r}}class _o extends ln{constructor(e){var t;super(),document.getElementById("svelte-1h5kecx-style")||((t=ft("style")).id="svelte-1h5kecx-style",t.textContent=".debug-panel.svelte-1h5kecx{position:fixed;color:#555;font-family:monospace;display:flex;flex-direction:row;text-align:left;right:0;top:0;height:100%;font-size:14px;box-sizing:border-box;opacity:0.9}.pane.svelte-1h5kecx{flex-grow:2;overflow-x:hidden;overflow-y:scroll;background:#fefefe;padding:20px;border-left:1px solid #ccc;box-shadow:-1px 0 5px rgba(0, 0, 0, 0.2);box-sizing:border-box;width:280px}.secondary-pane.svelte-1h5kecx{background:#fefefe;overflow-y:scroll}.debug-panel.svelte-1h5kecx button, select{cursor:pointer;outline:none;background:#eee;border:1px solid #bbb;color:#555;padding:3px;border-radius:3px}.debug-panel.svelte-1h5kecx button{padding-left:10px;padding-right:10px}.debug-panel.svelte-1h5kecx button:hover{background:#ddd}.debug-panel.svelte-1h5kecx button:active{background:#888;color:#fff}.debug-panel.svelte-1h5kecx section{margin-bottom:20px}",ct(document.head,t)),an(this,e,ko,Oo,Xe,["client"])}}function Io({game:e,numPlayers:t,setupData:n}){t||(t=2);let r={G:{},ctx:(e=Fe(e)).flow.ctx(t),plugins:{}};r=((e,t)=>([...je,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(n=>{const r=n.name,o=n.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[r]:{data:o}}}}),e))(r,{game:e}),r=Me(r,{game:e,playerID:void 0});const o=Se(r);r.G=e.setup(o,n);let a={...r,_undo:[],_redo:[],_stateID:0};return a=e.flow.init(a),a=ze(a,{game:e}),a}function Eo(e,t,n,r,o,a){return t.reduce((function(t,i){return t[i]=function(){var t=r;if(!a&&null==r){var l=n.getState();t=l.ctx.currentPlayer}for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];n.dispatch(C[e](i,c,t,o))},t}),{})}var Do=Eo.bind(null,"makeMove"),jo=Eo.bind(null,"gameEvent"),Ao=Eo.bind(null,"plugin"),So=function(){function e(t){var r=this,o=t.game,a=t.debug,i=t.numPlayers,l=t.multiplayer,s=t.gameID,c=t.playerID,u=t.credentials,d=t.enhancer;n(this,e),this.game=Fe(o),this.playerID=c,this.gameID=s,this.credentials=u,this.multiplayer=l,this.debug=a,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=Pe({game:this.game,isClient:void 0!==l,numPlayers:i}),this.initialState=null,l||(this.initialState=Io({game:this.game,numPlayers:i})),this.reset=function(){r.store.dispatch(I(r.initialState))},this.undo=function(){r.store.dispatch(E(c,u))},this.redo=function(){r.store.dispatch(D(c,u))},this.store=null,this.log=[];var f=function(e){return function(t){return function(n){var o=t(n),a=e.getState();switch(n.type){case"MAKE_MOVE":case"GAME_EVENT":var i=a.deltalog;r.log=[].concat(p(r.log),p(i));break;case"RESET":r.log=[];break;case"UPDATE":var l=-1;r.log.length>0&&(l=r.log[r.log.length-1]._stateID);var s=n.deltalog||[];s=s.filter((function(e){return e._stateID>l})),r.log=[].concat(p(r.log),p(s));break;case"SYNC":r.initialState=n.initialState,r.log=n.log||[]}return o}}},v=function(e){return function(t){return function(n){var o=e.getState(),a=t(n);return 1!=n.clientOnly&&r.transport.onAction(o,n),a}}},h=function(){return function(e){return function(t){var n=e(t);return r.notifySubscribers(),n}}};d=void 0!==d?$(w(h,v,f),d):w(h,v,f),this.store=g(this.reducer,this.initialState,d),this.transport={isConnected:!0,onAction:function(){},subscribe:function(){},subscribeGameMetadata:function(e){},connect:function(){},disconnect:function(){},updateGameID:function(){},updatePlayerID:function(){}},l&&(this.transport=l({gameKey:o,game:this.game,store:this.store,gameID:s,playerID:c,gameName:this.game.name,numPlayers:i})),this.createDispatchers(),this.transport.subscribeGameMetadata((function(e){r.gameMetadata=e})),this._debugPanel=null}return o(e,[{key:"notifySubscribers",value:function(){var e=this;Object.values(this.subscribers).forEach((function(t){return t(e.getState())}))}},{key:"overrideGameState",value:function(e){this.gameStateOverride=e,this.notifySubscribers()}},{key:"start",value:function(){this.transport.connect(),this._running=!0;var e=null;if(e=_o,this.debug&&this.debug.impl&&(e=this.debug.impl),null!==e&&!1!==this.debug&&null==this._debugPanel&&"undefined"!=typeof document){var t=document.body;this.debug&&void 0!==this.debug.target&&(t=this.debug.target),t&&(this._debugPanel=new e({target:t,props:{client:this}}))}}},{key:"stop",value:function(){this.transport.disconnect(),this._running=!1,null!=this._debugPanel&&(this._debugPanel.$destroy(),this._debugPanel=null)}},{key:"subscribe",value:function(e){var t=this,n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribe((function(){return t.notifySubscribers()})),!this._running&&this.multiplayer||e(this.getState()),function(){delete t.subscribers[n]}}},{key:"getInitialState",value:function(){return this.initialState}},{key:"getState",value:function(){var e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;var t=!0,n=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);var r=l({},e,{isActive:t,G:this.game.playerView(e.G,e.ctx,this.playerID),log:this.log});return r=l({},r,{isConnected:this.transport.isConnected})}},{key:"createDispatchers",value:function(){this.moves=Do(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=jo(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=Ao(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}},{key:"updatePlayerID",value:function(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}},{key:"updateGameID",value:function(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e),this.notifySubscribers()}},{key:"updateCredentials",value:function(e){this.credentials=e,this.createDispatchers(),this.notifySubscribers()}}]),e}();e.Client=function(e){return new So(e)},Object.defineProperty(e,"__esModule",{value:!0})}));
