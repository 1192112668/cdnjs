!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).BoardgameIO={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(n,!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),u=function(){return Math.random().toString(36).substring(7).split("").join(".")},d={INIT:"@@redux/INIT"+u(),REPLACE:"@@redux/REPLACE"+u(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+u()}};function p(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function f(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(f)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,a=t,i=[],l=i,s=!1;function u(){l===i&&(l=i.slice())}function v(){if(s)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return a}function h(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(s)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return u(),l.push(e),function(){if(t){if(s)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,u();var n=l.indexOf(e);l.splice(n,1)}}}function m(e){if(!p(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(s)throw new Error("Reducers may not dispatch actions.");try{s=!0,a=o(a,e)}finally{s=!1}for(var t=i=l,n=0;n<t.length;n++){(0,t[n])()}return e}function g(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,m({type:d.REPLACE})}function y(){var e,t=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(v())}return n(),{unsubscribe:t(n)}}})[c]=function(){return this},e}return m({type:d.INIT}),(r={dispatch:m,subscribe:h,getState:v,replaceReducer:g})[c]=y,r}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function y(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return m({},n,{dispatch:r=g.apply(void 0,a)(n.dispatch)})}}}const b=(e,t,n,r)=>({type:"MAKE_MOVE",payload:{type:e,args:t,playerID:n,credentials:r}}),x=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r}}),$=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}),w=e=>({type:"SYNC",state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),P=e=>({type:"RESET",state:e,clientOnly:!0}),O=(e,t)=>({type:"UNDO",payload:{type:null,args:null,playerID:e,credentials:t}}),k=(e,t)=>({type:"REDO",payload:{type:null,args:null,playerID:e,credentials:t}});var I,_,E,D=Object.freeze({makeMove:b,gameEvent:x,automaticGameEvent:$,sync:w,update:(e,t)=>({type:"UPDATE",state:e,deltalog:t,clientOnly:!0}),reset:P,undo:O,redo:k,plugin:(e,t,n,r)=>({type:"PLUGIN",payload:{type:e,args:t,playerID:n,credentials:r}})}),j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),S="undefined"!=typeof Symbol?Symbol("immer-nothing"):(E=!0,(_="immer-nothing")in(I={})?Object.defineProperty(I,_,{value:E,enumerable:!0,configurable:!0,writable:!0}):I[_]=E,I),C="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",M="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function z(e){return!!e&&!!e[M]}function N(e){if(!e||"object"!==(void 0===e?"undefined":j(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[C]||!!e.constructor[C])}var B=Object.assign||function(e,t){for(var n in t)R(t,n)&&(e[n]=t[n]);return e},G="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function q(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return G(e).forEach((function(r){if(r!==M){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}})),n}function L(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else G(e).forEach((function(n){return t(n,e[n],e)}))}function T(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function K(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var F={},U=[],V=function(){return U[U.length-1]};function J(e,t){var n=Array.isArray(e),r=X(e);L(r,(function(t){!function(e,t,n){var r=F[t];r?r.enumerable=n:F[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){Z(e);var n=W(e)[t];if(!e.finalizing&&n===e.base[t]&&N(n))return Q(e),e.copy[t]=J(n,e);return n}(this[M],t)},set:function(e){!function(e,t,n){if(Z(e),e.assigned[t]=!0,!e.modified){if(K(W(e)[t],n))return;Y(e),Q(e)}e.copy[t]=n}(this[M],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||T(e,t))}));var o={scope:t?t.scope:V(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:H,revoked:!1};return function(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0})}(r,M,o),o.scope.push(o),r}function H(){this.revoked=!0}function W(e){return e.copy||e.base}function Y(e){e.modified||(e.modified=!0,e.parent&&Y(e.parent))}function Q(e){e.copy||(e.copy=X(e.base))}function X(e){var t=e&&e[M];if(t){t.finalizing=!0;var n=q(t.draft,!0);return t.finalizing=!1,n}return q(e)}function Z(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(W(e)))}function ee(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!R(t,r[o]))return!0;return r.length!==Object.keys(t).length}function te(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var ne=Object.freeze({scopes:U,currentScope:V,willFinalize:function(e,t,n){var r=V();r.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(n&&function e(t){if(!t||"object"!==(void 0===t?"undefined":j(t)))return;var n=t[M];if(!n)return;var r=n.base,o=n.draft,a=n.assigned;if(Array.isArray(t)){if(te(n)){if(Y(n),a.length=!0,o.length<r.length)for(var i=o.length;i<r.length;i++)a[i]=!1;else for(var l=r.length;l<o.length;l++)a[l]=!0;for(var s=0;s<o.length;s++)void 0===a[s]&&e(o[s])}}else Object.keys(o).forEach((function(t){void 0!==r[t]||R(r,t)?a[t]||e(o[t]):(a[t]=!0,Y(n))})),Object.keys(r).forEach((function(e){void 0!==o[e]||R(o,e)||(a[e]=!1,Y(n))}))}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?te(n)&&Y(n):ee(n)&&Y(n))}}(r))},createDraft:J}),re=[],oe=function(){return re[re.length-1]};function ae(e,t){var n={scope:t?t.scope:oe(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],le):Proxy.revocable(n,ie),o=r.revoke,a=r.proxy;return n.draft=a,n.revoke=o,n.scope.push(n),a}var ie={get:function(e,t){if(t===M)return e;var n=e.drafts;if(!e.modified&&R(n,t))return n[t];var r=se(e)[t];if(e.finalized||!N(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=ae(r,e)},has:function(e,t){return t in se(e)},ownKeys:function(e){return Reflect.ownKeys(se(e))},set:function(e,t,n){if(!e.modified){if(n?K(e.base[t],n)||n===e.drafts[t]:K(e.base[t],n)&&t in e.base)return!0;ce(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,ce(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=se(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},le={};function se(e){return e.copy||e.base}function ce(e){e.modified||(e.modified=!0,e.copy=B(q(e.base),e.drafts),e.drafts=null,e.parent&&ce(e.parent))}L(ie,(function(e,t){le[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),le.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return ie.deleteProperty.call(this,e[0],t)},le.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return ie.set.call(this,e[0],t,n)};var ue=Object.freeze({scopes:re,currentScope:oe,willFinalize:function(){},createDraft:ae});function de(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,a=e.copy,i=e.assigned,l=Math.min(o.length,a.length),s=0;s<l;s++)if(i[s]&&o[s]!==a[s]){var c=t.concat(s);n.push({op:"replace",path:c,value:a[s]}),r.push({op:"replace",path:c,value:o[s]})}if(l<a.length){for(var u=l;u<a.length;u++)n.push({op:"add",path:t.concat(u),value:a[u]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(l<o.length){n.push({op:"replace",path:t.concat("length"),value:a.length});for(var d=l;d<o.length;d++)r.push({op:"add",path:t.concat(d),value:o[d]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,a=e.copy;L(e.assigned,(function(e,i){var l=o[e],s=a[e],c=i?e in o?"replace":"add":"remove";if(l!==s||"replace"!==c){var u=t.concat(e);n.push("remove"===c?{op:c,path:u}:{op:c,path:u,value:s}),r.push("add"===c?{op:"remove",path:u}:"remove"===c?{op:"add",path:u,value:l}:{op:"replace",path:u,value:l})}}))}(e,t,n,r)}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var a=e,i=0;i<o.length-1;i++)if(!(a=a[o[i]])||"object"!==(void 0===a?"undefined":j(a)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var l=o[o.length-1];switch(r.op){case"replace":case"add":a[l]=r.value;break;case"remove":if(Array.isArray(a)){if(l!==a.length-1)throw new Error("Only the last index of an array can be removed, index: "+l+", length: "+a.length);a.length-=1}else delete a[l];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var fe={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},ve=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,fe,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return A(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(i,(function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var a=void 0;if(N(e)){this.scopes.push([]);var i=this.createDraft(e);try{a=t.call(i,i),this.willFinalize(a,i,!!n);var l=n&&[],s=n&&[];if(void 0===a||a===i)a=this.finalize(i,[],l,s);else{if(i[M].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");N(a)&&(a=this.finalize(a)),n&&(l.push({op:"replace",path:[],value:a}),s.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}n&&n(l,s)}else if(void 0===(a=t(e)))return e;return a===S?void 0:a}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,B(this,e?ue:ne)}},{key:"applyPatches",value:function(e,t){return z(e)?pe(e,t):this.produce(e,(function(e){return pe(e,t)}))}},{key:"finalize",value:function(e,t,n,r){var o=this,a=e[M];if(!a)return Object.isFrozen(e)?e:this.finalizeTree(e);if(a.scope!==this.currentScope())return e;if(!a.modified)return a.base;if(!a.finalized){if(a.finalized=!0,this.finalizeTree(a.draft,t,n,r),this.onDelete)if(this.useProxies){var i=a.assigned;for(var l in i)i[l]||this.onDelete(a,l)}else{var s=a.base,c=a.copy;L(s,(function(e){R(c,e)||o.onDelete(a,e)}))}this.onCopy&&this.onCopy(a),this.autoFreeze&&1===this.scopes.length&&Object.freeze(a.copy),n&&de(a,t,n,r)}return a.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,a=e[M];a&&(this.useProxies||(a.finalizing=!0,a.copy=q(a.draft,!0),a.finalizing=!1),e=a.copy);var i=this.onAssign;return L(e,(function l(s,c,u){if(c===u)throw Error("Immer forbids circular references");var d=!!a&&u===e;if(z(c)){if(c=n&&d&&!a.assigned[s]?o.finalize(c,t.concat(s),n,r):o.finalize(c),Array.isArray(u)||T(u,s)?u[s]=c:Object.defineProperty(u,s,{value:c}),d&&c===a.base[s])return}else{if(d&&K(c,a.base[s]))return;N(c)&&!Object.isFrozen(c)&&L(c,l)}d&&i&&i(a,s,c)})),e}}]),e}()),he=ve.produce;ve.setAutoFreeze.bind(ve),ve.setUseProxies.bind(ve),ve.applyPatches.bind(ve);const me={name:"plugin-immer",fnWrap:e=>(t,n,...r)=>{let o=!1;const a=he(t,t=>{const a=e(t,n,...r);if("INVALID_MOVE"!==a)return a;o=!0});return o?"INVALID_MOVE":a}};function ge(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function ye(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function be(e,n){var r=new ge(e),o=n&&n.state,a=r.next;return a.quick=a,o&&("object"==t(o)&&ye(o,r),a.state=function(){return ye(r,{})}),a}var xe=function(){function e(t){n(this,e),this.state=t,this.used=!1}return o(e,[{key:"isUsed",value:function(){return this.used}},{key:"getState",value:function(){return this.state}},{key:"_random",value:function(){this.used=!0;var e,t=this.state,n=(e=void 0===t.prngstate?new be(t.seed,{state:!0}):new be("",{state:t.prngstate}))();return this.state=l({},t,{prngstate:e.state()}),n}},{key:"api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:s(new Array(t).keys()).map((function(){return Math.floor(e()*o)+1}))}};for(var o in t)r(o);return l({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:s(new Array(n).keys()).map((function(){return Math.floor(e()*t)+1}))},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,a=new Array(r);r;){var i=r*e()|0;a[o++]=n[i],n[i]=n[--r]}return a},_obj:this})}}]),e}();xe.seed=function(){return(+new Date).toString(36).slice(-10)};class $e{constructor(e,t){this.flow=e,this.playerID=t,this.dispatch=[]}api(e){const t={_obj:this},{phase:n,turn:r}=e;for(const e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({key:e,args:t,phase:n,turn:r})};return t}isUsed(){return this.dispatch.length>0}update(e){for(let t=0;t<this.dispatch.length;t++){const n=this.dispatch[t];if("endTurn"===n.key&&n.turn!==e.ctx.turn)continue;if(("endPhase"===n.key||"setPhase"===n.key)&&n.phase!==e.ctx.phase)continue;const r=$(n.key,n.args,this.playerID);e={...e,...this.flow.processEvent(e,r)}}return e}}const we=[me,{name:"random",noClient:({api:e})=>e._obj.isUsed(),flush:({api:e})=>e._obj.getState(),api:({data:e})=>new xe(e).api(),setup:({game:e})=>{let t=e.seed;return void 0===t&&(t=xe.seed()),{seed:t}}},{name:"events",noClient:({api:e})=>e._obj.isUsed(),dangerouslyFlushRawState:({state:e,api:t})=>t._obj.update(e),api:({game:e,playerID:t,ctx:n})=>new $e(e.flow,t).api(n)}],Pe=e=>{let t={...e.ctx};const n=e.plugins||{};return Object.entries(n).forEach(([e,{api:n}])=>{t[e]=n}),t},Oe=(e,t)=>[...we,...t].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:t})=>t(e),e),ke=(e,t)=>([...we,...t.game.plugins].filter(e=>void 0!==e.api).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},a=n.api({G:e.G,ctx:e.ctx,data:o.data,game:t.game,playerID:t.playerID});e={...e,plugins:{...e.plugins,[r]:{...o,api:a}}}}),e),Ie=(e,t)=>([...we,...t.game.plugins].reverse().forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}};if(n.flush){const r=n.flush({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data});e={...e,plugins:{...e.plugins,[n.name]:{data:r}}}}else if(n.dangerouslyFlushRawState){const a=(e=n.dangerouslyFlushRawState({state:e,game:t.game,api:o.api,data:o.data})).plugins[r].data;e={...e,plugins:{...e.plugins,[n.name]:{data:a}}}}}),e),_e=console.log,Ee=console.error;function De(e){Ee("ERROR:",e)}function je(e,t,n){return{...e,ctx:Ae(e.ctx,n)}}function Ae(e,t){let{_prevActivePlayers:n}=e,r={},o=null,a={};if(Array.isArray(t)){let e={};t.forEach(t=>e[t]=ze.NULL),r=e}else{if(t.next&&(o=t.next),n=t.revert?n.concat({activePlayers:e.activePlayers,_activePlayersMoveLimit:e._activePlayersMoveLimit,_activePlayersNumMoves:e._activePlayersNumMoves}):[],void 0!==t.currentPlayer&&Se(r,a,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(let n=0;n<e.playOrder.length;n++){const o=e.playOrder[n];o!==e.currentPlayer&&Se(r,a,o,t.others)}if(void 0!==t.all)for(let n=0;n<e.playOrder.length;n++){Se(r,a,e.playOrder[n],t.all)}if(t.value)for(const e in t.value)Se(r,a,e,t.value[e]);if(t.moveLimit)for(const e in r)void 0===a[e]&&(a[e]=t.moveLimit)}0==Object.keys(r).length&&(r=null),0==Object.keys(a).length&&(a=null);let i={};for(const e in r)i[e]=0;return{...e,activePlayers:r,_activePlayersMoveLimit:a,_activePlayersNumMoves:i,_prevActivePlayers:n,_nextActivePlayers:o}}function Se(e,t,n,r){"object"==typeof r&&r!==ze.NULL||(r={stage:r}),void 0!==r.stage&&(e[n]=r.stage,r.moveLimit&&(t[n]=r.moveLimit))}function Ce(e,t){return e[t]+""}const Me={first:(e,t)=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},ze={NULL:null};function Ne({moves:e,phases:t,endIf:n,onEnd:r,turn:o,events:a,plugins:i}){void 0===e&&(e={}),void 0===a&&(a={}),void 0===i&&(i=[]),void 0===t&&(t={}),n||(n=()=>{}),r||(r=e=>e),o||(o={});const l={...t};""in l&&De("cannot specify phase with empty name"),l[""]={};let s={},c=new Set,u=null;Object.keys(e).forEach(e=>c.add(e));const d=e=>{const t=Oe(e,i);return e=>{const n=Pe(e);return t(e.G,n)}},p=e=>t=>{let n=Pe(t);return e(t.G,n)},f={onEnd:d(r),endIf:p(n)};for(let e in l){const t=l[e];if(!0===t.start&&(u=e),void 0!==t.moves)for(let n of Object.keys(t.moves))s[e+"."+n]=t.moves[n],c.add(n);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=e=>e),void 0===t.onEnd&&(t.onEnd=e=>e),void 0===t.turn&&(t.turn=o),void 0===t.turn.order&&(t.turn.order=Me),void 0===t.turn.onBegin&&(t.turn.onBegin=e=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=e=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=e=>e),void 0===t.turn.stages&&(t.turn.stages={});for(const n in t.turn.stages){const r=t.turn.stages[n].moves||{};for(let t of Object.keys(r)){s[e+"."+n+"."+t]=r[t],c.add(t)}}t.wrapped={onBegin:d(t.onBegin),onEnd:d(t.onEnd),endIf:p(t.endIf)},t.turn.wrapped={onMove:d(t.turn.onMove),onBegin:d(t.turn.onBegin),onEnd:d(t.turn.onEnd),endIf:p(t.turn.endIf)}}function v(e){return e.phase?l[e.phase]:l[""]}function h(e){return e}function m(e,t){const n=new Set,r=new Set;for(let o=0;o<t.length;o++){const{fn:a,arg:i,...l}=t[o];if(a===E){r.clear();const t=e.ctx.phase;if(n.has(t)){const t={...e.ctx,phase:null};return{...e,ctx:t}}n.add(t)}let s=[];if(e=a(e,{...l,arg:i,next:s}),a===_)break;const c=O(e);if(c){t.push({fn:_,arg:c,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}const u=k(e);if(u)t.push({fn:E,arg:u,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});else{if(a===h){const n=I(e);if(n){t.push({fn:D,arg:n,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...s)}}return e}function g(e,{next:t}){return t.push({fn:y}),e}function y(e,{next:t}){let{G:n,ctx:r}=e;return n=v(r).wrapped.onBegin(e),t.push({fn:b}),{...e,G:n,ctx:r}}function b(e,{currentPlayer:t}){let{G:n,ctx:r}=e;const o=v(r);t?(r={...r,currentPlayer:t},o.turn.activePlayers&&(r=Ae(r,o.turn.activePlayers))):r=function(e,t){let{G:n,ctx:r}=e;const o=Pe(e),a=t.order;let i=[...new Array(r.numPlayers)].map((e,t)=>t+"");void 0!==a.playOrder&&(i=a.playOrder(n,o));const l=a.first(n,o),s=typeof l;"number"!==s&&De(`invalid value returned by turn.order.first — expected number got ${s} “${l}”.`);const c=Ce(i,l);return r={...r,currentPlayer:c,playOrderPos:l,playOrder:i},r=Ae(r,t.activePlayers||{}),r}(e,o.turn);const a=r.turn+1;r={...r,turn:a,numMoves:0,_prevActivePlayers:[]},n=o.turn.wrapped.onBegin({...e,G:n,ctx:r});const i=[{G:n,ctx:r}];return{...e,G:n,ctx:r,_undo:i,_redo:[]}}function $(e,{arg:t,next:n,phase:r}){const o=v({phase:r});let{ctx:a}=e;if(t&&t.next){if(!(t.next in l))return De("invalid phase: "+t.next),e;a={...a,phase:t.next}}else a=void 0!==o.next?{...a,phase:o.next}:{...a,phase:null};return e={...e,ctx:a},n.push({fn:y}),e}function w(e,{arg:t,currentPlayer:n,next:r}){let{G:o,ctx:a}=e;const i=v(a),{endPhase:l,ctx:s}=function(e,t,n,r){const o=n.order;let{G:a,ctx:i}=e,l=i.playOrderPos,s=!1;if(r&&!0!==r)"object"!=typeof r&&De(`invalid argument to endTurn: ${r}`),Object.keys(r).forEach(e=>{switch(e){case"remove":t=Ce(i.playOrder,l);break;case"next":l=i.playOrder.indexOf(r.next),t=r.next;break;default:De(`invalid argument to endTurn: ${e}`)}});else{const n=Pe(e),r=o.next(a,n),c=typeof r;void 0!==r&&"number"!==c&&De(`invalid value returned by turn.order.next — expected number or undefined got ${c} “${r}”.`),void 0===r?s=!0:(l=r,t=Ce(i.playOrder,l))}return i={...i,playOrderPos:l,currentPlayer:t},{endPhase:s,ctx:i}}(e,n,i.turn,t);return a=s,e={...e,G:o,ctx:a},l?r.push({fn:E,turn:a.turn,phase:a.phase}):r.push({fn:b,currentPlayer:a.currentPlayer}),e}function P(e,{arg:t,playerID:n}){"string"==typeof t&&(t={stage:t});let{ctx:r}=e,{activePlayers:o,_activePlayersMoveLimit:a,_activePlayersNumMoves:i}=r;return t.stage&&(null===o&&(o={}),o[n]=t.stage,i[n]=0,t.moveLimit&&(null===a&&(a={}),a[n]=t.moveLimit)),r={...r,activePlayers:o,_activePlayersMoveLimit:a,_activePlayersNumMoves:i},{...e,ctx:r}}function O(e){return f.endIf(e)}function k(e){return v(e.ctx).wrapped.endIf(e)}function I(e){const t=v(e.ctx),n=e.ctx.numMoves||0;return!!(t.turn.moveLimit&&n>=t.turn.moveLimit)||t.turn.wrapped.endIf(e)}function _(e,{arg:t,phase:n}){e=E(e,{phase:n}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};const r=f.onEnd(e);return{...e,G:r}}function E(e,{arg:t,next:n,turn:r,automatic:o}){let a=(e=D(e,{turn:r,force:!0})).G,i=e.ctx;if(n&&n.push({fn:$,arg:t,phase:i.phase}),null===i.phase)return e;a=v(i).wrapped.onEnd(e),i={...i,phase:null};const l={action:x("endPhase",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};o&&(l.automatic=!0);const s=[...e.deltalog,l];return{...e,G:a,ctx:i,deltalog:s}}function D(e,{arg:t,next:n,turn:r,force:o,automatic:a,playerID:i}){if(r!==e.ctx.turn)return e;let{G:l,ctx:s}=e;const c=v(s),u=s.numMoves||0;if(!o&&c.turn.moveLimit&&u<c.turn.moveLimit)return d=`cannot end turn before making ${c.turn.moveLimit} moves`,_e(`INFO: ${d}`),e;var d;if(l=c.turn.wrapped.onEnd(e),n&&n.push({fn:w,arg:t,currentPlayer:s.currentPlayer}),s={...s,activePlayers:null},t&&t.remove){i=i||s.currentPlayer;const t=s.playOrder.filter(e=>e!=i),r=s.playOrderPos>t.length-1?0:s.playOrderPos;if(s={...s,playOrder:t,playOrderPos:r},0===t.length)return n.push({fn:E,turn:s.turn,phase:s.phase}),e}const p={action:x("endTurn",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};a&&(p.automatic=!0);const f=[...e.deltalog||[],p];return{...e,G:l,ctx:s,deltalog:f,_undo:[],_redo:[]}}function j(e,{arg:t,next:n,automatic:r,playerID:o}){o=o||e.ctx.currentPlayer;let{ctx:a}=e,{activePlayers:i,_activePlayersMoveLimit:l}=a;const s=null!==i&&o in i;if(!t&&s){const e=v(a).turn.stages[i[o]];e&&e.next&&(t=e.next)}if(n&&t&&n.push({fn:P,arg:t,playerID:o}),!s)return e;i=Object.keys(i).filter(e=>e!==o).reduce((e,t)=>(e[t]=i[t],e),{}),l&&(l=Object.keys(l).filter(e=>e!==o).reduce((e,t)=>(e[t]=l[t],e),{})),a=function(e){let{activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e;if(t&&0==Object.keys(t).length)if(e._nextActivePlayers)e=Ae(e,e._nextActivePlayers),({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e);else if(o.length>0){const e=o.length-1;({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r}=o[e]),o=o.slice(0,e)}else t=null,n=null;return{...e,activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}}({...a,activePlayers:i,_activePlayersMoveLimit:l});const c={action:x("endStage",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};r&&(c.automatic=!0);const u=[...e.deltalog||[],c];return{...e,ctx:a,deltalog:u}}function A(t,n,r){const o=v(t),a=o.turn.stages,{activePlayers:i}=t;if(i&&void 0!==i[r]&&i[r]!==ze.NULL&&void 0!==a[i[r]]&&void 0!==a[i[r]].moves){const e=a[i[r]].moves;if(n in e)return e[n]}else if(o.moves){if(n in o.moves)return o.moves[n]}else if(n in e)return e[n];return null}const S={endStage:function(e,t){return m(e,[{fn:j,playerID:t}])},setStage:function(e,t,n){return m(e,[{fn:j,arg:n,playerID:t}])},endTurn:function(e,t,n){return m(e,[{fn:D,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},pass:function(e,t,n){return m(e,[{fn:D,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:n}])},endPhase:function(e){return m(e,[{fn:E,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,n){return m(e,[{fn:E,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:n}}])},endGame:function(e,t,n){return m(e,[{fn:_,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},setActivePlayers:je};let C=[];return!1!==a.endTurn&&C.push("endTurn"),!1!==a.pass&&C.push("pass"),!1!==a.endPhase&&C.push("endPhase"),!1!==a.setPhase&&C.push("setPhase"),!1!==a.endGame&&C.push("endGame"),!1!==a.setActivePlayers&&C.push("setActivePlayers"),!1!==a.endStage&&C.push("endStage"),!1!==a.setStage&&C.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...new Array(e)].map((e,t)=>t+""),playOrderPos:0,phase:u,activePlayers:null}),init:e=>m(e,[{fn:g}]),isPlayerActive:function(e,t,n){return t.activePlayers?n in t.activePlayers:t.currentPlayer===n},eventHandlers:S,eventNames:Object.keys(S),enabledEventNames:C,moveMap:s,moveNames:[...c.values()],processMove:function(e,t){let n=v(e.ctx);const r=A(e.ctx,t.type,t.playerID),o=!r||"function"==typeof r||!0!==r.noLimit;let{ctx:a}=e,{_activePlayersNumMoves:i}=a;const{playerID:l}=t;let s=e.ctx.numMoves;o&&(l==e.ctx.currentPlayer&&s++,a.activePlayers&&i[l]++),e={...e,ctx:{...a,numMoves:s,_activePlayersNumMoves:i}},a._activePlayersMoveLimit&&i[l]>=a._activePlayersMoveLimit[l]&&(e=j(e,{playerID:l,automatic:!0}));const c=n.turn.wrapped.onMove(e);return m(e={...e,G:c},[{fn:h}])},processEvent:function(e,t){const{type:n,playerID:r,args:o}=t.payload;if(S.hasOwnProperty(n)){const t=[e,r].concat(o);return S[n].apply({},t)}return e},getMove:A}}function Be(e){if(function(e){return void 0!==e.processMove}(e))return e;if(void 0===e.name&&(e.name="default"),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=e=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw new Error("Plugin missing name attribute");if(e.name.includes(" "))throw new Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw new Error(e.name+": Game name must not include spaces");const t=Ne(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(n,r)=>{let o=t.getMove(n.ctx,r.type,r.playerID);var a;if((a=o)instanceof Object&&void 0!==a.move&&(o=o.move),o instanceof Function){const t=Oe(o,e.plugins),a={...Pe(n),playerID:r.playerID};let i=[];return void 0!==r.args&&(i=i.concat(r.args)),t(n.G,a,...i)}return De(`invalid move object: ${r.type}`),n.G}}}function Ge(){}const qe=e=>e;function Le(e,t){for(const n in t)e[n]=t[n];return e}function Te(e){return e()}function Re(){return Object.create(null)}function Ke(e){e.forEach(Te)}function Fe(e){return"function"==typeof e}function Ue(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function Ve(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function Je(e,t,n){return e[1]?Le({},Le(t.$$scope.ctx,e[1](n?n(t):{}))):t.$$scope.ctx}function He(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}const We="undefined"!=typeof window;let Ye=We?()=>window.performance.now():()=>Date.now(),Qe=We?e=>requestAnimationFrame(e):Ge;const Xe=new Set;let Ze,et=!1;function tt(){Xe.forEach(e=>{e[0](Ye())||(Xe.delete(e),e[1]())}),et=Xe.size>0,et&&Qe(tt)}function nt(e,t){e.appendChild(t)}function rt(e,t,n){e.insertBefore(t,n||null)}function ot(e){e.parentNode.removeChild(e)}function at(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function it(e){return document.createElement(e)}function lt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function st(e){return document.createTextNode(e)}function ct(){return st(" ")}function ut(){return st("")}function dt(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function pt(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function ft(e,t){t=""+t,e.data!==t&&(e.data=t)}function vt(e,t){(null!=t||e.value)&&(e.value=t)}function ht(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}}function mt(e,t,n){e.classList[n?"add":"remove"](t)}function gt(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}let yt,bt=0,xt={};function $t(e,t,n,r,o,a,i,l=0){const s=16.666/r;let c="{\n";for(let e=0;e<=1;e+=s){const r=t+(n-t)*a(e);c+=100*e+`%{${i(r,1-r)}}\n`}const u=c+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`;if(!xt[d]){if(!Ze){const e=it("style");document.head.appendChild(e),Ze=e.sheet}xt[d]=!0,Ze.insertRule(`@keyframes ${d} ${u}`,Ze.cssRules.length)}const p=e.style.animation||"";return e.style.animation=`${p?`${p}, `:""}${d} ${r}ms linear ${o}ms 1 both`,bt+=1,d}function wt(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--bt&&Qe(()=>{if(bt)return;let e=Ze.cssRules.length;for(;e--;)Ze.deleteRule(e);xt={}})}function Pt(e){yt=e}function Ot(){if(!yt)throw new Error("Function called outside component initialization");return yt}function kt(e){Ot().$$.on_destroy.push(e)}function It(){const e=yt;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=gt(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}function _t(e,t){Ot().$$.context.set(e,t)}function Et(e){return Ot().$$.context.get(e)}const Dt=[],jt=[],At=[],St=[],Ct=Promise.resolve();let Mt,zt=!1;function Nt(e){At.push(e)}function Bt(){const e=new Set;do{for(;Dt.length;){const e=Dt.shift();Pt(e),Gt(e.$$)}for(;jt.length;)jt.pop()();for(let t=0;t<At.length;t+=1){const n=At[t];e.has(n)||(n(),e.add(n))}At.length=0}while(Dt.length);for(;St.length;)St.pop()();zt=!1}function Gt(e){e.fragment&&(e.update(e.dirty),Ke(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(Nt))}function qt(e,t,n){e.dispatchEvent(gt(`${t?"intro":"outro"}${n}`))}const Lt=new Set;let Tt;function Rt(){Tt={r:0,c:[],p:Tt}}function Kt(){Tt.r||Ke(Tt.c),Tt=Tt.p}function Ft(e,t){e&&e.i&&(Lt.delete(e),e.i(t))}function Ut(e,t,n,r){if(e&&e.o){if(Lt.has(e))return;Lt.add(e),Tt.c.push(()=>{Lt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}const Vt={duration:0};function Jt(e,t,n,r){let o=t(e,n),a=r?0:1,i=null,l=null,s=null;function c(){s&&wt(e,s)}function u(e,t){const n=e.b-a;return t*=Math.abs(n),{a:a,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function d(t){const{delay:n=0,duration:r=300,easing:d=qe,tick:p=Ge,css:f}=o||Vt,v={start:Ye()+n,b:t};t||(v.group=Tt,Tt.r+=1),i?l=v:(f&&(c(),s=$t(e,a,t,r,n,d,f)),t&&p(0,1),i=u(v,r),Nt(()=>qt(e,t,"start")),function(e){let t;et||(et=!0,Qe(tt)),new Promise(n=>{Xe.add(t=[e,n])})}(t=>{if(l&&t>l.start&&(i=u(l,r),l=null,qt(e,i.b,"start"),f&&(c(),s=$t(e,a,i.b,i.duration,0,d,o.css))),i)if(t>=i.end)p(a=i.b,1-a),qt(e,i.b,"end"),l||(i.b?c():--i.group.r||Ke(i.group.c)),i=null;else if(t>=i.start){const e=t-i.start;a=i.a+i.d*d(e/i.duration),p(a,1-a)}return!(!i&&!l)}))}return{run(e){Fe(o)?(Mt||(Mt=Promise.resolve(),Mt.then(()=>{Mt=null})),Mt).then(()=>{o=o(),d(e)}):d(e)},end(){c(),i=l=null}}}const Ht="undefined"!=typeof window?window:global;function Wt(e,t,n){const{fragment:r,on_mount:o,on_destroy:a,after_update:i}=e.$$;r.m(t,n),Nt(()=>{const t=o.map(Te).filter(Fe);a?a.push(...t):Ke(t),e.$$.on_mount=[]}),i.forEach(Nt)}function Yt(e,t){e.$$.fragment&&(Ke(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function Qt(e,t){e.$$.dirty||(Dt.push(e),zt||(zt=!0,Ct.then(Bt)),e.$$.dirty=Re()),e.$$.dirty[t]=!0}function Xt(e,t,n,r,o,a){const i=yt;Pt(e);const l=t.props||{},s=e.$$={fragment:null,ctx:null,props:a,update:Ge,not_equal:o,bound:Re(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:Re(),dirty:null};let c=!1;s.ctx=n?n(e,l,(t,n,r=n)=>(s.ctx&&o(s.ctx[t],s.ctx[t]=r)&&(s.bound[t]&&s.bound[t](r),c&&Qt(e,t)),n)):l,s.update(),c=!0,Ke(s.before_update),s.fragment=r(s.ctx),t.target&&(t.hydrate?s.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):s.fragment.c(),t.intro&&Ft(e.$$.fragment),Wt(e,t.target,t.anchor),Bt()),Pt(i)}class Zt{$destroy(){Yt(this,1),this.$destroy=Ge}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const en=[];function tn(e,t=Ge){let n;const r=[];function o(t){if(Ue(e,t)&&(e=t,n)){const t=!en.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),en.push(n,e)}if(t){for(let e=0;e<en.length;e+=2)en[e][0](en[e+1]);en.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(a,i=Ge){const l=[a,i];return r.push(l),1===r.length&&(n=t(o)||Ge),a(e),()=>{const e=r.indexOf(l);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}function nn(e){const t=e-1;return t*t*t+1}function rn(e,{delay:t=0,duration:n=400,easing:r=nn,x:o=0,y:a=0,opacity:i=0}){const l=getComputedStyle(e),s=+l.opacity,c="none"===l.transform?"":l.transform,u=s*(1-i);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*o}px, ${(1-e)*a}px);\n\t\t\topacity: ${s-u*t}`}}function on(e,t,n){const r=Object.create(e);return r.key=t[n][0],r.label=t[n][1].label,r}function an(e){var t,n,r,o,a=e.label+"";function i(){return e.click_handler(e)}return{c(){t=it("div"),n=st(a),r=ct(),pt(t,"class","menu-item svelte-19bfq8g"),mt(t,"active",e.pane==e.key),o=dt(t,"click",i)},m(e,o){rt(e,t,o),nt(t,n),nt(t,r)},p(r,o){e=o,r.panes&&a!==(a=e.label+"")&&ft(n,a),(r.pane||r.panes)&&mt(t,"active",e.pane==e.key)},d(e){e&&ot(t),o()}}}function ln(e){var t;let n=Object.entries(e.panes).reverse(),r=[];for(let t=0;t<n.length;t+=1)r[t]=an(on(e,n,t));return{c(){t=it("div");for(let e=0;e<r.length;e+=1)r[e].c();pt(t,"class","menu svelte-19bfq8g")},m(e,n){rt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.pane||e.panes){let a;for(n=Object.entries(o.panes).reverse(),a=0;a<n.length;a+=1){const i=on(o,n,a);r[a]?r[a].p(e,i):(r[a]=an(i),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ge,o:Ge,d(e){e&&ot(t),at(r,e)}}}function sn(e,t,n){let{pane:r,panes:o}=t;const a=It();return e.$set=e=>{"pane"in e&&n("pane",r=e.pane),"panes"in e&&n("panes",o=e.panes)},{pane:r,panes:o,dispatch:a,click_handler:({key:e})=>a("change",e)}}class cn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-19bfq8g-style")||((t=it("style")).id="svelte-19bfq8g-style",t.textContent=".menu.svelte-19bfq8g{display:flex;margin-top:-10px;flex-direction:row;border:1px solid #ccc;border-radius:5px 5px 0 0;height:25px;line-height:25px;margin-right:-500px;transform-origin:bottom right;transform:rotate(-90deg) translate(0, -500px)}.menu-item.svelte-19bfq8g{line-height:25px;cursor:pointer;background:#fefefe;color:#555;padding-left:15px;padding-right:15px;text-align:center}.menu-item.svelte-19bfq8g:last-child{border-radius:0 5px 0 0}.menu-item.svelte-19bfq8g:first-child{border-radius:5px 0 0 0}.menu-item.active.svelte-19bfq8g{cursor:default;font-weight:bold;background:#ddd;color:#555}.menu-item.svelte-19bfq8g:hover{background:#ddd;color:#555}",nt(document.head,t)),Xt(this,e,sn,ln,Ue,["pane","panes"])}}function un(e){var t,n;return{c(){t=it("div"),n=st(e.label),pt(t,"class","label svelte-1olzq4i")},m(e,r){rt(e,t,r),nt(t,n)},p(e,t){e.label&&ft(n,t.label)},d(e){e&&ot(t)}}}function dn(e){var t,n,r,o,a,i=e.label&&un(e);return{c(){t=it("div"),n=it("div"),r=st(e.value),o=ct(),i&&i.c(),pt(n,"class","key-box svelte-1olzq4i"),pt(t,"class","key svelte-1olzq4i"),mt(t,"active",e.active),a=[dt(window,"keydown",e.Keypress),dt(n,"click",e.Activate)]},m(e,a){rt(e,t,a),nt(t,n),nt(n,r),nt(t,o),i&&i.m(t,null)},p(e,n){e.value&&ft(r,n.value),n.label?i?i.p(e,n):((i=un(n)).c(),i.m(t,null)):i&&(i.d(1),i=null),e.active&&mt(t,"active",n.active)},i:Ge,o:Ge,d(e){e&&ot(t),i&&i.d(),Ke(a)}}}function pn(e,t,n){let r,{value:o,onPress:a=null,label:i=null,disable:l=!1}=t;const{disableHotkeys:s}=Et("hotkeys");Ve(e,s,e=>{r=e,n("$disableHotkeys",r)});let c=!1;function u(){n("active",c=!1)}function d(){n("active",c=!0),setTimeout(u,200),a&&setTimeout(a,1)}return e.$set=e=>{"value"in e&&n("value",o=e.value),"onPress"in e&&n("onPress",a=e.onPress),"label"in e&&n("label",i=e.label),"disable"in e&&n("disable",l=e.disable)},{value:o,onPress:a,label:i,disable:l,disableHotkeys:s,active:c,Activate:d,Keypress:function(e){r||l||e.ctrlKey||e.metaKey||e.key!=o||(e.preventDefault(),d())}}}class fn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1olzq4i-style")||((t=it("style")).id="svelte-1olzq4i-style",t.textContent=".key.svelte-1olzq4i{display:flex;flex-direction:row;align-items:center}.key-box.svelte-1olzq4i{cursor:pointer;min-width:10px;padding-left:5px;padding-right:5px;height:20px;line-height:20px;text-align:center;border:1px solid #ccc;box-shadow:1px 1px 1px #888;background:#eee;color:#444}.key-box.svelte-1olzq4i:hover{background:#ddd}.key.active.svelte-1olzq4i .key-box.svelte-1olzq4i{background:#ddd;border:1px solid #999;box-shadow:none}.label.svelte-1olzq4i{margin-left:10px}",nt(document.head,t)),Xt(this,e,pn,dn,Ue,["value","onPress","label","disable"])}}function vn(e){var t,n,r,o,a,i,l,s,c,u;return{c(){var d;t=it("div"),n=it("span"),r=st(e.name),o=ct(),(a=it("span")).textContent="(",i=ct(),l=it("span"),s=ct(),(c=it("span")).textContent=")",pt(l,"class","arg-field svelte-1mppqmp"),pt(l,"contenteditable",""),pt(t,"class","move svelte-1mppqmp"),mt(t,"active",e.active),u=[dt(l,"blur",e.Deactivate),dt(l,"keypress",(d=hn,function(e){return e.stopPropagation(),d.call(this,e)})),dt(l,"keydown",e.OnKeyDown),dt(t,"click",e.Activate)]},m(u,d){rt(u,t,d),nt(t,n),nt(n,r),nt(t,o),nt(t,a),nt(t,i),nt(t,l),e.span2_binding(l),nt(t,s),nt(t,c)},p(e,n){e.name&&ft(r,n.name),e.active&&mt(t,"active",n.active)},i:Ge,o:Ge,d(n){n&&ot(t),e.span2_binding(null),Ke(u)}}}const hn=()=>{};function mn(e,t,n){let r,{Activate:o,Deactivate:a,name:i,active:l}=t;const s=It();var c;return c=()=>{l?r.focus():r.blur()},Ot().$$.after_update.push(c),e.$set=e=>{"Activate"in e&&n("Activate",o=e.Activate),"Deactivate"in e&&n("Deactivate",a=e.Deactivate),"name"in e&&n("name",i=e.name),"active"in e&&n("active",l=e.active)},{Activate:o,Deactivate:a,name:i,active:l,span:r,OnKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),function(){try{const e=r.innerText;let t=new Function(`return [${e}]`)();s("submit",t)}catch(e){s("error",e)}n("span",r.innerText="",r)}()),"Escape"==e.key&&(e.preventDefault(),a())},span2_binding:function(e){jt[e?"unshift":"push"](()=>{n("span",r=e)})}}}class gn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1mppqmp-style")||((t=it("style")).id="svelte-1mppqmp-style",t.textContent=".move.svelte-1mppqmp{display:flex;flex-direction:row;cursor:pointer;margin-left:10px;color:#666}.move.svelte-1mppqmp:hover{color:#333}.move.active.svelte-1mppqmp{color:#111;font-weight:bold}.arg-field.svelte-1mppqmp{outline:none;font-family:monospace}",nt(document.head,t)),Xt(this,e,mn,vn,Ue,["Activate","Deactivate","name","active"])}}function yn(e){var t,n;return{c(){t=it("span"),n=st(e.error),pt(t,"class","move-error svelte-smqssc")},m(e,r){rt(e,t,r),nt(t,n)},p(e,t){e.error&&ft(n,t.error)},d(e){e&&ot(t)}}}function bn(e){var t,n,r,o,a,i=new fn({props:{value:e.shortcut,onPress:e.Activate}}),l=new gn({props:{Activate:e.Activate,Deactivate:e.Deactivate,name:e.name,active:e.active}});l.$on("submit",e.Submit),l.$on("error",e.Error);var s=e.error&&yn(e);return{c(){t=it("div"),n=it("div"),i.$$.fragment.c(),r=ct(),l.$$.fragment.c(),o=ct(),s&&s.c(),pt(n,"class","wrapper svelte-smqssc")},m(e,c){rt(e,t,c),nt(t,n),Wt(i,n,null),nt(n,r),Wt(l,n,null),nt(t,o),s&&s.m(t,null),a=!0},p(e,n){var r={};e.shortcut&&(r.value=n.shortcut),i.$set(r);var o={};e.name&&(o.name=n.name),e.active&&(o.active=n.active),l.$set(o),n.error?s?s.p(e,n):((s=yn(n)).c(),s.m(t,null)):s&&(s.d(1),s=null)},i(e){a||(Ft(i.$$.fragment,e),Ft(l.$$.fragment,e),a=!0)},o(e){Ut(i.$$.fragment,e),Ut(l.$$.fragment,e),a=!1},d(e){e&&ot(t),Yt(i),Yt(l),s&&s.d()}}}function xn(e,t,n){let{shortcut:r,name:o,fn:a}=t;const{disableHotkeys:i}=Et("hotkeys");let l="",s=!1;function c(){i.set(!1),n("error",l=""),n("active",s=!1)}return e.$set=e=>{"shortcut"in e&&n("shortcut",r=e.shortcut),"name"in e&&n("name",o=e.name),"fn"in e&&n("fn",a=e.fn)},{shortcut:r,name:o,fn:a,error:l,active:s,Activate:function(){i.set(!0),n("active",s=!0)},Deactivate:c,Submit:function(e){n("error",l=""),c(),a.apply(this,e.detail)},Error:function(e){n("error",l=e.detail),De(e.detail)}}}class $n extends Zt{constructor(e){var t;super(),document.getElementById("svelte-smqssc-style")||((t=it("style")).id="svelte-smqssc-style",t.textContent=".move-error.svelte-smqssc{color:#a00;font-weight:bold}.wrapper.svelte-smqssc{display:flex;flex-direction:row;align-items:center}",nt(document.head,t)),Xt(this,e,xn,bn,Ue,["shortcut","name","fn"])}}var wn=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),a=n[0];return"object"==typeof a&&a?function t(n,r,o){return Object.keys(o).reduce((function(o,a){var i=o[a];if(i instanceof e){var l=n[i];"object"!=typeof l||r.has(l)?o[a]=l:(r.add(l),o[a]=t(n,r,l))}return o}),o)}(n,new Set,a):a},stringify:function(e){for(var t,r=new Map,o=[],a=[],i=+n(r,o,e),l=function(e,a){if(t)return t=!t,a;switch(typeof a){case"object":if(null===a)return a;case"string":return r.get(a)||n(r,o,a)}return a};i<o.length;i++)t=!0,a[i]=JSON.stringify(o[i],l);return"["+a.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(t,n){return"string"==typeof n?new e(n):n}}(String);const Pn=wn.parse,On=wn.stringify;function kn(e){var t,n,r,o,a,i,l,s,c,u=new fn({props:{value:"1",onPress:e.client.reset,label:"reset"}}),d=new fn({props:{value:"2",onPress:e.Save,label:"save"}}),p=new fn({props:{value:"3",onPress:e.Restore,label:"restore"}}),f=new fn({props:{value:".",disable:!0,label:"hide"}});return{c(){t=it("section"),n=it("li"),u.$$.fragment.c(),r=ct(),o=it("li"),d.$$.fragment.c(),a=ct(),i=it("li"),p.$$.fragment.c(),l=ct(),s=it("li"),f.$$.fragment.c(),pt(n,"class","svelte-1x2w9i0"),pt(o,"class","svelte-1x2w9i0"),pt(i,"class","svelte-1x2w9i0"),pt(s,"class","svelte-1x2w9i0"),pt(t,"id","debug-controls"),pt(t,"class","controls")},m(e,v){rt(e,t,v),nt(t,n),Wt(u,n,null),nt(t,r),nt(t,o),Wt(d,o,null),nt(t,a),nt(t,i),Wt(p,i,null),nt(t,l),nt(t,s),Wt(f,s,null),c=!0},p(e,t){var n={};e.client&&(n.onPress=t.client.reset),u.$set(n)},i(e){c||(Ft(u.$$.fragment,e),Ft(d.$$.fragment,e),Ft(p.$$.fragment,e),Ft(f.$$.fragment,e),c=!0)},o(e){Ut(u.$$.fragment,e),Ut(d.$$.fragment,e),Ut(p.$$.fragment,e),Ut(f.$$.fragment,e),c=!1},d(e){e&&ot(t),Yt(u),Yt(d),Yt(p),Yt(f)}}}function In(e,t,n){let{client:r}=t;return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,Save:function(){const{deltalog:e,_undo:t,_redo:n,...o}=r.getState(),a=On(o);window.localStorage.setItem("gamestate",a)},Restore:function(){const e=window.localStorage.getItem("gamestate");if(null!==e){const t=Pn(e);r.store.dispatch(w({state:t}))}}}}class _n extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1x2w9i0-style")||((t=it("style")).id="svelte-1x2w9i0-style",t.textContent="li.svelte-1x2w9i0{list-style:none;margin:none;margin-bottom:5px}",nt(document.head,t)),Xt(this,e,In,kn,Ue,["client"])}}function En(e,t,n){const r=Object.create(e);return r.player=t[n],r}function Dn(e){var t,n,r,o,a=e.player+"";function i(){return e.click_handler(e)}return{c(){t=it("div"),n=st(a),r=ct(),pt(t,"class","player svelte-6sf87x"),mt(t,"current",e.player==e.ctx.currentPlayer),mt(t,"active",e.player==e.playerID),o=dt(t,"click",i)},m(e,o){rt(e,t,o),nt(t,n),nt(t,r)},p(r,o){e=o,r.players&&a!==(a=e.player+"")&&ft(n,a),(r.players||r.ctx)&&mt(t,"current",e.player==e.ctx.currentPlayer),(r.players||r.playerID)&&mt(t,"active",e.player==e.playerID)},d(e){e&&ot(t),o()}}}function jn(e){var t;let n=e.players,r=[];for(let t=0;t<n.length;t+=1)r[t]=Dn(En(e,n,t));return{c(){t=it("div");for(let e=0;e<r.length;e+=1)r[e].c();pt(t,"class","player-box svelte-6sf87x")},m(e,n){rt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.players||e.ctx||e.playerID){let a;for(n=o.players,a=0;a<n.length;a+=1){const i=En(o,n,a);r[a]?r[a].p(e,i):(r[a]=Dn(i),r[a].c(),r[a].m(t,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ge,o:Ge,d(e){e&&ot(t),at(r,e)}}}function An(e,t,n){let{ctx:r,playerID:o}=t;const a=It();function i(e){a("change",e==o?{playerID:null}:{playerID:e})}let l;return e.$set=e=>{"ctx"in e&&n("ctx",r=e.ctx),"playerID"in e&&n("playerID",o=e.playerID)},e.$$.update=(e={ctx:1})=>{e.ctx&&n("players",l=r?[...Array(r.numPlayers).keys()].map(e=>e.toString()):[])},{ctx:r,playerID:o,OnClick:i,players:l,click_handler:({player:e})=>i(e)}}class Sn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-6sf87x-style")||((t=it("style")).id="svelte-6sf87x-style",t.textContent=".player-box.svelte-6sf87x{display:flex;flex-direction:row}.player.svelte-6sf87x{cursor:pointer;text-align:center;width:30px;height:30px;line-height:30px;background:#eee;border:3px solid #fefefe;box-sizing:content-box}.player.current.svelte-6sf87x{background:#555;color:#eee;font-weight:bold}.player.active.svelte-6sf87x{border:3px solid #ff7f50}",nt(document.head,t)),Xt(this,e,An,jn,Ue,["ctx","playerID"])}}function Cn(e,t,n){const r=Object.create(e);return r.name=t[n][0],r.fn=t[n][1],r}function Mn(e){var t,n,r,o=new $n({props:{shortcut:e.shortcuts[e.name],fn:e.fn,name:e.name}});return{c(){t=it("li"),o.$$.fragment.c(),n=ct(),pt(t,"class","svelte-1vg2l2b")},m(e,a){rt(e,t,a),Wt(o,t,null),nt(t,n),r=!0},p(e,t){var n={};e.client&&(n.shortcut=t.shortcuts[t.name]),e.client&&(n.fn=t.fn),e.client&&(n.name=t.name),o.$set(n)},i(e){r||(Ft(o.$$.fragment,e),r=!0)},o(e){Ut(o.$$.fragment,e),r=!1},d(e){e&&ot(t),Yt(o)}}}function zn(e){var t,n;return{c(){(t=it("button")).textContent="End Turn",pt(t,"class","svelte-1vg2l2b"),n=dt(t,"click",e.click_handler)},m(e,n){rt(e,t,n)},d(e){e&&ot(t),n()}}}function Nn(e){var t,n;return{c(){(t=it("button")).textContent="End Phase",pt(t,"class","svelte-1vg2l2b"),n=dt(t,"click",e.click_handler_1)},m(e,n){rt(e,t,n)},d(e){e&&ot(t),n()}}}function Bn(e){var t,n;return{c(){(t=it("button")).textContent="End Stage",pt(t,"class","svelte-1vg2l2b"),n=dt(t,"click",e.click_handler_2)},m(e,n){rt(e,t,n)},d(e){e&&ot(t),n()}}}function Gn(e){var t,n,r,o,a,i,l,s,c,u,d,p,f,v,h,m,g,y,b,x,$,w,P,O,k,I,_,E,D,j,A,S=JSON.stringify(e.G,null,2)+"",C=JSON.stringify(qn(e.ctx),null,2)+"",M=new _n({props:{client:e.client}}),z=new Sn({props:{ctx:e.ctx,playerID:e.playerID}});z.$on("change",e.change_handler);let N=Object.entries(e.client.moves),B=[];for(let t=0;t<N.length;t+=1)B[t]=Mn(Cn(e,N,t));const G=e=>Ut(B[e],1,1,()=>{B[e]=null});var q=e.client.events.endTurn&&zn(e),L=e.ctx.phase&&e.client.events.endPhase&&Nn(e),T=e.ctx.activePlayers&&e.client.events.endStage&&Bn(e);return{c(){t=it("section"),(n=it("h3")).textContent="Controls",r=ct(),M.$$.fragment.c(),o=ct(),a=it("section"),(i=it("h3")).textContent="Players",l=ct(),z.$$.fragment.c(),s=ct(),c=it("section"),(u=it("h3")).textContent="Moves",d=ct();for(let e=0;e<B.length;e+=1)B[e].c();p=ct(),f=it("section"),(v=it("h3")).textContent="Events",h=ct(),m=it("div"),q&&q.c(),g=ct(),L&&L.c(),y=ct(),T&&T.c(),b=ct(),x=it("section"),($=it("label")).textContent="G",w=ct(),P=it("pre"),O=st(S),k=ct(),I=it("section"),(_=it("label")).textContent="ctx",E=ct(),D=it("pre"),j=st(C),pt(n,"class","svelte-1vg2l2b"),pt(i,"class","svelte-1vg2l2b"),pt(u,"class","svelte-1vg2l2b"),pt(v,"class","svelte-1vg2l2b"),pt(m,"class","events svelte-1vg2l2b"),pt($,"class","svelte-1vg2l2b"),pt(P,"class","json svelte-1vg2l2b"),pt(_,"class","svelte-1vg2l2b"),pt(D,"class","json svelte-1vg2l2b")},m(e,S){rt(e,t,S),nt(t,n),nt(t,r),Wt(M,t,null),rt(e,o,S),rt(e,a,S),nt(a,i),nt(a,l),Wt(z,a,null),rt(e,s,S),rt(e,c,S),nt(c,u),nt(c,d);for(let e=0;e<B.length;e+=1)B[e].m(c,null);rt(e,p,S),rt(e,f,S),nt(f,v),nt(f,h),nt(f,m),q&&q.m(m,null),nt(m,g),L&&L.m(m,null),nt(m,y),T&&T.m(m,null),rt(e,b,S),rt(e,x,S),nt(x,$),nt(x,w),nt(x,P),nt(P,O),rt(e,k,S),rt(e,I,S),nt(I,_),nt(I,E),nt(I,D),nt(D,j),A=!0},p(e,t){var n={};e.client&&(n.client=t.client),M.$set(n);var r={};if(e.ctx&&(r.ctx=t.ctx),e.playerID&&(r.playerID=t.playerID),z.$set(r),e.shortcuts||e.client){let n;for(N=Object.entries(t.client.moves),n=0;n<N.length;n+=1){const r=Cn(t,N,n);B[n]?(B[n].p(e,r),Ft(B[n],1)):(B[n]=Mn(r),B[n].c(),Ft(B[n],1),B[n].m(c,null))}for(Rt(),n=N.length;n<B.length;n+=1)G(n);Kt()}t.client.events.endTurn?q||((q=zn(t)).c(),q.m(m,g)):q&&(q.d(1),q=null),t.ctx.phase&&t.client.events.endPhase?L||((L=Nn(t)).c(),L.m(m,y)):L&&(L.d(1),L=null),t.ctx.activePlayers&&t.client.events.endStage?T||((T=Bn(t)).c(),T.m(m,null)):T&&(T.d(1),T=null),A&&!e.G||S===(S=JSON.stringify(t.G,null,2)+"")||ft(O,S),A&&!e.ctx||C===(C=JSON.stringify(qn(t.ctx),null,2)+"")||ft(j,C)},i(e){if(!A){Ft(M.$$.fragment,e),Ft(z.$$.fragment,e);for(let e=0;e<N.length;e+=1)Ft(B[e]);A=!0}},o(e){Ut(M.$$.fragment,e),Ut(z.$$.fragment,e),B=B.filter(Boolean);for(let e=0;e<B.length;e+=1)Ut(B[e]);A=!1},d(e){e&&ot(t),Yt(M),e&&(ot(o),ot(a)),Yt(z),e&&(ot(s),ot(c)),at(B,e),e&&(ot(p),ot(f)),q&&q.d(),L&&L.d(),T&&T.d(),e&&(ot(b),ot(x),ot(k),ot(I))}}}function qn(e){let t={};for(const n in e)n.startsWith("_")||(t[n]=e[n]);return t}function Ln(e,t,n){let{client:r}=t;const o=function(e,t,n){var r={},o={};for(var a in e)o[a]=a;for(var i in t)o[i]=i;for(var l={},s=0;s<n.length;s++){l[n[s]]=!0}var c=l,u=!0;for(var d in o){var p=d[0];if(c[p]){u=!1;break}c[p]=!0,r[d]=p}if(u)return r;c=l;var f=97;for(var v in r={},o){for(var h=String.fromCharCode(f);c[h];)f++,h=String.fromCharCode(f);c[h]=!0,r[v]=h}return r}(r.moves,r.events,"mlia");let a=r.playerID,i={},l={};r.subscribe(e=>{e&&(n("G",l=e.G),n("ctx",i=e.ctx)),n("playerID",a=r.playerID)});return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,shortcuts:o,playerID:a,ctx:i,G:l,change_handler:e=>r.updatePlayerID(e.detail.playerID),click_handler:()=>r.events.endTurn(),click_handler_1:()=>r.events.endPhase(),click_handler_2:()=>r.events.endStage()}}class Tn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1vg2l2b-style")||((t=it("style")).id="svelte-1vg2l2b-style",t.textContent=".json.svelte-1vg2l2b{font-family:monospace;color:#888}label.svelte-1vg2l2b{font-weight:bold;font-size:1.1em;display:inline}h3.svelte-1vg2l2b{text-transform:uppercase}li.svelte-1vg2l2b{list-style:none;margin:none;margin-bottom:5px}.events.svelte-1vg2l2b{display:flex;flex-direction:column}.events.svelte-1vg2l2b button.svelte-1vg2l2b{width:100px}.events.svelte-1vg2l2b button.svelte-1vg2l2b:not(:last-child){margin-bottom:10px}",nt(document.head,t)),Xt(this,e,Ln,Gn,Ue,["client"])}}function Rn(e){var t,n,r,o,a,i,l=JSON.stringify(e.value)+"";return{c(){t=it("div"),n=it("strong"),r=st(e.name),o=ct(),a=it("div"),i=st(l),pt(a,"class","svelte-13qih23"),pt(t,"class","item svelte-13qih23")},m(e,l){rt(e,t,l),nt(t,n),nt(n,r),nt(t,o),nt(t,a),nt(a,i)},p(e,t){e.name&&ft(r,t.name),e.value&&l!==(l=JSON.stringify(t.value)+"")&&ft(i,l)},i:Ge,o:Ge,d(e){e&&ot(t)}}}function Kn(e,t,n){let{name:r,value:o}=t;return e.$set=e=>{"name"in e&&n("name",r=e.name),"value"in e&&n("value",o=e.value)},{name:r,value:o}}class Fn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-13qih23-style")||((t=it("style")).id="svelte-13qih23-style",t.textContent=".item.svelte-13qih23{padding:10px}.item.svelte-13qih23:not(:first-child){border-top:1px dashed #aaa}.item.svelte-13qih23 div.svelte-13qih23{float:right;text-align:right}",nt(document.head,t)),Xt(this,e,Kn,Rn,Ue,["name","value"])}}function Un(e){var t,n,r,o=new Fn({props:{name:"isConnected",value:e.$client.isConnected}}),a=new Fn({props:{name:"isMultiplayer",value:e.$client.isMultiplayer}});return{c(){t=it("span"),o.$$.fragment.c(),n=ct(),a.$$.fragment.c()},m(e,i){rt(e,t,i),Wt(o,t,null),nt(t,n),Wt(a,t,null),r=!0},p(e,t){var n={};e.$client&&(n.value=t.$client.isConnected),o.$set(n);var r={};e.$client&&(r.value=t.$client.isMultiplayer),a.$set(r)},i(e){r||(Ft(o.$$.fragment,e),Ft(a.$$.fragment,e),r=!0)},o(e){Ut(o.$$.fragment,e),Ut(a.$$.fragment,e),r=!1},d(e){e&&ot(t),Yt(o),Yt(a)}}}function Vn(e){var t,n,r,o,a,i=new Fn({props:{name:"gameID",value:e.client.gameID}}),l=new Fn({props:{name:"playerID",value:e.client.playerID}}),s=new Fn({props:{name:"isActive",value:e.$client.isActive}}),c=e.$client.isMultiplayer&&Un(e);return{c(){t=it("section"),i.$$.fragment.c(),n=ct(),l.$$.fragment.c(),r=ct(),s.$$.fragment.c(),o=ct(),c&&c.c(),pt(t,"class","gameinfo svelte-1yzq5o8")},m(e,u){rt(e,t,u),Wt(i,t,null),nt(t,n),Wt(l,t,null),nt(t,r),Wt(s,t,null),nt(t,o),c&&c.m(t,null),a=!0},p(e,n){var r={};e.client&&(r.value=n.client.gameID),i.$set(r);var o={};e.client&&(o.value=n.client.playerID),l.$set(o);var a={};e.$client&&(a.value=n.$client.isActive),s.$set(a),n.$client.isMultiplayer?c?(c.p(e,n),Ft(c,1)):((c=Un(n)).c(),Ft(c,1),c.m(t,null)):c&&(Rt(),Ut(c,1,1,()=>{c=null}),Kt())},i(e){a||(Ft(i.$$.fragment,e),Ft(l.$$.fragment,e),Ft(s.$$.fragment,e),Ft(c),a=!0)},o(e){Ut(i.$$.fragment,e),Ut(l.$$.fragment,e),Ut(s.$$.fragment,e),Ut(c),a=!1},d(e){e&&ot(t),Yt(i),Yt(l),Yt(s),c&&c.d()}}}function Jn(e,t,n){let r,{client:o}=t;return Ve(e,o,e=>{r=e,n("$client",r)}),e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,$client:r}}class Hn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1yzq5o8-style")||((t=it("style")).id="svelte-1yzq5o8-style",t.textContent=".gameinfo.svelte-1yzq5o8{padding:10px}",nt(document.head,t)),Xt(this,e,Jn,Vn,Ue,["client"])}}function Wn(e){var t,n;return{c(){t=it("div"),n=st(e.turn),pt(t,"class","turn-marker svelte-6eza86"),pt(t,"style",e.style)},m(e,r){rt(e,t,r),nt(t,n)},p(e,t){e.turn&&ft(n,t.turn)},i:Ge,o:Ge,d(e){e&&ot(t)}}}function Yn(e,t,n){let{turn:r,numEvents:o}=t;const a=`grid-row: span ${o}`;return e.$set=e=>{"turn"in e&&n("turn",r=e.turn),"numEvents"in e&&n("numEvents",o=e.numEvents)},{turn:r,numEvents:o,style:a}}class Qn extends Zt{constructor(e){var t;super(),document.getElementById("svelte-6eza86-style")||((t=it("style")).id="svelte-6eza86-style",t.textContent=".turn-marker.svelte-6eza86{display:flex;justify-content:center;align-items:center;grid-column:1;background:#555;color:#eee;text-align:center;font-weight:bold;border:1px solid #888}",nt(document.head,t)),Xt(this,e,Yn,Wn,Ue,["turn","numEvents"])}}function Xn(e){var t,n,r=e.phase||"";return{c(){t=it("div"),n=st(r),pt(t,"class","phase-marker svelte-1t4xap"),pt(t,"style",e.style)},m(e,r){rt(e,t,r),nt(t,n)},p(e,t){e.phase&&r!==(r=t.phase||"")&&ft(n,r)},i:Ge,o:Ge,d(e){e&&ot(t)}}}function Zn(e,t,n){let{phase:r,numEvents:o}=t;const a=`grid-row: span ${o}`;return e.$set=e=>{"phase"in e&&n("phase",r=e.phase),"numEvents"in e&&n("numEvents",o=e.numEvents)},{phase:r,numEvents:o,style:a}}class er extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1t4xap-style")||((t=it("style")).id="svelte-1t4xap-style",t.textContent=".phase-marker.svelte-1t4xap{grid-column:3;background:#555;border:1px solid #888;color:#eee;text-align:center;font-weight:bold;padding-top:10px;padding-bottom:10px;text-orientation:sideways;writing-mode:vertical-rl;line-height:30px;width:100%}",nt(document.head,t)),Xt(this,e,Zn,Xn,Ue,["phase","numEvents"])}}function tr(e){var t,n;return{c(){t=it("div"),n=st(e.custompayload)},m(e,r){rt(e,t,r),nt(t,n)},p:Ge,i:Ge,o:Ge,d(e){e&&ot(t)}}}function nr(e,t,n){let{payload:r}=t;const o=void 0!==r?JSON.stringify(r,null,4):"";return e.$set=e=>{"payload"in e&&n("payload",r=e.payload)},{payload:r,custompayload:o}}class rr extends Zt{constructor(e){super(),Xt(this,e,nr,tr,Ue,["payload"])}}function or(e){var t,n=new rr({props:{payload:e.payload}});return{c(){n.$$.fragment.c()},m(e,r){Wt(n,e,r),t=!0},p(e,t){var r={};e.payload&&(r.payload=t.payload),n.$set(r)},i(e){t||(Ft(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Yt(n,e)}}}function ar(e){var t,n,r=e.payloadComponent;function o(e){return{props:{payload:e.payload}}}if(r)var a=new r(o(e));return{c(){a&&a.$$.fragment.c(),t=ut()},m(e,r){a&&Wt(a,e,r),rt(e,t,r),n=!0},p(e,n){var i={};if(e.payload&&(i.payload=n.payload),r!==(r=n.payloadComponent)){if(a){Rt();const e=a;Ut(e.$$.fragment,1,0,()=>{Yt(e,1)}),Kt()}r?((a=new r(o(n))).$$.fragment.c(),Ft(a.$$.fragment,1),Wt(a,t.parentNode,t)):a=null}else r&&a.$set(i)},i(e){n||(a&&Ft(a.$$.fragment,e),n=!0)},o(e){a&&Ut(a.$$.fragment,e),n=!1},d(e){e&&ot(t),a&&Yt(a,e)}}}function ir(e){var t,n,r,o,a,i,l,s,c,u,d,p=e.action.payload.type+"",f=e.args.join(",")+"",v=[ar,or],h=[];function m(e,t){return t.payloadComponent?0:1}return s=m(0,e),c=h[s]=v[s](e),{c(){t=it("div"),n=it("div"),r=st(p),o=st("("),a=st(f),i=st(")"),l=ct(),c.c(),pt(t,"class","log-event player"+e.playerID+" svelte-10wdo7v"),mt(t,"pinned",e.pinned),d=[dt(t,"click",e.click_handler),dt(t,"mouseenter",e.mouseenter_handler),dt(t,"mouseleave",e.mouseleave_handler)]},m(e,c){rt(e,t,c),nt(t,n),nt(n,r),nt(n,o),nt(n,a),nt(n,i),nt(t,l),h[s].m(t,null),u=!0},p(e,n){u&&!e.action||p===(p=n.action.payload.type+"")||ft(r,p);var o=s;(s=m(0,n))===o?h[s].p(e,n):(Rt(),Ut(h[o],1,1,()=>{h[o]=null}),Kt(),(c=h[s])||(c=h[s]=v[s](n)).c(),Ft(c,1),c.m(t,null)),e.pinned&&mt(t,"pinned",n.pinned)},i(e){u||(Ft(c),u=!0)},o(e){Ut(c),u=!1},d(e){e&&ot(t),h[s].d(),Ke(d)}}}function lr(e,t,n){let{logIndex:r,action:o,pinned:a,payload:i,payloadComponent:l}=t;const s=It(),c=o.payload.args||[],u=o.payload.playerID;return e.$set=e=>{"logIndex"in e&&n("logIndex",r=e.logIndex),"action"in e&&n("action",o=e.action),"pinned"in e&&n("pinned",a=e.pinned),"payload"in e&&n("payload",i=e.payload),"payloadComponent"in e&&n("payloadComponent",l=e.payloadComponent)},{logIndex:r,action:o,pinned:a,payload:i,payloadComponent:l,dispatch:s,args:c,playerID:u,click_handler:()=>s("click",{logIndex:r}),mouseenter_handler:()=>s("mouseenter",{logIndex:r}),mouseleave_handler:()=>s("mouseleave")}}class sr extends Zt{constructor(e){var t;super(),document.getElementById("svelte-10wdo7v-style")||((t=it("style")).id="svelte-10wdo7v-style",t.textContent=".log-event.svelte-10wdo7v{grid-column:2;cursor:pointer;overflow:hidden;display:flex;flex-direction:column;justify-content:center;background:#fff;border:1px dotted #ccc;border-left:5px solid #ccc;padding:5px;text-align:center;color:#888;font-size:14px;min-height:25px;line-height:25px}.log-event.svelte-10wdo7v:hover{border-style:solid;background:#eee}.log-event.pinned.svelte-10wdo7v{border-style:solid;background:#eee;opacity:1}.player0.svelte-10wdo7v{border-left-color:#ff851b}.player1.svelte-10wdo7v{border-left-color:#7fdbff}.player2.svelte-10wdo7v{border-left-color:#0074d9}.player3.svelte-10wdo7v{border-left-color:#39cccc}.player4.svelte-10wdo7v{border-left-color:#3d9970}.player5.svelte-10wdo7v{border-left-color:#2ecc40}.player6.svelte-10wdo7v{border-left-color:#01ff70}.player7.svelte-10wdo7v{border-left-color:#ffdc00}.player8.svelte-10wdo7v{border-left-color:#001f3f}.player9.svelte-10wdo7v{border-left-color:#ff4136}.player10.svelte-10wdo7v{border-left-color:#85144b}.player11.svelte-10wdo7v{border-left-color:#f012be}.player12.svelte-10wdo7v{border-left-color:#b10dc9}.player13.svelte-10wdo7v{border-left-color:#111111}.player14.svelte-10wdo7v{border-left-color:#aaaaaa}.player15.svelte-10wdo7v{border-left-color:#dddddd}",nt(document.head,t)),Xt(this,e,lr,ir,Ue,["logIndex","action","pinned","payload","payloadComponent"])}}function cr(e){var t,n;return{c(){t=lt("title"),n=st(e.title)},m(e,r){rt(e,t,r),nt(t,n)},p(e,t){e.title&&ft(n,t.title)},d(e){e&&ot(t)}}}function ur(e){var t,n,r,o=e.title&&cr(e);const a=e.$$slots.default,i=function(e,t,n){if(e){const r=Je(e,t,n);return e[0](r)}}(a,e,null);return{c(){t=lt("svg"),o&&o.c(),n=ut(),i&&i.c(),pt(t,"xmlns","http://www.w3.org/2000/svg"),pt(t,"viewBox",e.viewBox),pt(t,"class","svelte-c8tyih")},l(e){i&&i.l(svg_nodes)},m(e,a){rt(e,t,a),o&&o.m(t,null),nt(t,n),i&&i.m(t,null),r=!0},p(e,l){l.title?o?o.p(e,l):((o=cr(l)).c(),o.m(t,n)):o&&(o.d(1),o=null),i&&i.p&&e.$$scope&&i.p(function(e,t,n,r){return e[1]?Le({},Le(t.$$scope.changed||{},e[1](r?r(n):{}))):t.$$scope.changed||{}}(a,l,e,null),Je(a,l,null)),r&&!e.viewBox||pt(t,"viewBox",l.viewBox)},i(e){r||(Ft(i,e),r=!0)},o(e){Ut(i,e),r=!1},d(e){e&&ot(t),o&&o.d(),i&&i.d(e)}}}function dr(e,t,n){let{title:r=null,viewBox:o}=t,{$$slots:a={},$$scope:i}=t;return e.$set=e=>{"title"in e&&n("title",r=e.title),"viewBox"in e&&n("viewBox",o=e.viewBox),"$$scope"in e&&n("$$scope",i=e.$$scope)},{title:r,viewBox:o,$$slots:a,$$scope:i}}class pr extends Zt{constructor(e){var t;super(),document.getElementById("svelte-c8tyih-style")||((t=it("style")).id="svelte-c8tyih-style",t.textContent="svg.svelte-c8tyih{stroke:currentColor;fill:currentColor;stroke-width:0;width:100%;height:auto;max-height:100%}",nt(document.head,t)),Xt(this,e,dr,ur,Ue,["title","viewBox"])}}function fr(e){var t;return{c(){pt(t=lt("path"),"d","M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z")},m(e,n){rt(e,t,n)},d(e){e&&ot(t)}}}function vr(e){var t,n=[{viewBox:"0 0 512 512"},e.$$props];let r={$$slots:{default:[fr]},$$scope:{ctx:e}};for(var o=0;o<n.length;o+=1)r=Le(r,n[o]);var a=new pr({props:r});return{c(){a.$$.fragment.c()},m(e,n){Wt(a,e,n),t=!0},p(e,t){var r,o=e.$$props?function(e,t){const n={},r={},o={$$scope:1};let a=e.length;for(;a--;){const i=e[a],l=t[a];if(l){for(const e in i)e in l||(r[e]=1);for(const e in l)o[e]||(n[e]=l[e],o[e]=1);e[a]=l}else for(const e in i)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(n,[n[0],(r=t.$$props,"object"==typeof r&&null!==r?r:{})]):{};e.$$scope&&(o.$$scope={changed:e,ctx:t}),a.$set(o)},i(e){t||(Ft(a.$$.fragment,e),t=!0)},o(e){Ut(a.$$.fragment,e),t=!1},d(e){Yt(a,e)}}}function hr(e,t,n){return e.$set=e=>{n("$$props",t=Le(Le({},t),e))},{$$props:t,$$props:t=He(t)}}class mr extends Zt{constructor(e){super(),Xt(this,e,hr,vr,Ue,[])}}function gr(e){var t,n;return{c(){t=it("div"),n=st(e.text),pt(t,"alt",e.text),pt(t,"class","svelte-1a7time")},m(e,r){rt(e,t,r),nt(t,n)},p(e,r){e.text&&(ft(n,r.text),pt(t,"alt",r.text))},i:Ge,o:Ge,d(e){e&&ot(t)}}}function yr(e,t,n){let r,{action:o}=t;return e.$set=e=>{"action"in e&&n("action",o=e.action)},e.$$.update=(e={action:1})=>{if(e.action){const{type:e,args:t}=o.payload,a=(t||[]).join(",");n("text",r=`${e}(${a})`)}},{action:o,text:r}}class br extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1a7time-style")||((t=it("style")).id="svelte-1a7time-style",t.textContent="div.svelte-1a7time{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:500px}",nt(document.head,t)),Xt(this,e,yr,gr,Ue,["action"])}}function xr(e,t,n){const r=Object.create(e);return r.child=t[n],r.i=n,r}function $r(e){var t,n,r,o,a,i,l,s,c,u,d,p=e.child.value+"",f=e.child.visits+"",v=new br({props:{action:e.child.parentAction}});function h(){return e.click_handler(e)}function m(){return e.mouseout_handler(e)}function g(){return e.mouseover_handler(e)}return{c(){t=it("tr"),n=it("td"),r=st(p),o=ct(),a=it("td"),i=st(f),l=ct(),s=it("td"),v.$$.fragment.c(),c=ct(),pt(n,"class","svelte-ztcwsu"),pt(a,"class","svelte-ztcwsu"),pt(s,"class","svelte-ztcwsu"),pt(t,"class","svelte-ztcwsu"),mt(t,"clickable",e.children.length>0),mt(t,"selected",e.i===e.selectedIndex),d=[dt(t,"click",h),dt(t,"mouseout",m),dt(t,"mouseover",g)]},m(e,d){rt(e,t,d),nt(t,n),nt(n,r),nt(t,o),nt(t,a),nt(a,i),nt(t,l),nt(t,s),Wt(v,s,null),nt(t,c),u=!0},p(n,o){e=o,u&&!n.children||p===(p=e.child.value+"")||ft(r,p),u&&!n.children||f===(f=e.child.visits+"")||ft(i,f);var a={};n.children&&(a.action=e.child.parentAction),v.$set(a),n.children&&mt(t,"clickable",e.children.length>0),n.selectedIndex&&mt(t,"selected",e.i===e.selectedIndex)},i(e){u||(Ft(v.$$.fragment,e),u=!0)},o(e){Ut(v.$$.fragment,e),u=!1},d(e){e&&ot(t),Yt(v),Ke(d)}}}function wr(e){var t,n,r,o,a;let i=e.children,l=[];for(let t=0;t<i.length;t+=1)l[t]=$r(xr(e,i,t));const s=e=>Ut(l[e],1,1,()=>{l[e]=null});return{c(){t=it("table"),(n=it("thead")).innerHTML='<th class="svelte-ztcwsu">Value</th> <th class="svelte-ztcwsu">Visits</th> <th class="svelte-ztcwsu">Action</th>',r=ct(),o=it("tbody");for(let e=0;e<l.length;e+=1)l[e].c();pt(t,"class","svelte-ztcwsu")},m(e,i){rt(e,t,i),nt(t,n),nt(t,r),nt(t,o);for(let e=0;e<l.length;e+=1)l[e].m(o,null);a=!0},p(e,t){if(e.children||e.selectedIndex){let n;for(i=t.children,n=0;n<i.length;n+=1){const r=xr(t,i,n);l[n]?(l[n].p(e,r),Ft(l[n],1)):(l[n]=$r(r),l[n].c(),Ft(l[n],1),l[n].m(o,null))}for(Rt(),n=i.length;n<l.length;n+=1)s(n);Kt()}},i(e){if(!a){for(let e=0;e<i.length;e+=1)Ft(l[e]);a=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)Ut(l[e]);a=!1},d(e){e&&ot(t),at(l,e)}}}function Pr(e,t,n){let{root:r,selectedIndex:o=null}=t;const a=It();let i=[],l=[];function s(e,t){a("select",{node:e,selectedIndex:t})}function c(e,t){null===o&&a("preview",{node:e})}return e.$set=e=>{"root"in e&&n("root",r=e.root),"selectedIndex"in e&&n("selectedIndex",o=e.selectedIndex)},e.$$.update=(e={root:1,parents:1})=>{if(e.root||e.parents){let e=r;for(n("parents",i=[]);e.parent;){const t=e.parent,{type:n,args:r}=e.parentAction.payload,o=`${n}(${(r||[]).join(",")})`;i.push({parent:t,arrowText:o}),e=t}i.reverse(),n("children",l=[...r.children].sort((e,t)=>e.visits<t.visits?1:-1).slice(0,50))}},{root:r,selectedIndex:o,children:l,Select:s,Preview:c,click_handler:({child:e,i:t})=>s(e,t),mouseout_handler:({i:e})=>c(null),mouseover_handler:({child:e,i:t})=>c(e)}}class Or extends Zt{constructor(e){var t;super(),document.getElementById("svelte-ztcwsu-style")||((t=it("style")).id="svelte-ztcwsu-style",t.textContent="table.svelte-ztcwsu{font-size:12px;border-collapse:collapse;border:1px solid #ddd;padding:0}tr.svelte-ztcwsu{cursor:pointer}tr.svelte-ztcwsu:hover td.svelte-ztcwsu{background:#eee}tr.selected.svelte-ztcwsu td.svelte-ztcwsu{background:#eee}td.svelte-ztcwsu{padding:10px;height:10px;line-height:10px;font-size:12px;border:none}th.svelte-ztcwsu{background:#888;color:#fff;padding:10px;text-align:center}",nt(document.head,t)),Xt(this,e,Pr,wr,Ue,["root","selectedIndex"])}}function kr(e,t,n){const r=Object.create(e);return r.node=t[n].node,r.selectedIndex=t[n].selectedIndex,r.i=n,r}function Ir(e){var t;var n=new Or({props:{root:e.node,selectedIndex:e.selectedIndex}});return n.$on("select",(function(...t){return e.select_handler_1(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){Wt(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),t.nodes&&(o.selectedIndex=e.selectedIndex),n.$set(o)},i(e){t||(Ft(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Yt(n,e)}}}function _r(e){var t;var n=new Or({props:{root:e.node}});return n.$on("select",(function(...t){return e.select_handler(e,...t)})),n.$on("preview",(function(...t){return e.preview_handler(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){Wt(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),n.$set(o)},i(e){t||(Ft(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Yt(n,e)}}}function Er(e){var t,n,r,o,a,i=0!==e.i&&function(e){var t,n,r=new mr({});return{c(){t=it("div"),r.$$.fragment.c(),pt(t,"class","icon svelte-1f0amz4")},m(e,o){rt(e,t,o),Wt(r,t,null),n=!0},i(e){n||(Ft(r.$$.fragment,e),n=!0)},o(e){Ut(r.$$.fragment,e),n=!1},d(e){e&&ot(t),Yt(r)}}}(),l=[_r,Ir],s=[];function c(e,t){return t.i===t.nodes.length-1?0:1}return r=c(0,e),o=s[r]=l[r](e),{c(){i&&i.c(),t=ct(),n=it("section"),o.c()},m(e,o){i&&i.m(e,o),rt(e,t,o),rt(e,n,o),s[r].m(n,null),a=!0},p(e,t){var a=r;(r=c(0,t))===a?s[r].p(e,t):(Rt(),Ut(s[a],1,1,()=>{s[a]=null}),Kt(),(o=s[r])||(o=s[r]=l[r](t)).c(),Ft(o,1),o.m(n,null))},i(e){a||(Ft(i),Ft(o),a=!0)},o(e){Ut(i),Ut(o),a=!1},d(e){i&&i.d(e),e&&(ot(t),ot(n)),s[r].d()}}}function Dr(e){var t,n,r,o,a=new mr({}),i=new Or({props:{root:e.preview}});return{c(){t=it("div"),a.$$.fragment.c(),n=ct(),r=it("section"),i.$$.fragment.c(),pt(t,"class","icon svelte-1f0amz4"),pt(r,"class","preview svelte-1f0amz4")},m(e,l){rt(e,t,l),Wt(a,t,null),rt(e,n,l),rt(e,r,l),Wt(i,r,null),o=!0},p(e,t){var n={};e.preview&&(n.root=t.preview),i.$set(n)},i(e){o||(Ft(a.$$.fragment,e),Ft(i.$$.fragment,e),o=!0)},o(e){Ut(a.$$.fragment,e),Ut(i.$$.fragment,e),o=!1},d(e){e&&ot(t),Yt(a),e&&(ot(n),ot(r)),Yt(i)}}}function jr(e){var t,n,r;let o=e.nodes,a=[];for(let t=0;t<o.length;t+=1)a[t]=Er(kr(e,o,t));const i=e=>Ut(a[e],1,1,()=>{a[e]=null});var l=e.preview&&Dr(e);return{c(){t=it("div");for(let e=0;e<a.length;e+=1)a[e].c();n=ct(),l&&l.c(),pt(t,"class","visualizer svelte-1f0amz4")},m(e,o){rt(e,t,o);for(let e=0;e<a.length;e+=1)a[e].m(t,null);nt(t,n),l&&l.m(t,null),r=!0},p(e,r){if(e.nodes){let l;for(o=r.nodes,l=0;l<o.length;l+=1){const i=kr(r,o,l);a[l]?(a[l].p(e,i),Ft(a[l],1)):(a[l]=Er(i),a[l].c(),Ft(a[l],1),a[l].m(t,n))}for(Rt(),l=o.length;l<a.length;l+=1)i(l);Kt()}r.preview?l?(l.p(e,r),Ft(l,1)):((l=Dr(r)).c(),Ft(l,1),l.m(t,null)):l&&(Rt(),Ut(l,1,1,()=>{l=null}),Kt())},i(e){if(!r){for(let e=0;e<o.length;e+=1)Ft(a[e]);Ft(l),r=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)Ut(a[e]);Ut(l),r=!1},d(e){e&&ot(t),at(a,e),l&&l.d()}}}function Ar(e,t,n){let{metadata:r}=t,o=[],a=null;function i({node:e,selectedIndex:t},r){n("preview",a=null),n("nodes",o[r].selectedIndex=t,o),n("nodes",o=[...o.slice(0,r+1),{node:e}])}function l({node:e},t){n("preview",a=e)}return e.$set=e=>{"metadata"in e&&n("metadata",r=e.metadata)},e.$$.update=(e={metadata:1})=>{e.metadata&&n("nodes",o=[{node:r}])},{metadata:r,nodes:o,preview:a,SelectNode:i,PreviewNode:l,select_handler:({i:e},t)=>i(t.detail,e),preview_handler:({i:e},t)=>l(t.detail),select_handler_1:({i:e},t)=>i(t.detail,e)}}class Sr extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1f0amz4-style")||((t=it("style")).id="svelte-1f0amz4-style",t.textContent=".visualizer.svelte-1f0amz4{display:flex;flex-direction:column;align-items:center;padding:50px}.preview.svelte-1f0amz4{opacity:0.5}.icon.svelte-1f0amz4{color:#777;width:32px;height:32px;margin-bottom:20px}",nt(document.head,t)),Xt(this,e,Ar,jr,Ue,["metadata"])}}function Cr(e,t,n){const r=Object.create(e);return r.phase=t[n].phase,r.i=n,r}function Mr(e,t,n){const r=Object.create(e);return r.action=t[n].action,r.payload=t[n].payload,r.i=n,r}function zr(e,t,n){const r=Object.create(e);return r.turn=t[n].turn,r.i=n,r}function Nr(e){var t,n=new Qn({props:{turn:e.turn,numEvents:e.turnBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){Wt(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.turn=t.turn),e.turnBoundaries&&(r.numEvents=t.turnBoundaries[t.i]),n.$set(r)},i(e){t||(Ft(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Yt(n,e)}}}function Br(e){var t,n,r=e.i in e.turnBoundaries&&Nr(e);return{c(){r&&r.c(),t=ut()},m(e,o){r&&r.m(e,o),rt(e,t,o),n=!0},p(e,n){n.i in n.turnBoundaries?r?(r.p(e,n),Ft(r,1)):((r=Nr(n)).c(),Ft(r,1),r.m(t.parentNode,t)):r&&(Rt(),Ut(r,1,1,()=>{r=null}),Kt())},i(e){n||(Ft(r),n=!0)},o(e){Ut(r),n=!1},d(e){r&&r.d(e),e&&ot(t)}}}function Gr(e){var t,n=new sr({props:{pinned:e.i===e.pinned,logIndex:e.i,action:e.action,payload:e.payload}});return n.$on("click",e.OnLogClick),n.$on("mouseenter",e.OnMouseEnter),n.$on("mouseleave",e.OnMouseLeave),{c(){n.$$.fragment.c()},m(e,r){Wt(n,e,r),t=!0},p(e,t){var r={};e.pinned&&(r.pinned=t.i===t.pinned),e.renderedLogEntries&&(r.action=t.action),e.renderedLogEntries&&(r.payload=t.payload),n.$set(r)},i(e){t||(Ft(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Yt(n,e)}}}function qr(e){var t,n=new er({props:{phase:e.phase,numEvents:e.phaseBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){Wt(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.phase=t.phase),e.phaseBoundaries&&(r.numEvents=t.phaseBoundaries[t.i]),n.$set(r)},i(e){t||(Ft(n.$$.fragment,e),t=!0)},o(e){Ut(n.$$.fragment,e),t=!1},d(e){Yt(n,e)}}}function Lr(e){var t,n,r=e.i in e.phaseBoundaries&&qr(e);return{c(){r&&r.c(),t=ut()},m(e,o){r&&r.m(e,o),rt(e,t,o),n=!0},p(e,n){n.i in n.phaseBoundaries?r?(r.p(e,n),Ft(r,1)):((r=qr(n)).c(),Ft(r,1),r.m(t.parentNode,t)):r&&(Rt(),Ut(r,1,1,()=>{r=null}),Kt())},i(e){n||(Ft(r),n=!0)},o(e){Ut(r),n=!1},d(e){r&&r.d(e),e&&ot(t)}}}function Tr(e){var t,n,r,o,a;let i=e.renderedLogEntries,l=[];for(let t=0;t<i.length;t+=1)l[t]=Br(zr(e,i,t));const s=e=>Ut(l[e],1,1,()=>{l[e]=null});let c=e.renderedLogEntries,u=[];for(let t=0;t<c.length;t+=1)u[t]=Gr(Mr(e,c,t));const d=e=>Ut(u[e],1,1,()=>{u[e]=null});let p=e.renderedLogEntries,f=[];for(let t=0;t<p.length;t+=1)f[t]=Lr(Cr(e,p,t));const v=e=>Ut(f[e],1,1,()=>{f[e]=null});return{c(){t=it("div");for(let e=0;e<l.length;e+=1)l[e].c();n=ct();for(let e=0;e<u.length;e+=1)u[e].c();r=ct();for(let e=0;e<f.length;e+=1)f[e].c();pt(t,"class","gamelog svelte-1pq5e4b"),mt(t,"pinned",e.pinned),a=dt(window,"keydown",e.OnKeyDown)},m(e,a){rt(e,t,a);for(let e=0;e<l.length;e+=1)l[e].m(t,null);nt(t,n);for(let e=0;e<u.length;e+=1)u[e].m(t,null);nt(t,r);for(let e=0;e<f.length;e+=1)f[e].m(t,null);o=!0},p(e,o){if(e.turnBoundaries||e.renderedLogEntries){let r;for(i=o.renderedLogEntries,r=0;r<i.length;r+=1){const a=zr(o,i,r);l[r]?(l[r].p(e,a),Ft(l[r],1)):(l[r]=Br(a),l[r].c(),Ft(l[r],1),l[r].m(t,n))}for(Rt(),r=i.length;r<l.length;r+=1)s(r);Kt()}if(e.pinned||e.renderedLogEntries){let n;for(c=o.renderedLogEntries,n=0;n<c.length;n+=1){const a=Mr(o,c,n);u[n]?(u[n].p(e,a),Ft(u[n],1)):(u[n]=Gr(a),u[n].c(),Ft(u[n],1),u[n].m(t,r))}for(Rt(),n=c.length;n<u.length;n+=1)d(n);Kt()}if(e.phaseBoundaries||e.renderedLogEntries){let n;for(p=o.renderedLogEntries,n=0;n<p.length;n+=1){const r=Cr(o,p,n);f[n]?(f[n].p(e,r),Ft(f[n],1)):(f[n]=Lr(r),f[n].c(),Ft(f[n],1),f[n].m(t,null))}for(Rt(),n=p.length;n<f.length;n+=1)v(n);Kt()}e.pinned&&mt(t,"pinned",o.pinned)},i(e){if(!o){for(let e=0;e<i.length;e+=1)Ft(l[e]);for(let e=0;e<c.length;e+=1)Ft(u[e]);for(let e=0;e<p.length;e+=1)Ft(f[e]);o=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)Ut(l[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)Ut(u[e]);f=f.filter(Boolean);for(let e=0;e<f.length;e+=1)Ut(f[e]);o=!1},d(e){e&&ot(t),at(l,e),at(u,e),at(f,e),a()}}}function Rr(e,t,n){let r,{client:o}=t;Ve(e,o,e=>{r=e,n("$client",r)});const{secondaryPane:a}=Et("secondaryPane"),i=o.getInitialState();let l,{log:s}=r,c=null;function u(e){let t=i;for(let n=0;n<s.length;n++){const{action:r,automatic:a}=s[n];if(a||(t=o.reducer(t,r)),"MAKE_MOVE"==r.type){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}function d(){n("pinned",c=null),o.overrideGameState(null),a.set(null)}kt(d);let p={},f={};return e.$set=e=>{"client"in e&&n("client",o=e.client)},e.$$.update=(e={$client:1,log:1,renderedLogEntries:1})=>{if(e.$client||e.log||e.renderedLogEntries){n("log",s=r.log),n("renderedLogEntries",l=s.filter(e=>"MAKE_MOVE"==e.action.type));let e=0,t=0;n("turnBoundaries",p={}),n("phaseBoundaries",f={});for(let r=0;r<l.length;r++){const{action:o,payload:a,turn:i,phase:s}=l[r];t++,e++,r!=l.length-1&&l[r+1].turn==i||(n("turnBoundaries",p[r]=t,p),t=0),r!=l.length-1&&l[r+1].phase==s||(n("phaseBoundaries",f[r]=e,f),e=0)}}},{client:o,pinned:c,OnLogClick:function(e){const{logIndex:t}=e.detail,r=u(t),i=s.filter(e=>"MAKE_MOVE"==e.action.type);if(o.overrideGameState(r),c==t)n("pinned",c=null),a.set(null);else{n("pinned",c=t);const{metadata:e}=i[t].action.payload;e&&a.set({component:Sr,metadata:e})}},OnMouseEnter:function(e){const{logIndex:t}=e.detail;if(null===c){const e=u(t);o.overrideGameState(e)}},OnMouseLeave:function(){null===c&&o.overrideGameState(null)},OnKeyDown:function(e){27==e.keyCode&&d()},renderedLogEntries:l,turnBoundaries:p,phaseBoundaries:f}}class Kr extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1pq5e4b-style")||((t=it("style")).id="svelte-1pq5e4b-style",t.textContent=".gamelog.svelte-1pq5e4b{display:grid;grid-template-columns:30px 1fr 30px;grid-auto-rows:auto;grid-auto-flow:column}",nt(document.head,t)),Xt(this,e,Rr,Tr,Ue,["client"])}}const{Object:Fr}=Ht;function Ur(e,t,n){const r=Fr.create(e);return r.key=t[n][0],r.value=t[n][1],r}function Vr(e){var t,n,r,o,a,i,l,s=e.values[e.key]+"";function c(){e.input_change_input_handler.call(o,e)}return{c(){t=it("span"),n=st(s),r=ct(),o=it("input"),pt(t,"class","value svelte-7cel4i"),pt(o,"type","range"),pt(o,"min",a=e.value.range.min),pt(o,"max",i=e.value.range.max),l=[dt(o,"change",c),dt(o,"input",c),dt(o,"change",e.OnChange)]},m(a,i){rt(a,t,i),nt(t,n),rt(a,r,i),rt(a,o,i),vt(o,e.values[e.key])},p(t,r){e=r,(t.values||t.bot)&&s!==(s=e.values[e.key]+"")&&ft(n,s),(t.values||t.Object||t.bot)&&vt(o,e.values[e.key]),t.bot&&a!==(a=e.value.range.min)&&pt(o,"min",a),t.bot&&i!==(i=e.value.range.max)&&pt(o,"max",i)},d(e){e&&(ot(t),ot(r),ot(o)),Ke(l)}}}function Jr(e){var t,n;function r(){e.input_change_handler.call(t,e)}return{c(){pt(t=it("input"),"type","checkbox"),pt(t,"class","svelte-7cel4i"),n=[dt(t,"change",r),dt(t,"change",e.OnChange)]},m(n,r){rt(n,t,r),t.checked=e.values[e.key]},p(n,r){e=r,(n.values||n.Object||n.bot)&&(t.checked=e.values[e.key])},d(e){e&&ot(t),Ke(n)}}}function Hr(e){var t,n,r,o,a,i,l=e.key+"",s=e.value.range&&Vr(e),c="boolean"==typeof e.value.value&&Jr(e);return{c(){t=it("div"),n=it("label"),r=st(l),o=ct(),s&&s.c(),a=ct(),c&&c.c(),i=ct(),pt(n,"class","svelte-7cel4i"),pt(t,"class","option svelte-7cel4i")},m(e,l){rt(e,t,l),nt(t,n),nt(n,r),nt(t,o),s&&s.m(t,null),nt(t,a),c&&c.m(t,null),nt(t,i)},p(e,n){e.bot&&l!==(l=n.key+"")&&ft(r,l),n.value.range?s?s.p(e,n):((s=Vr(n)).c(),s.m(t,a)):s&&(s.d(1),s=null),"boolean"==typeof n.value.value?c?c.p(e,n):((c=Jr(n)).c(),c.m(t,i)):c&&(c.d(1),c=null)},d(e){e&&ot(t),s&&s.d(),c&&c.d()}}}function Wr(e){var t;let n=e.Object.entries(e.bot.opts()),r=[];for(let t=0;t<n.length;t+=1)r[t]=Hr(Ur(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=ut()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);rt(e,t,n)},p(e,o){if(e.Object||e.bot||e.values){let a;for(n=o.Object.entries(o.bot.opts()),a=0;a<n.length;a+=1){const i=Ur(o,n,a);r[a]?r[a].p(e,i):(r[a]=Hr(i),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},i:Ge,o:Ge,d(e){at(r,e),e&&ot(t)}}}function Yr(e,t,n){let{bot:r}=t,o={};for(let[e,t]of Object.entries(r.opts()))n("values",o[e]=t.value,o);return e.$set=e=>{"bot"in e&&n("bot",r=e.bot)},{bot:r,values:o,OnChange:function(){for(let[e,t]of Object.entries(o))r.setOpt(e,t)},Object:Object,input_change_input_handler:function({key:e}){o[e]=function(e){return""===e?void 0:+e}(this.value),n("values",o),n("Object",Object),n("bot",r)},input_change_handler:function({key:e}){o[e]=this.checked,n("values",o),n("Object",Object),n("bot",r)}}}class Qr extends Zt{constructor(e){var t;super(),document.getElementById("svelte-7cel4i-style")||((t=it("style")).id="svelte-7cel4i-style",t.textContent="label.svelte-7cel4i{font-weight:bold;color:#999}.option.svelte-7cel4i{margin-bottom:20px}.value.svelte-7cel4i{font-weight:bold}input[type='checkbox'].svelte-7cel4i{vertical-align:middle}",nt(document.head,t)),Xt(this,e,Yr,Wr,Ue,["bot"])}}function Xr({game:e,isClient:t}){return e=Be(e),(n=null,r)=>{switch(r.type){case"GAME_EVENT":{if(n={...n,deltalog:[]},t)return n;if(void 0!==n.ctx.gameover)return De("cannot call event after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return De(`disallowed event: ${r.payload.type}`),n;n=ke(n,{game:e,isClient:!1,playerID:r.payload.playerID});let o=e.flow.processEvent(n,r);return o=Ie(o,{game:e,isClient:!1}),{...o,_stateID:n._stateID+1}}case"MAKE_MOVE":{n={...n,deltalog:[]};const o=e.flow.getMove(n.ctx,r.payload.type,r.payload.playerID||n.ctx.currentPlayer);if(null===o)return De(`disallowed move: ${r.payload.type}`),n;if(t&&!1===o.client)return n;if(void 0!==n.ctx.gameover)return De("cannot make move after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return De(`disallowed move: ${r.payload.type}`),n;n=ke(n,{game:e,isClient:t,playerID:r.payload.playerID});let a=e.processMove(n,r.payload);if("INVALID_MOVE"===a)return De(`invalid move: ${r.payload.type} args: ${r.payload.args}`),n;let i={action:r,_stateID:n._stateID,turn:n.ctx.turn,phase:n.ctx.phase};!0===o.redact&&(i.redact=!0);const l={...n,G:a,deltalog:[i],_stateID:n._stateID+1};if(t&&((e,t)=>[...we,...t.game.plugins].filter(e=>void 0!==e.noClient).map(n=>{const r=n.name,o=e.plugins[r];return!!o&&n.noClient({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data})}).some(e=>!0===e))(l,{game:e}))return n;if(n=l,t)return n=Ie(n,{game:e,isClient:!0});const s=n.ctx.turn;return n=e.flow.processMove(n,r.payload),(n=Ie(n,{game:e})).ctx.turn===s&&(n._undo=n._undo.concat({G:n.G,ctx:n.ctx,moveType:r.payload.type})),n._redo=[],n}case"RESET":case"UPDATE":case"SYNC":return r.state;case"UNDO":{const{_undo:t,_redo:l}=n;if(t.length<2)return n;const s=t[t.length-1],c=t[t.length-2],u=e.flow.getMove(c.ctx,s.moveType,r.payload.playerID);return o=n.G,a=n.ctx,!function(e){return void 0!==e.undoable}(i=u)||(i.undoable instanceof Function?i.undoable(o,a):i.undoable)?{...n,G:c.G,ctx:c.ctx,_undo:t.slice(0,t.length-1),_redo:[s,...l]}:n}case"REDO":{const{_undo:e,_redo:t}=n;if(0==t.length)return n;const r=t[0];return{...n,G:r.G,ctx:r.ctx,_undo:[...e,r],_redo:t.slice(1)}}case"PLUGIN":return((e,t,n)=>(n.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},a=n.action(o.data,t.payload);e={...e,plugins:{...e.plugins,[r]:{...o,data:a}}}}),e))(n,r,{game:e});default:return n}var o,a,i}}class Zr{constructor({enumerate:e,seed:t}){this.enumerateFn=e,this.seed=t,this.iterationCounter=0,this._opts={}}addOpt({key:e,range:t,initial:n}){this._opts[e]={range:t,value:n}}getOpt(e){return this._opts[e].value}setOpt(e,t){e in this._opts&&(this._opts[e].value=t)}opts(){return this._opts}enumerate(e,t,n){return this.enumerateFn(e,t,n).map(e=>"payload"in e?e:"move"in e?b(e.move,e.args,n):"event"in e?x(e.event,e.args,n):void 0)}random(e){let t;if(void 0!==this.seed){let e=null;e=this.prngstate?new be("",{state:this.prngstate}):new be(this.seed,{state:!0}),t=e(),this.prngstate=e.state()}else t=Math.random();if(e){if(Array.isArray(e)){return e[Math.floor(t*e.length)]}return Math.floor(t*e)}return t}}class eo extends Zr{constructor({enumerate:e,seed:t,objectives:n,game:r,iterations:o,playoutDepth:a,iterationCallback:i}){super({enumerate:e,seed:t}),void 0===n&&(n=()=>({})),this.objectives=n,this.iterationCallback=i||(()=>{}),this.reducer=Xr({game:r}),this.iterations=o,this.playoutDepth=a,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:"number"==typeof o?o:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:"number"==typeof a?a:50,range:{min:1,max:100}})}createNode({state:e,parentAction:t,parent:n,playerID:r}){const{G:o,ctx:a}=e;let i=[],l=[];if(void 0!==r)i=this.enumerate(o,a,r),l=this.objectives(o,a,r);else if(a.activePlayers)for(let e in a.activePlayers)i=i.concat(this.enumerate(o,a,e)),l=l.concat(this.objectives(o,a,e));else i=i.concat(this.enumerate(o,a,a.currentPlayer)),l=l.concat(this.objectives(o,a,a.currentPlayer));return{state:e,parent:n,parentAction:t,actions:i,objectives:l,children:[],visits:0,value:0}}select(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;let t=null,n=0;for(const r of e.children){const o=r.visits+Number.EPSILON,a=r.value/o+Math.sqrt(2*Math.log(e.visits)/o);(null==t||a>n)&&(n=a,t=r)}return this.select(t)}expand(e){const t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;const n=this.random(t.length),r=t[n];e.actions.splice(n,1);const o=this.reducer(e.state,r),a=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(a),a}playout({state:e}){let t=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(t=this.playoutDepth(e.G,e.ctx));for(let n=0;n<t&&void 0===e.ctx.gameover;n++){const{G:t,ctx:n}=e;let r=n.currentPlayer;n.activePlayers&&(r=Object.keys(n.activePlayers)[0]);const o=this.enumerate(t,n,r),a=this.objectives(t,n,r),i=Object.keys(a).reduce((e,r)=>{const o=a[r];return o.checker(t,n)?e+o.weight:e},0);if(i>0)return{score:i};if(!o||0==o.length)return;const l=this.random(o.length);e=this.reducer(e,o[l])}return e.ctx.gameover}backpropagate(e,t={}){e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}play(e,t){const n=this.createNode({state:e,playerID:t});let r=this.getOpt("iterations");"function"==typeof this.iterations&&(r=this.iterations(e.G,e.ctx));const o=()=>{let e=null;for(const t of n.children)(null==e||t.visits>e.visits)&&(e=t);return{action:e&&e.parentAction,metadata:n}};return new Promise(e=>{const t=()=>{for(let e=0;e<25&&this.iterationCounter<r;e++){const e=this.select(n),t=this.expand(e),r=this.playout(t);this.backpropagate(t,r),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:r,metadata:n})};if(this.iterationCounter=0,this.getOpt("async")){const n=()=>{this.iterationCounter<r?(t(),setTimeout(n,0)):e(o())};n()}else{for(;this.iterationCounter<r;)t();e(o())}})}}class to extends Zr{play({G:e,ctx:t},n){const r=this.enumerate(e,t,n);return Promise.resolve({action:this.random(r)})}}async function no(e,t){const n=e.store.getState();let r=n.ctx.currentPlayer;n.ctx.activePlayers&&(r=Object.keys(n.ctx.activePlayers)[0]);const{action:o,metadata:a}=await t.play(n,r);if(o){const t={...o,payload:{...o.payload,metadata:a}};return e.store.dispatch(t),t}}function ro(e,t,n){const r=Object.create(e);return r.bot=t[n],r}function oo(e){var t,n,r;return{c(){(t=it("p")).textContent="No bots available.",n=ct(),(r=it("p")).innerHTML='\n\t\t\t        Follow the instructions\n\t\t\t        <a href="https://boardgame.io/documentation/#/tutorial?id=bots" target="_blank">\n\t\t\t          here</a>\n\t\t\t        to set up bots.\n\t\t\t      '},m(e,o){rt(e,t,o),rt(e,n,o),rt(e,r,o)},p:Ge,i:Ge,o:Ge,d(e){e&&(ot(t),ot(n),ot(r))}}}function ao(e){var t;return{c(){(t=it("p")).textContent="The bot debugger is only available in singleplayer mode."},m(e,n){rt(e,t,n)},p:Ge,i:Ge,o:Ge,d(e){e&&ot(t)}}}function io(e){var t,n,r,o,a,i,l,s,c,u,d,p,f,v,h,m,g,y,b=Object.keys(e.bot.opts()).length,x=new fn({props:{value:"1",onPress:e.Reset,label:"reset"}}),$=new fn({props:{value:"2",onPress:e.Step,label:"play"}}),w=new fn({props:{value:"3",onPress:e.Simulate,label:"simulate"}});let P=Object.keys(e.bots),O=[];for(let t=0;t<P.length;t+=1)O[t]=lo(ro(e,P,t));var k=b&&so(e),I=(e.botAction||e.iterationCounter)&&co(e);return{c(){t=it("section"),(n=it("h3")).textContent="Controls",r=ct(),o=it("li"),x.$$.fragment.c(),a=ct(),i=it("li"),$.$$.fragment.c(),l=ct(),s=it("li"),w.$$.fragment.c(),c=ct(),u=it("section"),(d=it("h3")).textContent="Bot",p=ct(),f=it("select");for(let e=0;e<O.length;e+=1)O[e].c();v=ct(),k&&k.c(),h=ct(),I&&I.c(),m=ut(),pt(n,"class","svelte-hsd9fq"),pt(o,"class","svelte-hsd9fq"),pt(i,"class","svelte-hsd9fq"),pt(s,"class","svelte-hsd9fq"),pt(d,"class","svelte-hsd9fq"),void 0===e.selectedBot&&Nt(()=>e.select_change_handler.call(f)),y=[dt(f,"change",e.select_change_handler),dt(f,"change",e.ChangeBot)]},m(y,b){rt(y,t,b),nt(t,n),nt(t,r),nt(t,o),Wt(x,o,null),nt(t,a),nt(t,i),Wt($,i,null),nt(t,l),nt(t,s),Wt(w,s,null),rt(y,c,b),rt(y,u,b),nt(u,d),nt(u,p),nt(u,f);for(let e=0;e<O.length;e+=1)O[e].m(f,null);ht(f,e.selectedBot),rt(y,v,b),k&&k.m(y,b),rt(y,h,b),I&&I.m(y,b),rt(y,m,b),g=!0},p(e,t){if(e.bots){let n;for(P=Object.keys(t.bots),n=0;n<P.length;n+=1){const r=ro(t,P,n);O[n]?O[n].p(e,r):(O[n]=lo(r),O[n].c(),O[n].m(f,null))}for(;n<O.length;n+=1)O[n].d(1);O.length=P.length}e.selectedBot&&ht(f,t.selectedBot),e.bot&&(b=Object.keys(t.bot.opts()).length),b?k?(k.p(e,t),Ft(k,1)):((k=so(t)).c(),Ft(k,1),k.m(h.parentNode,h)):k&&(Rt(),Ut(k,1,1,()=>{k=null}),Kt()),t.botAction||t.iterationCounter?I?I.p(e,t):((I=co(t)).c(),I.m(m.parentNode,m)):I&&(I.d(1),I=null)},i(e){g||(Ft(x.$$.fragment,e),Ft($.$$.fragment,e),Ft(w.$$.fragment,e),Ft(k),g=!0)},o(e){Ut(x.$$.fragment,e),Ut($.$$.fragment,e),Ut(w.$$.fragment,e),Ut(k),g=!1},d(e){e&&ot(t),Yt(x),Yt($),Yt(w),e&&(ot(c),ot(u)),at(O,e),e&&ot(v),k&&k.d(e),e&&ot(h),I&&I.d(e),e&&ot(m),Ke(y)}}}function lo(e){var t,n,r=e.bot+"";return{c(){t=it("option"),n=st(r),t.__value=e.bot,t.value=t.__value},m(e,r){rt(e,t,r),nt(t,n)},p:Ge,d(e){e&&ot(t)}}}function so(e){var t,n,r,o,a,i,l,s,c,u=new Qr({props:{bot:e.bot}});return{c(){t=it("section"),(n=it("h3")).textContent="Options",r=ct(),(o=it("label")).textContent="debug",a=ct(),i=it("input"),l=ct(),u.$$.fragment.c(),pt(n,"class","svelte-hsd9fq"),pt(o,"class","svelte-hsd9fq"),pt(i,"type","checkbox"),pt(i,"class","svelte-hsd9fq"),c=[dt(i,"change",e.input_change_handler),dt(i,"change",e.OnDebug)]},m(c,d){rt(c,t,d),nt(t,n),nt(t,r),nt(t,o),nt(t,a),nt(t,i),i.checked=e.debug,nt(t,l),Wt(u,t,null),s=!0},p(e,t){e.debug&&(i.checked=t.debug);var n={};e.bot&&(n.bot=t.bot),u.$set(n)},i(e){s||(Ft(u.$$.fragment,e),s=!0)},o(e){Ut(u.$$.fragment,e),s=!1},d(e){e&&ot(t),Yt(u),Ke(c)}}}function co(e){var t,n,r,o,a=e.progress&&e.progress<1&&uo(e),i=e.botAction&&po(e);return{c(){t=it("section"),(n=it("h3")).textContent="Result",r=ct(),a&&a.c(),o=ct(),i&&i.c(),pt(n,"class","svelte-hsd9fq")},m(e,l){rt(e,t,l),nt(t,n),nt(t,r),a&&a.m(t,null),nt(t,o),i&&i.m(t,null)},p(e,n){n.progress&&n.progress<1?a?a.p(e,n):((a=uo(n)).c(),a.m(t,o)):a&&(a.d(1),a=null),n.botAction?i?i.p(e,n):((i=po(n)).c(),i.m(t,null)):i&&(i.d(1),i=null)},d(e){e&&ot(t),a&&a.d(),i&&i.d()}}}function uo(e){var t;return{c(){(t=it("progress")).value=e.progress},m(e,n){rt(e,t,n)},p(e,n){e.progress&&(t.value=n.progress)},d(e){e&&ot(t)}}}function po(e){var t,n,r,o,a,i,l,s=JSON.stringify(e.botActionArgs)+"";return{c(){t=it("li"),n=st("Action: "),r=st(e.botAction),o=ct(),a=it("li"),i=st("Args: "),l=st(s),pt(t,"class","svelte-hsd9fq"),pt(a,"class","svelte-hsd9fq")},m(e,s){rt(e,t,s),nt(t,n),nt(t,r),rt(e,o,s),rt(e,a,s),nt(a,i),nt(a,l)},p(e,t){e.botAction&&ft(r,t.botAction),e.botActionArgs&&s!==(s=JSON.stringify(t.botActionArgs)+"")&&ft(l,s)},d(e){e&&(ot(t),ot(o),ot(a))}}}function fo(e){var t,n,r,o,a,i=[io,ao,oo],l=[];function s(e,t){return t.client.game.ai&&!t.client.multiplayer?0:t.client.multiplayer?1:2}return n=s(0,e),r=l[n]=i[n](e),{c(){t=it("section"),r.c(),a=dt(window,"keydown",e.OnKeyDown)},m(e,r){rt(e,t,r),l[n].m(t,null),o=!0},p(e,o){var a=n;(n=s(0,o))===a?l[n].p(e,o):(Rt(),Ut(l[a],1,1,()=>{l[a]=null}),Kt(),(r=l[n])||(r=l[n]=i[n](o)).c(),Ft(r,1),r.m(t,null))},i(e){o||(Ft(r),o=!0)},o(e){Ut(r),o=!1},d(e){e&&ot(t),l[n].d(),a()}}}function vo(e,t,n){let{client:r}=t;const{secondaryPane:o}=Et("secondaryPane"),a={MCTS:eo,Random:to};let i=!1,l=null,s=0,c=null;const u=({iterationCounter:e,numIterations:t,metadata:r})=>{n("iterationCounter",s=e),n("progress",l=e/t),c=r,i&&c&&o.set({component:Sr,metadata:c})};let d,p,f,v;function h(){r.overrideGameState(null),o.set(null),n("debug",i=!1)}return r.game.ai&&(n("bot",d=new eo({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),d.setOpt("async",!0)),kt(h),e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,bots:a,debug:i,progress:l,iterationCounter:s,OnDebug:function(){i&&c?o.set({component:Sr,metadata:c}):o.set(null)},bot:d,selectedBot:p,botAction:f,botActionArgs:v,ChangeBot:function(){n("bot",d=new(0,a[p])({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),d.setOpt("async",!0),n("botAction",f=null),c=null,o.set(null),n("iterationCounter",s=0)},Step:async function(){n("botAction",f=null),c=null,n("iterationCounter",s=0);const e=await no(r,d);e&&(n("botAction",f=e.payload.type),n("botActionArgs",v=e.payload.args))},Simulate:function(e=1e4,t=100){return n("botAction",f=null),c=null,n("iterationCounter",s=0),(async()=>{for(let n=0;n<e;n++){if(!await no(r,d))break;await new Promise(e=>setTimeout(e,t))}})()},Reset:function(){r.reset(),n("botAction",f=null),c=null,n("iterationCounter",s=0),h()},OnKeyDown:function(e){27==e.keyCode&&h()},select_change_handler:function(){p=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n("selectedBot",p),n("bots",a)},input_change_handler:function(){i=this.checked,n("debug",i)}}}class ho extends Zt{constructor(e){var t;super(),document.getElementById("svelte-hsd9fq-style")||((t=it("style")).id="svelte-hsd9fq-style",t.textContent="li.svelte-hsd9fq{list-style:none;margin:none;margin-bottom:5px}h3.svelte-hsd9fq{text-transform:uppercase}label.svelte-hsd9fq{font-weight:bold;color:#999}input[type='checkbox'].svelte-hsd9fq{vertical-align:middle}",nt(document.head,t)),Xt(this,e,vo,fo,Ue,["client"])}}function mo(e){var t,n,r,o,a,i,l=new cn({props:{panes:e.panes,pane:e.pane}});l.$on("change",e.MenuChange);var s=e.panes[e.pane].component;function c(e){return{props:{client:e.client}}}if(s)var u=new s(c(e));var d=e.$secondaryPane&&go(e);return{c(){t=it("div"),l.$$.fragment.c(),n=ct(),r=it("div"),u&&u.$$.fragment.c(),o=ct(),d&&d.c(),pt(r,"class","pane svelte-1h5kecx"),pt(t,"class","debug-panel svelte-1h5kecx")},m(e,a){rt(e,t,a),Wt(l,t,null),nt(t,n),nt(t,r),u&&Wt(u,r,null),nt(t,o),d&&d.m(t,null),i=!0},p(e,n){var o={};e.pane&&(o.pane=n.pane),l.$set(o);var a={};if(e.client&&(a.client=n.client),s!==(s=n.panes[n.pane].component)){if(u){Rt();const e=u;Ut(e.$$.fragment,1,0,()=>{Yt(e,1)}),Kt()}s?((u=new s(c(n))).$$.fragment.c(),Ft(u.$$.fragment,1),Wt(u,r,null)):u=null}else s&&u.$set(a);n.$secondaryPane?d?(d.p(e,n),Ft(d,1)):((d=go(n)).c(),Ft(d,1),d.m(t,null)):d&&(Rt(),Ut(d,1,1,()=>{d=null}),Kt())},i(e){i||(Ft(l.$$.fragment,e),u&&Ft(u.$$.fragment,e),Ft(d),Nt(()=>{a||(a=Jt(t,rn,{x:400},!0)),a.run(1)}),i=!0)},o(e){Ut(l.$$.fragment,e),u&&Ut(u.$$.fragment,e),Ut(d),a||(a=Jt(t,rn,{x:400},!1)),a.run(0),i=!1},d(e){e&&ot(t),Yt(l),u&&Yt(u),d&&d.d(),e&&a&&a.end()}}}function go(e){var t,n,r=e.$secondaryPane.component;function o(e){return{props:{metadata:e.$secondaryPane.metadata}}}if(r)var a=new r(o(e));return{c(){t=it("div"),a&&a.$$.fragment.c(),pt(t,"class","secondary-pane svelte-1h5kecx")},m(e,r){rt(e,t,r),a&&Wt(a,t,null),n=!0},p(e,n){var i={};if(e.$secondaryPane&&(i.metadata=n.$secondaryPane.metadata),r!==(r=n.$secondaryPane.component)){if(a){Rt();const e=a;Ut(e.$$.fragment,1,0,()=>{Yt(e,1)}),Kt()}r?((a=new r(o(n))).$$.fragment.c(),Ft(a.$$.fragment,1),Wt(a,t,null)):a=null}else r&&a.$set(i)},i(e){n||(a&&Ft(a.$$.fragment,e),n=!0)},o(e){a&&Ut(a.$$.fragment,e),n=!1},d(e){e&&ot(t),a&&Yt(a)}}}function yo(e){var t,n,r,o=e.visible&&mo(e);return{c(){o&&o.c(),t=ut(),r=dt(window,"keypress",e.Keypress)},m(e,r){o&&o.m(e,r),rt(e,t,r),n=!0},p(e,n){n.visible?o?(o.p(e,n),Ft(o,1)):((o=mo(n)).c(),Ft(o,1),o.m(t.parentNode,t)):o&&(Rt(),Ut(o,1,1,()=>{o=null}),Kt())},i(e){n||(Ft(o),n=!0)},o(e){Ut(o),n=!1},d(e){o&&o.d(e),e&&ot(t),r()}}}function bo(e,t,n){let r,{client:o}=t;const a={main:{label:"Main",shortcut:"m",component:Tn},log:{label:"Log",shortcut:"l",component:Kr},info:{label:"Info",shortcut:"i",component:Hn},ai:{label:"AI",shortcut:"a",component:ho}},i=tn(!1),l=tn(null);Ve(e,l,e=>{r=e,n("$secondaryPane",r)}),_t("hotkeys",{disableHotkeys:i}),_t("secondaryPane",{secondaryPane:l});let s="main";let c=!0;return e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,panes:a,secondaryPane:l,pane:s,MenuChange:function(e){n("pane",s=e.detail)},visible:c,Keypress:function(e){"."!=e.key?c&&Object.entries(a).forEach(([t,{shortcut:r}])=>{e.key==r&&n("pane",s=t)}):n("visible",c=!c)},$secondaryPane:r}}class xo extends Zt{constructor(e){var t;super(),document.getElementById("svelte-1h5kecx-style")||((t=it("style")).id="svelte-1h5kecx-style",t.textContent=".debug-panel.svelte-1h5kecx{position:fixed;color:#555;font-family:monospace;display:flex;flex-direction:row;text-align:left;right:0;top:0;height:100%;font-size:14px;box-sizing:border-box;opacity:0.9}.pane.svelte-1h5kecx{flex-grow:2;overflow-x:hidden;overflow-y:scroll;background:#fefefe;padding:20px;border-left:1px solid #ccc;box-shadow:-1px 0 5px rgba(0, 0, 0, 0.2);box-sizing:border-box;width:280px}.secondary-pane.svelte-1h5kecx{background:#fefefe;overflow-y:scroll}.debug-panel.svelte-1h5kecx button, select{cursor:pointer;outline:none;background:#eee;border:1px solid #bbb;color:#555;padding:3px;border-radius:3px}.debug-panel.svelte-1h5kecx button{padding-left:10px;padding-right:10px}.debug-panel.svelte-1h5kecx button:hover{background:#ddd}.debug-panel.svelte-1h5kecx button:active{background:#888;color:#fff}.debug-panel.svelte-1h5kecx section{margin-bottom:20px}",nt(document.head,t)),Xt(this,e,bo,yo,Ue,["client"])}}function $o({game:e,numPlayers:t,setupData:n}){t||(t=2);let r={G:{},ctx:(e=Be(e)).flow.ctx(t),plugins:{}};r=((e,t)=>([...we,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(n=>{const r=n.name,o=n.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[r]:{data:o}}}}),e))(r,{game:e}),r=ke(r,{game:e,playerID:void 0});const o=Pe(r);r.G=e.setup(o,n);let a={...r,_undo:[],_redo:[],_stateID:0};return a=e.flow.init(a),a=Ie(a,{game:e}),a}function wo(e,t,n,r,o,a){return t.reduce((function(t,i){return t[i]=function(){var t=r;if(!a&&null==r){var l=n.getState();t=l.ctx.currentPlayer}for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];n.dispatch(D[e](i,c,t,o))},t}),{})}var Po=wo.bind(null,"makeMove"),Oo=wo.bind(null,"gameEvent"),ko=wo.bind(null,"plugin"),Io=function(){function e(t){var r=this,o=t.game,a=t.debug,i=t.numPlayers,l=t.multiplayer,c=t.gameID,u=t.playerID,d=t.credentials,p=t.enhancer;n(this,e),this.game=Be(o),this.playerID=u,this.gameID=c,this.credentials=d,this.multiplayer=l,this.debug=a,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=Xr({game:this.game,isClient:void 0!==l,numPlayers:i}),this.initialState=null,l||(this.initialState=$o({game:this.game,numPlayers:i})),this.reset=function(){r.store.dispatch(P(r.initialState))},this.undo=function(){r.store.dispatch(O(u,d))},this.redo=function(){r.store.dispatch(k(u,d))},this.store=null,this.log=[];var v=function(e){return function(t){return function(n){var o=t(n),a=e.getState();switch(n.type){case"MAKE_MOVE":case"GAME_EVENT":var i=a.deltalog;r.log=[].concat(s(r.log),s(i));break;case"RESET":r.log=[];break;case"UPDATE":var l=-1;r.log.length>0&&(l=r.log[r.log.length-1]._stateID);var c=n.deltalog||[];c=c.filter((function(e){return e._stateID>l})),r.log=[].concat(s(r.log),s(c));break;case"SYNC":r.initialState=n.initialState,r.log=n.log||[]}return o}}},h=function(e){return function(t){return function(n){var o=e.getState(),a=t(n);return 1!=n.clientOnly&&r.transport.onAction(o,n),a}}},m=function(){return function(e){return function(t){var n=e(t);return r.notifySubscribers(),n}}};p=void 0!==p?g(y(m,h,v),p):y(m,h,v),this.store=f(this.reducer,this.initialState,p),this.transport={isConnected:!0,onAction:function(){},subscribe:function(){},subscribeGameMetadata:function(e){},connect:function(){},disconnect:function(){},updateGameID:function(){},updatePlayerID:function(){}},l&&(this.transport=l({gameKey:o,game:this.game,store:this.store,gameID:c,playerID:u,gameName:this.game.name,numPlayers:i})),this.createDispatchers(),this.transport.subscribeGameMetadata((function(e){r.gameMetadata=e})),this._debugPanel=null}return o(e,[{key:"notifySubscribers",value:function(){var e=this;Object.values(this.subscribers).forEach((function(t){return t(e.getState())}))}},{key:"overrideGameState",value:function(e){this.gameStateOverride=e,this.notifySubscribers()}},{key:"start",value:function(){this.transport.connect(),this._running=!0;var e=null;if(e=xo,this.debug&&this.debug.impl&&(e=this.debug.impl),null!==e&&!1!==this.debug&&null==this._debugPanel&&"undefined"!=typeof document){var t=document.body;this.debug&&void 0!==this.debug.target&&(t=this.debug.target),t&&(this._debugPanel=new e({target:t,props:{client:this}}))}}},{key:"stop",value:function(){this.transport.disconnect(),this._running=!1,null!=this._debugPanel&&(this._debugPanel.$destroy(),this._debugPanel=null)}},{key:"subscribe",value:function(e){var t=this,n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribe((function(){return t.notifySubscribers()})),!this._running&&this.multiplayer||e(this.getState()),function(){delete t.subscribers[n]}}},{key:"getInitialState",value:function(){return this.initialState}},{key:"getState",value:function(){var e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;var t=!0,n=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);var r=l({},e,{isActive:t,G:this.game.playerView(e.G,e.ctx,this.playerID),log:this.log});return r=l({},r,{isConnected:this.transport.isConnected})}},{key:"createDispatchers",value:function(){this.moves=Po(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=Oo(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=ko(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}},{key:"updatePlayerID",value:function(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}},{key:"updateGameID",value:function(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e),this.notifySubscribers()}},{key:"updateCredentials",value:function(e){this.credentials=e,this.createDispatchers(),this.notifySubscribers()}}]),e}();e.Client=function(e){return new Io(e)},Object.defineProperty(e,"__esModule",{value:!0})}));
