!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).BoardgameIO={},e.React)}(this,(function(e,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(n,!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t=t&&t.hasOwnProperty("default")?t.default:t;var y=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),v=function(){return Math.random().toString(36).substring(7).split("").join(".")},m={INIT:"@@redux/INIT"+v(),REPLACE:"@@redux/REPLACE"+v(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+v()}};function g(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function b(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(b)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,i=t,a=[],s=a,c=!1;function l(){s===a&&(s=a.slice())}function u(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function p(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return l(),s.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,l();var n=s.indexOf(e);s.splice(n,1)}}}function f(e){if(!g(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=o(i,e)}finally{c=!1}for(var t=a=s,n=0;n<t.length;n++){(0,t[n])()}return e}function d(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,f({type:m.REPLACE})}function h(){var e,t=p;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[y]=function(){return this},e}return f({type:m.INIT}),(r={dispatch:f,subscribe:p,getState:u,replaceReducer:d})[y]=h,r}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function P(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return k({},n,{dispatch:r=$.apply(void 0,i)(n.dispatch)})}}}const C=(e,t,n,r)=>({type:"MAKE_MOVE",payload:{type:e,args:t,playerID:n,credentials:r}}),O=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r}}),I=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}),D=e=>({type:"SYNC",state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),E=(e,t)=>({type:"UPDATE",state:e,deltalog:t,clientOnly:!0}),A=e=>({type:"RESET",state:e,clientOnly:!0}),S=()=>({type:"UNDO"}),_=()=>({type:"REDO"});var j,B,N,M=Object.freeze({makeMove:C,gameEvent:O,automaticGameEvent:I,sync:D,update:E,reset:A,undo:S,redo:_,plugin:(e,t,n,r)=>({type:"PLUGIN",payload:{type:e,args:t,playerID:n,credentials:r}})}),T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),q="undefined"!=typeof Symbol?Symbol("immer-nothing"):(N=!0,(B="immer-nothing")in(j={})?Object.defineProperty(j,B,{value:N,enumerable:!0,configurable:!0,writable:!0}):j[B]=N,j),z="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",F="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function L(e){return!!e&&!!e[F]}function U(e){if(!e||"object"!==(void 0===e?"undefined":T(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[z]||!!e.constructor[z])}var G=Object.assign||function(e,t){for(var n in t)J(t,n)&&(e[n]=t[n]);return e},H="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function K(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return H(e).forEach((function(r){if(r!==F){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}})),n}function V(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else H(e).forEach((function(n){return t(n,e[n],e)}))}function W(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Y(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var X={},Q=[],Z=function(){return Q[Q.length-1]};function ee(e,t){var n=Array.isArray(e),r=ie(e);V(r,(function(t){!function(e,t,n){var r=X[t];r?r.enumerable=n:X[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){ae(e);var n=ne(e)[t];if(!e.finalizing&&n===e.base[t]&&U(n))return oe(e),e.copy[t]=ee(n,e);return n}(this[F],t)},set:function(e){!function(e,t,n){if(ae(e),e.assigned[t]=!0,!e.modified){if(Y(ne(e)[t],n))return;re(e),oe(e)}e.copy[t]=n}(this[F],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||W(e,t))}));var o={scope:t?t.scope:Z(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:te,revoked:!1};return function(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0})}(r,F,o),o.scope.push(o),r}function te(){this.revoked=!0}function ne(e){return e.copy||e.base}function re(e){e.modified||(e.modified=!0,e.parent&&re(e.parent))}function oe(e){e.copy||(e.copy=ie(e.base))}function ie(e){var t=e&&e[F];if(t){t.finalizing=!0;var n=K(t.draft,!0);return t.finalizing=!1,n}return K(e)}function ae(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(ne(e)))}function se(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!J(t,r[o]))return!0;return r.length!==Object.keys(t).length}function ce(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var le=Object.freeze({scopes:Q,currentScope:Z,willFinalize:function(e,t,n){var r=Z();r.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(n&&function e(t){if(!t||"object"!==(void 0===t?"undefined":T(t)))return;var n=t[F];if(!n)return;var r=n.base,o=n.draft,i=n.assigned;if(Array.isArray(t)){if(ce(n)){if(re(n),i.length=!0,o.length<r.length)for(var a=o.length;a<r.length;a++)i[a]=!1;else for(var s=r.length;s<o.length;s++)i[s]=!0;for(var c=0;c<o.length;c++)void 0===i[c]&&e(o[c])}}else Object.keys(o).forEach((function(t){void 0!==r[t]||J(r,t)?i[t]||e(o[t]):(i[t]=!0,re(n))})),Object.keys(r).forEach((function(e){void 0!==o[e]||J(o,e)||(i[e]=!1,re(n))}))}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?ce(n)&&re(n):se(n)&&re(n))}}(r))},createDraft:ee}),ue=[],pe=function(){return ue[ue.length-1]};function fe(e,t){var n={scope:t?t.scope:pe(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],he):Proxy.revocable(n,de),o=r.revoke,i=r.proxy;return n.draft=i,n.revoke=o,n.scope.push(n),i}var de={get:function(e,t){if(t===F)return e;var n=e.drafts;if(!e.modified&&J(n,t))return n[t];var r=ye(e)[t];if(e.finalized||!U(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=fe(r,e)},has:function(e,t){return t in ye(e)},ownKeys:function(e){return Reflect.ownKeys(ye(e))},set:function(e,t,n){if(!e.modified){if(n?Y(e.base[t],n)||n===e.drafts[t]:Y(e.base[t],n)&&t in e.base)return!0;ve(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,ve(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=ye(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},he={};function ye(e){return e.copy||e.base}function ve(e){e.modified||(e.modified=!0,e.copy=G(K(e.base),e.drafts),e.drafts=null,e.parent&&ve(e.parent))}V(de,(function(e,t){he[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),he.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return de.deleteProperty.call(this,e[0],t)},he.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return de.set.call(this,e[0],t,n)};var me=Object.freeze({scopes:ue,currentScope:pe,willFinalize:function(){},createDraft:fe});function ge(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,i=e.copy,a=e.assigned,s=Math.min(o.length,i.length),c=0;c<s;c++)if(a[c]&&o[c]!==i[c]){var l=t.concat(c);n.push({op:"replace",path:l,value:i[c]}),r.push({op:"replace",path:l,value:o[c]})}if(s<i.length){for(var u=s;u<i.length;u++)n.push({op:"add",path:t.concat(u),value:i[u]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(s<o.length){n.push({op:"replace",path:t.concat("length"),value:i.length});for(var p=s;p<o.length;p++)r.push({op:"add",path:t.concat(p),value:o[p]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,i=e.copy;V(e.assigned,(function(e,a){var s=o[e],c=i[e],l=a?e in o?"replace":"add":"remove";if(s!==c||"replace"!==l){var u=t.concat(e);n.push("remove"===l?{op:l,path:u}:{op:l,path:u,value:c}),r.push("add"===l?{op:"remove",path:u}:"remove"===l?{op:"add",path:u,value:s}:{op:"replace",path:u,value:s})}}))}(e,t,n,r)}function be(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var i=e,a=0;a<o.length-1;a++)if(!(i=i[o[a]])||"object"!==(void 0===i?"undefined":T(i)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var s=o[o.length-1];switch(r.op){case"replace":case"add":i[s]=r.value;break;case"remove":if(Array.isArray(i)){if(s!==i.length-1)throw new Error("Only the last index of an array can be removed, index: "+s+", length: "+i.length);i.length-=1}else delete i[s];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var we={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},xe=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G(this,we,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return R(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(a,(function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var i=void 0;if(U(e)){this.scopes.push([]);var a=this.createDraft(e);try{i=t.call(a,a),this.willFinalize(i,a,!!n);var s=n&&[],c=n&&[];if(void 0===i||i===a)i=this.finalize(a,[],s,c);else{if(a[F].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");U(i)&&(i=this.finalize(i)),n&&(s.push({op:"replace",path:[],value:i}),c.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}n&&n(s,c)}else if(void 0===(i=t(e)))return e;return i===q?void 0:i}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,G(this,e?me:le)}},{key:"applyPatches",value:function(e,t){return L(e)?be(e,t):this.produce(e,(function(e){return be(e,t)}))}},{key:"finalize",value:function(e,t,n,r){var o=this,i=e[F];if(!i)return Object.isFrozen(e)?e:this.finalizeTree(e);if(i.scope!==this.currentScope())return e;if(!i.modified)return i.base;if(!i.finalized){if(i.finalized=!0,this.finalizeTree(i.draft,t,n,r),this.onDelete)if(this.useProxies){var a=i.assigned;for(var s in a)a[s]||this.onDelete(i,s)}else{var c=i.base,l=i.copy;V(c,(function(e){J(l,e)||o.onDelete(i,e)}))}this.onCopy&&this.onCopy(i),this.autoFreeze&&1===this.scopes.length&&Object.freeze(i.copy),n&&ge(i,t,n,r)}return i.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,i=e[F];i&&(this.useProxies||(i.finalizing=!0,i.copy=K(i.draft,!0),i.finalizing=!1),e=i.copy);var a=this.onAssign;return V(e,(function s(c,l,u){if(l===u)throw Error("Immer forbids circular references");var p=!!i&&u===e;if(L(l)){if(l=n&&p&&!i.assigned[c]?o.finalize(l,t.concat(c),n,r):o.finalize(l),Array.isArray(u)||W(u,c)?u[c]=l:Object.defineProperty(u,c,{value:l}),p&&l===i.base[c])return}else{if(p&&Y(l,i.base[c]))return;U(l)&&!Object.isFrozen(l)&&V(l,s)}p&&a&&a(i,c,l)})),e}}]),e}()),ke=xe.produce,$e=(xe.setAutoFreeze.bind(xe),xe.setUseProxies.bind(xe),xe.applyPatches.bind(xe),{name:"plugin-immer",fnWrap:function(e){return ke(e)}});function Pe(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function Ce(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function Oe(e,t){var r=new Pe(e),o=t&&t.state,i=r.next;return i.quick=i,o&&("object"==n(o)&&Ce(o,r),i.state=function(){return Ce(r,{})}),i}var Ie=function(){function e(t){r(this,e),this.state=t,this.used=!1}return i(e,[{key:"isUsed",value:function(){return this.used}},{key:"getState",value:function(){return this.state}},{key:"_random",value:function(){this.used=!0;var e,t=this.state,n=(e=void 0===t.prngstate?new Oe(t.seed,{state:!0}):new Oe("",{state:t.prngstate}))();return this.state=c({},t,{prngstate:e.state()}),n}},{key:"api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:h(new Array(t).keys()).map((function(){return Math.floor(e()*o)+1}))}};for(var o in t)r(o);return c({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:h(new Array(n).keys()).map((function(){return Math.floor(e()*t)+1}))},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,i=new Array(r);r;){var a=r*e()|0;i[o++]=n[a],n[a]=n[--r]}return i},_obj:this})}}]),e}();Ie.seed=function(){return(+new Date).toString(36).slice(-10)};var De={name:"random",noClient:({api:e})=>e._obj.isUsed(),flush:({api:e})=>e._obj.getState(),api:({data:e})=>new Ie(e).api(),setup:({game:e})=>{let t=e.seed;return void 0===t&&(t=Ie.seed()),{seed:t}}},Ee=function(){function e(t,n){r(this,e),this.flow=t,this.playerID=n,this.dispatch=[]}return i(e,[{key:"api",value:function(e){var t=this,n={},r=e.phase,o=e.turn,i=!0,a=!1,s=void 0;try{for(var c,l=function(){var e=c.value;n[e]=function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];t.dispatch.push({key:e,args:i,phase:r,turn:o})}},u=this.flow.eventNames[Symbol.iterator]();!(i=(c=u.next()).done);i=!0)l()}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return n._obj=this,n}},{key:"isUsed",value:function(){return this.dispatch.length>0}},{key:"update",value:function(e){for(var t=0;t<this.dispatch.length;t++){var n=this.dispatch[t];if(("endTurn"!==n.key||n.turn===e.ctx.turn)&&("endPhase"!==n.key&&"setPhase"!==n.key||n.phase===e.ctx.phase)){var r=I(n.key,n.args,this.playerID);e=c({},e,{},this.flow.processEvent(e,r))}}return e}}]),e}();const Ae=[$e,De,{name:"events",noClient:({api:e})=>e._obj.isUsed(),flushRaw:({state:e,api:t})=>t._obj.update(e),api:({game:e,playerID:t,ctx:n})=>new Ee(e.flow,t).api(n)}],Se=e=>{let t={...e.ctx};const n=e.plugins||{};return Object.entries(n).forEach(([e,{api:n}])=>{t[e]=n}),t},_e=(e,t)=>[...Ae,...t].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:n})=>n(e,t),e),je=(e,t)=>([...Ae,...t.game.plugins].filter(e=>void 0!==e.api).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},i=n.api({G:e.G,ctx:e.ctx,data:o.data,game:t.game});e={...e,plugins:{...e.plugins,[r]:{...o,api:i}}}}),e),Be=(e,t)=>([...Ae,...t.game.plugins].forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}};if(n.flush){const r=n.flush({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data});e={...e,plugins:{...e.plugins,[n.name]:{data:r}}}}else if(n.flushRaw){const i=(e=n.flushRaw({state:e,game:t.game,api:o.api,data:o.data})).plugins[r].data;e={...e,plugins:{...e.plugins,[n.name]:{data:i}}}}}),e);var Ne=console.log,Me=console.error;function Te(e){Me("ERROR:",e)}function Re(e,t,n){return c({},e,{ctx:qe(e.ctx,n)})}function qe(e,t){var n=e._prevActivePlayers,r=t.next||null;n=t.revert?n.concat({activePlayers:e.activePlayers,_activePlayersMoveLimit:e._activePlayersMoveLimit,_activePlayersNumMoves:e._activePlayersNumMoves}):[];var o={},i={};if(Array.isArray(t)){var a={};t.forEach((function(e){return a[e]=Ue.NULL})),o=a}if(void 0!==t.currentPlayer&&ze(o,i,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(var s=0;s<e.playOrder.length;s++){var l=e.playOrder[s];l!==e.currentPlayer&&ze(o,i,l,t.others)}if(void 0!==t.all)for(var u=0;u<e.playOrder.length;u++){ze(o,i,e.playOrder[u],t.all)}if(t.value)for(var p in t.value)ze(o,i,p,t.value[p]);if(t.moveLimit)for(var f in o)void 0===i[f]&&(i[f]=t.moveLimit);0==Object.keys(o).length&&(o=null),0==Object.keys(i).length&&(i=null);var d={};for(var h in o)d[h]=0;return c({},e,{activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:d,_prevActivePlayers:n,_nextActivePlayers:r})}function ze(e,t,r,o){"object"===n(o)&&o!==Ue.NULL||(o={stage:o}),void 0!==o.stage&&(e[r]=o.stage,o.moveLimit&&(t[r]=o.moveLimit))}function Fe(e,t){return e[t]+""}var Le={DEFAULT:{first:function(e,t){return 0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}},RESET:{first:function(){return 0},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}},CONTINUE:{first:function(e,t){return t.playOrderPos},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}},ONCE:{first:function(){return 0},next:function(e,t){if(t.playOrderPos<t.playOrder.length-1)return t.playOrderPos+1}},CUSTOM:function(e){return{playOrder:function(){return e},first:function(){return 0},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}}},CUSTOM_FROM:function(e){return{playOrder:function(t){return t[e]},first:function(){return 0},next:function(e,t){return(t.playOrderPos+1)%t.playOrder.length}}}},Ue={NULL:null};function Ge({moves:e,phases:t,endIf:r,onEnd:o,turn:i,events:a,plugins:s}){void 0===e&&(e={}),void 0===a&&(a={}),void 0===s&&(s=[]),void 0===t&&(t={}),r||(r=()=>{}),o||(o=e=>e),i||(i={});const l={...t};""in l&&Te("cannot specify phase with empty name"),l[""]={};let u={},p=new Set,f=null;Object.keys(e).forEach(e=>p.add(e));const d=e=>{const t=_e(e,s);return e=>{const n=Se(e);return t(e.G,n)}},y=e=>t=>{let n=Se(t);return e(t.G,n)},v={onEnd:d(o),endIf:y(r)};for(let e in l){const t=l[e];if(!0===t.start&&(f=e),void 0!==t.moves)for(let n of Object.keys(t.moves))u[e+"."+n]=t.moves[n],p.add(n);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=e=>e),void 0===t.onEnd&&(t.onEnd=e=>e),void 0===t.turn&&(t.turn=i),void 0===t.turn.order&&(t.turn.order=Le.DEFAULT),void 0===t.turn.onBegin&&(t.turn.onBegin=e=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=e=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=e=>e),void 0===t.turn.stages&&(t.turn.stages={});for(const n in t.turn.stages){const r=t.turn.stages[n].moves||{};for(let t of Object.keys(r)){u[e+"."+n+"."+t]=r[t],p.add(t)}}t.wrapped={onBegin:d(t.onBegin),onEnd:d(t.onEnd),endIf:y(t.endIf)},t.turn.wrapped={onMove:d(t.turn.onMove),onBegin:d(t.turn.onBegin),onEnd:d(t.turn.onEnd),endIf:y(t.turn.endIf)}}function m(e){return e.phase?l[e.phase]:l[""]}function g(e){return e}function b(e,t){const n=new Set,r=new Set;for(let o=0;o<t.length;o++){const{fn:i,arg:a,...s}=t[o];if(i===S){r.clear();const t=e.ctx.phase;if(n.has(t)){const t={...e.ctx,phase:null};return{...e,ctx:t}}n.add(t)}let c=[];if(e=i(e,{...s,arg:a,next:c}),i===A)break;const l=I(e);if(l){t.push({fn:A,arg:l,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}const u=D(e);if(u)t.push({fn:S,arg:u,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});else{if(i===g){const n=E(e);if(n){t.push({fn:_,arg:n,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...c)}}return e}function w(e,{next:t}){return t.push({fn:x}),e}function x(e,{next:t}){let{G:n,ctx:r}=e;return n=m(r).wrapped.onBegin(e),t.push({fn:k}),{...e,G:n,ctx:r}}function k(e,{currentPlayer:t}){let{G:n,ctx:r}=e;const o=m(r);t?(r={...r,currentPlayer:t},o.turn.activePlayers&&(r=qe(r,o.turn.activePlayers))):r=function(e,t,n){var r=n.order,o=h(new Array(t.numPlayers)).map((function(e,t){return t+""}));void 0!==r.playOrder&&(o=r.playOrder(e,t));var i=r.first(e,t);return t=qe(t=c({},t,{currentPlayer:Fe(o,i),playOrderPos:i,playOrder:o}),n.activePlayers||{})}(n,r,o.turn);const i=r.turn+1;r={...r,turn:i,numMoves:0,_prevActivePlayers:[]},n=o.turn.wrapped.onBegin({...e,G:n,ctx:r});const a=[{G:n,ctx:r}];return{...e,G:n,ctx:r,_undo:a,_redo:[]}}function $(e,{arg:t,next:n,phase:r}){const o=m({phase:r});let{ctx:i}=e;if(t&&t.next){if(!(t.next in l))return Te("invalid phase: "+t.next),e;i={...i,phase:t.next}}else i=void 0!==o.next?{...i,phase:o.next}:{...i,phase:null};return e={...e,ctx:i},n.push({fn:x}),e}function P(e,{arg:t,currentPlayer:r,next:o}){let{G:i,ctx:a}=e;const s=m(a),{endPhase:l,ctx:u}=function(e,t,r,o){var i=r.order,a=t.playOrderPos,s=t.currentPlayer,l=!1;if(o&&!0!==o)"object"!==n(o)&&Te("invalid argument to endTurn: ".concat(o)),Object.keys(o).forEach((function(e){switch(e){case"remove":s=Fe(t.playOrder,a);break;case"next":a=t.playOrder.indexOf(o.next),s=o.next;break;default:Te("invalid argument to endTurn: ".concat(e))}}));else{var u=i.next(e,t);void 0===u?l=!0:(a=u,s=Fe(t.playOrder,a))}return{endPhase:l,ctx:t=c({},t,{playOrderPos:a,currentPlayer:s})}}(i,{...a,currentPlayer:r},s.turn,t);return a=u,e={...e,G:i,ctx:a},l?o.push({fn:S,turn:a.turn,phase:a.phase}):o.push({fn:k,currentPlayer:a.currentPlayer}),e}function C(e,{arg:t,playerID:n}){"string"==typeof t&&(t={stage:t});let{ctx:r}=e,{activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:a}=r;return t.stage&&(null===o&&(o={}),o[n]=t.stage,a[n]=0,t.moveLimit&&(null===i&&(i={}),i[n]=t.moveLimit)),r={...r,activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:a},{...e,ctx:r}}function I(e){return v.endIf(e)}function D(e){return m(e.ctx).wrapped.endIf(e)}function E(e){const t=m(e.ctx),n=e.ctx.numMoves||0;return!!(t.turn.moveLimit&&n>=t.turn.moveLimit)||t.turn.wrapped.endIf(e)}function A(e,{arg:t,phase:n}){e=S(e,{phase:n}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};const r=v.onEnd(e);return{...e,G:r}}function S(e,{arg:t,next:n,turn:r,automatic:o}){let i=(e=_(e,{turn:r,force:!0})).G,a=e.ctx;if(n&&n.push({fn:$,arg:t,phase:a.phase}),null===a.phase)return e;i=m(a).wrapped.onEnd(e),a={...a,phase:null};const s={action:O("endPhase",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};o&&(s.automatic=!0);const c=[...e.deltalog,s];return{...e,G:i,ctx:a,deltalog:c}}function _(e,{arg:t,next:n,turn:r,force:o,automatic:i,playerID:a}){if(r!==e.ctx.turn)return e;let{G:s,ctx:c}=e;const l=m(c),u=c.numMoves||0;if(!o&&l.turn.moveLimit&&u<l.turn.moveLimit)return p=`cannot end turn before making ${l.turn.moveLimit} moves`,Ne("INFO: ".concat(p)),e;var p;if(s=l.turn.wrapped.onEnd(e),n&&n.push({fn:P,arg:t,currentPlayer:c.currentPlayer}),c={...c,activePlayers:null},t&&t.remove){a=a||c.currentPlayer;const t=c.playOrder.filter(e=>e!=a),r=c.playOrderPos>t.length-1?0:c.playOrderPos;if(c={...c,playOrder:t,playOrderPos:r},0===t.length)return n.push({fn:S,turn:c.turn,phase:c.phase}),e}const f={action:O("endTurn",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};i&&(f.automatic=!0);const d=[...e.deltalog||[],f];return{...e,G:s,ctx:c,deltalog:d,_undo:[],_redo:[]}}function j(e,{arg:t,next:n,automatic:r,playerID:o}){o=o||e.ctx.currentPlayer;let{ctx:i}=e,{activePlayers:a,_activePlayersMoveLimit:s}=i;const l=null!==a&&o in a;if(!t&&l){const e=m(i).turn.stages[a[o]];e&&e.next&&(t=e.next)}if(n&&t&&n.push({fn:C,arg:t,playerID:o}),!l)return e;a=Object.keys(a).filter(e=>e!==o).reduce((e,t)=>(e[t]=a[t],e),{}),s&&(s=Object.keys(s).filter(e=>e!==o).reduce((e,t)=>(e[t]=s[t],e),{})),i=function(e){var t=e,n=t.activePlayers,r=t._activePlayersMoveLimit,o=t._activePlayersNumMoves,i=t._prevActivePlayers;if(n&&0==Object.keys(n).length)if(e._nextActivePlayers){var a=e=qe(e,e._nextActivePlayers);n=a.activePlayers,r=a._activePlayersMoveLimit,o=a._activePlayersNumMoves,i=a._prevActivePlayers}else if(i.length>0){var s=i.length-1,l=i[s];n=l.activePlayers,r=l._activePlayersMoveLimit,o=l._activePlayersNumMoves,i=i.slice(0,s)}else n=null,r=null;return c({},e,{activePlayers:n,_activePlayersMoveLimit:r,_activePlayersNumMoves:o,_prevActivePlayers:i})}({...i,activePlayers:a,_activePlayersMoveLimit:s});const u={action:O("endStage",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};r&&(u.automatic=!0);const p=[...e.deltalog||[],u];return{...e,ctx:i,deltalog:p}}const B={endStage:function(e,t){return b(e,[{fn:j,playerID:t}])},setStage:function(e,t,n){return b(e,[{fn:j,arg:n,playerID:t}])},endTurn:function(e,t,n){return b(e,[{fn:_,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},pass:function(e,t,n){return b(e,[{fn:_,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:n}])},endPhase:function(e){return b(e,[{fn:S,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,n){return b(e,[{fn:S,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:n}}])},endGame:function(e,t,n){return b(e,[{fn:A,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},setActivePlayers:Re};let N=[];return!1!==a.endTurn&&N.push("endTurn"),!1!==a.pass&&N.push("pass"),!1!==a.endPhase&&N.push("endPhase"),!1!==a.setPhase&&N.push("setPhase"),!1!==a.endGame&&N.push("endGame"),!1!==a.setActivePlayers&&N.push("setActivePlayers"),!1!==a.endStage&&N.push("endStage"),!1!==a.setStage&&N.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...new Array(e)].map((e,t)=>t+""),playOrderPos:0,phase:f,activePlayers:null}),init:e=>b(e,[{fn:w}]),isPlayerActive:function(e,t,n){return t.activePlayers?n in t.activePlayers:t.currentPlayer===n},eventHandlers:B,eventNames:Object.keys(B),enabledEventNames:N,moveMap:u,moveNames:[...p.values()],processMove:function(e,t){let n=m(e.ctx),{ctx:r}=e,{_activePlayersNumMoves:o}=r;const{playerID:i}=t;r.activePlayers&&o[i]++;let a=e.ctx.numMoves;i==e.ctx.currentPlayer&&a++,e={...e,ctx:{...r,numMoves:a,_activePlayersNumMoves:o}},r._activePlayersMoveLimit&&o[i]>=r._activePlayersMoveLimit[i]&&(e=j(e,{playerID:i,automatic:!0}));const s=n.turn.wrapped.onMove(e),c=(e={...e,G:s})._undo||[],l=t.type;return b(e={...e,_undo:[...c,{G:e.G,ctx:e.ctx,moveType:l}],_redo:[]},[{fn:g}])},processEvent:function(e,t){const{type:n,playerID:r,args:o}=t.payload;if(B.hasOwnProperty(n)){const t=[e,r].concat(o);return B[n].apply({},t)}return e},getMove:function(t,n,r){const o=m(t),i=o.turn.stages,{activePlayers:a}=t;if(a&&void 0!==a[r]&&a[r]!==Ue.NULL&&void 0!==i[a[r]]&&void 0!==i[a[r]].moves){const e=i[a[r]].moves;if(n in e)return e[n]}else if(o.moves){if(n in o.moves)return o.moves[n]}else if(n in e)return e[n];return null}}}function He(e){if(function(e){return void 0!==e.processMove}(e))return e;if(void 0===e.name&&(e.name="default"),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=e=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw new Error("Plugin missing name attribute");if(e.name.includes(" "))throw new Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw new Error(e.name+": Game name must not include spaces");const t=Ge(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(n,r)=>{let o=t.getMove(n.ctx,r.type,r.playerID);var i;if((i=o)instanceof Object&&void 0!==i.move&&(o=o.move),o instanceof Function){const t=_e(o,e.plugins),i={...Se(n),playerID:r.playerID};let a=[n.G,i];return void 0!==r.args&&(a=a.concat(r.args)),t(...a)}return Te(`invalid move object: ${r.type}`),n.G}}}function Ke(){}const Ve=e=>e;function We(e,t){for(const n in t)e[n]=t[n];return e}function Je(e){return e()}function Ye(){return Object.create(null)}function Xe(e){e.forEach(Je)}function Qe(e){return"function"==typeof e}function Ze(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function et(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function tt(e,t,n){return e[1]?We({},We(t.$$scope.ctx,e[1](n?n(t):{}))):t.$$scope.ctx}function nt(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}const rt="undefined"!=typeof window;let ot=rt?()=>window.performance.now():()=>Date.now(),it=rt?e=>requestAnimationFrame(e):Ke;const at=new Set;let st,ct=!1;function lt(){at.forEach(e=>{e[0](ot())||(at.delete(e),e[1]())}),ct=at.size>0,ct&&it(lt)}function ut(e,t){e.appendChild(t)}function pt(e,t,n){e.insertBefore(t,n||null)}function ft(e){e.parentNode.removeChild(e)}function dt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function ht(e){return document.createElement(e)}function yt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function vt(e){return document.createTextNode(e)}function mt(){return vt(" ")}function gt(){return vt("")}function bt(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function wt(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function xt(e,t){t=""+t,e.data!==t&&(e.data=t)}function kt(e,t){(null!=t||e.value)&&(e.value=t)}function $t(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}}function Pt(e,t,n){e.classList[n?"add":"remove"](t)}function Ct(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}let Ot,It=0,Dt={};function Et(e,t,n,r,o,i,a,s=0){const c=16.666/r;let l="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*i(e);l+=100*e+`%{${a(r,1-r)}}\n`}const u=l+`100% {${a(n,1-n)}}\n}`,p=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${s}`;if(!Dt[p]){if(!st){const e=ht("style");document.head.appendChild(e),st=e.sheet}Dt[p]=!0,st.insertRule(`@keyframes ${p} ${u}`,st.cssRules.length)}const f=e.style.animation||"";return e.style.animation=`${f?`${f}, `:""}${p} ${r}ms linear ${o}ms 1 both`,It+=1,p}function At(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--It&&it(()=>{if(It)return;let e=st.cssRules.length;for(;e--;)st.deleteRule(e);Dt={}})}function St(e){Ot=e}function _t(){if(!Ot)throw new Error("Function called outside component initialization");return Ot}function jt(e){_t().$$.on_destroy.push(e)}function Bt(){const e=Ot;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=Ct(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}function Nt(e,t){_t().$$.context.set(e,t)}function Mt(e){return _t().$$.context.get(e)}const Tt=[],Rt=[],qt=[],zt=[],Ft=Promise.resolve();let Lt,Ut=!1;function Gt(e){qt.push(e)}function Ht(){const e=new Set;do{for(;Tt.length;){const e=Tt.shift();St(e),Kt(e.$$)}for(;Rt.length;)Rt.pop()();for(let t=0;t<qt.length;t+=1){const n=qt[t];e.has(n)||(n(),e.add(n))}qt.length=0}while(Tt.length);for(;zt.length;)zt.pop()();Ut=!1}function Kt(e){e.fragment&&(e.update(e.dirty),Xe(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(Gt))}function Vt(e,t,n){e.dispatchEvent(Ct(`${t?"intro":"outro"}${n}`))}const Wt=new Set;let Jt;function Yt(){Jt={r:0,c:[],p:Jt}}function Xt(){Jt.r||Xe(Jt.c),Jt=Jt.p}function Qt(e,t){e&&e.i&&(Wt.delete(e),e.i(t))}function Zt(e,t,n,r){if(e&&e.o){if(Wt.has(e))return;Wt.add(e),Jt.c.push(()=>{Wt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}const en={duration:0};function tn(e,t,n,r){let o=t(e,n),i=r?0:1,a=null,s=null,c=null;function l(){c&&At(e,c)}function u(e,t){const n=e.b-i;return t*=Math.abs(n),{a:i,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function p(t){const{delay:n=0,duration:r=300,easing:p=Ve,tick:f=Ke,css:d}=o||en,h={start:ot()+n,b:t};t||(h.group=Jt,Jt.r+=1),a?s=h:(d&&(l(),c=Et(e,i,t,r,n,p,d)),t&&f(0,1),a=u(h,r),Gt(()=>Vt(e,t,"start")),function(e){let t;ct||(ct=!0,it(lt)),new Promise(n=>{at.add(t=[e,n])})}(t=>{if(s&&t>s.start&&(a=u(s,r),s=null,Vt(e,a.b,"start"),d&&(l(),c=Et(e,i,a.b,a.duration,0,p,o.css))),a)if(t>=a.end)f(i=a.b,1-i),Vt(e,a.b,"end"),s||(a.b?l():--a.group.r||Xe(a.group.c)),a=null;else if(t>=a.start){const e=t-a.start;i=a.a+a.d*p(e/a.duration),f(i,1-i)}return!(!a&&!s)}))}return{run(e){Qe(o)?(Lt||(Lt=Promise.resolve(),Lt.then(()=>{Lt=null})),Lt).then(()=>{o=o(),p(e)}):p(e)},end(){l(),a=s=null}}}const nn="undefined"!=typeof window?window:global;function rn(e,t,n){const{fragment:r,on_mount:o,on_destroy:i,after_update:a}=e.$$;r.m(t,n),Gt(()=>{const t=o.map(Je).filter(Qe);i?i.push(...t):Xe(t),e.$$.on_mount=[]}),a.forEach(Gt)}function on(e,t){e.$$.fragment&&(Xe(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function an(e,t){e.$$.dirty||(Tt.push(e),Ut||(Ut=!0,Ft.then(Ht)),e.$$.dirty=Ye()),e.$$.dirty[t]=!0}function sn(e,t,n,r,o,i){const a=Ot;St(e);const s=t.props||{},c=e.$$={fragment:null,ctx:null,props:i,update:Ke,not_equal:o,bound:Ye(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:Ye(),dirty:null};let l=!1;c.ctx=n?n(e,s,(t,n,r=n)=>(c.ctx&&o(c.ctx[t],c.ctx[t]=r)&&(c.bound[t]&&c.bound[t](r),l&&an(e,t)),n)):s,c.update(),l=!0,Xe(c.before_update),c.fragment=r(c.ctx),t.target&&(t.hydrate?c.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):c.fragment.c(),t.intro&&Qt(e.$$.fragment),rn(e,t.target,t.anchor),Ht()),St(a)}class cn{$destroy(){on(this,1),this.$destroy=Ke}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const ln=[];function un(e,t=Ke){let n;const r=[];function o(t){if(Ze(e,t)&&(e=t,n)){const t=!ln.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),ln.push(n,e)}if(t){for(let e=0;e<ln.length;e+=2)ln[e][0](ln[e+1]);ln.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,a=Ke){const s=[i,a];return r.push(s),1===r.length&&(n=t(o)||Ke),i(e),()=>{const e=r.indexOf(s);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}function pn(e){const t=e-1;return t*t*t+1}function fn(e,{delay:t=0,duration:n=400,easing:r=pn,x:o=0,y:i=0,opacity:a=0}){const s=getComputedStyle(e),c=+s.opacity,l="none"===s.transform?"":s.transform,u=c*(1-a);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${l} translate(${(1-e)*o}px, ${(1-e)*i}px);\n\t\t\topacity: ${c-u*t}`}}function dn(e,t,n){const r=Object.create(e);return r.key=t[n][0],r.label=t[n][1].label,r}function hn(e){var t,n,r,o,i=e.label+"";function a(){return e.click_handler(e)}return{c(){t=ht("div"),n=vt(i),r=mt(),wt(t,"class","menu-item svelte-19bfq8g"),Pt(t,"active",e.pane==e.key),o=bt(t,"click",a)},m(e,o){pt(e,t,o),ut(t,n),ut(t,r)},p(r,o){e=o,r.panes&&i!==(i=e.label+"")&&xt(n,i),(r.pane||r.panes)&&Pt(t,"active",e.pane==e.key)},d(e){e&&ft(t),o()}}}function yn(e){var t;let n=Object.entries(e.panes).reverse(),r=[];for(let t=0;t<n.length;t+=1)r[t]=hn(dn(e,n,t));return{c(){t=ht("div");for(let e=0;e<r.length;e+=1)r[e].c();wt(t,"class","menu svelte-19bfq8g")},m(e,n){pt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.pane||e.panes){let i;for(n=Object.entries(o.panes).reverse(),i=0;i<n.length;i+=1){const a=dn(o,n,i);r[i]?r[i].p(e,a):(r[i]=hn(a),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:Ke,o:Ke,d(e){e&&ft(t),dt(r,e)}}}function vn(e,t,n){let{pane:r,panes:o}=t;const i=Bt();return e.$set=e=>{"pane"in e&&n("pane",r=e.pane),"panes"in e&&n("panes",o=e.panes)},{pane:r,panes:o,dispatch:i,click_handler:({key:e})=>i("change",e)}}class mn extends cn{constructor(e){var t;super(),document.getElementById("svelte-19bfq8g-style")||((t=ht("style")).id="svelte-19bfq8g-style",t.textContent=".menu.svelte-19bfq8g{display:flex;margin-top:-10px;flex-direction:row;border:1px solid #ccc;border-radius:5px 5px 0 0;height:25px;line-height:25px;margin-right:-500px;transform-origin:bottom right;transform:rotate(-90deg) translate(0, -500px)}.menu-item.svelte-19bfq8g{line-height:25px;cursor:pointer;background:#fefefe;color:#555;padding-left:15px;padding-right:15px;text-align:center}.menu-item.svelte-19bfq8g:last-child{border-radius:0 5px 0 0}.menu-item.svelte-19bfq8g:first-child{border-radius:5px 0 0 0}.menu-item.active.svelte-19bfq8g{cursor:default;font-weight:bold;background:#ddd;color:#555}.menu-item.svelte-19bfq8g:hover{background:#ddd;color:#555}",ut(document.head,t)),sn(this,e,vn,yn,Ze,["pane","panes"])}}function gn(e){var t,n;return{c(){t=ht("div"),n=vt(e.label),wt(t,"class","label svelte-1olzq4i")},m(e,r){pt(e,t,r),ut(t,n)},p(e,t){e.label&&xt(n,t.label)},d(e){e&&ft(t)}}}function bn(e){var t,n,r,o,i,a=e.label&&gn(e);return{c(){t=ht("div"),n=ht("div"),r=vt(e.value),o=mt(),a&&a.c(),wt(n,"class","key-box svelte-1olzq4i"),wt(t,"class","key svelte-1olzq4i"),Pt(t,"active",e.active),i=[bt(window,"keydown",e.Keypress),bt(n,"click",e.Activate)]},m(e,i){pt(e,t,i),ut(t,n),ut(n,r),ut(t,o),a&&a.m(t,null)},p(e,n){e.value&&xt(r,n.value),n.label?a?a.p(e,n):((a=gn(n)).c(),a.m(t,null)):a&&(a.d(1),a=null),e.active&&Pt(t,"active",n.active)},i:Ke,o:Ke,d(e){e&&ft(t),a&&a.d(),Xe(i)}}}function wn(e,t,n){let r,{value:o,onPress:i=null,label:a=null,disable:s=!1}=t;const{disableHotkeys:c}=Mt("hotkeys");et(e,c,e=>{r=e,n("$disableHotkeys",r)});let l=!1;function u(){n("active",l=!1)}function p(){n("active",l=!0),setTimeout(u,200),i&&setTimeout(i,1)}return e.$set=e=>{"value"in e&&n("value",o=e.value),"onPress"in e&&n("onPress",i=e.onPress),"label"in e&&n("label",a=e.label),"disable"in e&&n("disable",s=e.disable)},{value:o,onPress:i,label:a,disable:s,disableHotkeys:c,active:l,Activate:p,Keypress:function(e){r||s||e.key!=o||(e.preventDefault(),p())}}}class xn extends cn{constructor(e){var t;super(),document.getElementById("svelte-1olzq4i-style")||((t=ht("style")).id="svelte-1olzq4i-style",t.textContent=".key.svelte-1olzq4i{display:flex;flex-direction:row;align-items:center}.key-box.svelte-1olzq4i{cursor:pointer;min-width:10px;padding-left:5px;padding-right:5px;height:20px;line-height:20px;text-align:center;border:1px solid #ccc;box-shadow:1px 1px 1px #888;background:#eee;color:#444}.key-box.svelte-1olzq4i:hover{background:#ddd}.key.active.svelte-1olzq4i .key-box.svelte-1olzq4i{background:#ddd;border:1px solid #999;box-shadow:none}.label.svelte-1olzq4i{margin-left:10px}",ut(document.head,t)),sn(this,e,wn,bn,Ze,["value","onPress","label","disable"])}}function kn(e){var t,n,r,o,i,a;return{c(){t=ht("div"),n=vt(e.name),r=vt("("),o=ht("span"),i=vt(")"),wt(o,"class","arg-field svelte-khot71"),wt(o,"contenteditable",""),wt(t,"class","move svelte-khot71"),Pt(t,"active",e.active),a=[bt(o,"blur",e.Deactivate),bt(o,"keydown",e.OnKeyDown),bt(t,"click",e.Activate)]},m(a,s){pt(a,t,s),ut(t,n),ut(t,r),ut(t,o),e.span_1_binding(o),ut(t,i)},p(e,r){e.name&&xt(n,r.name),e.active&&Pt(t,"active",r.active)},i:Ke,o:Ke,d(n){n&&ft(t),e.span_1_binding(null),Xe(a)}}}function $n(e,t,n){let r,{Activate:o,Deactivate:i,name:a,active:s}=t;const c=Bt();var l;return l=()=>{s?r.focus():r.blur()},_t().$$.after_update.push(l),e.$set=e=>{"Activate"in e&&n("Activate",o=e.Activate),"Deactivate"in e&&n("Deactivate",i=e.Deactivate),"name"in e&&n("name",a=e.name),"active"in e&&n("active",s=e.active)},{Activate:o,Deactivate:i,name:a,active:s,span:r,OnKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),function(){try{const e=r.innerText;let t=new Function(`return [${e}]`)();c("submit",t)}catch(e){c("error",e)}n("span",r.innerText="",r)}()),"Escape"==e.key&&(e.preventDefault(),i())},span_1_binding:function(e){Rt[e?"unshift":"push"](()=>{n("span",r=e)})}}}class Pn extends cn{constructor(e){var t;super(),document.getElementById("svelte-khot71-style")||((t=ht("style")).id="svelte-khot71-style",t.textContent=".move.svelte-khot71{cursor:pointer;margin-left:10px;color:#666}.move.svelte-khot71:hover{color:#333}.move.active.svelte-khot71{color:#111;font-weight:bold}.arg-field.svelte-khot71{outline:none;font-family:monospace}",ut(document.head,t)),sn(this,e,$n,kn,Ze,["Activate","Deactivate","name","active"])}}function Cn(e){var t,n;return{c(){t=ht("span"),n=vt(e.error),wt(t,"class","move-error svelte-smqssc")},m(e,r){pt(e,t,r),ut(t,n)},p(e,t){e.error&&xt(n,t.error)},d(e){e&&ft(t)}}}function On(e){var t,n,r,o,i,a=new xn({props:{value:e.shortcut,onPress:e.Activate}}),s=new Pn({props:{Activate:e.Activate,Deactivate:e.Deactivate,name:e.name,active:e.active}});s.$on("submit",e.Submit),s.$on("error",e.Error);var c=e.error&&Cn(e);return{c(){t=ht("div"),n=ht("div"),a.$$.fragment.c(),r=mt(),s.$$.fragment.c(),o=mt(),c&&c.c(),wt(n,"class","wrapper svelte-smqssc")},m(e,l){pt(e,t,l),ut(t,n),rn(a,n,null),ut(n,r),rn(s,n,null),ut(t,o),c&&c.m(t,null),i=!0},p(e,n){var r={};e.shortcut&&(r.value=n.shortcut),a.$set(r);var o={};e.name&&(o.name=n.name),e.active&&(o.active=n.active),s.$set(o),n.error?c?c.p(e,n):((c=Cn(n)).c(),c.m(t,null)):c&&(c.d(1),c=null)},i(e){i||(Qt(a.$$.fragment,e),Qt(s.$$.fragment,e),i=!0)},o(e){Zt(a.$$.fragment,e),Zt(s.$$.fragment,e),i=!1},d(e){e&&ft(t),on(a),on(s),c&&c.d()}}}function In(e,t,n){let{shortcut:r,name:o,fn:i}=t;const{disableHotkeys:a}=Mt("hotkeys");let s="",c=!1;function l(){a.set(!1),n("error",s=""),n("active",c=!1)}return e.$set=e=>{"shortcut"in e&&n("shortcut",r=e.shortcut),"name"in e&&n("name",o=e.name),"fn"in e&&n("fn",i=e.fn)},{shortcut:r,name:o,fn:i,error:s,active:c,Activate:function(){a.set(!0),n("active",c=!0)},Deactivate:l,Submit:function(e){n("error",s=""),l(),i.apply(this,e.detail)},Error:function(e){n("error",s=e.detail),Te(e.detail)}}}class Dn extends cn{constructor(e){var t;super(),document.getElementById("svelte-smqssc-style")||((t=ht("style")).id="svelte-smqssc-style",t.textContent=".move-error.svelte-smqssc{color:#a00;font-weight:bold}.wrapper.svelte-smqssc{display:flex;flex-direction:row;align-items:center}",ut(document.head,t)),sn(this,e,In,On,Ze,["shortcut","name","fn"])}}var En=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),i=n[0];return"object"==typeof i&&i?function t(n,r,o){return Object.keys(o).reduce((function(o,i){var a=o[i];if(a instanceof e){var s=n[a];"object"!=typeof s||r.has(s)?o[i]=s:(r.add(s),o[i]=t(n,r,s))}return o}),o)}(n,new Set,i):i},stringify:function(e){for(var t,r=new Map,o=[],i=[],a=+n(r,o,e),s=function(e,i){if(t)return t=!t,i;switch(typeof i){case"object":if(null===i)return i;case"string":return r.get(i)||n(r,o,i)}return i};a<o.length;a++)t=!0,i[a]=JSON.stringify(o[a],s);return"["+i.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(t,n){return"string"==typeof n?new e(n):n}}(String);const An=En.parse,Sn=En.stringify;function _n(e){var t,n,r,o,i,a,s,c,l,u=new xn({props:{value:"1",onPress:e.client.reset,label:"reset"}}),p=new xn({props:{value:"2",onPress:e.Save,label:"save"}}),f=new xn({props:{value:"3",onPress:e.Restore,label:"restore"}}),d=new xn({props:{value:".",disable:!0,label:"hide"}});return{c(){t=ht("section"),n=ht("li"),u.$$.fragment.c(),r=mt(),o=ht("li"),p.$$.fragment.c(),i=mt(),a=ht("li"),f.$$.fragment.c(),s=mt(),c=ht("li"),d.$$.fragment.c(),wt(n,"class","svelte-1x2w9i0"),wt(o,"class","svelte-1x2w9i0"),wt(a,"class","svelte-1x2w9i0"),wt(c,"class","svelte-1x2w9i0"),wt(t,"id","debug-controls"),wt(t,"class","controls")},m(e,h){pt(e,t,h),ut(t,n),rn(u,n,null),ut(t,r),ut(t,o),rn(p,o,null),ut(t,i),ut(t,a),rn(f,a,null),ut(t,s),ut(t,c),rn(d,c,null),l=!0},p(e,t){var n={};e.client&&(n.onPress=t.client.reset),u.$set(n)},i(e){l||(Qt(u.$$.fragment,e),Qt(p.$$.fragment,e),Qt(f.$$.fragment,e),Qt(d.$$.fragment,e),l=!0)},o(e){Zt(u.$$.fragment,e),Zt(p.$$.fragment,e),Zt(f.$$.fragment,e),Zt(d.$$.fragment,e),l=!1},d(e){e&&ft(t),on(u),on(p),on(f),on(d)}}}function jn(e,t,n){let{client:r}=t;return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,Save:function(){const{G:e,ctx:t}=r.getState(),n=Sn({G:e,ctx:t});window.localStorage.setItem("gamestate",n)},Restore:function(){const e=window.localStorage.getItem("gamestate");if(null!==e){const t=An(e);r.store.dispatch(D(t))}}}}class Bn extends cn{constructor(e){var t;super(),document.getElementById("svelte-1x2w9i0-style")||((t=ht("style")).id="svelte-1x2w9i0-style",t.textContent="li.svelte-1x2w9i0{list-style:none;margin:none;margin-bottom:5px}",ut(document.head,t)),sn(this,e,jn,_n,Ze,["client"])}}function Nn(e,t,n){const r=Object.create(e);return r.player=t[n],r}function Mn(e){var t,n,r,o,i=e.player+"";function a(){return e.click_handler(e)}return{c(){t=ht("div"),n=vt(i),r=mt(),wt(t,"class","player svelte-6sf87x"),Pt(t,"current",e.player==e.ctx.currentPlayer),Pt(t,"active",e.player==e.playerID),o=bt(t,"click",a)},m(e,o){pt(e,t,o),ut(t,n),ut(t,r)},p(r,o){e=o,r.players&&i!==(i=e.player+"")&&xt(n,i),(r.players||r.ctx)&&Pt(t,"current",e.player==e.ctx.currentPlayer),(r.players||r.playerID)&&Pt(t,"active",e.player==e.playerID)},d(e){e&&ft(t),o()}}}function Tn(e){var t;let n=e.players,r=[];for(let t=0;t<n.length;t+=1)r[t]=Mn(Nn(e,n,t));return{c(){t=ht("div");for(let e=0;e<r.length;e+=1)r[e].c();wt(t,"class","player-box svelte-6sf87x")},m(e,n){pt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.players||e.ctx||e.playerID){let i;for(n=o.players,i=0;i<n.length;i+=1){const a=Nn(o,n,i);r[i]?r[i].p(e,a):(r[i]=Mn(a),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:Ke,o:Ke,d(e){e&&ft(t),dt(r,e)}}}function Rn(e,t,n){let{ctx:r,playerID:o}=t;const i=Bt();function a(e){i("change",e==o?{playerID:null}:{playerID:e})}let s;return e.$set=e=>{"ctx"in e&&n("ctx",r=e.ctx),"playerID"in e&&n("playerID",o=e.playerID)},e.$$.update=(e={ctx:1})=>{e.ctx&&n("players",s=r?[...Array(r.numPlayers).keys()].map(e=>e.toString()):[])},{ctx:r,playerID:o,OnClick:a,players:s,click_handler:({player:e})=>a(e)}}class qn extends cn{constructor(e){var t;super(),document.getElementById("svelte-6sf87x-style")||((t=ht("style")).id="svelte-6sf87x-style",t.textContent=".player-box.svelte-6sf87x{display:flex;flex-direction:row}.player.svelte-6sf87x{cursor:pointer;text-align:center;width:30px;height:30px;line-height:30px;background:#eee;border:3px solid #fefefe;box-sizing:content-box}.player.current.svelte-6sf87x{background:#555;color:#eee;font-weight:bold}.player.active.svelte-6sf87x{border:3px solid #ff7f50}",ut(document.head,t)),sn(this,e,Rn,Tn,Ze,["ctx","playerID"])}}function zn(e,t,n){const r=Object.create(e);return r.name=t[n][0],r.fn=t[n][1],r}function Fn(e){var t,n,r,o=new Dn({props:{shortcut:e.shortcuts[e.name],fn:e.fn,name:e.name}});return{c(){t=ht("li"),o.$$.fragment.c(),n=mt(),wt(t,"class","svelte-1vg2l2b")},m(e,i){pt(e,t,i),rn(o,t,null),ut(t,n),r=!0},p(e,t){var n={};e.client&&(n.shortcut=t.shortcuts[t.name]),e.client&&(n.fn=t.fn),e.client&&(n.name=t.name),o.$set(n)},i(e){r||(Qt(o.$$.fragment,e),r=!0)},o(e){Zt(o.$$.fragment,e),r=!1},d(e){e&&ft(t),on(o)}}}function Ln(e){var t,n;return{c(){(t=ht("button")).textContent="End Turn",wt(t,"class","svelte-1vg2l2b"),n=bt(t,"click",e.click_handler)},m(e,n){pt(e,t,n)},d(e){e&&ft(t),n()}}}function Un(e){var t,n;return{c(){(t=ht("button")).textContent="End Phase",wt(t,"class","svelte-1vg2l2b"),n=bt(t,"click",e.click_handler_1)},m(e,n){pt(e,t,n)},d(e){e&&ft(t),n()}}}function Gn(e){var t,n;return{c(){(t=ht("button")).textContent="End Stage",wt(t,"class","svelte-1vg2l2b"),n=bt(t,"click",e.click_handler_2)},m(e,n){pt(e,t,n)},d(e){e&&ft(t),n()}}}function Hn(e){var t,n,r,o,i,a,s,c,l,u,p,f,d,h,y,v,m,g,b,w,x,k,$,P,C,O,I,D,E,A,S,_=JSON.stringify(e.G,null,2)+"",j=JSON.stringify(Kn(e.ctx),null,2)+"",B=new Bn({props:{client:e.client}}),N=new qn({props:{ctx:e.ctx,playerID:e.playerID}});N.$on("change",e.change_handler);let M=Object.entries(e.client.moves),T=[];for(let t=0;t<M.length;t+=1)T[t]=Fn(zn(e,M,t));const R=e=>Zt(T[e],1,1,()=>{T[e]=null});var q=e.client.events.endTurn&&Ln(e),z=e.ctx.phase&&e.client.events.endPhase&&Un(e),F=e.ctx.activePlayers&&e.client.events.endStage&&Gn(e);return{c(){t=ht("section"),(n=ht("h3")).textContent="Controls",r=mt(),B.$$.fragment.c(),o=mt(),i=ht("section"),(a=ht("h3")).textContent="Players",s=mt(),N.$$.fragment.c(),c=mt(),l=ht("section"),(u=ht("h3")).textContent="Moves",p=mt();for(let e=0;e<T.length;e+=1)T[e].c();f=mt(),d=ht("section"),(h=ht("h3")).textContent="Events",y=mt(),v=ht("div"),q&&q.c(),m=mt(),z&&z.c(),g=mt(),F&&F.c(),b=mt(),w=ht("section"),(x=ht("label")).textContent="G",k=mt(),$=ht("pre"),P=vt(_),C=mt(),O=ht("section"),(I=ht("label")).textContent="ctx",D=mt(),E=ht("pre"),A=vt(j),wt(n,"class","svelte-1vg2l2b"),wt(a,"class","svelte-1vg2l2b"),wt(u,"class","svelte-1vg2l2b"),wt(h,"class","svelte-1vg2l2b"),wt(v,"class","events svelte-1vg2l2b"),wt(x,"class","svelte-1vg2l2b"),wt($,"class","json svelte-1vg2l2b"),wt(I,"class","svelte-1vg2l2b"),wt(E,"class","json svelte-1vg2l2b")},m(e,_){pt(e,t,_),ut(t,n),ut(t,r),rn(B,t,null),pt(e,o,_),pt(e,i,_),ut(i,a),ut(i,s),rn(N,i,null),pt(e,c,_),pt(e,l,_),ut(l,u),ut(l,p);for(let e=0;e<T.length;e+=1)T[e].m(l,null);pt(e,f,_),pt(e,d,_),ut(d,h),ut(d,y),ut(d,v),q&&q.m(v,null),ut(v,m),z&&z.m(v,null),ut(v,g),F&&F.m(v,null),pt(e,b,_),pt(e,w,_),ut(w,x),ut(w,k),ut(w,$),ut($,P),pt(e,C,_),pt(e,O,_),ut(O,I),ut(O,D),ut(O,E),ut(E,A),S=!0},p(e,t){var n={};e.client&&(n.client=t.client),B.$set(n);var r={};if(e.ctx&&(r.ctx=t.ctx),e.playerID&&(r.playerID=t.playerID),N.$set(r),e.shortcuts||e.client){let n;for(M=Object.entries(t.client.moves),n=0;n<M.length;n+=1){const r=zn(t,M,n);T[n]?(T[n].p(e,r),Qt(T[n],1)):(T[n]=Fn(r),T[n].c(),Qt(T[n],1),T[n].m(l,null))}for(Yt(),n=M.length;n<T.length;n+=1)R(n);Xt()}t.client.events.endTurn?q||((q=Ln(t)).c(),q.m(v,m)):q&&(q.d(1),q=null),t.ctx.phase&&t.client.events.endPhase?z||((z=Un(t)).c(),z.m(v,g)):z&&(z.d(1),z=null),t.ctx.activePlayers&&t.client.events.endStage?F||((F=Gn(t)).c(),F.m(v,null)):F&&(F.d(1),F=null),S&&!e.G||_===(_=JSON.stringify(t.G,null,2)+"")||xt(P,_),S&&!e.ctx||j===(j=JSON.stringify(Kn(t.ctx),null,2)+"")||xt(A,j)},i(e){if(!S){Qt(B.$$.fragment,e),Qt(N.$$.fragment,e);for(let e=0;e<M.length;e+=1)Qt(T[e]);S=!0}},o(e){Zt(B.$$.fragment,e),Zt(N.$$.fragment,e),T=T.filter(Boolean);for(let e=0;e<T.length;e+=1)Zt(T[e]);S=!1},d(e){e&&ft(t),on(B),e&&(ft(o),ft(i)),on(N),e&&(ft(c),ft(l)),dt(T,e),e&&(ft(f),ft(d)),q&&q.d(),z&&z.d(),F&&F.d(),e&&(ft(b),ft(w),ft(C),ft(O))}}}function Kn(e){let t={};for(const n in e)n.startsWith("_")||(t[n]=e[n]);return t}function Vn(e,t,n){let{client:r}=t;const o=function(e,t,n){var r={},o={};for(var i in e)o[i]=i;for(var a in t)o[a]=a;for(var s={},c=0;c<n.length;c++){s[n[c]]=!0}var l=s,u=!0;for(var p in o){var f=p[0];if(l[f]){u=!1;break}l[f]=!0,r[p]=f}if(u)return r;l=s;var d=97;for(var h in r={},o){for(var y=String.fromCharCode(d);l[y];)d++,y=String.fromCharCode(d);l[y]=!0,r[h]=y}return r}(r.moves,r.events,"mlia");let i=r.playerID,a={},s={};r.subscribe(e=>{e&&(n("G",s=e.G),n("ctx",a=e.ctx)),n("playerID",i=r.playerID)});return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,shortcuts:o,playerID:i,ctx:a,G:s,change_handler:e=>r.updatePlayerID(e.detail.playerID),click_handler:()=>r.events.endTurn(),click_handler_1:()=>r.events.endPhase(),click_handler_2:()=>r.events.endStage()}}class Wn extends cn{constructor(e){var t;super(),document.getElementById("svelte-1vg2l2b-style")||((t=ht("style")).id="svelte-1vg2l2b-style",t.textContent=".json.svelte-1vg2l2b{font-family:monospace;color:#888}label.svelte-1vg2l2b{font-weight:bold;font-size:1.1em;display:inline}h3.svelte-1vg2l2b{text-transform:uppercase}li.svelte-1vg2l2b{list-style:none;margin:none;margin-bottom:5px}.events.svelte-1vg2l2b{display:flex;flex-direction:column}.events.svelte-1vg2l2b button.svelte-1vg2l2b{width:100px}.events.svelte-1vg2l2b button.svelte-1vg2l2b:not(:last-child){margin-bottom:10px}",ut(document.head,t)),sn(this,e,Vn,Hn,Ze,["client"])}}function Jn(e){var t,n,r,o,i,a,s=JSON.stringify(e.value)+"";return{c(){t=ht("div"),n=ht("strong"),r=vt(e.name),o=mt(),i=ht("div"),a=vt(s),wt(i,"class","svelte-13qih23"),wt(t,"class","item svelte-13qih23")},m(e,s){pt(e,t,s),ut(t,n),ut(n,r),ut(t,o),ut(t,i),ut(i,a)},p(e,t){e.name&&xt(r,t.name),e.value&&s!==(s=JSON.stringify(t.value)+"")&&xt(a,s)},i:Ke,o:Ke,d(e){e&&ft(t)}}}function Yn(e,t,n){let{name:r,value:o}=t;return e.$set=e=>{"name"in e&&n("name",r=e.name),"value"in e&&n("value",o=e.value)},{name:r,value:o}}class Xn extends cn{constructor(e){var t;super(),document.getElementById("svelte-13qih23-style")||((t=ht("style")).id="svelte-13qih23-style",t.textContent=".item.svelte-13qih23{padding:10px}.item.svelte-13qih23:not(:first-child){border-top:1px dashed #aaa}.item.svelte-13qih23 div.svelte-13qih23{float:right;text-align:right}",ut(document.head,t)),sn(this,e,Yn,Jn,Ze,["name","value"])}}function Qn(e){var t,n,r,o=new Xn({props:{name:"isConnected",value:e.$client.isConnected}}),i=new Xn({props:{name:"isMultiplayer",value:e.$client.isMultiplayer}});return{c(){t=ht("span"),o.$$.fragment.c(),n=mt(),i.$$.fragment.c()},m(e,a){pt(e,t,a),rn(o,t,null),ut(t,n),rn(i,t,null),r=!0},p(e,t){var n={};e.$client&&(n.value=t.$client.isConnected),o.$set(n);var r={};e.$client&&(r.value=t.$client.isMultiplayer),i.$set(r)},i(e){r||(Qt(o.$$.fragment,e),Qt(i.$$.fragment,e),r=!0)},o(e){Zt(o.$$.fragment,e),Zt(i.$$.fragment,e),r=!1},d(e){e&&ft(t),on(o),on(i)}}}function Zn(e){var t,n,r,o,i,a=new Xn({props:{name:"gameID",value:e.client.gameID}}),s=new Xn({props:{name:"playerID",value:e.client.playerID}}),c=new Xn({props:{name:"isActive",value:e.$client.isActive}}),l=e.$client.isMultiplayer&&Qn(e);return{c(){t=ht("section"),a.$$.fragment.c(),n=mt(),s.$$.fragment.c(),r=mt(),c.$$.fragment.c(),o=mt(),l&&l.c(),wt(t,"class","gameinfo svelte-1yzq5o8")},m(e,u){pt(e,t,u),rn(a,t,null),ut(t,n),rn(s,t,null),ut(t,r),rn(c,t,null),ut(t,o),l&&l.m(t,null),i=!0},p(e,n){var r={};e.client&&(r.value=n.client.gameID),a.$set(r);var o={};e.client&&(o.value=n.client.playerID),s.$set(o);var i={};e.$client&&(i.value=n.$client.isActive),c.$set(i),n.$client.isMultiplayer?l?(l.p(e,n),Qt(l,1)):((l=Qn(n)).c(),Qt(l,1),l.m(t,null)):l&&(Yt(),Zt(l,1,1,()=>{l=null}),Xt())},i(e){i||(Qt(a.$$.fragment,e),Qt(s.$$.fragment,e),Qt(c.$$.fragment,e),Qt(l),i=!0)},o(e){Zt(a.$$.fragment,e),Zt(s.$$.fragment,e),Zt(c.$$.fragment,e),Zt(l),i=!1},d(e){e&&ft(t),on(a),on(s),on(c),l&&l.d()}}}function er(e,t,n){let r,{client:o}=t;return et(e,o,e=>{r=e,n("$client",r)}),e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,$client:r}}class tr extends cn{constructor(e){var t;super(),document.getElementById("svelte-1yzq5o8-style")||((t=ht("style")).id="svelte-1yzq5o8-style",t.textContent=".gameinfo.svelte-1yzq5o8{padding:10px}",ut(document.head,t)),sn(this,e,er,Zn,Ze,["client"])}}function nr(e){var t,n;return{c(){t=ht("div"),n=vt(e.turn),wt(t,"class","turn-marker svelte-6eza86"),wt(t,"style",e.style)},m(e,r){pt(e,t,r),ut(t,n)},p(e,t){e.turn&&xt(n,t.turn)},i:Ke,o:Ke,d(e){e&&ft(t)}}}function rr(e,t,n){let{turn:r,numEvents:o}=t;const i=`grid-row: span ${o}`;return e.$set=e=>{"turn"in e&&n("turn",r=e.turn),"numEvents"in e&&n("numEvents",o=e.numEvents)},{turn:r,numEvents:o,style:i}}class or extends cn{constructor(e){var t;super(),document.getElementById("svelte-6eza86-style")||((t=ht("style")).id="svelte-6eza86-style",t.textContent=".turn-marker.svelte-6eza86{display:flex;justify-content:center;align-items:center;grid-column:1;background:#555;color:#eee;text-align:center;font-weight:bold;border:1px solid #888}",ut(document.head,t)),sn(this,e,rr,nr,Ze,["turn","numEvents"])}}function ir(e){var t,n,r=e.phase||"";return{c(){t=ht("div"),n=vt(r),wt(t,"class","phase-marker svelte-1t4xap"),wt(t,"style",e.style)},m(e,r){pt(e,t,r),ut(t,n)},p(e,t){e.phase&&r!==(r=t.phase||"")&&xt(n,r)},i:Ke,o:Ke,d(e){e&&ft(t)}}}function ar(e,t,n){let{phase:r,numEvents:o}=t;const i=`grid-row: span ${o}`;return e.$set=e=>{"phase"in e&&n("phase",r=e.phase),"numEvents"in e&&n("numEvents",o=e.numEvents)},{phase:r,numEvents:o,style:i}}class sr extends cn{constructor(e){var t;super(),document.getElementById("svelte-1t4xap-style")||((t=ht("style")).id="svelte-1t4xap-style",t.textContent=".phase-marker.svelte-1t4xap{grid-column:3;background:#555;border:1px solid #888;color:#eee;text-align:center;font-weight:bold;padding-top:10px;padding-bottom:10px;text-orientation:sideways;writing-mode:vertical-rl;line-height:30px;width:100%}",ut(document.head,t)),sn(this,e,ar,ir,Ze,["phase","numEvents"])}}function cr(e){var t,n;return{c(){t=ht("div"),n=vt(e.custompayload)},m(e,r){pt(e,t,r),ut(t,n)},p:Ke,i:Ke,o:Ke,d(e){e&&ft(t)}}}function lr(e,t,n){let{payload:r}=t;const o=void 0!==r?JSON.stringify(r,null,4):"";return e.$set=e=>{"payload"in e&&n("payload",r=e.payload)},{payload:r,custompayload:o}}class ur extends cn{constructor(e){super(),sn(this,e,lr,cr,Ze,["payload"])}}function pr(e){var t,n=new ur({props:{payload:e.payload}});return{c(){n.$$.fragment.c()},m(e,r){rn(n,e,r),t=!0},p(e,t){var r={};e.payload&&(r.payload=t.payload),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Zt(n.$$.fragment,e),t=!1},d(e){on(n,e)}}}function fr(e){var t,n,r=e.payloadComponent;function o(e){return{props:{payload:e.payload}}}if(r)var i=new r(o(e));return{c(){i&&i.$$.fragment.c(),t=gt()},m(e,r){i&&rn(i,e,r),pt(e,t,r),n=!0},p(e,n){var a={};if(e.payload&&(a.payload=n.payload),r!==(r=n.payloadComponent)){if(i){Yt();const e=i;Zt(e.$$.fragment,1,0,()=>{on(e,1)}),Xt()}r?((i=new r(o(n))).$$.fragment.c(),Qt(i.$$.fragment,1),rn(i,t.parentNode,t)):i=null}else r&&i.$set(a)},i(e){n||(i&&Qt(i.$$.fragment,e),n=!0)},o(e){i&&Zt(i.$$.fragment,e),n=!1},d(e){e&&ft(t),i&&on(i,e)}}}function dr(e){var t,n,r,o,i,a,s,c,l,u,p,f=e.action.payload.type+"",d=e.args.join(",")+"",h=[fr,pr],y=[];function v(e,t){return t.payloadComponent?0:1}return c=v(0,e),l=y[c]=h[c](e),{c(){t=ht("div"),n=ht("div"),r=vt(f),o=vt("("),i=vt(d),a=vt(")"),s=mt(),l.c(),wt(t,"class","log-event player"+e.playerID+" svelte-10wdo7v"),Pt(t,"pinned",e.pinned),p=[bt(t,"click",e.click_handler),bt(t,"mouseenter",e.mouseenter_handler),bt(t,"mouseleave",e.mouseleave_handler)]},m(e,l){pt(e,t,l),ut(t,n),ut(n,r),ut(n,o),ut(n,i),ut(n,a),ut(t,s),y[c].m(t,null),u=!0},p(e,n){u&&!e.action||f===(f=n.action.payload.type+"")||xt(r,f);var o=c;(c=v(0,n))===o?y[c].p(e,n):(Yt(),Zt(y[o],1,1,()=>{y[o]=null}),Xt(),(l=y[c])||(l=y[c]=h[c](n)).c(),Qt(l,1),l.m(t,null)),e.pinned&&Pt(t,"pinned",n.pinned)},i(e){u||(Qt(l),u=!0)},o(e){Zt(l),u=!1},d(e){e&&ft(t),y[c].d(),Xe(p)}}}function hr(e,t,n){let{logIndex:r,action:o,pinned:i,payload:a,payloadComponent:s}=t;const c=Bt(),l=o.payload.args||[],u=o.payload.playerID;return e.$set=e=>{"logIndex"in e&&n("logIndex",r=e.logIndex),"action"in e&&n("action",o=e.action),"pinned"in e&&n("pinned",i=e.pinned),"payload"in e&&n("payload",a=e.payload),"payloadComponent"in e&&n("payloadComponent",s=e.payloadComponent)},{logIndex:r,action:o,pinned:i,payload:a,payloadComponent:s,dispatch:c,args:l,playerID:u,click_handler:()=>c("click",{logIndex:r}),mouseenter_handler:()=>c("mouseenter",{logIndex:r}),mouseleave_handler:()=>c("mouseleave")}}class yr extends cn{constructor(e){var t;super(),document.getElementById("svelte-10wdo7v-style")||((t=ht("style")).id="svelte-10wdo7v-style",t.textContent=".log-event.svelte-10wdo7v{grid-column:2;cursor:pointer;overflow:hidden;display:flex;flex-direction:column;justify-content:center;background:#fff;border:1px dotted #ccc;border-left:5px solid #ccc;padding:5px;text-align:center;color:#888;font-size:14px;min-height:25px;line-height:25px}.log-event.svelte-10wdo7v:hover{border-style:solid;background:#eee}.log-event.pinned.svelte-10wdo7v{border-style:solid;background:#eee;opacity:1}.player0.svelte-10wdo7v{border-left-color:#ff851b}.player1.svelte-10wdo7v{border-left-color:#7fdbff}.player2.svelte-10wdo7v{border-left-color:#0074d9}.player3.svelte-10wdo7v{border-left-color:#39cccc}.player4.svelte-10wdo7v{border-left-color:#3d9970}.player5.svelte-10wdo7v{border-left-color:#2ecc40}.player6.svelte-10wdo7v{border-left-color:#01ff70}.player7.svelte-10wdo7v{border-left-color:#ffdc00}.player8.svelte-10wdo7v{border-left-color:#001f3f}.player9.svelte-10wdo7v{border-left-color:#ff4136}.player10.svelte-10wdo7v{border-left-color:#85144b}.player11.svelte-10wdo7v{border-left-color:#f012be}.player12.svelte-10wdo7v{border-left-color:#b10dc9}.player13.svelte-10wdo7v{border-left-color:#111111}.player14.svelte-10wdo7v{border-left-color:#aaaaaa}.player15.svelte-10wdo7v{border-left-color:#dddddd}",ut(document.head,t)),sn(this,e,hr,dr,Ze,["logIndex","action","pinned","payload","payloadComponent"])}}function vr(e){var t,n;return{c(){t=yt("title"),n=vt(e.title)},m(e,r){pt(e,t,r),ut(t,n)},p(e,t){e.title&&xt(n,t.title)},d(e){e&&ft(t)}}}function mr(e){var t,n,r,o=e.title&&vr(e);const i=e.$$slots.default,a=function(e,t,n){if(e){const r=tt(e,t,n);return e[0](r)}}(i,e,null);return{c(){t=yt("svg"),o&&o.c(),n=gt(),a&&a.c(),wt(t,"xmlns","http://www.w3.org/2000/svg"),wt(t,"viewBox",e.viewBox),wt(t,"class","svelte-c8tyih")},l(e){a&&a.l(svg_nodes)},m(e,i){pt(e,t,i),o&&o.m(t,null),ut(t,n),a&&a.m(t,null),r=!0},p(e,s){s.title?o?o.p(e,s):((o=vr(s)).c(),o.m(t,n)):o&&(o.d(1),o=null),a&&a.p&&e.$$scope&&a.p(function(e,t,n,r){return e[1]?We({},We(t.$$scope.changed||{},e[1](r?r(n):{}))):t.$$scope.changed||{}}(i,s,e,null),tt(i,s,null)),r&&!e.viewBox||wt(t,"viewBox",s.viewBox)},i(e){r||(Qt(a,e),r=!0)},o(e){Zt(a,e),r=!1},d(e){e&&ft(t),o&&o.d(),a&&a.d(e)}}}function gr(e,t,n){let{title:r=null,viewBox:o}=t,{$$slots:i={},$$scope:a}=t;return e.$set=e=>{"title"in e&&n("title",r=e.title),"viewBox"in e&&n("viewBox",o=e.viewBox),"$$scope"in e&&n("$$scope",a=e.$$scope)},{title:r,viewBox:o,$$slots:i,$$scope:a}}class br extends cn{constructor(e){var t;super(),document.getElementById("svelte-c8tyih-style")||((t=ht("style")).id="svelte-c8tyih-style",t.textContent="svg.svelte-c8tyih{stroke:currentColor;fill:currentColor;stroke-width:0;width:100%;height:auto;max-height:100%}",ut(document.head,t)),sn(this,e,gr,mr,Ze,["title","viewBox"])}}function wr(e){var t;return{c(){wt(t=yt("path"),"d","M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z")},m(e,n){pt(e,t,n)},d(e){e&&ft(t)}}}function xr(e){var t,n=[{viewBox:"0 0 512 512"},e.$$props];let r={$$slots:{default:[wr]},$$scope:{ctx:e}};for(var o=0;o<n.length;o+=1)r=We(r,n[o]);var i=new br({props:r});return{c(){i.$$.fragment.c()},m(e,n){rn(i,e,n),t=!0},p(e,t){var r,o=e.$$props?function(e,t){const n={},r={},o={$$scope:1};let i=e.length;for(;i--;){const a=e[i],s=t[i];if(s){for(const e in a)e in s||(r[e]=1);for(const e in s)o[e]||(n[e]=s[e],o[e]=1);e[i]=s}else for(const e in a)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(n,[n[0],(r=t.$$props,"object"==typeof r&&null!==r?r:{})]):{};e.$$scope&&(o.$$scope={changed:e,ctx:t}),i.$set(o)},i(e){t||(Qt(i.$$.fragment,e),t=!0)},o(e){Zt(i.$$.fragment,e),t=!1},d(e){on(i,e)}}}function kr(e,t,n){return e.$set=e=>{n("$$props",t=We(We({},t),e))},{$$props:t,$$props:t=nt(t)}}class $r extends cn{constructor(e){super(),sn(this,e,kr,xr,Ze,[])}}function Pr(e){var t,n;return{c(){t=ht("div"),n=vt(e.text),wt(t,"alt",e.text),wt(t,"class","svelte-1a7time")},m(e,r){pt(e,t,r),ut(t,n)},p(e,r){e.text&&(xt(n,r.text),wt(t,"alt",r.text))},i:Ke,o:Ke,d(e){e&&ft(t)}}}function Cr(e,t,n){let r,{action:o}=t;return e.$set=e=>{"action"in e&&n("action",o=e.action)},e.$$.update=(e={action:1})=>{if(e.action){const{type:e,args:t}=o.payload,i=(t||[]).join(",");n("text",r=`${e}(${i})`)}},{action:o,text:r}}class Or extends cn{constructor(e){var t;super(),document.getElementById("svelte-1a7time-style")||((t=ht("style")).id="svelte-1a7time-style",t.textContent="div.svelte-1a7time{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:500px}",ut(document.head,t)),sn(this,e,Cr,Pr,Ze,["action"])}}function Ir(e,t,n){const r=Object.create(e);return r.child=t[n],r.i=n,r}function Dr(e){var t,n,r,o,i,a,s,c,l,u,p,f=e.child.value+"",d=e.child.visits+"",h=new Or({props:{action:e.child.parentAction}});function y(){return e.click_handler(e)}function v(){return e.mouseout_handler(e)}function m(){return e.mouseover_handler(e)}return{c(){t=ht("tr"),n=ht("td"),r=vt(f),o=mt(),i=ht("td"),a=vt(d),s=mt(),c=ht("td"),h.$$.fragment.c(),l=mt(),wt(n,"class","svelte-ztcwsu"),wt(i,"class","svelte-ztcwsu"),wt(c,"class","svelte-ztcwsu"),wt(t,"class","svelte-ztcwsu"),Pt(t,"clickable",e.children.length>0),Pt(t,"selected",e.i===e.selectedIndex),p=[bt(t,"click",y),bt(t,"mouseout",v),bt(t,"mouseover",m)]},m(e,p){pt(e,t,p),ut(t,n),ut(n,r),ut(t,o),ut(t,i),ut(i,a),ut(t,s),ut(t,c),rn(h,c,null),ut(t,l),u=!0},p(n,o){e=o,u&&!n.children||f===(f=e.child.value+"")||xt(r,f),u&&!n.children||d===(d=e.child.visits+"")||xt(a,d);var i={};n.children&&(i.action=e.child.parentAction),h.$set(i),n.children&&Pt(t,"clickable",e.children.length>0),n.selectedIndex&&Pt(t,"selected",e.i===e.selectedIndex)},i(e){u||(Qt(h.$$.fragment,e),u=!0)},o(e){Zt(h.$$.fragment,e),u=!1},d(e){e&&ft(t),on(h),Xe(p)}}}function Er(e){var t,n,r,o,i;let a=e.children,s=[];for(let t=0;t<a.length;t+=1)s[t]=Dr(Ir(e,a,t));const c=e=>Zt(s[e],1,1,()=>{s[e]=null});return{c(){t=ht("table"),(n=ht("thead")).innerHTML='<th class="svelte-ztcwsu">Value</th> <th class="svelte-ztcwsu">Visits</th> <th class="svelte-ztcwsu">Action</th>',r=mt(),o=ht("tbody");for(let e=0;e<s.length;e+=1)s[e].c();wt(t,"class","svelte-ztcwsu")},m(e,a){pt(e,t,a),ut(t,n),ut(t,r),ut(t,o);for(let e=0;e<s.length;e+=1)s[e].m(o,null);i=!0},p(e,t){if(e.children||e.selectedIndex){let n;for(a=t.children,n=0;n<a.length;n+=1){const r=Ir(t,a,n);s[n]?(s[n].p(e,r),Qt(s[n],1)):(s[n]=Dr(r),s[n].c(),Qt(s[n],1),s[n].m(o,null))}for(Yt(),n=a.length;n<s.length;n+=1)c(n);Xt()}},i(e){if(!i){for(let e=0;e<a.length;e+=1)Qt(s[e]);i=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)Zt(s[e]);i=!1},d(e){e&&ft(t),dt(s,e)}}}function Ar(e,t,n){let{root:r,selectedIndex:o=null}=t;const i=Bt();let a=[],s=[];function c(e,t){i("select",{node:e,selectedIndex:t})}function l(e,t){null===o&&i("preview",{node:e})}return e.$set=e=>{"root"in e&&n("root",r=e.root),"selectedIndex"in e&&n("selectedIndex",o=e.selectedIndex)},e.$$.update=(e={root:1,parents:1})=>{if(e.root||e.parents){let e=r;for(n("parents",a=[]);e.parent;){const t=e.parent,{type:n,args:r}=e.parentAction.payload,o=`${n}(${(r||[]).join(",")})`;a.push({parent:t,arrowText:o}),e=t}a.reverse(),n("children",s=[...r.children].sort((e,t)=>e.visits<t.visits?1:-1).slice(0,50))}},{root:r,selectedIndex:o,children:s,Select:c,Preview:l,click_handler:({child:e,i:t})=>c(e,t),mouseout_handler:({i:e})=>l(null),mouseover_handler:({child:e,i:t})=>l(e)}}class Sr extends cn{constructor(e){var t;super(),document.getElementById("svelte-ztcwsu-style")||((t=ht("style")).id="svelte-ztcwsu-style",t.textContent="table.svelte-ztcwsu{font-size:12px;border-collapse:collapse;border:1px solid #ddd;padding:0}tr.svelte-ztcwsu{cursor:pointer}tr.svelte-ztcwsu:hover td.svelte-ztcwsu{background:#eee}tr.selected.svelte-ztcwsu td.svelte-ztcwsu{background:#eee}td.svelte-ztcwsu{padding:10px;height:10px;line-height:10px;font-size:12px;border:none}th.svelte-ztcwsu{background:#888;color:#fff;padding:10px;text-align:center}",ut(document.head,t)),sn(this,e,Ar,Er,Ze,["root","selectedIndex"])}}function _r(e,t,n){const r=Object.create(e);return r.node=t[n].node,r.selectedIndex=t[n].selectedIndex,r.i=n,r}function jr(e){var t;var n=new Sr({props:{root:e.node,selectedIndex:e.selectedIndex}});return n.$on("select",(function(...t){return e.select_handler_1(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){rn(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),t.nodes&&(o.selectedIndex=e.selectedIndex),n.$set(o)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Zt(n.$$.fragment,e),t=!1},d(e){on(n,e)}}}function Br(e){var t;var n=new Sr({props:{root:e.node}});return n.$on("select",(function(...t){return e.select_handler(e,...t)})),n.$on("preview",(function(...t){return e.preview_handler(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){rn(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),n.$set(o)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Zt(n.$$.fragment,e),t=!1},d(e){on(n,e)}}}function Nr(e){var t,n,r,o,i,a=0!==e.i&&function(e){var t,n,r=new $r({});return{c(){t=ht("div"),r.$$.fragment.c(),wt(t,"class","icon svelte-1f0amz4")},m(e,o){pt(e,t,o),rn(r,t,null),n=!0},i(e){n||(Qt(r.$$.fragment,e),n=!0)},o(e){Zt(r.$$.fragment,e),n=!1},d(e){e&&ft(t),on(r)}}}(),s=[Br,jr],c=[];function l(e,t){return t.i===t.nodes.length-1?0:1}return r=l(0,e),o=c[r]=s[r](e),{c(){a&&a.c(),t=mt(),n=ht("section"),o.c()},m(e,o){a&&a.m(e,o),pt(e,t,o),pt(e,n,o),c[r].m(n,null),i=!0},p(e,t){var i=r;(r=l(0,t))===i?c[r].p(e,t):(Yt(),Zt(c[i],1,1,()=>{c[i]=null}),Xt(),(o=c[r])||(o=c[r]=s[r](t)).c(),Qt(o,1),o.m(n,null))},i(e){i||(Qt(a),Qt(o),i=!0)},o(e){Zt(a),Zt(o),i=!1},d(e){a&&a.d(e),e&&(ft(t),ft(n)),c[r].d()}}}function Mr(e){var t,n,r,o,i=new $r({}),a=new Sr({props:{root:e.preview}});return{c(){t=ht("div"),i.$$.fragment.c(),n=mt(),r=ht("section"),a.$$.fragment.c(),wt(t,"class","icon svelte-1f0amz4"),wt(r,"class","preview svelte-1f0amz4")},m(e,s){pt(e,t,s),rn(i,t,null),pt(e,n,s),pt(e,r,s),rn(a,r,null),o=!0},p(e,t){var n={};e.preview&&(n.root=t.preview),a.$set(n)},i(e){o||(Qt(i.$$.fragment,e),Qt(a.$$.fragment,e),o=!0)},o(e){Zt(i.$$.fragment,e),Zt(a.$$.fragment,e),o=!1},d(e){e&&ft(t),on(i),e&&(ft(n),ft(r)),on(a)}}}function Tr(e){var t,n,r;let o=e.nodes,i=[];for(let t=0;t<o.length;t+=1)i[t]=Nr(_r(e,o,t));const a=e=>Zt(i[e],1,1,()=>{i[e]=null});var s=e.preview&&Mr(e);return{c(){t=ht("div");for(let e=0;e<i.length;e+=1)i[e].c();n=mt(),s&&s.c(),wt(t,"class","visualizer svelte-1f0amz4")},m(e,o){pt(e,t,o);for(let e=0;e<i.length;e+=1)i[e].m(t,null);ut(t,n),s&&s.m(t,null),r=!0},p(e,r){if(e.nodes){let s;for(o=r.nodes,s=0;s<o.length;s+=1){const a=_r(r,o,s);i[s]?(i[s].p(e,a),Qt(i[s],1)):(i[s]=Nr(a),i[s].c(),Qt(i[s],1),i[s].m(t,n))}for(Yt(),s=o.length;s<i.length;s+=1)a(s);Xt()}r.preview?s?(s.p(e,r),Qt(s,1)):((s=Mr(r)).c(),Qt(s,1),s.m(t,null)):s&&(Yt(),Zt(s,1,1,()=>{s=null}),Xt())},i(e){if(!r){for(let e=0;e<o.length;e+=1)Qt(i[e]);Qt(s),r=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)Zt(i[e]);Zt(s),r=!1},d(e){e&&ft(t),dt(i,e),s&&s.d()}}}function Rr(e,t,n){let{metadata:r}=t,o=[],i=null;function a({node:e,selectedIndex:t},r){n("preview",i=null),n("nodes",o[r].selectedIndex=t,o),n("nodes",o=[...o.slice(0,r+1),{node:e}])}function s({node:e},t){n("preview",i=e)}return e.$set=e=>{"metadata"in e&&n("metadata",r=e.metadata)},e.$$.update=(e={metadata:1})=>{e.metadata&&n("nodes",o=[{node:r}])},{metadata:r,nodes:o,preview:i,SelectNode:a,PreviewNode:s,select_handler:({i:e},t)=>a(t.detail,e),preview_handler:({i:e},t)=>s(t.detail),select_handler_1:({i:e},t)=>a(t.detail,e)}}class qr extends cn{constructor(e){var t;super(),document.getElementById("svelte-1f0amz4-style")||((t=ht("style")).id="svelte-1f0amz4-style",t.textContent=".visualizer.svelte-1f0amz4{display:flex;flex-direction:column;align-items:center;padding:50px}.preview.svelte-1f0amz4{opacity:0.5}.icon.svelte-1f0amz4{color:#777;width:32px;height:32px;margin-bottom:20px}",ut(document.head,t)),sn(this,e,Rr,Tr,Ze,["metadata"])}}function zr(e,t,n){const r=Object.create(e);return r.phase=t[n].phase,r.i=n,r}function Fr(e,t,n){const r=Object.create(e);return r.action=t[n].action,r.payload=t[n].payload,r.i=n,r}function Lr(e,t,n){const r=Object.create(e);return r.turn=t[n].turn,r.i=n,r}function Ur(e){var t,n=new or({props:{turn:e.turn,numEvents:e.turnBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){rn(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.turn=t.turn),e.turnBoundaries&&(r.numEvents=t.turnBoundaries[t.i]),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Zt(n.$$.fragment,e),t=!1},d(e){on(n,e)}}}function Gr(e){var t,n,r=e.i in e.turnBoundaries&&Ur(e);return{c(){r&&r.c(),t=gt()},m(e,o){r&&r.m(e,o),pt(e,t,o),n=!0},p(e,n){n.i in n.turnBoundaries?r?(r.p(e,n),Qt(r,1)):((r=Ur(n)).c(),Qt(r,1),r.m(t.parentNode,t)):r&&(Yt(),Zt(r,1,1,()=>{r=null}),Xt())},i(e){n||(Qt(r),n=!0)},o(e){Zt(r),n=!1},d(e){r&&r.d(e),e&&ft(t)}}}function Hr(e){var t,n=new yr({props:{pinned:e.i===e.pinned,logIndex:e.i,action:e.action,payload:e.payload}});return n.$on("click",e.OnLogClick),n.$on("mouseenter",e.OnMouseEnter),n.$on("mouseleave",e.OnMouseLeave),{c(){n.$$.fragment.c()},m(e,r){rn(n,e,r),t=!0},p(e,t){var r={};e.pinned&&(r.pinned=t.i===t.pinned),e.renderedLogEntries&&(r.action=t.action),e.renderedLogEntries&&(r.payload=t.payload),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Zt(n.$$.fragment,e),t=!1},d(e){on(n,e)}}}function Kr(e){var t,n=new sr({props:{phase:e.phase,numEvents:e.phaseBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){rn(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.phase=t.phase),e.phaseBoundaries&&(r.numEvents=t.phaseBoundaries[t.i]),n.$set(r)},i(e){t||(Qt(n.$$.fragment,e),t=!0)},o(e){Zt(n.$$.fragment,e),t=!1},d(e){on(n,e)}}}function Vr(e){var t,n,r=e.i in e.phaseBoundaries&&Kr(e);return{c(){r&&r.c(),t=gt()},m(e,o){r&&r.m(e,o),pt(e,t,o),n=!0},p(e,n){n.i in n.phaseBoundaries?r?(r.p(e,n),Qt(r,1)):((r=Kr(n)).c(),Qt(r,1),r.m(t.parentNode,t)):r&&(Yt(),Zt(r,1,1,()=>{r=null}),Xt())},i(e){n||(Qt(r),n=!0)},o(e){Zt(r),n=!1},d(e){r&&r.d(e),e&&ft(t)}}}function Wr(e){var t,n,r,o,i;let a=e.renderedLogEntries,s=[];for(let t=0;t<a.length;t+=1)s[t]=Gr(Lr(e,a,t));const c=e=>Zt(s[e],1,1,()=>{s[e]=null});let l=e.renderedLogEntries,u=[];for(let t=0;t<l.length;t+=1)u[t]=Hr(Fr(e,l,t));const p=e=>Zt(u[e],1,1,()=>{u[e]=null});let f=e.renderedLogEntries,d=[];for(let t=0;t<f.length;t+=1)d[t]=Vr(zr(e,f,t));const h=e=>Zt(d[e],1,1,()=>{d[e]=null});return{c(){t=ht("div");for(let e=0;e<s.length;e+=1)s[e].c();n=mt();for(let e=0;e<u.length;e+=1)u[e].c();r=mt();for(let e=0;e<d.length;e+=1)d[e].c();wt(t,"class","gamelog svelte-1pq5e4b"),Pt(t,"pinned",e.pinned),i=bt(window,"keydown",e.OnKeyDown)},m(e,i){pt(e,t,i);for(let e=0;e<s.length;e+=1)s[e].m(t,null);ut(t,n);for(let e=0;e<u.length;e+=1)u[e].m(t,null);ut(t,r);for(let e=0;e<d.length;e+=1)d[e].m(t,null);o=!0},p(e,o){if(e.turnBoundaries||e.renderedLogEntries){let r;for(a=o.renderedLogEntries,r=0;r<a.length;r+=1){const i=Lr(o,a,r);s[r]?(s[r].p(e,i),Qt(s[r],1)):(s[r]=Gr(i),s[r].c(),Qt(s[r],1),s[r].m(t,n))}for(Yt(),r=a.length;r<s.length;r+=1)c(r);Xt()}if(e.pinned||e.renderedLogEntries){let n;for(l=o.renderedLogEntries,n=0;n<l.length;n+=1){const i=Fr(o,l,n);u[n]?(u[n].p(e,i),Qt(u[n],1)):(u[n]=Hr(i),u[n].c(),Qt(u[n],1),u[n].m(t,r))}for(Yt(),n=l.length;n<u.length;n+=1)p(n);Xt()}if(e.phaseBoundaries||e.renderedLogEntries){let n;for(f=o.renderedLogEntries,n=0;n<f.length;n+=1){const r=zr(o,f,n);d[n]?(d[n].p(e,r),Qt(d[n],1)):(d[n]=Vr(r),d[n].c(),Qt(d[n],1),d[n].m(t,null))}for(Yt(),n=f.length;n<d.length;n+=1)h(n);Xt()}e.pinned&&Pt(t,"pinned",o.pinned)},i(e){if(!o){for(let e=0;e<a.length;e+=1)Qt(s[e]);for(let e=0;e<l.length;e+=1)Qt(u[e]);for(let e=0;e<f.length;e+=1)Qt(d[e]);o=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)Zt(s[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)Zt(u[e]);d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)Zt(d[e]);o=!1},d(e){e&&ft(t),dt(s,e),dt(u,e),dt(d,e),i()}}}function Jr(e,t,n){let r,{client:o}=t;et(e,o,e=>{r=e,n("$client",r)});const{secondaryPane:i}=Mt("secondaryPane"),a=o.getInitialState();let s,{log:c}=r,l=null;function u(e){let t=a;for(let n=0;n<c.length;n++){const{action:r,automatic:i}=c[n];if(i||(t=o.reducer(t,r)),"MAKE_MOVE"==r.type){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}function p(){n("pinned",l=null),o.overrideGameState(null),i.set(null)}jt(p);let f={},d={};return e.$set=e=>{"client"in e&&n("client",o=e.client)},e.$$.update=(e={$client:1,log:1,renderedLogEntries:1})=>{if(e.$client||e.log||e.renderedLogEntries){n("log",c=r.log),n("renderedLogEntries",s=c.filter(e=>"MAKE_MOVE"==e.action.type));let e=0,t=0;n("turnBoundaries",f={}),n("phaseBoundaries",d={});for(let r=0;r<s.length;r++){const{action:o,payload:i,turn:a,phase:c}=s[r];t++,e++,r!=s.length-1&&s[r+1].turn==a||(n("turnBoundaries",f[r]=t,f),t=0),r!=s.length-1&&s[r+1].phase==c||(n("phaseBoundaries",d[r]=e,d),e=0)}}},{client:o,pinned:l,OnLogClick:function(e){const{logIndex:t}=e.detail,r=u(t),a=c.filter(e=>"MAKE_MOVE"==e.action.type);if(o.overrideGameState(r),l==t)n("pinned",l=null),i.set(null);else{n("pinned",l=t);const{metadata:e}=a[t].action.payload;e&&i.set({component:qr,metadata:e})}},OnMouseEnter:function(e){const{logIndex:t}=e.detail;if(null===l){const e=u(t);o.overrideGameState(e)}},OnMouseLeave:function(){null===l&&o.overrideGameState(null)},OnKeyDown:function(e){27==e.keyCode&&p()},renderedLogEntries:s,turnBoundaries:f,phaseBoundaries:d}}class Yr extends cn{constructor(e){var t;super(),document.getElementById("svelte-1pq5e4b-style")||((t=ht("style")).id="svelte-1pq5e4b-style",t.textContent=".gamelog.svelte-1pq5e4b{display:grid;grid-template-columns:30px 1fr 30px;grid-auto-rows:auto;grid-auto-flow:column}",ut(document.head,t)),sn(this,e,Jr,Wr,Ze,["client"])}}const{Object:Xr}=nn;function Qr(e,t,n){const r=Xr.create(e);return r.key=t[n][0],r.value=t[n][1],r}function Zr(e){var t,n,r,o,i,a,s,c=e.values[e.key]+"";function l(){e.input_change_input_handler.call(o,e)}return{c(){t=ht("span"),n=vt(c),r=mt(),o=ht("input"),wt(t,"class","value svelte-7cel4i"),wt(o,"type","range"),wt(o,"min",i=e.value.range.min),wt(o,"max",a=e.value.range.max),s=[bt(o,"change",l),bt(o,"input",l),bt(o,"change",e.OnChange)]},m(i,a){pt(i,t,a),ut(t,n),pt(i,r,a),pt(i,o,a),kt(o,e.values[e.key])},p(t,r){e=r,(t.values||t.bot)&&c!==(c=e.values[e.key]+"")&&xt(n,c),(t.values||t.Object||t.bot)&&kt(o,e.values[e.key]),t.bot&&i!==(i=e.value.range.min)&&wt(o,"min",i),t.bot&&a!==(a=e.value.range.max)&&wt(o,"max",a)},d(e){e&&(ft(t),ft(r),ft(o)),Xe(s)}}}function eo(e){var t,n;function r(){e.input_change_handler.call(t,e)}return{c(){wt(t=ht("input"),"type","checkbox"),wt(t,"class","svelte-7cel4i"),n=[bt(t,"change",r),bt(t,"change",e.OnChange)]},m(n,r){pt(n,t,r),t.checked=e.values[e.key]},p(n,r){e=r,(n.values||n.Object||n.bot)&&(t.checked=e.values[e.key])},d(e){e&&ft(t),Xe(n)}}}function to(e){var t,n,r,o,i,a,s=e.key+"",c=e.value.range&&Zr(e),l="boolean"==typeof e.value.value&&eo(e);return{c(){t=ht("div"),n=ht("label"),r=vt(s),o=mt(),c&&c.c(),i=mt(),l&&l.c(),a=mt(),wt(n,"class","svelte-7cel4i"),wt(t,"class","option svelte-7cel4i")},m(e,s){pt(e,t,s),ut(t,n),ut(n,r),ut(t,o),c&&c.m(t,null),ut(t,i),l&&l.m(t,null),ut(t,a)},p(e,n){e.bot&&s!==(s=n.key+"")&&xt(r,s),n.value.range?c?c.p(e,n):((c=Zr(n)).c(),c.m(t,i)):c&&(c.d(1),c=null),"boolean"==typeof n.value.value?l?l.p(e,n):((l=eo(n)).c(),l.m(t,a)):l&&(l.d(1),l=null)},d(e){e&&ft(t),c&&c.d(),l&&l.d()}}}function no(e){var t;let n=e.Object.entries(e.bot.opts()),r=[];for(let t=0;t<n.length;t+=1)r[t]=to(Qr(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=gt()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);pt(e,t,n)},p(e,o){if(e.Object||e.bot||e.values){let i;for(n=o.Object.entries(o.bot.opts()),i=0;i<n.length;i+=1){const a=Qr(o,n,i);r[i]?r[i].p(e,a):(r[i]=to(a),r[i].c(),r[i].m(t.parentNode,t))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:Ke,o:Ke,d(e){dt(r,e),e&&ft(t)}}}function ro(e,t,n){let{bot:r}=t,o={};for(let[e,t]of Object.entries(r.opts()))n("values",o[e]=t.value,o);return e.$set=e=>{"bot"in e&&n("bot",r=e.bot)},{bot:r,values:o,OnChange:function(){for(let[e,t]of Object.entries(o))r.setOpt(e,t)},Object:Object,input_change_input_handler:function({key:e}){o[e]=function(e){return""===e?void 0:+e}(this.value),n("values",o),n("Object",Object),n("bot",r)},input_change_handler:function({key:e}){o[e]=this.checked,n("values",o),n("Object",Object),n("bot",r)}}}class oo extends cn{constructor(e){var t;super(),document.getElementById("svelte-7cel4i-style")||((t=ht("style")).id="svelte-7cel4i-style",t.textContent="label.svelte-7cel4i{font-weight:bold;color:#999}.option.svelte-7cel4i{margin-bottom:20px}.value.svelte-7cel4i{font-weight:bold}input[type='checkbox'].svelte-7cel4i{vertical-align:middle}",ut(document.head,t)),sn(this,e,ro,no,Ze,["bot"])}}function io({game:e,isClient:t}){return e=He(e),(n=null,r)=>{switch(r.type){case"GAME_EVENT":{if(n={...n,deltalog:[]},t)return n;if(void 0!==n.ctx.gameover)return Te("cannot call event after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return Te(`disallowed event: ${r.payload.type}`),n;n=je(n,{game:e,isClient:!1});let o=e.flow.processEvent(n,r);return o=Be(o,{game:e,isClient:!1}),{...o,_stateID:n._stateID+1}}case"MAKE_MOVE":{n={...n,deltalog:[]};const o=e.flow.getMove(n.ctx,r.payload.type,r.payload.playerID||n.ctx.currentPlayer);if(null===o)return Te(`disallowed move: ${r.payload.type}`),n;if(t&&!1===o.client)return n;if(void 0!==n.ctx.gameover)return Te("cannot make move after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return Te(`disallowed move: ${r.payload.type}`),n;n=je(n,{game:e,isClient:t});let i=e.processMove(n,r.payload);if("INVALID_MOVE"===i)return Te(`invalid move: ${r.payload.type} args: ${r.payload.args}`),n;let a={action:r,_stateID:n._stateID,turn:n.ctx.turn,phase:n.ctx.phase};!0===o.redact&&(a.redact=!0);const s={...n,G:i,deltalog:[a],_stateID:n._stateID+1};return t&&((e,t)=>[...Ae,...t.game.plugins].filter(e=>void 0!==e.noClient).map(n=>{const r=n.name,o=e.plugins[r];return!!o&&n.noClient({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data})}).some(e=>!0===e))(s,{game:e})?n:(n=s,t?n=Be(n,{game:e,isClient:!0}):(n=e.flow.processMove(n,r.payload),n=Be(n,{game:e})))}case"RESET":case"UPDATE":case"SYNC":return r.state;case"UNDO":{const{_undo:t,_redo:r}=n;if(t.length<2)return n;const s=t[t.length-1],c=t[t.length-2],l=e.flow.getMove(n.ctx,s.moveType,n.ctx.currentPlayer);return o=n.G,i=n.ctx,!function(e){return void 0!==e.undoable}(a=l)||(a.undoable instanceof Function?a.undoable(o,i):a.undoable)?{...n,G:c.G,ctx:c.ctx,_undo:t.slice(0,t.length-1),_redo:[s,...r]}:n}case"REDO":{const{_undo:e,_redo:t}=n;if(0==t.length)return n;const r=t[0];return{...n,G:r.G,ctx:r.ctx,_undo:[...e,r],_redo:t.slice(1)}}case"PLUGIN":return((e,t,n)=>(n.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},i=n.action(o.data,t.payload);e={...e,plugins:{...e.plugins,[r]:{...o,data:i}}}}),e))(n,r,{game:e});default:return n}var o,i,a}}var ao=function(){function e(t){var n=this,o=t.enumerate,i=t.seed;r(this,e),a(this,"enumerate",(function(e,t,r){return n.enumerateFn(e,t,r).map((function(e){return void 0!==e.payload?e:void 0!==e.move?C(e.move,e.args,r):void 0!==e.event?O(e.event,e.args,r):void 0}))})),this.enumerateFn=o,this.seed=i,this.iterationCounter=0,this._opts={}}return i(e,[{key:"addOpt",value:function(e){var t=e.key,n=e.range,r=e.initial;this._opts[t]={range:n,value:r}}},{key:"getOpt",value:function(e){return this._opts[e].value}},{key:"setOpt",value:function(e,t){e in this._opts&&(this._opts[e].value=t)}},{key:"opts",value:function(){return this._opts}},{key:"random",value:function(e){var t;if(void 0!==this.seed){var n=null;t=(n=this.prngstate?new Oe("",{state:this.prngstate}):new Oe(this.seed,{state:!0}))(),this.prngstate=n.state()}else t=Math.random();return e?e.length?e[Math.floor(t*e.length)]:Math.floor(t*e):t}}]),e}(),so=function(e){function t(e){var n,o=e.enumerate,i=e.seed,a=e.objectives,s=e.game,c=e.iterations,l=e.playoutDepth,p=e.iterationCallback;return r(this,t),void 0===a&&(a=function(){return{}}),(n=d(this,u(t).call(this,{enumerate:o,seed:i}))).objectives=a,n.iterationCallback=p||function(){},n.reducer=io({game:s}),n.iterations=c,n.playoutDepth=l,n.addOpt({key:"async",initial:!1}),n.addOpt({key:"iterations",initial:"number"==typeof c?c:1e3,range:{min:1,max:2e3}}),n.addOpt({key:"playoutDepth",initial:"number"==typeof l?l:50,range:{min:1,max:100}}),n}return l(t,e),i(t,[{key:"createNode",value:function(e){var t=e.state,n=e.parentAction,r=e.parent,o=e.playerID,i=t.G,a=t.ctx,s=[],c=[];if(void 0!==o)s=this.enumerate(i,a,o),c=this.objectives(i,a,o);else if(a.activePlayers)for(var l in a.activePlayers)s=s.concat(this.enumerate(i,a,l)),c=c.concat(this.objectives(i,a,l));else s=s.concat(this.enumerate(i,a,a.currentPlayer)),c=c.concat(this.objectives(i,a,a.currentPlayer));return{state:t,parent:r,parentAction:n,actions:s,objectives:c,children:[],visits:0,value:0}}},{key:"select",value:function(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;var t=null,n=0,r=!0,o=!1,i=void 0;try{for(var a,s=e.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,l=c.visits+Number.EPSILON,u=c.value/l+Math.sqrt(2*Math.log(e.visits)/l);(null==t||u>n)&&(n=u,t=c)}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return this.select(t)}},{key:"expand",value:function(e){var t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;var n=this.random(t.length),r=t[n];e.actions.splice(n,1);var o=this.reducer(e.state,r),i=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(i),i}},{key:"playout",value:function(e){var t=this,r=e.state,o=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(o=this.playoutDepth(r.G,r.ctx));for(var i=function(e){var n=r,o=n.G,i=n.ctx,a=i.currentPlayer;i.activePlayers&&(a=Object.keys(i.activePlayers)[0]);var s=t.enumerate(o,i,a),c=t.objectives(o,i),l=Object.keys(c).reduce((function(e,t){var n=c[t];return n.checker(o,i)?e+n.weight:e}),0);if(l>0)return{v:{score:l}};if(!s||0==s.length)return{v:void 0};var u=t.random(s.length),p=t.reducer(r,s[u]);r=p},a=0;a<o&&void 0===r.ctx.gameover;a++){var s=i();if("object"===n(s))return s.v}return r.ctx.gameover}},{key:"backpropagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}},{key:"play",value:function(e,t){var n=this,r=this.createNode({state:e,playerID:t}),o=this.getOpt("iterations");"function"==typeof this.iterations&&(o=this.iterations(e.G,e.ctx));var i=function(){var e=null,t=!0,n=!1,o=void 0;try{for(var i,a=r.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;(null==e||s.visits>e.visits)&&(e=s)}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}return{action:e&&e.parentAction,metadata:r}};return new Promise((function(e){var t=function(){for(var e=0;e<25&&n.iterationCounter<o;e++){var t=n.select(r),i=n.expand(t),a=n.playout(i);n.backpropagate(i,a),n.iterationCounter++}n.iterationCallback({iterationCounter:n.iterationCounter,numIterations:o,metadata:r})};if(n.iterationCounter=0,n.getOpt("async")){!function r(){n.iterationCounter<o?(t(),setTimeout(r,0)):e(i())}()}else{for(;n.iterationCounter<o;)t();e(i())}}))}}]),t}(ao),co=function(e){function t(){return r(this,t),d(this,u(t).apply(this,arguments))}return l(t,e),i(t,[{key:"play",value:function(e,t){var n=e.G,r=e.ctx,o=this.enumerate(n,r,t);return Promise.resolve({action:this.random(o)})}}]),t}(ao);async function lo(e,t){var n=e.store.getState(),r=n.ctx.currentPlayer;n.ctx.activePlayers&&(r=Object.keys(n.ctx.activePlayers)[0]);var o=await t.play(n,r),i=o.action,a=o.metadata;return i&&(i.payload.metadata=a,e.store.dispatch(i)),i}function uo(e,t,n){const r=Object.create(e);return r.bot=t[n],r}function po(e){var t,n,r;return{c(){(t=ht("p")).textContent="No bots available.",n=mt(),(r=ht("p")).innerHTML='\n\t\t\t        Follow the instructions\n\t\t\t        <a href="https://boardgame.io/documentation/#/tutorial?id=bots" target="_blank">\n\t\t\t          here</a>\n\t\t\t        to set up bots.\n\t\t\t      '},m(e,o){pt(e,t,o),pt(e,n,o),pt(e,r,o)},p:Ke,i:Ke,o:Ke,d(e){e&&(ft(t),ft(n),ft(r))}}}function fo(e){var t;return{c(){(t=ht("p")).textContent="The bot debugger is only available in singleplayer mode."},m(e,n){pt(e,t,n)},p:Ke,i:Ke,o:Ke,d(e){e&&ft(t)}}}function ho(e){var t,n,r,o,i,a,s,c,l,u,p,f,d,h,y,v,m,g,b=Object.keys(e.bot.opts()).length,w=new xn({props:{value:"1",onPress:e.Reset,label:"reset"}}),x=new xn({props:{value:"2",onPress:e.Step,label:"play"}}),k=new xn({props:{value:"3",onPress:e.Simulate,label:"simulate"}});let $=Object.keys(e.bots),P=[];for(let t=0;t<$.length;t+=1)P[t]=yo(uo(e,$,t));var C=b&&vo(e),O=(e.botAction||e.iterationCounter)&&mo(e);return{c(){t=ht("section"),(n=ht("h3")).textContent="Controls",r=mt(),o=ht("li"),w.$$.fragment.c(),i=mt(),a=ht("li"),x.$$.fragment.c(),s=mt(),c=ht("li"),k.$$.fragment.c(),l=mt(),u=ht("section"),(p=ht("h3")).textContent="Bot",f=mt(),d=ht("select");for(let e=0;e<P.length;e+=1)P[e].c();h=mt(),C&&C.c(),y=mt(),O&&O.c(),v=gt(),wt(n,"class","svelte-hsd9fq"),wt(o,"class","svelte-hsd9fq"),wt(a,"class","svelte-hsd9fq"),wt(c,"class","svelte-hsd9fq"),wt(p,"class","svelte-hsd9fq"),void 0===e.selectedBot&&Gt(()=>e.select_change_handler.call(d)),g=[bt(d,"change",e.select_change_handler),bt(d,"change",e.ChangeBot)]},m(g,b){pt(g,t,b),ut(t,n),ut(t,r),ut(t,o),rn(w,o,null),ut(t,i),ut(t,a),rn(x,a,null),ut(t,s),ut(t,c),rn(k,c,null),pt(g,l,b),pt(g,u,b),ut(u,p),ut(u,f),ut(u,d);for(let e=0;e<P.length;e+=1)P[e].m(d,null);$t(d,e.selectedBot),pt(g,h,b),C&&C.m(g,b),pt(g,y,b),O&&O.m(g,b),pt(g,v,b),m=!0},p(e,t){if(e.bots){let n;for($=Object.keys(t.bots),n=0;n<$.length;n+=1){const r=uo(t,$,n);P[n]?P[n].p(e,r):(P[n]=yo(r),P[n].c(),P[n].m(d,null))}for(;n<P.length;n+=1)P[n].d(1);P.length=$.length}e.selectedBot&&$t(d,t.selectedBot),e.bot&&(b=Object.keys(t.bot.opts()).length),b?C?(C.p(e,t),Qt(C,1)):((C=vo(t)).c(),Qt(C,1),C.m(y.parentNode,y)):C&&(Yt(),Zt(C,1,1,()=>{C=null}),Xt()),t.botAction||t.iterationCounter?O?O.p(e,t):((O=mo(t)).c(),O.m(v.parentNode,v)):O&&(O.d(1),O=null)},i(e){m||(Qt(w.$$.fragment,e),Qt(x.$$.fragment,e),Qt(k.$$.fragment,e),Qt(C),m=!0)},o(e){Zt(w.$$.fragment,e),Zt(x.$$.fragment,e),Zt(k.$$.fragment,e),Zt(C),m=!1},d(e){e&&ft(t),on(w),on(x),on(k),e&&(ft(l),ft(u)),dt(P,e),e&&ft(h),C&&C.d(e),e&&ft(y),O&&O.d(e),e&&ft(v),Xe(g)}}}function yo(e){var t,n,r=e.bot+"";return{c(){t=ht("option"),n=vt(r),t.__value=e.bot,t.value=t.__value},m(e,r){pt(e,t,r),ut(t,n)},p:Ke,d(e){e&&ft(t)}}}function vo(e){var t,n,r,o,i,a,s,c,l,u=new oo({props:{bot:e.bot}});return{c(){t=ht("section"),(n=ht("h3")).textContent="Options",r=mt(),(o=ht("label")).textContent="debug",i=mt(),a=ht("input"),s=mt(),u.$$.fragment.c(),wt(n,"class","svelte-hsd9fq"),wt(o,"class","svelte-hsd9fq"),wt(a,"type","checkbox"),wt(a,"class","svelte-hsd9fq"),l=[bt(a,"change",e.input_change_handler),bt(a,"change",e.OnDebug)]},m(l,p){pt(l,t,p),ut(t,n),ut(t,r),ut(t,o),ut(t,i),ut(t,a),a.checked=e.debug,ut(t,s),rn(u,t,null),c=!0},p(e,t){e.debug&&(a.checked=t.debug);var n={};e.bot&&(n.bot=t.bot),u.$set(n)},i(e){c||(Qt(u.$$.fragment,e),c=!0)},o(e){Zt(u.$$.fragment,e),c=!1},d(e){e&&ft(t),on(u),Xe(l)}}}function mo(e){var t,n,r,o,i=e.progress&&e.progress<1&&go(e),a=e.botAction&&bo(e);return{c(){t=ht("section"),(n=ht("h3")).textContent="Result",r=mt(),i&&i.c(),o=mt(),a&&a.c(),wt(n,"class","svelte-hsd9fq")},m(e,s){pt(e,t,s),ut(t,n),ut(t,r),i&&i.m(t,null),ut(t,o),a&&a.m(t,null)},p(e,n){n.progress&&n.progress<1?i?i.p(e,n):((i=go(n)).c(),i.m(t,o)):i&&(i.d(1),i=null),n.botAction?a?a.p(e,n):((a=bo(n)).c(),a.m(t,null)):a&&(a.d(1),a=null)},d(e){e&&ft(t),i&&i.d(),a&&a.d()}}}function go(e){var t;return{c(){(t=ht("progress")).value=e.progress},m(e,n){pt(e,t,n)},p(e,n){e.progress&&(t.value=n.progress)},d(e){e&&ft(t)}}}function bo(e){var t,n,r,o,i,a,s,c=JSON.stringify(e.botActionArgs)+"";return{c(){t=ht("li"),n=vt("Action: "),r=vt(e.botAction),o=mt(),i=ht("li"),a=vt("Args: "),s=vt(c),wt(t,"class","svelte-hsd9fq"),wt(i,"class","svelte-hsd9fq")},m(e,c){pt(e,t,c),ut(t,n),ut(t,r),pt(e,o,c),pt(e,i,c),ut(i,a),ut(i,s)},p(e,t){e.botAction&&xt(r,t.botAction),e.botActionArgs&&c!==(c=JSON.stringify(t.botActionArgs)+"")&&xt(s,c)},d(e){e&&(ft(t),ft(o),ft(i))}}}function wo(e){var t,n,r,o,i,a=[ho,fo,po],s=[];function c(e,t){return t.client.game.ai&&!t.client.multiplayer?0:t.client.multiplayer?1:2}return n=c(0,e),r=s[n]=a[n](e),{c(){t=ht("section"),r.c(),i=bt(window,"keydown",e.OnKeyDown)},m(e,r){pt(e,t,r),s[n].m(t,null),o=!0},p(e,o){var i=n;(n=c(0,o))===i?s[n].p(e,o):(Yt(),Zt(s[i],1,1,()=>{s[i]=null}),Xt(),(r=s[n])||(r=s[n]=a[n](o)).c(),Qt(r,1),r.m(t,null))},i(e){o||(Qt(r),o=!0)},o(e){Zt(r),o=!1},d(e){e&&ft(t),s[n].d(),i()}}}function xo(e,t,n){let{client:r}=t;const{secondaryPane:o}=Mt("secondaryPane"),i={MCTS:so,Random:co};let a=!1,s=null,c=0,l=null;const u=({iterationCounter:e,numIterations:t,metadata:r})=>{n("iterationCounter",c=e),n("progress",s=e/t),l=r,a&&l&&o.set({component:qr,metadata:l})};let p,f,d,h;function y(){r.overrideGameState(null),o.set(null),n("debug",a=!1)}return r.game.ai&&(n("bot",p=new so({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),p.setOpt("async",!0)),jt(y),e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,bots:i,debug:a,progress:s,iterationCounter:c,OnDebug:function(){a&&l?o.set({component:qr,metadata:l}):o.set(null)},bot:p,selectedBot:f,botAction:d,botActionArgs:h,ChangeBot:function(){n("bot",p=new(0,i[f])({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),p.setOpt("async",!0),n("botAction",d=null),l=null,o.set(null),n("iterationCounter",c=0)},Step:async function(){n("botAction",d=null),l=null,n("iterationCounter",c=0);const e=await lo(r,p);e&&(n("botAction",d=e.payload.type),n("botActionArgs",h=e.payload.args))},Simulate:function(e=1e4,t=100){return n("botAction",d=null),l=null,n("iterationCounter",c=0),(async()=>{for(let n=0;n<e;n++){if(!await lo(r,p))break;await new Promise(e=>setTimeout(e,t))}})()},Reset:function(){r.reset(),n("botAction",d=null),l=null,n("iterationCounter",c=0),y()},OnKeyDown:function(e){27==e.keyCode&&y()},select_change_handler:function(){f=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n("selectedBot",f),n("bots",i)},input_change_handler:function(){a=this.checked,n("debug",a)}}}class ko extends cn{constructor(e){var t;super(),document.getElementById("svelte-hsd9fq-style")||((t=ht("style")).id="svelte-hsd9fq-style",t.textContent="li.svelte-hsd9fq{list-style:none;margin:none;margin-bottom:5px}h3.svelte-hsd9fq{text-transform:uppercase}label.svelte-hsd9fq{font-weight:bold;color:#999}input[type='checkbox'].svelte-hsd9fq{vertical-align:middle}",ut(document.head,t)),sn(this,e,xo,wo,Ze,["client"])}}function $o(e){var t,n,r,o,i,a,s=new mn({props:{panes:e.panes,pane:e.pane}});s.$on("change",e.MenuChange);var c=e.panes[e.pane].component;function l(e){return{props:{client:e.client}}}if(c)var u=new c(l(e));var p=e.$secondaryPane&&Po(e);return{c(){t=ht("div"),s.$$.fragment.c(),n=mt(),r=ht("div"),u&&u.$$.fragment.c(),o=mt(),p&&p.c(),wt(r,"class","pane svelte-1h5kecx"),wt(t,"class","debug-panel svelte-1h5kecx")},m(e,i){pt(e,t,i),rn(s,t,null),ut(t,n),ut(t,r),u&&rn(u,r,null),ut(t,o),p&&p.m(t,null),a=!0},p(e,n){var o={};e.pane&&(o.pane=n.pane),s.$set(o);var i={};if(e.client&&(i.client=n.client),c!==(c=n.panes[n.pane].component)){if(u){Yt();const e=u;Zt(e.$$.fragment,1,0,()=>{on(e,1)}),Xt()}c?((u=new c(l(n))).$$.fragment.c(),Qt(u.$$.fragment,1),rn(u,r,null)):u=null}else c&&u.$set(i);n.$secondaryPane?p?(p.p(e,n),Qt(p,1)):((p=Po(n)).c(),Qt(p,1),p.m(t,null)):p&&(Yt(),Zt(p,1,1,()=>{p=null}),Xt())},i(e){a||(Qt(s.$$.fragment,e),u&&Qt(u.$$.fragment,e),Qt(p),Gt(()=>{i||(i=tn(t,fn,{x:400},!0)),i.run(1)}),a=!0)},o(e){Zt(s.$$.fragment,e),u&&Zt(u.$$.fragment,e),Zt(p),i||(i=tn(t,fn,{x:400},!1)),i.run(0),a=!1},d(e){e&&ft(t),on(s),u&&on(u),p&&p.d(),e&&i&&i.end()}}}function Po(e){var t,n,r=e.$secondaryPane.component;function o(e){return{props:{metadata:e.$secondaryPane.metadata}}}if(r)var i=new r(o(e));return{c(){t=ht("div"),i&&i.$$.fragment.c(),wt(t,"class","secondary-pane svelte-1h5kecx")},m(e,r){pt(e,t,r),i&&rn(i,t,null),n=!0},p(e,n){var a={};if(e.$secondaryPane&&(a.metadata=n.$secondaryPane.metadata),r!==(r=n.$secondaryPane.component)){if(i){Yt();const e=i;Zt(e.$$.fragment,1,0,()=>{on(e,1)}),Xt()}r?((i=new r(o(n))).$$.fragment.c(),Qt(i.$$.fragment,1),rn(i,t,null)):i=null}else r&&i.$set(a)},i(e){n||(i&&Qt(i.$$.fragment,e),n=!0)},o(e){i&&Zt(i.$$.fragment,e),n=!1},d(e){e&&ft(t),i&&on(i)}}}function Co(e){var t,n,r,o=e.visible&&$o(e);return{c(){o&&o.c(),t=gt(),r=bt(window,"keypress",e.Keypress)},m(e,r){o&&o.m(e,r),pt(e,t,r),n=!0},p(e,n){n.visible?o?(o.p(e,n),Qt(o,1)):((o=$o(n)).c(),Qt(o,1),o.m(t.parentNode,t)):o&&(Yt(),Zt(o,1,1,()=>{o=null}),Xt())},i(e){n||(Qt(o),n=!0)},o(e){Zt(o),n=!1},d(e){o&&o.d(e),e&&ft(t),r()}}}function Oo(e,t,n){let r,{client:o}=t;const i={main:{label:"Main",shortcut:"m",component:Wn},log:{label:"Log",shortcut:"l",component:Yr},info:{label:"Info",shortcut:"i",component:tr},ai:{label:"AI",shortcut:"a",component:ko}},a=un(!1),s=un(null);et(e,s,e=>{r=e,n("$secondaryPane",r)}),Nt("hotkeys",{disableHotkeys:a}),Nt("secondaryPane",{secondaryPane:s});let c="main";let l=!0;return e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,panes:i,secondaryPane:s,pane:c,MenuChange:function(e){n("pane",c=e.detail)},visible:l,Keypress:function(e){"."!=e.key?Object.entries(i).forEach(([t,{shortcut:r}])=>{e.key==r&&n("pane",c=t)}):n("visible",l=!l)},$secondaryPane:r}}class Io extends cn{constructor(e){var t;super(),document.getElementById("svelte-1h5kecx-style")||((t=ht("style")).id="svelte-1h5kecx-style",t.textContent=".debug-panel.svelte-1h5kecx{position:fixed;color:#555;font-family:monospace;display:flex;flex-direction:row;text-align:left;right:0;top:0;height:100%;font-size:14px;box-sizing:border-box;opacity:0.9}.pane.svelte-1h5kecx{flex-grow:2;overflow-x:hidden;overflow-y:scroll;background:#fefefe;padding:20px;border-left:1px solid #ccc;box-shadow:-1px 0 5px rgba(0, 0, 0, 0.2);box-sizing:border-box;width:280px}.secondary-pane.svelte-1h5kecx{background:#fefefe;overflow-y:scroll}.debug-panel.svelte-1h5kecx button, select{cursor:pointer;outline:none;background:#eee;border:1px solid #bbb;color:#555;padding:3px;border-radius:3px}.debug-panel.svelte-1h5kecx button{padding-left:10px;padding-right:10px}.debug-panel.svelte-1h5kecx button:hover{background:#ddd}.debug-panel.svelte-1h5kecx button:active{background:#888;color:#fff}.debug-panel.svelte-1h5kecx section{margin-bottom:20px}",ut(document.head,t)),sn(this,e,Oo,Co,Ze,["client"])}}function Do({game:e,numPlayers:t,setupData:n}){t||(t=2);let r={G:{},ctx:(e=He(e)).flow.ctx(t),plugins:{}};r=((e,t)=>([...Ae,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(n=>{const r=n.name,o=n.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[r]:{data:o}}}}),e))(r,{game:e}),r=je(r,{game:e});const o=Se(r);r.G=e.setup(o,n);let i={...r,_undo:[],_redo:[],_stateID:0};return i=e.flow.init(i),i=Be(i,{game:e}),i}function Eo(e,t,n,r,o,i){return t.reduce((function(t,a){return t[a]=function(){var t=r;if(!i&&null==r){var s=n.getState();t=s.ctx.currentPlayer}for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];n.dispatch(M[e](a,l,t,o))},t}),{})}var Ao=Eo.bind(null,"makeMove"),So=Eo.bind(null,"gameEvent"),_o=Eo.bind(null,"plugin"),jo=function(){function e(t){var n=this,o=t.game,i=t.debug,a=t.numPlayers,s=t.multiplayer,c=t.gameID,l=t.playerID,u=t.credentials,p=t.enhancer;r(this,e),this.game=He(o),this.playerID=l,this.gameID=c,this.credentials=u,this.multiplayer=s,this.debug=i,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=io({game:this.game,isClient:void 0!==s,numPlayers:a}),this.initialState=null,s||(this.initialState=Do({game:this.game,numPlayers:a})),this.reset=function(){n.store.dispatch(A(n.initialState))},this.undo=function(){n.store.dispatch({type:"UNDO"})},this.redo=function(){n.store.dispatch({type:"REDO"})},this.store=null,this.log=[];var f=function(e){return function(t){return function(r){var o=t(r),i=e.getState();switch(r.type){case"MAKE_MOVE":case"GAME_EVENT":var a=i.deltalog;n.log=[].concat(h(n.log),h(a));break;case"RESET":n.log=[];break;case"UPDATE":var s=-1;n.log.length>0&&(s=n.log[n.log.length-1]._stateID);var c=r.deltalog||[];c=c.filter((function(e){return e._stateID>s})),n.log=[].concat(h(n.log),h(c));break;case"SYNC":n.initialState=r.initialState,n.log=r.log||[]}return o}}},d=function(e){return function(t){return function(r){var o=e.getState(),i=t(r);return 1!=r.clientOnly&&n.transport.onAction(o,r),i}}},y=function(){return function(e){return function(t){var r=e(t);return n.notifySubscribers(),r}}};p=void 0!==p?$(P(y,d,f),p):P(y,d,f),this.store=b(this.reducer,this.initialState,p),this.transport={isConnected:!0,onAction:function(){},subscribe:function(){},subscribeGameMetadata:function(e){},connect:function(){},disconnect:function(){},updateGameID:function(){},updatePlayerID:function(){}},s&&(this.transport=s({gameKey:o,game:this.game,store:this.store,gameID:c,playerID:l,gameName:this.game.name,numPlayers:a})),this.createDispatchers(),this.transport.subscribeGameMetadata((function(e){n.gameMetadata=e})),this._debugPanel=null}return i(e,[{key:"notifySubscribers",value:function(){var e=this;Object.values(this.subscribers).forEach((function(t){return t(e.getState())}))}},{key:"overrideGameState",value:function(e){this.gameStateOverride=e,this.notifySubscribers()}},{key:"start",value:function(){this.transport.connect(),this._running=!0;var e=null;if(e=Io,this.debug&&this.debug.impl&&(e=this.debug.impl),null!==e&&!1!==this.debug&&null==this._debugPanel&&"undefined"!=typeof document){var t=document.body;this.debug&&void 0!==this.debug.target&&(t=this.debug.target),t&&(this._debugPanel=new e({target:t,props:{client:this}}))}}},{key:"stop",value:function(){this.transport.disconnect(),this._running=!1,null!=this._debugPanel&&(this._debugPanel.$destroy(),this._debugPanel=null)}},{key:"subscribe",value:function(e){var t=this,n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribe((function(){return t.notifySubscribers()})),!this._running&&this.multiplayer||e(this.getState()),function(){delete t.subscribers[n]}}},{key:"getInitialState",value:function(){return this.initialState}},{key:"getState",value:function(){var e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;var t=!0,n=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);var r=c({},e,{isActive:t,G:this.game.playerView(e.G,e.ctx,this.playerID),log:this.log});return r=c({},r,{isConnected:this.transport.isConnected})}},{key:"createDispatchers",value:function(){this.moves=Ao(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=So(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=_o(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}},{key:"updatePlayerID",value:function(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}},{key:"updateGameID",value:function(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e),this.notifySubscribers()}},{key:"updateCredentials",value:function(e){this.credentials=e,this.createDispatchers(),this.notifySubscribers()}}]),e}();function Bo(e){return new jo(e)}var No="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Mo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function To(e,t){return e(t={exports:{}},t.exports),t.exports}var Ro=To((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,d=n?Symbol.for("react.suspense"):60113,h=n?Symbol.for("react.suspense_list"):60120,y=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,m=n?Symbol.for("react.fundamental"):60117,g=n?Symbol.for("react.responder"):60118;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case p:case i:case s:case a:case d:return e;default:switch(e=e&&e.$$typeof){case l:case f:case c:return e;default:return t}}case v:case y:case o:return t}}}function w(e){return b(e)===p}t.typeOf=b,t.AsyncMode=u,t.ConcurrentMode=p,t.ContextConsumer=l,t.ContextProvider=c,t.Element=r,t.ForwardRef=f,t.Fragment=i,t.Lazy=v,t.Memo=y,t.Portal=o,t.Profiler=s,t.StrictMode=a,t.Suspense=d,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===p||e===s||e===a||e===d||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===y||e.$$typeof===c||e.$$typeof===l||e.$$typeof===f||e.$$typeof===m||e.$$typeof===g)},t.isAsyncMode=function(e){return w(e)||b(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return b(e)===l},t.isContextProvider=function(e){return b(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return b(e)===f},t.isFragment=function(e){return b(e)===i},t.isLazy=function(e){return b(e)===v},t.isMemo=function(e){return b(e)===y},t.isPortal=function(e){return b(e)===o},t.isProfiler=function(e){return b(e)===s},t.isStrictMode=function(e){return b(e)===a},t.isSuspense=function(e){return b(e)===d}}));Mo(Ro);Ro.typeOf,Ro.AsyncMode,Ro.ConcurrentMode,Ro.ContextConsumer,Ro.ContextProvider,Ro.Element,Ro.ForwardRef,Ro.Fragment,Ro.Lazy,Ro.Memo,Ro.Portal,Ro.Profiler,Ro.StrictMode,Ro.Suspense,Ro.isValidElementType,Ro.isAsyncMode,Ro.isConcurrentMode,Ro.isContextConsumer,Ro.isContextProvider,Ro.isElement,Ro.isForwardRef,Ro.isFragment,Ro.isLazy,Ro.isMemo,Ro.isPortal,Ro.isProfiler,Ro.isStrictMode,Ro.isSuspense;var qo=To((function(e,t){}));Mo(qo);qo.typeOf,qo.AsyncMode,qo.ConcurrentMode,qo.ContextConsumer,qo.ContextProvider,qo.Element,qo.ForwardRef,qo.Fragment,qo.Lazy,qo.Memo,qo.Portal,qo.Profiler,qo.StrictMode,qo.Suspense,qo.isValidElementType,qo.isAsyncMode,qo.isConcurrentMode,qo.isContextConsumer,qo.isContextProvider,qo.isElement,qo.isForwardRef,qo.isFragment,qo.isLazy,qo.isMemo,qo.isPortal,qo.isProfiler,qo.isStrictMode,qo.isSuspense,To((function(e){e.exports=Ro}));var zo=Object.getOwnPropertySymbols,Fo=Object.prototype.hasOwnProperty,Lo=Object.prototype.propertyIsEnumerable;function Uo(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}})()&&Object.assign,Function.call.bind(Object.prototype.hasOwnProperty);function Go(){}function Ho(){}Ho.resetWarningCache=Go;var Ko,Vo=To((function(e){e.exports=function(){function e(e,t,n,r,o,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Ho,resetWarningCache:Go};return n.PropTypes=n,n}()}));!function(e){e[e.SYNC=0]="SYNC",e[e.ASYNC=1]="ASYNC"}(Ko||(Ko={}));class Wo extends class{type(){return Ko.SYNC}connect(){}}{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createGame(e,t){this.initial.set(e,t.initialState),this.setState(e,t.initialState),this.setMetadata(e,t.metadata)}setMetadata(e,t){this.metadata.set(e,t)}setState(e,t,n){if(n&&n.length>0){const t=this.log.get(e)||[];this.log.set(e,t.concat(n))}this.state.set(e,t)}fetch(e,t){let n={};return t.state&&(n.state=this.state.get(e)),t.metadata&&(n.metadata=this.metadata.get(e)),t.log&&(n.log=this.log.get(e)||[]),t.initialState&&(n.initialState=this.initial.get(e)),n}wipe(e){this.state.delete(e),this.metadata.delete(e)}listGames(e){if(e&&void 0!==e.gameName){let t=[];return this.metadata.forEach((n,r)=>{n.gameName===e.gameName&&t.push(r)}),t}return[...this.metadata.keys()]}}const Jo=(e,t)=>{if(e&&e.players)return e.players[t]};function Yo(e){return e.type()===Ko.SYNC}function Xo(e,t){return void 0===e?e:e.map(e=>{if(null!==t&&+t==+e.action.payload.playerID)return e;if(!0!==e.redact)return e;const n={...e.action.payload,args:null},r={...e,action:{...e.action,payload:n}},{redact:o,...i}=r;return i})}const Qo=e=>{if(!e)return!1;const{players:t}=e;return Object.keys(t).some(e=>!(!t[e]||!t[e].credentials))},Zo=(e,t)=>!!e&&(!!t&&e===t.credentials);class ei{constructor(e,t,n,r){this.game=He(e),this.storageAPI=t,this.transportAPI=n,this.auth=null,this.subscribeCallback=()=>{},this.shouldAuth=()=>!1,!0===r?(this.auth=Zo,this.shouldAuth=Qo):"function"==typeof r&&(this.auth=r,this.shouldAuth=()=>!0)}subscribe(e){this.subscribeCallback=e}async onUpdate(e,t,n,r){let o;const i="payload"in e&&"credentials"in e.payload?e.payload.credentials:void 0;if(Yo(this.storageAPI)){const{metadata:e}=this.storageAPI.fetch(n,{metadata:!0}),t=Jo(e,r);o=!this.shouldAuth(e)||this.auth(i,t)}else{const{metadata:e}=await this.storageAPI.fetch(n,{metadata:!0}),t=Jo(e,r);o=!this.shouldAuth(e)||await this.auth(i,t)}if(!o)return{error:"unauthorized action"};e=(e=>{if("payload"in e&&"credentials"in e.payload){const{credentials:t,...n}=e.payload;return{...e,payload:n}}return e})(e);const a=n;let s,c;if(c=Yo(this.storageAPI)?this.storageAPI.fetch(a,{state:!0}):await this.storageAPI.fetch(a,{state:!0}),s=c.state,void 0===s)return Te(`game not found, gameID=[${a}]`),{error:"game not found"};if(void 0!==s.ctx.gameover)return void Te(`game over - gameID=[${a}]`);const l=b(io({game:this.game}),s);if(!("UNDO"!=e.type&&"REDO"!=e.type||s.ctx.currentPlayer===r&&null===s.ctx.activePlayers))return void Te(`playerID=[${r}] cannot undo / redo right now`);if(!this.game.flow.isPlayerActive(s.G,s.ctx,r))return void Te(`player not active - playerID=[${r}]`);if("MAKE_MOVE"==e.type&&!this.game.flow.getMove(s.ctx,e.payload.type,r))return void Te(`move not processed - canPlayerMakeMove=false, playerID=[${r}]`);if(s._stateID!==t)return void Te(`invalid stateID, was=[${t}], expected=[${s._stateID}]`);l.dispatch(e),s=l.getState(),this.subscribeCallback({state:s,action:e,gameID:n}),this.transportAPI.sendAll(e=>{const t={...s,G:this.game.playerView(s.G,s.ctx,e),deltalog:void 0,_undo:[],_redo:[]},r=Xo(s.deltalog,e);return{type:"update",args:[n,t,r]}});const{deltalog:u,...p}=s;Yo(this.storageAPI)?this.storageAPI.setState(a,p,u):await this.storageAPI.setState(a,p,u)}async onSync(e,t,n){const r=e;let o,i,a,s,c,l;if(Yo(this.storageAPI)){l=this.storageAPI.fetch(r,{state:!0,metadata:!0,log:!0,initialState:!0})}else l=await this.storageAPI.fetch(r,{state:!0,metadata:!0,log:!0,initialState:!0});if(o=l.state,i=l.initialState,a=l.log,s=l.metadata,s&&(c=Object.values(s.players).map(e=>({id:e.id,name:e.name}))),void 0===o)if(i=o=Do({game:this.game,numPlayers:n}),this.subscribeCallback({state:o,gameID:e}),Yo(this.storageAPI)){this.storageAPI.setState(r,o)}else await this.storageAPI.setState(r,o);const u={...o,G:this.game.playerView(o.G,o.ctx,t),deltalog:void 0,_undo:[],_redo:[]};a=Xo(a,t);const p={state:u,log:a,filteredMetadata:c,initialState:i};this.transportAPI.send({playerID:t,type:"sync",args:[e,p]})}}var ti=function e(t){var n=t.store,o=t.gameName,i=t.playerID,a=t.gameID,s=t.numPlayers;r(this,e),this.store=n,this.gameName=o||"default",this.playerID=i||null,this.gameID=a||"default",this.numPlayers=s||2};function ni(e){var t=e.game,n=e.bots,r={},o={};if(t&&t.ai&&n)for(var i in n){var a=n[i];o[i]=new a({game:t,enumerate:t.ai.enumerate,seed:t.seed})}var s=function(e){var t=e.type,n=e.playerID,o=e.args,i=r[n];void 0!==i&&i.apply(null,[t].concat(h(o)))},c=new ei(t,new Wo,{send:s,sendAll:function(e){for(var t in r){var n=e(t),o=n.type,i=n.args;s({type:o,playerID:t,args:i})}}},!1);return c.connect=function(e,t,n){r[t]=n},c.subscribe((function(e){var t=e.state,r=e.gameID;if(n){var i=function(e,t){if(void 0!==e.ctx.gameover)return null;if(e.ctx.stage)for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];if(o in e.ctx.stage)return o}else if(e.ctx.currentPlayer in t)return e.ctx.currentPlayer;return null}(t,o);null!==i&&setTimeout((async function(){var e=await o[i].play(t,i);await c.onUpdate(e.action,t._stateID,r,e.action.payload.playerID)}),100)}})),c}var ri=function(e){function t(e){var n,o=e.master,i=e.game,a=e.store,s=e.gameID,c=e.playerID,l=e.gameName,p=e.numPlayers;return r(this,t),(n=d(this,u(t).call(this,{store:a,gameName:l,playerID:c,gameID:s,numPlayers:p}))).master=o,n.game=i,n.isConnected=!0,n}return l(t,e),i(t,[{key:"onUpdate",value:async function(e,t,n){var r=this.store.getState();if(e==this.gameID&&t._stateID>=r._stateID){var o=E(t,n);this.store.dispatch(o)}}},{key:"onSync",value:function(e,t){if(e==this.gameID){var n=D(t);this.store.dispatch(n)}}},{key:"onAction",value:function(e,t){this.master.onUpdate(t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;this.master.connect(this.gameID,this.playerID,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];"sync"==t&&e.onSync.apply(e,r),"update"==t&&e.onUpdate.apply(e,r)})),this.master.onSync(this.gameID,this.playerID,this.numPlayers)}},{key:"disconnect",value:function(){}},{key:"subscribe",value:function(){}},{key:"subscribeGameMetadata",value:function(e){}},{key:"updateGameID",value:function(e){this.gameID=e;var t=A(null);this.store.dispatch(t),this.connect()}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=A(null);this.store.dispatch(t),this.connect()}}]),t}(ti),oi=new Map;var ii=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ai=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],si=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o=ii.exec(e||""),i={},a=14;a--;)i[ai[a]]=o[a]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},ci=1e3,li=6e4,ui=36e5,pi=24*ui,fi=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*pi;case"hours":case"hour":case"hrs":case"hr":case"h":return n*ui;case"minutes":case"minute":case"mins":case"min":case"m":return n*li;case"seconds":case"second":case"secs":case"sec":case"s":return n*ci;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){return di(e,pi,"day")||di(e,ui,"hour")||di(e,li,"minute")||di(e,ci,"second")||e+" ms"}(e):function(e){if(e>=pi)return Math.round(e/pi)+"d";if(e>=ui)return Math.round(e/ui)+"h";if(e>=li)return Math.round(e/li)+"m";if(e>=ci)return Math.round(e/ci)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function di(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var hi=To((function(e,t){function n(e){var n;function o(){if(o.enabled){var e=o,r=+new Date,i=r-(n||r);e.diff=i,e.prev=n,e.curr=r,n=r;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=a[c];n=o.call(e,i),a.splice(c,1),c--}return n})),t.formatArgs.call(e,a);var l=o.log||t.log||console.log.bind(console);l.apply(e,a)}}return o.namespace=e,o.enabled=t.enabled(e),o.useColors=t.useColors(),o.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),o.destroy=r,"function"==typeof t.init&&t.init(o),t.instances.push(o),o}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=fi,t.instances=[],t.names=[],t.skips=[],t.formatters={}})),yi=(hi.coerce,hi.disable,hi.enable,hi.enabled,hi.humanize,hi.instances,hi.names,hi.skips,hi.formatters,To((function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=hi).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))})),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}))),vi=(yi.log,yi.formatArgs,yi.save,yi.load,yi.useColors,yi.storage,yi.colors,yi("socket.io-client:url")),mi=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(vi("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),vi("parse %s",e),n=si(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n};var gi=To((function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}})),bi={}.toString,wi=Array.isArray||function(e){return"[object Array]"==bi.call(e)},xi=function(e){return ki&&Buffer.isBuffer(e)||$i&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))},ki="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,$i="function"==typeof ArrayBuffer;var Pi=Object.prototype.toString,Ci="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Pi.call(Blob),Oi="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Pi.call(File);var Ii=function(e){var t=[],n=e.data,r=e;return r.data=function e(t,n){if(!t)return t;if(xi(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(wi(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=e(t[i],n);return o}if("object"==typeof t&&!(t instanceof Date)){o={};for(var a in t)o[a]=e(t[a],n);return o}return t}(n,t),r.attachments=t.length,{packet:r,buffers:t}},Di=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(wi(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],n);return t}(e.data,t),e.attachments=void 0,e},Ei=function(e,t){var n=0,r=e;!function e(o,i,a){if(!o)return o;if(Ci&&o instanceof Blob||Oi&&o instanceof File){n++;var s=new FileReader;s.onload=function(){a?a[i]=this.result:r=this.result,--n||t(r)},s.readAsArrayBuffer(o)}else if(wi(o))for(var c=0;c<o.length;c++)e(o[c],c,o);else if("object"==typeof o&&!xi(o))for(var l in o)e(o[l],l,o)}(r),n||t(r)},Ai=To((function(e,t){var n=yi("socket.io-parser");function r(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=a;var o=t.ERROR+'"encode error"';function i(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return o;r+=i}return n("encoded %j as %s",e,r),r}function a(){this.reconstructor=null}function s(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}r.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){Ei(e,(function(e){var n=Ii(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)}))}(e,r):r([i(e)])},gi(a.prototype),a.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return c("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(r+1))for(o.nsp="";++r;){if(","===(s=e.charAt(r)))break;if(o.nsp+=s,r===e.length)break}else o.nsp="/";var a=e.charAt(r+1);if(""!==a&&Number(a)==a){for(o.id="";++r;){var s;if(null==(s=e.charAt(r))||Number(s)!=s){--r;break}if(o.id+=e.charAt(r),r===e.length)break}o.id=Number(o.id)}if(e.charAt(++r)){var l=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r));if(!(!1!==l&&(o.type===t.ERROR||wi(l))))return c("invalid payload");o.data=l}return n("decoded %s as %j",e,o),o}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new s(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!xi(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},s.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Di(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},s.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}})),Si=(Ai.protocol,Ai.types,Ai.CONNECT,Ai.DISCONNECT,Ai.EVENT,Ai.ACK,Ai.ERROR,Ai.BINARY_EVENT,Ai.BINARY_ACK,Ai.Encoder,Ai.Decoder,To((function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}))),_i=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Si))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},ji=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},Bi={}.toString,Ni=Array.isArray||function(e){return"[object Array]"==Bi.call(e)},Mi=Object.prototype.toString,Ti="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Mi.call(Blob),Ri="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Mi.call(File),qi=function e(t){if(!t||"object"!=typeof t)return!1;if(Ni(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||Ti&&t instanceof Blob||Ri&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1};var zi=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)i[s]=o[a];return i.buffer},Fi=function(e,t,n){var r=!1;return n=n||Li,o.count=e,0===e?t():o;function o(e,i){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(r=!0,t(e),t=n):0!==o.count||r||t(null,i)}};function Li(){}
/*! https://mths.be/utf8js v2.1.2 by @mathias */var Ui,Gi,Hi,Ki=String.fromCharCode;function Vi(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function Wi(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Ji(e,t){return Ki(e>>t&63|128)}function Yi(e,t){if(0==(4294967168&e))return Ki(e);var n="";return 0==(4294965248&e)?n=Ki(e>>6&31|192):0==(4294901760&e)?(Wi(e,t)||(e=65533),n=Ki(e>>12&15|224),n+=Ji(e,6)):0==(4292870144&e)&&(n=Ki(e>>18&7|240),n+=Ji(e,12),n+=Ji(e,6)),n+=Ki(63&e|128)}function Xi(){if(Hi>=Gi)throw Error("Invalid byte index");var e=255&Ui[Hi];if(Hi++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function Qi(e){var t,n;if(Hi>Gi)throw Error("Invalid byte index");if(Hi==Gi)return!1;if(t=255&Ui[Hi],Hi++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|Xi())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|Xi()<<6|Xi())>=2048)return Wi(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|Xi()<<12|Xi()<<6|Xi())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var Zi={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=Vi(e),o=r.length,i=-1,a="";++i<o;)a+=Yi(r[i],n);return a},decode:function(e,t){var n=!1!==(t=t||{}).strict;Ui=Vi(e),Gi=Ui.length,Hi=0;for(var r,o=[];!1!==(r=Qi(n));)o.push(r);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)(t=e[r])>65535&&(o+=Ki((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=Ki(t);return o}(o)}},ea=To((function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,a,s=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),p=new Uint8Array(u);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],a=n[e.charCodeAt(t+3)],p[l++]=r<<2|o>>4,p[l++]=(15&o)<<4|i>>2,p[l++]=(3&i)<<6|63&a;return u}}()})),ta=(ea.encode,ea.decode,void 0!==ta?ta:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder),na=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),ra=na&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),oa=ta&&ta.prototype.append&&ta.prototype.getBlob;function ia(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function aa(e,t){t=t||{};var n=new ta;return ia(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function sa(e,t){return new Blob(ia(e),t||{})}"undefined"!=typeof Blob&&(aa.prototype=Blob.prototype,sa.prototype=Blob.prototype);var ca=na?ra?Blob:sa:oa?aa:void 0,la=To((function(e,t){var n;"undefined"!=typeof ArrayBuffer&&(n=ea);var r="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),o="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),i=r||o;t.protocol=3;var a=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=ji(a),c={type:"error",data:"parser error"};function l(e,t,n){for(var r=new Array(e.length),o=Fi(e.length,n),i=function(e,n,o){t(n,(function(t,n){r[e]=n,o(t,r)}))},a=0;a<e.length;a++)i(a,e[a],o)}t.encodePacket=function(e,n,r,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof r&&(o=r,r=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=e.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=a[e.type];for(var c=0;c<i.length;c++)s[c+1]=i[c];return r(s.buffer)}(e,n,o);if(void 0!==ca&&s instanceof ca)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(i)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=new FileReader;return o.onload=function(){t.encodePacket({type:e.type,data:o.result},n,!0,r)},o.readAsArrayBuffer(e.data)}(e,n,r);var o=new Uint8Array(1);o[0]=a[e.type];var s=new ca([o.buffer,e.data]);return r(s)}(e,n,o);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,o);var c=a[e.type];return void 0!==e.data&&(c+=r?Zi.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,n){var r,o="b"+t.packets[e.type];if(void 0!==ca&&e.data instanceof ca){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(o+e)},i.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];r=String.fromCharCode.apply(null,s)}return o+=btoa(r),n(o)},t.decodePacket=function(e,n,r){if(void 0===e)return c;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=Zi.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return c;var o=e.charAt(0);return Number(o)==o&&s[o]?e.length>1?{type:s[o],data:e.substring(1)}:{type:s[o]}:c}o=new Uint8Array(e)[0];var i=zi(e,1);return ca&&"blob"===n&&(i=new ca([i])),{type:s[o],data:i}},t.decodeBase64Packet=function(e,t){var r=s[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=n.decode(e.substr(1));return"blob"===t&&ca&&(o=new ca([o])),{type:r,data:o}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var o=qi(e);if(n&&o)return ca&&!i?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");l(e,(function(e,r){t.encodePacket(e,!!o&&n,!1,(function(e){r(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return r(t.join(""))}))},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var o;if("function"==typeof n&&(r=n,n=null),""===e)return r(c,0,1);for(var i,a,s="",l=0,u=e.length;l<u;l++){var p=e.charAt(l);if(":"===p){if(""===s||s!=(i=Number(s)))return r(c,0,1);if(s!=(a=e.substr(l+1,i)).length)return r(c,0,1);if(a.length){if(o=t.decodePacket(a,n,!1),c.type===o.type&&c.data===o.data)return r(c,0,1);if(!1===r(o,l+i,u))return}l+=i,s=""}else s+=p}return""!==s?r(c,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));l(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var r=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),o=new Uint8Array(r),i=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}o[i++]=t?0:1;var s=n.byteLength.toString();for(a=0;a<s.length;a++)o[i++]=parseInt(s[a]);o[i++]=255;for(r=new Uint8Array(n),a=0;a<r.length;a++)o[i++]=r[a]})),n(o.buffer)}))},t.encodePayloadAsBlob=function(e,n){l(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)a[o]=parseInt(i[o]);if(a[i.length]=255,ca){var s=new ca([t.buffer,a.buffer,e]);n(null,s)}}))}),(function(e,t){return n(new ca(t))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o=e,i=[];o.byteLength>0;){for(var a=new Uint8Array(o),s=0===a[0],l="",u=1;255!==a[u];u++){if(l.length>310)return r(c,0,1);l+=a[u]}o=zi(o,2+l.length),l=parseInt(l);var p=zi(o,0,l);if(s)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var f=new Uint8Array(p);p="";for(u=0;u<f.length;u++)p+=String.fromCharCode(f[u])}i.push(p),o=zi(o,l)}var d=i.length;i.forEach((function(e,o){r(t.decodePacket(e,n,!0),o,d)}))}})),ua=(la.protocol,la.packets,la.encodePacket,la.encodeBase64Packet,la.decodePacket,la.decodeBase64Packet,la.encodePayload,la.decodePayload,la.encodePayloadAsArrayBuffer,la.encodePayloadAsBlob,la.decodePayloadAsBinary,pa);function pa(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}gi(pa.prototype),pa.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},pa.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},pa.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},pa.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},pa.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},pa.prototype.onData=function(e){var t=la.decodePacket(e,this.socket.binaryType);this.onPacket(t)},pa.prototype.onPacket=function(e){this.emit("packet",e)},pa.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var fa,da=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},ha=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t},ya=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},va="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ma={},ga=0,ba=0;function wa(e){var t="";do{t=va[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function xa(){var e=wa(+new Date);return e!==fa?(ga=0,fa=e):e+"."+wa(ga++)}for(;ba<64;ba++)ma[va[ba]]=ba;xa.encode=wa,xa.decode=function(e){var t=0;for(ba=0;ba<e.length;ba++)t=64*t+ma[e.charAt(ba)];return t};var ka=xa,$a=yi("engine.io-client:polling"),Pa=Oa,Ca=null!=new _i({xdomain:!1}).responseType;function Oa(e){var t=e&&e.forceBase64;Ca&&!t||(this.supportsBinary=!1),ua.call(this,e)}ya(Oa,ua),Oa.prototype.name="polling",Oa.prototype.doOpen=function(){this.poll()},Oa.prototype.pause=function(e){var t=this;function n(){$a("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&($a("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){$a("pre-pause polling complete"),--r||n()}))),this.writable||($a("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){$a("pre-pause writing complete"),--r||n()})))}else n()},Oa.prototype.poll=function(){$a("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Oa.prototype.onData=function(e){var t=this;$a("polling got data %s",e);la.decodePayload(e,this.socket.binaryType,(function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():$a('ignoring poll - transport state "%s"',this.readyState))},Oa.prototype.doClose=function(){var e=this;function t(){$a("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?($a("transport open - closing"),t()):($a("transport not open - deferring close"),this.once("open",t))},Oa.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};la.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},Oa.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=ka()),this.supportsBinary||e.sid||(e.b64=1),e=da(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var Ia=yi("engine.io-client:polling-xhr"),Da=Sa,Ea=_a;function Aa(){}function Sa(e){if(Pa.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function _a(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(ya(Sa,Pa),Sa.prototype.supportsBinary=!0,Sa.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new _a(e)},Sa.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",(function(e){o.onError("xhr post error",e)})),this.sendXhr=r},Sa.prototype.doPoll=function(){Ia("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},gi(_a.prototype),_a.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new _i(e),n=this;try{Ia("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError(t.status)}),0))},Ia("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=_a.requestsCount++,_a.requests[this.index]=this)},_a.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},_a.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},_a.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},_a.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=Aa:this.xhr.onreadystatechange=Aa,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete _a.requests[this.index],this.xhr=null}},_a.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},_a.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},_a.prototype.abort=function(){this.cleanup()},_a.requestsCount=0,_a.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",Ba);else if("function"==typeof addEventListener){var ja="onpagehide"in self?"pagehide":"unload";addEventListener(ja,Ba,!1)}function Ba(){for(var e in _a.requests)_a.requests.hasOwnProperty(e)&&_a.requests[e].abort()}Da.Request=Ea;var Na,Ma=Fa,Ta=/\n/g,Ra=/\\n/g;function qa(){}function za(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==No?No:{}}function Fa(e){if(Pa.call(this,e),this.query=this.query||{},!Na){var t=za();Na=t.___eio=t.___eio||[]}this.index=Na.length;var n=this;Na.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=qa)}),!1)}ya(Fa,Pa),Fa.prototype.supportsBinary=!1,Fa.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Pa.prototype.doClose.call(this)},Fa.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},Fa.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function s(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(Ra,"\\\n"),this.area.value=e.replace(Ta,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&s()}:this.iframe.onload=s};var La,Ua,Ga=yi("engine.io-client:websocket");if("undefined"!=typeof WebSocket)La=WebSocket;else if("undefined"!=typeof self)La=self.WebSocket||self.MozWebSocket;else try{Ua={}}catch(e){}var Ha=La||Ua,Ka=Va;function Va(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=La&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(Ha=Ua),ua.call(this,e)}ya(Va,ua),Va.prototype.name="websocket",Va.prototype.supportsBinary=!0,Va.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new Ha(e,t):new Ha(e):new Ha(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Va.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Va.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,o=n;r<o;r++)!function(e){la.encodePacket(e,t.supportsBinary,(function(r){if(!t.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),t.perMessageDeflate)("string"==typeof r?Buffer.byteLength(r):r.length)<t.perMessageDeflate.threshold&&(o.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,o)}catch(e){Ga("websocket closed before onclose event")}--n||i()}))}(e[r]);function i(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}},Va.prototype.onClose=function(){ua.prototype.onClose.call(this)},Va.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},Va.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=ka()),this.supportsBinary||(e.b64=1),(e=da(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},Va.prototype.check=function(){return!(!Ha||"__initialize"in Ha&&this.name===Va.prototype.name)};var Wa={polling:function(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==o}if(e.xdomain=t,e.xscheme=n,"open"in new _i(e)&&!e.forceJSONP)return new Da(e);if(!r)throw new Error("JSONP disabled");return new Ma(e)},websocket:Ka},Ja=[].indexOf,Ya=function(e,t){if(Ja)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Xa=yi("engine.io-client:socket"),Qa=Za;function Za(e,t){if(!(this instanceof Za))return new Za(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=si(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=si(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=ha(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Za.priorWebsocketSuccess=!1,gi(Za.prototype),Za.protocol=la.protocol,Za.Socket=Za,Za.Transport=ua,Za.transports=Wa,Za.parser=la,Za.prototype.createTransport=function(e){Xa('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=la.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new Wa[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Za.prototype.open=function(){var e;if(this.rememberUpgrade&&Za.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Za.prototype.setTransport=function(e){Xa("setting transport %s",e.name);var t=this;this.transport&&(Xa("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},Za.prototype.probe=function(e){Xa('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(Xa('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(o){if(!n)if("pong"===o.type&&"probe"===o.data){if(Xa('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;Za.priorWebsocketSuccess="websocket"===t.name,Xa('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(Xa("changing transport and sending upgrade packet"),u(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{Xa('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,r.emit("upgradeError",i)}})))}function i(){n||(n=!0,u(),t.close(),t=null)}function a(n){var o=new Error("probe error: "+n);o.transport=t.name,i(),Xa('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function s(){a("transport closed")}function c(){a("socket closed")}function l(e){t&&e.name!==t.name&&(Xa('"%s" works - aborting "%s"',e.name,t.name),i())}function u(){t.removeListener("open",o),t.removeListener("error",a),t.removeListener("close",s),r.removeListener("close",c),r.removeListener("upgrading",l)}Za.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",a),t.once("close",s),this.once("close",c),this.once("upgrading",l),t.open()},Za.prototype.onOpen=function(){if(Xa("socket open"),this.readyState="open",Za.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Xa("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Za.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Xa('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Xa('packet received with socket readyState "%s"',this.readyState)},Za.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Za.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},Za.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){Xa("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},Za.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},Za.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Za.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Xa("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Za.prototype.write=Za.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},Za.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},Za.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()}function t(){e.onClose("forced close"),Xa("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},Za.prototype.onError=function(e){Xa("socket error %j",e),Za.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Za.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Xa('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},Za.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~Ya(this.transports,e[n])&&t.push(e[n]);return t};var es=Qa,ts=la;es.parser=ts;var ns=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n};var rs=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}};var os=[].slice,is=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=os.call(arguments,2);return function(){return t.apply(e,n.concat(os.call(arguments)))}},as=To((function(e,t){var n=yi("socket.io-client:socket");e.exports=i;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},o=gi.prototype.emit;function i(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}gi(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[rs(e,"open",is(this,"onopen")),rs(e,"packet",is(this,"onpacket")),rs(e,"close",is(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},i.prototype.send=function(){var e=ns(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(r.hasOwnProperty(e))return o.apply(this,arguments),this;var t=ns(arguments),i={type:(void 0!==this.flags.binary?this.flags.binary:qi(t))?Ai.BINARY_EVENT:Ai.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this.flags={},this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?da(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:Ai.CONNECT,query:e})}else this.packet({type:Ai.CONNECT})},i.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===Ai.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case Ai.CONNECT:this.onconnect();break;case Ai.EVENT:case Ai.BINARY_EVENT:this.onevent(e);break;case Ai.ACK:case Ai.BINARY_ACK:this.onack(e);break;case Ai.DISCONNECT:this.ondisconnect();break;case Ai.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?o.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var o=ns(arguments);n("sending ack %j",o),t.packet({type:qi(o)?Ai.BINARY_ACK:Ai.ACK,id:e,data:o})}}},i.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)o.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:Ai.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.prototype.compress=function(e){return this.flags.compress=e,this},i.prototype.binary=function(e){return this.flags.binary=e,this}})),ss=cs;function cs(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}cs.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},cs.prototype.reset=function(){this.attempts=0},cs.prototype.setMin=function(e){this.ms=e},cs.prototype.setMax=function(e){this.max=e},cs.prototype.setJitter=function(e){this.jitter=e};var ls=yi("socket.io-client:manager"),us=Object.prototype.hasOwnProperty,ps=fs;function fs(e,t){if(!(this instanceof fs))return new fs(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new ss({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||Ai;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}fs.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)us.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},fs.prototype.updateSocketIds=function(){for(var e in this.nsps)us.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},fs.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},gi(fs.prototype),fs.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},fs.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},fs.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},fs.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},fs.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},fs.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},fs.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},fs.prototype.open=fs.prototype.connect=function(e,t){if(ls("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;ls("opening %s",this.uri),this.engine=es(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=rs(n,"open",(function(){r.onopen(),e&&e()})),i=rs(n,"error",(function(t){if(ls("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;ls("connect attempt will timeout after %d",a);var s=setTimeout((function(){ls("connect attempt timed out after %d",a),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(o),this.subs.push(i),this},fs.prototype.onopen=function(){ls("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(rs(e,"data",is(this,"ondata"))),this.subs.push(rs(e,"ping",is(this,"onping"))),this.subs.push(rs(e,"pong",is(this,"onpong"))),this.subs.push(rs(e,"error",is(this,"onerror"))),this.subs.push(rs(e,"close",is(this,"onclose"))),this.subs.push(rs(this.decoder,"decoded",is(this,"ondecoded")))},fs.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},fs.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},fs.prototype.ondata=function(e){this.decoder.add(e)},fs.prototype.ondecoded=function(e){this.emit("packet",e)},fs.prototype.onerror=function(e){ls("error",e),this.emitAll("error",e)},fs.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new as(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",(function(){n.id=r.generateId(e)})),this.autoConnect&&o()}function o(){~Ya(r.connecting,n)||r.connecting.push(n)}return n},fs.prototype.destroy=function(e){var t=Ya(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},fs.prototype.packet=function(e){ls("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()})))},fs.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},fs.prototype.cleanup=function(){ls("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},fs.prototype.close=fs.prototype.disconnect=function(){ls("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},fs.prototype.onclose=function(e){ls("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},fs.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)ls("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();ls("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(ls("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(ls("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(ls("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},fs.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var ds=To((function(e,t){var n=yi("socket.io-client");e.exports=t=o;var r=t.managers={};function o(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,i=mi(e),a=i.source,s=i.id,c=i.path,l=r[s]&&c in r[s].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(n("ignoring socket cache for %s",a),o=ps(a,t)):(r[s]||(n("new io instance for %s",a),r[s]=ps(a,t)),o=r[s]),i.query&&!t.query&&(t.query=i.query),o.socket(i.path,t)}t.protocol=Ai.protocol,t.connect=o,t.Manager=ps,t.Socket=as})),hs=(ds.managers,ds.protocol,ds.connect,ds.Manager,ds.Socket,function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.socket,i=n.socketOpts,a=n.store,s=n.gameID,c=n.playerID,l=n.gameName,p=n.numPlayers,f=n.server;return r(this,t),(e=d(this,u(t).call(this,{store:a,gameName:l,playerID:c,gameID:s,numPlayers:p}))).server=f,e.socket=o,e.socketOpts=i,e.isConnected=!1,e.callback=function(){},e.gameMetadataCallback=function(){},e}return l(t,e),i(t,[{key:"onAction",value:function(e,t){this.socket.emit("update",t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;if(!this.socket)if(this.server){var t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.substr(-1)&&(t+="/"),this.socket=ds(t+this.gameName,this.socketOpts)}else this.socket=ds("/"+this.gameName,this.socketOpts);this.socket.on("update",(function(t,n,r){var o=e.store.getState();if(t==e.gameID&&n._stateID>=o._stateID){var i=E(n,r);e.store.dispatch(i)}})),this.socket.on("sync",(function(t,n){if(t==e.gameID){var r=D(n);e.gameMetadataCallback(n.filteredMetadata),e.store.dispatch(r)}})),this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers),this.socket.on("connect",(function(){e.isConnected=!0,e.callback()})),this.socket.on("disconnect",(function(){e.isConnected=!1,e.callback()}))}},{key:"disconnect",value:function(){this.socket.close(),this.socket=null,this.isConnected=!1,this.callback()}},{key:"subscribe",value:function(e){this.callback=e}},{key:"subscribeGameMetadata",value:function(e){this.gameMetadataCallback=e}},{key:"updateGameID",value:function(e){this.gameID=e;var t=A(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=A(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}}]),t}(ti));e.Client=Bo,e.Local=function(e){return function(t){var n;return oi.has(t.gameKey)&!e?n=oi.get(t.gameKey):(n=new ni({game:t.game,bots:e&&e.bots}),oi.set(t.gameKey,n)),new ri(c({master:n},t))}},e.MCTSBot=so,e.RandomBot=co,e.ReactClient=function(e){var n,o,s=e.game,p=e.numPlayers,f=e.loading,h=e.board,y=e.multiplayer,v=e.enhancer,m=e.debug;if(void 0===f){f=function(){return t.createElement("div",{className:"bgio-loading"},"connecting...")}}return o=n=function(e){function n(e){var t;return r(this,n),t=d(this,u(n).call(this,e)),void 0===m&&(m=e.debug),t.client=Bo({game:s,debug:m,numPlayers:p,multiplayer:y,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,enhancer:v}),t}return l(n,e),i(n,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.client.subscribe((function(){return e.forceUpdate()})),this.client.start()}},{key:"componentWillUnmount",value:function(){this.client.stop(),this.unsubscribe()}},{key:"componentDidUpdate",value:function(e){this.props.gameID!=e.gameID&&this.client.updateGameID(this.props.gameID),this.props.playerID!=e.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=e.credentials&&this.client.updateCredentials(this.props.credentials)}},{key:"render",value:function(){var e=this.client.getState();if(null===e)return t.createElement(f);var n=null;return h&&(n=t.createElement(h,c({},e,{},this.props,{isMultiplayer:!!y,moves:this.client.moves,events:this.client.events,gameID:this.client.gameID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,gameMetadata:this.client.gameMetadata}))),t.createElement("div",{className:"bgio-client"},n)}}]),n}(t.Component),a(n,"propTypes",{gameID:Vo.string,playerID:Vo.string,credentials:Vo.string,debug:Vo.any}),a(n,"defaultProps",{gameID:"default",playerID:null,credentials:null,debug:!0}),o},e.ReactNativeClient=function(e){var n,o,s=e.game,p=e.numPlayers,h=e.board,y=e.multiplayer,v=e.enhancer;return o=n=function(e){function n(e){var t;return r(this,n),(t=d(this,u(n).call(this,e))).client=Bo({game:s,numPlayers:p,multiplayer:y,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,debug:!1,enhancer:v}),t}return l(n,e),i(n,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.client.subscribe((function(){return e.forceUpdate()})),this.client.start()}},{key:"componentWillUnmount",value:function(){this.client.stop(),this.unsubscribe()}},{key:"componentDidUpdate",value:function(e){e.gameID!=this.props.gameID&&this.client.updateGameID(this.props.gameID),e.playerID!=this.props.playerID&&this.client.updatePlayerID(this.props.playerID),e.credentials!=this.props.credentials&&this.client.updateCredentials(this.props.credentials)}},{key:"render",value:function(){var e=null,n=this.client.getState(),r=this.props,o=r.gameID,i=r.playerID,a=f(r,["gameID","playerID"]);return h&&(e=t.createElement(h,c({},n,{},a,{gameID:o,playerID:i,isMultiplayer:!!y,moves:this.client.moves,events:this.client.events,step:this.client.step,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,gameMetadata:this.client.gameMetadata}))),e}}]),n}(t.Component),a(n,"propTypes",{gameID:Vo.string,playerID:Vo.string,credentials:Vo.string}),a(n,"defaultProps",{gameID:"default",playerID:null,credentials:null}),o},e.Simulate=async function(e){var t=e.game,n=e.bots,r=e.state,o=e.depth;void 0===o&&(o=1e4);for(var i=io({game:t,numPlayers:r.ctx.numPlayers}),a=null,s=0;void 0===r.ctx.gameover&&s<o;){var c=r.ctx.currentPlayer;r.ctx.activePlayers&&(c=Object.keys(r.ctx.activePlayers)[0]);var l=n instanceof ao?n:n[c],u=await l.play(r,c);if(!u.action)break;a=u.metadata,r=i(r,u.action),s++}return{state:r,metadata:a}},e.SocketIO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.server,n=e.socketOpts;return function(e){return new hs(c({server:t,socketOpts:n},e))}},e.Step=lo,e.TurnOrder=Le,Object.defineProperty(e,"__esModule",{value:!0})}));
