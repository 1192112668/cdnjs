!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).BoardgameIO={},e.React)}(this,(function(e,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(n,!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t=t&&t.hasOwnProperty("default")?t.default:t;var y=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),v=function(){return Math.random().toString(36).substring(7).split("").join(".")},m={INIT:"@@redux/INIT"+v(),REPLACE:"@@redux/REPLACE"+v(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+v()}};function g(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function b(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(b)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,i=t,a=[],s=a,c=!1;function l(){s===a&&(s=a.slice())}function u(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function p(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return l(),s.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,l();var n=s.indexOf(e);s.splice(n,1)}}}function f(e){if(!g(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=o(i,e)}finally{c=!1}for(var t=a=s,n=0;n<t.length;n++){(0,t[n])()}return e}function d(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,f({type:m.REPLACE})}function h(){var e,t=p;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[y]=function(){return this},e}return f({type:m.INIT}),(r={dispatch:f,subscribe:p,getState:u,replaceReducer:d})[y]=h,r}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function P(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return k({},n,{dispatch:r=$.apply(void 0,i)(n.dispatch)})}}}const C=(e,t,n,r)=>({type:"MAKE_MOVE",payload:{type:e,args:t,playerID:n,credentials:r}}),O=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r}}),I=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}),D=e=>({type:"SYNC",state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),E=(e,t)=>({type:"UPDATE",state:e,deltalog:t,clientOnly:!0}),A=e=>({type:"RESET",state:e,clientOnly:!0}),S=(e,t)=>({type:"UNDO",payload:{type:null,args:null,playerID:e,credentials:t}}),_=(e,t)=>({type:"REDO",payload:{type:null,args:null,playerID:e,credentials:t}});var j,B,N,M=Object.freeze({makeMove:C,gameEvent:O,automaticGameEvent:I,sync:D,update:E,reset:A,undo:S,redo:_,plugin:(e,t,n,r)=>({type:"PLUGIN",payload:{type:e,args:t,playerID:n,credentials:r}})}),T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),q="undefined"!=typeof Symbol?Symbol("immer-nothing"):(N=!0,(B="immer-nothing")in(j={})?Object.defineProperty(j,B,{value:N,enumerable:!0,configurable:!0,writable:!0}):j[B]=N,j),z="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",F="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function L(e){return!!e&&!!e[F]}function U(e){if(!e||"object"!==(void 0===e?"undefined":T(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[z]||!!e.constructor[z])}var G=Object.assign||function(e,t){for(var n in t)J(t,n)&&(e[n]=t[n]);return e},H="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function K(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return H(e).forEach((function(r){if(r!==F){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}})),n}function V(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else H(e).forEach((function(n){return t(n,e[n],e)}))}function W(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Y(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var X={},Q=[],Z=function(){return Q[Q.length-1]};function ee(e,t){var n=Array.isArray(e),r=ie(e);V(r,(function(t){!function(e,t,n){var r=X[t];r?r.enumerable=n:X[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){ae(e);var n=ne(e)[t];if(!e.finalizing&&n===e.base[t]&&U(n))return oe(e),e.copy[t]=ee(n,e);return n}(this[F],t)},set:function(e){!function(e,t,n){if(ae(e),e.assigned[t]=!0,!e.modified){if(Y(ne(e)[t],n))return;re(e),oe(e)}e.copy[t]=n}(this[F],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||W(e,t))}));var o={scope:t?t.scope:Z(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:te,revoked:!1};return function(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0})}(r,F,o),o.scope.push(o),r}function te(){this.revoked=!0}function ne(e){return e.copy||e.base}function re(e){e.modified||(e.modified=!0,e.parent&&re(e.parent))}function oe(e){e.copy||(e.copy=ie(e.base))}function ie(e){var t=e&&e[F];if(t){t.finalizing=!0;var n=K(t.draft,!0);return t.finalizing=!1,n}return K(e)}function ae(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(ne(e)))}function se(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!J(t,r[o]))return!0;return r.length!==Object.keys(t).length}function ce(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var le=Object.freeze({scopes:Q,currentScope:Z,willFinalize:function(e,t,n){var r=Z();r.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(n&&function e(t){if(!t||"object"!==(void 0===t?"undefined":T(t)))return;var n=t[F];if(!n)return;var r=n.base,o=n.draft,i=n.assigned;if(Array.isArray(t)){if(ce(n)){if(re(n),i.length=!0,o.length<r.length)for(var a=o.length;a<r.length;a++)i[a]=!1;else for(var s=r.length;s<o.length;s++)i[s]=!0;for(var c=0;c<o.length;c++)void 0===i[c]&&e(o[c])}}else Object.keys(o).forEach((function(t){void 0!==r[t]||J(r,t)?i[t]||e(o[t]):(i[t]=!0,re(n))})),Object.keys(r).forEach((function(e){void 0!==o[e]||J(o,e)||(i[e]=!1,re(n))}))}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?ce(n)&&re(n):se(n)&&re(n))}}(r))},createDraft:ee}),ue=[],pe=function(){return ue[ue.length-1]};function fe(e,t){var n={scope:t?t.scope:pe(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],he):Proxy.revocable(n,de),o=r.revoke,i=r.proxy;return n.draft=i,n.revoke=o,n.scope.push(n),i}var de={get:function(e,t){if(t===F)return e;var n=e.drafts;if(!e.modified&&J(n,t))return n[t];var r=ye(e)[t];if(e.finalized||!U(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=fe(r,e)},has:function(e,t){return t in ye(e)},ownKeys:function(e){return Reflect.ownKeys(ye(e))},set:function(e,t,n){if(!e.modified){if(n?Y(e.base[t],n)||n===e.drafts[t]:Y(e.base[t],n)&&t in e.base)return!0;ve(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,ve(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=ye(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},he={};function ye(e){return e.copy||e.base}function ve(e){e.modified||(e.modified=!0,e.copy=G(K(e.base),e.drafts),e.drafts=null,e.parent&&ve(e.parent))}V(de,(function(e,t){he[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),he.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return de.deleteProperty.call(this,e[0],t)},he.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return de.set.call(this,e[0],t,n)};var me=Object.freeze({scopes:ue,currentScope:pe,willFinalize:function(){},createDraft:fe});function ge(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,i=e.copy,a=e.assigned,s=Math.min(o.length,i.length),c=0;c<s;c++)if(a[c]&&o[c]!==i[c]){var l=t.concat(c);n.push({op:"replace",path:l,value:i[c]}),r.push({op:"replace",path:l,value:o[c]})}if(s<i.length){for(var u=s;u<i.length;u++)n.push({op:"add",path:t.concat(u),value:i[u]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(s<o.length){n.push({op:"replace",path:t.concat("length"),value:i.length});for(var p=s;p<o.length;p++)r.push({op:"add",path:t.concat(p),value:o[p]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,i=e.copy;V(e.assigned,(function(e,a){var s=o[e],c=i[e],l=a?e in o?"replace":"add":"remove";if(s!==c||"replace"!==l){var u=t.concat(e);n.push("remove"===l?{op:l,path:u}:{op:l,path:u,value:c}),r.push("add"===l?{op:"remove",path:u}:"remove"===l?{op:"add",path:u,value:s}:{op:"replace",path:u,value:s})}}))}(e,t,n,r)}function be(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var i=e,a=0;a<o.length-1;a++)if(!(i=i[o[a]])||"object"!==(void 0===i?"undefined":T(i)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var s=o[o.length-1];switch(r.op){case"replace":case"add":i[s]=r.value;break;case"remove":if(Array.isArray(i)){if(s!==i.length-1)throw new Error("Only the last index of an array can be removed, index: "+s+", length: "+i.length);i.length-=1}else delete i[s];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var we={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},xe=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G(this,we,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return R(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(a,(function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var i=void 0;if(U(e)){this.scopes.push([]);var a=this.createDraft(e);try{i=t.call(a,a),this.willFinalize(i,a,!!n);var s=n&&[],c=n&&[];if(void 0===i||i===a)i=this.finalize(a,[],s,c);else{if(a[F].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");U(i)&&(i=this.finalize(i)),n&&(s.push({op:"replace",path:[],value:i}),c.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}n&&n(s,c)}else if(void 0===(i=t(e)))return e;return i===q?void 0:i}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,G(this,e?me:le)}},{key:"applyPatches",value:function(e,t){return L(e)?be(e,t):this.produce(e,(function(e){return be(e,t)}))}},{key:"finalize",value:function(e,t,n,r){var o=this,i=e[F];if(!i)return Object.isFrozen(e)?e:this.finalizeTree(e);if(i.scope!==this.currentScope())return e;if(!i.modified)return i.base;if(!i.finalized){if(i.finalized=!0,this.finalizeTree(i.draft,t,n,r),this.onDelete)if(this.useProxies){var a=i.assigned;for(var s in a)a[s]||this.onDelete(i,s)}else{var c=i.base,l=i.copy;V(c,(function(e){J(l,e)||o.onDelete(i,e)}))}this.onCopy&&this.onCopy(i),this.autoFreeze&&1===this.scopes.length&&Object.freeze(i.copy),n&&ge(i,t,n,r)}return i.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,i=e[F];i&&(this.useProxies||(i.finalizing=!0,i.copy=K(i.draft,!0),i.finalizing=!1),e=i.copy);var a=this.onAssign;return V(e,(function s(c,l,u){if(l===u)throw Error("Immer forbids circular references");var p=!!i&&u===e;if(L(l)){if(l=n&&p&&!i.assigned[c]?o.finalize(l,t.concat(c),n,r):o.finalize(l),Array.isArray(u)||W(u,c)?u[c]=l:Object.defineProperty(u,c,{value:l}),p&&l===i.base[c])return}else{if(p&&Y(l,i.base[c]))return;U(l)&&!Object.isFrozen(l)&&V(l,s)}p&&a&&a(i,c,l)})),e}}]),e}()),ke=xe.produce;xe.setAutoFreeze.bind(xe),xe.setUseProxies.bind(xe),xe.applyPatches.bind(xe);const $e={name:"plugin-immer",fnWrap:e=>ke(e)};function Pe(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function Ce(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function Oe(e,t){var r=new Pe(e),o=t&&t.state,i=r.next;return i.quick=i,o&&("object"==n(o)&&Ce(o,r),i.state=function(){return Ce(r,{})}),i}var Ie=function(){function e(t){r(this,e),this.state=t,this.used=!1}return i(e,[{key:"isUsed",value:function(){return this.used}},{key:"getState",value:function(){return this.state}},{key:"_random",value:function(){this.used=!0;var e,t=this.state,n=(e=void 0===t.prngstate?new Oe(t.seed,{state:!0}):new Oe("",{state:t.prngstate}))();return this.state=c({},t,{prngstate:e.state()}),n}},{key:"api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:h(new Array(t).keys()).map((function(){return Math.floor(e()*o)+1}))}};for(var o in t)r(o);return c({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:h(new Array(n).keys()).map((function(){return Math.floor(e()*t)+1}))},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,i=new Array(r);r;){var a=r*e()|0;i[o++]=n[a],n[a]=n[--r]}return i},_obj:this})}}]),e}();Ie.seed=function(){return(+new Date).toString(36).slice(-10)};class De{constructor(e,t){this.flow=e,this.playerID=t,this.dispatch=[]}api(e){const t={_obj:this},{phase:n,turn:r}=e;for(const e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({key:e,args:t,phase:n,turn:r})};return t}isUsed(){return this.dispatch.length>0}update(e){for(let t=0;t<this.dispatch.length;t++){const n=this.dispatch[t];if("endTurn"===n.key&&n.turn!==e.ctx.turn)continue;if(("endPhase"===n.key||"setPhase"===n.key)&&n.phase!==e.ctx.phase)continue;const r=I(n.key,n.args,this.playerID);e={...e,...this.flow.processEvent(e,r)}}return e}}const Ee=[$e,{name:"random",noClient:({api:e})=>e._obj.isUsed(),flush:({api:e})=>e._obj.getState(),api:({data:e})=>new Ie(e).api(),setup:({game:e})=>{let t=e.seed;return void 0===t&&(t=Ie.seed()),{seed:t}}},{name:"events",noClient:({api:e})=>e._obj.isUsed(),dangerouslyFlushRawState:({state:e,api:t})=>t._obj.update(e),api:({game:e,playerID:t,ctx:n})=>new De(e.flow,t).api(n)}],Ae=e=>{let t={...e.ctx};const n=e.plugins||{};return Object.entries(n).forEach(([e,{api:n}])=>{t[e]=n}),t},Se=(e,t)=>[...Ee,...t].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:t})=>t(e),e),_e=(e,t)=>([...Ee,...t.game.plugins].filter(e=>void 0!==e.api).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},i=n.api({G:e.G,ctx:e.ctx,data:o.data,game:t.game,playerID:t.playerID});e={...e,plugins:{...e.plugins,[r]:{...o,api:i}}}}),e),je=(e,t)=>([...Ee,...t.game.plugins].forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}};if(n.flush){const r=n.flush({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data});e={...e,plugins:{...e.plugins,[n.name]:{data:r}}}}else if(n.dangerouslyFlushRawState){const i=(e=n.dangerouslyFlushRawState({state:e,game:t.game,api:o.api,data:o.data})).plugins[r].data;e={...e,plugins:{...e.plugins,[n.name]:{data:i}}}}}),e),Be=console.log,Ne=console.error;function Me(e){Ne("ERROR:",e)}function Te(e,t,n){return{...e,ctx:Re(e.ctx,n)}}function Re(e,t){let{_prevActivePlayers:n}=e,r={},o=null,i={};if(Array.isArray(t)){let e={};t.forEach(t=>e[t]=Le.NULL),r=e}else{if(t.next&&(o=t.next),n=t.revert?n.concat({activePlayers:e.activePlayers,_activePlayersMoveLimit:e._activePlayersMoveLimit,_activePlayersNumMoves:e._activePlayersNumMoves}):[],void 0!==t.currentPlayer&&qe(r,i,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(let n=0;n<e.playOrder.length;n++){const o=e.playOrder[n];o!==e.currentPlayer&&qe(r,i,o,t.others)}if(void 0!==t.all)for(let n=0;n<e.playOrder.length;n++){qe(r,i,e.playOrder[n],t.all)}if(t.value)for(const e in t.value)qe(r,i,e,t.value[e]);if(t.moveLimit)for(const e in r)void 0===i[e]&&(i[e]=t.moveLimit)}0==Object.keys(r).length&&(r=null),0==Object.keys(i).length&&(i=null);let a={};for(const e in r)a[e]=0;return{...e,activePlayers:r,_activePlayersMoveLimit:i,_activePlayersNumMoves:a,_prevActivePlayers:n,_nextActivePlayers:o}}function qe(e,t,n,r){"object"==typeof r&&r!==Le.NULL||(r={stage:r}),void 0!==r.stage&&(e[n]=r.stage,r.moveLimit&&(t[n]=r.moveLimit))}function ze(e,t){return e[t]+""}const Fe={DEFAULT:{first:(e,t)=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},RESET:{first:()=>0,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},CONTINUE:{first:(e,t)=>t.playOrderPos,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},ONCE:{first:()=>0,next:(e,t)=>{if(t.playOrderPos<t.playOrder.length-1)return t.playOrderPos+1}},CUSTOM:e=>({playOrder:()=>e,first:()=>0,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length}),CUSTOM_FROM:e=>({playOrder:t=>t[e],first:()=>0,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length})},Le={NULL:null};function Ue({moves:e,phases:t,endIf:n,onEnd:r,turn:o,events:i,plugins:a}){void 0===e&&(e={}),void 0===i&&(i={}),void 0===a&&(a=[]),void 0===t&&(t={}),n||(n=()=>{}),r||(r=e=>e),o||(o={});const s={...t};""in s&&Me("cannot specify phase with empty name"),s[""]={};let c={},l=new Set,u=null;Object.keys(e).forEach(e=>l.add(e));const p=e=>{const t=Se(e,a);return e=>{const n=Ae(e);return t(e.G,n)}},f=e=>t=>{let n=Ae(t);return e(t.G,n)},d={onEnd:p(r),endIf:f(n)};for(let e in s){const t=s[e];if(!0===t.start&&(u=e),void 0!==t.moves)for(let n of Object.keys(t.moves))c[e+"."+n]=t.moves[n],l.add(n);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=e=>e),void 0===t.onEnd&&(t.onEnd=e=>e),void 0===t.turn&&(t.turn=o),void 0===t.turn.order&&(t.turn.order=Fe.DEFAULT),void 0===t.turn.onBegin&&(t.turn.onBegin=e=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=e=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=e=>e),void 0===t.turn.stages&&(t.turn.stages={});for(const n in t.turn.stages){const r=t.turn.stages[n].moves||{};for(let t of Object.keys(r)){c[e+"."+n+"."+t]=r[t],l.add(t)}}t.wrapped={onBegin:p(t.onBegin),onEnd:p(t.onEnd),endIf:f(t.endIf)},t.turn.wrapped={onMove:p(t.turn.onMove),onBegin:p(t.turn.onBegin),onEnd:p(t.turn.onEnd),endIf:f(t.turn.endIf)}}function h(e){return e.phase?s[e.phase]:s[""]}function y(e){return e}function v(e,t){const n=new Set,r=new Set;for(let o=0;o<t.length;o++){const{fn:i,arg:a,...s}=t[o];if(i===D){r.clear();const t=e.ctx.phase;if(n.has(t)){const t={...e.ctx,phase:null};return{...e,ctx:t}}n.add(t)}let c=[];if(e=i(e,{...s,arg:a,next:c}),i===I)break;const l=$(e);if(l){t.push({fn:I,arg:l,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}const u=P(e);if(u)t.push({fn:D,arg:u,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});else{if(i===y){const n=C(e);if(n){t.push({fn:E,arg:n,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...c)}}return e}function m(e,{next:t}){return t.push({fn:g}),e}function g(e,{next:t}){let{G:n,ctx:r}=e;return n=h(r).wrapped.onBegin(e),t.push({fn:b}),{...e,G:n,ctx:r}}function b(e,{currentPlayer:t}){let{G:n,ctx:r}=e;const o=h(r);t?(r={...r,currentPlayer:t},o.turn.activePlayers&&(r=Re(r,o.turn.activePlayers))):r=function(e,t){let{G:n,ctx:r}=e;const o=Ae(e),i=t.order;let a=[...new Array(r.numPlayers)].map((e,t)=>t+"");void 0!==i.playOrder&&(a=i.playOrder(n,o));const s=i.first(n,o),c=typeof s;"number"!==c&&Me(`invalid value returned by turn.order.first — expected number got ${c} “${s}”.`);const l=ze(a,s);return r={...r,currentPlayer:l,playOrderPos:s,playOrder:a},r=Re(r,t.activePlayers||{}),r}(e,o.turn);const i=r.turn+1;r={...r,turn:i,numMoves:0,_prevActivePlayers:[]},n=o.turn.wrapped.onBegin({...e,G:n,ctx:r});const a=[{G:n,ctx:r}];return{...e,G:n,ctx:r,_undo:a,_redo:[]}}function w(e,{arg:t,next:n,phase:r}){const o=h({phase:r});let{ctx:i}=e;if(t&&t.next){if(!(t.next in s))return Me("invalid phase: "+t.next),e;i={...i,phase:t.next}}else i=void 0!==o.next?{...i,phase:o.next}:{...i,phase:null};return e={...e,ctx:i},n.push({fn:g}),e}function x(e,{arg:t,currentPlayer:n,next:r}){let{G:o,ctx:i}=e;const a=h(i),{endPhase:s,ctx:c}=function(e,t,n,r){const o=n.order;let{G:i,ctx:a}=e,s=a.playOrderPos,c=!1;if(r&&!0!==r)"object"!=typeof r&&Me(`invalid argument to endTurn: ${r}`),Object.keys(r).forEach(e=>{switch(e){case"remove":t=ze(a.playOrder,s);break;case"next":s=a.playOrder.indexOf(r.next),t=r.next;break;default:Me(`invalid argument to endTurn: ${e}`)}});else{const n=Ae(e),r=o.next(i,n),l=typeof r;"number"!==l&&Me(`invalid value returned by turn.order.next — expected number got ${l} “${r}”.`),void 0===r?c=!0:(s=r,t=ze(a.playOrder,s))}return a={...a,playOrderPos:s,currentPlayer:t},{endPhase:c,ctx:a}}(e,n,a.turn,t);return i=c,e={...e,G:o,ctx:i},s?r.push({fn:D,turn:i.turn,phase:i.phase}):r.push({fn:b,currentPlayer:i.currentPlayer}),e}function k(e,{arg:t,playerID:n}){"string"==typeof t&&(t={stage:t});let{ctx:r}=e,{activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:a}=r;return t.stage&&(null===o&&(o={}),o[n]=t.stage,a[n]=0,t.moveLimit&&(null===i&&(i={}),i[n]=t.moveLimit)),r={...r,activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:a},{...e,ctx:r}}function $(e){return d.endIf(e)}function P(e){return h(e.ctx).wrapped.endIf(e)}function C(e){const t=h(e.ctx),n=e.ctx.numMoves||0;return!!(t.turn.moveLimit&&n>=t.turn.moveLimit)||t.turn.wrapped.endIf(e)}function I(e,{arg:t,phase:n}){e=D(e,{phase:n}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};const r=d.onEnd(e);return{...e,G:r}}function D(e,{arg:t,next:n,turn:r,automatic:o}){let i=(e=E(e,{turn:r,force:!0})).G,a=e.ctx;if(n&&n.push({fn:w,arg:t,phase:a.phase}),null===a.phase)return e;i=h(a).wrapped.onEnd(e),a={...a,phase:null};const s={action:O("endPhase",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};o&&(s.automatic=!0);const c=[...e.deltalog,s];return{...e,G:i,ctx:a,deltalog:c}}function E(e,{arg:t,next:n,turn:r,force:o,automatic:i,playerID:a}){if(r!==e.ctx.turn)return e;let{G:s,ctx:c}=e;const l=h(c),u=c.numMoves||0;if(!o&&l.turn.moveLimit&&u<l.turn.moveLimit)return p=`cannot end turn before making ${l.turn.moveLimit} moves`,Be(`INFO: ${p}`),e;var p;if(s=l.turn.wrapped.onEnd(e),n&&n.push({fn:x,arg:t,currentPlayer:c.currentPlayer}),c={...c,activePlayers:null},t&&t.remove){a=a||c.currentPlayer;const t=c.playOrder.filter(e=>e!=a),r=c.playOrderPos>t.length-1?0:c.playOrderPos;if(c={...c,playOrder:t,playOrderPos:r},0===t.length)return n.push({fn:D,turn:c.turn,phase:c.phase}),e}const f={action:O("endTurn",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};i&&(f.automatic=!0);const d=[...e.deltalog||[],f];return{...e,G:s,ctx:c,deltalog:d,_undo:[],_redo:[]}}function A(e,{arg:t,next:n,automatic:r,playerID:o}){o=o||e.ctx.currentPlayer;let{ctx:i}=e,{activePlayers:a,_activePlayersMoveLimit:s}=i;const c=null!==a&&o in a;if(!t&&c){const e=h(i).turn.stages[a[o]];e&&e.next&&(t=e.next)}if(n&&t&&n.push({fn:k,arg:t,playerID:o}),!c)return e;a=Object.keys(a).filter(e=>e!==o).reduce((e,t)=>(e[t]=a[t],e),{}),s&&(s=Object.keys(s).filter(e=>e!==o).reduce((e,t)=>(e[t]=s[t],e),{})),i=function(e){let{activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e;if(t&&0==Object.keys(t).length)if(e._nextActivePlayers)e=Re(e,e._nextActivePlayers),({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e);else if(o.length>0){const e=o.length-1;({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r}=o[e]),o=o.slice(0,e)}else t=null,n=null;return{...e,activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}}({...i,activePlayers:a,_activePlayersMoveLimit:s});const l={action:O("endStage",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};r&&(l.automatic=!0);const u=[...e.deltalog||[],l];return{...e,ctx:i,deltalog:u}}const S={endStage:function(e,t){return v(e,[{fn:A,playerID:t}])},setStage:function(e,t,n){return v(e,[{fn:A,arg:n,playerID:t}])},endTurn:function(e,t,n){return v(e,[{fn:E,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},pass:function(e,t,n){return v(e,[{fn:E,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:n}])},endPhase:function(e){return v(e,[{fn:D,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,n){return v(e,[{fn:D,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:n}}])},endGame:function(e,t,n){return v(e,[{fn:I,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},setActivePlayers:Te};let _=[];return!1!==i.endTurn&&_.push("endTurn"),!1!==i.pass&&_.push("pass"),!1!==i.endPhase&&_.push("endPhase"),!1!==i.setPhase&&_.push("setPhase"),!1!==i.endGame&&_.push("endGame"),!1!==i.setActivePlayers&&_.push("setActivePlayers"),!1!==i.endStage&&_.push("endStage"),!1!==i.setStage&&_.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...new Array(e)].map((e,t)=>t+""),playOrderPos:0,phase:u,activePlayers:null}),init:e=>v(e,[{fn:m}]),isPlayerActive:function(e,t,n){return t.activePlayers?n in t.activePlayers:t.currentPlayer===n},eventHandlers:S,eventNames:Object.keys(S),enabledEventNames:_,moveMap:c,moveNames:[...l.values()],processMove:function(e,t){let n=h(e.ctx),{ctx:r}=e,{_activePlayersNumMoves:o}=r;const{playerID:i}=t;r.activePlayers&&o[i]++;let a=e.ctx.numMoves;i==e.ctx.currentPlayer&&a++,e={...e,ctx:{...r,numMoves:a,_activePlayersNumMoves:o}},r._activePlayersMoveLimit&&o[i]>=r._activePlayersMoveLimit[i]&&(e=A(e,{playerID:i,automatic:!0}));const s=n.turn.wrapped.onMove(e),c=(e={...e,G:s})._undo||[],l=t.type;return v(e={...e,_undo:[...c,{G:e.G,ctx:e.ctx,moveType:l}],_redo:[]},[{fn:y}])},processEvent:function(e,t){const{type:n,playerID:r,args:o}=t.payload;if(S.hasOwnProperty(n)){const t=[e,r].concat(o);return S[n].apply({},t)}return e},getMove:function(t,n,r){const o=h(t),i=o.turn.stages,{activePlayers:a}=t;if(a&&void 0!==a[r]&&a[r]!==Le.NULL&&void 0!==i[a[r]]&&void 0!==i[a[r]].moves){const e=i[a[r]].moves;if(n in e)return e[n]}else if(o.moves){if(n in o.moves)return o.moves[n]}else if(n in e)return e[n];return null}}}function Ge(e){if(function(e){return void 0!==e.processMove}(e))return e;if(void 0===e.name&&(e.name="default"),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=e=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw new Error("Plugin missing name attribute");if(e.name.includes(" "))throw new Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw new Error(e.name+": Game name must not include spaces");const t=Ue(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(n,r)=>{let o=t.getMove(n.ctx,r.type,r.playerID);var i;if((i=o)instanceof Object&&void 0!==i.move&&(o=o.move),o instanceof Function){const t=Se(o,e.plugins),i={...Ae(n),playerID:r.playerID};let a=[];return void 0!==r.args&&(a=a.concat(r.args)),t(n.G,i,...a)}return Me(`invalid move object: ${r.type}`),n.G}}}function He(){}const Ke=e=>e;function Ve(e,t){for(const n in t)e[n]=t[n];return e}function We(e){return e()}function Je(){return Object.create(null)}function Ye(e){e.forEach(We)}function Xe(e){return"function"==typeof e}function Qe(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function Ze(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function et(e,t,n){return e[1]?Ve({},Ve(t.$$scope.ctx,e[1](n?n(t):{}))):t.$$scope.ctx}function tt(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}const nt="undefined"!=typeof window;let rt=nt?()=>window.performance.now():()=>Date.now(),ot=nt?e=>requestAnimationFrame(e):He;const it=new Set;let at,st=!1;function ct(){it.forEach(e=>{e[0](rt())||(it.delete(e),e[1]())}),st=it.size>0,st&&ot(ct)}function lt(e,t){e.appendChild(t)}function ut(e,t,n){e.insertBefore(t,n||null)}function pt(e){e.parentNode.removeChild(e)}function ft(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function dt(e){return document.createElement(e)}function ht(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function yt(e){return document.createTextNode(e)}function vt(){return yt(" ")}function mt(){return yt("")}function gt(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function bt(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function wt(e,t){t=""+t,e.data!==t&&(e.data=t)}function xt(e,t){(null!=t||e.value)&&(e.value=t)}function kt(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}}function $t(e,t,n){e.classList[n?"add":"remove"](t)}function Pt(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}let Ct,Ot=0,It={};function Dt(e,t,n,r,o,i,a,s=0){const c=16.666/r;let l="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*i(e);l+=100*e+`%{${a(r,1-r)}}\n`}const u=l+`100% {${a(n,1-n)}}\n}`,p=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${s}`;if(!It[p]){if(!at){const e=dt("style");document.head.appendChild(e),at=e.sheet}It[p]=!0,at.insertRule(`@keyframes ${p} ${u}`,at.cssRules.length)}const f=e.style.animation||"";return e.style.animation=`${f?`${f}, `:""}${p} ${r}ms linear ${o}ms 1 both`,Ot+=1,p}function Et(e,t){e.style.animation=(e.style.animation||"").split(", ").filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")).join(", "),t&&!--Ot&&ot(()=>{if(Ot)return;let e=at.cssRules.length;for(;e--;)at.deleteRule(e);It={}})}function At(e){Ct=e}function St(){if(!Ct)throw new Error("Function called outside component initialization");return Ct}function _t(e){St().$$.on_destroy.push(e)}function jt(){const e=Ct;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=Pt(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}function Bt(e,t){St().$$.context.set(e,t)}function Nt(e){return St().$$.context.get(e)}const Mt=[],Tt=[],Rt=[],qt=[],zt=Promise.resolve();let Ft,Lt=!1;function Ut(e){Rt.push(e)}function Gt(){const e=new Set;do{for(;Mt.length;){const e=Mt.shift();At(e),Ht(e.$$)}for(;Tt.length;)Tt.pop()();for(let t=0;t<Rt.length;t+=1){const n=Rt[t];e.has(n)||(n(),e.add(n))}Rt.length=0}while(Mt.length);for(;qt.length;)qt.pop()();Lt=!1}function Ht(e){e.fragment&&(e.update(e.dirty),Ye(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(Ut))}function Kt(e,t,n){e.dispatchEvent(Pt(`${t?"intro":"outro"}${n}`))}const Vt=new Set;let Wt;function Jt(){Wt={r:0,c:[],p:Wt}}function Yt(){Wt.r||Ye(Wt.c),Wt=Wt.p}function Xt(e,t){e&&e.i&&(Vt.delete(e),e.i(t))}function Qt(e,t,n,r){if(e&&e.o){if(Vt.has(e))return;Vt.add(e),Wt.c.push(()=>{Vt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}const Zt={duration:0};function en(e,t,n,r){let o=t(e,n),i=r?0:1,a=null,s=null,c=null;function l(){c&&Et(e,c)}function u(e,t){const n=e.b-i;return t*=Math.abs(n),{a:i,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function p(t){const{delay:n=0,duration:r=300,easing:p=Ke,tick:f=He,css:d}=o||Zt,h={start:rt()+n,b:t};t||(h.group=Wt,Wt.r+=1),a?s=h:(d&&(l(),c=Dt(e,i,t,r,n,p,d)),t&&f(0,1),a=u(h,r),Ut(()=>Kt(e,t,"start")),function(e){let t;st||(st=!0,ot(ct)),new Promise(n=>{it.add(t=[e,n])})}(t=>{if(s&&t>s.start&&(a=u(s,r),s=null,Kt(e,a.b,"start"),d&&(l(),c=Dt(e,i,a.b,a.duration,0,p,o.css))),a)if(t>=a.end)f(i=a.b,1-i),Kt(e,a.b,"end"),s||(a.b?l():--a.group.r||Ye(a.group.c)),a=null;else if(t>=a.start){const e=t-a.start;i=a.a+a.d*p(e/a.duration),f(i,1-i)}return!(!a&&!s)}))}return{run(e){Xe(o)?(Ft||(Ft=Promise.resolve(),Ft.then(()=>{Ft=null})),Ft).then(()=>{o=o(),p(e)}):p(e)},end(){l(),a=s=null}}}const tn="undefined"!=typeof window?window:global;function nn(e,t,n){const{fragment:r,on_mount:o,on_destroy:i,after_update:a}=e.$$;r.m(t,n),Ut(()=>{const t=o.map(We).filter(Xe);i?i.push(...t):Ye(t),e.$$.on_mount=[]}),a.forEach(Ut)}function rn(e,t){e.$$.fragment&&(Ye(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function on(e,t){e.$$.dirty||(Mt.push(e),Lt||(Lt=!0,zt.then(Gt)),e.$$.dirty=Je()),e.$$.dirty[t]=!0}function an(e,t,n,r,o,i){const a=Ct;At(e);const s=t.props||{},c=e.$$={fragment:null,ctx:null,props:i,update:He,not_equal:o,bound:Je(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:Je(),dirty:null};let l=!1;c.ctx=n?n(e,s,(t,n,r=n)=>(c.ctx&&o(c.ctx[t],c.ctx[t]=r)&&(c.bound[t]&&c.bound[t](r),l&&on(e,t)),n)):s,c.update(),l=!0,Ye(c.before_update),c.fragment=r(c.ctx),t.target&&(t.hydrate?c.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):c.fragment.c(),t.intro&&Xt(e.$$.fragment),nn(e,t.target,t.anchor),Gt()),At(a)}class sn{$destroy(){rn(this,1),this.$destroy=He}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const cn=[];function ln(e,t=He){let n;const r=[];function o(t){if(Qe(e,t)&&(e=t,n)){const t=!cn.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),cn.push(n,e)}if(t){for(let e=0;e<cn.length;e+=2)cn[e][0](cn[e+1]);cn.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,a=He){const s=[i,a];return r.push(s),1===r.length&&(n=t(o)||He),i(e),()=>{const e=r.indexOf(s);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}function un(e){const t=e-1;return t*t*t+1}function pn(e,{delay:t=0,duration:n=400,easing:r=un,x:o=0,y:i=0,opacity:a=0}){const s=getComputedStyle(e),c=+s.opacity,l="none"===s.transform?"":s.transform,u=c*(1-a);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${l} translate(${(1-e)*o}px, ${(1-e)*i}px);\n\t\t\topacity: ${c-u*t}`}}function fn(e,t,n){const r=Object.create(e);return r.key=t[n][0],r.label=t[n][1].label,r}function dn(e){var t,n,r,o,i=e.label+"";function a(){return e.click_handler(e)}return{c(){t=dt("div"),n=yt(i),r=vt(),bt(t,"class","menu-item svelte-19bfq8g"),$t(t,"active",e.pane==e.key),o=gt(t,"click",a)},m(e,o){ut(e,t,o),lt(t,n),lt(t,r)},p(r,o){e=o,r.panes&&i!==(i=e.label+"")&&wt(n,i),(r.pane||r.panes)&&$t(t,"active",e.pane==e.key)},d(e){e&&pt(t),o()}}}function hn(e){var t;let n=Object.entries(e.panes).reverse(),r=[];for(let t=0;t<n.length;t+=1)r[t]=dn(fn(e,n,t));return{c(){t=dt("div");for(let e=0;e<r.length;e+=1)r[e].c();bt(t,"class","menu svelte-19bfq8g")},m(e,n){ut(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.pane||e.panes){let i;for(n=Object.entries(o.panes).reverse(),i=0;i<n.length;i+=1){const a=fn(o,n,i);r[i]?r[i].p(e,a):(r[i]=dn(a),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:He,o:He,d(e){e&&pt(t),ft(r,e)}}}function yn(e,t,n){let{pane:r,panes:o}=t;const i=jt();return e.$set=e=>{"pane"in e&&n("pane",r=e.pane),"panes"in e&&n("panes",o=e.panes)},{pane:r,panes:o,dispatch:i,click_handler:({key:e})=>i("change",e)}}class vn extends sn{constructor(e){var t;super(),document.getElementById("svelte-19bfq8g-style")||((t=dt("style")).id="svelte-19bfq8g-style",t.textContent=".menu.svelte-19bfq8g{display:flex;margin-top:-10px;flex-direction:row;border:1px solid #ccc;border-radius:5px 5px 0 0;height:25px;line-height:25px;margin-right:-500px;transform-origin:bottom right;transform:rotate(-90deg) translate(0, -500px)}.menu-item.svelte-19bfq8g{line-height:25px;cursor:pointer;background:#fefefe;color:#555;padding-left:15px;padding-right:15px;text-align:center}.menu-item.svelte-19bfq8g:last-child{border-radius:0 5px 0 0}.menu-item.svelte-19bfq8g:first-child{border-radius:5px 0 0 0}.menu-item.active.svelte-19bfq8g{cursor:default;font-weight:bold;background:#ddd;color:#555}.menu-item.svelte-19bfq8g:hover{background:#ddd;color:#555}",lt(document.head,t)),an(this,e,yn,hn,Qe,["pane","panes"])}}function mn(e){var t,n;return{c(){t=dt("div"),n=yt(e.label),bt(t,"class","label svelte-1olzq4i")},m(e,r){ut(e,t,r),lt(t,n)},p(e,t){e.label&&wt(n,t.label)},d(e){e&&pt(t)}}}function gn(e){var t,n,r,o,i,a=e.label&&mn(e);return{c(){t=dt("div"),n=dt("div"),r=yt(e.value),o=vt(),a&&a.c(),bt(n,"class","key-box svelte-1olzq4i"),bt(t,"class","key svelte-1olzq4i"),$t(t,"active",e.active),i=[gt(window,"keydown",e.Keypress),gt(n,"click",e.Activate)]},m(e,i){ut(e,t,i),lt(t,n),lt(n,r),lt(t,o),a&&a.m(t,null)},p(e,n){e.value&&wt(r,n.value),n.label?a?a.p(e,n):((a=mn(n)).c(),a.m(t,null)):a&&(a.d(1),a=null),e.active&&$t(t,"active",n.active)},i:He,o:He,d(e){e&&pt(t),a&&a.d(),Ye(i)}}}function bn(e,t,n){let r,{value:o,onPress:i=null,label:a=null,disable:s=!1}=t;const{disableHotkeys:c}=Nt("hotkeys");Ze(e,c,e=>{r=e,n("$disableHotkeys",r)});let l=!1;function u(){n("active",l=!1)}function p(){n("active",l=!0),setTimeout(u,200),i&&setTimeout(i,1)}return e.$set=e=>{"value"in e&&n("value",o=e.value),"onPress"in e&&n("onPress",i=e.onPress),"label"in e&&n("label",a=e.label),"disable"in e&&n("disable",s=e.disable)},{value:o,onPress:i,label:a,disable:s,disableHotkeys:c,active:l,Activate:p,Keypress:function(e){r||s||e.key!=o||(e.preventDefault(),p())}}}class wn extends sn{constructor(e){var t;super(),document.getElementById("svelte-1olzq4i-style")||((t=dt("style")).id="svelte-1olzq4i-style",t.textContent=".key.svelte-1olzq4i{display:flex;flex-direction:row;align-items:center}.key-box.svelte-1olzq4i{cursor:pointer;min-width:10px;padding-left:5px;padding-right:5px;height:20px;line-height:20px;text-align:center;border:1px solid #ccc;box-shadow:1px 1px 1px #888;background:#eee;color:#444}.key-box.svelte-1olzq4i:hover{background:#ddd}.key.active.svelte-1olzq4i .key-box.svelte-1olzq4i{background:#ddd;border:1px solid #999;box-shadow:none}.label.svelte-1olzq4i{margin-left:10px}",lt(document.head,t)),an(this,e,bn,gn,Qe,["value","onPress","label","disable"])}}function xn(e){var t,n,r,o,i,a;return{c(){t=dt("div"),n=yt(e.name),r=yt("("),o=dt("span"),i=yt(")"),bt(o,"class","arg-field svelte-khot71"),bt(o,"contenteditable",""),bt(t,"class","move svelte-khot71"),$t(t,"active",e.active),a=[gt(o,"blur",e.Deactivate),gt(o,"keydown",e.OnKeyDown),gt(t,"click",e.Activate)]},m(a,s){ut(a,t,s),lt(t,n),lt(t,r),lt(t,o),e.span_1_binding(o),lt(t,i)},p(e,r){e.name&&wt(n,r.name),e.active&&$t(t,"active",r.active)},i:He,o:He,d(n){n&&pt(t),e.span_1_binding(null),Ye(a)}}}function kn(e,t,n){let r,{Activate:o,Deactivate:i,name:a,active:s}=t;const c=jt();var l;return l=()=>{s?r.focus():r.blur()},St().$$.after_update.push(l),e.$set=e=>{"Activate"in e&&n("Activate",o=e.Activate),"Deactivate"in e&&n("Deactivate",i=e.Deactivate),"name"in e&&n("name",a=e.name),"active"in e&&n("active",s=e.active)},{Activate:o,Deactivate:i,name:a,active:s,span:r,OnKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),function(){try{const e=r.innerText;let t=new Function(`return [${e}]`)();c("submit",t)}catch(e){c("error",e)}n("span",r.innerText="",r)}()),"Escape"==e.key&&(e.preventDefault(),i())},span_1_binding:function(e){Tt[e?"unshift":"push"](()=>{n("span",r=e)})}}}class $n extends sn{constructor(e){var t;super(),document.getElementById("svelte-khot71-style")||((t=dt("style")).id="svelte-khot71-style",t.textContent=".move.svelte-khot71{cursor:pointer;margin-left:10px;color:#666}.move.svelte-khot71:hover{color:#333}.move.active.svelte-khot71{color:#111;font-weight:bold}.arg-field.svelte-khot71{outline:none;font-family:monospace}",lt(document.head,t)),an(this,e,kn,xn,Qe,["Activate","Deactivate","name","active"])}}function Pn(e){var t,n;return{c(){t=dt("span"),n=yt(e.error),bt(t,"class","move-error svelte-smqssc")},m(e,r){ut(e,t,r),lt(t,n)},p(e,t){e.error&&wt(n,t.error)},d(e){e&&pt(t)}}}function Cn(e){var t,n,r,o,i,a=new wn({props:{value:e.shortcut,onPress:e.Activate}}),s=new $n({props:{Activate:e.Activate,Deactivate:e.Deactivate,name:e.name,active:e.active}});s.$on("submit",e.Submit),s.$on("error",e.Error);var c=e.error&&Pn(e);return{c(){t=dt("div"),n=dt("div"),a.$$.fragment.c(),r=vt(),s.$$.fragment.c(),o=vt(),c&&c.c(),bt(n,"class","wrapper svelte-smqssc")},m(e,l){ut(e,t,l),lt(t,n),nn(a,n,null),lt(n,r),nn(s,n,null),lt(t,o),c&&c.m(t,null),i=!0},p(e,n){var r={};e.shortcut&&(r.value=n.shortcut),a.$set(r);var o={};e.name&&(o.name=n.name),e.active&&(o.active=n.active),s.$set(o),n.error?c?c.p(e,n):((c=Pn(n)).c(),c.m(t,null)):c&&(c.d(1),c=null)},i(e){i||(Xt(a.$$.fragment,e),Xt(s.$$.fragment,e),i=!0)},o(e){Qt(a.$$.fragment,e),Qt(s.$$.fragment,e),i=!1},d(e){e&&pt(t),rn(a),rn(s),c&&c.d()}}}function On(e,t,n){let{shortcut:r,name:o,fn:i}=t;const{disableHotkeys:a}=Nt("hotkeys");let s="",c=!1;function l(){a.set(!1),n("error",s=""),n("active",c=!1)}return e.$set=e=>{"shortcut"in e&&n("shortcut",r=e.shortcut),"name"in e&&n("name",o=e.name),"fn"in e&&n("fn",i=e.fn)},{shortcut:r,name:o,fn:i,error:s,active:c,Activate:function(){a.set(!0),n("active",c=!0)},Deactivate:l,Submit:function(e){n("error",s=""),l(),i.apply(this,e.detail)},Error:function(e){n("error",s=e.detail),Me(e.detail)}}}class In extends sn{constructor(e){var t;super(),document.getElementById("svelte-smqssc-style")||((t=dt("style")).id="svelte-smqssc-style",t.textContent=".move-error.svelte-smqssc{color:#a00;font-weight:bold}.wrapper.svelte-smqssc{display:flex;flex-direction:row;align-items:center}",lt(document.head,t)),an(this,e,On,Cn,Qe,["shortcut","name","fn"])}}var Dn=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),i=n[0];return"object"==typeof i&&i?function t(n,r,o){return Object.keys(o).reduce((function(o,i){var a=o[i];if(a instanceof e){var s=n[a];"object"!=typeof s||r.has(s)?o[i]=s:(r.add(s),o[i]=t(n,r,s))}return o}),o)}(n,new Set,i):i},stringify:function(e){for(var t,r=new Map,o=[],i=[],a=+n(r,o,e),s=function(e,i){if(t)return t=!t,i;switch(typeof i){case"object":if(null===i)return i;case"string":return r.get(i)||n(r,o,i)}return i};a<o.length;a++)t=!0,i[a]=JSON.stringify(o[a],s);return"["+i.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(t,n){return"string"==typeof n?new e(n):n}}(String);const En=Dn.parse,An=Dn.stringify;function Sn(e){var t,n,r,o,i,a,s,c,l,u=new wn({props:{value:"1",onPress:e.client.reset,label:"reset"}}),p=new wn({props:{value:"2",onPress:e.Save,label:"save"}}),f=new wn({props:{value:"3",onPress:e.Restore,label:"restore"}}),d=new wn({props:{value:".",disable:!0,label:"hide"}});return{c(){t=dt("section"),n=dt("li"),u.$$.fragment.c(),r=vt(),o=dt("li"),p.$$.fragment.c(),i=vt(),a=dt("li"),f.$$.fragment.c(),s=vt(),c=dt("li"),d.$$.fragment.c(),bt(n,"class","svelte-1x2w9i0"),bt(o,"class","svelte-1x2w9i0"),bt(a,"class","svelte-1x2w9i0"),bt(c,"class","svelte-1x2w9i0"),bt(t,"id","debug-controls"),bt(t,"class","controls")},m(e,h){ut(e,t,h),lt(t,n),nn(u,n,null),lt(t,r),lt(t,o),nn(p,o,null),lt(t,i),lt(t,a),nn(f,a,null),lt(t,s),lt(t,c),nn(d,c,null),l=!0},p(e,t){var n={};e.client&&(n.onPress=t.client.reset),u.$set(n)},i(e){l||(Xt(u.$$.fragment,e),Xt(p.$$.fragment,e),Xt(f.$$.fragment,e),Xt(d.$$.fragment,e),l=!0)},o(e){Qt(u.$$.fragment,e),Qt(p.$$.fragment,e),Qt(f.$$.fragment,e),Qt(d.$$.fragment,e),l=!1},d(e){e&&pt(t),rn(u),rn(p),rn(f),rn(d)}}}function _n(e,t,n){let{client:r}=t;return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,Save:function(){const{G:e,ctx:t}=r.getState(),n=An({G:e,ctx:t});window.localStorage.setItem("gamestate",n)},Restore:function(){const e=window.localStorage.getItem("gamestate");if(null!==e){const t=En(e);r.store.dispatch(D(t))}}}}class jn extends sn{constructor(e){var t;super(),document.getElementById("svelte-1x2w9i0-style")||((t=dt("style")).id="svelte-1x2w9i0-style",t.textContent="li.svelte-1x2w9i0{list-style:none;margin:none;margin-bottom:5px}",lt(document.head,t)),an(this,e,_n,Sn,Qe,["client"])}}function Bn(e,t,n){const r=Object.create(e);return r.player=t[n],r}function Nn(e){var t,n,r,o,i=e.player+"";function a(){return e.click_handler(e)}return{c(){t=dt("div"),n=yt(i),r=vt(),bt(t,"class","player svelte-6sf87x"),$t(t,"current",e.player==e.ctx.currentPlayer),$t(t,"active",e.player==e.playerID),o=gt(t,"click",a)},m(e,o){ut(e,t,o),lt(t,n),lt(t,r)},p(r,o){e=o,r.players&&i!==(i=e.player+"")&&wt(n,i),(r.players||r.ctx)&&$t(t,"current",e.player==e.ctx.currentPlayer),(r.players||r.playerID)&&$t(t,"active",e.player==e.playerID)},d(e){e&&pt(t),o()}}}function Mn(e){var t;let n=e.players,r=[];for(let t=0;t<n.length;t+=1)r[t]=Nn(Bn(e,n,t));return{c(){t=dt("div");for(let e=0;e<r.length;e+=1)r[e].c();bt(t,"class","player-box svelte-6sf87x")},m(e,n){ut(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,o){if(e.players||e.ctx||e.playerID){let i;for(n=o.players,i=0;i<n.length;i+=1){const a=Bn(o,n,i);r[i]?r[i].p(e,a):(r[i]=Nn(a),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:He,o:He,d(e){e&&pt(t),ft(r,e)}}}function Tn(e,t,n){let{ctx:r,playerID:o}=t;const i=jt();function a(e){i("change",e==o?{playerID:null}:{playerID:e})}let s;return e.$set=e=>{"ctx"in e&&n("ctx",r=e.ctx),"playerID"in e&&n("playerID",o=e.playerID)},e.$$.update=(e={ctx:1})=>{e.ctx&&n("players",s=r?[...Array(r.numPlayers).keys()].map(e=>e.toString()):[])},{ctx:r,playerID:o,OnClick:a,players:s,click_handler:({player:e})=>a(e)}}class Rn extends sn{constructor(e){var t;super(),document.getElementById("svelte-6sf87x-style")||((t=dt("style")).id="svelte-6sf87x-style",t.textContent=".player-box.svelte-6sf87x{display:flex;flex-direction:row}.player.svelte-6sf87x{cursor:pointer;text-align:center;width:30px;height:30px;line-height:30px;background:#eee;border:3px solid #fefefe;box-sizing:content-box}.player.current.svelte-6sf87x{background:#555;color:#eee;font-weight:bold}.player.active.svelte-6sf87x{border:3px solid #ff7f50}",lt(document.head,t)),an(this,e,Tn,Mn,Qe,["ctx","playerID"])}}function qn(e,t,n){const r=Object.create(e);return r.name=t[n][0],r.fn=t[n][1],r}function zn(e){var t,n,r,o=new In({props:{shortcut:e.shortcuts[e.name],fn:e.fn,name:e.name}});return{c(){t=dt("li"),o.$$.fragment.c(),n=vt(),bt(t,"class","svelte-1vg2l2b")},m(e,i){ut(e,t,i),nn(o,t,null),lt(t,n),r=!0},p(e,t){var n={};e.client&&(n.shortcut=t.shortcuts[t.name]),e.client&&(n.fn=t.fn),e.client&&(n.name=t.name),o.$set(n)},i(e){r||(Xt(o.$$.fragment,e),r=!0)},o(e){Qt(o.$$.fragment,e),r=!1},d(e){e&&pt(t),rn(o)}}}function Fn(e){var t,n;return{c(){(t=dt("button")).textContent="End Turn",bt(t,"class","svelte-1vg2l2b"),n=gt(t,"click",e.click_handler)},m(e,n){ut(e,t,n)},d(e){e&&pt(t),n()}}}function Ln(e){var t,n;return{c(){(t=dt("button")).textContent="End Phase",bt(t,"class","svelte-1vg2l2b"),n=gt(t,"click",e.click_handler_1)},m(e,n){ut(e,t,n)},d(e){e&&pt(t),n()}}}function Un(e){var t,n;return{c(){(t=dt("button")).textContent="End Stage",bt(t,"class","svelte-1vg2l2b"),n=gt(t,"click",e.click_handler_2)},m(e,n){ut(e,t,n)},d(e){e&&pt(t),n()}}}function Gn(e){var t,n,r,o,i,a,s,c,l,u,p,f,d,h,y,v,m,g,b,w,x,k,$,P,C,O,I,D,E,A,S,_=JSON.stringify(e.G,null,2)+"",j=JSON.stringify(Hn(e.ctx),null,2)+"",B=new jn({props:{client:e.client}}),N=new Rn({props:{ctx:e.ctx,playerID:e.playerID}});N.$on("change",e.change_handler);let M=Object.entries(e.client.moves),T=[];for(let t=0;t<M.length;t+=1)T[t]=zn(qn(e,M,t));const R=e=>Qt(T[e],1,1,()=>{T[e]=null});var q=e.client.events.endTurn&&Fn(e),z=e.ctx.phase&&e.client.events.endPhase&&Ln(e),F=e.ctx.activePlayers&&e.client.events.endStage&&Un(e);return{c(){t=dt("section"),(n=dt("h3")).textContent="Controls",r=vt(),B.$$.fragment.c(),o=vt(),i=dt("section"),(a=dt("h3")).textContent="Players",s=vt(),N.$$.fragment.c(),c=vt(),l=dt("section"),(u=dt("h3")).textContent="Moves",p=vt();for(let e=0;e<T.length;e+=1)T[e].c();f=vt(),d=dt("section"),(h=dt("h3")).textContent="Events",y=vt(),v=dt("div"),q&&q.c(),m=vt(),z&&z.c(),g=vt(),F&&F.c(),b=vt(),w=dt("section"),(x=dt("label")).textContent="G",k=vt(),$=dt("pre"),P=yt(_),C=vt(),O=dt("section"),(I=dt("label")).textContent="ctx",D=vt(),E=dt("pre"),A=yt(j),bt(n,"class","svelte-1vg2l2b"),bt(a,"class","svelte-1vg2l2b"),bt(u,"class","svelte-1vg2l2b"),bt(h,"class","svelte-1vg2l2b"),bt(v,"class","events svelte-1vg2l2b"),bt(x,"class","svelte-1vg2l2b"),bt($,"class","json svelte-1vg2l2b"),bt(I,"class","svelte-1vg2l2b"),bt(E,"class","json svelte-1vg2l2b")},m(e,_){ut(e,t,_),lt(t,n),lt(t,r),nn(B,t,null),ut(e,o,_),ut(e,i,_),lt(i,a),lt(i,s),nn(N,i,null),ut(e,c,_),ut(e,l,_),lt(l,u),lt(l,p);for(let e=0;e<T.length;e+=1)T[e].m(l,null);ut(e,f,_),ut(e,d,_),lt(d,h),lt(d,y),lt(d,v),q&&q.m(v,null),lt(v,m),z&&z.m(v,null),lt(v,g),F&&F.m(v,null),ut(e,b,_),ut(e,w,_),lt(w,x),lt(w,k),lt(w,$),lt($,P),ut(e,C,_),ut(e,O,_),lt(O,I),lt(O,D),lt(O,E),lt(E,A),S=!0},p(e,t){var n={};e.client&&(n.client=t.client),B.$set(n);var r={};if(e.ctx&&(r.ctx=t.ctx),e.playerID&&(r.playerID=t.playerID),N.$set(r),e.shortcuts||e.client){let n;for(M=Object.entries(t.client.moves),n=0;n<M.length;n+=1){const r=qn(t,M,n);T[n]?(T[n].p(e,r),Xt(T[n],1)):(T[n]=zn(r),T[n].c(),Xt(T[n],1),T[n].m(l,null))}for(Jt(),n=M.length;n<T.length;n+=1)R(n);Yt()}t.client.events.endTurn?q||((q=Fn(t)).c(),q.m(v,m)):q&&(q.d(1),q=null),t.ctx.phase&&t.client.events.endPhase?z||((z=Ln(t)).c(),z.m(v,g)):z&&(z.d(1),z=null),t.ctx.activePlayers&&t.client.events.endStage?F||((F=Un(t)).c(),F.m(v,null)):F&&(F.d(1),F=null),S&&!e.G||_===(_=JSON.stringify(t.G,null,2)+"")||wt(P,_),S&&!e.ctx||j===(j=JSON.stringify(Hn(t.ctx),null,2)+"")||wt(A,j)},i(e){if(!S){Xt(B.$$.fragment,e),Xt(N.$$.fragment,e);for(let e=0;e<M.length;e+=1)Xt(T[e]);S=!0}},o(e){Qt(B.$$.fragment,e),Qt(N.$$.fragment,e),T=T.filter(Boolean);for(let e=0;e<T.length;e+=1)Qt(T[e]);S=!1},d(e){e&&pt(t),rn(B),e&&(pt(o),pt(i)),rn(N),e&&(pt(c),pt(l)),ft(T,e),e&&(pt(f),pt(d)),q&&q.d(),z&&z.d(),F&&F.d(),e&&(pt(b),pt(w),pt(C),pt(O))}}}function Hn(e){let t={};for(const n in e)n.startsWith("_")||(t[n]=e[n]);return t}function Kn(e,t,n){let{client:r}=t;const o=function(e,t,n){var r={},o={};for(var i in e)o[i]=i;for(var a in t)o[a]=a;for(var s={},c=0;c<n.length;c++){s[n[c]]=!0}var l=s,u=!0;for(var p in o){var f=p[0];if(l[f]){u=!1;break}l[f]=!0,r[p]=f}if(u)return r;l=s;var d=97;for(var h in r={},o){for(var y=String.fromCharCode(d);l[y];)d++,y=String.fromCharCode(d);l[y]=!0,r[h]=y}return r}(r.moves,r.events,"mlia");let i=r.playerID,a={},s={};r.subscribe(e=>{e&&(n("G",s=e.G),n("ctx",a=e.ctx)),n("playerID",i=r.playerID)});return e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,shortcuts:o,playerID:i,ctx:a,G:s,change_handler:e=>r.updatePlayerID(e.detail.playerID),click_handler:()=>r.events.endTurn(),click_handler_1:()=>r.events.endPhase(),click_handler_2:()=>r.events.endStage()}}class Vn extends sn{constructor(e){var t;super(),document.getElementById("svelte-1vg2l2b-style")||((t=dt("style")).id="svelte-1vg2l2b-style",t.textContent=".json.svelte-1vg2l2b{font-family:monospace;color:#888}label.svelte-1vg2l2b{font-weight:bold;font-size:1.1em;display:inline}h3.svelte-1vg2l2b{text-transform:uppercase}li.svelte-1vg2l2b{list-style:none;margin:none;margin-bottom:5px}.events.svelte-1vg2l2b{display:flex;flex-direction:column}.events.svelte-1vg2l2b button.svelte-1vg2l2b{width:100px}.events.svelte-1vg2l2b button.svelte-1vg2l2b:not(:last-child){margin-bottom:10px}",lt(document.head,t)),an(this,e,Kn,Gn,Qe,["client"])}}function Wn(e){var t,n,r,o,i,a,s=JSON.stringify(e.value)+"";return{c(){t=dt("div"),n=dt("strong"),r=yt(e.name),o=vt(),i=dt("div"),a=yt(s),bt(i,"class","svelte-13qih23"),bt(t,"class","item svelte-13qih23")},m(e,s){ut(e,t,s),lt(t,n),lt(n,r),lt(t,o),lt(t,i),lt(i,a)},p(e,t){e.name&&wt(r,t.name),e.value&&s!==(s=JSON.stringify(t.value)+"")&&wt(a,s)},i:He,o:He,d(e){e&&pt(t)}}}function Jn(e,t,n){let{name:r,value:o}=t;return e.$set=e=>{"name"in e&&n("name",r=e.name),"value"in e&&n("value",o=e.value)},{name:r,value:o}}class Yn extends sn{constructor(e){var t;super(),document.getElementById("svelte-13qih23-style")||((t=dt("style")).id="svelte-13qih23-style",t.textContent=".item.svelte-13qih23{padding:10px}.item.svelte-13qih23:not(:first-child){border-top:1px dashed #aaa}.item.svelte-13qih23 div.svelte-13qih23{float:right;text-align:right}",lt(document.head,t)),an(this,e,Jn,Wn,Qe,["name","value"])}}function Xn(e){var t,n,r,o=new Yn({props:{name:"isConnected",value:e.$client.isConnected}}),i=new Yn({props:{name:"isMultiplayer",value:e.$client.isMultiplayer}});return{c(){t=dt("span"),o.$$.fragment.c(),n=vt(),i.$$.fragment.c()},m(e,a){ut(e,t,a),nn(o,t,null),lt(t,n),nn(i,t,null),r=!0},p(e,t){var n={};e.$client&&(n.value=t.$client.isConnected),o.$set(n);var r={};e.$client&&(r.value=t.$client.isMultiplayer),i.$set(r)},i(e){r||(Xt(o.$$.fragment,e),Xt(i.$$.fragment,e),r=!0)},o(e){Qt(o.$$.fragment,e),Qt(i.$$.fragment,e),r=!1},d(e){e&&pt(t),rn(o),rn(i)}}}function Qn(e){var t,n,r,o,i,a=new Yn({props:{name:"gameID",value:e.client.gameID}}),s=new Yn({props:{name:"playerID",value:e.client.playerID}}),c=new Yn({props:{name:"isActive",value:e.$client.isActive}}),l=e.$client.isMultiplayer&&Xn(e);return{c(){t=dt("section"),a.$$.fragment.c(),n=vt(),s.$$.fragment.c(),r=vt(),c.$$.fragment.c(),o=vt(),l&&l.c(),bt(t,"class","gameinfo svelte-1yzq5o8")},m(e,u){ut(e,t,u),nn(a,t,null),lt(t,n),nn(s,t,null),lt(t,r),nn(c,t,null),lt(t,o),l&&l.m(t,null),i=!0},p(e,n){var r={};e.client&&(r.value=n.client.gameID),a.$set(r);var o={};e.client&&(o.value=n.client.playerID),s.$set(o);var i={};e.$client&&(i.value=n.$client.isActive),c.$set(i),n.$client.isMultiplayer?l?(l.p(e,n),Xt(l,1)):((l=Xn(n)).c(),Xt(l,1),l.m(t,null)):l&&(Jt(),Qt(l,1,1,()=>{l=null}),Yt())},i(e){i||(Xt(a.$$.fragment,e),Xt(s.$$.fragment,e),Xt(c.$$.fragment,e),Xt(l),i=!0)},o(e){Qt(a.$$.fragment,e),Qt(s.$$.fragment,e),Qt(c.$$.fragment,e),Qt(l),i=!1},d(e){e&&pt(t),rn(a),rn(s),rn(c),l&&l.d()}}}function Zn(e,t,n){let r,{client:o}=t;return Ze(e,o,e=>{r=e,n("$client",r)}),e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,$client:r}}class er extends sn{constructor(e){var t;super(),document.getElementById("svelte-1yzq5o8-style")||((t=dt("style")).id="svelte-1yzq5o8-style",t.textContent=".gameinfo.svelte-1yzq5o8{padding:10px}",lt(document.head,t)),an(this,e,Zn,Qn,Qe,["client"])}}function tr(e){var t,n;return{c(){t=dt("div"),n=yt(e.turn),bt(t,"class","turn-marker svelte-6eza86"),bt(t,"style",e.style)},m(e,r){ut(e,t,r),lt(t,n)},p(e,t){e.turn&&wt(n,t.turn)},i:He,o:He,d(e){e&&pt(t)}}}function nr(e,t,n){let{turn:r,numEvents:o}=t;const i=`grid-row: span ${o}`;return e.$set=e=>{"turn"in e&&n("turn",r=e.turn),"numEvents"in e&&n("numEvents",o=e.numEvents)},{turn:r,numEvents:o,style:i}}class rr extends sn{constructor(e){var t;super(),document.getElementById("svelte-6eza86-style")||((t=dt("style")).id="svelte-6eza86-style",t.textContent=".turn-marker.svelte-6eza86{display:flex;justify-content:center;align-items:center;grid-column:1;background:#555;color:#eee;text-align:center;font-weight:bold;border:1px solid #888}",lt(document.head,t)),an(this,e,nr,tr,Qe,["turn","numEvents"])}}function or(e){var t,n,r=e.phase||"";return{c(){t=dt("div"),n=yt(r),bt(t,"class","phase-marker svelte-1t4xap"),bt(t,"style",e.style)},m(e,r){ut(e,t,r),lt(t,n)},p(e,t){e.phase&&r!==(r=t.phase||"")&&wt(n,r)},i:He,o:He,d(e){e&&pt(t)}}}function ir(e,t,n){let{phase:r,numEvents:o}=t;const i=`grid-row: span ${o}`;return e.$set=e=>{"phase"in e&&n("phase",r=e.phase),"numEvents"in e&&n("numEvents",o=e.numEvents)},{phase:r,numEvents:o,style:i}}class ar extends sn{constructor(e){var t;super(),document.getElementById("svelte-1t4xap-style")||((t=dt("style")).id="svelte-1t4xap-style",t.textContent=".phase-marker.svelte-1t4xap{grid-column:3;background:#555;border:1px solid #888;color:#eee;text-align:center;font-weight:bold;padding-top:10px;padding-bottom:10px;text-orientation:sideways;writing-mode:vertical-rl;line-height:30px;width:100%}",lt(document.head,t)),an(this,e,ir,or,Qe,["phase","numEvents"])}}function sr(e){var t,n;return{c(){t=dt("div"),n=yt(e.custompayload)},m(e,r){ut(e,t,r),lt(t,n)},p:He,i:He,o:He,d(e){e&&pt(t)}}}function cr(e,t,n){let{payload:r}=t;const o=void 0!==r?JSON.stringify(r,null,4):"";return e.$set=e=>{"payload"in e&&n("payload",r=e.payload)},{payload:r,custompayload:o}}class lr extends sn{constructor(e){super(),an(this,e,cr,sr,Qe,["payload"])}}function ur(e){var t,n=new lr({props:{payload:e.payload}});return{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.payload&&(r.payload=t.payload),n.$set(r)},i(e){t||(Xt(n.$$.fragment,e),t=!0)},o(e){Qt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function pr(e){var t,n,r=e.payloadComponent;function o(e){return{props:{payload:e.payload}}}if(r)var i=new r(o(e));return{c(){i&&i.$$.fragment.c(),t=mt()},m(e,r){i&&nn(i,e,r),ut(e,t,r),n=!0},p(e,n){var a={};if(e.payload&&(a.payload=n.payload),r!==(r=n.payloadComponent)){if(i){Jt();const e=i;Qt(e.$$.fragment,1,0,()=>{rn(e,1)}),Yt()}r?((i=new r(o(n))).$$.fragment.c(),Xt(i.$$.fragment,1),nn(i,t.parentNode,t)):i=null}else r&&i.$set(a)},i(e){n||(i&&Xt(i.$$.fragment,e),n=!0)},o(e){i&&Qt(i.$$.fragment,e),n=!1},d(e){e&&pt(t),i&&rn(i,e)}}}function fr(e){var t,n,r,o,i,a,s,c,l,u,p,f=e.action.payload.type+"",d=e.args.join(",")+"",h=[pr,ur],y=[];function v(e,t){return t.payloadComponent?0:1}return c=v(0,e),l=y[c]=h[c](e),{c(){t=dt("div"),n=dt("div"),r=yt(f),o=yt("("),i=yt(d),a=yt(")"),s=vt(),l.c(),bt(t,"class","log-event player"+e.playerID+" svelte-10wdo7v"),$t(t,"pinned",e.pinned),p=[gt(t,"click",e.click_handler),gt(t,"mouseenter",e.mouseenter_handler),gt(t,"mouseleave",e.mouseleave_handler)]},m(e,l){ut(e,t,l),lt(t,n),lt(n,r),lt(n,o),lt(n,i),lt(n,a),lt(t,s),y[c].m(t,null),u=!0},p(e,n){u&&!e.action||f===(f=n.action.payload.type+"")||wt(r,f);var o=c;(c=v(0,n))===o?y[c].p(e,n):(Jt(),Qt(y[o],1,1,()=>{y[o]=null}),Yt(),(l=y[c])||(l=y[c]=h[c](n)).c(),Xt(l,1),l.m(t,null)),e.pinned&&$t(t,"pinned",n.pinned)},i(e){u||(Xt(l),u=!0)},o(e){Qt(l),u=!1},d(e){e&&pt(t),y[c].d(),Ye(p)}}}function dr(e,t,n){let{logIndex:r,action:o,pinned:i,payload:a,payloadComponent:s}=t;const c=jt(),l=o.payload.args||[],u=o.payload.playerID;return e.$set=e=>{"logIndex"in e&&n("logIndex",r=e.logIndex),"action"in e&&n("action",o=e.action),"pinned"in e&&n("pinned",i=e.pinned),"payload"in e&&n("payload",a=e.payload),"payloadComponent"in e&&n("payloadComponent",s=e.payloadComponent)},{logIndex:r,action:o,pinned:i,payload:a,payloadComponent:s,dispatch:c,args:l,playerID:u,click_handler:()=>c("click",{logIndex:r}),mouseenter_handler:()=>c("mouseenter",{logIndex:r}),mouseleave_handler:()=>c("mouseleave")}}class hr extends sn{constructor(e){var t;super(),document.getElementById("svelte-10wdo7v-style")||((t=dt("style")).id="svelte-10wdo7v-style",t.textContent=".log-event.svelte-10wdo7v{grid-column:2;cursor:pointer;overflow:hidden;display:flex;flex-direction:column;justify-content:center;background:#fff;border:1px dotted #ccc;border-left:5px solid #ccc;padding:5px;text-align:center;color:#888;font-size:14px;min-height:25px;line-height:25px}.log-event.svelte-10wdo7v:hover{border-style:solid;background:#eee}.log-event.pinned.svelte-10wdo7v{border-style:solid;background:#eee;opacity:1}.player0.svelte-10wdo7v{border-left-color:#ff851b}.player1.svelte-10wdo7v{border-left-color:#7fdbff}.player2.svelte-10wdo7v{border-left-color:#0074d9}.player3.svelte-10wdo7v{border-left-color:#39cccc}.player4.svelte-10wdo7v{border-left-color:#3d9970}.player5.svelte-10wdo7v{border-left-color:#2ecc40}.player6.svelte-10wdo7v{border-left-color:#01ff70}.player7.svelte-10wdo7v{border-left-color:#ffdc00}.player8.svelte-10wdo7v{border-left-color:#001f3f}.player9.svelte-10wdo7v{border-left-color:#ff4136}.player10.svelte-10wdo7v{border-left-color:#85144b}.player11.svelte-10wdo7v{border-left-color:#f012be}.player12.svelte-10wdo7v{border-left-color:#b10dc9}.player13.svelte-10wdo7v{border-left-color:#111111}.player14.svelte-10wdo7v{border-left-color:#aaaaaa}.player15.svelte-10wdo7v{border-left-color:#dddddd}",lt(document.head,t)),an(this,e,dr,fr,Qe,["logIndex","action","pinned","payload","payloadComponent"])}}function yr(e){var t,n;return{c(){t=ht("title"),n=yt(e.title)},m(e,r){ut(e,t,r),lt(t,n)},p(e,t){e.title&&wt(n,t.title)},d(e){e&&pt(t)}}}function vr(e){var t,n,r,o=e.title&&yr(e);const i=e.$$slots.default,a=function(e,t,n){if(e){const r=et(e,t,n);return e[0](r)}}(i,e,null);return{c(){t=ht("svg"),o&&o.c(),n=mt(),a&&a.c(),bt(t,"xmlns","http://www.w3.org/2000/svg"),bt(t,"viewBox",e.viewBox),bt(t,"class","svelte-c8tyih")},l(e){a&&a.l(svg_nodes)},m(e,i){ut(e,t,i),o&&o.m(t,null),lt(t,n),a&&a.m(t,null),r=!0},p(e,s){s.title?o?o.p(e,s):((o=yr(s)).c(),o.m(t,n)):o&&(o.d(1),o=null),a&&a.p&&e.$$scope&&a.p(function(e,t,n,r){return e[1]?Ve({},Ve(t.$$scope.changed||{},e[1](r?r(n):{}))):t.$$scope.changed||{}}(i,s,e,null),et(i,s,null)),r&&!e.viewBox||bt(t,"viewBox",s.viewBox)},i(e){r||(Xt(a,e),r=!0)},o(e){Qt(a,e),r=!1},d(e){e&&pt(t),o&&o.d(),a&&a.d(e)}}}function mr(e,t,n){let{title:r=null,viewBox:o}=t,{$$slots:i={},$$scope:a}=t;return e.$set=e=>{"title"in e&&n("title",r=e.title),"viewBox"in e&&n("viewBox",o=e.viewBox),"$$scope"in e&&n("$$scope",a=e.$$scope)},{title:r,viewBox:o,$$slots:i,$$scope:a}}class gr extends sn{constructor(e){var t;super(),document.getElementById("svelte-c8tyih-style")||((t=dt("style")).id="svelte-c8tyih-style",t.textContent="svg.svelte-c8tyih{stroke:currentColor;fill:currentColor;stroke-width:0;width:100%;height:auto;max-height:100%}",lt(document.head,t)),an(this,e,mr,vr,Qe,["title","viewBox"])}}function br(e){var t;return{c(){bt(t=ht("path"),"d","M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z")},m(e,n){ut(e,t,n)},d(e){e&&pt(t)}}}function wr(e){var t,n=[{viewBox:"0 0 512 512"},e.$$props];let r={$$slots:{default:[br]},$$scope:{ctx:e}};for(var o=0;o<n.length;o+=1)r=Ve(r,n[o]);var i=new gr({props:r});return{c(){i.$$.fragment.c()},m(e,n){nn(i,e,n),t=!0},p(e,t){var r,o=e.$$props?function(e,t){const n={},r={},o={$$scope:1};let i=e.length;for(;i--;){const a=e[i],s=t[i];if(s){for(const e in a)e in s||(r[e]=1);for(const e in s)o[e]||(n[e]=s[e],o[e]=1);e[i]=s}else for(const e in a)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(n,[n[0],(r=t.$$props,"object"==typeof r&&null!==r?r:{})]):{};e.$$scope&&(o.$$scope={changed:e,ctx:t}),i.$set(o)},i(e){t||(Xt(i.$$.fragment,e),t=!0)},o(e){Qt(i.$$.fragment,e),t=!1},d(e){rn(i,e)}}}function xr(e,t,n){return e.$set=e=>{n("$$props",t=Ve(Ve({},t),e))},{$$props:t,$$props:t=tt(t)}}class kr extends sn{constructor(e){super(),an(this,e,xr,wr,Qe,[])}}function $r(e){var t,n;return{c(){t=dt("div"),n=yt(e.text),bt(t,"alt",e.text),bt(t,"class","svelte-1a7time")},m(e,r){ut(e,t,r),lt(t,n)},p(e,r){e.text&&(wt(n,r.text),bt(t,"alt",r.text))},i:He,o:He,d(e){e&&pt(t)}}}function Pr(e,t,n){let r,{action:o}=t;return e.$set=e=>{"action"in e&&n("action",o=e.action)},e.$$.update=(e={action:1})=>{if(e.action){const{type:e,args:t}=o.payload,i=(t||[]).join(",");n("text",r=`${e}(${i})`)}},{action:o,text:r}}class Cr extends sn{constructor(e){var t;super(),document.getElementById("svelte-1a7time-style")||((t=dt("style")).id="svelte-1a7time-style",t.textContent="div.svelte-1a7time{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:500px}",lt(document.head,t)),an(this,e,Pr,$r,Qe,["action"])}}function Or(e,t,n){const r=Object.create(e);return r.child=t[n],r.i=n,r}function Ir(e){var t,n,r,o,i,a,s,c,l,u,p,f=e.child.value+"",d=e.child.visits+"",h=new Cr({props:{action:e.child.parentAction}});function y(){return e.click_handler(e)}function v(){return e.mouseout_handler(e)}function m(){return e.mouseover_handler(e)}return{c(){t=dt("tr"),n=dt("td"),r=yt(f),o=vt(),i=dt("td"),a=yt(d),s=vt(),c=dt("td"),h.$$.fragment.c(),l=vt(),bt(n,"class","svelte-ztcwsu"),bt(i,"class","svelte-ztcwsu"),bt(c,"class","svelte-ztcwsu"),bt(t,"class","svelte-ztcwsu"),$t(t,"clickable",e.children.length>0),$t(t,"selected",e.i===e.selectedIndex),p=[gt(t,"click",y),gt(t,"mouseout",v),gt(t,"mouseover",m)]},m(e,p){ut(e,t,p),lt(t,n),lt(n,r),lt(t,o),lt(t,i),lt(i,a),lt(t,s),lt(t,c),nn(h,c,null),lt(t,l),u=!0},p(n,o){e=o,u&&!n.children||f===(f=e.child.value+"")||wt(r,f),u&&!n.children||d===(d=e.child.visits+"")||wt(a,d);var i={};n.children&&(i.action=e.child.parentAction),h.$set(i),n.children&&$t(t,"clickable",e.children.length>0),n.selectedIndex&&$t(t,"selected",e.i===e.selectedIndex)},i(e){u||(Xt(h.$$.fragment,e),u=!0)},o(e){Qt(h.$$.fragment,e),u=!1},d(e){e&&pt(t),rn(h),Ye(p)}}}function Dr(e){var t,n,r,o,i;let a=e.children,s=[];for(let t=0;t<a.length;t+=1)s[t]=Ir(Or(e,a,t));const c=e=>Qt(s[e],1,1,()=>{s[e]=null});return{c(){t=dt("table"),(n=dt("thead")).innerHTML='<th class="svelte-ztcwsu">Value</th> <th class="svelte-ztcwsu">Visits</th> <th class="svelte-ztcwsu">Action</th>',r=vt(),o=dt("tbody");for(let e=0;e<s.length;e+=1)s[e].c();bt(t,"class","svelte-ztcwsu")},m(e,a){ut(e,t,a),lt(t,n),lt(t,r),lt(t,o);for(let e=0;e<s.length;e+=1)s[e].m(o,null);i=!0},p(e,t){if(e.children||e.selectedIndex){let n;for(a=t.children,n=0;n<a.length;n+=1){const r=Or(t,a,n);s[n]?(s[n].p(e,r),Xt(s[n],1)):(s[n]=Ir(r),s[n].c(),Xt(s[n],1),s[n].m(o,null))}for(Jt(),n=a.length;n<s.length;n+=1)c(n);Yt()}},i(e){if(!i){for(let e=0;e<a.length;e+=1)Xt(s[e]);i=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)Qt(s[e]);i=!1},d(e){e&&pt(t),ft(s,e)}}}function Er(e,t,n){let{root:r,selectedIndex:o=null}=t;const i=jt();let a=[],s=[];function c(e,t){i("select",{node:e,selectedIndex:t})}function l(e,t){null===o&&i("preview",{node:e})}return e.$set=e=>{"root"in e&&n("root",r=e.root),"selectedIndex"in e&&n("selectedIndex",o=e.selectedIndex)},e.$$.update=(e={root:1,parents:1})=>{if(e.root||e.parents){let e=r;for(n("parents",a=[]);e.parent;){const t=e.parent,{type:n,args:r}=e.parentAction.payload,o=`${n}(${(r||[]).join(",")})`;a.push({parent:t,arrowText:o}),e=t}a.reverse(),n("children",s=[...r.children].sort((e,t)=>e.visits<t.visits?1:-1).slice(0,50))}},{root:r,selectedIndex:o,children:s,Select:c,Preview:l,click_handler:({child:e,i:t})=>c(e,t),mouseout_handler:({i:e})=>l(null),mouseover_handler:({child:e,i:t})=>l(e)}}class Ar extends sn{constructor(e){var t;super(),document.getElementById("svelte-ztcwsu-style")||((t=dt("style")).id="svelte-ztcwsu-style",t.textContent="table.svelte-ztcwsu{font-size:12px;border-collapse:collapse;border:1px solid #ddd;padding:0}tr.svelte-ztcwsu{cursor:pointer}tr.svelte-ztcwsu:hover td.svelte-ztcwsu{background:#eee}tr.selected.svelte-ztcwsu td.svelte-ztcwsu{background:#eee}td.svelte-ztcwsu{padding:10px;height:10px;line-height:10px;font-size:12px;border:none}th.svelte-ztcwsu{background:#888;color:#fff;padding:10px;text-align:center}",lt(document.head,t)),an(this,e,Er,Dr,Qe,["root","selectedIndex"])}}function Sr(e,t,n){const r=Object.create(e);return r.node=t[n].node,r.selectedIndex=t[n].selectedIndex,r.i=n,r}function _r(e){var t;var n=new Ar({props:{root:e.node,selectedIndex:e.selectedIndex}});return n.$on("select",(function(...t){return e.select_handler_1(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),t.nodes&&(o.selectedIndex=e.selectedIndex),n.$set(o)},i(e){t||(Xt(n.$$.fragment,e),t=!0)},o(e){Qt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function jr(e){var t;var n=new Ar({props:{root:e.node}});return n.$on("select",(function(...t){return e.select_handler(e,...t)})),n.$on("preview",(function(...t){return e.preview_handler(e,...t)})),{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(t,r){e=r;var o={};t.nodes&&(o.root=e.node),n.$set(o)},i(e){t||(Xt(n.$$.fragment,e),t=!0)},o(e){Qt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Br(e){var t,n,r,o,i,a=0!==e.i&&function(e){var t,n,r=new kr({});return{c(){t=dt("div"),r.$$.fragment.c(),bt(t,"class","icon svelte-1f0amz4")},m(e,o){ut(e,t,o),nn(r,t,null),n=!0},i(e){n||(Xt(r.$$.fragment,e),n=!0)},o(e){Qt(r.$$.fragment,e),n=!1},d(e){e&&pt(t),rn(r)}}}(),s=[jr,_r],c=[];function l(e,t){return t.i===t.nodes.length-1?0:1}return r=l(0,e),o=c[r]=s[r](e),{c(){a&&a.c(),t=vt(),n=dt("section"),o.c()},m(e,o){a&&a.m(e,o),ut(e,t,o),ut(e,n,o),c[r].m(n,null),i=!0},p(e,t){var i=r;(r=l(0,t))===i?c[r].p(e,t):(Jt(),Qt(c[i],1,1,()=>{c[i]=null}),Yt(),(o=c[r])||(o=c[r]=s[r](t)).c(),Xt(o,1),o.m(n,null))},i(e){i||(Xt(a),Xt(o),i=!0)},o(e){Qt(a),Qt(o),i=!1},d(e){a&&a.d(e),e&&(pt(t),pt(n)),c[r].d()}}}function Nr(e){var t,n,r,o,i=new kr({}),a=new Ar({props:{root:e.preview}});return{c(){t=dt("div"),i.$$.fragment.c(),n=vt(),r=dt("section"),a.$$.fragment.c(),bt(t,"class","icon svelte-1f0amz4"),bt(r,"class","preview svelte-1f0amz4")},m(e,s){ut(e,t,s),nn(i,t,null),ut(e,n,s),ut(e,r,s),nn(a,r,null),o=!0},p(e,t){var n={};e.preview&&(n.root=t.preview),a.$set(n)},i(e){o||(Xt(i.$$.fragment,e),Xt(a.$$.fragment,e),o=!0)},o(e){Qt(i.$$.fragment,e),Qt(a.$$.fragment,e),o=!1},d(e){e&&pt(t),rn(i),e&&(pt(n),pt(r)),rn(a)}}}function Mr(e){var t,n,r;let o=e.nodes,i=[];for(let t=0;t<o.length;t+=1)i[t]=Br(Sr(e,o,t));const a=e=>Qt(i[e],1,1,()=>{i[e]=null});var s=e.preview&&Nr(e);return{c(){t=dt("div");for(let e=0;e<i.length;e+=1)i[e].c();n=vt(),s&&s.c(),bt(t,"class","visualizer svelte-1f0amz4")},m(e,o){ut(e,t,o);for(let e=0;e<i.length;e+=1)i[e].m(t,null);lt(t,n),s&&s.m(t,null),r=!0},p(e,r){if(e.nodes){let s;for(o=r.nodes,s=0;s<o.length;s+=1){const a=Sr(r,o,s);i[s]?(i[s].p(e,a),Xt(i[s],1)):(i[s]=Br(a),i[s].c(),Xt(i[s],1),i[s].m(t,n))}for(Jt(),s=o.length;s<i.length;s+=1)a(s);Yt()}r.preview?s?(s.p(e,r),Xt(s,1)):((s=Nr(r)).c(),Xt(s,1),s.m(t,null)):s&&(Jt(),Qt(s,1,1,()=>{s=null}),Yt())},i(e){if(!r){for(let e=0;e<o.length;e+=1)Xt(i[e]);Xt(s),r=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)Qt(i[e]);Qt(s),r=!1},d(e){e&&pt(t),ft(i,e),s&&s.d()}}}function Tr(e,t,n){let{metadata:r}=t,o=[],i=null;function a({node:e,selectedIndex:t},r){n("preview",i=null),n("nodes",o[r].selectedIndex=t,o),n("nodes",o=[...o.slice(0,r+1),{node:e}])}function s({node:e},t){n("preview",i=e)}return e.$set=e=>{"metadata"in e&&n("metadata",r=e.metadata)},e.$$.update=(e={metadata:1})=>{e.metadata&&n("nodes",o=[{node:r}])},{metadata:r,nodes:o,preview:i,SelectNode:a,PreviewNode:s,select_handler:({i:e},t)=>a(t.detail,e),preview_handler:({i:e},t)=>s(t.detail),select_handler_1:({i:e},t)=>a(t.detail,e)}}class Rr extends sn{constructor(e){var t;super(),document.getElementById("svelte-1f0amz4-style")||((t=dt("style")).id="svelte-1f0amz4-style",t.textContent=".visualizer.svelte-1f0amz4{display:flex;flex-direction:column;align-items:center;padding:50px}.preview.svelte-1f0amz4{opacity:0.5}.icon.svelte-1f0amz4{color:#777;width:32px;height:32px;margin-bottom:20px}",lt(document.head,t)),an(this,e,Tr,Mr,Qe,["metadata"])}}function qr(e,t,n){const r=Object.create(e);return r.phase=t[n].phase,r.i=n,r}function zr(e,t,n){const r=Object.create(e);return r.action=t[n].action,r.payload=t[n].payload,r.i=n,r}function Fr(e,t,n){const r=Object.create(e);return r.turn=t[n].turn,r.i=n,r}function Lr(e){var t,n=new rr({props:{turn:e.turn,numEvents:e.turnBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.turn=t.turn),e.turnBoundaries&&(r.numEvents=t.turnBoundaries[t.i]),n.$set(r)},i(e){t||(Xt(n.$$.fragment,e),t=!0)},o(e){Qt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Ur(e){var t,n,r=e.i in e.turnBoundaries&&Lr(e);return{c(){r&&r.c(),t=mt()},m(e,o){r&&r.m(e,o),ut(e,t,o),n=!0},p(e,n){n.i in n.turnBoundaries?r?(r.p(e,n),Xt(r,1)):((r=Lr(n)).c(),Xt(r,1),r.m(t.parentNode,t)):r&&(Jt(),Qt(r,1,1,()=>{r=null}),Yt())},i(e){n||(Xt(r),n=!0)},o(e){Qt(r),n=!1},d(e){r&&r.d(e),e&&pt(t)}}}function Gr(e){var t,n=new hr({props:{pinned:e.i===e.pinned,logIndex:e.i,action:e.action,payload:e.payload}});return n.$on("click",e.OnLogClick),n.$on("mouseenter",e.OnMouseEnter),n.$on("mouseleave",e.OnMouseLeave),{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.pinned&&(r.pinned=t.i===t.pinned),e.renderedLogEntries&&(r.action=t.action),e.renderedLogEntries&&(r.payload=t.payload),n.$set(r)},i(e){t||(Xt(n.$$.fragment,e),t=!0)},o(e){Qt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Hr(e){var t,n=new ar({props:{phase:e.phase,numEvents:e.phaseBoundaries[e.i]}});return{c(){n.$$.fragment.c()},m(e,r){nn(n,e,r),t=!0},p(e,t){var r={};e.renderedLogEntries&&(r.phase=t.phase),e.phaseBoundaries&&(r.numEvents=t.phaseBoundaries[t.i]),n.$set(r)},i(e){t||(Xt(n.$$.fragment,e),t=!0)},o(e){Qt(n.$$.fragment,e),t=!1},d(e){rn(n,e)}}}function Kr(e){var t,n,r=e.i in e.phaseBoundaries&&Hr(e);return{c(){r&&r.c(),t=mt()},m(e,o){r&&r.m(e,o),ut(e,t,o),n=!0},p(e,n){n.i in n.phaseBoundaries?r?(r.p(e,n),Xt(r,1)):((r=Hr(n)).c(),Xt(r,1),r.m(t.parentNode,t)):r&&(Jt(),Qt(r,1,1,()=>{r=null}),Yt())},i(e){n||(Xt(r),n=!0)},o(e){Qt(r),n=!1},d(e){r&&r.d(e),e&&pt(t)}}}function Vr(e){var t,n,r,o,i;let a=e.renderedLogEntries,s=[];for(let t=0;t<a.length;t+=1)s[t]=Ur(Fr(e,a,t));const c=e=>Qt(s[e],1,1,()=>{s[e]=null});let l=e.renderedLogEntries,u=[];for(let t=0;t<l.length;t+=1)u[t]=Gr(zr(e,l,t));const p=e=>Qt(u[e],1,1,()=>{u[e]=null});let f=e.renderedLogEntries,d=[];for(let t=0;t<f.length;t+=1)d[t]=Kr(qr(e,f,t));const h=e=>Qt(d[e],1,1,()=>{d[e]=null});return{c(){t=dt("div");for(let e=0;e<s.length;e+=1)s[e].c();n=vt();for(let e=0;e<u.length;e+=1)u[e].c();r=vt();for(let e=0;e<d.length;e+=1)d[e].c();bt(t,"class","gamelog svelte-1pq5e4b"),$t(t,"pinned",e.pinned),i=gt(window,"keydown",e.OnKeyDown)},m(e,i){ut(e,t,i);for(let e=0;e<s.length;e+=1)s[e].m(t,null);lt(t,n);for(let e=0;e<u.length;e+=1)u[e].m(t,null);lt(t,r);for(let e=0;e<d.length;e+=1)d[e].m(t,null);o=!0},p(e,o){if(e.turnBoundaries||e.renderedLogEntries){let r;for(a=o.renderedLogEntries,r=0;r<a.length;r+=1){const i=Fr(o,a,r);s[r]?(s[r].p(e,i),Xt(s[r],1)):(s[r]=Ur(i),s[r].c(),Xt(s[r],1),s[r].m(t,n))}for(Jt(),r=a.length;r<s.length;r+=1)c(r);Yt()}if(e.pinned||e.renderedLogEntries){let n;for(l=o.renderedLogEntries,n=0;n<l.length;n+=1){const i=zr(o,l,n);u[n]?(u[n].p(e,i),Xt(u[n],1)):(u[n]=Gr(i),u[n].c(),Xt(u[n],1),u[n].m(t,r))}for(Jt(),n=l.length;n<u.length;n+=1)p(n);Yt()}if(e.phaseBoundaries||e.renderedLogEntries){let n;for(f=o.renderedLogEntries,n=0;n<f.length;n+=1){const r=qr(o,f,n);d[n]?(d[n].p(e,r),Xt(d[n],1)):(d[n]=Kr(r),d[n].c(),Xt(d[n],1),d[n].m(t,null))}for(Jt(),n=f.length;n<d.length;n+=1)h(n);Yt()}e.pinned&&$t(t,"pinned",o.pinned)},i(e){if(!o){for(let e=0;e<a.length;e+=1)Xt(s[e]);for(let e=0;e<l.length;e+=1)Xt(u[e]);for(let e=0;e<f.length;e+=1)Xt(d[e]);o=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)Qt(s[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)Qt(u[e]);d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)Qt(d[e]);o=!1},d(e){e&&pt(t),ft(s,e),ft(u,e),ft(d,e),i()}}}function Wr(e,t,n){let r,{client:o}=t;Ze(e,o,e=>{r=e,n("$client",r)});const{secondaryPane:i}=Nt("secondaryPane"),a=o.getInitialState();let s,{log:c}=r,l=null;function u(e){let t=a;for(let n=0;n<c.length;n++){const{action:r,automatic:i}=c[n];if(i||(t=o.reducer(t,r)),"MAKE_MOVE"==r.type){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}function p(){n("pinned",l=null),o.overrideGameState(null),i.set(null)}_t(p);let f={},d={};return e.$set=e=>{"client"in e&&n("client",o=e.client)},e.$$.update=(e={$client:1,log:1,renderedLogEntries:1})=>{if(e.$client||e.log||e.renderedLogEntries){n("log",c=r.log),n("renderedLogEntries",s=c.filter(e=>"MAKE_MOVE"==e.action.type));let e=0,t=0;n("turnBoundaries",f={}),n("phaseBoundaries",d={});for(let r=0;r<s.length;r++){const{action:o,payload:i,turn:a,phase:c}=s[r];t++,e++,r!=s.length-1&&s[r+1].turn==a||(n("turnBoundaries",f[r]=t,f),t=0),r!=s.length-1&&s[r+1].phase==c||(n("phaseBoundaries",d[r]=e,d),e=0)}}},{client:o,pinned:l,OnLogClick:function(e){const{logIndex:t}=e.detail,r=u(t),a=c.filter(e=>"MAKE_MOVE"==e.action.type);if(o.overrideGameState(r),l==t)n("pinned",l=null),i.set(null);else{n("pinned",l=t);const{metadata:e}=a[t].action.payload;e&&i.set({component:Rr,metadata:e})}},OnMouseEnter:function(e){const{logIndex:t}=e.detail;if(null===l){const e=u(t);o.overrideGameState(e)}},OnMouseLeave:function(){null===l&&o.overrideGameState(null)},OnKeyDown:function(e){27==e.keyCode&&p()},renderedLogEntries:s,turnBoundaries:f,phaseBoundaries:d}}class Jr extends sn{constructor(e){var t;super(),document.getElementById("svelte-1pq5e4b-style")||((t=dt("style")).id="svelte-1pq5e4b-style",t.textContent=".gamelog.svelte-1pq5e4b{display:grid;grid-template-columns:30px 1fr 30px;grid-auto-rows:auto;grid-auto-flow:column}",lt(document.head,t)),an(this,e,Wr,Vr,Qe,["client"])}}const{Object:Yr}=tn;function Xr(e,t,n){const r=Yr.create(e);return r.key=t[n][0],r.value=t[n][1],r}function Qr(e){var t,n,r,o,i,a,s,c=e.values[e.key]+"";function l(){e.input_change_input_handler.call(o,e)}return{c(){t=dt("span"),n=yt(c),r=vt(),o=dt("input"),bt(t,"class","value svelte-7cel4i"),bt(o,"type","range"),bt(o,"min",i=e.value.range.min),bt(o,"max",a=e.value.range.max),s=[gt(o,"change",l),gt(o,"input",l),gt(o,"change",e.OnChange)]},m(i,a){ut(i,t,a),lt(t,n),ut(i,r,a),ut(i,o,a),xt(o,e.values[e.key])},p(t,r){e=r,(t.values||t.bot)&&c!==(c=e.values[e.key]+"")&&wt(n,c),(t.values||t.Object||t.bot)&&xt(o,e.values[e.key]),t.bot&&i!==(i=e.value.range.min)&&bt(o,"min",i),t.bot&&a!==(a=e.value.range.max)&&bt(o,"max",a)},d(e){e&&(pt(t),pt(r),pt(o)),Ye(s)}}}function Zr(e){var t,n;function r(){e.input_change_handler.call(t,e)}return{c(){bt(t=dt("input"),"type","checkbox"),bt(t,"class","svelte-7cel4i"),n=[gt(t,"change",r),gt(t,"change",e.OnChange)]},m(n,r){ut(n,t,r),t.checked=e.values[e.key]},p(n,r){e=r,(n.values||n.Object||n.bot)&&(t.checked=e.values[e.key])},d(e){e&&pt(t),Ye(n)}}}function eo(e){var t,n,r,o,i,a,s=e.key+"",c=e.value.range&&Qr(e),l="boolean"==typeof e.value.value&&Zr(e);return{c(){t=dt("div"),n=dt("label"),r=yt(s),o=vt(),c&&c.c(),i=vt(),l&&l.c(),a=vt(),bt(n,"class","svelte-7cel4i"),bt(t,"class","option svelte-7cel4i")},m(e,s){ut(e,t,s),lt(t,n),lt(n,r),lt(t,o),c&&c.m(t,null),lt(t,i),l&&l.m(t,null),lt(t,a)},p(e,n){e.bot&&s!==(s=n.key+"")&&wt(r,s),n.value.range?c?c.p(e,n):((c=Qr(n)).c(),c.m(t,i)):c&&(c.d(1),c=null),"boolean"==typeof n.value.value?l?l.p(e,n):((l=Zr(n)).c(),l.m(t,a)):l&&(l.d(1),l=null)},d(e){e&&pt(t),c&&c.d(),l&&l.d()}}}function to(e){var t;let n=e.Object.entries(e.bot.opts()),r=[];for(let t=0;t<n.length;t+=1)r[t]=eo(Xr(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=mt()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);ut(e,t,n)},p(e,o){if(e.Object||e.bot||e.values){let i;for(n=o.Object.entries(o.bot.opts()),i=0;i<n.length;i+=1){const a=Xr(o,n,i);r[i]?r[i].p(e,a):(r[i]=eo(a),r[i].c(),r[i].m(t.parentNode,t))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:He,o:He,d(e){ft(r,e),e&&pt(t)}}}function no(e,t,n){let{bot:r}=t,o={};for(let[e,t]of Object.entries(r.opts()))n("values",o[e]=t.value,o);return e.$set=e=>{"bot"in e&&n("bot",r=e.bot)},{bot:r,values:o,OnChange:function(){for(let[e,t]of Object.entries(o))r.setOpt(e,t)},Object:Object,input_change_input_handler:function({key:e}){o[e]=function(e){return""===e?void 0:+e}(this.value),n("values",o),n("Object",Object),n("bot",r)},input_change_handler:function({key:e}){o[e]=this.checked,n("values",o),n("Object",Object),n("bot",r)}}}class ro extends sn{constructor(e){var t;super(),document.getElementById("svelte-7cel4i-style")||((t=dt("style")).id="svelte-7cel4i-style",t.textContent="label.svelte-7cel4i{font-weight:bold;color:#999}.option.svelte-7cel4i{margin-bottom:20px}.value.svelte-7cel4i{font-weight:bold}input[type='checkbox'].svelte-7cel4i{vertical-align:middle}",lt(document.head,t)),an(this,e,no,to,Qe,["bot"])}}function oo({game:e,isClient:t}){return e=Ge(e),(n=null,r)=>{switch(r.type){case"GAME_EVENT":{if(n={...n,deltalog:[]},t)return n;if(void 0!==n.ctx.gameover)return Me("cannot call event after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return Me(`disallowed event: ${r.payload.type}`),n;n=_e(n,{game:e,isClient:!1,playerID:r.payload.playerID});let o=e.flow.processEvent(n,r);return o=je(o,{game:e,isClient:!1}),{...o,_stateID:n._stateID+1}}case"MAKE_MOVE":{n={...n,deltalog:[]};const o=e.flow.getMove(n.ctx,r.payload.type,r.payload.playerID||n.ctx.currentPlayer);if(null===o)return Me(`disallowed move: ${r.payload.type}`),n;if(t&&!1===o.client)return n;if(void 0!==n.ctx.gameover)return Me("cannot make move after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return Me(`disallowed move: ${r.payload.type}`),n;n=_e(n,{game:e,isClient:t,playerID:r.payload.playerID});let i=e.processMove(n,r.payload);if("INVALID_MOVE"===i)return Me(`invalid move: ${r.payload.type} args: ${r.payload.args}`),n;let a={action:r,_stateID:n._stateID,turn:n.ctx.turn,phase:n.ctx.phase};!0===o.redact&&(a.redact=!0);const s={...n,G:i,deltalog:[a],_stateID:n._stateID+1};return t&&((e,t)=>[...Ee,...t.game.plugins].filter(e=>void 0!==e.noClient).map(n=>{const r=n.name,o=e.plugins[r];return!!o&&n.noClient({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data})}).some(e=>!0===e))(s,{game:e})?n:(n=s,t?n=je(n,{game:e,isClient:!0}):(n=e.flow.processMove(n,r.payload),n=je(n,{game:e})))}case"RESET":case"UPDATE":case"SYNC":return r.state;case"UNDO":{const{_undo:t,_redo:r}=n;if(t.length<2)return n;const s=t[t.length-1],c=t[t.length-2],l=e.flow.getMove(n.ctx,s.moveType,n.ctx.currentPlayer);return o=n.G,i=n.ctx,!function(e){return void 0!==e.undoable}(a=l)||(a.undoable instanceof Function?a.undoable(o,i):a.undoable)?{...n,G:c.G,ctx:c.ctx,_undo:t.slice(0,t.length-1),_redo:[s,...r]}:n}case"REDO":{const{_undo:e,_redo:t}=n;if(0==t.length)return n;const r=t[0];return{...n,G:r.G,ctx:r.ctx,_undo:[...e,r],_redo:t.slice(1)}}case"PLUGIN":return((e,t,n)=>(n.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},i=n.action(o.data,t.payload);e={...e,plugins:{...e.plugins,[r]:{...o,data:i}}}}),e))(n,r,{game:e});default:return n}var o,i,a}}var io=function(){function e(t){var n=this,o=t.enumerate,i=t.seed;r(this,e),a(this,"enumerate",(function(e,t,r){return n.enumerateFn(e,t,r).map((function(e){return void 0!==e.payload?e:void 0!==e.move?C(e.move,e.args,r):void 0!==e.event?O(e.event,e.args,r):void 0}))})),this.enumerateFn=o,this.seed=i,this.iterationCounter=0,this._opts={}}return i(e,[{key:"addOpt",value:function(e){var t=e.key,n=e.range,r=e.initial;this._opts[t]={range:n,value:r}}},{key:"getOpt",value:function(e){return this._opts[e].value}},{key:"setOpt",value:function(e,t){e in this._opts&&(this._opts[e].value=t)}},{key:"opts",value:function(){return this._opts}},{key:"random",value:function(e){var t;if(void 0!==this.seed){var n=null;t=(n=this.prngstate?new Oe("",{state:this.prngstate}):new Oe(this.seed,{state:!0}))(),this.prngstate=n.state()}else t=Math.random();return e?e.length?e[Math.floor(t*e.length)]:Math.floor(t*e):t}}]),e}(),ao=function(e){function t(e){var n,o=e.enumerate,i=e.seed,a=e.objectives,s=e.game,c=e.iterations,l=e.playoutDepth,p=e.iterationCallback;return r(this,t),void 0===a&&(a=function(){return{}}),(n=d(this,u(t).call(this,{enumerate:o,seed:i}))).objectives=a,n.iterationCallback=p||function(){},n.reducer=oo({game:s}),n.iterations=c,n.playoutDepth=l,n.addOpt({key:"async",initial:!1}),n.addOpt({key:"iterations",initial:"number"==typeof c?c:1e3,range:{min:1,max:2e3}}),n.addOpt({key:"playoutDepth",initial:"number"==typeof l?l:50,range:{min:1,max:100}}),n}return l(t,e),i(t,[{key:"createNode",value:function(e){var t=e.state,n=e.parentAction,r=e.parent,o=e.playerID,i=t.G,a=t.ctx,s=[],c=[];if(void 0!==o)s=this.enumerate(i,a,o),c=this.objectives(i,a,o);else if(a.activePlayers)for(var l in a.activePlayers)s=s.concat(this.enumerate(i,a,l)),c=c.concat(this.objectives(i,a,l));else s=s.concat(this.enumerate(i,a,a.currentPlayer)),c=c.concat(this.objectives(i,a,a.currentPlayer));return{state:t,parent:r,parentAction:n,actions:s,objectives:c,children:[],visits:0,value:0}}},{key:"select",value:function(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;var t=null,n=0,r=!0,o=!1,i=void 0;try{for(var a,s=e.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,l=c.visits+Number.EPSILON,u=c.value/l+Math.sqrt(2*Math.log(e.visits)/l);(null==t||u>n)&&(n=u,t=c)}}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return this.select(t)}},{key:"expand",value:function(e){var t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;var n=this.random(t.length),r=t[n];e.actions.splice(n,1);var o=this.reducer(e.state,r),i=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(i),i}},{key:"playout",value:function(e){var t=this,r=e.state,o=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(o=this.playoutDepth(r.G,r.ctx));for(var i=function(e){var n=r,o=n.G,i=n.ctx,a=i.currentPlayer;i.activePlayers&&(a=Object.keys(i.activePlayers)[0]);var s=t.enumerate(o,i,a),c=t.objectives(o,i),l=Object.keys(c).reduce((function(e,t){var n=c[t];return n.checker(o,i)?e+n.weight:e}),0);if(l>0)return{v:{score:l}};if(!s||0==s.length)return{v:void 0};var u=t.random(s.length),p=t.reducer(r,s[u]);r=p},a=0;a<o&&void 0===r.ctx.gameover;a++){var s=i();if("object"===n(s))return s.v}return r.ctx.gameover}},{key:"backpropagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}},{key:"play",value:function(e,t){var n=this,r=this.createNode({state:e,playerID:t}),o=this.getOpt("iterations");"function"==typeof this.iterations&&(o=this.iterations(e.G,e.ctx));var i=function(){var e=null,t=!0,n=!1,o=void 0;try{for(var i,a=r.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;(null==e||s.visits>e.visits)&&(e=s)}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}return{action:e&&e.parentAction,metadata:r}};return new Promise((function(e){var t=function(){for(var e=0;e<25&&n.iterationCounter<o;e++){var t=n.select(r),i=n.expand(t),a=n.playout(i);n.backpropagate(i,a),n.iterationCounter++}n.iterationCallback({iterationCounter:n.iterationCounter,numIterations:o,metadata:r})};if(n.iterationCounter=0,n.getOpt("async")){!function r(){n.iterationCounter<o?(t(),setTimeout(r,0)):e(i())}()}else{for(;n.iterationCounter<o;)t();e(i())}}))}}]),t}(io),so=function(e){function t(){return r(this,t),d(this,u(t).apply(this,arguments))}return l(t,e),i(t,[{key:"play",value:function(e,t){var n=e.G,r=e.ctx,o=this.enumerate(n,r,t);return Promise.resolve({action:this.random(o)})}}]),t}(io);async function co(e,t){var n=e.store.getState(),r=n.ctx.currentPlayer;n.ctx.activePlayers&&(r=Object.keys(n.ctx.activePlayers)[0]);var o=await t.play(n,r),i=o.action,a=o.metadata;return i&&(i.payload.metadata=a,e.store.dispatch(i)),i}function lo(e,t,n){const r=Object.create(e);return r.bot=t[n],r}function uo(e){var t,n,r;return{c(){(t=dt("p")).textContent="No bots available.",n=vt(),(r=dt("p")).innerHTML='\n\t\t\t        Follow the instructions\n\t\t\t        <a href="https://boardgame.io/documentation/#/tutorial?id=bots" target="_blank">\n\t\t\t          here</a>\n\t\t\t        to set up bots.\n\t\t\t      '},m(e,o){ut(e,t,o),ut(e,n,o),ut(e,r,o)},p:He,i:He,o:He,d(e){e&&(pt(t),pt(n),pt(r))}}}function po(e){var t;return{c(){(t=dt("p")).textContent="The bot debugger is only available in singleplayer mode."},m(e,n){ut(e,t,n)},p:He,i:He,o:He,d(e){e&&pt(t)}}}function fo(e){var t,n,r,o,i,a,s,c,l,u,p,f,d,h,y,v,m,g,b=Object.keys(e.bot.opts()).length,w=new wn({props:{value:"1",onPress:e.Reset,label:"reset"}}),x=new wn({props:{value:"2",onPress:e.Step,label:"play"}}),k=new wn({props:{value:"3",onPress:e.Simulate,label:"simulate"}});let $=Object.keys(e.bots),P=[];for(let t=0;t<$.length;t+=1)P[t]=ho(lo(e,$,t));var C=b&&yo(e),O=(e.botAction||e.iterationCounter)&&vo(e);return{c(){t=dt("section"),(n=dt("h3")).textContent="Controls",r=vt(),o=dt("li"),w.$$.fragment.c(),i=vt(),a=dt("li"),x.$$.fragment.c(),s=vt(),c=dt("li"),k.$$.fragment.c(),l=vt(),u=dt("section"),(p=dt("h3")).textContent="Bot",f=vt(),d=dt("select");for(let e=0;e<P.length;e+=1)P[e].c();h=vt(),C&&C.c(),y=vt(),O&&O.c(),v=mt(),bt(n,"class","svelte-hsd9fq"),bt(o,"class","svelte-hsd9fq"),bt(a,"class","svelte-hsd9fq"),bt(c,"class","svelte-hsd9fq"),bt(p,"class","svelte-hsd9fq"),void 0===e.selectedBot&&Ut(()=>e.select_change_handler.call(d)),g=[gt(d,"change",e.select_change_handler),gt(d,"change",e.ChangeBot)]},m(g,b){ut(g,t,b),lt(t,n),lt(t,r),lt(t,o),nn(w,o,null),lt(t,i),lt(t,a),nn(x,a,null),lt(t,s),lt(t,c),nn(k,c,null),ut(g,l,b),ut(g,u,b),lt(u,p),lt(u,f),lt(u,d);for(let e=0;e<P.length;e+=1)P[e].m(d,null);kt(d,e.selectedBot),ut(g,h,b),C&&C.m(g,b),ut(g,y,b),O&&O.m(g,b),ut(g,v,b),m=!0},p(e,t){if(e.bots){let n;for($=Object.keys(t.bots),n=0;n<$.length;n+=1){const r=lo(t,$,n);P[n]?P[n].p(e,r):(P[n]=ho(r),P[n].c(),P[n].m(d,null))}for(;n<P.length;n+=1)P[n].d(1);P.length=$.length}e.selectedBot&&kt(d,t.selectedBot),e.bot&&(b=Object.keys(t.bot.opts()).length),b?C?(C.p(e,t),Xt(C,1)):((C=yo(t)).c(),Xt(C,1),C.m(y.parentNode,y)):C&&(Jt(),Qt(C,1,1,()=>{C=null}),Yt()),t.botAction||t.iterationCounter?O?O.p(e,t):((O=vo(t)).c(),O.m(v.parentNode,v)):O&&(O.d(1),O=null)},i(e){m||(Xt(w.$$.fragment,e),Xt(x.$$.fragment,e),Xt(k.$$.fragment,e),Xt(C),m=!0)},o(e){Qt(w.$$.fragment,e),Qt(x.$$.fragment,e),Qt(k.$$.fragment,e),Qt(C),m=!1},d(e){e&&pt(t),rn(w),rn(x),rn(k),e&&(pt(l),pt(u)),ft(P,e),e&&pt(h),C&&C.d(e),e&&pt(y),O&&O.d(e),e&&pt(v),Ye(g)}}}function ho(e){var t,n,r=e.bot+"";return{c(){t=dt("option"),n=yt(r),t.__value=e.bot,t.value=t.__value},m(e,r){ut(e,t,r),lt(t,n)},p:He,d(e){e&&pt(t)}}}function yo(e){var t,n,r,o,i,a,s,c,l,u=new ro({props:{bot:e.bot}});return{c(){t=dt("section"),(n=dt("h3")).textContent="Options",r=vt(),(o=dt("label")).textContent="debug",i=vt(),a=dt("input"),s=vt(),u.$$.fragment.c(),bt(n,"class","svelte-hsd9fq"),bt(o,"class","svelte-hsd9fq"),bt(a,"type","checkbox"),bt(a,"class","svelte-hsd9fq"),l=[gt(a,"change",e.input_change_handler),gt(a,"change",e.OnDebug)]},m(l,p){ut(l,t,p),lt(t,n),lt(t,r),lt(t,o),lt(t,i),lt(t,a),a.checked=e.debug,lt(t,s),nn(u,t,null),c=!0},p(e,t){e.debug&&(a.checked=t.debug);var n={};e.bot&&(n.bot=t.bot),u.$set(n)},i(e){c||(Xt(u.$$.fragment,e),c=!0)},o(e){Qt(u.$$.fragment,e),c=!1},d(e){e&&pt(t),rn(u),Ye(l)}}}function vo(e){var t,n,r,o,i=e.progress&&e.progress<1&&mo(e),a=e.botAction&&go(e);return{c(){t=dt("section"),(n=dt("h3")).textContent="Result",r=vt(),i&&i.c(),o=vt(),a&&a.c(),bt(n,"class","svelte-hsd9fq")},m(e,s){ut(e,t,s),lt(t,n),lt(t,r),i&&i.m(t,null),lt(t,o),a&&a.m(t,null)},p(e,n){n.progress&&n.progress<1?i?i.p(e,n):((i=mo(n)).c(),i.m(t,o)):i&&(i.d(1),i=null),n.botAction?a?a.p(e,n):((a=go(n)).c(),a.m(t,null)):a&&(a.d(1),a=null)},d(e){e&&pt(t),i&&i.d(),a&&a.d()}}}function mo(e){var t;return{c(){(t=dt("progress")).value=e.progress},m(e,n){ut(e,t,n)},p(e,n){e.progress&&(t.value=n.progress)},d(e){e&&pt(t)}}}function go(e){var t,n,r,o,i,a,s,c=JSON.stringify(e.botActionArgs)+"";return{c(){t=dt("li"),n=yt("Action: "),r=yt(e.botAction),o=vt(),i=dt("li"),a=yt("Args: "),s=yt(c),bt(t,"class","svelte-hsd9fq"),bt(i,"class","svelte-hsd9fq")},m(e,c){ut(e,t,c),lt(t,n),lt(t,r),ut(e,o,c),ut(e,i,c),lt(i,a),lt(i,s)},p(e,t){e.botAction&&wt(r,t.botAction),e.botActionArgs&&c!==(c=JSON.stringify(t.botActionArgs)+"")&&wt(s,c)},d(e){e&&(pt(t),pt(o),pt(i))}}}function bo(e){var t,n,r,o,i,a=[fo,po,uo],s=[];function c(e,t){return t.client.game.ai&&!t.client.multiplayer?0:t.client.multiplayer?1:2}return n=c(0,e),r=s[n]=a[n](e),{c(){t=dt("section"),r.c(),i=gt(window,"keydown",e.OnKeyDown)},m(e,r){ut(e,t,r),s[n].m(t,null),o=!0},p(e,o){var i=n;(n=c(0,o))===i?s[n].p(e,o):(Jt(),Qt(s[i],1,1,()=>{s[i]=null}),Yt(),(r=s[n])||(r=s[n]=a[n](o)).c(),Xt(r,1),r.m(t,null))},i(e){o||(Xt(r),o=!0)},o(e){Qt(r),o=!1},d(e){e&&pt(t),s[n].d(),i()}}}function wo(e,t,n){let{client:r}=t;const{secondaryPane:o}=Nt("secondaryPane"),i={MCTS:ao,Random:so};let a=!1,s=null,c=0,l=null;const u=({iterationCounter:e,numIterations:t,metadata:r})=>{n("iterationCounter",c=e),n("progress",s=e/t),l=r,a&&l&&o.set({component:Rr,metadata:l})};let p,f,d,h;function y(){r.overrideGameState(null),o.set(null),n("debug",a=!1)}return r.game.ai&&(n("bot",p=new ao({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),p.setOpt("async",!0)),_t(y),e.$set=e=>{"client"in e&&n("client",r=e.client)},{client:r,bots:i,debug:a,progress:s,iterationCounter:c,OnDebug:function(){a&&l?o.set({component:Rr,metadata:l}):o.set(null)},bot:p,selectedBot:f,botAction:d,botActionArgs:h,ChangeBot:function(){n("bot",p=new(0,i[f])({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),p.setOpt("async",!0),n("botAction",d=null),l=null,o.set(null),n("iterationCounter",c=0)},Step:async function(){n("botAction",d=null),l=null,n("iterationCounter",c=0);const e=await co(r,p);e&&(n("botAction",d=e.payload.type),n("botActionArgs",h=e.payload.args))},Simulate:function(e=1e4,t=100){return n("botAction",d=null),l=null,n("iterationCounter",c=0),(async()=>{for(let n=0;n<e;n++){if(!await co(r,p))break;await new Promise(e=>setTimeout(e,t))}})()},Reset:function(){r.reset(),n("botAction",d=null),l=null,n("iterationCounter",c=0),y()},OnKeyDown:function(e){27==e.keyCode&&y()},select_change_handler:function(){f=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n("selectedBot",f),n("bots",i)},input_change_handler:function(){a=this.checked,n("debug",a)}}}class xo extends sn{constructor(e){var t;super(),document.getElementById("svelte-hsd9fq-style")||((t=dt("style")).id="svelte-hsd9fq-style",t.textContent="li.svelte-hsd9fq{list-style:none;margin:none;margin-bottom:5px}h3.svelte-hsd9fq{text-transform:uppercase}label.svelte-hsd9fq{font-weight:bold;color:#999}input[type='checkbox'].svelte-hsd9fq{vertical-align:middle}",lt(document.head,t)),an(this,e,wo,bo,Qe,["client"])}}function ko(e){var t,n,r,o,i,a,s=new vn({props:{panes:e.panes,pane:e.pane}});s.$on("change",e.MenuChange);var c=e.panes[e.pane].component;function l(e){return{props:{client:e.client}}}if(c)var u=new c(l(e));var p=e.$secondaryPane&&$o(e);return{c(){t=dt("div"),s.$$.fragment.c(),n=vt(),r=dt("div"),u&&u.$$.fragment.c(),o=vt(),p&&p.c(),bt(r,"class","pane svelte-1h5kecx"),bt(t,"class","debug-panel svelte-1h5kecx")},m(e,i){ut(e,t,i),nn(s,t,null),lt(t,n),lt(t,r),u&&nn(u,r,null),lt(t,o),p&&p.m(t,null),a=!0},p(e,n){var o={};e.pane&&(o.pane=n.pane),s.$set(o);var i={};if(e.client&&(i.client=n.client),c!==(c=n.panes[n.pane].component)){if(u){Jt();const e=u;Qt(e.$$.fragment,1,0,()=>{rn(e,1)}),Yt()}c?((u=new c(l(n))).$$.fragment.c(),Xt(u.$$.fragment,1),nn(u,r,null)):u=null}else c&&u.$set(i);n.$secondaryPane?p?(p.p(e,n),Xt(p,1)):((p=$o(n)).c(),Xt(p,1),p.m(t,null)):p&&(Jt(),Qt(p,1,1,()=>{p=null}),Yt())},i(e){a||(Xt(s.$$.fragment,e),u&&Xt(u.$$.fragment,e),Xt(p),Ut(()=>{i||(i=en(t,pn,{x:400},!0)),i.run(1)}),a=!0)},o(e){Qt(s.$$.fragment,e),u&&Qt(u.$$.fragment,e),Qt(p),i||(i=en(t,pn,{x:400},!1)),i.run(0),a=!1},d(e){e&&pt(t),rn(s),u&&rn(u),p&&p.d(),e&&i&&i.end()}}}function $o(e){var t,n,r=e.$secondaryPane.component;function o(e){return{props:{metadata:e.$secondaryPane.metadata}}}if(r)var i=new r(o(e));return{c(){t=dt("div"),i&&i.$$.fragment.c(),bt(t,"class","secondary-pane svelte-1h5kecx")},m(e,r){ut(e,t,r),i&&nn(i,t,null),n=!0},p(e,n){var a={};if(e.$secondaryPane&&(a.metadata=n.$secondaryPane.metadata),r!==(r=n.$secondaryPane.component)){if(i){Jt();const e=i;Qt(e.$$.fragment,1,0,()=>{rn(e,1)}),Yt()}r?((i=new r(o(n))).$$.fragment.c(),Xt(i.$$.fragment,1),nn(i,t,null)):i=null}else r&&i.$set(a)},i(e){n||(i&&Xt(i.$$.fragment,e),n=!0)},o(e){i&&Qt(i.$$.fragment,e),n=!1},d(e){e&&pt(t),i&&rn(i)}}}function Po(e){var t,n,r,o=e.visible&&ko(e);return{c(){o&&o.c(),t=mt(),r=gt(window,"keypress",e.Keypress)},m(e,r){o&&o.m(e,r),ut(e,t,r),n=!0},p(e,n){n.visible?o?(o.p(e,n),Xt(o,1)):((o=ko(n)).c(),Xt(o,1),o.m(t.parentNode,t)):o&&(Jt(),Qt(o,1,1,()=>{o=null}),Yt())},i(e){n||(Xt(o),n=!0)},o(e){Qt(o),n=!1},d(e){o&&o.d(e),e&&pt(t),r()}}}function Co(e,t,n){let r,{client:o}=t;const i={main:{label:"Main",shortcut:"m",component:Vn},log:{label:"Log",shortcut:"l",component:Jr},info:{label:"Info",shortcut:"i",component:er},ai:{label:"AI",shortcut:"a",component:xo}},a=ln(!1),s=ln(null);Ze(e,s,e=>{r=e,n("$secondaryPane",r)}),Bt("hotkeys",{disableHotkeys:a}),Bt("secondaryPane",{secondaryPane:s});let c="main";let l=!0;return e.$set=e=>{"client"in e&&n("client",o=e.client)},{client:o,panes:i,secondaryPane:s,pane:c,MenuChange:function(e){n("pane",c=e.detail)},visible:l,Keypress:function(e){"."!=e.key?Object.entries(i).forEach(([t,{shortcut:r}])=>{e.key==r&&n("pane",c=t)}):n("visible",l=!l)},$secondaryPane:r}}class Oo extends sn{constructor(e){var t;super(),document.getElementById("svelte-1h5kecx-style")||((t=dt("style")).id="svelte-1h5kecx-style",t.textContent=".debug-panel.svelte-1h5kecx{position:fixed;color:#555;font-family:monospace;display:flex;flex-direction:row;text-align:left;right:0;top:0;height:100%;font-size:14px;box-sizing:border-box;opacity:0.9}.pane.svelte-1h5kecx{flex-grow:2;overflow-x:hidden;overflow-y:scroll;background:#fefefe;padding:20px;border-left:1px solid #ccc;box-shadow:-1px 0 5px rgba(0, 0, 0, 0.2);box-sizing:border-box;width:280px}.secondary-pane.svelte-1h5kecx{background:#fefefe;overflow-y:scroll}.debug-panel.svelte-1h5kecx button, select{cursor:pointer;outline:none;background:#eee;border:1px solid #bbb;color:#555;padding:3px;border-radius:3px}.debug-panel.svelte-1h5kecx button{padding-left:10px;padding-right:10px}.debug-panel.svelte-1h5kecx button:hover{background:#ddd}.debug-panel.svelte-1h5kecx button:active{background:#888;color:#fff}.debug-panel.svelte-1h5kecx section{margin-bottom:20px}",lt(document.head,t)),an(this,e,Co,Po,Qe,["client"])}}function Io({game:e,numPlayers:t,setupData:n}){t||(t=2);let r={G:{},ctx:(e=Ge(e)).flow.ctx(t),plugins:{}};r=((e,t)=>([...Ee,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(n=>{const r=n.name,o=n.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[r]:{data:o}}}}),e))(r,{game:e}),r=_e(r,{game:e,playerID:void 0});const o=Ae(r);r.G=e.setup(o,n);let i={...r,_undo:[],_redo:[],_stateID:0};return i=e.flow.init(i),i=je(i,{game:e}),i}function Do(e,t,n,r,o,i){return t.reduce((function(t,a){return t[a]=function(){var t=r;if(!i&&null==r){var s=n.getState();t=s.ctx.currentPlayer}for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];n.dispatch(M[e](a,l,t,o))},t}),{})}var Eo=Do.bind(null,"makeMove"),Ao=Do.bind(null,"gameEvent"),So=Do.bind(null,"plugin"),_o=function(){function e(t){var n=this,o=t.game,i=t.debug,a=t.numPlayers,s=t.multiplayer,c=t.gameID,l=t.playerID,u=t.credentials,p=t.enhancer;r(this,e),this.game=Ge(o),this.playerID=l,this.gameID=c,this.credentials=u,this.multiplayer=s,this.debug=i,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=oo({game:this.game,isClient:void 0!==s,numPlayers:a}),this.initialState=null,s||(this.initialState=Io({game:this.game,numPlayers:a})),this.reset=function(){n.store.dispatch(A(n.initialState))},this.undo=function(){n.store.dispatch(S(l,u))},this.redo=function(){n.store.dispatch(_(l,u))},this.store=null,this.log=[];var f=function(e){return function(t){return function(r){var o=t(r),i=e.getState();switch(r.type){case"MAKE_MOVE":case"GAME_EVENT":var a=i.deltalog;n.log=[].concat(h(n.log),h(a));break;case"RESET":n.log=[];break;case"UPDATE":var s=-1;n.log.length>0&&(s=n.log[n.log.length-1]._stateID);var c=r.deltalog||[];c=c.filter((function(e){return e._stateID>s})),n.log=[].concat(h(n.log),h(c));break;case"SYNC":n.initialState=r.initialState,n.log=r.log||[]}return o}}},d=function(e){return function(t){return function(r){var o=e.getState(),i=t(r);return 1!=r.clientOnly&&n.transport.onAction(o,r),i}}},y=function(){return function(e){return function(t){var r=e(t);return n.notifySubscribers(),r}}};p=void 0!==p?$(P(y,d,f),p):P(y,d,f),this.store=b(this.reducer,this.initialState,p),this.transport={isConnected:!0,onAction:function(){},subscribe:function(){},subscribeGameMetadata:function(e){},connect:function(){},disconnect:function(){},updateGameID:function(){},updatePlayerID:function(){}},s&&(this.transport=s({gameKey:o,game:this.game,store:this.store,gameID:c,playerID:l,gameName:this.game.name,numPlayers:a})),this.createDispatchers(),this.transport.subscribeGameMetadata((function(e){n.gameMetadata=e})),this._debugPanel=null}return i(e,[{key:"notifySubscribers",value:function(){var e=this;Object.values(this.subscribers).forEach((function(t){return t(e.getState())}))}},{key:"overrideGameState",value:function(e){this.gameStateOverride=e,this.notifySubscribers()}},{key:"start",value:function(){this.transport.connect(),this._running=!0;var e=null;if(e=Oo,this.debug&&this.debug.impl&&(e=this.debug.impl),null!==e&&!1!==this.debug&&null==this._debugPanel&&"undefined"!=typeof document){var t=document.body;this.debug&&void 0!==this.debug.target&&(t=this.debug.target),t&&(this._debugPanel=new e({target:t,props:{client:this}}))}}},{key:"stop",value:function(){this.transport.disconnect(),this._running=!1,null!=this._debugPanel&&(this._debugPanel.$destroy(),this._debugPanel=null)}},{key:"subscribe",value:function(e){var t=this,n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribe((function(){return t.notifySubscribers()})),!this._running&&this.multiplayer||e(this.getState()),function(){delete t.subscribers[n]}}},{key:"getInitialState",value:function(){return this.initialState}},{key:"getState",value:function(){var e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;var t=!0,n=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);var r=c({},e,{isActive:t,G:this.game.playerView(e.G,e.ctx,this.playerID),log:this.log});return r=c({},r,{isConnected:this.transport.isConnected})}},{key:"createDispatchers",value:function(){this.moves=Eo(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=Ao(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=So(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}},{key:"updatePlayerID",value:function(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}},{key:"updateGameID",value:function(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e),this.notifySubscribers()}},{key:"updateCredentials",value:function(e){this.credentials=e,this.createDispatchers(),this.notifySubscribers()}}]),e}();function jo(e){return new _o(e)}var Bo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function No(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Mo(e,t){return e(t={exports:{}},t.exports),t.exports}var To=Mo((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,d=n?Symbol.for("react.suspense"):60113,h=n?Symbol.for("react.suspense_list"):60120,y=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,m=n?Symbol.for("react.fundamental"):60117,g=n?Symbol.for("react.responder"):60118;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case p:case i:case s:case a:case d:return e;default:switch(e=e&&e.$$typeof){case l:case f:case c:return e;default:return t}}case v:case y:case o:return t}}}function w(e){return b(e)===p}t.typeOf=b,t.AsyncMode=u,t.ConcurrentMode=p,t.ContextConsumer=l,t.ContextProvider=c,t.Element=r,t.ForwardRef=f,t.Fragment=i,t.Lazy=v,t.Memo=y,t.Portal=o,t.Profiler=s,t.StrictMode=a,t.Suspense=d,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===p||e===s||e===a||e===d||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===y||e.$$typeof===c||e.$$typeof===l||e.$$typeof===f||e.$$typeof===m||e.$$typeof===g)},t.isAsyncMode=function(e){return w(e)||b(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return b(e)===l},t.isContextProvider=function(e){return b(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return b(e)===f},t.isFragment=function(e){return b(e)===i},t.isLazy=function(e){return b(e)===v},t.isMemo=function(e){return b(e)===y},t.isPortal=function(e){return b(e)===o},t.isProfiler=function(e){return b(e)===s},t.isStrictMode=function(e){return b(e)===a},t.isSuspense=function(e){return b(e)===d}}));No(To);To.typeOf,To.AsyncMode,To.ConcurrentMode,To.ContextConsumer,To.ContextProvider,To.Element,To.ForwardRef,To.Fragment,To.Lazy,To.Memo,To.Portal,To.Profiler,To.StrictMode,To.Suspense,To.isValidElementType,To.isAsyncMode,To.isConcurrentMode,To.isContextConsumer,To.isContextProvider,To.isElement,To.isForwardRef,To.isFragment,To.isLazy,To.isMemo,To.isPortal,To.isProfiler,To.isStrictMode,To.isSuspense;var Ro=Mo((function(e,t){}));No(Ro);Ro.typeOf,Ro.AsyncMode,Ro.ConcurrentMode,Ro.ContextConsumer,Ro.ContextProvider,Ro.Element,Ro.ForwardRef,Ro.Fragment,Ro.Lazy,Ro.Memo,Ro.Portal,Ro.Profiler,Ro.StrictMode,Ro.Suspense,Ro.isValidElementType,Ro.isAsyncMode,Ro.isConcurrentMode,Ro.isContextConsumer,Ro.isContextProvider,Ro.isElement,Ro.isForwardRef,Ro.isFragment,Ro.isLazy,Ro.isMemo,Ro.isPortal,Ro.isProfiler,Ro.isStrictMode,Ro.isSuspense,Mo((function(e){e.exports=To}));var qo=Object.getOwnPropertySymbols,zo=Object.prototype.hasOwnProperty,Fo=Object.prototype.propertyIsEnumerable;function Lo(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}})()&&Object.assign,Function.call.bind(Object.prototype.hasOwnProperty);function Uo(){}function Go(){}Go.resetWarningCache=Uo;var Ho,Ko=Mo((function(e){e.exports=function(){function e(e,t,n,r,o,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Go,resetWarningCache:Uo};return n.PropTypes=n,n}()}));!function(e){e[e.SYNC=0]="SYNC",e[e.ASYNC=1]="ASYNC"}(Ho||(Ho={}));class Vo extends class{type(){return Ho.SYNC}connect(){}}{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createGame(e,t){this.initial.set(e,t.initialState),this.setState(e,t.initialState),this.setMetadata(e,t.metadata)}setMetadata(e,t){this.metadata.set(e,t)}setState(e,t,n){if(n&&n.length>0){const t=this.log.get(e)||[];this.log.set(e,t.concat(n))}this.state.set(e,t)}fetch(e,t){let n={};return t.state&&(n.state=this.state.get(e)),t.metadata&&(n.metadata=this.metadata.get(e)),t.log&&(n.log=this.log.get(e)||[]),t.initialState&&(n.initialState=this.initial.get(e)),n}wipe(e){this.state.delete(e),this.metadata.delete(e)}listGames(e){if(e&&void 0!==e.gameName){let t=[];return this.metadata.forEach((n,r)=>{n.gameName===e.gameName&&t.push(r)}),t}return[...this.metadata.keys()]}}const Wo=(e,t)=>{if(e&&e.players)return e.players[t]};function Jo(e){return e.type()===Ho.SYNC}function Yo(e,t){return void 0===e?e:e.map(e=>{if(null!==t&&+t==+e.action.payload.playerID)return e;if(!0!==e.redact)return e;const n={...e.action.payload,args:null},r={...e,action:{...e.action,payload:n}},{redact:o,...i}=r;return i})}const Xo=e=>{if(!e)return!1;const{players:t}=e;return Object.keys(t).some(e=>!(!t[e]||!t[e].credentials))},Qo=(e,t)=>!!e&&(!!t&&e===t.credentials);class Zo{constructor(e,t,n,r){this.game=Ge(e),this.storageAPI=t,this.transportAPI=n,this.auth=null,this.subscribeCallback=()=>{},this.shouldAuth=()=>!1,!0===r?(this.auth=Qo,this.shouldAuth=Xo):"function"==typeof r&&(this.auth=r,this.shouldAuth=()=>!0)}subscribe(e){this.subscribeCallback=e}async onUpdate(e,t,n,r){let o;const i=e.payload.credentials;if(Jo(this.storageAPI)){const{metadata:e}=this.storageAPI.fetch(n,{metadata:!0}),t=Wo(e,r);o=!this.shouldAuth(e)||this.auth(i,t)}else{const{metadata:e}=await this.storageAPI.fetch(n,{metadata:!0}),t=Wo(e,r);o=!this.shouldAuth(e)||await this.auth(i,t)}if(!o)return{error:"unauthorized action"};let a=(e=>{const{credentials:t,...n}=e.payload;return{...e,payload:n}})(e);const s=n;let c,l;if(l=Jo(this.storageAPI)?this.storageAPI.fetch(s,{state:!0}):await this.storageAPI.fetch(s,{state:!0}),c=l.state,void 0===c)return Me(`game not found, gameID=[${s}]`),{error:"game not found"};if(void 0!==c.ctx.gameover)return void Me(`game over - gameID=[${s}]`);const u=b(oo({game:this.game}),c);if(!("UNDO"!=a.type&&"REDO"!=a.type||c.ctx.currentPlayer===r&&null===c.ctx.activePlayers))return void Me(`playerID=[${r}] cannot undo / redo right now`);if(!this.game.flow.isPlayerActive(c.G,c.ctx,r))return void Me(`player not active - playerID=[${r}]`);if("MAKE_MOVE"==a.type&&!this.game.flow.getMove(c.ctx,a.payload.type,r))return void Me(`move not processed - canPlayerMakeMove=false, playerID=[${r}]`);if(c._stateID!==t)return void Me(`invalid stateID, was=[${t}], expected=[${c._stateID}]`);u.dispatch(a),c=u.getState(),this.subscribeCallback({state:c,action:a,gameID:n}),this.transportAPI.sendAll(e=>{const t={...c,G:this.game.playerView(c.G,c.ctx,e),deltalog:void 0,_undo:[],_redo:[]},r=Yo(c.deltalog,e);return{type:"update",args:[n,t,r]}});const{deltalog:p,...f}=c;Jo(this.storageAPI)?this.storageAPI.setState(s,f,p):await this.storageAPI.setState(s,f,p)}async onSync(e,t,n){const r=e;let o,i,a,s,c,l;if(Jo(this.storageAPI)){l=this.storageAPI.fetch(r,{state:!0,metadata:!0,log:!0,initialState:!0})}else l=await this.storageAPI.fetch(r,{state:!0,metadata:!0,log:!0,initialState:!0});if(o=l.state,i=l.initialState,a=l.log,s=l.metadata,s&&(c=Object.values(s.players).map(e=>({id:e.id,name:e.name}))),void 0===o)if(i=o=Io({game:this.game,numPlayers:n}),this.subscribeCallback({state:o,gameID:e}),Jo(this.storageAPI)){this.storageAPI.setState(r,o)}else await this.storageAPI.setState(r,o);const u={...o,G:this.game.playerView(o.G,o.ctx,t),deltalog:void 0,_undo:[],_redo:[]};a=Yo(a,t);const p={state:u,log:a,filteredMetadata:c,initialState:i};this.transportAPI.send({playerID:t,type:"sync",args:[e,p]})}}var ei=function e(t){var n=t.store,o=t.gameName,i=t.playerID,a=t.gameID,s=t.numPlayers;r(this,e),this.store=n,this.gameName=o||"default",this.playerID=i||null,this.gameID=a||"default",this.numPlayers=s||2};function ti(e){var t=e.game,n=e.bots,r={},o={};if(t&&t.ai&&n)for(var i in n){var a=n[i];o[i]=new a({game:t,enumerate:t.ai.enumerate,seed:t.seed})}var s=function(e){var t=e.type,n=e.playerID,o=e.args,i=r[n];void 0!==i&&i.apply(null,[t].concat(h(o)))},c=new Zo(t,new Vo,{send:s,sendAll:function(e){for(var t in r){var n=e(t),o=n.type,i=n.args;s({type:o,playerID:t,args:i})}}},!1);return c.connect=function(e,t,n){r[t]=n},c.subscribe((function(e){var t=e.state,r=e.gameID;if(n){var i=function(e,t){if(void 0!==e.ctx.gameover)return null;if(e.ctx.stage)for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];if(o in e.ctx.stage)return o}else if(e.ctx.currentPlayer in t)return e.ctx.currentPlayer;return null}(t,o);null!==i&&setTimeout((async function(){var e=await o[i].play(t,i);await c.onUpdate(e.action,t._stateID,r,e.action.payload.playerID)}),100)}})),c}var ni=function(e){function t(e){var n,o=e.master,i=e.game,a=e.store,s=e.gameID,c=e.playerID,l=e.gameName,p=e.numPlayers;return r(this,t),(n=d(this,u(t).call(this,{store:a,gameName:l,playerID:c,gameID:s,numPlayers:p}))).master=o,n.game=i,n.isConnected=!0,n}return l(t,e),i(t,[{key:"onUpdate",value:async function(e,t,n){var r=this.store.getState();if(e==this.gameID&&t._stateID>=r._stateID){var o=E(t,n);this.store.dispatch(o)}}},{key:"onSync",value:function(e,t){if(e==this.gameID){var n=D(t);this.store.dispatch(n)}}},{key:"onAction",value:function(e,t){this.master.onUpdate(t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;this.master.connect(this.gameID,this.playerID,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];"sync"==t&&e.onSync.apply(e,r),"update"==t&&e.onUpdate.apply(e,r)})),this.master.onSync(this.gameID,this.playerID,this.numPlayers)}},{key:"disconnect",value:function(){}},{key:"subscribe",value:function(){}},{key:"subscribeGameMetadata",value:function(e){}},{key:"updateGameID",value:function(e){this.gameID=e;var t=A(null);this.store.dispatch(t),this.connect()}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=A(null);this.store.dispatch(t),this.connect()}}]),t}(ei),ri=new Map;var oi=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ii=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ai=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o=oi.exec(e||""),i={},a=14;a--;)i[ii[a]]=o[a]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},si=1e3,ci=6e4,li=36e5,ui=24*li,pi=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*ui;case"hours":case"hour":case"hrs":case"hr":case"h":return n*li;case"minutes":case"minute":case"mins":case"min":case"m":return n*ci;case"seconds":case"second":case"secs":case"sec":case"s":return n*si;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){return fi(e,ui,"day")||fi(e,li,"hour")||fi(e,ci,"minute")||fi(e,si,"second")||e+" ms"}(e):function(e){if(e>=ui)return Math.round(e/ui)+"d";if(e>=li)return Math.round(e/li)+"h";if(e>=ci)return Math.round(e/ci)+"m";if(e>=si)return Math.round(e/si)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function fi(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var di=Mo((function(e,t){function n(e){var n;function o(){if(o.enabled){var e=o,r=+new Date,i=r-(n||r);e.diff=i,e.prev=n,e.curr=r,n=r;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=a[c];n=o.call(e,i),a.splice(c,1),c--}return n})),t.formatArgs.call(e,a);var l=o.log||t.log||console.log.bind(console);l.apply(e,a)}}return o.namespace=e,o.enabled=t.enabled(e),o.useColors=t.useColors(),o.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),o.destroy=r,"function"==typeof t.init&&t.init(o),t.instances.push(o),o}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=pi,t.instances=[],t.names=[],t.skips=[],t.formatters={}})),hi=(di.coerce,di.disable,di.enable,di.enabled,di.humanize,di.instances,di.names,di.skips,di.formatters,Mo((function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=di).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))})),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}))),yi=(hi.log,hi.formatArgs,hi.save,hi.load,hi.useColors,hi.storage,hi.colors,hi("socket.io-client:url")),vi=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(yi("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),yi("parse %s",e),n=ai(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n};var mi=Mo((function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}})),gi={}.toString,bi=Array.isArray||function(e){return"[object Array]"==gi.call(e)},wi=function(e){return xi&&Buffer.isBuffer(e)||ki&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))},xi="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,ki="function"==typeof ArrayBuffer;var $i=Object.prototype.toString,Pi="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===$i.call(Blob),Ci="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===$i.call(File);var Oi=function(e){var t=[],n=e.data,r=e;return r.data=function e(t,n){if(!t)return t;if(wi(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(bi(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=e(t[i],n);return o}if("object"==typeof t&&!(t instanceof Date)){o={};for(var a in t)o[a]=e(t[a],n);return o}return t}(n,t),r.attachments=t.length,{packet:r,buffers:t}},Ii=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(bi(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],n);return t}(e.data,t),e.attachments=void 0,e},Di=function(e,t){var n=0,r=e;!function e(o,i,a){if(!o)return o;if(Pi&&o instanceof Blob||Ci&&o instanceof File){n++;var s=new FileReader;s.onload=function(){a?a[i]=this.result:r=this.result,--n||t(r)},s.readAsArrayBuffer(o)}else if(bi(o))for(var c=0;c<o.length;c++)e(o[c],c,o);else if("object"==typeof o&&!wi(o))for(var l in o)e(o[l],l,o)}(r),n||t(r)},Ei=Mo((function(e,t){var n=hi("socket.io-parser");function r(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=a;var o=t.ERROR+'"encode error"';function i(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return o;r+=i}return n("encoded %j as %s",e,r),r}function a(){this.reconstructor=null}function s(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}r.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){Di(e,(function(e){var n=Oi(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)}))}(e,r):r([i(e)])},mi(a.prototype),a.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return c("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(r+1))for(o.nsp="";++r;){if(","===(s=e.charAt(r)))break;if(o.nsp+=s,r===e.length)break}else o.nsp="/";var a=e.charAt(r+1);if(""!==a&&Number(a)==a){for(o.id="";++r;){var s;if(null==(s=e.charAt(r))||Number(s)!=s){--r;break}if(o.id+=e.charAt(r),r===e.length)break}o.id=Number(o.id)}if(e.charAt(++r)){var l=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r));if(!(!1!==l&&(o.type===t.ERROR||bi(l))))return c("invalid payload");o.data=l}return n("decoded %s as %j",e,o),o}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new s(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!wi(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},s.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Ii(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},s.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}})),Ai=(Ei.protocol,Ei.types,Ei.CONNECT,Ei.DISCONNECT,Ei.EVENT,Ei.ACK,Ei.ERROR,Ei.BINARY_EVENT,Ei.BINARY_ACK,Ei.Encoder,Ei.Decoder,Mo((function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}))),Si=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Ai))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},_i=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},ji={}.toString,Bi=Array.isArray||function(e){return"[object Array]"==ji.call(e)},Ni=Object.prototype.toString,Mi="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Ni.call(Blob),Ti="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Ni.call(File),Ri=function e(t){if(!t||"object"!=typeof t)return!1;if(Bi(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||Mi&&t instanceof Blob||Ti&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1};var qi=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)i[s]=o[a];return i.buffer},zi=function(e,t,n){var r=!1;return n=n||Fi,o.count=e,0===e?t():o;function o(e,i){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(r=!0,t(e),t=n):0!==o.count||r||t(null,i)}};function Fi(){}
/*! https://mths.be/utf8js v2.1.2 by @mathias */var Li,Ui,Gi,Hi=String.fromCharCode;function Ki(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function Vi(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Wi(e,t){return Hi(e>>t&63|128)}function Ji(e,t){if(0==(4294967168&e))return Hi(e);var n="";return 0==(4294965248&e)?n=Hi(e>>6&31|192):0==(4294901760&e)?(Vi(e,t)||(e=65533),n=Hi(e>>12&15|224),n+=Wi(e,6)):0==(4292870144&e)&&(n=Hi(e>>18&7|240),n+=Wi(e,12),n+=Wi(e,6)),n+=Hi(63&e|128)}function Yi(){if(Gi>=Ui)throw Error("Invalid byte index");var e=255&Li[Gi];if(Gi++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function Xi(e){var t,n;if(Gi>Ui)throw Error("Invalid byte index");if(Gi==Ui)return!1;if(t=255&Li[Gi],Gi++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|Yi())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|Yi()<<6|Yi())>=2048)return Vi(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|Yi()<<12|Yi()<<6|Yi())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var Qi={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=Ki(e),o=r.length,i=-1,a="";++i<o;)a+=Ji(r[i],n);return a},decode:function(e,t){var n=!1!==(t=t||{}).strict;Li=Ki(e),Ui=Li.length,Gi=0;for(var r,o=[];!1!==(r=Xi(n));)o.push(r);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)(t=e[r])>65535&&(o+=Hi((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=Hi(t);return o}(o)}},Zi=Mo((function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,a,s=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),p=new Uint8Array(u);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],a=n[e.charCodeAt(t+3)],p[l++]=r<<2|o>>4,p[l++]=(15&o)<<4|i>>2,p[l++]=(3&i)<<6|63&a;return u}}()})),ea=(Zi.encode,Zi.decode,void 0!==ea?ea:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder),ta=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),na=ta&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),ra=ea&&ea.prototype.append&&ea.prototype.getBlob;function oa(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function ia(e,t){t=t||{};var n=new ea;return oa(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function aa(e,t){return new Blob(oa(e),t||{})}"undefined"!=typeof Blob&&(ia.prototype=Blob.prototype,aa.prototype=Blob.prototype);var sa=ta?na?Blob:aa:ra?ia:void 0,ca=Mo((function(e,t){var n;"undefined"!=typeof ArrayBuffer&&(n=Zi);var r="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),o="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),i=r||o;t.protocol=3;var a=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=_i(a),c={type:"error",data:"parser error"};function l(e,t,n){for(var r=new Array(e.length),o=zi(e.length,n),i=function(e,n,o){t(n,(function(t,n){r[e]=n,o(t,r)}))},a=0;a<e.length;a++)i(a,e[a],o)}t.encodePacket=function(e,n,r,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof r&&(o=r,r=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=e.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=a[e.type];for(var c=0;c<i.length;c++)s[c+1]=i[c];return r(s.buffer)}(e,n,o);if(void 0!==sa&&s instanceof sa)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(i)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=new FileReader;return o.onload=function(){t.encodePacket({type:e.type,data:o.result},n,!0,r)},o.readAsArrayBuffer(e.data)}(e,n,r);var o=new Uint8Array(1);o[0]=a[e.type];var s=new sa([o.buffer,e.data]);return r(s)}(e,n,o);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,o);var c=a[e.type];return void 0!==e.data&&(c+=r?Qi.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,n){var r,o="b"+t.packets[e.type];if(void 0!==sa&&e.data instanceof sa){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(o+e)},i.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];r=String.fromCharCode.apply(null,s)}return o+=btoa(r),n(o)},t.decodePacket=function(e,n,r){if(void 0===e)return c;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=Qi.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return c;var o=e.charAt(0);return Number(o)==o&&s[o]?e.length>1?{type:s[o],data:e.substring(1)}:{type:s[o]}:c}o=new Uint8Array(e)[0];var i=qi(e,1);return sa&&"blob"===n&&(i=new sa([i])),{type:s[o],data:i}},t.decodeBase64Packet=function(e,t){var r=s[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=n.decode(e.substr(1));return"blob"===t&&sa&&(o=new sa([o])),{type:r,data:o}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var o=Ri(e);if(n&&o)return sa&&!i?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");l(e,(function(e,r){t.encodePacket(e,!!o&&n,!1,(function(e){r(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return r(t.join(""))}))},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var o;if("function"==typeof n&&(r=n,n=null),""===e)return r(c,0,1);for(var i,a,s="",l=0,u=e.length;l<u;l++){var p=e.charAt(l);if(":"===p){if(""===s||s!=(i=Number(s)))return r(c,0,1);if(s!=(a=e.substr(l+1,i)).length)return r(c,0,1);if(a.length){if(o=t.decodePacket(a,n,!1),c.type===o.type&&c.data===o.data)return r(c,0,1);if(!1===r(o,l+i,u))return}l+=i,s=""}else s+=p}return""!==s?r(c,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));l(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var r=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),o=new Uint8Array(r),i=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}o[i++]=t?0:1;var s=n.byteLength.toString();for(a=0;a<s.length;a++)o[i++]=parseInt(s[a]);o[i++]=255;for(r=new Uint8Array(n),a=0;a<r.length;a++)o[i++]=r[a]})),n(o.buffer)}))},t.encodePayloadAsBlob=function(e,n){l(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)a[o]=parseInt(i[o]);if(a[i.length]=255,sa){var s=new sa([t.buffer,a.buffer,e]);n(null,s)}}))}),(function(e,t){return n(new sa(t))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o=e,i=[];o.byteLength>0;){for(var a=new Uint8Array(o),s=0===a[0],l="",u=1;255!==a[u];u++){if(l.length>310)return r(c,0,1);l+=a[u]}o=qi(o,2+l.length),l=parseInt(l);var p=qi(o,0,l);if(s)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var f=new Uint8Array(p);p="";for(u=0;u<f.length;u++)p+=String.fromCharCode(f[u])}i.push(p),o=qi(o,l)}var d=i.length;i.forEach((function(e,o){r(t.decodePacket(e,n,!0),o,d)}))}})),la=(ca.protocol,ca.packets,ca.encodePacket,ca.encodeBase64Packet,ca.decodePacket,ca.decodeBase64Packet,ca.encodePayload,ca.decodePayload,ca.encodePayloadAsArrayBuffer,ca.encodePayloadAsBlob,ca.decodePayloadAsBinary,ua);function ua(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}mi(ua.prototype),ua.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},ua.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},ua.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},ua.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},ua.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},ua.prototype.onData=function(e){var t=ca.decodePacket(e,this.socket.binaryType);this.onPacket(t)},ua.prototype.onPacket=function(e){this.emit("packet",e)},ua.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var pa,fa=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},da=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t},ha=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},ya="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),va={},ma=0,ga=0;function ba(e){var t="";do{t=ya[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function wa(){var e=ba(+new Date);return e!==pa?(ma=0,pa=e):e+"."+ba(ma++)}for(;ga<64;ga++)va[ya[ga]]=ga;wa.encode=ba,wa.decode=function(e){var t=0;for(ga=0;ga<e.length;ga++)t=64*t+va[e.charAt(ga)];return t};var xa=wa,ka=hi("engine.io-client:polling"),$a=Ca,Pa=null!=new Si({xdomain:!1}).responseType;function Ca(e){var t=e&&e.forceBase64;Pa&&!t||(this.supportsBinary=!1),la.call(this,e)}ha(Ca,la),Ca.prototype.name="polling",Ca.prototype.doOpen=function(){this.poll()},Ca.prototype.pause=function(e){var t=this;function n(){ka("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(ka("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){ka("pre-pause polling complete"),--r||n()}))),this.writable||(ka("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){ka("pre-pause writing complete"),--r||n()})))}else n()},Ca.prototype.poll=function(){ka("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Ca.prototype.onData=function(e){var t=this;ka("polling got data %s",e);ca.decodePayload(e,this.socket.binaryType,(function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ka('ignoring poll - transport state "%s"',this.readyState))},Ca.prototype.doClose=function(){var e=this;function t(){ka("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(ka("transport open - closing"),t()):(ka("transport not open - deferring close"),this.once("open",t))},Ca.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};ca.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},Ca.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=xa()),this.supportsBinary||e.sid||(e.b64=1),e=fa(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var Oa=hi("engine.io-client:polling-xhr"),Ia=Aa,Da=Sa;function Ea(){}function Aa(e){if($a.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function Sa(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(ha(Aa,$a),Aa.prototype.supportsBinary=!0,Aa.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new Sa(e)},Aa.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",(function(e){o.onError("xhr post error",e)})),this.sendXhr=r},Aa.prototype.doPoll=function(){Oa("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},mi(Sa.prototype),Sa.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new Si(e),n=this;try{Oa("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");n.supportsBinary&&"application/octet-stream"===e&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError(t.status)}),0))},Oa("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Sa.requestsCount++,Sa.requests[this.index]=this)},Sa.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Sa.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},Sa.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},Sa.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=Ea:this.xhr.onreadystatechange=Ea,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Sa.requests[this.index],this.xhr=null}},Sa.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},Sa.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},Sa.prototype.abort=function(){this.cleanup()},Sa.requestsCount=0,Sa.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",ja);else if("function"==typeof addEventListener){var _a="onpagehide"in self?"pagehide":"unload";addEventListener(_a,ja,!1)}function ja(){for(var e in Sa.requests)Sa.requests.hasOwnProperty(e)&&Sa.requests[e].abort()}Ia.Request=Da;var Ba,Na=za,Ma=/\n/g,Ta=/\\n/g;function Ra(){}function qa(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==Bo?Bo:{}}function za(e){if($a.call(this,e),this.query=this.query||{},!Ba){var t=qa();Ba=t.___eio=t.___eio||[]}this.index=Ba.length;var n=this;Ba.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=Ra)}),!1)}ha(za,$a),za.prototype.supportsBinary=!1,za.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),$a.prototype.doClose.call(this)},za.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},za.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=a,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function s(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(Ta,"\\\n"),this.area.value=e.replace(Ma,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&s()}:this.iframe.onload=s};var Fa,La,Ua=hi("engine.io-client:websocket");if("undefined"!=typeof WebSocket)Fa=WebSocket;else if("undefined"!=typeof self)Fa=self.WebSocket||self.MozWebSocket;else try{La={}}catch(e){}var Ga=Fa||La,Ha=Ka;function Ka(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=Fa&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(Ga=La),la.call(this,e)}ha(Ka,la),Ka.prototype.name="websocket",Ka.prototype.supportsBinary=!0,Ka.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new Ga(e,t):new Ga(e):new Ga(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Ka.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Ka.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,o=n;r<o;r++)!function(e){ca.encodePacket(e,t.supportsBinary,(function(r){if(!t.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),t.perMessageDeflate)("string"==typeof r?Buffer.byteLength(r):r.length)<t.perMessageDeflate.threshold&&(o.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,o)}catch(e){Ua("websocket closed before onclose event")}--n||i()}))}(e[r]);function i(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}},Ka.prototype.onClose=function(){la.prototype.onClose.call(this)},Ka.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},Ka.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=xa()),this.supportsBinary||(e.b64=1),(e=fa(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},Ka.prototype.check=function(){return!(!Ga||"__initialize"in Ga&&this.name===Ka.prototype.name)};var Va={polling:function(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==o}if(e.xdomain=t,e.xscheme=n,"open"in new Si(e)&&!e.forceJSONP)return new Ia(e);if(!r)throw new Error("JSONP disabled");return new Na(e)},websocket:Ha},Wa=[].indexOf,Ja=function(e,t){if(Wa)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Ya=hi("engine.io-client:socket"),Xa=Qa;function Qa(e,t){if(!(this instanceof Qa))return new Qa(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=ai(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=ai(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=da(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Qa.priorWebsocketSuccess=!1,mi(Qa.prototype),Qa.protocol=ca.protocol,Qa.Socket=Qa,Qa.Transport=la,Qa.transports=Va,Qa.parser=ca,Qa.prototype.createTransport=function(e){Ya('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=ca.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new Va[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Qa.prototype.open=function(){var e;if(this.rememberUpgrade&&Qa.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Qa.prototype.setTransport=function(e){Ya("setting transport %s",e.name);var t=this;this.transport&&(Ya("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},Qa.prototype.probe=function(e){Ya('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(Ya('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(o){if(!n)if("pong"===o.type&&"probe"===o.data){if(Ya('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;Qa.priorWebsocketSuccess="websocket"===t.name,Ya('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(Ya("changing transport and sending upgrade packet"),u(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{Ya('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,r.emit("upgradeError",i)}})))}function i(){n||(n=!0,u(),t.close(),t=null)}function a(n){var o=new Error("probe error: "+n);o.transport=t.name,i(),Ya('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function s(){a("transport closed")}function c(){a("socket closed")}function l(e){t&&e.name!==t.name&&(Ya('"%s" works - aborting "%s"',e.name,t.name),i())}function u(){t.removeListener("open",o),t.removeListener("error",a),t.removeListener("close",s),r.removeListener("close",c),r.removeListener("upgrading",l)}Qa.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",a),t.once("close",s),this.once("close",c),this.once("upgrading",l),t.open()},Qa.prototype.onOpen=function(){if(Ya("socket open"),this.readyState="open",Qa.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Ya("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Qa.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Ya('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Ya('packet received with socket readyState "%s"',this.readyState)},Qa.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Qa.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},Qa.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){Ya("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},Qa.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},Qa.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Qa.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Ya("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Qa.prototype.write=Qa.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},Qa.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},Qa.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()}function t(){e.onClose("forced close"),Ya("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},Qa.prototype.onError=function(e){Ya("socket error %j",e),Qa.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Qa.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Ya('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},Qa.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~Ja(this.transports,e[n])&&t.push(e[n]);return t};var Za=Xa,es=ca;Za.parser=es;var ts=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n};var ns=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}};var rs=[].slice,os=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=rs.call(arguments,2);return function(){return t.apply(e,n.concat(rs.call(arguments)))}},is=Mo((function(e,t){var n=hi("socket.io-client:socket");e.exports=i;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},o=mi.prototype.emit;function i(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}mi(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[ns(e,"open",os(this,"onopen")),ns(e,"packet",os(this,"onpacket")),ns(e,"close",os(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},i.prototype.send=function(){var e=ts(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(r.hasOwnProperty(e))return o.apply(this,arguments),this;var t=ts(arguments),i={type:(void 0!==this.flags.binary?this.flags.binary:Ri(t))?Ei.BINARY_EVENT:Ei.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this.flags={},this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?fa(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:Ei.CONNECT,query:e})}else this.packet({type:Ei.CONNECT})},i.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===Ei.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case Ei.CONNECT:this.onconnect();break;case Ei.EVENT:case Ei.BINARY_EVENT:this.onevent(e);break;case Ei.ACK:case Ei.BINARY_ACK:this.onack(e);break;case Ei.DISCONNECT:this.ondisconnect();break;case Ei.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?o.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var o=ts(arguments);n("sending ack %j",o),t.packet({type:Ri(o)?Ei.BINARY_ACK:Ei.ACK,id:e,data:o})}}},i.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)o.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:Ei.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.prototype.compress=function(e){return this.flags.compress=e,this},i.prototype.binary=function(e){return this.flags.binary=e,this}})),as=ss;function ss(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ss.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},ss.prototype.reset=function(){this.attempts=0},ss.prototype.setMin=function(e){this.ms=e},ss.prototype.setMax=function(e){this.max=e},ss.prototype.setJitter=function(e){this.jitter=e};var cs=hi("socket.io-client:manager"),ls=Object.prototype.hasOwnProperty,us=ps;function ps(e,t){if(!(this instanceof ps))return new ps(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new as({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||Ei;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}ps.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)ls.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},ps.prototype.updateSocketIds=function(){for(var e in this.nsps)ls.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},ps.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},mi(ps.prototype),ps.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},ps.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},ps.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},ps.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},ps.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},ps.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},ps.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},ps.prototype.open=ps.prototype.connect=function(e,t){if(cs("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;cs("opening %s",this.uri),this.engine=Za(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=ns(n,"open",(function(){r.onopen(),e&&e()})),i=ns(n,"error",(function(t){if(cs("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;cs("connect attempt will timeout after %d",a);var s=setTimeout((function(){cs("connect attempt timed out after %d",a),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(o),this.subs.push(i),this},ps.prototype.onopen=function(){cs("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(ns(e,"data",os(this,"ondata"))),this.subs.push(ns(e,"ping",os(this,"onping"))),this.subs.push(ns(e,"pong",os(this,"onpong"))),this.subs.push(ns(e,"error",os(this,"onerror"))),this.subs.push(ns(e,"close",os(this,"onclose"))),this.subs.push(ns(this.decoder,"decoded",os(this,"ondecoded")))},ps.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},ps.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},ps.prototype.ondata=function(e){this.decoder.add(e)},ps.prototype.ondecoded=function(e){this.emit("packet",e)},ps.prototype.onerror=function(e){cs("error",e),this.emitAll("error",e)},ps.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new is(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",(function(){n.id=r.generateId(e)})),this.autoConnect&&o()}function o(){~Ja(r.connecting,n)||r.connecting.push(n)}return n},ps.prototype.destroy=function(e){var t=Ja(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},ps.prototype.packet=function(e){cs("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()})))},ps.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},ps.prototype.cleanup=function(){cs("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},ps.prototype.close=ps.prototype.disconnect=function(){cs("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},ps.prototype.onclose=function(e){cs("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},ps.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)cs("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();cs("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(cs("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(cs("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(cs("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},ps.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var fs=Mo((function(e,t){var n=hi("socket.io-client");e.exports=t=o;var r=t.managers={};function o(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,i=vi(e),a=i.source,s=i.id,c=i.path,l=r[s]&&c in r[s].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(n("ignoring socket cache for %s",a),o=us(a,t)):(r[s]||(n("new io instance for %s",a),r[s]=us(a,t)),o=r[s]),i.query&&!t.query&&(t.query=i.query),o.socket(i.path,t)}t.protocol=Ei.protocol,t.connect=o,t.Manager=us,t.Socket=is})),ds=(fs.managers,fs.protocol,fs.connect,fs.Manager,fs.Socket,function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.socket,i=n.socketOpts,a=n.store,s=n.gameID,c=n.playerID,l=n.gameName,p=n.numPlayers,f=n.server;return r(this,t),(e=d(this,u(t).call(this,{store:a,gameName:l,playerID:c,gameID:s,numPlayers:p}))).server=f,e.socket=o,e.socketOpts=i,e.isConnected=!1,e.callback=function(){},e.gameMetadataCallback=function(){},e}return l(t,e),i(t,[{key:"onAction",value:function(e,t){this.socket.emit("update",t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;if(!this.socket)if(this.server){var t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.substr(-1)&&(t+="/"),this.socket=fs(t+this.gameName,this.socketOpts)}else this.socket=fs("/"+this.gameName,this.socketOpts);this.socket.on("update",(function(t,n,r){var o=e.store.getState();if(t==e.gameID&&n._stateID>=o._stateID){var i=E(n,r);e.store.dispatch(i)}})),this.socket.on("sync",(function(t,n){if(t==e.gameID){var r=D(n);e.gameMetadataCallback(n.filteredMetadata),e.store.dispatch(r)}})),this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers),this.socket.on("connect",(function(){e.isConnected=!0,e.callback()})),this.socket.on("disconnect",(function(){e.isConnected=!1,e.callback()}))}},{key:"disconnect",value:function(){this.socket.close(),this.socket=null,this.isConnected=!1,this.callback()}},{key:"subscribe",value:function(e){this.callback=e}},{key:"subscribeGameMetadata",value:function(e){this.gameMetadataCallback=e}},{key:"updateGameID",value:function(e){this.gameID=e;var t=A(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=A(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}}]),t}(ei));e.Client=jo,e.Local=function(e){return function(t){var n;return ri.has(t.gameKey)&!e?n=ri.get(t.gameKey):(n=new ti({game:t.game,bots:e&&e.bots}),ri.set(t.gameKey,n)),new ni(c({master:n},t))}},e.MCTSBot=ao,e.RandomBot=so,e.ReactClient=function(e){var n,o,s=e.game,p=e.numPlayers,f=e.loading,h=e.board,y=e.multiplayer,v=e.enhancer,m=e.debug;if(void 0===f){f=function(){return t.createElement("div",{className:"bgio-loading"},"connecting...")}}return o=n=function(e){function n(e){var t;return r(this,n),t=d(this,u(n).call(this,e)),void 0===m&&(m=e.debug),t.client=jo({game:s,debug:m,numPlayers:p,multiplayer:y,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,enhancer:v}),t}return l(n,e),i(n,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.client.subscribe((function(){return e.forceUpdate()})),this.client.start()}},{key:"componentWillUnmount",value:function(){this.client.stop(),this.unsubscribe()}},{key:"componentDidUpdate",value:function(e){this.props.gameID!=e.gameID&&this.client.updateGameID(this.props.gameID),this.props.playerID!=e.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=e.credentials&&this.client.updateCredentials(this.props.credentials)}},{key:"render",value:function(){var e=this.client.getState();if(null===e)return t.createElement(f);var n=null;return h&&(n=t.createElement(h,c({},e,{},this.props,{isMultiplayer:!!y,moves:this.client.moves,events:this.client.events,gameID:this.client.gameID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,gameMetadata:this.client.gameMetadata}))),t.createElement("div",{className:"bgio-client"},n)}}]),n}(t.Component),a(n,"propTypes",{gameID:Ko.string,playerID:Ko.string,credentials:Ko.string,debug:Ko.any}),a(n,"defaultProps",{gameID:"default",playerID:null,credentials:null,debug:!0}),o},e.ReactNativeClient=function(e){var n,o,s=e.game,p=e.numPlayers,h=e.board,y=e.multiplayer,v=e.enhancer;return o=n=function(e){function n(e){var t;return r(this,n),(t=d(this,u(n).call(this,e))).client=jo({game:s,numPlayers:p,multiplayer:y,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,debug:!1,enhancer:v}),t}return l(n,e),i(n,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.client.subscribe((function(){return e.forceUpdate()})),this.client.start()}},{key:"componentWillUnmount",value:function(){this.client.stop(),this.unsubscribe()}},{key:"componentDidUpdate",value:function(e){e.gameID!=this.props.gameID&&this.client.updateGameID(this.props.gameID),e.playerID!=this.props.playerID&&this.client.updatePlayerID(this.props.playerID),e.credentials!=this.props.credentials&&this.client.updateCredentials(this.props.credentials)}},{key:"render",value:function(){var e=null,n=this.client.getState(),r=this.props,o=r.gameID,i=r.playerID,a=f(r,["gameID","playerID"]);return h&&(e=t.createElement(h,c({},n,{},a,{gameID:o,playerID:i,isMultiplayer:!!y,moves:this.client.moves,events:this.client.events,step:this.client.step,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,gameMetadata:this.client.gameMetadata}))),e}}]),n}(t.Component),a(n,"propTypes",{gameID:Ko.string,playerID:Ko.string,credentials:Ko.string}),a(n,"defaultProps",{gameID:"default",playerID:null,credentials:null}),o},e.Simulate=async function(e){var t=e.game,n=e.bots,r=e.state,o=e.depth;void 0===o&&(o=1e4);for(var i=oo({game:t,numPlayers:r.ctx.numPlayers}),a=null,s=0;void 0===r.ctx.gameover&&s<o;){var c=r.ctx.currentPlayer;r.ctx.activePlayers&&(c=Object.keys(r.ctx.activePlayers)[0]);var l=n instanceof io?n:n[c],u=await l.play(r,c);if(!u.action)break;a=u.metadata,r=i(r,u.action),s++}return{state:r,metadata:a}},e.SocketIO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.server,n=e.socketOpts;return function(e){return new ds(c({server:t,socketOpts:n},e))}},e.Step=co,e.TurnOrder=Fe,Object.defineProperty(e,"__esModule",{value:!0})}));
